var eE=Object.defineProperty;var iE=(i,t,e)=>t in i?eE(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var P=(i,t,e)=>(iE(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();var wa=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(wa||{}),Od=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(Od||{}),ue=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(ue||{}),vn=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(vn||{}),Yt=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(Yt||{}),po=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(po||{}),de=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(de||{}),Fd=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(Fd||{}),Kn=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(Kn||{}),Bs=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(Bs||{}),xn=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(xn||{}),an=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(an||{}),ea=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(ea||{}),df=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(df||{}),zr=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(zr||{}),Pi=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(Pi||{}),Ti=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(Ti||{}),bn=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(bn||{});const rE={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t)};var ed=/iPhone/i,Vm=/iPod/i,Xm=/iPad/i,jm=/\biOS-universal(?:.+)Mac\b/i,id=/\bAndroid(?:.+)Mobile\b/i,Ym=/Android/i,$a=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Tl=/Silk/i,Wn=/Windows Phone/i,Km=/\bWindows(?:.+)ARM\b/i,qm=/BlackBerry/i,$m=/BB10/i,Zm=/Opera Mini/i,Qm=/\b(CriOS|Chrome)(?:.+)Mobile/i,Jm=/Mobile(?:.+)Firefox\b/i,tg=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function nE(i){return function(t){return t.test(i)}}function sE(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var n=nE(e),s={apple:{phone:n(ed)&&!n(Wn),ipod:n(Vm),tablet:!n(ed)&&(n(Xm)||tg(t))&&!n(Wn),universal:n(jm),device:(n(ed)||n(Vm)||n(Xm)||n(jm)||tg(t))&&!n(Wn)},amazon:{phone:n($a),tablet:!n($a)&&n(Tl),device:n($a)||n(Tl)},android:{phone:!n(Wn)&&n($a)||!n(Wn)&&n(id),tablet:!n(Wn)&&!n($a)&&!n(id)&&(n(Tl)||n(Ym)),device:!n(Wn)&&(n($a)||n(Tl)||n(id)||n(Ym))||n(/\bokhttp\b/i)},windows:{phone:n(Wn),tablet:n(Km),device:n(Wn)||n(Km)},other:{blackberry:n(qm),blackberry10:n($m),opera:n(Zm),firefox:n(Jm),chrome:n(Qm),device:n(qm)||n($m)||n(Zm)||n(Jm)||n(Qm)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const qn=sE(globalThis.navigator);function aE(){return!qn.apple.device}function oE(i){let t=!0;if(qn.tablet||qn.phone){if(qn.apple.device){const e=navigator.userAgent.match(/OS (\d+)_(\d+)?/);e&&parseInt(e[1],10)<11&&(t=!1)}if(qn.android.device){const e=navigator.userAgent.match(/Android\s([0-9.]*)/);e&&parseInt(e[1],10)<7&&(t=!1)}}return t?i:4}const Xt={ADAPTER:rE,MIPMAP_TEXTURES:xn.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:Ti.NONE,SPRITE_MAX_TEXTURES:oE(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},GC_MODE:df.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:Bs.CLAMP,SCALE_MODE:Kn.LINEAR,PRECISION_VERTEX:zr.HIGH,PRECISION_FRAGMENT:qn.apple.device?zr.HIGH:zr.MEDIUM,CAN_UPLOAD_SAME_BUFFER:aE(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};Xt.PREFER_ENV=wa.WEBGL2;Xt.STRICT_TEXTURE_CACHE=!1;var Jt=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(Jt||{});const eg=i=>{if((typeof i=="function"||typeof i=="object"&&i.extension)&&(i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}),typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},le={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(eg).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...i){return i.map(eg).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,n=this._queue;r[e]?r[e](t):(n[e]=n[e]||[],n[e].push(t))})}),this},handle(i,t,e){const r=this._addHandlers,n=this._removeHandlers;r[i]=t,n[i]=e;const s=this._queue;return s[i]&&(s[i].forEach(a=>t(a)),delete s[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t){return this.handle(i,e=>{t.includes(e.ref)||(t.push(e.ref),t.sort((r,n)=>(n.priority??-1)-(r.priority??-1)))},e=>{const r=t.indexOf(e.ref);r!==-1&&t.splice(r,1)})}},dc=Math.PI*2,hE=180/Math.PI,lE=Math.PI/180;var Ki=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(Ki||{});class He{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new He(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}const Sl=[new He,new He,new He,new He];class Te{constructor(t=0,e=0,r=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(n),this.type=Ki.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Te(0,0,0,0)}clone(){return new Te(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const et=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=et)return!1;const rt=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>rt}const r=this.left,n=this.right,s=this.top,a=this.bottom;if(n<=r||a<=s)return!1;const o=Sl[0].set(t.left,t.top),u=Sl[1].set(t.left,t.bottom),d=Sl[2].set(t.right,t.top),m=Sl[3].set(t.right,t.bottom);if(d.x<=o.x||u.y<=o.y)return!1;const l=Math.sign(e.a*e.d-e.b*e.c);if(l===0||(e.apply(o,o),e.apply(u,u),e.apply(d,d),e.apply(m,m),Math.max(o.x,u.x,d.x,m.x)<=r||Math.min(o.x,u.x,d.x,m.x)>=n||Math.max(o.y,u.y,d.y,m.y)<=s||Math.min(o.y,u.y,d.y,m.y)>=a))return!1;const f=l*(u.y-o.y),p=l*(o.x-u.x),y=f*r+p*s,v=f*n+p*s,_=f*r+p*a,w=f*n+p*a;if(Math.max(y,v,_,w)<=f*o.x+p*o.y||Math.min(y,v,_,w)>=f*m.x+p*m.y)return!1;const T=l*(o.y-d.y),E=l*(d.x-o.x),R=T*r+E*s,H=T*n+E*s,Y=T*r+E*a,j=T*n+E*a;return!(Math.max(R,H,Y,j)<=T*o.x+E*o.y||Math.min(R,H,Y,j)>=T*m.x+E*m.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=s-n,this}}class ff{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=Ki.CIRC}clone(){return new ff(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=r}getBounds(){return new Te(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}class pf{constructor(t=0,e=0,r=0,n=0){this.x=t,this.y=e,this.width=r,this.height=n,this.type=Ki.ELIP}clone(){return new pf(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,n=(e-this.y)/this.height;return r*=r,n*=n,r+n<=1}getBounds(){return new Te(this.x-this.width,this.y-this.height,this.width,this.height)}}class mo{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const r=[];for(let n=0,s=e.length;n<s;n++)r.push(e[n].x,e[n].y);e=r}this.points=e,this.type=Ki.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new mo(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const n=this.points.length/2;for(let s=0,a=n-1;s<n;a=s++){const o=this.points[s*2],u=this.points[s*2+1],d=this.points[a*2],m=this.points[a*2+1];u>e!=m>e&&t<(d-o)*((e-u)/(m-u))+o&&(r=!r)}return r}}class mf{constructor(t=0,e=0,r=0,n=0,s=20){this.x=t,this.y=e,this.width=r,this.height=n,this.radius=s,this.type=Ki.RREC}clone(){return new mf(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let n=t-(this.x+r),s=e-(this.y+r);const a=r*r;if(n*n+s*s<=a||(n=t-(this.x+this.width-r),n*n+s*s<=a)||(s=e-(this.y+this.height-r),n*n+s*s<=a)||(n=t-(this.x+r),n*n+s*s<=a))return!0}return!1}}class Cs{constructor(t,e,r=0,n=0){this._x=r,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Cs(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}class vi{constructor(t=1,e=0,r=0,n=1,s=0,a=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,n,s,a){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new He;const r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e}applyInverse(t,e){e=e||new He;const r=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*r*n+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*s+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),n=this.a,s=this.c,a=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=s*e-this.d*r,this.d=s*r+this.d*e,this.tx=a*e-this.ty*r,this.ty=a*r+this.ty*e,this}append(t){const e=this.a,r=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*s+this.ty,this}setTransform(t,e,r,n,s,a,o,u,d){return this.a=Math.cos(o+d)*s,this.b=Math.sin(o+d)*s,this.c=-Math.sin(o-u)*a,this.d=Math.cos(o-u)*a,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,n=this.c,s=this.d,a=t.pivot,o=-Math.atan2(-n,s),u=Math.atan2(r,e),d=Math.abs(o+u);return d<1e-5||Math.abs(dc-d)<1e-5?(t.rotation=u,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=u),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(a.x*e+a.y*n),t.position.y=this.ty+(a.x*r+a.y*s),t}invert(){const t=this.a,e=this.b,r=this.c,n=this.d,s=this.tx,a=t*n-e*r;return this.a=n/a,this.b=-e/a,this.c=-r/a,this.d=t/a,this.tx=(r*this.ty-n*s)/a,this.ty=-(t*this.ty-e*s)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new vi;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new vi}static get TEMP_MATRIX(){return new vi}}const ia=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ra=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],na=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],sa=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Nd=[],b0=[],Cl=Math.sign;function cE(){for(let i=0;i<16;i++){const t=[];Nd.push(t);for(let e=0;e<16;e++){const r=Cl(ia[i]*ia[e]+na[i]*ra[e]),n=Cl(ra[i]*ia[e]+sa[i]*ra[e]),s=Cl(ia[i]*na[e]+na[i]*sa[e]),a=Cl(ra[i]*na[e]+sa[i]*sa[e]);for(let o=0;o<16;o++)if(ia[o]===r&&ra[o]===n&&na[o]===s&&sa[o]===a){t.push(o);break}}}for(let i=0;i<16;i++){const t=new vi;t.set(ia[i],ra[i],na[i],sa[i],0,0),b0.push(t)}}cE();const ui={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>ia[i],uY:i=>ra[i],vX:i=>na[i],vY:i=>sa[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>Nd[i][t],sub:(i,t)=>Nd[i][ui.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?ui.S:ui.N:Math.abs(t)*2<=Math.abs(i)?i>0?ui.E:ui.W:t>0?i>0?ui.SE:ui.SW:i>0?ui.NE:ui.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const n=b0[ui.inv(t)];n.tx=e,n.ty=r,i.append(n)}},x0=class{constructor(){this.worldTransform=new vi,this.localTransform=new vi,this.position=new Cs(this.onChange,this,0,0),this.scale=new Cs(this.onChange,this,1,1),this.pivot=new Cs(this.onChange,this,0,0),this.skew=new Cs(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};let kc=x0;kc.IDENTITY=new x0;class en{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,n,s,a,o,u){if(arguments.length>8)throw new Error("max arguments reached");const{name:d,items:m}=this;this._aliasCount++;for(let l=0,f=m.length;l<f;l++)m[l][d](t,e,r,n,s,a,o,u);return m===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(en.prototype,{dispatch:{value:en.prototype.emit},run:{value:en.prototype.emit}});Xt.TARGET_FPMS=.06;var pa=(i=>(i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(pa||{});class rd{constructor(t,e=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}class xi{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new rd(null,null,1/0),this.deltaMS=1/Xt.TARGET_FPMS,this.elapsedMS=1/Xt.TARGET_FPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=pa.NORMAL){return this._addListener(new rd(t,e,r))}addOnce(t,e,r=pa.NORMAL){return this._addListener(new rd(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Xt.TARGET_FPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,Xt.TARGET_FPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!xi._shared){const t=xi._shared=new xi;t.autoStart=!0,t._protected=!0}return xi._shared}static get system(){if(!xi._system){const t=xi._system=new xi;t.autoStart=!0,t._protected=!0}return xi._system}}class A0{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,pa.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?xi.shared:new xi,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}A0.extension=Jt.Application;le.add(A0);var hi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qR(i){var t=i.default;if(typeof t=="function"){var e=function(){return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),e}var E0={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function n(u,d,m){this.fn=u,this.context=d,this.once=m||!1}function s(u,d,m,l,f){if(typeof m!="function")throw new TypeError("The listener must be a function");var p=new n(m,l||u,f),y=e?e+d:d;return u._events[y]?u._events[y].fn?u._events[y]=[u._events[y],p]:u._events[y].push(p):(u._events[y]=p,u._eventsCount++),u}function a(u,d){--u._eventsCount===0?u._events=new r:delete u._events[d]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var d=[],m,l;if(this._eventsCount===0)return d;for(l in m=this._events)t.call(m,l)&&d.push(e?l.slice(1):l);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(m)):d},o.prototype.listeners=function(d){var m=e?e+d:d,l=this._events[m];if(!l)return[];if(l.fn)return[l.fn];for(var f=0,p=l.length,y=new Array(p);f<p;f++)y[f]=l[f].fn;return y},o.prototype.listenerCount=function(d){var m=e?e+d:d,l=this._events[m];return l?l.fn?1:l.length:0},o.prototype.emit=function(d,m,l,f,p,y){var v=e?e+d:d;if(!this._events[v])return!1;var _=this._events[v],w=arguments.length,T,E;if(_.fn){switch(_.once&&this.removeListener(d,_.fn,void 0,!0),w){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,m),!0;case 3:return _.fn.call(_.context,m,l),!0;case 4:return _.fn.call(_.context,m,l,f),!0;case 5:return _.fn.call(_.context,m,l,f,p),!0;case 6:return _.fn.call(_.context,m,l,f,p,y),!0}for(E=1,T=new Array(w-1);E<w;E++)T[E-1]=arguments[E];_.fn.apply(_.context,T)}else{var R=_.length,H;for(E=0;E<R;E++)switch(_[E].once&&this.removeListener(d,_[E].fn,void 0,!0),w){case 1:_[E].fn.call(_[E].context);break;case 2:_[E].fn.call(_[E].context,m);break;case 3:_[E].fn.call(_[E].context,m,l);break;case 4:_[E].fn.call(_[E].context,m,l,f);break;default:if(!T)for(H=1,T=new Array(w-1);H<w;H++)T[H-1]=arguments[H];_[E].fn.apply(_[E].context,T)}}return!0},o.prototype.on=function(d,m,l){return s(this,d,m,l,!1)},o.prototype.once=function(d,m,l){return s(this,d,m,l,!0)},o.prototype.removeListener=function(d,m,l,f){var p=e?e+d:d;if(!this._events[p])return this;if(!m)return a(this,p),this;var y=this._events[p];if(y.fn)y.fn===m&&(!f||y.once)&&(!l||y.context===l)&&a(this,p);else{for(var v=0,_=[],w=y.length;v<w;v++)(y[v].fn!==m||f&&!y[v].once||l&&y[v].context!==l)&&_.push(y[v]);_.length?this._events[p]=_.length===1?_[0]:_:a(this,p)}return this},o.prototype.removeAllListeners=function(d){var m;return d?(m=e?e+d:d,this._events[m]&&a(this,m)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,i.exports=o})(E0);const Io=E0.exports;var gf={exports:{}};gf.exports=Rc;gf.exports.default=Rc;function Rc(i,t,e){e=e||2;var r=t&&t.length,n=r?t[0]*e:i.length,s=T0(i,0,n,e,!0),a=[];if(!s||s.next===s.prev)return a;var o,u,d,m,l,f,p;if(r&&(s=mE(i,t,s,e)),i.length>80*e){o=d=i[0],u=m=i[1];for(var y=e;y<n;y+=e)l=i[y],f=i[y+1],l<o&&(o=l),f<u&&(u=f),l>d&&(d=l),f>m&&(m=f);p=Math.max(d-o,m-u),p=p!==0?32767/p:0}return xh(s,a,e,o,u,p,0),a}function T0(i,t,e,r,n){var s,a;if(n===Gd(i,t,e,r)>0)for(s=t;s<e;s+=r)a=ig(s,i[s],i[s+1],a);else for(s=e-r;s>=t;s-=r)a=ig(s,i[s],i[s+1],a);return a&&Pc(a,a.next)&&(Eh(a),a=a.next),a}function ma(i,t){if(!i)return i;t||(t=i);var e=i,r;do if(r=!1,!e.steiner&&(Pc(e,e.next)||fi(e.prev,e,e.next)===0)){if(Eh(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function xh(i,t,e,r,n,s,a){if(!!i){!a&&s&&wE(i,r,n,s);for(var o=i,u,d;i.prev!==i.next;){if(u=i.prev,d=i.next,s?dE(i,r,n,s):uE(i)){t.push(u.i/e|0),t.push(i.i/e|0),t.push(d.i/e|0),Eh(i),i=d.next,o=d.next;continue}if(i=d,i===o){a?a===1?(i=fE(ma(i),t,e),xh(i,t,e,r,n,s,2)):a===2&&pE(i,t,e,r,n,s):xh(ma(i),t,e,r,n,s,1);break}}}}function uE(i){var t=i.prev,e=i,r=i.next;if(fi(t,e,r)>=0)return!1;for(var n=t.x,s=e.x,a=r.x,o=t.y,u=e.y,d=r.y,m=n<s?n<a?n:a:s<a?s:a,l=o<u?o<d?o:d:u<d?u:d,f=n>s?n>a?n:a:s>a?s:a,p=o>u?o>d?o:d:u>d?u:d,y=r.next;y!==t;){if(y.x>=m&&y.x<=f&&y.y>=l&&y.y<=p&&no(n,o,s,u,a,d,y.x,y.y)&&fi(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function dE(i,t,e,r){var n=i.prev,s=i,a=i.next;if(fi(n,s,a)>=0)return!1;for(var o=n.x,u=s.x,d=a.x,m=n.y,l=s.y,f=a.y,p=o<u?o<d?o:d:u<d?u:d,y=m<l?m<f?m:f:l<f?l:f,v=o>u?o>d?o:d:u>d?u:d,_=m>l?m>f?m:f:l>f?l:f,w=Ud(p,y,t,e,r),T=Ud(v,_,t,e,r),E=i.prevZ,R=i.nextZ;E&&E.z>=w&&R&&R.z<=T;){if(E.x>=p&&E.x<=v&&E.y>=y&&E.y<=_&&E!==n&&E!==a&&no(o,m,u,l,d,f,E.x,E.y)&&fi(E.prev,E,E.next)>=0||(E=E.prevZ,R.x>=p&&R.x<=v&&R.y>=y&&R.y<=_&&R!==n&&R!==a&&no(o,m,u,l,d,f,R.x,R.y)&&fi(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;E&&E.z>=w;){if(E.x>=p&&E.x<=v&&E.y>=y&&E.y<=_&&E!==n&&E!==a&&no(o,m,u,l,d,f,E.x,E.y)&&fi(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;R&&R.z<=T;){if(R.x>=p&&R.x<=v&&R.y>=y&&R.y<=_&&R!==n&&R!==a&&no(o,m,u,l,d,f,R.x,R.y)&&fi(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function fE(i,t,e){var r=i;do{var n=r.prev,s=r.next.next;!Pc(n,s)&&S0(n,r,r.next,s)&&Ah(n,s)&&Ah(s,n)&&(t.push(n.i/e|0),t.push(r.i/e|0),t.push(s.i/e|0),Eh(r),Eh(r.next),r=i=s),r=r.next}while(r!==i);return ma(r)}function pE(i,t,e,r,n,s){var a=i;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&AE(a,o)){var u=C0(a,o);a=ma(a,a.next),u=ma(u,u.next),xh(a,t,e,r,n,s,0),xh(u,t,e,r,n,s,0);return}o=o.next}a=a.next}while(a!==i)}function mE(i,t,e,r){var n=[],s,a,o,u,d;for(s=0,a=t.length;s<a;s++)o=t[s]*r,u=s<a-1?t[s+1]*r:i.length,d=T0(i,o,u,r,!1),d===d.next&&(d.steiner=!0),n.push(xE(d));for(n.sort(gE),s=0;s<n.length;s++)e=yE(n[s],e);return e}function gE(i,t){return i.x-t.x}function yE(i,t){var e=vE(i,t);if(!e)return t;var r=C0(e,i);return ma(r,r.next),ma(e,e.next)}function vE(i,t){var e=t,r=i.x,n=i.y,s=-1/0,a;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var o=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(o<=r&&o>s&&(s=o,a=e.x<e.next.x?e:e.next,o===r))return a}e=e.next}while(e!==t);if(!a)return null;var u=a,d=a.x,m=a.y,l=1/0,f;e=a;do r>=e.x&&e.x>=d&&r!==e.x&&no(n<m?r:s,n,d,m,n<m?s:r,n,e.x,e.y)&&(f=Math.abs(n-e.y)/(r-e.x),Ah(e,i)&&(f<l||f===l&&(e.x>a.x||e.x===a.x&&_E(a,e)))&&(a=e,l=f)),e=e.next;while(e!==u);return a}function _E(i,t){return fi(i.prev,i,t.prev)<0&&fi(t.next,i,i.next)<0}function wE(i,t,e,r){var n=i;do n.z===0&&(n.z=Ud(n.x,n.y,t,e,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==i);n.prevZ.nextZ=null,n.prevZ=null,bE(n)}function bE(i){var t,e,r,n,s,a,o,u,d=1;do{for(e=i,i=null,s=null,a=0;e;){for(a++,r=e,o=0,t=0;t<d&&(o++,r=r.nextZ,!!r);t++);for(u=d;o>0||u>0&&r;)o!==0&&(u===0||!r||e.z<=r.z)?(n=e,e=e.nextZ,o--):(n=r,r=r.nextZ,u--),s?s.nextZ=n:i=n,n.prevZ=s,s=n;e=r}s.nextZ=null,d*=2}while(a>1);return i}function Ud(i,t,e,r,n){return i=(i-e)*n|0,t=(t-r)*n|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function xE(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function no(i,t,e,r,n,s,a,o){return(n-a)*(t-o)>=(i-a)*(s-o)&&(i-a)*(r-o)>=(e-a)*(t-o)&&(e-a)*(s-o)>=(n-a)*(r-o)}function AE(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!EE(i,t)&&(Ah(i,t)&&Ah(t,i)&&TE(i,t)&&(fi(i.prev,i,t.prev)||fi(i,t.prev,t))||Pc(i,t)&&fi(i.prev,i,i.next)>0&&fi(t.prev,t,t.next)>0)}function fi(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function Pc(i,t){return i.x===t.x&&i.y===t.y}function S0(i,t,e,r){var n=Il(fi(i,t,e)),s=Il(fi(i,t,r)),a=Il(fi(e,r,i)),o=Il(fi(e,r,t));return!!(n!==s&&a!==o||n===0&&Ml(i,e,t)||s===0&&Ml(i,r,t)||a===0&&Ml(e,i,r)||o===0&&Ml(e,t,r))}function Ml(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function Il(i){return i>0?1:i<0?-1:0}function EE(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&S0(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function Ah(i,t){return fi(i.prev,i,i.next)<0?fi(i,t,i.next)>=0&&fi(i,i.prev,t)>=0:fi(i,t,i.prev)<0||fi(i,i.next,t)<0}function TE(i,t){var e=i,r=!1,n=(i.x+t.x)/2,s=(i.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==i);return r}function C0(i,t){var e=new Hd(i.i,i.x,i.y),r=new Hd(t.i,t.x,t.y),n=i.next,s=t.prev;return i.next=t,t.prev=i,e.next=n,n.prev=e,r.next=e,e.prev=r,s.next=r,r.prev=s,r}function ig(i,t,e,r){var n=new Hd(i,t,e);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Eh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Hd(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Rc.deviation=function(i,t,e,r){var n=t&&t.length,s=n?t[0]*e:i.length,a=Math.abs(Gd(i,0,s,e));if(n)for(var o=0,u=t.length;o<u;o++){var d=t[o]*e,m=o<u-1?t[o+1]*e:i.length;a-=Math.abs(Gd(i,d,m,e))}var l=0;for(o=0;o<r.length;o+=3){var f=r[o]*e,p=r[o+1]*e,y=r[o+2]*e;l+=Math.abs((i[f]-i[y])*(i[p+1]-i[f+1])-(i[f]-i[p])*(i[y+1]-i[f+1]))}return a===0&&l===0?0:Math.abs((l-a)/a)};function Gd(i,t,e,r){for(var n=0,s=t,a=e-r;s<e;s+=r)n+=(i[a]-i[s])*(i[s+1]+i[a+1]),a=s;return n}Rc.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},r=0,n=0;n<i.length;n++){for(var s=0;s<i[n].length;s++)for(var a=0;a<t;a++)e.vertices.push(i[n][s][a]);n>0&&(r+=i[n-1].length,e.holes.push(r))}return e};var Wd={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(i,t){(function(e){var r=t&&!t.nodeType&&t,n=i&&!i.nodeType&&i,s=typeof hi=="object"&&hi;(s.global===s||s.window===s||s.self===s)&&(e=s);var a,o=2147483647,u=36,d=1,m=26,l=38,f=700,p=72,y=128,v="-",_=/^xn--/,w=/[^\x20-\x7E]/,T=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},R=u-d,H=Math.floor,Y=String.fromCharCode,j;function et(xt){throw RangeError(E[xt])}function J(xt,tt){for(var it=xt.length,Gt=[];it--;)Gt[it]=tt(xt[it]);return Gt}function rt(xt,tt){var it=xt.split("@"),Gt="";it.length>1&&(Gt=it[0]+"@",xt=it[1]),xt=xt.replace(T,".");var Dt=xt.split("."),Mt=J(Dt,tt).join(".");return Gt+Mt}function gt(xt){for(var tt=[],it=0,Gt=xt.length,Dt,Mt;it<Gt;)Dt=xt.charCodeAt(it++),Dt>=55296&&Dt<=56319&&it<Gt?(Mt=xt.charCodeAt(it++),(Mt&64512)==56320?tt.push(((Dt&1023)<<10)+(Mt&1023)+65536):(tt.push(Dt),it--)):tt.push(Dt);return tt}function X(xt){return J(xt,function(tt){var it="";return tt>65535&&(tt-=65536,it+=Y(tt>>>10&1023|55296),tt=56320|tt&1023),it+=Y(tt),it}).join("")}function Q(xt){return xt-48<10?xt-22:xt-65<26?xt-65:xt-97<26?xt-97:u}function S(xt,tt){return xt+22+75*(xt<26)-((tt!=0)<<5)}function ut(xt,tt,it){var Gt=0;for(xt=it?H(xt/f):xt>>1,xt+=H(xt/tt);xt>R*m>>1;Gt+=u)xt=H(xt/R);return H(Gt+(R+1)*xt/(xt+l))}function Pt(xt){var tt=[],it=xt.length,Gt,Dt=0,Mt=y,te=p,re,jt,qt,ce,ne,_e,pe,C,At;for(re=xt.lastIndexOf(v),re<0&&(re=0),jt=0;jt<re;++jt)xt.charCodeAt(jt)>=128&&et("not-basic"),tt.push(xt.charCodeAt(jt));for(qt=re>0?re+1:0;qt<it;){for(ce=Dt,ne=1,_e=u;qt>=it&&et("invalid-input"),pe=Q(xt.charCodeAt(qt++)),(pe>=u||pe>H((o-Dt)/ne))&&et("overflow"),Dt+=pe*ne,C=_e<=te?d:_e>=te+m?m:_e-te,!(pe<C);_e+=u)At=u-C,ne>H(o/At)&&et("overflow"),ne*=At;Gt=tt.length+1,te=ut(Dt-ce,Gt,ce==0),H(Dt/Gt)>o-Mt&&et("overflow"),Mt+=H(Dt/Gt),Dt%=Gt,tt.splice(Dt++,0,Mt)}return X(tt)}function pt(xt){var tt,it,Gt,Dt,Mt,te,re,jt,qt,ce,ne,_e=[],pe,C,At,vt;for(xt=gt(xt),pe=xt.length,tt=y,it=0,Mt=p,te=0;te<pe;++te)ne=xt[te],ne<128&&_e.push(Y(ne));for(Gt=Dt=_e.length,Dt&&_e.push(v);Gt<pe;){for(re=o,te=0;te<pe;++te)ne=xt[te],ne>=tt&&ne<re&&(re=ne);for(C=Gt+1,re-tt>H((o-it)/C)&&et("overflow"),it+=(re-tt)*C,tt=re,te=0;te<pe;++te)if(ne=xt[te],ne<tt&&++it>o&&et("overflow"),ne==tt){for(jt=it,qt=u;ce=qt<=Mt?d:qt>=Mt+m?m:qt-Mt,!(jt<ce);qt+=u)vt=jt-ce,At=u-ce,_e.push(Y(S(ce+vt%At,0))),jt=H(vt/At);_e.push(Y(S(jt,0))),Mt=ut(it,C,Gt==Dt),it=0,++Gt}++it,++tt}return _e.join("")}function Wt(xt){return rt(xt,function(tt){return _.test(tt)?Pt(tt.slice(4).toLowerCase()):tt})}function bt(xt){return rt(xt,function(tt){return w.test(tt)?"xn--"+pt(tt):tt})}if(a={version:"1.3.2",ucs2:{decode:gt,encode:X},decode:Pt,encode:pt,toASCII:bt,toUnicode:Wt},r&&n)if(i.exports==r)n.exports=a;else for(j in a)a.hasOwnProperty(j)&&(r[j]=a[j]);else e.punycode=a})(hi)})(Wd,Wd.exports);var SE={isString:function(i){return typeof i=="string"},isObject:function(i){return typeof i=="object"&&i!==null},isNull:function(i){return i===null},isNullOrUndefined:function(i){return i==null}},Th={};function CE(i,t){return Object.prototype.hasOwnProperty.call(i,t)}var ME=function(i,t,e,r){t=t||"&",e=e||"=";var n={};if(typeof i!="string"||i.length===0)return n;var s=/\+/g;i=i.split(t);var a=1e3;r&&typeof r.maxKeys=="number"&&(a=r.maxKeys);var o=i.length;a>0&&o>a&&(o=a);for(var u=0;u<o;++u){var d=i[u].replace(s,"%20"),m=d.indexOf(e),l,f,p,y;m>=0?(l=d.substr(0,m),f=d.substr(m+1)):(l=d,f=""),p=decodeURIComponent(l),y=decodeURIComponent(f),CE(n,p)?Array.isArray(n[p])?n[p].push(y):n[p]=[n[p],y]:n[p]=y}return n},lh=function(i){switch(typeof i){case"string":return i;case"boolean":return i?"true":"false";case"number":return isFinite(i)?i:"";default:return""}},IE=function(i,t,e,r){return t=t||"&",e=e||"=",i===null&&(i=void 0),typeof i=="object"?Object.keys(i).map(function(n){var s=encodeURIComponent(lh(n))+e;return Array.isArray(i[n])?i[n].map(function(a){return s+encodeURIComponent(lh(a))}).join(t):s+encodeURIComponent(lh(i[n]))}).join(t):r?encodeURIComponent(lh(r))+e+encodeURIComponent(lh(i)):""};Th.decode=Th.parse=ME;Th.encode=Th.stringify=IE;var BE=Wd.exports,gn=SE,kE=Dc,RE=zE,PE=WE;function rn(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var DE=/^([a-z0-9.+-]+:)/i,LE=/:[0-9]*$/,OE=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,FE=["<",">",'"',"`"," ","\r",`
`,"	"],NE=["{","}","|","\\","^","`"].concat(FE),zd=["'"].concat(NE),rg=["%","/","?",";","#"].concat(zd),ng=["/","?","#"],UE=255,sg=/^[+a-z0-9A-Z_-]{0,63}$/,HE=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,GE={javascript:!0,"javascript:":!0},Vd={javascript:!0,"javascript:":!0},go={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Xd=Th;function Dc(i,t,e){if(i&&gn.isObject(i)&&i instanceof rn)return i;var r=new rn;return r.parse(i,t,e),r}rn.prototype.parse=function(i,t,e){if(!gn.isString(i))throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),n=r!==-1&&r<i.indexOf("#")?"?":"#",s=i.split(n),a=/\\/g;s[0]=s[0].replace(a,"/"),i=s.join(n);var o=i;if(o=o.trim(),!e&&i.split("#").length===1){var u=OE.exec(o);if(u)return this.path=o,this.href=o,this.pathname=u[1],u[2]?(this.search=u[2],t?this.query=Xd.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var d=DE.exec(o);if(d){d=d[0];var m=d.toLowerCase();this.protocol=m,o=o.substr(d.length)}if(e||d||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var l=o.substr(0,2)==="//";l&&!(d&&Vd[d])&&(o=o.substr(2),this.slashes=!0)}if(!Vd[d]&&(l||d&&!go[d])){for(var f=-1,p=0;p<ng.length;p++){var y=o.indexOf(ng[p]);y!==-1&&(f===-1||y<f)&&(f=y)}var v,_;f===-1?_=o.lastIndexOf("@"):_=o.lastIndexOf("@",f),_!==-1&&(v=o.slice(0,_),o=o.slice(_+1),this.auth=decodeURIComponent(v)),f=-1;for(var p=0;p<rg.length;p++){var y=o.indexOf(rg[p]);y!==-1&&(f===-1||y<f)&&(f=y)}f===-1&&(f=o.length),this.host=o.slice(0,f),o=o.slice(f),this.parseHost(),this.hostname=this.hostname||"";var w=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!w)for(var T=this.hostname.split(/\./),p=0,E=T.length;p<E;p++){var R=T[p];if(!!R&&!R.match(sg)){for(var H="",Y=0,j=R.length;Y<j;Y++)R.charCodeAt(Y)>127?H+="x":H+=R[Y];if(!H.match(sg)){var et=T.slice(0,p),J=T.slice(p+1),rt=R.match(HE);rt&&(et.push(rt[1]),J.unshift(rt[2])),J.length&&(o="/"+J.join(".")+o),this.hostname=et.join(".");break}}}this.hostname.length>UE?this.hostname="":this.hostname=this.hostname.toLowerCase(),w||(this.hostname=BE.toASCII(this.hostname));var gt=this.port?":"+this.port:"",X=this.hostname||"";this.host=X+gt,this.href+=this.host,w&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),o[0]!=="/"&&(o="/"+o))}if(!GE[m])for(var p=0,E=zd.length;p<E;p++){var Q=zd[p];if(o.indexOf(Q)!==-1){var S=encodeURIComponent(Q);S===Q&&(S=escape(Q)),o=o.split(Q).join(S)}}var ut=o.indexOf("#");ut!==-1&&(this.hash=o.substr(ut),o=o.slice(0,ut));var Pt=o.indexOf("?");if(Pt!==-1?(this.search=o.substr(Pt),this.query=o.substr(Pt+1),t&&(this.query=Xd.parse(this.query)),o=o.slice(0,Pt)):t&&(this.search="",this.query={}),o&&(this.pathname=o),go[m]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var gt=this.pathname||"",pt=this.search||"";this.path=gt+pt}return this.href=this.format(),this};function WE(i){return gn.isString(i)&&(i=Dc(i)),i instanceof rn?i.format():rn.prototype.format.call(i)}rn.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",r=this.hash||"",n=!1,s="";this.host?n=i+this.host:this.hostname&&(n=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&gn.isObject(this.query)&&Object.keys(this.query).length&&(s=Xd.stringify(this.query));var a=this.search||s&&"?"+s||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||go[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),r&&r.charAt(0)!=="#"&&(r="#"+r),a&&a.charAt(0)!=="?"&&(a="?"+a),e=e.replace(/[?#]/g,function(o){return encodeURIComponent(o)}),a=a.replace("#","%23"),t+n+e+a+r};function zE(i,t){return Dc(i,!1,!0).resolve(t)}rn.prototype.resolve=function(i){return this.resolveObject(Dc(i,!1,!0)).format()};rn.prototype.resolveObject=function(i){if(gn.isString(i)){var t=new rn;t.parse(i,!1,!0),i=t}for(var e=new rn,r=Object.keys(this),n=0;n<r.length;n++){var s=r[n];e[s]=this[s]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var a=Object.keys(i),o=0;o<a.length;o++){var u=a[o];u!=="protocol"&&(e[u]=i[u])}return go[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!go[i.protocol]){for(var d=Object.keys(i),m=0;m<d.length;m++){var l=d[m];e[l]=i[l]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!Vd[i.protocol]){for(var E=(i.pathname||"").split("/");E.length&&!(i.host=E.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),E[0]!==""&&E.unshift(""),E.length<2&&E.unshift(""),e.pathname=E.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var f=e.pathname||"",p=e.search||"";e.path=f+p}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var y=e.pathname&&e.pathname.charAt(0)==="/",v=i.host||i.pathname&&i.pathname.charAt(0)==="/",_=v||y||e.host&&i.pathname,w=_,T=e.pathname&&e.pathname.split("/")||[],E=i.pathname&&i.pathname.split("/")||[],R=e.protocol&&!go[e.protocol];if(R&&(e.hostname="",e.port=null,e.host&&(T[0]===""?T[0]=e.host:T.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(E[0]===""?E[0]=i.host:E.unshift(i.host)),i.host=null),_=_&&(E[0]===""||T[0]==="")),v)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,T=E;else if(E.length)T||(T=[]),T.pop(),T=T.concat(E),e.search=i.search,e.query=i.query;else if(!gn.isNullOrUndefined(i.search)){if(R){e.hostname=e.host=T.shift();var H=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;H&&(e.auth=H.shift(),e.host=e.hostname=H.shift())}return e.search=i.search,e.query=i.query,(!gn.isNull(e.pathname)||!gn.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!T.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var Y=T.slice(-1)[0],j=(e.host||i.host||T.length>1)&&(Y==="."||Y==="..")||Y==="",et=0,J=T.length;J>=0;J--)Y=T[J],Y==="."?T.splice(J,1):Y===".."?(T.splice(J,1),et++):et&&(T.splice(J,1),et--);if(!_&&!w)for(;et--;et)T.unshift("..");_&&T[0]!==""&&(!T[0]||T[0].charAt(0)!=="/")&&T.unshift(""),j&&T.join("/").substr(-1)!=="/"&&T.push("");var rt=T[0]===""||T[0]&&T[0].charAt(0)==="/";if(R){e.hostname=e.host=rt?"":T.length?T.shift():"";var H=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;H&&(e.auth=H.shift(),e.host=e.hostname=H.shift())}return _=_||e.host&&T.length,_&&!rt&&T.unshift(""),T.length?e.pathname=T.join("/"):(e.pathname=null,e.path=null),(!gn.isNull(e.pathname)||!gn.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};rn.prototype.parseHost=function(){var i=this.host,t=LE.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};const VE={parse:kE,format:PE,resolve:RE};function qr(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function ag(i){return i.split("?")[0].split("#")[0]}function XE(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function jE(i,t,e){return i.replace(new RegExp(XE(t),"g"),e)}function YE(i,t){let e="",r=0,n=-1,s=0,a;for(let o=0;o<=i.length;++o){if(o<i.length)a=i.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(n===o-1||s===1))if(n!==o-1&&s===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const u=e.lastIndexOf("/");if(u!==e.length-1){u===-1?(e="",r=0):(e=e.slice(0,u),r=e.length-1-e.lastIndexOf("/")),n=o,s=0;continue}}else if(e.length===2||e.length===1){e="",r=0,n=o,s=0;continue}}t&&(e.length>0?e+="/..":e="..",r=2)}else e.length>0?e+=`/${i.slice(n+1,o)}`:e=i.slice(n+1,o),r=o-n-1;n=o,s=0}else a===46&&s!==-1?++s:s=-1}return e}const qi={toPosix(i){return jE(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},hasProtocol(i){return/^[^/:]+:\//.test(this.toPosix(i))},getProtocol(i){qr(i),i=this.toPosix(i);let t="";const e=/^file:\/\/\//.exec(i),r=/^[^/:]+:\/\//.exec(i),n=/^[^/:]+:\//.exec(i);if(e||r||n){const s=e?.[0]||r?.[0]||n?.[0];t=s,i=i.slice(s.length)}return t},toAbsolute(i,t,e){if(this.isDataUrl(i))return i;const r=ag(this.toPosix(t??Xt.ADAPTER.getBaseUrl())),n=ag(this.toPosix(e??this.rootname(r)));return qr(i),i=this.toPosix(i),i.startsWith("/")?qi.join(n,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(i=this.toPosix(i),qr(i),i.length===0)return".";let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const r=i.endsWith("/");return i=YE(i,!1),i.length>0&&r&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return qr(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){const r=i[e];if(qr(r),r.length>0)if(t===void 0)t=r;else{const n=i[e-1]??"";this.extname(n)?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(qr(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let r=-1,n=!0;const s=this.getProtocol(i),a=i;i=i.slice(s.length);for(let o=i.length-1;o>=1;--o)if(t=i.charCodeAt(o),t===47){if(!n){r=o;break}}else n=!1;return r===-1?e?"/":this.isUrl(a)?s+i:s:e&&r===1?"//":s+i.slice(0,r)},rootname(i){qr(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){qr(i),t&&qr(t),i=this.toPosix(i);let e=0,r=-1,n=!0,s;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let a=t.length-1,o=-1;for(s=i.length-1;s>=0;--s){const u=i.charCodeAt(s);if(u===47){if(!n){e=s+1;break}}else o===-1&&(n=!1,o=s+1),a>=0&&(u===t.charCodeAt(a)?--a===-1&&(r=s):(a=-1,r=o))}return e===r?r=o:r===-1&&(r=i.length),i.slice(e,r)}for(s=i.length-1;s>=0;--s)if(i.charCodeAt(s)===47){if(!n){e=s+1;break}}else r===-1&&(n=!1,r=s+1);return r===-1?"":i.slice(e,r)},extname(i){qr(i),i=this.toPosix(i);let t=-1,e=0,r=-1,n=!0,s=0;for(let a=i.length-1;a>=0;--a){const o=i.charCodeAt(a);if(o===47){if(!n){e=a+1;break}continue}r===-1&&(n=!1,r=a+1),o===46?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||r===-1||s===0||s===1&&t===r-1&&t===e+1?"":i.slice(t,r)},parse(i){qr(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=this.toPosix(i);let e=i.charCodeAt(0);const r=this.isAbsolute(i);let n;t.root=this.rootname(i),r||this.hasProtocol(i)?n=1:n=0;let s=-1,a=0,o=-1,u=!0,d=i.length-1,m=0;for(;d>=n;--d){if(e=i.charCodeAt(d),e===47){if(!u){a=d+1;break}continue}o===-1&&(u=!1,o=d+1),e===46?s===-1?s=d:m!==1&&(m=1):s!==-1&&(m=-1)}return s===-1||o===-1||m===0||m===1&&s===o-1&&s===a+1?o!==-1&&(a===0&&r?t.base=t.name=i.slice(1,o):t.base=t.name=i.slice(a,o)):(a===0&&r?(t.name=i.slice(1,s),t.base=i.slice(1,o)):(t.name=i.slice(a,s),t.base=i.slice(a,o)),t.ext=i.slice(s,o)),t.dir=this.dirname(i),t},sep:"/",delimiter:":"};Xt.RETINA_PREFIX=/@([0-9\.]+)x/;Xt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;let nd;function KE(){return typeof nd>"u"&&(nd=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:Xt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Xt.ADAPTER.getWebGLRenderingContext())return!1;const e=Xt.ADAPTER.createCanvas();let r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const n=!!(r&&r.getContextAttributes().stencil);if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,n}catch{return!1}}()),nd}var qE="#f0f8ff",$E="#faebd7",ZE="#00ffff",QE="#7fffd4",JE="#f0ffff",tT="#f5f5dc",eT="#ffe4c4",iT="#000000",rT="#ffebcd",nT="#0000ff",sT="#8a2be2",aT="#a52a2a",oT="#deb887",hT="#5f9ea0",lT="#7fff00",cT="#d2691e",uT="#ff7f50",dT="#6495ed",fT="#fff8dc",pT="#dc143c",mT="#00ffff",gT="#00008b",yT="#008b8b",vT="#b8860b",_T="#a9a9a9",wT="#006400",bT="#a9a9a9",xT="#bdb76b",AT="#8b008b",ET="#556b2f",TT="#ff8c00",ST="#9932cc",CT="#8b0000",MT="#e9967a",IT="#8fbc8f",BT="#483d8b",kT="#2f4f4f",RT="#2f4f4f",PT="#00ced1",DT="#9400d3",LT="#ff1493",OT="#00bfff",FT="#696969",NT="#696969",UT="#1e90ff",HT="#b22222",GT="#fffaf0",WT="#228b22",zT="#ff00ff",VT="#dcdcdc",XT="#f8f8ff",jT="#daa520",YT="#ffd700",KT="#808080",qT="#008000",$T="#adff2f",ZT="#808080",QT="#f0fff0",JT="#ff69b4",tS="#cd5c5c",eS="#4b0082",iS="#fffff0",rS="#f0e68c",nS="#fff0f5",sS="#e6e6fa",aS="#7cfc00",oS="#fffacd",hS="#add8e6",lS="#f08080",cS="#e0ffff",uS="#fafad2",dS="#d3d3d3",fS="#90ee90",pS="#d3d3d3",mS="#ffb6c1",gS="#ffa07a",yS="#20b2aa",vS="#87cefa",_S="#778899",wS="#778899",bS="#b0c4de",xS="#ffffe0",AS="#00ff00",ES="#32cd32",TS="#faf0e6",SS="#ff00ff",CS="#800000",MS="#66cdaa",IS="#0000cd",BS="#ba55d3",kS="#9370db",RS="#3cb371",PS="#7b68ee",DS="#00fa9a",LS="#48d1cc",OS="#c71585",FS="#191970",NS="#f5fffa",US="#ffe4e1",HS="#ffe4b5",GS="#ffdead",WS="#000080",zS="#fdf5e6",VS="#808000",XS="#6b8e23",jS="#ffa500",YS="#ff4500",KS="#da70d6",qS="#eee8aa",$S="#98fb98",ZS="#afeeee",QS="#db7093",JS="#ffefd5",tC="#ffdab9",eC="#cd853f",iC="#ffc0cb",rC="#dda0dd",nC="#b0e0e6",sC="#800080",aC="#663399",oC="#ff0000",hC="#bc8f8f",lC="#4169e1",cC="#8b4513",uC="#fa8072",dC="#f4a460",fC="#2e8b57",pC="#fff5ee",mC="#a0522d",gC="#c0c0c0",yC="#87ceeb",vC="#6a5acd",_C="#708090",wC="#708090",bC="#fffafa",xC="#00ff7f",AC="#4682b4",EC="#d2b48c",TC="#008080",SC="#d8bfd8",CC="#ff6347",MC="#40e0d0",IC="#ee82ee",BC="#f5deb3",kC="#ffffff",RC="#f5f5f5",PC="#ffff00",DC="#9acd32",LC={aliceblue:qE,antiquewhite:$E,aqua:ZE,aquamarine:QE,azure:JE,beige:tT,bisque:eT,black:iT,blanchedalmond:rT,blue:nT,blueviolet:sT,brown:aT,burlywood:oT,cadetblue:hT,chartreuse:lT,chocolate:cT,coral:uT,cornflowerblue:dT,cornsilk:fT,crimson:pT,cyan:mT,darkblue:gT,darkcyan:yT,darkgoldenrod:vT,darkgray:_T,darkgreen:wT,darkgrey:bT,darkkhaki:xT,darkmagenta:AT,darkolivegreen:ET,darkorange:TT,darkorchid:ST,darkred:CT,darksalmon:MT,darkseagreen:IT,darkslateblue:BT,darkslategray:kT,darkslategrey:RT,darkturquoise:PT,darkviolet:DT,deeppink:LT,deepskyblue:OT,dimgray:FT,dimgrey:NT,dodgerblue:UT,firebrick:HT,floralwhite:GT,forestgreen:WT,fuchsia:zT,gainsboro:VT,ghostwhite:XT,goldenrod:jT,gold:YT,gray:KT,green:qT,greenyellow:$T,grey:ZT,honeydew:QT,hotpink:JT,indianred:tS,indigo:eS,ivory:iS,khaki:rS,lavenderblush:nS,lavender:sS,lawngreen:aS,lemonchiffon:oS,lightblue:hS,lightcoral:lS,lightcyan:cS,lightgoldenrodyellow:uS,lightgray:dS,lightgreen:fS,lightgrey:pS,lightpink:mS,lightsalmon:gS,lightseagreen:yS,lightskyblue:vS,lightslategray:_S,lightslategrey:wS,lightsteelblue:bS,lightyellow:xS,lime:AS,limegreen:ES,linen:TS,magenta:SS,maroon:CS,mediumaquamarine:MS,mediumblue:IS,mediumorchid:BS,mediumpurple:kS,mediumseagreen:RS,mediumslateblue:PS,mediumspringgreen:DS,mediumturquoise:LS,mediumvioletred:OS,midnightblue:FS,mintcream:NS,mistyrose:US,moccasin:HS,navajowhite:GS,navy:WS,oldlace:zS,olive:VS,olivedrab:XS,orange:jS,orangered:YS,orchid:KS,palegoldenrod:qS,palegreen:$S,paleturquoise:ZS,palevioletred:QS,papayawhip:JS,peachpuff:tC,peru:eC,pink:iC,plum:rC,powderblue:nC,purple:sC,rebeccapurple:aC,red:oC,rosybrown:hC,royalblue:lC,saddlebrown:cC,salmon:uC,sandybrown:dC,seagreen:fC,seashell:pC,sienna:mC,silver:gC,skyblue:yC,slateblue:vC,slategray:_C,slategrey:wC,snow:bC,springgreen:xC,steelblue:AC,tan:EC,teal:TC,thistle:SC,tomato:CC,turquoise:MC,violet:IC,wheat:BC,white:kC,whitesmoke:RC,yellow:PC,yellowgreen:DC};function bo(i,t=[]){return t[0]=(i>>16&255)/255,t[1]=(i>>8&255)/255,t[2]=(i&255)/255,t}function M0(i){let t=i.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function yf(i){if(typeof i=="string"&&(i=LC[i.toLowerCase()]||i,i[0]==="#"&&(i=i.slice(1)),i.length===3)){const[t,e,r]=i;i=t+t+e+e+r+r}return parseInt(i,16)}function OC(){const i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[ue.NORMAL_NPM]=ue.NORMAL,i[ue.ADD_NPM]=ue.ADD,i[ue.SCREEN_NPM]=ue.SCREEN,t[ue.NORMAL]=ue.NORMAL_NPM,t[ue.ADD]=ue.ADD_NPM,t[ue.SCREEN]=ue.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const I0=OC();function B0(i,t){return I0[t?1:0][i]}function FC(i,t,e,r){return e=e||new Float32Array(4),r||r===void 0?(e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t):(e[0]=i[0],e[1]=i[1],e[2]=i[2]),e[3]=t,e}function vf(i,t){if(t===1)return(t*255<<24)+i;if(t===0)return 0;let e=i>>16&255,r=i>>8&255,n=i&255;return e=e*t+.5|0,r=r*t+.5|0,n=n*t+.5|0,(t*255<<24)+(e<<16)+(r<<8)+n}function k0(i,t,e,r){return e=e||new Float32Array(4),e[0]=(i>>16&255)/255,e[1]=(i>>8&255)/255,e[2]=(i&255)/255,(r||r===void 0)&&(e[0]*=t,e[1]*=t,e[2]*=t),e[3]=t,e}function NC(i,t=null){const e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let r=0,n=0;r<e;r+=6,n+=4)t[r+0]=n+0,t[r+1]=n+1,t[r+2]=n+2,t[r+3]=n+0,t[r+4]=n+2,t[r+5]=n+3;return t}function R0(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function fc(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function og(i){return!(i&i-1)&&!!i}function hg(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function yo(i,t,e){const r=i.length;let n;if(t>=r||e===0)return;e=t+e>r?r-t:e;const s=r-e;for(n=t;n<s;++n)i[n]=i[n+e];i.length=s}function so(i){return i===0?0:i<0?-1:1}let UC=0;function ga(){return++UC}const lg={},Vn=Object.create(null),Zs=Object.create(null);class cg{constructor(t,e,r){this.canvas=Xt.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=r||Xt.RESOLUTION,this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)}destroy(){this.context=null,this.canvas=null}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}function HC(i){let t=i.width,e=i.height;const r=i.getContext("2d",{willReadFrequently:!0}),s=r.getImageData(0,0,t,e).data,a=s.length,o={top:null,left:null,right:null,bottom:null};let u=null,d,m,l;for(d=0;d<a;d+=4)s[d+3]!==0&&(m=d/4%t,l=~~(d/4/t),o.top===null&&(o.top=l),(o.left===null||m<o.left)&&(o.left=m),(o.right===null||o.right<m)&&(o.right=m+1),(o.bottom===null||o.bottom<l)&&(o.bottom=l));return o.top!==null&&(t=o.right-o.left,e=o.bottom-o.top+1,u=r.getImageData(o.left,o.top,t,e)),{height:e,width:t,data:u}}let Bl;function GC(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location,Bl||(Bl=document.createElement("a")),Bl.href=i;const e=VE.parse(Bl.href),r=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!r||e.protocol!==t.protocol?"anonymous":""}function Rs(i,t=1){const e=Xt.RETINA_PREFIX.exec(i);return e?parseFloat(e[1]):t}const jd=[];function P0(i,t){if(!i)return null;let e="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=jd.length-1;r>=0;--r){const n=jd[r];if(n.test&&n.test(i,e))return new n(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Sh{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new en("setRealSize"),this.onUpdate=new en("update"),this.onError=new en("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class kh extends Sh{constructor(t,e){const{width:r,height:n}=e||{};if(!r||!n)throw new Error("BufferResource width or height invalid");super(r,n),this.data=t}upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===an.UNPACK);const s=e.realWidth,a=e.realHeight;return r.width===s&&r.height===a?n.texSubImage2D(e.target,0,0,0,s,a,e.format,r.type,this.data):(r.width=s,r.height=a,n.texImage2D(e.target,0,r.internalFormat,s,a,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const WC={scaleMode:Kn.NEAREST,format:Yt.RGBA,alphaMode:an.NPM},yh=class extends Io{constructor(i=null,t=null){super(),t=t||{};const{alphaMode:e,mipmap:r,anisotropicLevel:n,scaleMode:s,width:a,height:o,wrapMode:u,format:d,type:m,target:l,resolution:f,resourceOptions:p}=t;i&&!(i instanceof Sh)&&(i=P0(i,p),i.internal=!0),this.resolution=f||Xt.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((o||0)*this.resolution)/this.resolution,this._mipmap=r??Xt.MIPMAP_TEXTURES,this.anisotropicLevel=n??Xt.ANISOTROPIC_LEVEL,this._wrapMode=u||Xt.WRAP_MODE,this._scaleMode=s??Xt.SCALE_MODE,this.format=d||Yt.RGBA,this.type=m||de.UNSIGNED_BYTE,this.target=l||po.TEXTURE_2D,this.alphaMode=e??an.UNPACK,this.uid=ga(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&o>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(i)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(i){this._mipmap!==i&&(this._mipmap=i,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(i){this._scaleMode!==i&&(this._scaleMode=i,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(i){this._wrapMode!==i&&(this._wrapMode=i,this.dirtyStyleId++)}setStyle(i,t){let e;return i!==void 0&&i!==this.scaleMode&&(this.scaleMode=i,e=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,e=!0),e&&this.dirtyStyleId++,this}setSize(i,t,e){return e=e||this.resolution,this.setRealSize(i*e,t*e,e)}setRealSize(i,t,e){return this.resolution=e||this.resolution,this.width=Math.round(i)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=og(this.realWidth)&&og(this.realHeight)}setResolution(i){const t=this.resolution;return t===i?this:(this.resolution=i,this.valid&&(this.width=Math.round(this.width*t)/i,this.height=Math.round(this.height*t)/i,this.emit("update",this)),this._refreshPOT(),this)}setResource(i){if(this.resource===i)return this;if(this.resource)throw new Error("Resource can be set only once");return i.bind(this),this.resource=i,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(i){this.emit("error",this,i)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Zs[this.cacheId],delete Vn[this.cacheId],this.cacheId=null),this.dispose(),yh.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(i,t,e=Xt.STRICT_TEXTURE_CACHE){const r=typeof i=="string";let n=null;if(r)n=i;else{if(!i._pixiId){const a=t?.pixiIdPrefix||"pixiid";i._pixiId=`${a}_${ga()}`}n=i._pixiId}let s=Zs[n];if(r&&e&&!s)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return s||(s=new yh(i,t),s.cacheId=n,yh.addToCache(s,n)),s}static fromBuffer(i,t,e,r){i=i||new Float32Array(t*e*4);const n=new kh(i,{width:t,height:e}),s=i instanceof Float32Array?de.FLOAT:de.UNSIGNED_BYTE;return new yh(n,Object.assign({},WC,r||{width:t,height:e,type:s}))}static addToCache(i,t){t&&(i.textureCacheIds.includes(t)||i.textureCacheIds.push(t),Zs[t]&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Zs[t]=i)}static removeFromCache(i){if(typeof i=="string"){const t=Zs[i];if(t){const e=t.textureCacheIds.indexOf(i);return e>-1&&t.textureCacheIds.splice(e,1),delete Zs[i],t}}else if(i?.textureCacheIds){for(let t=0;t<i.textureCacheIds.length;++t)delete Zs[i.textureCacheIds[t]];return i.textureCacheIds.length=0,i}return null}};let Pe=yh;Pe._globalBatch=0;class D0 extends Sh{constructor(t,e){const{width:r,height:n}=e||{};super(r,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<t;s++){const a=new Pe;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)!t[r]||(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Sh?this.addResourceAt(t[r],r):this.addResourceAt(P0(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const e=this.items.map(r=>r.resource).filter(r=>r).map(r=>r.load());return this._load=Promise.all(e).then(()=>{const{realWidth:r,realHeight:n}=this.items[0];return this.resize(r,n),Promise.resolve(this)}),this._load}}class zC extends D0{constructor(t,e){const{width:r,height:n}=e||{};let s,a;Array.isArray(t)?(s=t,a=t.length):a=t,super(a,{width:r,height:n}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=po.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:n,itemDirtyIds:s,items:a}=this,{gl:o}=t;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,n,0,e.format,r.type,null);for(let u=0;u<n;u++){const d=a[u];s[u]<d.dirtyId&&(s[u]=d.dirtyId,d.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,u,d.resource.width,d.resource.height,1,e.format,r.type,d.resource.source))}return!0}}class Ps extends Sh{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;super(r,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=GC(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,n){const s=t.gl,a=e.realWidth,o=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1&&n.buffered.length===0)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===an.UNPACK),!this.noSubImage&&e.target===s.TEXTURE_2D&&r.width===a&&r.height===o?s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,r.type,n):(r.width=a,r.height=o,s.texImage2D(e.target,0,r.internalFormat,e.format,r.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class VC extends Ps{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const vh=class extends D0{constructor(i,t){const{width:e,height:r,autoLoad:n,linkBaseTexture:s}=t||{};if(i&&i.length!==vh.SIDES)throw new Error(`Invalid length. Got ${i.length}, expected 6`);super(6,{width:e,height:r});for(let a=0;a<vh.SIDES;a++)this.items[a].target=po.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=s!==!1,i&&this.initFromArray(i,t),n!==!1&&this.load()}bind(i){super.bind(i),i.target=po.TEXTURE_CUBE_MAP}addBaseTextureAt(i,t,e){if(e===void 0&&(e=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||i.parentTextureArray||Object.keys(i._glTextures).length>0)if(i.resource)this.addResourceAt(i.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else i.target=po.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.parentTextureArray=this.baseTexture,this.items[t]=i;return i.valid&&!this.valid&&this.resize(i.realWidth,i.realHeight),this.items[t]=i,this}upload(i,t,e){const r=this.itemDirtyIds;for(let n=0;n<vh.SIDES;n++){const s=this.items[n];(r[n]<s.dirtyId||e.dirtyId<t.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(i,s,e),r[n]=s.dirtyId):r[n]<-1&&(i.gl.texImage2D(s.target,0,e.internalFormat,t.realWidth,t.realHeight,0,t.format,e.type,null),r[n]=-1))}return!0}static test(i){return Array.isArray(i)&&i.length===vh.SIDES}};let L0=vh;L0.SIDES=6;class O0 extends Ps{constructor(t,e){if(e=e||{},typeof t=="string"){const r=new Image;Ps.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&!!this._width&&!!this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??Xt.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=a=>{r(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===an.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let n=!0;const s=e._glTextures;for(const a in s){const o=s[a];if(o!==r&&o.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}const sc=class extends Ps{constructor(i,t){t=t||{},super(Xt.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=i,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(i=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),i(this)},sc.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const i=new Image;Ps.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=t=>{!this._resolve||(i.onerror=null,this.onError.emit(t))},i.onload=()=>{if(!this._resolve)return;const t=i.width,e=i.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=t*this.scale,n=e*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/e*t,n=this._overrideHeight||this._overrideWidth/t*e),r=Math.round(r),n=Math.round(n);const s=this.source;s.width=r,s.height=n,s._pixiId=`canvas_${ga()}`,s.getContext("2d").drawImage(i,0,0,t,e,0,0,r,n),this._resolve(),this._resolve=null}}static getSize(i){const t=sc.SVG_SIZE.exec(i),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(i,t){return t==="svg"||typeof i=="string"&&i.startsWith("data:image/svg+xml")||typeof i=="string"&&sc.SVG_XML.test(i)}};let Ch=sc;Ch.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Ch.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Yd=class extends Ps{constructor(i,t){if(t=t||{},!(i instanceof HTMLVideoElement)){const e=document.createElement("video");e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),typeof i=="string"&&(i=[i]);const r=i[0].src||i[0];Ps.crossOrigin(e,r,t.crossorigin);for(let n=0;n<i.length;++n){const s=document.createElement("source");let{src:a,mime:o}=i[n];a=a||i[n];const u=a.split("?").shift().toLowerCase(),d=u.slice(u.lastIndexOf(".")+1);o=o||Yd.MIME_TYPES[d]||`video/${d}`,s.src=a,s.type=o,e.appendChild(s)}i=e}super(i),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(i=0){if(!this.destroyed){const t=xi.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,i.load())}),this._load}_onError(i){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(i)}_isSourcePlaying(){const i=this.source;return!i.paused&&!i.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(xi.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(xi.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const i=this.source;i.removeEventListener("canplay",this._onCanPlay),i.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(i.videoWidth,i.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&i.play()}dispose(){this._isConnectedToTicker&&(xi.shared.remove(this.update,this),this._isConnectedToTicker=!1);const i=this.source;i&&(i.removeEventListener("error",this._onError,!0),i.pause(),i.src="",i.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(xi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(xi.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(i){i!==this._updateFPS&&(this._updateFPS=i)}static test(i,t){return globalThis.HTMLVideoElement&&i instanceof HTMLVideoElement||Yd.TYPES.includes(t)}};let _f=Yd;_f.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];_f.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};class ao extends Ps{constructor(t,e){var r=(...n)=>{super(...n)};e=e||{},typeof t=="string"?(r(ao.EMPTY),this.url=t):(r(t),this.url=null),this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await Xt.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await r.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===an.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=s,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return ao._EMPTY=ao._EMPTY??Xt.ADAPTER.createCanvas(0,0),ao._EMPTY}}jd.push(ao,O0,VC,_f,Ch,kh,L0,zC);class XC extends kh{upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===an.UNPACK);const s=e.realWidth,a=e.realHeight;return r.width===s&&r.height===a?n.texSubImage2D(e.target,0,0,0,s,a,e.format,r.type,this.data):(r.width=s,r.height=a,n.texImage2D(e.target,0,r.internalFormat,s,a,0,e.format,r.type,this.data)),!0}}class Kd{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new en("disposeFramebuffer"),this.multisample=Ti.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Pe(null,{scaleMode:Kn.NEAREST,resolution:1,mipmap:xn.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Pe(new XC(null,{width:this.width,height:this.height}),{scaleMode:Kn.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:xn.OFF,format:Yt.DEPTH_COMPONENT,type:de.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const n=this.colorTextures[r],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class F0 extends Pe{constructor(t={}){if(typeof t=="number"){const e=arguments[0],r=arguments[1],n=arguments[2],s=arguments[3];t={width:e,height:r,scaleMode:n,resolution:s}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=Ti.NONE),super(null,t),this.mipmap=xn.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new Kd(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class N0{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const n=e.width,s=e.height;if(r){const a=t.width/2/n,o=t.height/2/s,u=t.x/n+a,d=t.y/s+o;r=ui.add(r,ui.NW),this.x0=u+a*ui.uX(r),this.y0=d+o*ui.uY(r),r=ui.add(r,2),this.x1=u+a*ui.uX(r),this.y1=d+o*ui.uY(r),r=ui.add(r,2),this.x2=u+a*ui.uX(r),this.y2=d+o*ui.uY(r),r=ui.add(r,2),this.x3=u+a*ui.uX(r),this.y3=d+o*ui.uY(r)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}const ug=new N0;function kl(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class Ht extends Io{constructor(t,e,r,n,s,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Te(0,0,1,1)),t instanceof Ht&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this._uvs=ug,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new He(a.x,a.y):new He(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e?.url&&Vn[e.url]&&Ht.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Ht.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new Ht(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===ug&&(this._uvs=new N0),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=Xt.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else if(t instanceof Pe){if(!t.cacheId){const o=e?.pixiIdPrefix||"pixiid";t.cacheId=`${o}-${ga()}`,Pe.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const o=e?.pixiIdPrefix||"pixiid";t._pixiId=`${o}_${ga()}`}s=t._pixiId}let a=Vn[s];if(n&&r&&!a)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!a&&!(t instanceof Pe)?(e.resolution||(e.resolution=Rs(t)),a=new Ht(new Pe(t,e)),a.baseTexture.cacheId=s,Pe.addToCache(a.baseTexture,s),Ht.addToCache(a,s)):!a&&t instanceof Pe&&(a=new Ht(t),Ht.addToCache(a,s)),a}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e?.resourceOptions),n=Ht.from(t,Object.assign({resourceOptions:r},e),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,r,n){return new Ht(Pe.fromBuffer(t,e,r,n))}static fromLoader(t,e,r,n){const s=new Pe(t,Object.assign({scaleMode:Xt.SCALE_MODE,resolution:Rs(e)},n)),{resource:a}=s;a instanceof O0&&(a.url=e);const o=new Ht(s);return r||(r=e),Pe.addToCache(o.baseTexture,r),Ht.addToCache(o,r),r!==e&&(Pe.addToCache(o.baseTexture,e),Ht.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise(u=>{o.baseTexture.once("loaded",()=>u(o))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Vn[e]&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Vn[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Vn[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Vn[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Vn[t.textureCacheIds[e]]===t&&delete Vn[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:n,height:s}=t,a=e+n>this.baseTexture.width,o=r+s>this.baseTexture.height;if(a||o){const u=a&&o?"and":"or",d=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,m=`Y: ${r} + ${s} = ${r+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${d} ${u} ${m}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Ht._EMPTY||(Ht._EMPTY=new Ht(new Pe),kl(Ht._EMPTY),kl(Ht._EMPTY.baseTexture)),Ht._EMPTY}static get WHITE(){if(!Ht._WHITE){const t=Xt.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Ht._WHITE=new Ht(Pe.from(t)),kl(Ht._WHITE),kl(Ht._WHITE.baseTexture)}return Ht._WHITE}}class Di extends Ht{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,a=Math.round(e*n)/n;this.valid=s>0&&a>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=a,r&&this.baseTexture.resize(s,a),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Di(new F0(t))}}class U0{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=Ti.NONE){const n=new F0(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new Di(n)}getOptimalTexture(t,e,r=1,n=Ti.NONE){let s;t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=fc(t),e=fc(e),s=((t&65535)<<16|e&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let a=this.texturePool[s].pop();return a||(a=this.createTexture(t,e,n)),a.filterPoolKey=s,a.setResolution(r),a}getFilterTexture(t,e,r){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||Ti.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}U0.SCREEN_KEY=-1;class pc{constructor(t,e=0,r=!1,n=de.FLOAT,s,a,o){this.buffer=t,this.size=e,this.normalized=r,this.type=n,this.stride=s,this.start=a,this.instance=o}destroy(){this.buffer=null}static from(t,e,r,n,s){return new pc(t,e,r,n,s)}}let jC=0;class Ai{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=jC++,this.disposeRunner=new en("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?bn.ELEMENT_ARRAY_BUFFER:bn.ARRAY_BUFFER}get index(){return this.type===bn.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Ai(t)}}const YC={Float32Array,Uint32Array,Int32Array,Uint8Array};function KC(i,t){let e=0,r=0;const n={};for(let u=0;u<i.length;u++)r+=t[u],e+=i[u].length;const s=new ArrayBuffer(e*4);let a=null,o=0;for(let u=0;u<i.length;u++){const d=t[u],m=i[u],l=R0(m);n[l]||(n[l]=new YC[l](s)),a=n[l];for(let f=0;f<m.length;f++){const p=(f/d|0)*r+o,y=f%d;a[p+y]=m[f]}o+=d}return new Float32Array(s)}const dg={5126:4,5123:2,5121:1};let qC=0;const $C={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class An{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=qC++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new en("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,n=!1,s,a,o,u=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Ai||(e instanceof Array&&(e=new Float32Array(e)),e=new Ai(e));const d=t.split("|");if(d.length>1){for(let l=0;l<d.length;l++)this.addAttribute(d[l],e,r,n,s);return this}let m=this.buffers.indexOf(e);return m===-1&&(this.buffers.push(e),m=this.buffers.length-1),this.attributes[t]=new pc(m,r,n,s,a,o,u),this.instanced=this.instanced||u,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Ai||(t instanceof Array&&(t=new Uint16Array(t)),t=new Ai(t)),t.type=bn.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new Ai;let n;for(n in this.attributes){const s=this.attributes[n],a=this.buffers[s.buffer];t.push(a.data),e.push(s.size*dg[s.type]/4),s.buffer=0}for(r.data=KC(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new An;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Ai(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new pc(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=bn.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new An,r=[],n=[],s=[];let a;for(let o=0;o<t.length;o++){a=t[o];for(let u=0;u<a.buffers.length;u++)n[u]=n[u]||0,n[u]+=a.buffers[u].data.length,s[u]=0}for(let o=0;o<a.buffers.length;o++)r[o]=new $C[R0(a.buffers[o].data)](n[o]),e.buffers[o]=new Ai(r[o]);for(let o=0;o<t.length;o++){a=t[o];for(let u=0;u<a.buffers.length;u++)r[u].set(a.buffers[u].data,s[u]),s[u]+=a.buffers[u].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=bn.ELEMENT_ARRAY_BUFFER;let o=0,u=0,d=0,m=0;for(let l=0;l<a.buffers.length;l++)if(a.buffers[l]!==a.indexBuffer){m=l;break}for(const l in a.attributes){const f=a.attributes[l];(f.buffer|0)===m&&(u+=f.size*dg[f.type]/4)}for(let l=0;l<t.length;l++){const f=t[l].indexBuffer.data;for(let p=0;p<f.length;p++)e.indexBuffer.data[p+d]+=o;o+=t[l].buffers[m].data.length/u,d+=f.length}}return e}}class ZC extends An{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class H0 extends An{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ai(this.vertices),this.uvBuffer=new Ai(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,r=e.x,n=e.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}let QC=0;class nn{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=QC++,this.static=!!e,this.ubo=!!r,t instanceof Ai?(this.buffer=t,this.buffer.type=bn.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Ai(new Float32Array(1)),this.buffer.type=bn.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new nn(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new nn(t,e,r)}static uboFrom(t,e){return new nn(t,e??!0,!0)}}class JC{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Ti.NONE,this.sourceFrame=new Te,this.destinationFrame=new Te,this.bindingSourceFrame=new Te,this.bindingDestinationFrame=new Te,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Rl=[new He,new He,new He,new He],sd=new vi;class G0{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new U0,this.statePool=[],this.quad=new ZC,this.quadUv=new H0,this.tempRect=new Te,this.activeState={},this.globalUniforms=new nn({outputFrame:new Te,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new JC,a=this.renderer.renderTexture;let o=e[0].resolution,u=e[0].multisample,d=e[0].padding,m=e[0].autoFit,l=e[0].legacy??!0;for(let y=1;y<e.length;y++){const v=e[y];o=Math.min(o,v.resolution),u=Math.min(u,v.multisample),d=this.useMaxPadding?Math.max(d,v.padding):d+v.padding,m=m&&v.autoFit,l=l||(v.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),n.push(s),s.resolution=o,s.multisample=u,s.legacy=l,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(d);const f=this.tempRect.copyFrom(a.sourceFrame);r.projection.transform&&this.transformAABB(sd.copyFrom(r.projection.transform).invert(),f),m?(s.sourceFrame.fit(f),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(f)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,a.current?a.current.resolution:r.resolution,a.sourceFrame,a.destinationFrame,r.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,o,u),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const p=this.tempRect;p.x=0,p.y=0,p.width=s.sourceFrame.width,p.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(a.sourceFrame),s.bindingDestinationFrame.copyFrom(a.destinationFrame),s.transform=r.projection.transform,r.projection.transform=null,a.bind(s.renderTexture,s.sourceFrame,p),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const s=n.inputSize,a=n.inputPixel,o=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],a[0]=Math.round(s[0]*e.resolution),a[1]=Math.round(s[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=e.sourceFrame.width*s[2]-.5*a[2],o[3]=e.sourceFrame.height*s[3]-.5*a[3],e.legacy){const d=n.filterArea;d[0]=e.destinationFrame.width,d[1]=e.destinationFrame.height,d[2]=e.sourceFrame.x,d[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const u=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,u.renderTexture,ea.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let d=e.renderTexture,m=this.getOptimalFilterTexture(d.width,d.height,e.resolution);m.filterFrame=d.filterFrame;let l=0;for(l=0;l<r.length-1;++l){l===1&&e.multisample>1&&(m=this.getOptimalFilterTexture(d.width,d.height,e.resolution),m.filterFrame=d.filterFrame),r[l].apply(this,d,m,ea.CLEAR,e);const f=d;d=m,m=f}r[l].apply(this,d,u.renderTexture,ea.BLEND,e),l>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(d),this.returnFilterTexture(m)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=ea.CLEAR){const{renderTexture:r,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,r.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(e===ea.CLEAR||e===ea.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(r,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(vn.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(vn.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:n}=this.activeState,{orig:s}=e._texture,a=t.set(n.width,0,0,n.height,r.x,r.y),o=e.worldTransform.copyTo(vi.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/s.width,1/s.height),a.translate(e.anchor.x,e.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,n=Ti.NONE){return this.texturePool.getOptimalTexture(t,e,r,n)}getFilterTexture(t,e,r){if(typeof t=="number"){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||Ti.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=Rl[0],n=Rl[1],s=Rl[2],a=Rl[3];r.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(r,r),t.apply(n,n),t.apply(s,s),t.apply(a,a);const o=Math.min(r.x,n.x,s.x,a.x),u=Math.min(r.y,n.y,s.y,a.y),d=Math.max(r.x,n.x,s.x,a.x),m=Math.max(r.y,n.y,s.y,a.y);e.x=o,e.y=u,e.width=d-o,e.height=m-u}roundFrame(t,e,r,n,s){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(s){const{a,b:o,c:u,d}=s;if((Math.abs(o)>1e-4||Math.abs(u)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(d)>1e-4))return}s=s?sd.copyFrom(s):sd.identity(),s.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}G0.extension={type:Jt.RendererSystem,name:"filter"};le.add(G0);class Lc{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}class W0{constructor(t){this.renderer=t,this.emptyRenderer=new Lc(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=r[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,r,n){const{elements:s,ids:a,count:o}=t;let u=0;for(let d=0;d<o;d++){const m=s[d],l=m._batchLocation;if(l>=0&&l<n&&e[l]===m){a[d]=l;continue}for(;u<n;){const f=e[u];if(f&&f._batchEnabled===r&&f._batchLocation===u){u++;continue}a[d]=u,m._batchLocation=u,e[u]=m;break}}}destroy(){this.renderer=null}}W0.extension={type:Jt.RendererSystem,name:"batch"};le.add(W0);let fg=0;class z0{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=fg++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha??!0;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=fg++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(Xt.PREFER_ENV>=wa.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault()}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}z0.extension={type:Jt.RendererSystem,name:"context"};le.add(z0);class tM{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Ti.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const eM=new Te;class V0{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Kd(10,10),this.msaaSamples=null}contextChange(){const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Te,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;Xt.PREFER_ENV===wa.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=r),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const o=t.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const a=e.width>>r,o=e.height>>r,u=a/e.width;this.setViewport(e.x*u,e.y*u,a,o)}else{const a=t.width>>r,o=t.height>>r;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,n){const s=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),(s.width!==r||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=r,s.height=n,this.gl.viewport(t,e,r,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,n,s=Od.COLOR|Od.DEPTH){const{gl:a}=this;a.clearColor(t,e,r,n),a.clear(s)}initFramebuffer(t){const{gl:e}=this,r=new tM(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];r.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let s=n.length;e.drawBuffers||(s=Math.min(s,1));for(let a=0;a<s;a++){const o=n[a],u=o.parentTextureArray||o;this.renderer.texture.bind(u,0),a===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let a=s.length;r.drawBuffers||(a=Math.min(a,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer():n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const o=[];for(let u=0;u<a;u++){const d=s[u],m=d.parentTextureArray||d;this.renderer.texture.bind(m,0),u===0&&n.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,m._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+u,d.target,m._glTextures[this.CONTEXT_UID].texture,e),o.push(r.COLOR_ATTACHMENT0+u))}if(o.length>1&&r.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const d=t.depthTexture;this.renderer.texture.bind(d,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,d._glTextures[this.CONTEXT_UID].texture,e)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n.stencil)):n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=Ti.NONE;if(t<=1||e===null)return r;for(let n=0;n<e.length;n++)if(e[n]<=t){r=e[n];break}return r===1&&(r=Ti.NONE),r}blit(t,e,r){const{current:n,renderer:s,gl:a,CONTEXT_UID:o}=this;if(s.context.webGLVersion!==2||!n)return;const u=n.glFramebuffers[o];if(!u)return;if(!t){if(!u.msaaBuffer)return;const m=n.colorTextures[0];if(!m)return;u.blitFramebuffer||(u.blitFramebuffer=new Kd(n.width,n.height),u.blitFramebuffer.addColorTexture(0,m)),t=u.blitFramebuffer,t.colorTextures[0]!==m&&(t.colorTextures[0]=m,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=eM,e.width=n.width,e.height=n.height),r||(r=e);const d=e.width===r.width&&e.height===r.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,u.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,a.COLOR_BUFFER_BIT,d?a.NEAREST:a.LINEAR)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&r.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const r=t.width,n=t.height,s=this.gl,a=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,a),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,s.DEPTH24_STENCIL8,r,n):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,r,n),e.stencil=a,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Te}destroy(){this.renderer=null}}V0.extension={type:Jt.RendererSystem,name:"framebuffer"};le.add(V0);const ad={5126:4,5123:2,5121:1};class X0{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;Xt.PREFER_ENV===wa.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=n=>r.bindVertexArrayOES(n),t.deleteVertexArray=n=>r.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(n,s)=>r.vertexAttribDivisorANGLE(n,s),t.drawElementsInstanced=(n,s,a,o,u)=>r.drawElementsInstancedANGLE(n,s,a,o,u),t.drawArraysInstanced=(n,s,a,o)=>r.drawArraysInstancedANGLE(n,s,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const a=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];e.update(n)}}checkCompatibility(t,e){const r=t.attributes,n=e.attributeData;for(const s in n)if(!r[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(t,e){const r=t.attributes,n=e.attributeData,s=["g",t.id];for(const a in r)n[a]&&s.push(a,n[a].location);return s.join("-")}initGeometryVao(t,e,r=!0){const n=this.gl,s=this.CONTEXT_UID,a=this.renderer.buffer,o=e.program;o.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const u=this.getSignature(t,o),d=t.glVertexArrayObjects[this.CONTEXT_UID];let m=d[u];if(m)return d[o.id]=m,m;const l=t.buffers,f=t.attributes,p={},y={};for(const v in l)p[v]=0,y[v]=0;for(const v in f)!f[v].size&&o.attributeData[v]?f[v].size=o.attributeData[v].size:f[v].size||console.warn(`PIXI Geometry attribute '${v}' size cannot be determined (likely the bound shader does not have the attribute)`),p[f[v].buffer]+=f[v].size*ad[f[v].type];for(const v in f){const _=f[v],w=_.size;_.stride===void 0&&(p[_.buffer]===w*ad[_.type]?_.stride=0:_.stride=p[_.buffer]),_.start===void 0&&(_.start=y[_.buffer],y[_.buffer]+=w*ad[_.type])}m=n.createVertexArray(),n.bindVertexArray(m);for(let v=0;v<l.length;v++){const _=l[v];a.bind(_),r&&_._glBuffers[s].refCount++}return this.activateVao(t,o),d[o.id]=m,d[u]=m,n.bindVertexArray(null),a.unbind(bn.ARRAY_BUFFER),m}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,a=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!r){if(a)for(let o=0;o<s.length;o++){const u=s[o]._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!e&&a.dispose(s[o],e))}if(!e){for(const o in r)if(o[0]==="g"){const u=r[o];this._activeVao===u&&this.unbind(),n.deleteVertexArray(u)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,a=t.buffers,o=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let u=null;for(const d in o){const m=o[d],l=a[m.buffer],f=l._glBuffers[n];if(e.attributeData[d]){u!==f&&(s.bind(l),u=f);const p=e.attributeData[d].location;if(r.enableVertexAttribArray(p),r.vertexAttribPointer(p,m.size,m.type||r.FLOAT,m.normalized,m.stride,m.start),m.instance)if(this.hasInstance)r.vertexAttribDivisor(p,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,n){const{gl:s}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,u=o===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?s.drawElementsInstanced(t,e||a.indexBuffer.data.length,u,(r||0)*o,n||1):s.drawElements(t,e||a.indexBuffer.data.length,u,(r||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?s.drawArraysInstanced(t,r,e||a.getSize(),n||1):s.drawArrays(t,r,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}X0.extension={type:Jt.RendererSystem,name:"geometry"};le.add(X0);class iM{constructor(t=null){this.type=Pi.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Xt.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Pi.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}function pg(i,t,e){const r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function mg(i,t){const e=i.getShaderSource(t).split(`
`).map((d,m)=>`${m}: ${d}`),r=i.getShaderInfoLog(t),n=r.split(`
`),s={},a=n.map(d=>parseFloat(d.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(d=>d&&!s[d]?(s[d]=!0,!0):!1),o=[""];a.forEach(d=>{e[d-1]=`%c${e[d-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const u=e.join(`
`);o[0]=u,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function rM(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||mg(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||mg(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}function od(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function j0(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return od(2*t);case"bvec3":return od(3*t);case"bvec4":return od(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Y0={};let Pl=Y0;function nM(){if(Pl===Y0||Pl?.isContextLost()){const i=Xt.ADAPTER.createCanvas();let t;Xt.PREFER_ENV>=wa.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Pl=t}return Pl}let Dl;function sM(){if(!Dl){Dl=zr.MEDIUM;const i=nM();i&&i.getShaderPrecisionFormat&&(Dl=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision?zr.HIGH:zr.MEDIUM)}return Dl}function gg(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===zr.HIGH&&e!==zr.HIGH&&(r=zr.MEDIUM),`precision ${r} float;
${i}`}else if(e!==zr.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}const aM={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function K0(i){return aM[i]}let Ll=null;const yg={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function q0(i,t){if(!Ll){const e=Object.keys(yg);Ll={};for(let r=0;r<e.length;++r){const n=e[r];Ll[i[n]]=yg[n]}}return Ll[t]}const vo=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],oM={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},hM={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function lM(i,t){const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in i.uniforms){const n=t[r];if(!n){i.uniforms[r]?.group&&(i.uniforms[r].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const s=i.uniforms[r];let a=!1;for(let o=0;o<vo.length;o++)if(vo[o].test(n,s)){e.push(vo[o].code(r,s)),a=!0;break}if(!a){const u=(n.size===1&&!n.isArray?oM:hM)[n.type].replace("location",`ud["${r}"].location`);e.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${u};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const cM=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function uM(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function dM(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=cM.replace(/%forloop%/gi,uM(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}let ch;function fM(){if(typeof ch=="boolean")return ch;try{ch=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{ch=!1}return ch}var pM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,mM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;let gM=0;const Ol={};class $n{constructor(t,e,r="pixi-shader",n={}){this.extra={},this.id=gM++,this.vertexSrc=t||$n.defaultVertexSrc,this.fragmentSrc=e||$n.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Ol[r]?(Ol[r]++,r+=`-${Ol[r]}`):Ol[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=gg(this.vertexSrc,Xt.PRECISION_VERTEX,zr.HIGH),this.fragmentSrc=gg(this.fragmentSrc,Xt.PRECISION_FRAGMENT,sM())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return mM}static get defaultFragmentSrc(){return pM}static from(t,e,r){const n=t+e;let s=lg[n];return s||(lg[n]=s=new $n(t,e,r)),s}}class yr{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof nn?this.uniformGroup=e:this.uniformGroup=new nn(e):this.uniformGroup=new nn({}),this.disposeRunner=new en("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const n=e.uniforms[r];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const n=$n.from(t,e);return new yr(n,r)}}const hd=0,ld=1,cd=2,ud=3,dd=4,fd=5;class rs{constructor(){this.data=0,this.blendMode=ue.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<hd)}set blend(t){!!(this.data&1<<hd)!==t&&(this.data^=1<<hd)}get offsets(){return!!(this.data&1<<ld)}set offsets(t){!!(this.data&1<<ld)!==t&&(this.data^=1<<ld)}get culling(){return!!(this.data&1<<cd)}set culling(t){!!(this.data&1<<cd)!==t&&(this.data^=1<<cd)}get depthTest(){return!!(this.data&1<<ud)}set depthTest(t){!!(this.data&1<<ud)!==t&&(this.data^=1<<ud)}get depthMask(){return!!(this.data&1<<fd)}set depthMask(t){!!(this.data&1<<fd)!==t&&(this.data^=1<<fd)}get clockwiseFrontFace(){return!!(this.data&1<<dd)}set clockwiseFrontFace(t){!!(this.data&1<<dd)!==t&&(this.data^=1<<dd)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==ue.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new rs;return t.depthTest=!1,t.blend=!0,t}}var yM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,vM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;class Mh extends yr{constructor(t,e,r){const n=$n.from(t||Mh.defaultVertexSrc,e||Mh.defaultFragmentSrc);super(n,r),this.padding=0,this.resolution=Xt.FILTER_RESOLUTION,this.multisample=Xt.FILTER_MULTISAMPLE,this.enabled=!0,this.autoFit=!0,this.state=new rs}apply(t,e,r,n,s){t.applyFilter(this,e,r,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return vM}static get defaultFragmentSrc(){return yM}}var _M=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,wM=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;const vg=new vi;class wf{constructor(t,e){this._texture=t,this.mapCoord=new vi,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],a=t[n+1];e[n]=s*r.a+a*r.c+r.tx,e[n+1]=s*r.b+a*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const n=e.orig,s=e.trim;s&&(vg.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(vg));const a=e.baseTexture,o=this.uClampFrame,u=this.clampMargin/a.resolution,d=this.clampOffset;return o[0]=(e._frame.x+u+d)/a.width,o[1]=(e._frame.y+u+d)/a.height,o[2]=(e._frame.x+e._frame.width-u+d)/a.width,o[3]=(e._frame.y+e._frame.height-u+d)/a.height,this.uClampOffset[0]=d/a.realWidth,this.uClampOffset[1]=d/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&e.rotate===0,!0}}class bM extends Mh{constructor(t,e,r){let n=null;typeof t!="string"&&e===void 0&&r===void 0&&(n=t,t=void 0,e=void 0,r=void 0),super(t||_M,e||wM,r),this.maskSprite=n,this.maskMatrix=new vi}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,n){const s=this._maskSprite,a=s._texture;!a.valid||(a.uvMatrix||(a.uvMatrix=new wf(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,r,n))}}class $0{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const s=this.maskDataPool.pop()||new iM;s.pooled=!0,s.maskObject=e,r=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(n),r._colorMask=n?n._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==Pi.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Pi.SCISSOR:this.renderer.scissor.push(r);break;case Pi.STENCIL:this.renderer.stencil.push(r);break;case Pi.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Pi.COLOR:this.pushColorMask(r);break}r.type===Pi.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case Pi.SCISSOR:this.renderer.scissor.pop(e);break;case Pi.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Pi.SPRITE:this.popSpriteMask(e);break;case Pi.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===Pi.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=Pi.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Pi.SCISSOR:t.type=Pi.STENCIL:t.type=Pi.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new bM]));const s=this.renderer,a=s.renderTexture;let o,u;if(a.current){const m=a.current;o=t.resolution||m.resolution,u=t.multisample??m.multisample}else o=t.resolution||s.resolution,u=t.multisample??s.multisample;n[0].resolution=o,n[0].multisample=u,n[0].maskSprite=e;const d=r.filterArea;r.filterArea=e.getBounds(!0),s.filter.push(r,n),r.filterArea=d,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}$0.extension={type:Jt.RendererSystem,name:"mask"};le.add($0);class Z0{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==r&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const _g=new vi,wg=[],ac=class extends Z0{constructor(i){super(i),this.glConst=Xt.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const i=this.maskStack[this.maskStack.length-1];return i?i._scissorCounter:0}calcScissorRect(i){if(i._scissorRectLocal)return;const t=i._scissorRect,{maskObject:e}=i,{renderer:r}=this,n=r.renderTexture,s=e.getBounds(!0,wg.pop()??new Te);this.roundFrameToPixels(s,n.current?n.current.resolution:r.resolution,n.sourceFrame,n.destinationFrame,r.projection.transform),t&&s.fit(t),i._scissorRectLocal=s}static isMatrixRotated(i){if(!i)return!1;const{a:t,b:e,c:r,d:n}=i;return(Math.abs(e)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(i){const{maskObject:t}=i;if(!t.isFastRect||!t.isFastRect()||ac.isMatrixRotated(t.worldTransform)||ac.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(i);const e=i._scissorRectLocal;return e.width>0&&e.height>0}roundFrameToPixels(i,t,e,r,n){ac.isMatrixRotated(n)||(n=n?_g.copyFrom(n):_g.identity(),n.translate(-e.x,-e.y).scale(r.width/e.width,r.height/e.height).translate(r.x,r.y),this.renderer.filter.transformAABB(n,i),i.fit(r),i.x=Math.round(i.x*t),i.y=Math.round(i.y*t),i.width=Math.round(i.width*t),i.height=Math.round(i.height*t))}push(i){i._scissorRectLocal||this.calcScissorRect(i);const{gl:t}=this.renderer;i._scissorRect||t.enable(t.SCISSOR_TEST),i._scissorCounter++,i._scissorRect=i._scissorRectLocal,this._useCurrent()}pop(i){const{gl:t}=this.renderer;i&&wg.push(i._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const i=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=i.y:t=this.renderer.height-i.height-i.y,this.renderer.gl.scissor(i.x,t,i.width,i.height)}};let Q0=ac;Q0.extension={type:Jt.RendererSystem,name:"scissor"};le.add(Q0);class J0 extends Z0{constructor(t){super(t),this.glConst=Xt.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;s!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,n,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(t._colorMask=s,r.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=r?r._colorMask:15;n!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(r._colorMask=n,e.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}J0.extension={type:Jt.RendererSystem,name:"stencil"};le.add(J0);class ty{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new vi,this.transform=null}update(t,e,r,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,r,n){const s=this.projectionMatrix,a=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=a*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-a-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}ty.extension={type:Jt.RendererSystem,name:"projection"};le.add(ty);const Qs=new Te,uh=new Te;class ey{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Te,this.destinationFrame=new Te,this.viewportFrame=new Te}bind(t=null,e,r){const n=this.renderer;this.current=t;let s,a,o;t?(s=t.baseTexture,o=s.resolution,e||(Qs.width=t.frame.width,Qs.height=t.frame.height,e=Qs),r||(uh.x=t.frame.x,uh.y=t.frame.y,uh.width=e.width,uh.height=e.height,r=uh),a=s.framebuffer):(o=n.resolution,e||(Qs.width=n._view.screen.width,Qs.height=n._view.screen.height,e=Qs),r||(r=Qs,r.width=e.width,r.height=e.height));const u=this.viewportFrame;u.x=r.x*o,u.y=r.y*o,u.width=r.width*o,u.height=r.height*o,t||(u.y=n.view.height-(u.y+u.height)),u.ceil(),this.renderer.framebuffer.bind(a,u),this.renderer.projection.update(r,e,o,!a),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.renderer.background.colorRgba;const r=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,s=r.width!==n.width||r.height!==n.height;if(s){let{x:a,y:o,width:u,height:d}=this.viewportFrame;a=Math.round(a),o=Math.round(o),u=Math.round(u),d=Math.round(d),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,o,u,d)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),s&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}ey.extension={type:Jt.RendererSystem,name:"renderTexture"};le.add(ey);function xM(i,t,e,r,n){e.buffer.update(n)}const AM={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},iy={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function EM(i){const t=i.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let e=0,r=0,n=0;for(let s=0;s<t.length;s++){const a=t[s];if(e=iy[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,r%e!==0&&r<16){const o=r%e%16;r+=o,n+=o}r+e>16?(n=Math.ceil(n/16)*16,a.offset=n,n+=e,r=e):(a.offset=n,r+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function TM(i,t){const e=[];for(const r in i)t[r]&&e.push(t[r]);return e.sort((r,n)=>r.index-n.index),e}function SM(i,t){if(!i.autoManage)return{size:0,syncFunc:xM};const e=TM(i.uniforms,t),{uboElements:r,size:n}=EM(e),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<r.length;a++){const o=r[a],u=i.uniforms[o.data.name],d=o.data.name;let m=!1;for(let l=0;l<vo.length;l++){const f=vo[l];if(f.codeUbo&&f.test(o.data,u)){s.push(`offset = ${o.offset/4};`,vo[l].codeUbo(o.data.name,u)),m=!0;break}}if(!m)if(o.data.size>1){const l=K0(o.data.type),f=Math.max(iy[o.data.type]/16,1),p=l/f,y=(4-p%4)%4;s.push(`
                cv = ud.${d}.value;
                v = uv.${d};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*f}; i++)
                {
                    for(var j = 0; j < ${p}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${y};
                }

                `)}else{const l=AM[o.data.type];s.push(`
                cv = ud.${d}.value;
                v = uv.${d};
                offset = ${o.offset/4};
                ${l};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}class CM{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function MM(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=t.getActiveAttrib(i,n);if(s.name.startsWith("gl_"))continue;const a=q0(t,s.type),o={type:a,name:s.name,size:K0(a),location:t.getAttribLocation(i,s.name)};e[s.name]=o}return e}function IM(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<r;n++){const s=t.getActiveUniform(i,n),a=s.name.replace(/\[.*?\]$/,""),o=!!s.name.match(/\[.*?\]$/),u=q0(t,s.type);e[a]={name:a,index:n,type:u,size:s.size,isArray:o,value:j0(u,s.size)}}return e}function BM(i,t){const e=pg(i,i.VERTEX_SHADER,t.vertexSrc),r=pg(i,i.FRAGMENT_SHADER,t.fragmentSrc),n=i.createProgram();i.attachShader(n,e),i.attachShader(n,r);const s=t.extra?.transformFeedbackVaryings;if(s&&(typeof i.transformFeedbackVaryings!="function"||i.transformFeedbackVaryings(n,s.names,s.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(n),i.getProgramParameter(n,i.LINK_STATUS)||rM(i,n,e,r),t.attributeData=MM(n,i),t.uniformData=IM(n,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const u=Object.keys(t.attributeData);u.sort((d,m)=>d>m?1:-1);for(let d=0;d<u.length;d++)t.attributeData[u[d]].location=d,i.bindAttribLocation(n,d,u[d]);i.linkProgram(n)}i.deleteShader(e),i.deleteShader(r);const a={};for(const u in t.uniformData){const d=t.uniformData[u];a[u]={location:i.getUniformLocation(n,u),value:j0(d.type,d.size)}}return new CM(n,a)}let kM=0;const Fl={textureCount:0,uboCount:0};class ry{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=kM++}systemCheck(){if(!fM())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),e||(Fl.textureCount=0,Fl.uboCount=0,this.syncUniformGroup(t.uniformGroup,Fl)),n}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=lM(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const n=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),n(r.uniformData,t.uniforms,this.renderer,Fl,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=SM(t,this.shader.program.uniformData)),t.autoManage){const u=new Float32Array(o.size/4);t.buffer.update(u)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const n=t.uniforms,s=[`${r}-`];for(const a in n)s.push(a),e[a]&&s.push(e[a].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,n=BM(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ry.extension={type:Jt.RendererSystem,name:"shader"};le.add(ry);function RM(i,t=[]){return t[ue.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.ADD]=[i.ONE,i.ONE],t[ue.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.NONE]=[0,0],t[ue.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[ue.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ue.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[ue.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[ue.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[ue.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[ue.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[ue.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[ue.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[ue.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[ue.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const PM=0,DM=1,LM=2,OM=3,FM=4,NM=5,qd=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ue.NONE,this._blendEq=!1,this.map=[],this.map[PM]=this.setBlend,this.map[DM]=this.setOffset,this.map[LM]=this.setCullFace,this.map[OM]=this.setDepthTest,this.map[FM]=this.setFrontFace,this.map[NM]=this.setDepthMask,this.checks=[],this.defaultState=new rs,this.defaultState.blend=!0}contextChange(i){this.gl=i,this.blendModes=RM(i),this.set(this.defaultState),this.reset()}set(i){if(i=i||this.defaultState,this.stateId!==i.data){let t=this.stateId^i.data,e=0;for(;t;)t&1&&this.map[e].call(this,!!(i.data&1<<e)),t=t>>1,e++;this.stateId=i.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,i)}forceState(i){i=i||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(i.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,i);this.stateId=i.data}setBlend(i){this.updateCheck(qd.checkBlendMode,i),this.gl[i?"enable":"disable"](this.gl.BLEND)}setOffset(i){this.updateCheck(qd.checkPolygonOffset,i),this.gl[i?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(i){this.gl[i?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(i){this.gl.depthMask(i)}setCullFace(i){this.gl[i?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(i){this.gl.frontFace(this.gl[i?"CW":"CCW"])}setBlendMode(i){if(i===this.blendMode)return;this.blendMode=i;const t=this.blendModes[i],e=this.gl;t.length===2?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(i,t){this.gl.polygonOffset(i,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(i,t){const e=this.checks.indexOf(i);t&&e===-1?this.checks.push(i):!t&&e!==-1&&this.checks.splice(e,1)}static checkBlendMode(i,t){i.setBlendMode(t.blendMode)}static checkPolygonOffset(i,t){i.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let ny=qd;ny.extension={type:Jt.RendererSystem,name:"state"};le.add(ny);class sy{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Xt.GC_MAX_IDLE,this.checkCountMax=Xt.GC_MAX_CHECK_COUNT,this.mode=Xt.GC_MODE}postrender(){!this.renderer.objectRenderer.renderingToScreen||(this.count++,this.mode!==df.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let n=0;n<e.length;n++){const s=e[n];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,r=!0)}if(r){let n=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[n++]=e[s]);e.length=n}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}}sy.extension={type:Jt.RendererSystem,name:"textureGC"};le.add(sy);function UM(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[de.UNSIGNED_BYTE]:{[Yt.RGBA]:i.RGBA8,[Yt.RGB]:i.RGB8,[Yt.RG]:i.RG8,[Yt.RED]:i.R8,[Yt.RGBA_INTEGER]:i.RGBA8UI,[Yt.RGB_INTEGER]:i.RGB8UI,[Yt.RG_INTEGER]:i.RG8UI,[Yt.RED_INTEGER]:i.R8UI,[Yt.ALPHA]:i.ALPHA,[Yt.LUMINANCE]:i.LUMINANCE,[Yt.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[de.BYTE]:{[Yt.RGBA]:i.RGBA8_SNORM,[Yt.RGB]:i.RGB8_SNORM,[Yt.RG]:i.RG8_SNORM,[Yt.RED]:i.R8_SNORM,[Yt.RGBA_INTEGER]:i.RGBA8I,[Yt.RGB_INTEGER]:i.RGB8I,[Yt.RG_INTEGER]:i.RG8I,[Yt.RED_INTEGER]:i.R8I},[de.UNSIGNED_SHORT]:{[Yt.RGBA_INTEGER]:i.RGBA16UI,[Yt.RGB_INTEGER]:i.RGB16UI,[Yt.RG_INTEGER]:i.RG16UI,[Yt.RED_INTEGER]:i.R16UI,[Yt.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[de.SHORT]:{[Yt.RGBA_INTEGER]:i.RGBA16I,[Yt.RGB_INTEGER]:i.RGB16I,[Yt.RG_INTEGER]:i.RG16I,[Yt.RED_INTEGER]:i.R16I},[de.UNSIGNED_INT]:{[Yt.RGBA_INTEGER]:i.RGBA32UI,[Yt.RGB_INTEGER]:i.RGB32UI,[Yt.RG_INTEGER]:i.RG32UI,[Yt.RED_INTEGER]:i.R32UI,[Yt.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[de.INT]:{[Yt.RGBA_INTEGER]:i.RGBA32I,[Yt.RGB_INTEGER]:i.RGB32I,[Yt.RG_INTEGER]:i.RG32I,[Yt.RED_INTEGER]:i.R32I},[de.FLOAT]:{[Yt.RGBA]:i.RGBA32F,[Yt.RGB]:i.RGB32F,[Yt.RG]:i.RG32F,[Yt.RED]:i.R32F,[Yt.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[de.HALF_FLOAT]:{[Yt.RGBA]:i.RGBA16F,[Yt.RGB]:i.RGB16F,[Yt.RG]:i.RG16F,[Yt.RED]:i.R16F},[de.UNSIGNED_SHORT_5_6_5]:{[Yt.RGB]:i.RGB565},[de.UNSIGNED_SHORT_4_4_4_4]:{[Yt.RGBA]:i.RGBA4},[de.UNSIGNED_SHORT_5_5_5_1]:{[Yt.RGBA]:i.RGB5_A1},[de.UNSIGNED_INT_2_10_10_10_REV]:{[Yt.RGBA]:i.RGB10_A2,[Yt.RGBA_INTEGER]:i.RGB10_A2UI},[de.UNSIGNED_INT_10F_11F_11F_REV]:{[Yt.RGB]:i.R11F_G11F_B10F},[de.UNSIGNED_INT_5_9_9_9_REV]:{[Yt.RGB]:i.RGB9_E5},[de.UNSIGNED_INT_24_8]:{[Yt.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[de.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[Yt.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[de.UNSIGNED_BYTE]:{[Yt.RGBA]:i.RGBA,[Yt.RGB]:i.RGB,[Yt.ALPHA]:i.ALPHA,[Yt.LUMINANCE]:i.LUMINANCE,[Yt.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[de.UNSIGNED_SHORT_5_6_5]:{[Yt.RGB]:i.RGB},[de.UNSIGNED_SHORT_4_4_4_4]:{[Yt.RGBA]:i.RGBA},[de.UNSIGNED_SHORT_5_5_5_1]:{[Yt.RGBA]:i.RGBA}},t}class pd{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=de.UNSIGNED_BYTE,this.internalFormat=Yt.RGBA,this.samplerType=0}}class ay{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Pe,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=UM(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const r=new pd(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new pd(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<r.length;n++)r[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:n}=this;if(!!r)for(let s=t-1;s>=0;--s){const a=e[s];a&&a._glTextures[n].samplerType!==Fd.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const e=new pd(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,this.webGLVersion===2&&t.type===de.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==Fd.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,s=t.realHeight,a=r.gl;(e.width!==n||e.height!==s||e.dirtyId<0)&&(e.width=n,e.height=s,a.texImage2D(t.target,0,e.internalFormat,n,s,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);n!==-1&&yo(this.managedTextures,n,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];!e||((t.mipmap===xn.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Bs.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==xn.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Kn.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===Kn.LINEAR){const s=Math.min(t.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===Kn.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===Kn.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}ay.extension={type:Jt.RendererSystem,name:"texture"};le.add(ay);const HM=new kc;class oy{constructor(t){this.renderer=t,this._tempMatrix=new vi}generateTexture(t,e){const{region:r,...n}=e||{},s=r||t.getLocalBounds(null,!0);s.width===0&&(s.width=1),s.height===0&&(s.height=1);const a=Di.create({width:s.width,height:s.height,...n});this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const o=t.transform;return t.transform=HM,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,a}destroy(){}}oy.extension={type:[Jt.RendererSystem,Jt.CanvasRendererSystem],name:"textureGenerator"};le.add(oy);class hy{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color=typeof t.color=="string"?yf(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=M0(t),bo(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}hy.extension={type:[Jt.RendererSystem,Jt.CanvasRendererSystem],name:"background"};le.add(hy);class ly{constructor(t){this.renderer=t}init(t){this.screen=new Te(0,0,t.width,t.height),this.element=t.view||Xt.ADAPTER.createCanvas(),this.resolution=t.resolution||Xt.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=r,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",r,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}ly.extension={type:[Jt.RendererSystem,Jt.CanvasRendererSystem],name:"_view"};le.add(ly);class cy{constructor(t){this.renderer=t,this.plugins={}}init(t){for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}cy.extension={type:[Jt.RendererSystem,Jt.CanvasRendererSystem],name:"_plugin"};le.add(cy);class GM extends Io{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(n=>t.systems[n]),r=[...e,...Object.keys(t.systems).filter(n=>!e.includes(n))];for(const n of r)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(e=>{this.runners[e]=new en(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const n in this.runners)this.runners[n].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(n=>{const s=r.find(a=>this._systemsHash[a]===n);n[t.name](e[s])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}class uy{constructor(t){this.renderer=t}run(t){const e=this.renderer;e.emitWithCustomOptions(e.runners.init,t),t.hello&&console.log(`PixiJS 7.0.4 - ${e.rendererLogId} - https://pixijs.com`),e.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}uy.extension={type:[Jt.RendererSystem,Jt.CanvasRendererSystem],name:"startup"};le.add(uy);class dy{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:n}=this;e&&n.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:n}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[n]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];!o||(r.buffer.update(o),o._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];if(!o)continue;const u=o._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!e&&s.dispose(o,e))}!r||(e||n.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}dy.extension={type:Jt.RendererSystem,name:"transformFeedback"};le.add(dy);const fy=[];le.handleByList(Jt.Renderer,fy);function WM(i){for(const t of fy)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var zM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const VM=zM,$d=class extends GM{constructor(i){super(),i=Object.assign({},Xt.RENDER_OPTIONS,i),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new nn({projectionMatrix:new vi},!0);const t={runners:["init","destroy","contextChange","reset","update","postrender","prerender","resize"],systems:$d.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t);const e={hello:i.hello,_plugin:$d.__plugins,background:{alpha:i.backgroundAlpha,color:i.background??i.backgroundColor,clearBeforeRender:i.clearBeforeRender},_view:{height:i.height,width:i.width,autoDensity:i.autoDensity,resolution:i.resolution,view:i.view},context:{antialias:i.antialias,context:i.context,powerPreference:i.powerPreference,premultipliedAlpha:i.premultipliedAlpha??(i.useContextAlpha&&i.useContextAlpha!=="notMultiplied"),preserveDrawingBuffer:i.preserveDrawingBuffer}};this.startup.run(e)}static test(i){return i?.forceCanvas?!1:KE()}render(i,t){this.objectRenderer.render(i,t)}resize(i,t){this._view.resizeView(i,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(i=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:i}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return this.background.clearBeforeRender}get useContextAlpha(){return this.context.useContextAlpha}get preserveDrawingBuffer(){return this.context.preserveDrawingBuffer}get backgroundColor(){return this.background.color}set backgroundColor(i){this.background.color=i}get backgroundAlpha(){return this.background.color}set backgroundAlpha(i){this.background.alpha=i}get powerPreference(){return this.context.powerPreference}generateTexture(i,t){return this.textureGenerator.generateTexture(i,t)}};let ba=$d;ba.extension={type:Jt.Renderer,priority:1};ba.__plugins={};ba.__systems={};le.handleByMap(Jt.RendererPlugin,ba.__plugins);le.handleByMap(Jt.RendererSystem,ba.__systems);le.add(ba);class Zd{constructor(){this.texArray=null,this.blend=0,this.type=vn.TRIANGLES,this.start=0,this.size=0,this.data=null}}class Qd{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class Jd{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}class XM{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let s=0;s<t;s++)r[s]=s;this.defaultGroupCache[t]=nn.from({uSamplers:r},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new $n(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new vi,default:this.defaultGroupCache[t]};return new yr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class py extends An{constructor(t=!1){super(),this._buffer=new Ai(null,t,!1),this._indexBuffer=new Ai(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,de.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,de.FLOAT).addAttribute("aColor",this._buffer,4,!0,de.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,de.FLOAT).addIndex(this._indexBuffer)}}var jM=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,YM=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;const aa=class extends Lc{constructor(i){super(i),this.setShaderGenerator(),this.geometryClass=py,this.vertexSize=6,this.state=rs.for2d(),this.size=Xt.SPRITE_BATCH_SIZE*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),i.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultVertexSrc(){return jM}static get defaultFragmentTemplate(){return YM}setShaderGenerator({vertex:i=aa.defaultVertexSrc,fragment:t=aa.defaultFragmentTemplate}={}){this.shaderGenerator=new XM(i,t)}contextChange(){const i=this.renderer.gl;Xt.PREFER_ENV===wa.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),Xt.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=dM(this.MAX_TEXTURES,i)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:i,_textureArrayPool:t}=aa,e=this.size/4,r=Math.floor(e/this.MAX_TEXTURES)+1;for(;i.length<e;)i.push(new Zd);for(;t.length<r;)t.push(new Qd);for(let n=0;n<this.MAX_TEXTURES;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(i){!i._texture.valid||(this._vertexCount+i.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=i.vertexData.length/2,this._indexCount+=i.indices.length,this._bufferedTextures[this._bufferSize]=i._texture.baseTexture,this._bufferedElements[this._bufferSize++]=i)}buildTexturesAndDrawCalls(){const{_bufferedTextures:i,MAX_TEXTURES:t}=this,e=aa._textureArrayPool,r=this.renderer.batch,n=this._tempBoundTextures,s=this.renderer.textureGC.count;let a=++Pe._globalBatch,o=0,u=e[0],d=0;r.copyBoundTextures(n,t);for(let m=0;m<this._bufferSize;++m){const l=i[m];i[m]=null,l._batchEnabled!==a&&(u.count>=t&&(r.boundArray(u,n,a,t),this.buildDrawCalls(u,d,m),d=m,u=e[++o],++a),l._batchEnabled=a,l.touched=s,u.elements[u.count++]=l)}u.count>0&&(r.boundArray(u,n,a,t),this.buildDrawCalls(u,d,this._bufferSize),++o,++a);for(let m=0;m<n.length;m++)n[m]=null;Pe._globalBatch=a}buildDrawCalls(i,t,e){const{_bufferedElements:r,_attributeBuffer:n,_indexBuffer:s,vertexSize:a}=this,o=aa._drawCallPool;let u=this._dcIndex,d=this._aIndex,m=this._iIndex,l=o[u];l.start=this._iIndex,l.texArray=i;for(let f=t;f<e;++f){const p=r[f],y=p._texture.baseTexture,v=I0[y.alphaMode?1:0][p.blendMode];r[f]=null,t<f&&l.blend!==v&&(l.size=m-l.start,t=f,l=o[++u],l.texArray=i,l.start=m),this.packInterleavedGeometry(p,n,s,d,m),d+=p.vertexData.length/2*a,m+=p.indices.length,l.blend=v}t<e&&(l.size=m-l.start,++u),this._dcIndex=u,this._aIndex=d,this._iIndex=m}bindAndClearTexArray(i){const t=this.renderer.texture;for(let e=0;e<i.count;e++)t.bind(i.elements[e],i.ids[e]),i.elements[e]=null;i.count=0}updateGeometry(){const{_packedGeometries:i,_attributeBuffer:t,_indexBuffer:e}=this;Xt.CAN_UPLOAD_SAME_BUFFER?(i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const i=this._dcIndex,{gl:t,state:e}=this.renderer,r=aa._drawCallPool;let n=null;for(let s=0;s<i;s++){const{texArray:a,type:o,size:u,start:d,blend:m}=r[s];n!==a&&(n=a,this.bindAndClearTexArray(a)),this.state.blendMode=m,e.set(this.state),t.drawElements(o,u,t.UNSIGNED_SHORT,d*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),Xt.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(i){const t=fc(Math.ceil(i/8)),e=hg(t),r=t*8;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._aBuffers[r];return n||(this._aBuffers[r]=n=new Jd(r*this.vertexSize*4)),n}getIndexBuffer(i){const t=fc(Math.ceil(i/12)),e=hg(t),r=t*12;this._iBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._iBuffers[e];return n||(this._iBuffers[e]=n=new Uint16Array(r)),n}packInterleavedGeometry(i,t,e,r,n){const{uint32View:s,float32View:a}=t,o=r/this.vertexSize,u=i.uvs,d=i.indices,m=i.vertexData,l=i._texture.baseTexture._batchLocation,f=Math.min(i.worldAlpha,1),p=f<1&&i._texture.baseTexture.alphaMode?vf(i._tintRGB,f):i._tintRGB+(f*255<<24);for(let y=0;y<m.length;y+=2)a[r++]=m[y],a[r++]=m[y+1],a[r++]=u[y],a[r++]=u[y+1],s[r++]=p,a[r++]=l;for(let y=0;y<d.length;y++)e[n++]=o+d[y]}};let Oc=aa;Oc.extension={name:"batch",type:Jt.RendererPlugin};Oc._drawCallPool=[];Oc._textureArrayPool=[];le.add(Oc);class KM{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class my{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,r){const{gl:n,CONTEXT_UID:s}=this;r=r||0;const a=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,a.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),r&&(e||n.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new KM(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}my.extension={type:Jt.RendererSystem,name:"buffer"};le.add(my);class gy{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=Ti.HIGH?this.multisample=Ti.HIGH:e>=Ti.MEDIUM?this.multisample=Ti.MEDIUM:e>=Ti.LOW?this.multisample=Ti.LOW:this.multisample=Ti.NONE}destroy(){}}gy.extension={type:Jt.RendererSystem,name:"_multisample"};le.add(gy);class yy{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let n,s,a,o;if(e&&(n=e.renderTexture,s=e.clear,a=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!n,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=a,!r.context.isLost){if(n||(this.lastObjectRendered=t),!o){const u=t.enableTempParent();t.updateTransform(),t.disableTempParent(u)}r.renderTexture.bind(n),r.batch.currentRenderer.start(),(s??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),n&&(e.blit&&r.framebuffer.blit(),n.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}yy.extension={type:Jt.RendererSystem,name:"objectRenderer"};le.add(yy);var qM=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class bg extends Mh{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(VM,qM,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const r=t>>16&255,n=t>>8&255,s=t&255,a=[r/255,0,0,0,0,0,n/255,0,0,0,0,0,s/255,0,0,0,0,0,1,0];this._loadMatrix(a,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),n=Math.sin(t),s=Math.sqrt,a=1/3,o=s(a),u=r+(1-r)*a,d=a*(1-r)-o*n,m=a*(1-r)+o*n,l=a*(1-r)+o*n,f=r+a*(1-r),p=a*(1-r)-o*n,y=a*(1-r)-o*n,v=a*(1-r)+o*n,_=r+a*(1-r),w=[u,d,m,0,0,l,f,p,0,0,y,v,_,0,0,0,0,0,1,0];this._loadMatrix(w,e)}contrast(t,e){const r=(t||0)+1,n=-.5*(r-1),s=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const r=t*2/3+1,n=(r-1)*-.5,s=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,n,s){t=t||.2,e=e||.15,r=r||16770432,n=n||3375104;const a=(r>>16&255)/255,o=(r>>8&255)/255,u=(r&255)/255,d=(n>>16&255)/255,m=(n>>8&255)/255,l=(n&255)/255,f=[.3,.59,.11,0,0,a,o,u,t,0,d,m,l,e,0,a-d,o-m,u-l,0,0];this._loadMatrix(f,s)}night(t,e){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}bg.prototype.grayscale=bg.prototype.greyscale;Xt.SORTABLE_CHILDREN=!1;class mc{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Te.EMPTY:(t=t||new Te(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:n,c:s,d:a,tx:o,ty:u}=t,d=r*e.x+s*e.y+o,m=n*e.x+a*e.y+u;this.minX=Math.min(this.minX,d),this.maxX=Math.max(this.maxX,d),this.minY=Math.min(this.minY,m),this.maxY=Math.max(this.maxY,m)}addQuad(t){let e=this.minX,r=this.minY,n=this.maxX,s=this.maxY,a=t[0],o=t[1];e=a<e?a:e,r=o<r?o:r,n=a>n?a:n,s=o>s?o:s,a=t[2],o=t[3],e=a<e?a:e,r=o<r?o:r,n=a>n?a:n,s=o>s?o:s,a=t[4],o=t[5],e=a<e?a:e,r=o<r?o:r,n=a>n?a:n,s=o>s?o:s,a=t[6],o=t[7],e=a<e?a:e,r=o<r?o:r,n=a>n?a:n,s=o>s?o:s,this.minX=e,this.minY=r,this.maxX=n,this.maxY=s}addFrame(t,e,r,n,s){this.addFrameMatrix(t.worldTransform,e,r,n,s)}addFrameMatrix(t,e,r,n,s){const a=t.a,o=t.b,u=t.c,d=t.d,m=t.tx,l=t.ty;let f=this.minX,p=this.minY,y=this.maxX,v=this.maxY,_=a*e+u*r+m,w=o*e+d*r+l;f=_<f?_:f,p=w<p?w:p,y=_>y?_:y,v=w>v?w:v,_=a*n+u*r+m,w=o*n+d*r+l,f=_<f?_:f,p=w<p?w:p,y=_>y?_:y,v=w>v?w:v,_=a*e+u*s+m,w=o*e+d*s+l,f=_<f?_:f,p=w<p?w:p,y=_>y?_:y,v=w>v?w:v,_=a*n+u*s+m,w=o*n+d*s+l,f=_<f?_:f,p=w<p?w:p,y=_>y?_:y,v=w>v?w:v,this.minX=f,this.minY=p,this.maxX=y,this.maxY=v}addVertexData(t,e,r){let n=this.minX,s=this.minY,a=this.maxX,o=this.maxY;for(let u=e;u<r;u+=2){const d=t[u],m=t[u+1];n=d<n?d:n,s=m<s?m:s,a=d>a?d:a,o=m>o?m:o}this.minX=n,this.minY=s,this.maxX=a,this.maxY=o}addVertices(t,e,r,n){this.addVerticesMatrix(t.worldTransform,e,r,n)}addVerticesMatrix(t,e,r,n,s=0,a=s){const o=t.a,u=t.b,d=t.c,m=t.d,l=t.tx,f=t.ty;let p=this.minX,y=this.minY,v=this.maxX,_=this.maxY;for(let w=r;w<n;w+=2){const T=e[w],E=e[w+1],R=o*T+d*E+l,H=m*E+u*T+f;p=Math.min(p,R-s),v=Math.max(v,R+s),y=Math.min(y,H-a),_=Math.max(_,H+a)}this.minX=p,this.minY=y,this.maxX=v,this.maxY=_}addBounds(t){const e=this.minX,r=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=s&&n<=a){const o=this.minX,u=this.minY,d=this.maxX,m=this.maxY;this.minX=r<o?r:o,this.minY=n<u?n:u,this.maxX=s>d?s:d,this.maxY=a>m?a:m}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=s&&n<=a){const o=this.minX,u=this.minY,d=this.maxX,m=this.maxY;this.minX=r<o?r:o,this.minY=n<u?n:u,this.maxX=s>d?s:d,this.maxY=a>m?a:m}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,n,s,a){t-=s,e-=a,r+=s,n+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class pi extends Io{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new kc,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new mc,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const n=e[r];Object.defineProperty(pi.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Te),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Te),t=this._localBoundsRect),this._localBounds||(this._localBounds=new mc);const e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-s,a}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,n=1,s=0,a=0,o=0,u=0,d=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=n||1,this.rotation=s,this.skew.x=a,this.skew.y=o,this.pivot.x=u,this.pivot.y=d,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new $M),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*hE}set angle(t){this.transform.rotation=t*lE}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class $M extends pi{constructor(){super(...arguments),this.sortDirty=null}}pi.prototype.displayObjectUpdateTransform=pi.prototype.updateTransform;function ZM(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}class be extends pi{constructor(){super(),this.children=[],this.sortableChildren=Xt.SORTABLE_CHILDREN,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t,this.onChildrenChange(r<n?r:n)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);yo(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,yo(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,yo(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,n=e,s=n-r;let a;if(s>0&&s<=n){a=this.children.splice(r,s);for(let o=0;o<a.length;++o)a[o].parent=null,a[o].transform&&(a[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let o=0;o<a.length;++o)a[o].emit("removed",this),this.emit("childRemoved",a[o],this,o);return a}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const n=this.children[e];n._lastSortedIndex=e,!t&&n.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(ZM),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let n=0,s=this.children.length;n<s;++n){const a=this.children[n];a.visible&&a.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,n;if(this.cullArea?(r=this.cullArea,n=this.worldTransform):this._render!==be.prototype._render&&(r=this.getBounds(!0)),r&&e.intersects(r,n))this._render(t);else if(this.cullArea)return;for(let s=0,a=this.children.length;s<a;++s){const o=this.children[s],u=o.cullable;o.cullable=u||!this.cullArea,o.render(t),o.cullable=u}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let s=0;s<e.length;s++)e[s].enabled&&this._enabledFilters.push(e[s])}const n=e&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==Pi.NONE));if(n&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let s=0,a=this.children.length;s<a;++s)this.children[s].render(t)}n&&t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t?.children,r=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<r.length;++n)r[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}}be.prototype.containerUpdateTransform=be.prototype.updateTransform;const dh=new He,QM=new Uint16Array([0,1,2,0,2,3]);class Ie extends be{constructor(t){super(),this._anchor=new Cs(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=ue.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Ht.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=QM,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Xt.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=so(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=so(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,n=e.b,s=e.c,a=e.d,o=e.tx,u=e.ty,d=this.vertexData,m=t.trim,l=t.orig,f=this._anchor;let p=0,y=0,v=0,_=0;if(m?(y=m.x-f._x*l.width,p=y+m.width,_=m.y-f._y*l.height,v=_+m.height):(y=-f._x*l.width,p=y+l.width,_=-f._y*l.height,v=_+l.height),d[0]=r*y+s*_+o,d[1]=a*_+n*y+u,d[2]=r*p+s*_+o,d[3]=a*_+n*p+u,d[4]=r*p+s*v+o,d[5]=a*v+n*p+u,d[6]=r*y+s*v+o,d[7]=a*v+n*y+u,this._roundPixels){const w=Xt.RESOLUTION;for(let T=0;T<d.length;++T)d[T]=Math.round(d[T]*w)/w}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,n=this._anchor,s=this.transform.worldTransform,a=s.a,o=s.b,u=s.c,d=s.d,m=s.tx,l=s.ty,f=-n._x*r.width,p=f+r.width,y=-n._y*r.height,v=y+r.height;e[0]=a*f+u*y+m,e[1]=d*y+o*f+l,e[2]=a*p+u*y+m,e[3]=d*y+o*p+l,e[4]=a*p+u*v+m,e[5]=d*v+o*p+l,e[6]=a*f+u*v+m,e[7]=d*v+o*f+l}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new mc),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Te),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,dh);const e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x;let s=0;return dh.x>=n&&dh.x<n+e&&(s=-r*this.anchor.y,dh.y>=s&&dh.y<s+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.baseTexture;this._texture.destroy(!!r)}this._texture=null}static from(t,e){const r=t instanceof Ht?t:Ht.from(t,e);return new Ie(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=so(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=so(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Ht.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const vy=new vi;pi.prototype._cacheAsBitmap=!1;pi.prototype._cacheData=null;pi.prototype._cacheAsBitmapResolution=null;pi.prototype._cacheAsBitmapMultisample=null;class JM{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(pi.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let t;i?(this._cacheData||(this._cacheData=new JM),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});pi.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};pi.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const r=this.getLocalBounds(null,!0).clone();if(this.filters?.length){const f=this.filters[0].padding;r.pad(f)}r.ceil(Xt.RESOLUTION);const n=t.renderTexture.current,s=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,u=Di.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),d=`cacheAsBitmap_${ga()}`;this._cacheData.textureCacheId=d,Pe.addToCache(u.baseTexture,d),Ht.addToCache(u,d);const m=this.transform.localTransform.copyTo(vy).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:u,clear:!0,transform:m,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=o,t.renderTexture.bind(n,s,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const l=new Ie(u);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(r.x/r.width),l.anchor.y=-(r.y/r.height),l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=l.containsPoint.bind(l)};pi.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};pi.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,s=t._projTransform;e.ceil(Xt.RESOLUTION);const a=Di.create({width:e.width,height:e.height}),o=`cacheAsBitmap_${ga()}`;this._cacheData.textureCacheId=o,Pe.addToCache(a.baseTexture,o),Ht.addToCache(a,o);const u=vy;this.transform.localTransform.copyTo(u),u.invert(),u.tx-=e.x,u.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:a,clear:!0,transform:u,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const d=new Ie(a);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-(e.x/e.width),d.anchor.y=-(e.y/e.height),d.alpha=r,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=d.containsPoint.bind(d)};pi.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};pi.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};pi.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Pe.removeFromCache(this._cacheData.textureCacheId),Ht.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};pi.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};pi.prototype.name=null;be.prototype.getChildByName=function(t,e){for(let r=0,n=this.children.length;r<n;r++)if(this.children[r].name===t)return this.children[r];if(e)for(let r=0,n=this.children.length;r<n;r++){const s=this.children[r];if(!s.getChildByName)continue;const a=s.getChildByName(t,!0);if(a)return a}return null};pi.prototype.getGlobalPosition=function(t=new He,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const tI={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};class Rh{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Rh.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new He,this.page=new He,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class gc extends Rh{constructor(){super(...arguments),this.client=new He,this.movement=new He,this.offset=new He,this.global=new He,this.screen=new He}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,n,s,a,o,u,d,m,l,f,p,y,v){throw new Error("Method not implemented.")}}class Zr extends gc{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class tf extends gc{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const eI=2048,iI=new He,md=new He;class rI{constructor(t){this.dispatch=new Io,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((r,n)=>r.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,n=e.length;r<n;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){const r=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,iI.set(t,e),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=r.length-1;n<s;n++)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=r.length-2;n>=0;n--)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const n=r.children;if(n)for(let s=0;s<n.length;s++)this.all(t,e,n[s]);t.currentTarget=r,this.notifyTarget(t,e)}propagationPath(t){const e=[t];for(let r=0;r<eI&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestRecursive(t,e,r,n,s){if(!t||!t.visible||s(t,r))return null;if(t.interactiveChildren&&t.children){const a=t.children;for(let o=a.length-1;o>=0;o--){const u=a[o],d=this.hitTestRecursive(u,e||u.interactive,r,n,s);if(d){if(d.length>0&&!d[d.length-1].parent)continue;return(d.length>0||t.interactive)&&d.push(t),d}}}return e&&n(t,r)?t.interactive?[t]:[]:null}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,md),!t.hitArea.contains(md.x,md.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!r.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){e=e??t.type;const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,r),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Zr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const n=e.button===2;this.dispatchEvent(e,n?"rightdown":"mousedown")}const r=this.trackingData(t.pointerId);r.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Zr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t),r=e.pointerType==="mouse"||e.pointerType==="pen",n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(n.overTargets&&s!==e.target){const o=t.type==="mousemove"?"mouseout":"pointerout",u=this.createPointerEvent(t,o,s);if(this.dispatchEvent(u,"pointerout"),r&&this.dispatchEvent(u,"mouseout"),!e.composedPath().includes(s)){const d=this.createPointerEvent(t,"pointerleave",s);for(d.eventPhase=d.AT_TARGET;d.target&&!e.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),r&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(u)}if(s!==e.target){const o=t.type==="mousemove"?"mouseover":"pointerover",u=this.clonePointerEvent(e,o);this.dispatchEvent(u,"pointerover"),r&&this.dispatchEvent(u,"mouseover");let d=s?.parent;for(;d&&d!==this.rootTarget.parent&&d!==e.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const l=this.clonePointerEvent(e,"pointerenter");for(l.eventPhase=l.AT_TARGET;l.target&&l.target!==s&&l.target!==this.rootTarget.parent;)l.currentTarget=l.target,this.notifyTarget(l),r&&this.notifyTarget(l,"mouseenter"),l.target=l.target.parent;this.freeEvent(l)}this.freeEvent(u)}const a=this.moveOnAll?"all":"dispatchEvent";this[a](e,"pointermove"),e.pointerType==="touch"&&this[a](e,"touchmove"),r&&(this[a](e,"mousemove"),this.cursor=e.target?.cursor),n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Zr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),n=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=r.target?.cursor);const s=this.clonePointerEvent(r,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof Zr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const r=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),r&&this.dispatchEvent(s,"mouseout");const a=this.createPointerEvent(t,"pointerleave",n);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),r&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(a)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Zr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const o=r.button===2;this.dispatchEvent(r,o?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let a=s;if(s&&!r.composedPath().includes(s)){let o=s;for(;o&&!r.composedPath().includes(o);){if(r.currentTarget=o,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const u=r.button===2;this.notifyTarget(r,u?"rightupoutside":"mouseupoutside")}o=o.parent}delete n.pressTargetsByButton[t.button],a=o}if(a){const o=this.clonePointerEvent(r,"click");o.target=a,o.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:o.target,timeStamp:e});const u=n.clicksByButton[t.button];u.target===o.target&&e-u.timeStamp<200?++u.clickCount:u.clickCount=1,u.target=o.target,u.timeStamp=e,o.detail=u.clickCount,o.pointerType==="mouse"?this.dispatchEvent(o,"click"):o.pointerType==="touch"&&this.dispatchEvent(o,"tap"),this.dispatchEvent(o,"pointertap"),this.freeEvent(o)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof Zr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(r){let s=r;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof tf)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){const n=this.allocateEvent(Zr);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=r??this.hitTest(n.global.x,n.global.y),typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(tf);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(Zr);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Zr&&e instanceof Zr&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof gc&&e instanceof gc&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(!!r)if("fn"in r)r.fn.call(r.context,t);else for(let n=0,s=r.length;n<s&&!t.propagationImmediatelyStopped;n++)r[n].fn.call(r[n].context,t)}}const nI=1,sI={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class _y{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new rI(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Zr(null),this.rootWheelEvent=new tf(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let r=0,n=e.length;r<n;r++){const s=e[r],a=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const s=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let s=0,a=n.length;s<a;s++){const o=this.bootstrapEvent(this.rootPointerEvent,n[s]);o.type+=r,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const s=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){let n;this.domElement.parentElement?n=this.domElement.getBoundingClientRect():n={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const s=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*s,t.y=(r-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,n=t.changedTouches.length;r<n;r++){const s=t.changedTouches[r];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=nI),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=sI[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}}_y.extension={name:"events",type:[Jt.RendererSystem,Jt.CanvasRendererSystem]};le.add(_y);const aI={interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.on(i,t,n)},removeEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.off(i,t,n)},dispatchEvent(i){if(!(i instanceof Rh))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};pi.mixin(aI);pi.mixin(tI);const oI=9,Nl=100,hI=0,lI=0,xg=2,Ag=1,cI=-1e3,uI=-1e3,dI=2;class wy{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(qn.tablet||qn.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${Nl}px`,e.style.height=`${Nl}px`,e.style.position="absolute",e.style.top=`${hI}px`,e.style.left=`${lI}px`,e.style.zIndex=xg.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${Ag}px`,t.style.height=`${Ag}px`,t.style.position="absolute",t.style.top=`${cI}px`,t.style.left=`${uI}px`,t.style.zIndex=dI.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){!this._hookDiv||(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}update(){const t=performance.now();if(qn.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:a,height:o,resolution:u}=this.renderer,d=n/a*u,m=s/o*u;let l=this.div;l.style.left=`${e}px`,l.style.top=`${r}px`,l.style.width=`${a}px`,l.style.height=`${o}px`;for(let f=0;f<this.children.length;f++){const p=this.children[f];if(p.renderId!==this.renderId)p._accessibleActive=!1,yo(this.children,f,1),this.div.removeChild(p._accessibleDiv),this.pool.push(p._accessibleDiv),p._accessibleDiv=null,f--;else{l=p._accessibleDiv;let y=p.hitArea;const v=p.worldTransform;p.hitArea?(l.style.left=`${(v.tx+y.x*v.a)*d}px`,l.style.top=`${(v.ty+y.y*v.d)*m}px`,l.style.width=`${y.width*v.a*d}px`,l.style.height=`${y.height*v.d*m}px`):(y=p.getBounds(),this.capHitArea(y),l.style.left=`${y.x*d}px`,l.style.top=`${y.y*m}px`,l.style.width=`${y.width*d}px`,l.style.height=`${y.height*m}px`,l.title!==p.accessibleTitle&&p.accessibleTitle!==null&&(l.title=p.accessibleTitle),l.getAttribute("aria-label")!==p.accessibleHint&&p.accessibleHint!==null&&l.setAttribute("aria-label",p.accessibleHint)),(p.accessibleTitle!==l.title||p.tabIndex!==l.tabIndex)&&(l.title=p.accessibleTitle,l.tabIndex=p.tabIndex,this.debug&&this.updateDebugHTML(l))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${Nl}px`,e.style.height=`${Nl}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=xg.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new Rh(n),{target:r});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(a=>n.dispatchEvent(s,a))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===oI&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}wy.extension={name:"accessibility",type:[Jt.RendererPlugin,Jt.CanvasRendererPlugin]};le.add(wy);const ef=class{constructor(i){this.stage=new be,i=Object.assign({forceCanvas:!1},i),this.renderer=WM(i),ef._plugins.forEach(t=>{t.init.call(this,i)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(i,t){const e=ef._plugins.slice(0);e.reverse(),e.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(i),this.renderer=null}};let by=ef;by._plugins=[];le.handleByList(Jt.Application,by._plugins);class xy{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{!this._resizeTo||(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;e=n,r=s}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}xy.extension=Jt.Application;le.add(xy);class fI{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const Zn=(i,t)=>(Array.isArray(i)||(i=[i]),t?i.map(e=>typeof e=="string"?t(e):e):i);function Ay(i,t,e,r,n){const s=t[e];for(let a=0;a<s.length;a++){const o=s[a];e<t.length-1?Ay(i.replace(r[e],o),t,e+1,r,n):n.push(i.replace(r[e],o))}}function pI(i){const t=/\{(.*?)\}/g,e=i.match(t),r=[];if(e){const n=[];e.forEach(s=>{const a=s.substring(1,s.length-1).split(",");n.push(a)}),Ay(i,n,0,e,r)}else r.push(i);return r}const yc=i=>!Array.isArray(i);class mI{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){return this._cache.get(t)}set(t,e){const r=Zn(t);let n;for(let o=0;o<this.parsers.length;o++){const u=this.parsers[o];if(u.test(e)){n=u.getCacheableAssets(r,e);break}}n||(n={},r.forEach(o=>{n[o]=e}));const s=Object.keys(n),a={cacheKeys:s,keys:r};if(r.forEach(o=>{this._cacheMap.set(o,a)}),s.forEach(o=>{this._cache.has(o)&&this._cache.get(o),this._cache.set(o,n[o])}),e instanceof Ht){const o=e;r.forEach(u=>{o.baseTexture!==Ht.EMPTY.baseTexture&&Pe.addToCache(o.baseTexture,u),Ht.addToCache(o,u)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return;const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const fh=new mI;class gI{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{let n=null;for(let s=0;s<this.parsers.length;s++){const a=this.parsers[s];if(a.load&&a.test?.(t,e,this)){n=await a.load(t,e,this),r.parser=a;break}}if(!r.parser)return null;for(let s=0;s<this.parsers.length;s++){const a=this.parsers[s];a.parse&&a.parse&&await a.testParse?.(n,e,this)&&(n=await a.parse(n,e,this)||n,r.parser=a)}return n})(),r}async load(t,e){let r=0;const n={},s=yc(t),a=Zn(t,d=>({src:d})),o=a.length,u=a.map(async d=>{const m=qi.toAbsolute(d.src);if(!n[d.src])try{this.promiseCache[m]||(this.promiseCache[m]=this._getLoadPromiseAndParser(m,d)),n[d.src]=await this.promiseCache[m].promise,e&&e(++r/o)}catch(l){throw delete this.promiseCache[m],delete n[d.src],new Error(`[Loader.load] Failed to load ${m}.
${l}`)}});return await Promise.all(u),s?n[a[0].src]:n}async unload(t){const r=Zn(t,n=>({src:n})).map(async n=>{const s=qi.toAbsolute(n.src),a=this.promiseCache[s];if(a){const o=await a.promise;a.parser?.unload?.(o,n,this),delete this.promiseCache[s]}});await Promise.all(r)}get parsers(){return this._parsers}}class yI{constructor(){this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}addManifest(t){this._manifest,this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach(n=>{typeof n.name=="string"?r.push(n.name):r.push(...n.name),this.add(n.name,n.srcs)}):Object.keys(e).forEach(n=>{r.push(n),this.add(n,e[n])}),this._bundles[t]=r}add(t,e,r){const n=Zn(t);n.forEach(a=>{this._assetMap[a]}),Array.isArray(e)||(typeof e=="string"?e=pI(e):e=[e]);const s=e.map(a=>{let o=a;if(typeof a=="string"){let u=!1;for(let d=0;d<this._parsers.length;d++){const m=this._parsers[d];if(m.test(a)){o=m.parse(a),u=!0;break}}u||(o={src:a})}return o.format||(o.format=o.src.split(".").pop()),o.alias||(o.alias=n),(this._basePath||this._rootPath)&&(o.src=qi.toAbsolute(o.src,this._basePath,this._rootPath)),o.data=o.data??r,o});n.forEach(a=>{this._assetMap[a]=s})}resolveBundle(t){const e=yc(t);t=Zn(t);const r={};return t.forEach(n=>{const s=this._bundles[n];s&&(r[n]=this.resolve(s))}),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const r={};for(const n in e)r[n]=e[n].src;return r}return e.src}resolve(t){const e=yc(t);t=Zn(t);const r={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const a=this._getPreferredOrder(s),o=s[0];a?.priority.forEach(u=>{a.params[u].forEach(d=>{const m=s.filter(l=>l[u]?l[u]===d:!1);m.length&&(s=m)})}),this._resolverHash[n]=s[0]??o}else{let s=n;(this._basePath||this._rootPath)&&(s=qi.toAbsolute(s,this._basePath,this._rootPath)),this._resolverHash[n]={src:s}}r[n]=this._resolverHash[n]}),e?r[t[0]]:r}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const r=t[0],n=this._preferredOrder.find(s=>s.params.format.includes(r.format));if(n)return n}return this._preferredOrder[0]}}class vI{constructor(){this._detections=[],this._initialized=!1,this.resolver=new yI,this.loader=new gI,this.cache=fh,this._backgroundLoader=new fI(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return;if(this._initialized=!0,t.basePath&&(this.resolver.basePath=t.basePath),t.manifest){let s=t.manifest;typeof s=="string"&&(s=await this.load(s)),this.resolver.addManifest(s)}const e=t.texturePreference?.resolution??1,r=typeof e=="number"?[e]:e;let n=[];if(t.texturePreference?.format){const s=t.texturePreference?.format;n=typeof s=="string"?[s]:s;for(const a of this._detections)await a.test()||(n=await a.remove(n))}else for(const s of this._detections)await s.test()&&(n=await s.add(n));this.resolver.prefer({params:{format:n,resolution:r}})}add(t,e,r){this.resolver.add(t,e,r)}async load(t,e){this._initialized||await this.init();const r=yc(t),n=Zn(t).map(o=>typeof o!="string"?(this.resolver.add(o.src,o),o.src):o),s=this.resolver.resolve(n),a=await this._mapLoadToResolve(s,e);return r?a[n[0]]:a}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},a=Object.keys(n);let o=0,u=0;const d=()=>{e?.(++o/u)},m=a.map(l=>{const f=n[l];return u+=Object.keys(f).length,this._mapLoadToResolve(f,d).then(p=>{s[l]=p})});return await Promise.all(m),r?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return fh.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=fh.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(r,e);this._backgroundLoader.active=!0;const a={};return r.forEach((o,u)=>{const d=s[o.src],m=[o.src];o.alias&&m.push(...o.alias),a[n[u]]=d,fh.set(m,d)}),a}async unload(t){this._initialized||await this.init();const e=Zn(t).map(n=>typeof n!="string"?n.src:n),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=Zn(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(r=>{fh.remove(r.src)}),await this.loader.unload(e)}get detections(){return this._detections}}const oo=new vI;le.handleByList(Jt.LoadParser,oo.loader.parsers).handleByList(Jt.ResolveParser,oo.resolver.parsers).handleByList(Jt.CacheParser,oo.cache.parsers).handleByList(Jt.DetectionParser,oo.detections);const Eg={loader:Jt.LoadParser,resolver:Jt.ResolveParser,cache:Jt.CacheParser,detection:Jt.DetectionParser};le.handle(Jt.Asset,i=>{const t=i.ref;Object.entries(Eg).filter(([e])=>!!t[e]).forEach(([e,r])=>le.add(Object.assign(t[e],{extension:t[e].extension??r})))},i=>{const t=i.ref;Object.keys(Eg).filter(e=>!!t[e]).forEach(e=>le.remove(t[e]))});const _I={extension:Jt.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof Ht),getCacheableAssets:(i,t)=>{const e={};return i.forEach(r=>{t.forEach((n,s)=>{e[r+(s===0?"":s+1)]=n})}),e}};le.add(_I);var En=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(En||{});const wI={extension:{type:Jt.LoadParser,priority:En.Low},test(i){return qi.extname(i).includes(".json")},async load(i){return await(await Xt.ADAPTER.fetch(i)).json()}};le.add(wI);const bI={extension:{type:Jt.LoadParser,priority:En.Low},test(i){return qi.extname(i).includes(".txt")},async load(i){return await(await Xt.ADAPTER.fetch(i)).text()}};le.add(bI);const xI=["normal","bold","100","200","300","400","500","600","700","800","900"],AI=["woff","woff2","ttf","otf"];function EI(i){const t=qi.extname(i);return qi.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ")}const TI={extension:{type:Jt.LoadParser,priority:En.Low},test(i){const e=i.split("?")[0].split(".").pop();return AI.includes(e)},async load(i,t){if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const e=Xt.ADAPTER.getFontFaceSet();if(e){const r=[],n=t.data?.family??EI(i),s=t.data?.weights?.filter(o=>xI.includes(o))??["normal"],a=t.data??{};for(let o=0;o<s.length;o++){const u=s[o],d=new FontFace(n,`url(${i})`,{...a,weight:u});await d.load(),e.add(d),r.push(d)}return r.length===1?r[0]:r}return null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>Xt.ADAPTER.getFontFaceSet().delete(t))}};le.add(TI);let Tg=0,gd;const SI="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",CI={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${SI}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},MI={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let yd;class II{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([CI.code],{type:"application/javascript"})),r=new Worker(e);r.addEventListener("message",n=>{r.terminate(),URL.revokeObjectURL(e),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){gd===void 0&&(gd=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<gd&&(yd||(yd=URL.createObjectURL(new Blob([MI.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(yd),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise((n,s)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:s})});return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[Tg]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Tg++,id:r})}}const Sg=new II;function bf(i,t){const e=i.split("?")[0],r=qi.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r.toLowerCase()):r.toLowerCase()===t}function Fc(i,t,e){const r=new Ht(i);return r.baseTexture.on("dispose",()=>{delete t.promiseCache[e]}),r}const vd=[".jpg",".png",".jpeg",".avif",".webp"];async function BI(i){const t=await Xt.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const xf={extension:{type:Jt.LoadParser,priority:En.High},config:{preferWorkers:!0},test(i){let t=!1;for(let e=0;e<vd.length;e++)if(i.startsWith(`data:image/${vd[e].slice(1)}`)){t=!0;break}return t||bf(i,vd)},async load(i,t,e){let r=null;globalThis.createImageBitmap?this.config.preferWorkers&&await Sg.isImageBitmapSupported()?r=await Sg.loadImageBitmap(i):r=await BI(i):r=await new Promise(s=>{r=new Image,r.crossOrigin="anonymous",r.src=i,r.complete?s(r):r.onload=()=>{s(r)}});const n=new Pe(r,{resolution:Rs(i),...t.data});return n.resource.src=i,Fc(n,e,i)},unload(i){i.destroy(!0)}};le.add(xf);Jt.LoadParser,En.High,xf.unload;const kI={extension:Jt.ResolveParser,test:xf.test,parse:i=>({resolution:parseFloat(Xt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:i.split(".").pop(),src:i})};le.add(kI);const RI={extension:{type:Jt.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await Xt.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};le.add(RI);const PI={extension:{type:Jt.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await Xt.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};le.add(PI);const Cg=["png","jpg","jpeg"],DI={extension:{type:Jt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...Cg],remove:async i=>i.filter(t=>!Cg.includes(t))};le.add(DI);var Cr=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i))(Cr||{});const vc={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};class LI extends kh{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,n;typeof t=="string"?(r=t,n=new Uint8Array):(r=null,n=t),super(n,e),this.origin=r,this.buffer=n?new Jd(n):null,this.origin&&e.autoLoad!==!1&&this.load(),n?.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const r=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(r),this.buffer=new Jd(r),this.loaded=!0,this.onBlobLoaded(r),this.update(),this}}class da extends LI{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=da._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||da._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let a=0,o=this.levels;a<o;a++){const{levelID:u,levelWidth:d,levelHeight:m,levelBuffer:l}=this._levelBuffers[a];n.compressedTexImage2D(n.TEXTURE_2D,u,this.format,d,m,0,l)}return!0}onBlobLoaded(){this._levelBuffers=da._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,r,n,s,a,o){const u=new Array(r);let d=t.byteOffset,m=a,l=o,f=m+n-1&~(n-1),p=l+s-1&~(s-1),y=f*p*vc[e];for(let v=0;v<r;v++)u[v]={levelID:v,levelWidth:r>1?m:f,levelHeight:r>1?l:p,levelBuffer:new Uint8Array(t.buffer,d,y)},d+=y,m=m>>1||1,l=l>>1||1,f=m+n-1&~(n-1),p=l+s-1&~(s-1),y=f*p*vc[e];return u}}let Xn,ro;function Mg(){ro={s3tc:Xn.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Xn.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Xn.getExtension("WEBGL_compressed_texture_etc"),etc1:Xn.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Xn.getExtension("WEBGL_compressed_texture_pvrtc")||Xn.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Xn.getExtension("WEBGL_compressed_texture_atc"),astc:Xn.getExtension("WEBGL_compressed_texture_astc")}}const OI={extension:{type:Jt.DetectionParser,priority:2},test:async()=>{const t=Xt.ADAPTER.createCanvas().getContext("webgl");return t?(Xn=t,!0):!1},add:async i=>{ro||Mg();const t=[];for(const e in ro)!ro[e]||t.push(e);return[...t,...i]},remove:async i=>(ro||Mg(),i.filter(t=>!(t in ro)))};le.add(OI);const _d=4,Ul=124,FI=32,Ig=20,NI=542327876,Hl={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},UI={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Gl={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},HI=1,GI=2,WI=4,zI=64,VI=512,XI=131072,jI=827611204,YI=861165636,KI=894720068,qI=808540228,$I=4,ZI={[jI]:Cr.COMPRESSED_RGBA_S3TC_DXT1_EXT,[YI]:Cr.COMPRESSED_RGBA_S3TC_DXT3_EXT,[KI]:Cr.COMPRESSED_RGBA_S3TC_DXT5_EXT},QI={[70]:Cr.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:Cr.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:Cr.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:Cr.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:Cr.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:Cr.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:Cr.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:Cr.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:Cr.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function JI(i){const t=new Uint32Array(i);if(t[0]!==NI)throw new Error("Invalid DDS file magic word");const r=new Uint32Array(i,0,Ul/Uint32Array.BYTES_PER_ELEMENT),n=r[Hl.HEIGHT],s=r[Hl.WIDTH],a=r[Hl.MIPMAP_COUNT],o=new Uint32Array(i,Hl.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,FI/Uint32Array.BYTES_PER_ELEMENT),u=o[HI];if(u&WI){const d=o[UI.FOURCC];if(d!==qI){const E=ZI[d],R=_d+Ul,H=new Uint8Array(i,R);return[new da(H,{format:E,width:s,height:n,levels:a})]}const m=_d+Ul,l=new Uint32Array(t.buffer,m,Ig/Uint32Array.BYTES_PER_ELEMENT),f=l[Gl.DXGI_FORMAT],p=l[Gl.RESOURCE_DIMENSION],y=l[Gl.MISC_FLAG],v=l[Gl.ARRAY_SIZE],_=QI[f];if(_===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${f}`);if(y===$I)throw new Error("DDSParser does not support cubemap textures");if(p===6)throw new Error("DDSParser does not supported 3D texture data");const w=new Array,T=_d+Ul+Ig;if(v===1)w.push(new Uint8Array(i,T));else{const E=vc[_];let R=0,H=s,Y=n;for(let et=0;et<a;et++){const J=Math.max(1,H+3&-4),rt=Math.max(1,Y+3&-4),gt=J*rt*E;R+=gt,H=H>>>1,Y=Y>>>1}let j=T;for(let et=0;et<v;et++)w.push(new Uint8Array(i,j,R)),j+=R}return w.map(E=>new da(E,{format:_,width:s,height:n,levels:a}))}throw u&zI?new Error("DDSParser does not support uncompressed texture data."):u&VI?new Error("DDSParser does not supported YUV uncompressed texture data."):u&XI?new Error("DDSParser does not support single-channel (lumninance) texture data!"):u&GI?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Bg=[171,75,84,88,32,49,49,187,13,10,26,10],t2=67305985,$r={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},rf=64,kg={[de.UNSIGNED_BYTE]:1,[de.UNSIGNED_SHORT]:2,[de.INT]:4,[de.UNSIGNED_INT]:4,[de.FLOAT]:4,[de.HALF_FLOAT]:8},e2={[Yt.RGBA]:4,[Yt.RGB]:3,[Yt.RG]:2,[Yt.RED]:1,[Yt.LUMINANCE]:1,[Yt.LUMINANCE_ALPHA]:2,[Yt.ALPHA]:1},i2={[de.UNSIGNED_SHORT_4_4_4_4]:2,[de.UNSIGNED_SHORT_5_5_5_1]:2,[de.UNSIGNED_SHORT_5_6_5]:2};function r2(i,t,e=!1){const r=new DataView(t);if(!n2(i,r))return null;const n=r.getUint32($r.ENDIANNESS,!0)===t2,s=r.getUint32($r.GL_TYPE,n),a=r.getUint32($r.GL_FORMAT,n),o=r.getUint32($r.GL_INTERNAL_FORMAT,n),u=r.getUint32($r.PIXEL_WIDTH,n),d=r.getUint32($r.PIXEL_HEIGHT,n)||1,m=r.getUint32($r.PIXEL_DEPTH,n)||1,l=r.getUint32($r.NUMBER_OF_ARRAY_ELEMENTS,n)||1,f=r.getUint32($r.NUMBER_OF_FACES,n),p=r.getUint32($r.NUMBER_OF_MIPMAP_LEVELS,n),y=r.getUint32($r.BYTES_OF_KEY_VALUE_DATA,n);if(d===0||m!==1)throw new Error("Only 2D textures are supported");if(f!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(l!==1)throw new Error("WebGL does not support array textures");const v=4,_=4,w=u+3&-4,T=d+3&-4,E=new Array(l);let R=u*d;s===0&&(R=w*T);let H;if(s!==0?kg[s]?H=kg[s]*e2[a]:H=i2[s]:H=vc[o],H===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const Y=e?a2(r,y,n):null;let et=R*H,J=u,rt=d,gt=w,X=T,Q=rf+y;for(let S=0;S<p;S++){const ut=r.getUint32(Q,n);let Pt=Q+4;for(let pt=0;pt<l;pt++){let Wt=E[pt];Wt||(Wt=E[pt]=new Array(p)),Wt[S]={levelID:S,levelWidth:p>1||s!==0?J:gt,levelHeight:p>1||s!==0?rt:X,levelBuffer:new Uint8Array(t,Pt,et)},Pt+=et}Q+=ut+4,Q=Q%4!==0?Q+4-Q%4:Q,J=J>>1||1,rt=rt>>1||1,gt=J+v-1&~(v-1),X=rt+_-1&~(_-1),et=gt*X*H}return s!==0?{uncompressed:E.map(S=>{let ut=S[0].levelBuffer,Pt=!1;return s===de.FLOAT?ut=new Float32Array(S[0].levelBuffer.buffer,S[0].levelBuffer.byteOffset,S[0].levelBuffer.byteLength/4):s===de.UNSIGNED_INT?(Pt=!0,ut=new Uint32Array(S[0].levelBuffer.buffer,S[0].levelBuffer.byteOffset,S[0].levelBuffer.byteLength/4)):s===de.INT&&(Pt=!0,ut=new Int32Array(S[0].levelBuffer.buffer,S[0].levelBuffer.byteOffset,S[0].levelBuffer.byteLength/4)),{resource:new kh(ut,{width:S[0].levelWidth,height:S[0].levelHeight}),type:s,format:Pt?s2(a):a}}),kvData:Y}:{compressed:E.map(S=>new da(null,{format:o,width:u,height:d,levels:p,levelBuffers:S})),kvData:Y}}function n2(i,t){for(let e=0;e<Bg.length;e++)if(t.getUint8(e)!==Bg[e])return!1;return!0}function s2(i){switch(i){case Yt.RGBA:return Yt.RGBA_INTEGER;case Yt.RGB:return Yt.RGB_INTEGER;case Yt.RG:return Yt.RG_INTEGER;case Yt.RED:return Yt.RED_INTEGER;default:return i}}function a2(i,t,e){const r=new Map;let n=0;for(;n<t;){const s=i.getUint32(rf+n,e),a=rf+n+4,o=3-(s+3)%4;if(s===0||s>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let u=0;for(;u<s&&i.getUint8(a+u)!==0;u++);if(u===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const d=new TextDecoder().decode(new Uint8Array(i.buffer,a,u)),m=new DataView(i.buffer,a+u+1,s-u-1);r.set(d,m),n+=4+s+o}return r}const o2={extension:{type:Jt.LoadParser,priority:En.High},test(i){return bf(i,".dds")},async load(i,t,e){const n=await(await Xt.ADAPTER.fetch(i)).arrayBuffer(),a=JI(n).map(o=>{const u=new Pe(o,{mipmap:xn.OFF,alphaMode:an.NO_PREMULTIPLIED_ALPHA,resolution:Rs(i),...t.data});return Fc(u,e,i)});return a.length===1?a[0]:a},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};le.add(o2);const h2={extension:{type:Jt.LoadParser,priority:En.High},test(i){return bf(i,".ktx")},async load(i,t,e){const n=await(await Xt.ADAPTER.fetch(i)).arrayBuffer(),{compressed:s,uncompressed:a,kvData:o}=r2(i,n),u=s??a,d={mipmap:xn.OFF,alphaMode:an.NO_PREMULTIPLIED_ALPHA,resolution:Rs(i),...t.data},m=u.map(l=>{u===a&&Object.assign(d,{type:l.type,format:l.format});const f=new Pe(l,d);return f.ktxKeyValueData=o,Fc(f,e,i)});return m.length===1?m[0]:m},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};le.add(h2);const l2={extension:Jt.ResolveParser,test:i=>{const e=i.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:i=>{if(i.split("?")[0].split(".").pop()==="ktx"){const r=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(r.some(n=>i.endsWith(n)))return{resolution:parseFloat(Xt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:r.find(n=>i.endsWith(n)),src:i}}return{resolution:parseFloat(Xt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:i.split(".").pop(),src:i}}};le.add(l2);const Rg=new Te,Pg=4,nf=class{constructor(i){this.renderer=i}async image(i,t,e){const r=new Image;return r.src=await this.base64(i,t,e),r}async base64(i,t,e){const r=this.canvas(i);if(r.toDataURL!==void 0)return r.toDataURL(t,e);if(r.convertToBlob!==void 0){const n=await r.convertToBlob({type:t,quality:e});return await new Promise(s=>{const a=new FileReader;a.onload=()=>s(a.result),a.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(i,t){const e=this.renderer;let r,n=!1,s,a=!1;i&&(i instanceof Di?s=i:(s=this.renderer.generateTexture(i),a=!0)),s?(r=s.baseTexture.resolution,t=t??s.frame,n=!1,e.renderTexture.bind(s)):(r=e.resolution,t||(t=Rg,t.width=e.width,t.height=e.height),n=!0,e.renderTexture.bind(null));const o=Math.round(t.width*r),u=Math.round(t.height*r);let d=new cg(o,u,1);const m=new Uint8Array(Pg*o*u),l=e.gl;l.readPixels(Math.round(t.x*r),Math.round(t.y*r),o,u,l.RGBA,l.UNSIGNED_BYTE,m);const f=d.context.getImageData(0,0,o,u);if(nf.arrayPostDivide(m,f.data),d.context.putImageData(f,0,0),n){const p=new cg(d.width,d.height,1);p.context.scale(1,-1),p.context.drawImage(d.canvas,0,-u),d.destroy(),d=p}return a&&s.destroy(!0),d.canvas}pixels(i,t){const e=this.renderer;let r,n,s=!1;i&&(i instanceof Di?n=i:(n=this.renderer.generateTexture(i),s=!0)),n?(r=n.baseTexture.resolution,t=t??n.frame,e.renderTexture.bind(n)):(r=e.resolution,t||(t=Rg,t.width=e.width,t.height=e.height),e.renderTexture.bind(null));const a=Math.round(t.width*r),o=Math.round(t.height*r),u=new Uint8Array(Pg*a*o),d=e.gl;return d.readPixels(Math.round(t.x*r),Math.round(t.y*r),a,o,d.RGBA,d.UNSIGNED_BYTE,u),s&&n.destroy(!0),nf.arrayPostDivide(u,u),u}destroy(){this.renderer=null}static arrayPostDivide(i,t){for(let e=0;e<i.length;e+=4){const r=t[e+3]=i[e+3];r!==0?(t[e]=Math.round(Math.min(i[e]*255/r,255)),t[e+1]=Math.round(Math.min(i[e+1]*255/r,255)),t[e+2]=Math.round(Math.min(i[e+2]*255/r,255))):(t[e]=i[e],t[e+1]=i[e+1],t[e+2]=i[e+2])}}};let Ey=nf;Ey.extension={name:"extract",type:Jt.RendererSystem};le.add(Ey);var Ts=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(Ts||{}),ca=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(ca||{});const Ih={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class Nc{constructor(){this.color=16777215,this.alpha=1,this.texture=Ht.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Nc;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Ht.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}function Dg(i,t=!1){const e=i.length;if(e<6)return;let r=0;for(let n=0,s=i[e-2],a=i[e-1];n<e;n+=2){const o=i[n],u=i[n+1];r+=(o-s)*(u+a),s=o,a=u}if(!t&&r>0||t&&r<=0){const n=e/2;for(let s=n+n%2;s<e;s+=2){const a=e-s-2,o=e-s-1,u=s,d=s+1;[i[a],i[u]]=[i[u],i[a]],[i[o],i[d]]=[i[d],i[o]]}}}const Ty={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points;const r=i.holes,n=t.points,s=t.indices;if(e.length>=6){Dg(e,!1);const a=[];for(let d=0;d<r.length;d++){const m=r[d];Dg(m.points,!0),a.push(e.length/2),e=e.concat(m.points)}const o=gf.exports(e,a,2);if(!o)return;const u=n.length/2;for(let d=0;d<o.length;d+=3)s.push(o[d]+u),s.push(o[d+1]+u),s.push(o[d+2]+u);for(let d=0;d<e.length;d++)n.push(e[d])}}},_c={build(i){const t=i.points;let e,r,n,s,a,o;if(i.type===Ki.CIRC){const y=i.shape;e=y.x,r=y.y,a=o=y.radius,n=s=0}else if(i.type===Ki.ELIP){const y=i.shape;e=y.x,r=y.y,a=y.width,o=y.height,n=s=0}else{const y=i.shape,v=y.width/2,_=y.height/2;e=y.x+v,r=y.y+_,a=o=Math.max(0,Math.min(y.radius,Math.min(v,_))),n=v-a,s=_-o}if(!(a>=0&&o>=0&&n>=0&&s>=0)){t.length=0;return}const u=Math.ceil(2.3*Math.sqrt(a+o)),d=u*8+(n?4:0)+(s?4:0);if(t.length=d,d===0)return;if(u===0){t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=r+s,t[2]=t[4]=e-n,t[5]=t[7]=r-s;return}let m=0,l=u*4+(n?2:0)+2,f=l,p=d;{const y=n+a,v=s,_=e+y,w=e-y,T=r+v;if(t[m++]=_,t[m++]=T,t[--l]=T,t[--l]=w,s){const E=r-v;t[f++]=w,t[f++]=E,t[--p]=E,t[--p]=_}}for(let y=1;y<u;y++){const v=Math.PI/2*(y/u),_=n+Math.cos(v)*a,w=s+Math.sin(v)*o,T=e+_,E=e-_,R=r+w,H=r-w;t[m++]=T,t[m++]=R,t[--l]=R,t[--l]=E,t[f++]=E,t[f++]=H,t[--p]=H,t[--p]=T}{const y=n,v=s+o,_=e+y,w=e-y,T=r+v,E=r-v;t[m++]=_,t[m++]=T,t[--p]=E,t[--p]=_,n&&(t[m++]=w,t[m++]=T,t[--p]=E,t[--p]=w)}},triangulate(i,t){const e=i.points,r=t.points,n=t.indices;if(e.length===0)return;let s=r.length/2;const a=s;let o,u;if(i.type!==Ki.RREC){const m=i.shape;o=m.x,u=m.y}else{const m=i.shape;o=m.x+m.width/2,u=m.y+m.height/2}const d=i.matrix;r.push(i.matrix?d.a*o+d.c*u+d.tx:o,i.matrix?d.b*o+d.d*u+d.ty:u),s++,r.push(e[0],e[1]);for(let m=2;m<e.length;m+=2)r.push(e[m],e[m+1]),n.push(s++,a,s);n.push(a+1,a,s)}},c2={build(i){const t=i.shape,e=t.x,r=t.y,n=t.width,s=t.height,a=i.points;a.length=0,n>=0&&s>=0&&a.push(e,r,e+n,r,e+n,r+s,e,r+s)},triangulate(i,t){const e=i.points,r=t.points;if(e.length===0)return;const n=r.length/2;r.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},u2={build(i){_c.build(i)},triangulate(i,t){_c.triangulate(i,t)}};function Lg(i,t,e,r,n,s,a,o){const u=i-e*n,d=t-r*n,m=i+e*s,l=t+r*s;let f,p;a?(f=r,p=-e):(f=-r,p=e);const y=u+f,v=d+p,_=m+f,w=l+p;return o.push(y,v),o.push(_,w),2}function Js(i,t,e,r,n,s,a,o){const u=e-i,d=r-t;let m=Math.atan2(u,d),l=Math.atan2(n-i,s-t);o&&m<l?m+=Math.PI*2:!o&&m>l&&(l+=Math.PI*2);let f=m;const p=l-m,y=Math.abs(p),v=Math.sqrt(u*u+d*d),_=(15*y*Math.sqrt(v)/Math.PI>>0)+1,w=p/_;if(f+=w,o){a.push(i,t),a.push(e,r);for(let T=1,E=f;T<_;T++,E+=w)a.push(i,t),a.push(i+Math.sin(E)*v,t+Math.cos(E)*v);a.push(i,t),a.push(n,s)}else{a.push(e,r),a.push(i,t);for(let T=1,E=f;T<_;T++,E+=w)a.push(i+Math.sin(E)*v,t+Math.cos(E)*v),a.push(i,t);a.push(n,s),a.push(i,t)}return _*2}function d2(i,t){const e=i.shape;let r=i.points||e.points.slice();const n=t.closePointEps;if(r.length===0)return;const s=i.lineStyle,a=new He(r[0],r[1]),o=new He(r[r.length-2],r[r.length-1]),u=e.type!==Ki.POLY||e.closeStroke,d=Math.abs(a.x-o.x)<n&&Math.abs(a.y-o.y)<n;if(u){r=r.slice(),d&&(r.pop(),r.pop(),o.set(r[r.length-2],r[r.length-1]));const pt=(a.x+o.x)*.5,Wt=(o.y+a.y)*.5;r.unshift(pt,Wt),r.push(pt,Wt)}const m=t.points,l=r.length/2;let f=r.length;const p=m.length/2,y=s.width/2,v=y*y,_=s.miterLimit*s.miterLimit;let w=r[0],T=r[1],E=r[2],R=r[3],H=0,Y=0,j=-(T-R),et=w-E,J=0,rt=0,gt=Math.sqrt(j*j+et*et);j/=gt,et/=gt,j*=y,et*=y;const X=s.alignment,Q=(1-X)*2,S=X*2;u||(s.cap===ca.ROUND?f+=Js(w-j*(Q-S)*.5,T-et*(Q-S)*.5,w-j*Q,T-et*Q,w+j*S,T+et*S,m,!0)+2:s.cap===ca.SQUARE&&(f+=Lg(w,T,j,et,Q,S,!0,m))),m.push(w-j*Q,T-et*Q),m.push(w+j*S,T+et*S);for(let pt=1;pt<l-1;++pt){w=r[(pt-1)*2],T=r[(pt-1)*2+1],E=r[pt*2],R=r[pt*2+1],H=r[(pt+1)*2],Y=r[(pt+1)*2+1],j=-(T-R),et=w-E,gt=Math.sqrt(j*j+et*et),j/=gt,et/=gt,j*=y,et*=y,J=-(R-Y),rt=E-H,gt=Math.sqrt(J*J+rt*rt),J/=gt,rt/=gt,J*=y,rt*=y;const Wt=E-w,bt=T-R,xt=E-H,tt=Y-R,it=Wt*xt+bt*tt,Gt=bt*xt-tt*Wt,Dt=Gt<0;if(Math.abs(Gt)<.001*Math.abs(it)){m.push(E-j*Q,R-et*Q),m.push(E+j*S,R+et*S),it>=0&&(s.join===Ts.ROUND?f+=Js(E,R,E-j*Q,R-et*Q,E-J*Q,R-rt*Q,m,!1)+4:f+=2,m.push(E-J*S,R-rt*S),m.push(E+J*Q,R+rt*Q));continue}const Mt=(-j+w)*(-et+R)-(-j+E)*(-et+T),te=(-J+H)*(-rt+R)-(-J+E)*(-rt+Y),re=(Wt*te-xt*Mt)/Gt,jt=(tt*Mt-bt*te)/Gt,qt=(re-E)*(re-E)+(jt-R)*(jt-R),ce=E+(re-E)*Q,ne=R+(jt-R)*Q,_e=E-(re-E)*S,pe=R-(jt-R)*S,C=Math.min(Wt*Wt+bt*bt,xt*xt+tt*tt),At=Dt?Q:S,vt=C+At*At*v;qt<=vt?s.join===Ts.BEVEL||qt/v>_?(Dt?(m.push(ce,ne),m.push(E+j*S,R+et*S),m.push(ce,ne),m.push(E+J*S,R+rt*S)):(m.push(E-j*Q,R-et*Q),m.push(_e,pe),m.push(E-J*Q,R-rt*Q),m.push(_e,pe)),f+=2):s.join===Ts.ROUND?Dt?(m.push(ce,ne),m.push(E+j*S,R+et*S),f+=Js(E,R,E+j*S,R+et*S,E+J*S,R+rt*S,m,!0)+4,m.push(ce,ne),m.push(E+J*S,R+rt*S)):(m.push(E-j*Q,R-et*Q),m.push(_e,pe),f+=Js(E,R,E-j*Q,R-et*Q,E-J*Q,R-rt*Q,m,!1)+4,m.push(E-J*Q,R-rt*Q),m.push(_e,pe)):(m.push(ce,ne),m.push(_e,pe)):(m.push(E-j*Q,R-et*Q),m.push(E+j*S,R+et*S),s.join===Ts.ROUND?Dt?f+=Js(E,R,E+j*S,R+et*S,E+J*S,R+rt*S,m,!0)+2:f+=Js(E,R,E-j*Q,R-et*Q,E-J*Q,R-rt*Q,m,!1)+2:s.join===Ts.MITER&&qt/v<=_&&(Dt?(m.push(_e,pe),m.push(_e,pe)):(m.push(ce,ne),m.push(ce,ne)),f+=2),m.push(E-J*Q,R-rt*Q),m.push(E+J*S,R+rt*S),f+=2)}w=r[(l-2)*2],T=r[(l-2)*2+1],E=r[(l-1)*2],R=r[(l-1)*2+1],j=-(T-R),et=w-E,gt=Math.sqrt(j*j+et*et),j/=gt,et/=gt,j*=y,et*=y,m.push(E-j*Q,R-et*Q),m.push(E+j*S,R+et*S),u||(s.cap===ca.ROUND?f+=Js(E-j*(Q-S)*.5,R-et*(Q-S)*.5,E-j*Q,R-et*Q,E+j*S,R+et*S,m,!1)+2:s.cap===ca.SQUARE&&(f+=Lg(E,R,j,et,Q,S,!1,m)));const ut=t.indices,Pt=Ih.epsilon*Ih.epsilon;for(let pt=p;pt<f+p-2;++pt)w=m[pt*2],T=m[pt*2+1],E=m[(pt+1)*2],R=m[(pt+1)*2+1],H=m[(pt+2)*2],Y=m[(pt+2)*2+1],!(Math.abs(w*(R-Y)+E*(Y-T)+H*(T-R))<Pt)&&ut.push(pt,pt+1,pt+2)}function f2(i,t){let e=0;const r=i.shape,n=i.points||r.points,s=r.type!==Ki.POLY||r.closeStroke;if(n.length===0)return;const a=t.points,o=t.indices,u=n.length/2,d=a.length/2;let m=d;for(a.push(n[0],n[1]),e=1;e<u;e++)a.push(n[e*2],n[e*2+1]),o.push(m,m+1),m++;s&&o.push(m,d)}function Og(i,t){i.lineStyle.native?f2(i,t):d2(i,t)}class Fg{static curveTo(t,e,r,n,s,a){const o=a[a.length-2],d=a[a.length-1]-e,m=o-t,l=n-e,f=r-t,p=Math.abs(d*f-m*l);if(p<1e-8||s===0)return(a[a.length-2]!==t||a[a.length-1]!==e)&&a.push(t,e),null;const y=d*d+m*m,v=l*l+f*f,_=d*l+m*f,w=s*Math.sqrt(y)/p,T=s*Math.sqrt(v)/p,E=w*_/y,R=T*_/v,H=w*f+T*m,Y=w*l+T*d,j=m*(T+E),et=d*(T+E),J=f*(w+R),rt=l*(w+R),gt=Math.atan2(et-Y,j-H),X=Math.atan2(rt-Y,J-H);return{cx:H+t,cy:Y+e,radius:s,startAngle:gt,endAngle:X,anticlockwise:m*l>f*d}}static arc(t,e,r,n,s,a,o,u,d){const m=o-a,l=Ih._segmentsCount(Math.abs(m)*s,Math.ceil(Math.abs(m)/dc)*40),f=m/(l*2),p=f*2,y=Math.cos(f),v=Math.sin(f),_=l-1,w=_%1/_;for(let T=0;T<=_;++T){const E=T+w*T,R=f+a+p*E,H=Math.cos(R),Y=-Math.sin(R);d.push((y*H+v*Y)*s+r,(y*-Y+v*H)*s+n)}}}class Af{static curveLength(t,e,r,n,s,a,o,u){let m=0,l=0,f=0,p=0,y=0,v=0,_=0,w=0,T=0,E=0,R=0,H=t,Y=e;for(let j=1;j<=10;++j)l=j/10,f=l*l,p=f*l,y=1-l,v=y*y,_=v*y,w=_*t+3*v*l*r+3*y*f*s+p*o,T=_*e+3*v*l*n+3*y*f*a+p*u,E=H-w,R=Y-T,H=w,Y=T,m+=Math.sqrt(E*E+R*R);return m}static curveTo(t,e,r,n,s,a,o){const u=o[o.length-2],d=o[o.length-1];o.length-=2;const m=Ih._segmentsCount(Af.curveLength(u,d,t,e,r,n,s,a));let l=0,f=0,p=0,y=0,v=0;o.push(u,d);for(let _=1,w=0;_<=m;++_)w=_/m,l=1-w,f=l*l,p=f*l,y=w*w,v=y*w,o.push(p*u+3*f*w*t+3*l*y*r+v*s,p*d+3*f*w*e+3*l*y*n+v*a)}}class Ef{static curveLength(t,e,r,n,s,a){const o=t-2*r+s,u=e-2*n+a,d=2*r-2*t,m=2*n-2*e,l=4*(o*o+u*u),f=4*(o*d+u*m),p=d*d+m*m,y=2*Math.sqrt(l+f+p),v=Math.sqrt(l),_=2*l*v,w=2*Math.sqrt(p),T=f/v;return(_*y+v*f*(y-w)+(4*p*l-f*f)*Math.log((2*v+T+y)/(T+w)))/(4*_)}static curveTo(t,e,r,n,s){const a=s[s.length-2],o=s[s.length-1],u=Ih._segmentsCount(Ef.curveLength(a,o,t,e,r,n));let d=0,m=0;for(let l=1;l<=u;++l){const f=l/u;d=a+(t-a)*f,m=o+(e-o)*f,s.push(d+(t+(r-t)*f-d)*f,m+(e+(n-e)*f-m)*f)}}}class p2{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const wd={[Ki.POLY]:Ty,[Ki.CIRC]:_c,[Ki.ELIP]:_c,[Ki.RECT]:c2,[Ki.RREC]:u2},Ng=[],Wl=[];class wc{constructor(t,e=null,r=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new wc(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Za=new He,Sy=class extends py{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new mc,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),Wl.push(this.drawCalls[i]);this.drawCalls.length=0;for(let i=0;i<this.batches.length;i++){const t=this.batches[i];t.reset(),Ng.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(i,t=null,e=null,r=null){const n=new wc(i,t,e,r);return this.graphicsData.push(n),this.dirty++,this}drawHole(i,t=null){if(!this.graphicsData.length)return null;const e=new wc(i,null,null,t),r=this.graphicsData[this.graphicsData.length-1];return e.lineStyle=r.lineStyle,r.holes.push(e),this.dirty++,this}destroy(){super.destroy();for(let i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(i){const t=this.graphicsData;for(let e=0;e<t.length;++e){const r=t[e];if(!!r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(i,Za):Za.copyFrom(i),r.shape.contains(Za.x,Za.y))){let n=!1;if(r.holes){for(let s=0;s<r.holes.length;s++)if(r.holes[s].shape.contains(Za.x,Za.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const i=this.uvs,t=this.graphicsData;let e=null,r=null;this.batches.length>0&&(e=this.batches[this.batches.length-1],r=e.style);for(let o=this.shapeIndex;o<t.length;o++){this.shapeIndex++;const u=t[o],d=u.fillStyle,m=u.lineStyle;wd[u.type].build(u),u.matrix&&this.transformPoints(u.points,u.matrix),(d.visible||m.visible)&&this.processHoles(u.holes);for(let f=0;f<2;f++){const p=f===0?d:m;if(!p.visible)continue;const y=p.texture.baseTexture,v=this.indices.length,_=this.points.length/2;y.wrapMode=Bs.REPEAT,f===0?this.processFill(u):this.processLine(u);const w=this.points.length/2-_;w!==0&&(e&&!this._compareStyles(r,p)&&(e.end(v,_),e=null),e||(e=Ng.pop()||new p2,e.begin(p,v,_),this.batches.push(e),r=p),this.addUvs(this.points,i,p.texture,_,w,p.matrix))}}const n=this.indices.length,s=this.points.length/2;if(e&&e.end(n,s),this.batches.length===0){this.batchable=!0;return}const a=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(i,t){return!(!i||!t||i.texture.baseTexture!==t.texture.baseTexture||i.color+i.alpha!==t.color+t.alpha||!!i.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let i=0,t=this.graphicsData.length;i<t;i++){const e=this.graphicsData[i],r=e.fillStyle,n=e.lineStyle;if(r&&!r.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const i=this.batches;for(let t=0,e=i.length;t<e;t++){const r=i[t];for(let n=0;n<r.size;n++){const s=r.start+n;this.indicesUint16[s]=this.indicesUint16[s]-r.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const i=this.batches;for(let t=0;t<i.length;t++)if(i[t].style.native)return!1;return this.points.length<Sy.BATCHABLE_SIZE*2}buildDrawCalls(){let i=++Pe._globalBatch;for(let m=0;m<this.drawCalls.length;m++)this.drawCalls[m].texArray.clear(),Wl.push(this.drawCalls[m]);this.drawCalls.length=0;const t=this.colors,e=this.textureIds;let r=Wl.pop();r||(r=new Zd,r.texArray=new Qd),r.texArray.count=0,r.start=0,r.size=0,r.type=vn.TRIANGLES;let n=0,s=null,a=0,o=!1,u=vn.TRIANGLES,d=0;this.drawCalls.push(r);for(let m=0;m<this.batches.length;m++){const l=this.batches[m],f=8,p=l.style,y=p.texture.baseTexture;o!==!!p.native&&(o=!!p.native,u=o?vn.LINES:vn.TRIANGLES,s=null,n=f,i++),s!==y&&(s=y,y._batchEnabled!==i&&(n===f&&(i++,n=0,r.size>0&&(r=Wl.pop(),r||(r=new Zd,r.texArray=new Qd),this.drawCalls.push(r)),r.start=d,r.size=0,r.texArray.count=0,r.type=u),y.touched=1,y._batchEnabled=i,y._batchLocation=n,y.wrapMode=Bs.REPEAT,r.texArray.elements[r.texArray.count++]=y,n++)),r.size+=l.size,d+=l.size,a=y._batchLocation,this.addColors(t,p.color,p.alpha,l.attribSize,l.attribStart),this.addTextureIds(e,a,l.attribSize,l.attribStart)}Pe._globalBatch=i,this.packAttributes()}packAttributes(){const i=this.points,t=this.uvs,e=this.colors,r=this.textureIds,n=new ArrayBuffer(i.length*3*4),s=new Float32Array(n),a=new Uint32Array(n);let o=0;for(let u=0;u<i.length/2;u++)s[o++]=i[u*2],s[o++]=i[u*2+1],s[o++]=t[u*2],s[o++]=t[u*2+1],a[o++]=e[u],s[o++]=r[u];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(i){i.holes.length?Ty.triangulate(i,this):wd[i.type].triangulate(i,this)}processLine(i){Og(i,this);for(let t=0;t<i.holes.length;t++)Og(i.holes[t],this)}processHoles(i){for(let t=0;t<i.length;t++){const e=i[t];wd[e.type].build(e),e.matrix&&this.transformPoints(e.points,e.matrix)}}calculateBounds(){const i=this._bounds;i.clear(),i.addVertexData(this.points,0,this.points.length),i.pad(this.boundsPadding,this.boundsPadding)}transformPoints(i,t){for(let e=0;e<i.length/2;e++){const r=i[e*2],n=i[e*2+1];i[e*2]=t.a*r+t.c*n+t.tx,i[e*2+1]=t.b*r+t.d*n+t.ty}}addColors(i,t,e,r,n=0){const s=(t>>16)+(t&65280)+((t&255)<<16),a=vf(s,e);i.length=Math.max(i.length,n+r);for(let o=0;o<r;o++)i[n+o]=a}addTextureIds(i,t,e,r=0){i.length=Math.max(i.length,r+e);for(let n=0;n<e;n++)i[r+n]=t}addUvs(i,t,e,r,n,s=null){let a=0;const o=t.length,u=e.frame;for(;a<n;){let m=i[(r+a)*2],l=i[(r+a)*2+1];if(s){const f=s.a*m+s.c*l+s.tx;l=s.b*m+s.d*l+s.ty,m=f}a++,t.push(m/u.width,l/u.height)}const d=e.baseTexture;(u.width<d.width||u.height<d.height)&&this.adjustUvs(t,e,o,n)}adjustUvs(i,t,e,r){const n=t.baseTexture,s=1e-6,a=e+r*2,o=t.frame,u=o.width/n.width,d=o.height/n.height;let m=o.x/o.width,l=o.y/o.height,f=Math.floor(i[e]+s),p=Math.floor(i[e+1]+s);for(let y=e+2;y<a;y+=2)f=Math.min(f,Math.floor(i[y]+s)),p=Math.min(p,Math.floor(i[y+1]+s));m-=f,l-=p;for(let y=e;y<a;y+=2)i[y]=(i[y]+m)*u,i[y+1]=(i[y+1]+l)*d}};let Cy=Sy;Cy.BATCHABLE_SIZE=100;class Tf extends Nc{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ca.BUTT,this.join=Ts.MITER,this.miterLimit=10}clone(){const t=new Tf;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const m2=new Float32Array(3),bd={},oc=class extends be{constructor(i=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Nc,this._lineStyle=new Tf,this._matrix=null,this._holeMode=!1,this.state=rs.for2d(),this._geometry=i||new Cy,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=ue.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new oc(this._geometry)}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(i){this._tint=i}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(i=null,t=0,e=1,r=.5,n=!1){return typeof i=="number"&&(i={width:i,color:t,alpha:e,alignment:r,native:n}),this.lineTextureStyle(i)}lineTextureStyle(i){i=Object.assign({width:0,texture:Ht.WHITE,color:i?.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:ca.BUTT,join:Ts.MITER,miterLimit:10},i),this.currentPath&&this.startPoly();const t=i.width>0&&i.alpha>0;return t?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._lineStyle,{visible:t},i)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const i=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new mo,this.currentPath.closeStroke=!1,this.currentPath.points.push(i[t-2],i[t-1]))}else this.currentPath=new mo,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(i,t){return this.startPoly(),this.currentPath.points[0]=i,this.currentPath.points[1]=t,this}lineTo(i,t){this.currentPath||this.moveTo(0,0);const e=this.currentPath.points,r=e[e.length-2],n=e[e.length-1];return(r!==i||n!==t)&&e.push(i,t),this}_initCurve(i=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[i,t]):this.moveTo(i,t)}quadraticCurveTo(i,t,e,r){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),Ef.curveTo(i,t,e,r,n),this}bezierCurveTo(i,t,e,r,n,s){return this._initCurve(),Af.curveTo(i,t,e,r,n,s,this.currentPath.points),this}arcTo(i,t,e,r,n){this._initCurve(i,t);const s=this.currentPath.points,a=Fg.curveTo(i,t,e,r,n,s);if(a){const{cx:o,cy:u,radius:d,startAngle:m,endAngle:l,anticlockwise:f}=a;this.arc(o,u,d,m,l,f)}return this}arc(i,t,e,r,n,s=!1){if(r===n)return this;if(!s&&n<=r?n+=dc:s&&r<=n&&(r+=dc),n-r===0)return this;const o=i+Math.cos(r)*e,u=t+Math.sin(r)*e,d=this._geometry.closePointEps;let m=this.currentPath?this.currentPath.points:null;if(m){const l=Math.abs(m[m.length-2]-o),f=Math.abs(m[m.length-1]-u);l<d&&f<d||m.push(o,u)}else this.moveTo(o,u),m=this.currentPath.points;return Fg.arc(o,u,i,t,e,r,n,s,m),this}beginFill(i=0,t=1){return this.beginTextureFill({texture:Ht.WHITE,color:i,alpha:t})}beginTextureFill(i){i=Object.assign({texture:Ht.WHITE,color:16777215,alpha:1,matrix:null},i),this.currentPath&&this.startPoly();const t=i.alpha>0;return t?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._fillStyle,{visible:t},i)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(i,t,e,r){return this.drawShape(new Te(i,t,e,r))}drawRoundedRect(i,t,e,r,n){return this.drawShape(new mf(i,t,e,r,n))}drawCircle(i,t,e){return this.drawShape(new ff(i,t,e))}drawEllipse(i,t,e,r){return this.drawShape(new pf(i,t,e,r))}drawPolygon(...i){let t,e=!0;const r=i[0];r.points?(e=r.closeStroke,t=r.points):Array.isArray(i[0])?t=i[0]:t=i;const n=new mo(t);return n.closeStroke=e,this.drawShape(n),this}drawShape(i){return this._holeMode?this._geometry.drawHole(i,this._matrix):this._geometry.drawShape(i,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const i=this._geometry.graphicsData;return i.length===1&&i[0].shape.type===Ki.RECT&&!i[0].matrix&&!i[0].holes.length&&!(i[0].lineStyle.visible&&i[0].lineStyle.width)}_render(i){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(i)):(i.batch.flush(),this._renderDirect(i))}_populateBatches(){const i=this._geometry,t=this.blendMode,e=i.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=i.batchDirty,this.batches.length=e,this.vertexData=new Float32Array(i.points);for(let r=0;r<e;r++){const n=i.batches[r],s=n.style.color,a=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),o=new Float32Array(i.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),u=new Uint16Array(i.indicesUint16.buffer,n.start*2,n.size),d={vertexData:a,blendMode:t,indices:u,uvs:o,_batchRGB:bo(s),_tintRGB:s,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=d}}_renderBatched(i){if(!!this.batches.length){i.batch.setObjectRenderer(i.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,e=this.batches.length;t<e;t++){const r=this.batches[t];r.worldAlpha=this.worldAlpha*r.alpha,i.plugins[this.pluginName].render(r)}}}_renderDirect(i){const t=this._resolveDirectShader(i),e=this._geometry,r=this.tint,n=this.worldAlpha,s=t.uniforms,a=e.drawCalls;s.translationMatrix=this.transform.worldTransform,s.tint[0]=(r>>16&255)/255*n,s.tint[1]=(r>>8&255)/255*n,s.tint[2]=(r&255)/255*n,s.tint[3]=n,i.shader.bind(t),i.geometry.bind(e,t),i.state.set(this.state);for(let o=0,u=a.length;o<u;o++)this._renderDrawCallDirect(i,e.drawCalls[o])}_renderDrawCallDirect(i,t){const{texArray:e,type:r,size:n,start:s}=t,a=e.count;for(let o=0;o<a;o++)i.texture.bind(e.elements[o],o);i.geometry.draw(r,n,s)}_resolveDirectShader(i){let t=this.shader;const e=this.pluginName;if(!t){if(!bd[e]){const{MAX_TEXTURES:r}=i.plugins[e],n=new Int32Array(r);for(let o=0;o<r;o++)n[o]=o;const s={tint:new Float32Array([1,1,1,1]),translationMatrix:new vi,default:nn.from({uSamplers:n},!0)},a=i.plugins[e]._shader.program;bd[e]=new yr(a,s)}t=bd[e]}return t}_calculateBounds(){this.finishPoly();const i=this._geometry;if(!i.graphicsData.length)return;const{minX:t,minY:e,maxX:r,maxY:n}=i.bounds;this._bounds.addFrame(this.transform,t,e,r,n)}containsPoint(i){return this.worldTransform.applyInverse(i,oc._TEMP_POINT),this._geometry.containsPoint(oc._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const i=bo(this.tint,m2);for(let t=0;t<this.batches.length;t++){const e=this.batches[t],r=e._batchRGB,n=i[0]*r[0]*255,s=i[1]*r[1]*255,a=i[2]*r[2]*255,o=(n<<16)+(s<<8)+(a|0);e._tintRGB=(o>>16)+(o&65280)+((o&255)<<16)}}}calculateVertices(){const i=this.transform._worldID;if(this._transformID===i)return;this._transformID=i;const t=this.transform.worldTransform,e=t.a,r=t.b,n=t.c,s=t.d,a=t.tx,o=t.ty,u=this._geometry.points,d=this.vertexData;let m=0;for(let l=0;l<u.length;l+=2){const f=u[l],p=u[l+1];d[m++]=e*f+n*p+a,d[m++]=s*p+r*f+o}}closePath(){const i=this.currentPath;return i&&(i.closeStroke=!0,this.finishPoly()),this}setMatrix(i){return this._matrix=i,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(i){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(i)}};let Bo=oc;Bo._TEMP_POINT=new He;class g2{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const xd=new He,Ug=new mo,My=class extends be{constructor(i,t,e,r=vn.TRIANGLES){super(),this.geometry=i,this.shader=t,this.state=e||rs.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Xt.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(i){this._geometry!==i&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=i,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(i){this.shader=i}get material(){return this.shader}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}set roundPixels(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(i){this.shader.tint=i}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(i){this.shader.texture=i}_render(i){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===vn.TRIANGLES&&t.length<My.BATCHABLE_SIZE*2?this._renderToBatch(i):this._renderDefault(i)}_renderDefault(i){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),i.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),i.shader.bind(t),i.state.set(this.state),i.geometry.bind(this.geometry,t),i.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(i){const t=this.geometry,e=this.shader;e.uvMatrix&&(e.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=e._tintRGB,this._texture=e.texture;const r=this.material.pluginName;i.batch.setObjectRenderer(i.plugins[r]),i.plugins[r].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,s=n.a,a=n.b,o=n.c,u=n.d,d=n.tx,m=n.ty,l=this.vertexData;for(let f=0;f<l.length/2;f++){const p=e[f*2],y=e[f*2+1];l[f*2]=s*p+o*y+d,l[f*2+1]=a*p+u*y+m}if(this._roundPixels){const f=Xt.RESOLUTION;for(let p=0;p<l.length;++p)l[p]=Math.round(l[p]*f)/f}this.vertexDirty=r}calculateUvs(){const i=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=i.data:(this.batchUvs||(this.batchUvs=new g2(i,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(i){if(!this.getBounds().contains(i.x,i.y))return!1;this.worldTransform.applyInverse(i,xd);const t=this.geometry.getBuffer("aVertexPosition").data,e=Ug.points,r=this.geometry.getIndex().data,n=r.length,s=this.drawMode===4?3:1;for(let a=0;a+2<n;a+=s){const o=r[a]*2,u=r[a+1]*2,d=r[a+2]*2;if(e[0]=t[o],e[1]=t[o+1],e[2]=t[u],e[3]=t[u+1],e[4]=t[d],e[5]=t[d+1],Ug.contains(xd.x,xd.y))return!0}return!1}destroy(i){super.destroy(i),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Ms=My;Ms.BATCHABLE_SIZE=100;var y2=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,v2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class sf extends yr{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:vi.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(r,e.uniforms),super(e.program||$n.from(v2,y2),r),this._colorDirty=!1,this.uvMatrix=new wf(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this.tint=e.tint,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;k0(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Iy extends An{constructor(t,e,r){super();const n=new Ai(t),s=new Ai(e,!0),a=new Ai(r,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,de.FLOAT).addAttribute("aTextureCoord",s,2,!1,de.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class _2 extends Iy{constructor(t=100,e=100,r=10,n=10){super(),this.segWidth=r,this.segHeight=n,this.width=t,this.height=e,this.build()}build(){const t=this.segWidth*this.segHeight,e=[],r=[],n=[],s=this.segWidth-1,a=this.segHeight-1,o=this.width/s,u=this.height/a;for(let m=0;m<t;m++){const l=m%this.segWidth,f=m/this.segWidth|0;e.push(l*o,f*u),r.push(l/s,f/a)}const d=s*a;for(let m=0;m<d;m++){const l=m%s,f=m/s|0,p=f*this.segWidth+l,y=f*this.segWidth+l+1,v=(f+1)*this.segWidth+l,_=(f+1)*this.segWidth+l+1;n.push(p,y,v,y,_,v)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint16Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class w2 extends Ms{constructor(t,e,r){const n=new _2(t.width,t.height,e,r),s=new sf(Ht.WHITE);super(n,s),this.texture=t,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const t=this.geometry,{width:e,height:r}=this.shader.texture;this.autoResize&&(t.width!==e||t.height!==r)&&(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())}set texture(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(t)}destroy(t){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(t)}}const zl=10;class b2 extends w2{constructor(t,e=zl,r=zl,n=zl,s=zl){super(Ht.WHITE,4,4),this._origWidth=t.orig.width,this._origHeight=t.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=e,this._rightWidth=n,this._topHeight=r,this._bottomHeight=s,this.texture=t}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}updateHorizontalVertices(){const t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){const t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width}_getMinScale(){const t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,r=this._topHeight+this._bottomHeight,n=this._height>r?1:this._height/r;return Math.min(e,n)}get width(){return this._width}set width(t){this._width=t,this._refresh()}get height(){return this._height}set height(t){this._height=t,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this._refresh()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this._refresh()}_refresh(){const t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;const r=1/this._origWidth,n=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=r*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-r*this._rightWidth,e[9]=e[11]=e[13]=e[15]=n*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-n*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class By extends be{constructor(t=1500,e,r=16384,n=!1){super();const s=16384;r>s&&(r=s),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=r,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=ue.NORMAL,this.autoResize=n,this.roundPixels=!0,this.baseTexture=null,this.setProperties(e),this._tint=0,this.tintRgb=new Float32Array(4),this.tint=16777215}setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tint}set tint(t){this._tint=t,bo(t,this.tintRgb)}render(t){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){const e=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}class Hg{constructor(t,e,r){this.geometry=new An,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||de.FLOAT,offset:s.offset},e[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Ai(NC(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];o.offset=e,e+=o.size,this.dynamicStride+=o.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Ai(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];o.offset=n,n+=o.size,this.staticStride+=o.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Ai(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];t.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===de.UNSIGNED_BYTE,o.type,this.dynamicStride*4,o.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];t.addAttribute(o.attributeName,this.staticBuffer,0,o.type===de.UNSIGNED_BYTE,o.type,this.staticStride*4,o.offset*4)}}uploadDynamic(t,e,r){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,e,r,s.type===de.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,e,r,s.type===de.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var x2=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,A2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class ky extends Lc{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new vi,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:de.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=yr.from(A2,x2,{}),this.state=rs.for2d()}render(t){const e=t.children,r=t._maxSize,n=t._batchSize,s=this.renderer;let a=e.length;if(a===0)return;a>r&&!t.autoResize&&(a=r);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const u=e[0]._texture.baseTexture,d=u.alphaMode>0;this.state.blendMode=B0(t.blendMode,d),s.state.set(this.state);const m=s.gl,l=t.worldTransform.copyTo(this.tempMatrix);l.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=l.toArray(!0),this.shader.uniforms.uColor=FC(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,d),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);let f=!1;for(let p=0,y=0;p<a;p+=n,y+=1){let v=a-p;v>n&&(v=n),y>=o.length&&o.push(this._generateOneMoreBuffer(t));const _=o[y];_.uploadDynamic(e,p,v);const w=t._bufferUpdateIDs[y]||0;f=f||_._updateID<w,f&&(_._updateID=t._updateID,_.uploadStatic(e,p,v)),s.geometry.bind(_.geometry),m.drawElements(m.TRIANGLES,v*6,m.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,n=t._batchSize,s=t._properties;for(let a=0;a<r;a+=n)e.push(new Hg(this.properties,s,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new Hg(this.properties,r,e)}uploadVertices(t,e,r,n,s,a){let o=0,u=0,d=0,m=0;for(let l=0;l<r;++l){const f=t[e+l],p=f._texture,y=f.scale.x,v=f.scale.y,_=p.trim,w=p.orig;_?(u=_.x-f.anchor.x*w.width,o=u+_.width,m=_.y-f.anchor.y*w.height,d=m+_.height):(o=w.width*(1-f.anchor.x),u=w.width*-f.anchor.x,d=w.height*(1-f.anchor.y),m=w.height*-f.anchor.y),n[a]=u*y,n[a+1]=m*v,n[a+s]=o*y,n[a+s+1]=m*v,n[a+s*2]=o*y,n[a+s*2+1]=d*v,n[a+s*3]=u*y,n[a+s*3+1]=d*v,a+=s*4}}uploadPosition(t,e,r,n,s,a){for(let o=0;o<r;o++){const u=t[e+o].position;n[a]=u.x,n[a+1]=u.y,n[a+s]=u.x,n[a+s+1]=u.y,n[a+s*2]=u.x,n[a+s*2+1]=u.y,n[a+s*3]=u.x,n[a+s*3+1]=u.y,a+=s*4}}uploadRotation(t,e,r,n,s,a){for(let o=0;o<r;o++){const u=t[e+o].rotation;n[a]=u,n[a+s]=u,n[a+s*2]=u,n[a+s*3]=u,a+=s*4}}uploadUvs(t,e,r,n,s,a){for(let o=0;o<r;++o){const u=t[e+o]._texture._uvs;u?(n[a]=u.x0,n[a+1]=u.y0,n[a+s]=u.x1,n[a+s+1]=u.y1,n[a+s*2]=u.x2,n[a+s*2+1]=u.y2,n[a+s*3]=u.x3,n[a+s*3+1]=u.y3,a+=s*4):(n[a]=0,n[a+1]=0,n[a+s]=0,n[a+s+1]=0,n[a+s*2]=0,n[a+s*2+1]=0,n[a+s*3]=0,n[a+s*3+1]=0,a+=s*4)}}uploadTint(t,e,r,n,s,a){for(let o=0;o<r;++o){const u=t[e+o],d=u._texture.baseTexture.alphaMode>0,m=u.alpha,l=m<1&&d?vf(u._tintRGB,m):u._tintRGB+(m*255<<24);n[a]=l,n[a+s]=l,n[a+s*2]=l,n[a+s*3]=l,a+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}ky.extension={name:"particle",type:Jt.RendererPlugin};le.add(ky);Xt.UPLOADS_PER_FRAME=4;var Ph=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(Ph||{});const Ad={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ph.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},E2=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];class Ds{constructor(t){this.styleID=0,this.reset(),Td(this,t,t)}clone(){const t={};return Td(t,this,Ad),new Ds(t)}reset(){Td(this,Ad,Ad)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Ed(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Ed(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){T2(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Ed(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let n=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!E2.includes(n)&&(n=`"${n}"`),e[r]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}}function Gg(i){return typeof i=="number"?M0(i):(typeof i=="string"&&i.startsWith("0x")&&(i=i.replace("0x","#")),i)}function Ed(i){if(Array.isArray(i)){for(let t=0;t<i.length;++t)i[t]=Gg(i[t]);return i}else return Gg(i)}function T2(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function Td(i,t,e){for(const r in e)Array.isArray(t[r])?i[r]=t[r].slice():i[r]=t[r]}const Vl={willReadFrequently:!0};class ae{constructor(t,e,r,n,s,a,o,u,d){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=s,this.lineWidths=a,this.lineHeight=o,this.maxLineWidth=u,this.fontProperties=d}static measureText(t,e,r,n=ae._canvas){r=r??e.wordWrap;const s=e.toFontString(),a=ae.measureFont(s);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const o=n.getContext("2d",Vl);o.font=s;const d=(r?ae.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),m=new Array(d.length);let l=0;for(let v=0;v<d.length;v++){const _=o.measureText(d[v]).width+(d[v].length-1)*e.letterSpacing;m[v]=_,l=Math.max(l,_)}let f=l+e.strokeThickness;e.dropShadow&&(f+=e.dropShadowDistance);const p=e.lineHeight||a.fontSize+e.strokeThickness;let y=Math.max(p,a.fontSize+e.strokeThickness)+(d.length-1)*(p+e.leading);return e.dropShadow&&(y+=e.dropShadowDistance),new ae(t,e,f,y,d,m,p+e.leading,l,a)}static wordWrap(t,e,r=ae._canvas){const n=r.getContext("2d",Vl);let s=0,a="",o="";const u=Object.create(null),{letterSpacing:d,whiteSpace:m}=e,l=ae.collapseSpaces(m),f=ae.collapseNewlines(m);let p=!l;const y=e.wordWrapWidth+d,v=ae.tokenize(t);for(let _=0;_<v.length;_++){let w=v[_];if(ae.isNewline(w)){if(!f){o+=ae.addLine(a),p=!l,a="",s=0;continue}w=" "}if(l){const E=ae.isBreakingSpace(w),R=ae.isBreakingSpace(a[a.length-1]);if(E&&R)continue}const T=ae.getFromCache(w,d,u,n);if(T>y)if(a!==""&&(o+=ae.addLine(a),a="",s=0),ae.canBreakWords(w,e.breakWords)){const E=ae.wordWrapSplit(w);for(let R=0;R<E.length;R++){let H=E[R],Y=1;for(;E[R+Y];){const et=E[R+Y],J=H[H.length-1];if(ae.canBreakChars(J,et,w,R,e.breakWords))break}R+=H.length-1;const j=ae.getFromCache(H,d,u,n);j+s>y&&(o+=ae.addLine(a),p=!1,a="",s=0),a+=H,s+=j}}else{a.length>0&&(o+=ae.addLine(a),a="",s=0);const E=_===v.length-1;o+=ae.addLine(w,!E),p=!1,a="",s=0}else T+s>y&&(p=!1,o+=ae.addLine(a),a="",s=0),(a.length>0||!ae.isBreakingSpace(w)||p)&&(a+=w,s+=T)}return o+=ae.addLine(a,!1),o}static addLine(t,e=!0){return t=ae.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,r,n){let s=r[t];if(typeof s!="number"){const a=t.length*e;s=n.measureText(t).width+a,r[t]=s}return s}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!ae.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:ae._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:ae._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let r="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const s=t[n],a=t[n+1];if(ae.isBreakingSpace(s,a)||ae.isNewline(s)){r!==""&&(e.push(r),r=""),e.push(s);continue}r+=s}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,n,s){return!0}static wordWrapSplit(t){return t.split("")}static measureFont(t){if(ae._fonts[t])return ae._fonts[t];const e={ascent:0,descent:0,fontSize:0},r=ae._canvas,n=ae._context;n.font=t;const s=ae.METRICS_STRING+ae.BASELINE_SYMBOL,a=Math.ceil(n.measureText(s).width);let o=Math.ceil(n.measureText(ae.BASELINE_SYMBOL).width);const u=Math.ceil(ae.HEIGHT_MULTIPLIER*o);o=o*ae.BASELINE_MULTIPLIER|0,r.width=a,r.height=u,n.fillStyle="#f00",n.fillRect(0,0,a,u),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,o);const d=n.getImageData(0,0,a,u).data,m=d.length,l=a*4;let f=0,p=0,y=!1;for(f=0;f<o;++f){for(let v=0;v<l;v+=4)if(d[p+v]!==255){y=!0;break}if(!y)p+=l;else break}for(e.ascent=o-f,p=m-l,y=!1,f=u;f>o;--f){for(let v=0;v<l;v+=4)if(d[p+v]!==255){y=!0;break}if(!y)p-=l;else break}return e.descent=f-o,e.fontSize=e.ascent+e.descent,ae._fonts[t]=e,e}static clearMetrics(t=""){t?delete ae._fonts[t]:ae._fonts={}}static get _canvas(){if(!ae.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",Vl)?.measureText)return ae.__canvas=e,e;t=Xt.ADAPTER.createCanvas()}catch{t=Xt.ADAPTER.createCanvas()}t.width=t.height=10,ae.__canvas=t}return ae.__canvas}static get _context(){return ae.__context||(ae.__context=ae._canvas.getContext("2d",Vl)),ae.__context}}ae._fonts={};ae.METRICS_STRING="|\xC9q\xC5";ae.BASELINE_SYMBOL="M";ae.BASELINE_MULTIPLIER=1.4;ae.HEIGHT_MULTIPLIER=2;ae._newlines=[10,13];ae._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const S2={texture:!0,children:!1,baseTexture:!0},Ry=class extends Ie{constructor(i,t,e){let r=!1;e||(e=Xt.ADAPTER.createCanvas(),r=!0),e.width=3,e.height=3;const n=Ht.from(e);n.orig=new Te,n.trim=new Te,super(n),this._ownCanvas=r,this.canvas=e,this.context=e.getContext("2d",{willReadFrequently:!0}),this._resolution=Xt.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=i,this.style=t,this.localStyleID=-1}updateText(i){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&i)return;this._font=this._style.toFontString();const e=this.context,r=ae.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=r.width,s=r.height,a=r.lines,o=r.lineHeight,u=r.lineWidths,d=r.maxLineWidth,m=r.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+t.padding*2)*this._resolution),e.scale(this._resolution,this._resolution),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.font=this._font,e.lineWidth=t.strokeThickness,e.textBaseline=t.textBaseline,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit;let l,f;const p=t.dropShadow?2:1;for(let y=0;y<p;++y){const v=t.dropShadow&&y===0,_=v?Math.ceil(Math.max(1,s)+t.padding*2):0,w=_*this._resolution;if(v){e.fillStyle="black",e.strokeStyle="black";const E=t.dropShadowColor,R=bo(typeof E=="number"?E:yf(E)),H=t.dropShadowBlur*this._resolution,Y=t.dropShadowDistance*this._resolution;e.shadowColor=`rgba(${R[0]*255},${R[1]*255},${R[2]*255},${t.dropShadowAlpha})`,e.shadowBlur=H,e.shadowOffsetX=Math.cos(t.dropShadowAngle)*Y,e.shadowOffsetY=Math.sin(t.dropShadowAngle)*Y+w}else e.fillStyle=this._generateFillStyle(t,a,r),e.strokeStyle=t.stroke,e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;let T=(o-m.fontSize)/2;o-m.fontSize<0&&(T=0);for(let E=0;E<a.length;E++)l=t.strokeThickness/2,f=t.strokeThickness/2+E*o+m.ascent+T,t.align==="right"?l+=d-u[E]:t.align==="center"&&(l+=(d-u[E])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(a[E],l+t.padding,f+t.padding-_,!0),t.fill&&this.drawLetterSpacing(a[E],l+t.padding,f+t.padding-_)}this.updateTexture()}drawLetterSpacing(i,t,e,r=!1){const s=this._style.letterSpacing,a=Ry.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(s===0||a){a&&(this.context.letterSpacing=s,this.context.textLetterSpacing=s),r?this.context.strokeText(i,t,e):this.context.fillText(i,t,e);return}let o=t;const u=Array.from?Array.from(i):i.split("");let d=this.context.measureText(i).width,m=0;for(let l=0;l<u.length;++l){const f=u[l];r?this.context.strokeText(f,o,e):this.context.fillText(f,o,e);let p="";for(let y=l+1;y<u.length;++y)p+=u[y];m=this.context.measureText(p).width,o+=d-m+s,d=m}}updateTexture(){const i=this.canvas;if(this._style.trim){const s=HC(i);s.data&&(i.width=s.width,i.height=s.height,this.context.putImageData(s.data,0,0))}const t=this._texture,e=this._style,r=e.trim?0:e.padding,n=t.baseTexture;t.trim.width=t._frame.width=i.width/this._resolution,t.trim.height=t._frame.height=i.height/this._resolution,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-r*2,t.orig.height=t._frame.height-r*2,this._onTextureUpdate(),n.setRealSize(i.width,i.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),super._render(i)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(i,t){return this.updateText(!0),this._textureID===-1&&(i=!1),super.getBounds(i,t)}getLocalBounds(i){return this.updateText(!0),super.getLocalBounds.call(this,i)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(i,t,e){const r=i.fill;if(Array.isArray(r)){if(r.length===1)return r[0]}else return r;let n;const s=i.dropShadow?i.dropShadowDistance:0,a=i.padding||0,o=this.canvas.width/this._resolution-s-a*2,u=this.canvas.height/this._resolution-s-a*2,d=r.slice(),m=i.fillGradientStops.slice();if(!m.length){const l=d.length+1;for(let f=1;f<l;++f)m.push(f/l)}if(d.unshift(r[0]),m.unshift(0),d.push(r[r.length-1]),m.push(1),i.fillGradientType===Ph.LINEAR_VERTICAL){n=this.context.createLinearGradient(o/2,a,o/2,u+a);const l=e.fontProperties.fontSize+i.strokeThickness;for(let f=0;f<t.length;f++){const p=e.lineHeight*(f-1)+l,y=e.lineHeight*f;let v=y;f>0&&p>y&&(v=(y+p)/2);const _=y+l,w=e.lineHeight*(f+1);let T=_;f+1<t.length&&w<_&&(T=(_+w)/2);const E=(T-v)/u;for(let R=0;R<d.length;R++){let H=0;typeof m[R]=="number"?H=m[R]:H=R/d.length;let Y=Math.min(1,Math.max(0,v/u+H*E));Y=Number(Y.toFixed(5)),n.addColorStop(Y,d[R])}}}else{n=this.context.createLinearGradient(a,u/2,o+a,u/2);const l=d.length+1;let f=1;for(let p=0;p<d.length;p++){let y;typeof m[p]=="number"?y=m[p]:y=f/l,n.addColorStop(y,d[p]),f++}}return n}destroy(i){typeof i=="boolean"&&(i={children:i}),i=Object.assign({},S2,i),super.destroy(i),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(i){this.updateText(!0);const t=so(this.scale.x)||1;this.scale.x=t*i/this._texture.orig.width,this._width=i}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(i){this.updateText(!0);const t=so(this.scale.y)||1;this.scale.y=t*i/this._texture.orig.height,this._height=i}get style(){return this._style}set style(i){i=i||{},i instanceof Ds?this._style=i:this._style=new Ds(i),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(i){i=String(i??""),this._text!==i&&(this._text=i,this.dirty=!0)}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}};let Sf=Ry;Sf.experimentalLetterSpacing=!1;class C2{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function M2(i,t){let e=!1;if(i?._textures?.length){for(let r=0;r<i._textures.length;r++)if(i._textures[r]instanceof Ht){const n=i._textures[r].baseTexture;t.includes(n)||(t.push(n),e=!0)}}return e}function I2(i,t){if(i.baseTexture instanceof Pe){const e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function B2(i,t){if(i._texture&&i._texture instanceof Ht){const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function k2(i,t){return t instanceof Sf?(t.updateText(!0),!0):!1}function R2(i,t){if(t instanceof Ds){const e=t.toFontString();return ae.measureFont(e),!0}return!1}function P2(i,t){if(i instanceof Sf){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function D2(i,t){return i instanceof Ds?(t.includes(i)||t.push(i),!0):!1}class L2{constructor(t){this.limiter=new C2(Xt.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{!this.queue||this.prepareItems()},this.registerFindHook(P2),this.registerFindHook(D2),this.registerFindHook(M2),this.registerFindHook(I2),this.registerFindHook(B2),this.registerUploadHook(k2),this.registerUploadHook(R2)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,xi.system.addOnce(this.tick,this,pa.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)xi.system.addOnce(this.tick,this,pa.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof be)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&xi.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}}function Py(i,t){return t instanceof Pe?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function O2(i,t){if(!(t instanceof Bo))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:r}=e;for(let n=0;n<r.length;n++){const{texture:s}=r[n].style;s&&Py(i,s.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function F2(i,t){return i instanceof Bo?(t.push(i),!0):!1}class Dy extends L2{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(F2),this.registerUploadHook(Py),this.registerUploadHook(O2)}}Dy.extension={name:"prepare",type:Jt.RendererSystem};le.add(Dy);const _h=class{constructor(i,t,e=null){this.linkedSheets=[],this._texture=i instanceof Ht?i:null,this.baseTexture=i instanceof Pe?i:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const r=this.baseTexture.resource;this.resolution=this._updateResolution(e||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(i=null){const{scale:t}=this.data.meta;let e=Rs(i,null);return e===null&&(e=parseFloat(t??"1")),e!==1&&this.baseTexture.setResolution(e),e}parse(){return new Promise(i=>{this._callback=i,this._batchIndex=0,this._frameKeys.length<=_h.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(i){let t=i;const e=_h.BATCH_SIZE;for(;t-i<e&&t<this._frameKeys.length;){const r=this._frameKeys[t],n=this._frames[r],s=n.frame;if(s){let a=null,o=null;const u=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,d=new Te(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);n.rotated?a=new Te(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):a=new Te(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(o=new Te(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[r]=new Ht(this.baseTexture,a,d,o,n.rotated?2:0,n.anchor),Ht.addToCache(this.textures[r],r)}t++}}_processAnimations(){const i=this.data.animations||{};for(const t in i){this.animations[t]=[];for(let e=0;e<i[t].length;e++){const r=i[t][e];this.animations[t].push(this.textures[r])}}}_parseComplete(){const i=this._callback;this._callback=null,this._batchIndex=0,i.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*_h.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*_h.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(i=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,i&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let af=_h;af.BATCH_SIZE=1e3;const N2=["jpg","png","jpeg","avif","webp"];function Ly(i,t,e){const r={};if(i.forEach(n=>{r[n]=t}),Object.keys(t.textures).forEach(n=>{r[n]=t.textures[n]}),!e){const n=qi.dirname(i[0]);t.linkedSheets.forEach((s,a)=>{const o=Ly([`${n}/${t.data.meta.related_multi_packs[a]}`],s,!0);Object.assign(r,o)})}return r}const U2={extension:Jt.Asset,cache:{test:i=>i instanceof af,getCacheableAssets:(i,t)=>Ly(i,t,!1)},resolver:{test:i=>{const e=i.split("?")[0].split("."),r=e.pop(),n=e.pop();return r==="json"&&N2.includes(n)},parse:i=>{const t=i.split(".");return{resolution:parseFloat(Xt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:t[t.length-2],src:i}}},loader:{extension:{type:Jt.LoadParser,priority:En.Normal},async testParse(i,t){return qi.extname(t.src).includes(".json")&&!!i.frames},async parse(i,t,e){let r=qi.dirname(t.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");const n=r+i.meta.image,a=(await e.load([n]))[n],o=new af(a.baseTexture,i,t.src);await o.parse();const u=i?.meta?.related_multi_packs;if(Array.isArray(u)){const d=[];for(const l of u){if(typeof l!="string")continue;const f=r+l;t.data?.ignoreMultiPack||d.push(e.load({src:f,data:{ignoreMultiPack:!0}}))}const m=await Promise.all(d);o.linkedSheets=m,m.forEach(l=>{l.linkedSheets=[o].concat(o.linkedSheets.filter(f=>f!==l))})}return o},unload(i){i.destroy(!0)}}};le.add(U2);const ph=new He;class Cf extends Ie{constructor(t,e=100,r=100){super(t),this.tileTransform=new kc,this._width=e,this._height=r,this.uvMatrix=this.texture.uvMatrix||new wf(t),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(t){this.tileTransform.scale.copyFrom(t)}get tilePosition(){return this.tileTransform.position}set tilePosition(t){this.tileTransform.position.copyFrom(t)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(t){const e=this._texture;!e||!e.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}_calculateBounds(){const t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),n=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,r,n)}getLocalBounds(t){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Te),t=this._localBoundsRect),this._bounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,ph);const e=this._width,r=this._height,n=-e*this.anchor._x;if(ph.x>=n&&ph.x<n+e){const s=-r*this.anchor._y;if(ph.y>=s&&ph.y<s+r)return!0}return!1}destroy(t){super.destroy(t),this.tileTransform=null,this.uvMatrix=null}static from(t,e){const r=t instanceof Ht?t:Ht.from(t,e);return new Cf(r,e.width,e.height)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}}var H2=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,Wg=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,G2=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,W2=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,z2=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;const Xl=new vi;class Oy extends Lc{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new H0,this.state=rs.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=yr.from(Wg,H2,e),this.shader=t.context.webGLVersion>1?yr.from(W2,z2,e):yr.from(Wg,G2,e)}render(t){const e=this.renderer,r=this.quad;let n=r.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,a=t.uvRespectAnchor?t.anchor.y:0;n=r.uvs,n[0]=n[6]=-s,n[1]=n[3]=-a,n[2]=n[4]=1-s,n[5]=n[7]=1-a,r.invalidate();const o=t._texture,u=o.baseTexture,d=u.alphaMode>0,m=t.tileTransform.localTransform,l=t.uvMatrix;let f=u.isPowerOfTwo&&o.frame.width===u.width&&o.frame.height===u.height;f&&(u._glTextures[e.CONTEXT_UID]?f=u.wrapMode!==Bs.CLAMP:u.wrapMode===Bs.CLAMP&&(u.wrapMode=Bs.REPEAT));const p=f?this.simpleShader:this.shader,y=o.width,v=o.height,_=t._width,w=t._height;Xl.set(m.a*y/_,m.b*y/w,m.c*v/_,m.d*v/w,m.tx/_,m.ty/w),Xl.invert(),f?Xl.prepend(l.mapCoord):(p.uniforms.uMapCoord=l.mapCoord.toArray(!0),p.uniforms.uClampFrame=l.uClampFrame,p.uniforms.uClampOffset=l.uClampOffset),p.uniforms.uTransform=Xl.toArray(!0),p.uniforms.uColor=k0(t.tint,t.worldAlpha,p.uniforms.uColor,d),p.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),p.uniforms.uSampler=o,e.shader.bind(p),e.geometry.bind(r),this.state.blendMode=B0(t.blendMode,d),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Oy.extension={name:"tilingSprite",type:Jt.RendererPlugin};le.add(Oy);class bc{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class hc{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in e){const a=e[s].match(/^[a-z]+/gm)[0],o=e[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),u={};for(const d in o){const m=o[d].split("="),l=m[0],f=m[1].replace(/"/gm,""),p=parseFloat(f),y=isNaN(p)?f:p;u[l]=y}r[a].push(u)}const n=new bc;return r.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),r.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),r.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),r.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),r.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),r.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class of{static test(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new bc,r=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),u=t.getElementsByTagName("distanceField");for(let d=0;d<r.length;d++)e.info.push({face:r[d].getAttribute("face"),size:parseInt(r[d].getAttribute("size"),10)});for(let d=0;d<n.length;d++)e.common.push({lineHeight:parseInt(n[d].getAttribute("lineHeight"),10)});for(let d=0;d<s.length;d++)e.page.push({id:parseInt(s[d].getAttribute("id"),10)||0,file:s[d].getAttribute("file")});for(let d=0;d<a.length;d++){const m=a[d];e.char.push({id:parseInt(m.getAttribute("id"),10),page:parseInt(m.getAttribute("page"),10)||0,x:parseInt(m.getAttribute("x"),10),y:parseInt(m.getAttribute("y"),10),width:parseInt(m.getAttribute("width"),10),height:parseInt(m.getAttribute("height"),10),xoffset:parseInt(m.getAttribute("xoffset"),10),yoffset:parseInt(m.getAttribute("yoffset"),10),xadvance:parseInt(m.getAttribute("xadvance"),10)})}for(let d=0;d<o.length;d++)e.kerning.push({first:parseInt(o[d].getAttribute("first"),10),second:parseInt(o[d].getAttribute("second"),10),amount:parseInt(o[d].getAttribute("amount"),10)});for(let d=0;d<u.length;d++)e.distanceField.push({fieldType:u[d].getAttribute("fieldType"),distanceRange:parseInt(u[d].getAttribute("distanceRange"),10)});return e}}class hf{static test(t){if(typeof t=="string"&&t.includes("<font>")){const e=new globalThis.DOMParser().parseFromString(t,"text/xml");return of.test(e)}return!1}static parse(t){const e=new globalThis.DOMParser().parseFromString(t,"text/xml");return of.parse(e)}}const Sd=[hc,of,hf];function V2(i){for(let t=0;t<Sd.length;t++)if(Sd[t].test(i))return Sd[t];return null}function X2(i,t,e,r,n,s){const a=e.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let o;const u=e.dropShadow?e.dropShadowDistance:0,d=e.padding||0,m=i.width/r-u-d*2,l=i.height/r-u-d*2,f=a.slice(),p=e.fillGradientStops.slice();if(!p.length){const y=f.length+1;for(let v=1;v<y;++v)p.push(v/y)}if(f.unshift(a[0]),p.unshift(0),f.push(a[a.length-1]),p.push(1),e.fillGradientType===Ph.LINEAR_VERTICAL){o=t.createLinearGradient(m/2,d,m/2,l+d);let y=0;const _=(s.fontProperties.fontSize+e.strokeThickness)/l;for(let w=0;w<n.length;w++){const T=s.lineHeight*w;for(let E=0;E<f.length;E++){let R=0;typeof p[E]=="number"?R=p[E]:R=E/f.length;const H=T/l+R*_;let Y=Math.max(y,H);Y=Math.min(Y,1),o.addColorStop(Y,f[E]),y=Y}}}else{o=t.createLinearGradient(d,l/2,m+d,l/2);const y=f.length+1;let v=1;for(let _=0;_<f.length;_++){let w;typeof p[_]=="number"?w=p[_]:w=v/y,o.addColorStop(w,f[_]),v++}}return o}function j2(i,t,e,r,n,s,a){const o=e.text,u=e.fontProperties;t.translate(r,n),t.scale(s,s);const d=a.strokeThickness/2,m=-(a.strokeThickness/2);if(t.font=a.toFontString(),t.lineWidth=a.strokeThickness,t.textBaseline=a.textBaseline,t.lineJoin=a.lineJoin,t.miterLimit=a.miterLimit,t.fillStyle=X2(i,t,a,s,[o],e),t.strokeStyle=a.stroke,a.dropShadow){const l=a.dropShadowColor,f=bo(typeof l=="number"?l:yf(l)),p=a.dropShadowBlur*s,y=a.dropShadowDistance*s;t.shadowColor=`rgba(${f[0]*255},${f[1]*255},${f[2]*255},${a.dropShadowAlpha})`,t.shadowBlur=p,t.shadowOffsetX=Math.cos(a.dropShadowAngle)*y,t.shadowOffsetY=Math.sin(a.dropShadowAngle)*y}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;a.stroke&&a.strokeThickness&&t.strokeText(o,d,m+e.lineHeight-u.descent),a.fill&&t.fillText(o,d,m+e.lineHeight-u.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Fy(i){return Array.from?Array.from(i):i.split("")}function Y2(i){typeof i=="string"&&(i=[i]);const t=[];for(let e=0,r=i.length;e<r;e++){const n=i[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),a=n[1].charCodeAt(0);if(a<s)throw new Error("[BitmapFont]: Invalid character range.");for(let o=s,u=a;o<=u;o++)t.push(String.fromCharCode(o))}else t.push(...Fy(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}function lc(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}const Qr=class{constructor(i,t,e){const[r]=i.info,[n]=i.common,[s]=i.page,[a]=i.distanceField,o=Rs(s.file),u={};this._ownsTextures=e,this.font=r.face,this.size=r.size,this.lineHeight=n.lineHeight/o,this.chars={},this.pageTextures=u;for(let d=0;d<i.page.length;d++){const{id:m,file:l}=i.page[d];u[m]=t instanceof Array?t[d]:t[l],a?.fieldType&&a.fieldType!=="none"&&(u[m].baseTexture.alphaMode=an.NO_PREMULTIPLIED_ALPHA,u[m].baseTexture.mipmap=xn.OFF)}for(let d=0;d<i.char.length;d++){const{id:m,page:l}=i.char[d];let{x:f,y:p,width:y,height:v,xoffset:_,yoffset:w,xadvance:T}=i.char[d];f/=o,p/=o,y/=o,v/=o,_/=o,w/=o,T/=o;const E=new Te(f+u[l].frame.x/o,p+u[l].frame.y/o,y,v);this.chars[m]={xOffset:_,yOffset:w,xAdvance:T,kerning:{},texture:new Ht(u[l].baseTexture,E),page:l}}for(let d=0;d<i.kerning.length;d++){let{first:m,second:l,amount:f}=i.kerning[d];m/=o,l/=o,f/=o,this.chars[l]&&(this.chars[l].kerning[m]=f)}this.distanceFieldRange=a?.distanceRange,this.distanceFieldType=a?.fieldType?.toLowerCase()??"none"}destroy(){for(const i in this.chars)this.chars[i].texture.destroy(),this.chars[i].texture=null;for(const i in this.pageTextures)this._ownsTextures&&this.pageTextures[i].destroy(!0),this.pageTextures[i]=null;this.chars=null,this.pageTextures=null}static install(i,t,e){let r;if(i instanceof bc)r=i;else{const s=V2(i);if(!s)throw new Error("Unrecognized data format for font.");r=s.parse(i)}t instanceof Ht&&(t=[t]);const n=new Qr(r,t,e);return Qr.available[n.font]=n,n}static uninstall(i){const t=Qr.available[i];if(!t)throw new Error(`No font found named '${i}'`);t.destroy(),delete Qr.available[i]}static from(i,t,e){if(!i)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:n,resolution:s,textureWidth:a,textureHeight:o,...u}=Object.assign({},Qr.defaultOptions,e),d=Y2(r),m=t instanceof Ds?t:new Ds(t),l=a,f=new bc;f.info[0]={face:m.fontFamily,size:m.fontSize},f.common[0]={lineHeight:m.fontSize};let p=0,y=0,v,_,w,T=0;const E=[];for(let H=0;H<d.length;H++){v||(v=Xt.ADAPTER.createCanvas(),v.width=a,v.height=o,_=v.getContext("2d"),w=new Pe(v,{resolution:s,...u}),E.push(new Ht(w)),f.page.push({id:E.length-1,file:""}));const Y=d[H],j=ae.measureText(Y,m,!1,v),et=j.width,J=Math.ceil(j.height),rt=Math.ceil((m.fontStyle==="italic"?2:1)*et);if(y>=o-J*s){if(y===0)throw new Error(`[BitmapFont] textureHeight ${o}px is too small (fontFamily: '${m.fontFamily}', fontSize: ${m.fontSize}px, char: '${Y}')`);--H,v=null,_=null,w=null,y=0,p=0,T=0;continue}if(T=Math.max(J+j.fontProperties.descent,T),rt*s+p>=l){if(p===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${m.fontFamily}', fontSize: ${m.fontSize}px, char: '${Y}')`);--H,y+=T*s,y=Math.ceil(y),p=0,T=0;continue}j2(v,_,j,p,y,s,m);const gt=lc(j.text);f.char.push({id:gt,page:E.length-1,x:p/s,y:y/s,width:rt,height:J,xoffset:0,yoffset:0,xadvance:Math.ceil(et-(m.dropShadow?m.dropShadowDistance:0)-(m.stroke?m.strokeThickness:0))}),p+=(rt+2*n)*s,p=Math.ceil(p)}for(let H=0,Y=d.length;H<Y;H++){const j=d[H];for(let et=0;et<Y;et++){const J=d[et],rt=_.measureText(j).width,gt=_.measureText(J).width,Q=_.measureText(j+J).width-(rt+gt);Q&&f.kerning.push({first:lc(j),second:lc(J),amount:Q})}}const R=new Qr(f,E,!0);return Qr.available[i]!==void 0&&Qr.uninstall(i),Qr.available[i]=R,R}};let Ji=Qr;Ji.ALPHA=[["a","z"],["A","Z"]," "];Ji.NUMERIC=[["0","9"]];Ji.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Ji.ASCII=[[" ","~"]];Ji.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Qr.ALPHANUMERIC};Ji.available={};var K2=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,q2=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const zg=[],Vg=[],Xg=[],Ny=class extends be{constructor(i,t={}){super(),this._tint=16777215;const{align:e,tint:r,maxWidth:n,letterSpacing:s,fontName:a,fontSize:o}=Object.assign({},Ny.styleDefaults,t);if(!Ji.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=e,this._tint=r,this._font=void 0,this._fontName=a,this._fontSize=o,this.text=i,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new Cs(()=>{this.dirty=!0},this,0,0),this._roundPixels=Xt.ROUND_PIXELS,this.dirty=!0,this._resolution=Xt.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const i=Ji.available[this._fontName],t=this.fontSize,e=t/i.size,r=new He,n=[],s=[],a=[],o=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",u=Fy(o),d=this._maxWidth*i.size/t,m=i.distanceFieldType==="none"?zg:Vg;let l=null,f=0,p=0,y=0,v=-1,_=0,w=0,T=0,E=0;for(let rt=0;rt<u.length;rt++){const gt=u[rt],X=lc(gt);if(/(?:\s)/.test(gt)&&(v=rt,_=f,E++),gt==="\r"||gt===`
`){s.push(f),a.push(-1),p=Math.max(p,f),++y,++w,r.x=0,r.y+=i.lineHeight,l=null,E=0;continue}const Q=i.chars[X];if(!Q)continue;l&&Q.kerning[l]&&(r.x+=Q.kerning[l]);const S=Xg.pop()||{texture:Ht.EMPTY,line:0,charCode:0,prevSpaces:0,position:new He};S.texture=Q.texture,S.line=y,S.charCode=X,S.position.x=r.x+Q.xOffset+this._letterSpacing/2,S.position.y=r.y+Q.yOffset,S.prevSpaces=E,n.push(S),f=S.position.x+Math.max(Q.xAdvance-Q.xOffset,Q.texture.orig.width),r.x+=Q.xAdvance+this._letterSpacing,T=Math.max(T,Q.yOffset+Q.texture.height),l=X,v!==-1&&d>0&&r.x>d&&(++w,yo(n,1+v-w,1+rt-v),rt=v,v=-1,s.push(_),a.push(n.length>0?n[n.length-1].prevSpaces:0),p=Math.max(p,_),y++,r.x=0,r.y+=i.lineHeight,l=null,E=0)}const R=u[u.length-1];R!=="\r"&&R!==`
`&&(/(?:\s)/.test(R)&&(f=_),s.push(f),p=Math.max(p,f),a.push(-1));const H=[];for(let rt=0;rt<=y;rt++){let gt=0;this._align==="right"?gt=p-s[rt]:this._align==="center"?gt=(p-s[rt])/2:this._align==="justify"&&(gt=a[rt]<0?0:(p-s[rt])/a[rt]),H.push(gt)}const Y=n.length,j={},et=[],J=this._activePagesMeshData;m.push(...J);for(let rt=0;rt<Y;rt++){const gt=n[rt].texture,X=gt.baseTexture.uid;if(!j[X]){let Q=m.pop();if(!Q){const ut=new Iy;let Pt,pt;i.distanceFieldType==="none"?(Pt=new sf(Ht.EMPTY),pt=ue.NORMAL):(Pt=new sf(Ht.EMPTY,{program:$n.from(q2,K2),uniforms:{uFWidth:0}}),pt=ue.NORMAL_NPM);const Wt=new Ms(ut,Pt);Wt.blendMode=pt,Q={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Wt,vertices:null,uvs:null,indices:null}}Q.index=0,Q.indexCount=0,Q.vertexCount=0,Q.uvsCount=0,Q.total=0;const{_textureCache:S}=this;S[X]=S[X]||new Ht(gt.baseTexture),Q.mesh.texture=S[X],Q.mesh.tint=this._tint,et.push(Q),j[X]=Q}j[X].total++}for(let rt=0;rt<J.length;rt++)et.includes(J[rt])||this.removeChild(J[rt].mesh);for(let rt=0;rt<et.length;rt++)et[rt].mesh.parent!==this&&this.addChild(et[rt].mesh);this._activePagesMeshData=et;for(const rt in j){const gt=j[rt],X=gt.total;if(!(gt.indices?.length>6*X)||gt.vertices.length<Ms.BATCHABLE_SIZE*2)gt.vertices=new Float32Array(4*2*X),gt.uvs=new Float32Array(4*2*X),gt.indices=new Uint16Array(6*X);else{const Q=gt.total,S=gt.vertices;for(let ut=Q*4*2;ut<S.length;ut++)S[ut]=0}gt.mesh.size=6*X}for(let rt=0;rt<Y;rt++){const gt=n[rt];let X=gt.position.x+H[gt.line]*(this._align==="justify"?gt.prevSpaces:1);this._roundPixels&&(X=Math.round(X));const Q=X*e,S=gt.position.y*e,ut=gt.texture,Pt=j[ut.baseTexture.uid],pt=ut.frame,Wt=ut._uvs,bt=Pt.index++;Pt.indices[bt*6+0]=0+bt*4,Pt.indices[bt*6+1]=1+bt*4,Pt.indices[bt*6+2]=2+bt*4,Pt.indices[bt*6+3]=0+bt*4,Pt.indices[bt*6+4]=2+bt*4,Pt.indices[bt*6+5]=3+bt*4,Pt.vertices[bt*8+0]=Q,Pt.vertices[bt*8+1]=S,Pt.vertices[bt*8+2]=Q+pt.width*e,Pt.vertices[bt*8+3]=S,Pt.vertices[bt*8+4]=Q+pt.width*e,Pt.vertices[bt*8+5]=S+pt.height*e,Pt.vertices[bt*8+6]=Q,Pt.vertices[bt*8+7]=S+pt.height*e,Pt.uvs[bt*8+0]=Wt.x0,Pt.uvs[bt*8+1]=Wt.y0,Pt.uvs[bt*8+2]=Wt.x1,Pt.uvs[bt*8+3]=Wt.y1,Pt.uvs[bt*8+4]=Wt.x2,Pt.uvs[bt*8+5]=Wt.y2,Pt.uvs[bt*8+6]=Wt.x3,Pt.uvs[bt*8+7]=Wt.y3}this._textWidth=p*e,this._textHeight=(r.y+i.lineHeight)*e;for(const rt in j){const gt=j[rt];if(this.anchor.x!==0||this.anchor.y!==0){let ut=0;const Pt=this._textWidth*this.anchor.x,pt=this._textHeight*this.anchor.y;for(let Wt=0;Wt<gt.total;Wt++)gt.vertices[ut++]-=Pt,gt.vertices[ut++]-=pt,gt.vertices[ut++]-=Pt,gt.vertices[ut++]-=pt,gt.vertices[ut++]-=Pt,gt.vertices[ut++]-=pt,gt.vertices[ut++]-=Pt,gt.vertices[ut++]-=pt}this._maxLineHeight=T*e;const X=gt.mesh.geometry.getBuffer("aVertexPosition"),Q=gt.mesh.geometry.getBuffer("aTextureCoord"),S=gt.mesh.geometry.getIndex();X.data=gt.vertices,Q.data=gt.uvs,S.data=gt.indices,X.update(),Q.update(),S.update()}for(let rt=0;rt<n.length;rt++)Xg.push(n[rt]);this._font=i,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:e,size:r}=Ji.available[this._fontName];if(e!=="none"){const{a:n,b:s,c:a,d:o}=this.worldTransform,u=Math.sqrt(n*n+s*s),d=Math.sqrt(a*a+o*o),m=(Math.abs(u)+Math.abs(d))/2,l=this.fontSize/r,f=i._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=m*t*l*f}super._render(i)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const i=Ji.available[this._fontName];if(!i)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==i&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(i){if(this._tint!==i){this._tint=i;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=i}}get align(){return this._align}set align(i){this._align!==i&&(this._align=i,this.dirty=!0)}get fontName(){return this._fontName}set fontName(i){if(!Ji.available[i])throw new Error(`Missing BitmapFont "${i}"`);this._fontName!==i&&(this._fontName=i,this.dirty=!0)}get fontSize(){return this._fontSize??Ji.available[this._fontName].size}set fontSize(i){this._fontSize!==i&&(this._fontSize=i,this.dirty=!0)}get anchor(){return this._anchor}set anchor(i){typeof i=="number"?this._anchor.set(i):this._anchor.copyFrom(i)}get text(){return this._text}set text(i){i=String(i??""),this._text!==i&&(this._text=i,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(i){this._maxWidth!==i&&(this._maxWidth=i,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(i){this._letterSpacing!==i&&(this._letterSpacing=i,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(i){i!==this._roundPixels&&(this._roundPixels=i,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}destroy(i){const{_textureCache:t}=this,r=Ji.available[this._fontName].distanceFieldType==="none"?zg:Vg;r.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],r.filter(n=>t[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=Ht.EMPTY});for(const n in t)t[n].destroy(),delete t[n];this._font=null,this._textureCache=null,super.destroy(i)}};let Je=Ny;Je.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const $2=[".xml",".fnt"],Z2={extension:{type:Jt.LoadParser,priority:En.Normal},test(i){return $2.includes(qi.extname(i))},async testParse(i){return hc.test(i)||hf.test(i)},async parse(i,t,e){const r=hc.test(i)?hc.parse(i):hf.parse(i),{src:n}=t,{page:s}=r,a=[];for(let d=0;d<s.length;++d){const m=s[d].file,l=qi.join(qi.dirname(n),m);a.push(l)}const o=await e.load(a),u=a.map(d=>o[d]);return Ji.install(r,u,!0)},async load(i,t){return(await Xt.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};le.add(Z2);var Uy={exports:{}};(function(i){(function(){function t(I,N,mt){return I.call.apply(I.bind,arguments)}function e(I,N,mt){if(!I)throw Error();if(2<arguments.length){var yt=Array.prototype.slice.call(arguments,2);return function(){var Ct=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ct,yt),I.apply(N,Ct)}}return function(){return I.apply(N,arguments)}}function r(I,N,mt){return r=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?t:e,r.apply(null,arguments)}var n=Date.now||function(){return+new Date};function s(I,N){this.a=I,this.o=N||I,this.c=this.o.document}var a=!!window.FontFace;function o(I,N,mt,yt){if(N=I.c.createElement(N),mt)for(var Ct in mt)mt.hasOwnProperty(Ct)&&(Ct=="style"?N.style.cssText=mt[Ct]:N.setAttribute(Ct,mt[Ct]));return yt&&N.appendChild(I.c.createTextNode(yt)),N}function u(I,N,mt){I=I.c.getElementsByTagName(N)[0],I||(I=document.documentElement),I.insertBefore(mt,I.lastChild)}function d(I){I.parentNode&&I.parentNode.removeChild(I)}function m(I,N,mt){N=N||[],mt=mt||[];for(var yt=I.className.split(/\s+/),Ct=0;Ct<N.length;Ct+=1){for(var zt=!1,Vt=0;Vt<yt.length;Vt+=1)if(N[Ct]===yt[Vt]){zt=!0;break}zt||yt.push(N[Ct])}for(N=[],Ct=0;Ct<yt.length;Ct+=1){for(zt=!1,Vt=0;Vt<mt.length;Vt+=1)if(yt[Ct]===mt[Vt]){zt=!0;break}zt||N.push(yt[Ct])}I.className=N.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function l(I,N){for(var mt=I.className.split(/\s+/),yt=0,Ct=mt.length;yt<Ct;yt++)if(mt[yt]==N)return!0;return!1}function f(I){return I.o.location.hostname||I.a.location.hostname}function p(I,N,mt){function yt(){xe&&Ct&&zt&&(xe(Vt),xe=null)}N=o(I,"link",{rel:"stylesheet",href:N,media:"all"});var Ct=!1,zt=!0,Vt=null,xe=mt||null;a?(N.onload=function(){Ct=!0,yt()},N.onerror=function(){Ct=!0,Vt=Error("Stylesheet failed to load"),yt()}):setTimeout(function(){Ct=!0,yt()},0),u(I,"head",N)}function y(I,N,mt,yt){var Ct=I.c.getElementsByTagName("head")[0];if(Ct){var zt=o(I,"script",{src:N}),Vt=!1;return zt.onload=zt.onreadystatechange=function(){Vt||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(Vt=!0,mt&&mt(null),zt.onload=zt.onreadystatechange=null,zt.parentNode.tagName=="HEAD"&&Ct.removeChild(zt))},Ct.appendChild(zt),setTimeout(function(){Vt||(Vt=!0,mt&&mt(Error("Script load timeout")))},yt||5e3),zt}return null}function v(){this.a=0,this.c=null}function _(I){return I.a++,function(){I.a--,T(I)}}function w(I,N){I.c=N,T(I)}function T(I){I.a==0&&I.c&&(I.c(),I.c=null)}function E(I){this.a=I||"-"}E.prototype.c=function(I){for(var N=[],mt=0;mt<arguments.length;mt++)N.push(arguments[mt].replace(/[\W_]+/g,"").toLowerCase());return N.join(this.a)};function R(I,N){this.c=I,this.f=4,this.a="n";var mt=(N||"n4").match(/^([nio])([1-9])$/i);mt&&(this.a=mt[1],this.f=parseInt(mt[2],10))}function H(I){return et(I)+" "+(I.f+"00")+" 300px "+Y(I.c)}function Y(I){var N=[];I=I.split(/,\s*/);for(var mt=0;mt<I.length;mt++){var yt=I[mt].replace(/['"]/g,"");yt.indexOf(" ")!=-1||/^\d/.test(yt)?N.push("'"+yt+"'"):N.push(yt)}return N.join(",")}function j(I){return I.a+I.f}function et(I){var N="normal";return I.a==="o"?N="oblique":I.a==="i"&&(N="italic"),N}function J(I){var N=4,mt="n",yt=null;return I&&((yt=I.match(/(normal|oblique|italic)/i))&&yt[1]&&(mt=yt[1].substr(0,1).toLowerCase()),(yt=I.match(/([1-9]00|normal|bold)/i))&&yt[1]&&(/bold/i.test(yt[1])?N=7:/[1-9]00/.test(yt[1])&&(N=parseInt(yt[1].substr(0,1),10)))),mt+N}function rt(I,N){this.c=I,this.f=I.o.document.documentElement,this.h=N,this.a=new E("-"),this.j=N.events!==!1,this.g=N.classes!==!1}function gt(I){I.g&&m(I.f,[I.a.c("wf","loading")]),Q(I,"loading")}function X(I){if(I.g){var N=l(I.f,I.a.c("wf","active")),mt=[],yt=[I.a.c("wf","loading")];N||mt.push(I.a.c("wf","inactive")),m(I.f,mt,yt)}Q(I,"inactive")}function Q(I,N,mt){I.j&&I.h[N]&&(mt?I.h[N](mt.c,j(mt)):I.h[N]())}function S(){this.c={}}function ut(I,N,mt){var yt=[],Ct;for(Ct in N)if(N.hasOwnProperty(Ct)){var zt=I.c[Ct];zt&&yt.push(zt(N[Ct],mt))}return yt}function Pt(I,N){this.c=I,this.f=N,this.a=o(this.c,"span",{"aria-hidden":"true"},this.f)}function pt(I){u(I.c,"body",I.a)}function Wt(I){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+Y(I.c)+";"+("font-style:"+et(I)+";font-weight:"+(I.f+"00")+";")}function bt(I,N,mt,yt,Ct,zt){this.g=I,this.j=N,this.a=yt,this.c=mt,this.f=Ct||3e3,this.h=zt||void 0}bt.prototype.start=function(){var I=this.c.o.document,N=this,mt=n(),yt=new Promise(function(Vt,xe){function Be(){n()-mt>=N.f?xe():I.fonts.load(H(N.a),N.h).then(function(Ne){1<=Ne.length?Vt():setTimeout(Be,25)},function(){xe()})}Be()}),Ct=null,zt=new Promise(function(Vt,xe){Ct=setTimeout(xe,N.f)});Promise.race([zt,yt]).then(function(){Ct&&(clearTimeout(Ct),Ct=null),N.g(N.a)},function(){N.j(N.a)})};function xt(I,N,mt,yt,Ct,zt,Vt){this.v=I,this.B=N,this.c=mt,this.a=yt,this.s=Vt||"BESbswy",this.f={},this.w=Ct||3e3,this.u=zt||null,this.m=this.j=this.h=this.g=null,this.g=new Pt(this.c,this.s),this.h=new Pt(this.c,this.s),this.j=new Pt(this.c,this.s),this.m=new Pt(this.c,this.s),I=new R(this.a.c+",serif",j(this.a)),I=Wt(I),this.g.a.style.cssText=I,I=new R(this.a.c+",sans-serif",j(this.a)),I=Wt(I),this.h.a.style.cssText=I,I=new R("serif",j(this.a)),I=Wt(I),this.j.a.style.cssText=I,I=new R("sans-serif",j(this.a)),I=Wt(I),this.m.a.style.cssText=I,pt(this.g),pt(this.h),pt(this.j),pt(this.m)}var tt={D:"serif",C:"sans-serif"},it=null;function Gt(){if(it===null){var I=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);it=!!I&&(536>parseInt(I[1],10)||parseInt(I[1],10)===536&&11>=parseInt(I[2],10))}return it}xt.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=n(),Mt(this)};function Dt(I,N,mt){for(var yt in tt)if(tt.hasOwnProperty(yt)&&N===I.f[tt[yt]]&&mt===I.f[tt[yt]])return!0;return!1}function Mt(I){var N=I.g.a.offsetWidth,mt=I.h.a.offsetWidth,yt;(yt=N===I.f.serif&&mt===I.f["sans-serif"])||(yt=Gt()&&Dt(I,N,mt)),yt?n()-I.A>=I.w?Gt()&&Dt(I,N,mt)&&(I.u===null||I.u.hasOwnProperty(I.a.c))?re(I,I.v):re(I,I.B):te(I):re(I,I.v)}function te(I){setTimeout(r(function(){Mt(this)},I),50)}function re(I,N){setTimeout(r(function(){d(this.g.a),d(this.h.a),d(this.j.a),d(this.m.a),N(this.a)},I),0)}function jt(I,N,mt){this.c=I,this.a=N,this.f=0,this.m=this.j=!1,this.s=mt}var qt=null;jt.prototype.g=function(I){var N=this.a;N.g&&m(N.f,[N.a.c("wf",I.c,j(I).toString(),"active")],[N.a.c("wf",I.c,j(I).toString(),"loading"),N.a.c("wf",I.c,j(I).toString(),"inactive")]),Q(N,"fontactive",I),this.m=!0,ce(this)},jt.prototype.h=function(I){var N=this.a;if(N.g){var mt=l(N.f,N.a.c("wf",I.c,j(I).toString(),"active")),yt=[],Ct=[N.a.c("wf",I.c,j(I).toString(),"loading")];mt||yt.push(N.a.c("wf",I.c,j(I).toString(),"inactive")),m(N.f,yt,Ct)}Q(N,"fontinactive",I),ce(this)};function ce(I){--I.f==0&&I.j&&(I.m?(I=I.a,I.g&&m(I.f,[I.a.c("wf","active")],[I.a.c("wf","loading"),I.a.c("wf","inactive")]),Q(I,"active")):X(I.a))}function ne(I){this.j=I,this.a=new S,this.h=0,this.f=this.g=!0}ne.prototype.load=function(I){this.c=new s(this.j,I.context||this.j),this.g=I.events!==!1,this.f=I.classes!==!1,pe(this,new rt(this.c,I),I)};function _e(I,N,mt,yt,Ct){var zt=--I.h==0;(I.f||I.g)&&setTimeout(function(){var Vt=Ct||null,xe=yt||null||{};if(mt.length===0&&zt)X(N.a);else{N.f+=mt.length,zt&&(N.j=zt);var Be,Ne=[];for(Be=0;Be<mt.length;Be++){var ke=mt[Be],Ze=xe[ke.c],Ei=N.a,_r=ke;if(Ei.g&&m(Ei.f,[Ei.a.c("wf",_r.c,j(_r).toString(),"loading")]),Q(Ei,"fontloading",_r),Ei=null,qt===null)if(window.FontFace){var _r=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),as=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);qt=_r?42<parseInt(_r[1],10):!as}else qt=!1;qt?Ei=new bt(r(N.g,N),r(N.h,N),N.c,ke,N.s,Ze):Ei=new xt(r(N.g,N),r(N.h,N),N.c,ke,N.s,Vt,Ze),Ne.push(Ei)}for(Be=0;Be<Ne.length;Be++)Ne[Be].start()}},0)}function pe(I,N,mt){var Ct=[],yt=mt.timeout;gt(N);var Ct=ut(I.a,mt,I.c),zt=new jt(I.c,N,yt);for(I.h=Ct.length,N=0,mt=Ct.length;N<mt;N++)Ct[N].load(function(Vt,xe,Be){_e(I,zt,Vt,xe,Be)})}function C(I,N){this.c=I,this.a=N}C.prototype.load=function(I){function N(){if(zt["__mti_fntLst"+yt]){var Vt=zt["__mti_fntLst"+yt](),xe=[],Be;if(Vt)for(var Ne=0;Ne<Vt.length;Ne++){var ke=Vt[Ne].fontfamily;Vt[Ne].fontStyle!=null&&Vt[Ne].fontWeight!=null?(Be=Vt[Ne].fontStyle+Vt[Ne].fontWeight,xe.push(new R(ke,Be))):xe.push(new R(ke))}I(xe)}else setTimeout(function(){N()},50)}var mt=this,yt=mt.a.projectId,Ct=mt.a.version;if(yt){var zt=mt.c.o;y(this.c,(mt.a.api||"https://fast.fonts.net/jsapi")+"/"+yt+".js"+(Ct?"?v="+Ct:""),function(Vt){Vt?I([]):(zt["__MonotypeConfiguration__"+yt]=function(){return mt.a},N())}).id="__MonotypeAPIScript__"+yt}else I([])};function At(I,N){this.c=I,this.a=N}At.prototype.load=function(I){var N,mt,yt=this.a.urls||[],Ct=this.a.families||[],zt=this.a.testStrings||{},Vt=new v;for(N=0,mt=yt.length;N<mt;N++)p(this.c,yt[N],_(Vt));var xe=[];for(N=0,mt=Ct.length;N<mt;N++)if(yt=Ct[N].split(":"),yt[1])for(var Be=yt[1].split(","),Ne=0;Ne<Be.length;Ne+=1)xe.push(new R(yt[0],Be[Ne]));else xe.push(new R(yt[0]));w(Vt,function(){I(xe,zt)})};function vt(I,N){I?this.c=I:this.c=K,this.a=[],this.f=[],this.g=N||""}var K="https://fonts.googleapis.com/css";function V(I,N){for(var mt=N.length,yt=0;yt<mt;yt++){var Ct=N[yt].split(":");Ct.length==3&&I.f.push(Ct.pop());var zt="";Ct.length==2&&Ct[1]!=""&&(zt=":"),I.a.push(Ct.join(zt))}}function lt(I){if(I.a.length==0)throw Error("No fonts to load!");if(I.c.indexOf("kit=")!=-1)return I.c;for(var N=I.a.length,mt=[],yt=0;yt<N;yt++)mt.push(I.a[yt].replace(/ /g,"+"));return N=I.c+"?family="+mt.join("%7C"),0<I.f.length&&(N+="&subset="+I.f.join(",")),0<I.g.length&&(N+="&text="+encodeURIComponent(I.g)),N}function Et(I){this.f=I,this.a=[],this.c={}}var Tt={latin:"BESbswy","latin-ext":"\xE7\xF6\xFC\u011F\u015F",cyrillic:"\u0439\u044F\u0416",greek:"\u03B1\u03B2\u03A3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},at={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Ut={i:"i",italic:"i",n:"n",normal:"n"},$t=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Lt(I){for(var N=I.f.length,mt=0;mt<N;mt++){var yt=I.f[mt].split(":"),Ct=yt[0].replace(/\+/g," "),zt=["n4"];if(2<=yt.length){var Vt,xe=yt[1];if(Vt=[],xe)for(var xe=xe.split(","),Be=xe.length,Ne=0;Ne<Be;Ne++){var ke;if(ke=xe[Ne],ke.match(/^[\w-]+$/)){var Ze=$t.exec(ke.toLowerCase());if(Ze==null)ke="";else{if(ke=Ze[2],ke=ke==null||ke==""?"n":Ut[ke],Ze=Ze[1],Ze==null||Ze=="")Ze="4";else var Ei=at[Ze],Ze=Ei||(isNaN(Ze)?"4":Ze.substr(0,1));ke=[ke,Ze].join("")}}else ke="";ke&&Vt.push(ke)}0<Vt.length&&(zt=Vt),yt.length==3&&(yt=yt[2],Vt=[],yt=yt?yt.split(","):Vt,0<yt.length&&(yt=Tt[yt[0]])&&(I.c[Ct]=yt))}for(I.c[Ct]||(yt=Tt[Ct])&&(I.c[Ct]=yt),yt=0;yt<zt.length;yt+=1)I.a.push(new R(Ct,zt[yt]))}}function ee(I,N){this.c=I,this.a=N}var L={Arimo:!0,Cousine:!0,Tinos:!0};ee.prototype.load=function(I){var N=new v,mt=this.c,yt=new vt(this.a.api,this.a.text),Ct=this.a.families;V(yt,Ct);var zt=new Et(Ct);Lt(zt),p(mt,lt(yt),_(N)),w(N,function(){I(zt.a,zt.c,L)})};function b(I,N){this.c=I,this.a=N}b.prototype.load=function(I){var N=this.a.id,mt=this.c.o;N?y(this.c,(this.a.api||"https://use.typekit.net")+"/"+N+".js",function(yt){if(yt)I([]);else if(mt.Typekit&&mt.Typekit.config&&mt.Typekit.config.fn){yt=mt.Typekit.config.fn;for(var Ct=[],zt=0;zt<yt.length;zt+=2)for(var Vt=yt[zt],xe=yt[zt+1],Be=0;Be<xe.length;Be++)Ct.push(new R(Vt,xe[Be]));try{mt.Typekit.load({events:!1,classes:!1,async:!0})}catch{}I(Ct)}},2e3):I([])};function A(I,N){this.c=I,this.f=N,this.a=[]}A.prototype.load=function(I){var N=this.f.id,mt=this.c.o,yt=this;N?(mt.__webfontfontdeckmodule__||(mt.__webfontfontdeckmodule__={}),mt.__webfontfontdeckmodule__[N]=function(Ct,zt){for(var Vt=0,xe=zt.fonts.length;Vt<xe;++Vt){var Be=zt.fonts[Vt];yt.a.push(new R(Be.name,J("font-weight:"+Be.weight+";font-style:"+Be.style)))}I(yt.a)},y(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+f(this.c)+"/"+N+".js",function(Ct){Ct&&I([])})):I([])};var z=new ne(window);z.a.c.custom=function(I,N){return new At(N,I)},z.a.c.fontdeck=function(I,N){return new A(N,I)},z.a.c.monotype=function(I,N){return new C(N,I)},z.a.c.typekit=function(I,N){return new b(N,I)},z.a.c.google=function(I,N){return new ee(N,I)};var nt={load:r(z.load,z)};i.exports?i.exports=nt:(window.WebFont=nt,window.WebFontConfig&&z.load(window.WebFontConfig))})()})(Uy);const Q2=Uy.exports;var ua={};/*! howler.js v2.2.3 | (c) 2013-2020, James Simpson of GoldFire Studios | MIT License | howlerjs.com */(function(i){(function(){var t=function(){this.init()};t.prototype={init:function(){var l=this||e;return l._counter=1e3,l._html5AudioPool=[],l.html5PoolSize=10,l._codecs={},l._howls=[],l._muted=!1,l._volume=1,l._canPlayEvent="canplaythrough",l._navigator=typeof window<"u"&&window.navigator?window.navigator:null,l.masterGain=null,l.noAudio=!1,l.usingWebAudio=!0,l.autoSuspend=!0,l.ctx=null,l.autoUnlock=!0,l._setup(),l},volume:function(l){var f=this||e;if(l=parseFloat(l),f.ctx||m(),l!==void 0&&l>=0&&l<=1){if(f._volume=l,f._muted)return f;f.usingWebAudio&&f.masterGain.gain.setValueAtTime(l,e.ctx.currentTime);for(var p=0;p<f._howls.length;p++)if(!f._howls[p]._webAudio)for(var y=f._howls[p]._getSoundIds(),v=0;v<y.length;v++){var _=f._howls[p]._soundById(y[v]);_&&_._node&&(_._node.volume=_._volume*l)}return f}return f._volume},mute:function(l){var f=this||e;f.ctx||m(),f._muted=l,f.usingWebAudio&&f.masterGain.gain.setValueAtTime(l?0:f._volume,e.ctx.currentTime);for(var p=0;p<f._howls.length;p++)if(!f._howls[p]._webAudio)for(var y=f._howls[p]._getSoundIds(),v=0;v<y.length;v++){var _=f._howls[p]._soundById(y[v]);_&&_._node&&(_._node.muted=!!l||_._muted)}return f},stop:function(){for(var l=this||e,f=0;f<l._howls.length;f++)l._howls[f].stop();return l},unload:function(){for(var l=this||e,f=l._howls.length-1;f>=0;f--)l._howls[f].unload();return l.usingWebAudio&&l.ctx&&l.ctx.close!==void 0&&(l.ctx.close(),l.ctx=null,m()),l},codecs:function(l){return(this||e)._codecs[l.replace(/^x-/,"")]},_setup:function(){var l=this||e;if(l.state=l.ctx&&l.ctx.state||"suspended",l._autoSuspend(),!l.usingWebAudio)if(typeof Audio<"u")try{var f=new Audio;f.oncanplaythrough===void 0&&(l._canPlayEvent="canplay")}catch{l.noAudio=!0}else l.noAudio=!0;try{var f=new Audio;f.muted&&(l.noAudio=!0)}catch{}return l.noAudio||l._setupCodecs(),l},_setupCodecs:function(){var l=this||e,f=null;try{f=typeof Audio<"u"?new Audio:null}catch{return l}if(!f||typeof f.canPlayType!="function")return l;var p=f.canPlayType("audio/mpeg;").replace(/^no$/,""),y=l._navigator?l._navigator.userAgent:"",v=y.match(/OPR\/([0-6].)/g),_=v&&parseInt(v[0].split("/")[1],10)<33,w=y.indexOf("Safari")!==-1&&y.indexOf("Chrome")===-1,T=y.match(/Version\/(.*?) /),E=w&&T&&parseInt(T[1],10)<15;return l._codecs={mp3:!(_||!p&&!f.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!p,opus:!!f.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(f.canPlayType('audio/wav; codecs="1"')||f.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!f.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!f.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(f.canPlayType("audio/x-m4a;")||f.canPlayType("audio/m4a;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(f.canPlayType("audio/x-m4b;")||f.canPlayType("audio/m4b;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(f.canPlayType("audio/x-mp4;")||f.canPlayType("audio/mp4;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(E||!f.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(E||!f.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!f.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(f.canPlayType("audio/x-flac;")||f.canPlayType("audio/flac;")).replace(/^no$/,"")},l},_unlockAudio:function(){var l=this||e;if(!l._audioUnlocked&&l.ctx){l._audioUnlocked=!1,l.autoUnlock=!1,l._mobileUnloaded||l.ctx.sampleRate===44100||(l._mobileUnloaded=!0,l.unload()),l._scratchBuffer=l.ctx.createBuffer(1,1,22050);var f=function(p){for(;l._html5AudioPool.length<l.html5PoolSize;)try{var y=new Audio;y._unlocked=!0,l._releaseHtml5Audio(y)}catch{l.noAudio=!0;break}for(var v=0;v<l._howls.length;v++)if(!l._howls[v]._webAudio)for(var _=l._howls[v]._getSoundIds(),w=0;w<_.length;w++){var T=l._howls[v]._soundById(_[w]);T&&T._node&&!T._node._unlocked&&(T._node._unlocked=!0,T._node.load())}l._autoResume();var E=l.ctx.createBufferSource();E.buffer=l._scratchBuffer,E.connect(l.ctx.destination),E.start===void 0?E.noteOn(0):E.start(0),typeof l.ctx.resume=="function"&&l.ctx.resume(),E.onended=function(){E.disconnect(0),l._audioUnlocked=!0,document.removeEventListener("touchstart",f,!0),document.removeEventListener("touchend",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("keydown",f,!0);for(var R=0;R<l._howls.length;R++)l._howls[R]._emit("unlock")}};return document.addEventListener("touchstart",f,!0),document.addEventListener("touchend",f,!0),document.addEventListener("click",f,!0),document.addEventListener("keydown",f,!0),l}},_obtainHtml5Audio:function(){var l=this||e;if(l._html5AudioPool.length)return l._html5AudioPool.pop();var f=new Audio().play();return f&&typeof Promise<"u"&&(f instanceof Promise||typeof f.then=="function")&&f.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(l){var f=this||e;return l._unlocked&&f._html5AudioPool.push(l),f},_autoSuspend:function(){var l=this;if(l.autoSuspend&&l.ctx&&l.ctx.suspend!==void 0&&e.usingWebAudio){for(var f=0;f<l._howls.length;f++)if(l._howls[f]._webAudio){for(var p=0;p<l._howls[f]._sounds.length;p++)if(!l._howls[f]._sounds[p]._paused)return l}return l._suspendTimer&&clearTimeout(l._suspendTimer),l._suspendTimer=setTimeout(function(){if(l.autoSuspend){l._suspendTimer=null,l.state="suspending";var y=function(){l.state="suspended",l._resumeAfterSuspend&&(delete l._resumeAfterSuspend,l._autoResume())};l.ctx.suspend().then(y,y)}},3e4),l}},_autoResume:function(){var l=this;if(l.ctx&&l.ctx.resume!==void 0&&e.usingWebAudio)return l.state==="running"&&l.ctx.state!=="interrupted"&&l._suspendTimer?(clearTimeout(l._suspendTimer),l._suspendTimer=null):l.state==="suspended"||l.state==="running"&&l.ctx.state==="interrupted"?(l.ctx.resume().then(function(){l.state="running";for(var f=0;f<l._howls.length;f++)l._howls[f]._emit("resume")}),l._suspendTimer&&(clearTimeout(l._suspendTimer),l._suspendTimer=null)):l.state==="suspending"&&(l._resumeAfterSuspend=!0),l}};var e=new t,r=function(l){var f=this;if(!l.src||l.src.length===0)return void console.error("An array of source files must be passed with any new Howl.");f.init(l)};r.prototype={init:function(l){var f=this;return e.ctx||m(),f._autoplay=l.autoplay||!1,f._format=typeof l.format!="string"?l.format:[l.format],f._html5=l.html5||!1,f._muted=l.mute||!1,f._loop=l.loop||!1,f._pool=l.pool||5,f._preload=typeof l.preload!="boolean"&&l.preload!=="metadata"||l.preload,f._rate=l.rate||1,f._sprite=l.sprite||{},f._src=typeof l.src!="string"?l.src:[l.src],f._volume=l.volume!==void 0?l.volume:1,f._xhr={method:l.xhr&&l.xhr.method?l.xhr.method:"GET",headers:l.xhr&&l.xhr.headers?l.xhr.headers:null,withCredentials:!(!l.xhr||!l.xhr.withCredentials)&&l.xhr.withCredentials},f._duration=0,f._state="unloaded",f._sounds=[],f._endTimers={},f._queue=[],f._playLock=!1,f._onend=l.onend?[{fn:l.onend}]:[],f._onfade=l.onfade?[{fn:l.onfade}]:[],f._onload=l.onload?[{fn:l.onload}]:[],f._onloaderror=l.onloaderror?[{fn:l.onloaderror}]:[],f._onplayerror=l.onplayerror?[{fn:l.onplayerror}]:[],f._onpause=l.onpause?[{fn:l.onpause}]:[],f._onplay=l.onplay?[{fn:l.onplay}]:[],f._onstop=l.onstop?[{fn:l.onstop}]:[],f._onmute=l.onmute?[{fn:l.onmute}]:[],f._onvolume=l.onvolume?[{fn:l.onvolume}]:[],f._onrate=l.onrate?[{fn:l.onrate}]:[],f._onseek=l.onseek?[{fn:l.onseek}]:[],f._onunlock=l.onunlock?[{fn:l.onunlock}]:[],f._onresume=[],f._webAudio=e.usingWebAudio&&!f._html5,e.ctx!==void 0&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(f),f._autoplay&&f._queue.push({event:"play",action:function(){f.play()}}),f._preload&&f._preload!=="none"&&f.load(),f},load:function(){var l=this,f=null;if(e.noAudio)return void l._emit("loaderror",null,"No audio support.");typeof l._src=="string"&&(l._src=[l._src]);for(var p=0;p<l._src.length;p++){var y,v;if(l._format&&l._format[p])y=l._format[p];else{if(typeof(v=l._src[p])!="string"){l._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}y=/^data:audio\/([^;,]+);/i.exec(v),y||(y=/\.([^.]+)$/.exec(v.split("?",1)[0])),y&&(y=y[1].toLowerCase())}if(y||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),y&&e.codecs(y)){f=l._src[p];break}}return f?(l._src=f,l._state="loading",window.location.protocol==="https:"&&f.slice(0,5)==="http:"&&(l._html5=!0,l._webAudio=!1),new n(l),l._webAudio&&a(l),l):void l._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(l,f){var p=this,y=null;if(typeof l=="number")y=l,l=null;else{if(typeof l=="string"&&p._state==="loaded"&&!p._sprite[l])return null;if(l===void 0&&(l="__default",!p._playLock)){for(var v=0,_=0;_<p._sounds.length;_++)p._sounds[_]._paused&&!p._sounds[_]._ended&&(v++,y=p._sounds[_]._id);v===1?l=null:y=null}}var w=y?p._soundById(y):p._inactiveSound();if(!w)return null;if(y&&!l&&(l=w._sprite||"__default"),p._state!=="loaded"){w._sprite=l,w._ended=!1;var T=w._id;return p._queue.push({event:"play",action:function(){p.play(T)}}),T}if(y&&!w._paused)return f||p._loadQueue("play"),w._id;p._webAudio&&e._autoResume();var E=Math.max(0,w._seek>0?w._seek:p._sprite[l][0]/1e3),R=Math.max(0,(p._sprite[l][0]+p._sprite[l][1])/1e3-E),H=1e3*R/Math.abs(w._rate),Y=p._sprite[l][0]/1e3,j=(p._sprite[l][0]+p._sprite[l][1])/1e3;w._sprite=l,w._ended=!1;var et=function(){w._paused=!1,w._seek=E,w._start=Y,w._stop=j,w._loop=!(!w._loop&&!p._sprite[l][2])};if(E>=j)return void p._ended(w);var J=w._node;if(p._webAudio){var rt=function(){p._playLock=!1,et(),p._refreshBuffer(w);var S=w._muted||p._muted?0:w._volume;J.gain.setValueAtTime(S,e.ctx.currentTime),w._playStart=e.ctx.currentTime,J.bufferSource.start===void 0?w._loop?J.bufferSource.noteGrainOn(0,E,86400):J.bufferSource.noteGrainOn(0,E,R):w._loop?J.bufferSource.start(0,E,86400):J.bufferSource.start(0,E,R),H!==1/0&&(p._endTimers[w._id]=setTimeout(p._ended.bind(p,w),H)),f||setTimeout(function(){p._emit("play",w._id),p._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?rt():(p._playLock=!0,p.once("resume",rt),p._clearTimer(w._id))}else{var gt=function(){J.currentTime=E,J.muted=w._muted||p._muted||e._muted||J.muted,J.volume=w._volume*e.volume(),J.playbackRate=w._rate;try{var S=J.play();if(S&&typeof Promise<"u"&&(S instanceof Promise||typeof S.then=="function")?(p._playLock=!0,et(),S.then(function(){p._playLock=!1,J._unlocked=!0,f?p._loadQueue():p._emit("play",w._id)}).catch(function(){p._playLock=!1,p._emit("playerror",w._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),w._ended=!0,w._paused=!0})):f||(p._playLock=!1,et(),p._emit("play",w._id)),J.playbackRate=w._rate,J.paused)return void p._emit("playerror",w._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");l!=="__default"||w._loop?p._endTimers[w._id]=setTimeout(p._ended.bind(p,w),H):(p._endTimers[w._id]=function(){p._ended(w),J.removeEventListener("ended",p._endTimers[w._id],!1)},J.addEventListener("ended",p._endTimers[w._id],!1))}catch(ut){p._emit("playerror",w._id,ut)}};J.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(J.src=p._src,J.load());var X=window&&window.ejecta||!J.readyState&&e._navigator.isCocoonJS;if(J.readyState>=3||X)gt();else{p._playLock=!0,p._state="loading";var Q=function(){p._state="loaded",gt(),J.removeEventListener(e._canPlayEvent,Q,!1)};J.addEventListener(e._canPlayEvent,Q,!1),p._clearTimer(w._id)}}return w._id},pause:function(l){var f=this;if(f._state!=="loaded"||f._playLock)return f._queue.push({event:"pause",action:function(){f.pause(l)}}),f;for(var p=f._getSoundIds(l),y=0;y<p.length;y++){f._clearTimer(p[y]);var v=f._soundById(p[y]);if(v&&!v._paused&&(v._seek=f.seek(p[y]),v._rateSeek=0,v._paused=!0,f._stopFade(p[y]),v._node))if(f._webAudio){if(!v._node.bufferSource)continue;v._node.bufferSource.stop===void 0?v._node.bufferSource.noteOff(0):v._node.bufferSource.stop(0),f._cleanBuffer(v._node)}else isNaN(v._node.duration)&&v._node.duration!==1/0||v._node.pause();arguments[1]||f._emit("pause",v?v._id:null)}return f},stop:function(l,f){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(l)}}),p;for(var y=p._getSoundIds(l),v=0;v<y.length;v++){p._clearTimer(y[v]);var _=p._soundById(y[v]);_&&(_._seek=_._start||0,_._rateSeek=0,_._paused=!0,_._ended=!0,p._stopFade(y[v]),_._node&&(p._webAudio?_._node.bufferSource&&(_._node.bufferSource.stop===void 0?_._node.bufferSource.noteOff(0):_._node.bufferSource.stop(0),p._cleanBuffer(_._node)):isNaN(_._node.duration)&&_._node.duration!==1/0||(_._node.currentTime=_._start||0,_._node.pause(),_._node.duration===1/0&&p._clearSound(_._node))),f||p._emit("stop",_._id))}return p},mute:function(l,f){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(l,f)}}),p;if(f===void 0){if(typeof l!="boolean")return p._muted;p._muted=l}for(var y=p._getSoundIds(f),v=0;v<y.length;v++){var _=p._soundById(y[v]);_&&(_._muted=l,_._interval&&p._stopFade(_._id),p._webAudio&&_._node?_._node.gain.setValueAtTime(l?0:_._volume,e.ctx.currentTime):_._node&&(_._node.muted=!!e._muted||l),p._emit("mute",_._id))}return p},volume:function(){var l,f,p=this,y=arguments;if(y.length===0)return p._volume;y.length===1||y.length===2&&y[1]===void 0?p._getSoundIds().indexOf(y[0])>=0?f=parseInt(y[0],10):l=parseFloat(y[0]):y.length>=2&&(l=parseFloat(y[0]),f=parseInt(y[1],10));var v;if(!(l!==void 0&&l>=0&&l<=1))return v=f?p._soundById(f):p._sounds[0],v?v._volume:0;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"volume",action:function(){p.volume.apply(p,y)}}),p;f===void 0&&(p._volume=l),f=p._getSoundIds(f);for(var _=0;_<f.length;_++)(v=p._soundById(f[_]))&&(v._volume=l,y[2]||p._stopFade(f[_]),p._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(l,e.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=l*e.volume()),p._emit("volume",v._id));return p},fade:function(l,f,p,y){var v=this;if(v._state!=="loaded"||v._playLock)return v._queue.push({event:"fade",action:function(){v.fade(l,f,p,y)}}),v;l=Math.min(Math.max(0,parseFloat(l)),1),f=Math.min(Math.max(0,parseFloat(f)),1),p=parseFloat(p),v.volume(l,y);for(var _=v._getSoundIds(y),w=0;w<_.length;w++){var T=v._soundById(_[w]);if(T){if(y||v._stopFade(_[w]),v._webAudio&&!T._muted){var E=e.ctx.currentTime,R=E+p/1e3;T._volume=l,T._node.gain.setValueAtTime(l,E),T._node.gain.linearRampToValueAtTime(f,R)}v._startFadeInterval(T,l,f,p,_[w],y===void 0)}}return v},_startFadeInterval:function(l,f,p,y,v,_){var w=this,T=f,E=p-f,R=Math.abs(E/.01),H=Math.max(4,R>0?y/R:y),Y=Date.now();l._fadeTo=p,l._interval=setInterval(function(){var j=(Date.now()-Y)/y;Y=Date.now(),T+=E*j,T=Math.round(100*T)/100,T=E<0?Math.max(p,T):Math.min(p,T),w._webAudio?l._volume=T:w.volume(T,l._id,!0),_&&(w._volume=T),(p<f&&T<=p||p>f&&T>=p)&&(clearInterval(l._interval),l._interval=null,l._fadeTo=null,w.volume(p,l._id),w._emit("fade",l._id))},H)},_stopFade:function(l){var f=this,p=f._soundById(l);return p&&p._interval&&(f._webAudio&&p._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(p._interval),p._interval=null,f.volume(p._fadeTo,l),p._fadeTo=null,f._emit("fade",l)),f},loop:function(){var l,f,p,y=this,v=arguments;if(v.length===0)return y._loop;if(v.length===1){if(typeof v[0]!="boolean")return!!(p=y._soundById(parseInt(v[0],10)))&&p._loop;l=v[0],y._loop=l}else v.length===2&&(l=v[0],f=parseInt(v[1],10));for(var _=y._getSoundIds(f),w=0;w<_.length;w++)(p=y._soundById(_[w]))&&(p._loop=l,y._webAudio&&p._node&&p._node.bufferSource&&(p._node.bufferSource.loop=l,l&&(p._node.bufferSource.loopStart=p._start||0,p._node.bufferSource.loopEnd=p._stop,y.playing(_[w])&&(y.pause(_[w],!0),y.play(_[w],!0)))));return y},rate:function(){var l,f,p=this,y=arguments;if(y.length===0)f=p._sounds[0]._id;else if(y.length===1){var v=p._getSoundIds(),_=v.indexOf(y[0]);_>=0?f=parseInt(y[0],10):l=parseFloat(y[0])}else y.length===2&&(l=parseFloat(y[0]),f=parseInt(y[1],10));var w;if(typeof l!="number")return w=p._soundById(f),w?w._rate:p._rate;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"rate",action:function(){p.rate.apply(p,y)}}),p;f===void 0&&(p._rate=l),f=p._getSoundIds(f);for(var T=0;T<f.length;T++)if(w=p._soundById(f[T])){p.playing(f[T])&&(w._rateSeek=p.seek(f[T]),w._playStart=p._webAudio?e.ctx.currentTime:w._playStart),w._rate=l,p._webAudio&&w._node&&w._node.bufferSource?w._node.bufferSource.playbackRate.setValueAtTime(l,e.ctx.currentTime):w._node&&(w._node.playbackRate=l);var E=p.seek(f[T]),R=(p._sprite[w._sprite][0]+p._sprite[w._sprite][1])/1e3-E,H=1e3*R/Math.abs(w._rate);!p._endTimers[f[T]]&&w._paused||(p._clearTimer(f[T]),p._endTimers[f[T]]=setTimeout(p._ended.bind(p,w),H)),p._emit("rate",w._id)}return p},seek:function(){var l,f,p=this,y=arguments;if(y.length===0)p._sounds.length&&(f=p._sounds[0]._id);else if(y.length===1){var v=p._getSoundIds(),_=v.indexOf(y[0]);_>=0?f=parseInt(y[0],10):p._sounds.length&&(f=p._sounds[0]._id,l=parseFloat(y[0]))}else y.length===2&&(l=parseFloat(y[0]),f=parseInt(y[1],10));if(f===void 0)return 0;if(typeof l=="number"&&(p._state!=="loaded"||p._playLock))return p._queue.push({event:"seek",action:function(){p.seek.apply(p,y)}}),p;var w=p._soundById(f);if(w){if(!(typeof l=="number"&&l>=0)){if(p._webAudio){var T=p.playing(f)?e.ctx.currentTime-w._playStart:0,E=w._rateSeek?w._rateSeek-w._seek:0;return w._seek+(E+T*Math.abs(w._rate))}return w._node.currentTime}var R=p.playing(f);R&&p.pause(f,!0),w._seek=l,w._ended=!1,p._clearTimer(f),p._webAudio||!w._node||isNaN(w._node.duration)||(w._node.currentTime=l);var H=function(){R&&p.play(f,!0),p._emit("seek",f)};if(R&&!p._webAudio){var Y=function(){p._playLock?setTimeout(Y,0):H()};setTimeout(Y,0)}else H()}return p},playing:function(l){var f=this;if(typeof l=="number"){var p=f._soundById(l);return!!p&&!p._paused}for(var y=0;y<f._sounds.length;y++)if(!f._sounds[y]._paused)return!0;return!1},duration:function(l){var f=this,p=f._duration,y=f._soundById(l);return y&&(p=f._sprite[y._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var l=this,f=l._sounds,p=0;p<f.length;p++)f[p]._paused||l.stop(f[p]._id),l._webAudio||(l._clearSound(f[p]._node),f[p]._node.removeEventListener("error",f[p]._errorFn,!1),f[p]._node.removeEventListener(e._canPlayEvent,f[p]._loadFn,!1),f[p]._node.removeEventListener("ended",f[p]._endFn,!1),e._releaseHtml5Audio(f[p]._node)),delete f[p]._node,l._clearTimer(f[p]._id);var y=e._howls.indexOf(l);y>=0&&e._howls.splice(y,1);var v=!0;for(p=0;p<e._howls.length;p++)if(e._howls[p]._src===l._src||l._src.indexOf(e._howls[p]._src)>=0){v=!1;break}return s&&v&&delete s[l._src],e.noAudio=!1,l._state="unloaded",l._sounds=[],l=null,null},on:function(l,f,p,y){var v=this,_=v["_on"+l];return typeof f=="function"&&_.push(y?{id:p,fn:f,once:y}:{id:p,fn:f}),v},off:function(l,f,p){var y=this,v=y["_on"+l],_=0;if(typeof f=="number"&&(p=f,f=null),f||p)for(_=0;_<v.length;_++){var w=p===v[_].id;if(f===v[_].fn&&w||!f&&w){v.splice(_,1);break}}else if(l)y["_on"+l]=[];else{var T=Object.keys(y);for(_=0;_<T.length;_++)T[_].indexOf("_on")===0&&Array.isArray(y[T[_]])&&(y[T[_]]=[])}return y},once:function(l,f,p){var y=this;return y.on(l,f,p,1),y},_emit:function(l,f,p){for(var y=this,v=y["_on"+l],_=v.length-1;_>=0;_--)v[_].id&&v[_].id!==f&&l!=="load"||(setTimeout(function(w){w.call(this,f,p)}.bind(y,v[_].fn),0),v[_].once&&y.off(l,v[_].fn,v[_].id));return y._loadQueue(l),y},_loadQueue:function(l){var f=this;if(f._queue.length>0){var p=f._queue[0];p.event===l&&(f._queue.shift(),f._loadQueue()),l||p.action()}return f},_ended:function(l){var f=this,p=l._sprite;if(!f._webAudio&&l._node&&!l._node.paused&&!l._node.ended&&l._node.currentTime<l._stop)return setTimeout(f._ended.bind(f,l),100),f;var y=!(!l._loop&&!f._sprite[p][2]);if(f._emit("end",l._id),!f._webAudio&&y&&f.stop(l._id,!0).play(l._id),f._webAudio&&y){f._emit("play",l._id),l._seek=l._start||0,l._rateSeek=0,l._playStart=e.ctx.currentTime;var v=1e3*(l._stop-l._start)/Math.abs(l._rate);f._endTimers[l._id]=setTimeout(f._ended.bind(f,l),v)}return f._webAudio&&!y&&(l._paused=!0,l._ended=!0,l._seek=l._start||0,l._rateSeek=0,f._clearTimer(l._id),f._cleanBuffer(l._node),e._autoSuspend()),f._webAudio||y||f.stop(l._id,!0),f},_clearTimer:function(l){var f=this;if(f._endTimers[l]){if(typeof f._endTimers[l]!="function")clearTimeout(f._endTimers[l]);else{var p=f._soundById(l);p&&p._node&&p._node.removeEventListener("ended",f._endTimers[l],!1)}delete f._endTimers[l]}return f},_soundById:function(l){for(var f=this,p=0;p<f._sounds.length;p++)if(l===f._sounds[p]._id)return f._sounds[p];return null},_inactiveSound:function(){var l=this;l._drain();for(var f=0;f<l._sounds.length;f++)if(l._sounds[f]._ended)return l._sounds[f].reset();return new n(l)},_drain:function(){var l=this,f=l._pool,p=0,y=0;if(!(l._sounds.length<f)){for(y=0;y<l._sounds.length;y++)l._sounds[y]._ended&&p++;for(y=l._sounds.length-1;y>=0;y--){if(p<=f)return;l._sounds[y]._ended&&(l._webAudio&&l._sounds[y]._node&&l._sounds[y]._node.disconnect(0),l._sounds.splice(y,1),p--)}}},_getSoundIds:function(l){var f=this;if(l===void 0){for(var p=[],y=0;y<f._sounds.length;y++)p.push(f._sounds[y]._id);return p}return[l]},_refreshBuffer:function(l){var f=this;return l._node.bufferSource=e.ctx.createBufferSource(),l._node.bufferSource.buffer=s[f._src],l._panner?l._node.bufferSource.connect(l._panner):l._node.bufferSource.connect(l._node),l._node.bufferSource.loop=l._loop,l._loop&&(l._node.bufferSource.loopStart=l._start||0,l._node.bufferSource.loopEnd=l._stop||0),l._node.bufferSource.playbackRate.setValueAtTime(l._rate,e.ctx.currentTime),f},_cleanBuffer:function(l){var f=this,p=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&l.bufferSource&&(l.bufferSource.onended=null,l.bufferSource.disconnect(0),p))try{l.bufferSource.buffer=e._scratchBuffer}catch{}return l.bufferSource=null,f},_clearSound:function(l){/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent)||(l.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var n=function(l){this._parent=l,this.init()};n.prototype={init:function(){var l=this,f=l._parent;return l._muted=f._muted,l._loop=f._loop,l._volume=f._volume,l._rate=f._rate,l._seek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++e._counter,f._sounds.push(l),l.create(),l},create:function(){var l=this,f=l._parent,p=e._muted||l._muted||l._parent._muted?0:l._volume;return f._webAudio?(l._node=e.ctx.createGain===void 0?e.ctx.createGainNode():e.ctx.createGain(),l._node.gain.setValueAtTime(p,e.ctx.currentTime),l._node.paused=!0,l._node.connect(e.masterGain)):e.noAudio||(l._node=e._obtainHtml5Audio(),l._errorFn=l._errorListener.bind(l),l._node.addEventListener("error",l._errorFn,!1),l._loadFn=l._loadListener.bind(l),l._node.addEventListener(e._canPlayEvent,l._loadFn,!1),l._endFn=l._endListener.bind(l),l._node.addEventListener("ended",l._endFn,!1),l._node.src=f._src,l._node.preload=f._preload===!0?"auto":f._preload,l._node.volume=p*e.volume(),l._node.load()),l},reset:function(){var l=this,f=l._parent;return l._muted=f._muted,l._loop=f._loop,l._volume=f._volume,l._rate=f._rate,l._seek=0,l._rateSeek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++e._counter,l},_errorListener:function(){var l=this;l._parent._emit("loaderror",l._id,l._node.error?l._node.error.code:0),l._node.removeEventListener("error",l._errorFn,!1)},_loadListener:function(){var l=this,f=l._parent;f._duration=Math.ceil(10*l._node.duration)/10,Object.keys(f._sprite).length===0&&(f._sprite={__default:[0,1e3*f._duration]}),f._state!=="loaded"&&(f._state="loaded",f._emit("load"),f._loadQueue()),l._node.removeEventListener(e._canPlayEvent,l._loadFn,!1)},_endListener:function(){var l=this,f=l._parent;f._duration===1/0&&(f._duration=Math.ceil(10*l._node.duration)/10,f._sprite.__default[1]===1/0&&(f._sprite.__default[1]=1e3*f._duration),f._ended(l)),l._node.removeEventListener("ended",l._endFn,!1)}};var s={},a=function(l){var f=l._src;if(s[f])return l._duration=s[f].duration,void d(l);if(/^data:[^;]+;base64,/.test(f)){for(var p=atob(f.split(",")[1]),y=new Uint8Array(p.length),v=0;v<p.length;++v)y[v]=p.charCodeAt(v);u(y.buffer,l)}else{var _=new XMLHttpRequest;_.open(l._xhr.method,f,!0),_.withCredentials=l._xhr.withCredentials,_.responseType="arraybuffer",l._xhr.headers&&Object.keys(l._xhr.headers).forEach(function(w){_.setRequestHeader(w,l._xhr.headers[w])}),_.onload=function(){var w=(_.status+"")[0];if(w!=="0"&&w!=="2"&&w!=="3")return void l._emit("loaderror",null,"Failed loading audio file with status: "+_.status+".");u(_.response,l)},_.onerror=function(){l._webAudio&&(l._html5=!0,l._webAudio=!1,l._sounds=[],delete s[f],l.load())},o(_)}},o=function(l){try{l.send()}catch{l.onerror()}},u=function(l,f){var p=function(){f._emit("loaderror",null,"Decoding audio data failed.")},y=function(v){v&&f._sounds.length>0?(s[f._src]=v,d(f,v)):p()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(l).then(y).catch(p):e.ctx.decodeAudioData(l,y,p)},d=function(l,f){f&&!l._duration&&(l._duration=f.duration),Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,1e3*l._duration]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue())},m=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var l=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),f=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=f?parseInt(f[1],10):null;if(l&&p&&p<9){var y=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!y&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=e.ctx.createGain===void 0?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};i.Howler=e,i.Howl=r,typeof hi<"u"?(hi.HowlerGlobal=t,hi.Howler=e,hi.Howl=r,hi.Sound=n):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=r,window.Sound=n)})()})(ua);const Uc=[".aac",".mid",".midi",".mp3",".oga",".ogg",".opus",".wav",".webm",".weba",".flac",".aiff"],Hy=[".bmp",".gif",".jpeg",".jpg",".png",".tif",".tiff",".webp"];function J2(i){return i.hold==null}function De(i){return i.hold!=null}var Mf={},Hc={};Hc.byteLength=iB;Hc.toByteArray=nB;Hc.fromByteArray=oB;var yn=[],Hr=[],tB=typeof Uint8Array<"u"?Uint8Array:Array,Cd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Qa=0,eB=Cd.length;Qa<eB;++Qa)yn[Qa]=Cd[Qa],Hr[Cd.charCodeAt(Qa)]=Qa;Hr["-".charCodeAt(0)]=62;Hr["_".charCodeAt(0)]=63;function Gy(i){var t=i.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=i.indexOf("=");e===-1&&(e=t);var r=e===t?0:4-e%4;return[e,r]}function iB(i){var t=Gy(i),e=t[0],r=t[1];return(e+r)*3/4-r}function rB(i,t,e){return(t+e)*3/4-e}function nB(i){var t,e=Gy(i),r=e[0],n=e[1],s=new tB(rB(i,r,n)),a=0,o=n>0?r-4:r,u;for(u=0;u<o;u+=4)t=Hr[i.charCodeAt(u)]<<18|Hr[i.charCodeAt(u+1)]<<12|Hr[i.charCodeAt(u+2)]<<6|Hr[i.charCodeAt(u+3)],s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=t&255;return n===2&&(t=Hr[i.charCodeAt(u)]<<2|Hr[i.charCodeAt(u+1)]>>4,s[a++]=t&255),n===1&&(t=Hr[i.charCodeAt(u)]<<10|Hr[i.charCodeAt(u+1)]<<4|Hr[i.charCodeAt(u+2)]>>2,s[a++]=t>>8&255,s[a++]=t&255),s}function sB(i){return yn[i>>18&63]+yn[i>>12&63]+yn[i>>6&63]+yn[i&63]}function aB(i,t,e){for(var r,n=[],s=t;s<e;s+=3)r=(i[s]<<16&16711680)+(i[s+1]<<8&65280)+(i[s+2]&255),n.push(sB(r));return n.join("")}function oB(i){for(var t,e=i.length,r=e%3,n=[],s=16383,a=0,o=e-r;a<o;a+=s)n.push(aB(i,a,a+s>o?o:a+s));return r===1?(t=i[e-1],n.push(yn[t>>2]+yn[t<<4&63]+"==")):r===2&&(t=(i[e-2]<<8)+i[e-1],n.push(yn[t>>10]+yn[t>>4&63]+yn[t<<2&63]+"=")),n.join("")}var If={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */If.read=function(i,t,e,r,n){var s,a,o=n*8-r-1,u=(1<<o)-1,d=u>>1,m=-7,l=e?n-1:0,f=e?-1:1,p=i[t+l];for(l+=f,s=p&(1<<-m)-1,p>>=-m,m+=o;m>0;s=s*256+i[t+l],l+=f,m-=8);for(a=s&(1<<-m)-1,s>>=-m,m+=r;m>0;a=a*256+i[t+l],l+=f,m-=8);if(s===0)s=1-d;else{if(s===u)return a?NaN:(p?-1:1)*(1/0);a=a+Math.pow(2,r),s=s-d}return(p?-1:1)*a*Math.pow(2,s-r)};If.write=function(i,t,e,r,n,s){var a,o,u,d=s*8-n-1,m=(1<<d)-1,l=m>>1,f=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,y=r?1:-1,v=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=m):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),a+l>=1?t+=f/u:t+=f*Math.pow(2,1-l),t*u>=2&&(a++,u/=2),a+l>=m?(o=0,a=m):a+l>=1?(o=(t*u-1)*Math.pow(2,n),a=a+l):(o=t*Math.pow(2,l-1)*Math.pow(2,n),a=0));n>=8;i[e+p]=o&255,p+=y,o/=256,n-=8);for(a=a<<n|o,d+=n;d>0;i[e+p]=a&255,p+=y,a/=256,d-=8);i[e+p-y]|=v*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(i){const t=Hc,e=If,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;i.Buffer=o,i.SlowBuffer=T,i.INSPECT_MAX_BYTES=50;const n=2147483647;i.kMaxLength=n,o.TYPED_ARRAY_SUPPORT=s(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const L=new Uint8Array(1),b={foo:function(){return 42}};return Object.setPrototypeOf(b,Uint8Array.prototype),Object.setPrototypeOf(L,b),L.foo()===42}catch{return!1}}Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(!!o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(!!o.isBuffer(this))return this.byteOffset}});function a(L){if(L>n)throw new RangeError('The value "'+L+'" is invalid for option "size"');const b=new Uint8Array(L);return Object.setPrototypeOf(b,o.prototype),b}function o(L,b,A){if(typeof L=="number"){if(typeof b=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return l(L)}return u(L,b,A)}o.poolSize=8192;function u(L,b,A){if(typeof L=="string")return f(L,b);if(ArrayBuffer.isView(L))return y(L);if(L==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof L);if(at(L,ArrayBuffer)||L&&at(L.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(at(L,SharedArrayBuffer)||L&&at(L.buffer,SharedArrayBuffer)))return v(L,b,A);if(typeof L=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const z=L.valueOf&&L.valueOf();if(z!=null&&z!==L)return o.from(z,b,A);const nt=_(L);if(nt)return nt;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof L[Symbol.toPrimitive]=="function")return o.from(L[Symbol.toPrimitive]("string"),b,A);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof L)}o.from=function(L,b,A){return u(L,b,A)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array);function d(L){if(typeof L!="number")throw new TypeError('"size" argument must be of type number');if(L<0)throw new RangeError('The value "'+L+'" is invalid for option "size"')}function m(L,b,A){return d(L),L<=0?a(L):b!==void 0?typeof A=="string"?a(L).fill(b,A):a(L).fill(b):a(L)}o.alloc=function(L,b,A){return m(L,b,A)};function l(L){return d(L),a(L<0?0:w(L)|0)}o.allocUnsafe=function(L){return l(L)},o.allocUnsafeSlow=function(L){return l(L)};function f(L,b){if((typeof b!="string"||b==="")&&(b="utf8"),!o.isEncoding(b))throw new TypeError("Unknown encoding: "+b);const A=E(L,b)|0;let z=a(A);const nt=z.write(L,b);return nt!==A&&(z=z.slice(0,nt)),z}function p(L){const b=L.length<0?0:w(L.length)|0,A=a(b);for(let z=0;z<b;z+=1)A[z]=L[z]&255;return A}function y(L){if(at(L,Uint8Array)){const b=new Uint8Array(L);return v(b.buffer,b.byteOffset,b.byteLength)}return p(L)}function v(L,b,A){if(b<0||L.byteLength<b)throw new RangeError('"offset" is outside of buffer bounds');if(L.byteLength<b+(A||0))throw new RangeError('"length" is outside of buffer bounds');let z;return b===void 0&&A===void 0?z=new Uint8Array(L):A===void 0?z=new Uint8Array(L,b):z=new Uint8Array(L,b,A),Object.setPrototypeOf(z,o.prototype),z}function _(L){if(o.isBuffer(L)){const b=w(L.length)|0,A=a(b);return A.length===0||L.copy(A,0,0,b),A}if(L.length!==void 0)return typeof L.length!="number"||Ut(L.length)?a(0):p(L);if(L.type==="Buffer"&&Array.isArray(L.data))return p(L.data)}function w(L){if(L>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return L|0}function T(L){return+L!=L&&(L=0),o.alloc(+L)}o.isBuffer=function(b){return b!=null&&b._isBuffer===!0&&b!==o.prototype},o.compare=function(b,A){if(at(b,Uint8Array)&&(b=o.from(b,b.offset,b.byteLength)),at(A,Uint8Array)&&(A=o.from(A,A.offset,A.byteLength)),!o.isBuffer(b)||!o.isBuffer(A))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(b===A)return 0;let z=b.length,nt=A.length;for(let I=0,N=Math.min(z,nt);I<N;++I)if(b[I]!==A[I]){z=b[I],nt=A[I];break}return z<nt?-1:nt<z?1:0},o.isEncoding=function(b){switch(String(b).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(b,A){if(!Array.isArray(b))throw new TypeError('"list" argument must be an Array of Buffers');if(b.length===0)return o.alloc(0);let z;if(A===void 0)for(A=0,z=0;z<b.length;++z)A+=b[z].length;const nt=o.allocUnsafe(A);let I=0;for(z=0;z<b.length;++z){let N=b[z];if(at(N,Uint8Array))I+N.length>nt.length?(o.isBuffer(N)||(N=o.from(N)),N.copy(nt,I)):Uint8Array.prototype.set.call(nt,N,I);else if(o.isBuffer(N))N.copy(nt,I);else throw new TypeError('"list" argument must be an Array of Buffers');I+=N.length}return nt};function E(L,b){if(o.isBuffer(L))return L.length;if(ArrayBuffer.isView(L)||at(L,ArrayBuffer))return L.byteLength;if(typeof L!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof L);const A=L.length,z=arguments.length>2&&arguments[2]===!0;if(!z&&A===0)return 0;let nt=!1;for(;;)switch(b){case"ascii":case"latin1":case"binary":return A;case"utf8":case"utf-8":return K(L).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A*2;case"hex":return A>>>1;case"base64":return Et(L).length;default:if(nt)return z?-1:K(L).length;b=(""+b).toLowerCase(),nt=!0}}o.byteLength=E;function R(L,b,A){let z=!1;if((b===void 0||b<0)&&(b=0),b>this.length||((A===void 0||A>this.length)&&(A=this.length),A<=0)||(A>>>=0,b>>>=0,A<=b))return"";for(L||(L="utf8");;)switch(L){case"hex":return bt(this,b,A);case"utf8":case"utf-8":return S(this,b,A);case"ascii":return pt(this,b,A);case"latin1":case"binary":return Wt(this,b,A);case"base64":return Q(this,b,A);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return xt(this,b,A);default:if(z)throw new TypeError("Unknown encoding: "+L);L=(L+"").toLowerCase(),z=!0}}o.prototype._isBuffer=!0;function H(L,b,A){const z=L[b];L[b]=L[A],L[A]=z}o.prototype.swap16=function(){const b=this.length;if(b%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let A=0;A<b;A+=2)H(this,A,A+1);return this},o.prototype.swap32=function(){const b=this.length;if(b%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let A=0;A<b;A+=4)H(this,A,A+3),H(this,A+1,A+2);return this},o.prototype.swap64=function(){const b=this.length;if(b%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let A=0;A<b;A+=8)H(this,A,A+7),H(this,A+1,A+6),H(this,A+2,A+5),H(this,A+3,A+4);return this},o.prototype.toString=function(){const b=this.length;return b===0?"":arguments.length===0?S(this,0,b):R.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(b){if(!o.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:o.compare(this,b)===0},o.prototype.inspect=function(){let b="";const A=i.INSPECT_MAX_BYTES;return b=this.toString("hex",0,A).replace(/(.{2})/g,"$1 ").trim(),this.length>A&&(b+=" ... "),"<Buffer "+b+">"},r&&(o.prototype[r]=o.prototype.inspect),o.prototype.compare=function(b,A,z,nt,I){if(at(b,Uint8Array)&&(b=o.from(b,b.offset,b.byteLength)),!o.isBuffer(b))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof b);if(A===void 0&&(A=0),z===void 0&&(z=b?b.length:0),nt===void 0&&(nt=0),I===void 0&&(I=this.length),A<0||z>b.length||nt<0||I>this.length)throw new RangeError("out of range index");if(nt>=I&&A>=z)return 0;if(nt>=I)return-1;if(A>=z)return 1;if(A>>>=0,z>>>=0,nt>>>=0,I>>>=0,this===b)return 0;let N=I-nt,mt=z-A;const yt=Math.min(N,mt),Ct=this.slice(nt,I),zt=b.slice(A,z);for(let Vt=0;Vt<yt;++Vt)if(Ct[Vt]!==zt[Vt]){N=Ct[Vt],mt=zt[Vt];break}return N<mt?-1:mt<N?1:0};function Y(L,b,A,z,nt){if(L.length===0)return-1;if(typeof A=="string"?(z=A,A=0):A>2147483647?A=2147483647:A<-2147483648&&(A=-2147483648),A=+A,Ut(A)&&(A=nt?0:L.length-1),A<0&&(A=L.length+A),A>=L.length){if(nt)return-1;A=L.length-1}else if(A<0)if(nt)A=0;else return-1;if(typeof b=="string"&&(b=o.from(b,z)),o.isBuffer(b))return b.length===0?-1:j(L,b,A,z,nt);if(typeof b=="number")return b=b&255,typeof Uint8Array.prototype.indexOf=="function"?nt?Uint8Array.prototype.indexOf.call(L,b,A):Uint8Array.prototype.lastIndexOf.call(L,b,A):j(L,[b],A,z,nt);throw new TypeError("val must be string, number or Buffer")}function j(L,b,A,z,nt){let I=1,N=L.length,mt=b.length;if(z!==void 0&&(z=String(z).toLowerCase(),z==="ucs2"||z==="ucs-2"||z==="utf16le"||z==="utf-16le")){if(L.length<2||b.length<2)return-1;I=2,N/=2,mt/=2,A/=2}function yt(zt,Vt){return I===1?zt[Vt]:zt.readUInt16BE(Vt*I)}let Ct;if(nt){let zt=-1;for(Ct=A;Ct<N;Ct++)if(yt(L,Ct)===yt(b,zt===-1?0:Ct-zt)){if(zt===-1&&(zt=Ct),Ct-zt+1===mt)return zt*I}else zt!==-1&&(Ct-=Ct-zt),zt=-1}else for(A+mt>N&&(A=N-mt),Ct=A;Ct>=0;Ct--){let zt=!0;for(let Vt=0;Vt<mt;Vt++)if(yt(L,Ct+Vt)!==yt(b,Vt)){zt=!1;break}if(zt)return Ct}return-1}o.prototype.includes=function(b,A,z){return this.indexOf(b,A,z)!==-1},o.prototype.indexOf=function(b,A,z){return Y(this,b,A,z,!0)},o.prototype.lastIndexOf=function(b,A,z){return Y(this,b,A,z,!1)};function et(L,b,A,z){A=Number(A)||0;const nt=L.length-A;z?(z=Number(z),z>nt&&(z=nt)):z=nt;const I=b.length;z>I/2&&(z=I/2);let N;for(N=0;N<z;++N){const mt=parseInt(b.substr(N*2,2),16);if(Ut(mt))return N;L[A+N]=mt}return N}function J(L,b,A,z){return Tt(K(b,L.length-A),L,A,z)}function rt(L,b,A,z){return Tt(V(b),L,A,z)}function gt(L,b,A,z){return Tt(Et(b),L,A,z)}function X(L,b,A,z){return Tt(lt(b,L.length-A),L,A,z)}o.prototype.write=function(b,A,z,nt){if(A===void 0)nt="utf8",z=this.length,A=0;else if(z===void 0&&typeof A=="string")nt=A,z=this.length,A=0;else if(isFinite(A))A=A>>>0,isFinite(z)?(z=z>>>0,nt===void 0&&(nt="utf8")):(nt=z,z=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const I=this.length-A;if((z===void 0||z>I)&&(z=I),b.length>0&&(z<0||A<0)||A>this.length)throw new RangeError("Attempt to write outside buffer bounds");nt||(nt="utf8");let N=!1;for(;;)switch(nt){case"hex":return et(this,b,A,z);case"utf8":case"utf-8":return J(this,b,A,z);case"ascii":case"latin1":case"binary":return rt(this,b,A,z);case"base64":return gt(this,b,A,z);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return X(this,b,A,z);default:if(N)throw new TypeError("Unknown encoding: "+nt);nt=(""+nt).toLowerCase(),N=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Q(L,b,A){return b===0&&A===L.length?t.fromByteArray(L):t.fromByteArray(L.slice(b,A))}function S(L,b,A){A=Math.min(L.length,A);const z=[];let nt=b;for(;nt<A;){const I=L[nt];let N=null,mt=I>239?4:I>223?3:I>191?2:1;if(nt+mt<=A){let yt,Ct,zt,Vt;switch(mt){case 1:I<128&&(N=I);break;case 2:yt=L[nt+1],(yt&192)===128&&(Vt=(I&31)<<6|yt&63,Vt>127&&(N=Vt));break;case 3:yt=L[nt+1],Ct=L[nt+2],(yt&192)===128&&(Ct&192)===128&&(Vt=(I&15)<<12|(yt&63)<<6|Ct&63,Vt>2047&&(Vt<55296||Vt>57343)&&(N=Vt));break;case 4:yt=L[nt+1],Ct=L[nt+2],zt=L[nt+3],(yt&192)===128&&(Ct&192)===128&&(zt&192)===128&&(Vt=(I&15)<<18|(yt&63)<<12|(Ct&63)<<6|zt&63,Vt>65535&&Vt<1114112&&(N=Vt))}}N===null?(N=65533,mt=1):N>65535&&(N-=65536,z.push(N>>>10&1023|55296),N=56320|N&1023),z.push(N),nt+=mt}return Pt(z)}const ut=4096;function Pt(L){const b=L.length;if(b<=ut)return String.fromCharCode.apply(String,L);let A="",z=0;for(;z<b;)A+=String.fromCharCode.apply(String,L.slice(z,z+=ut));return A}function pt(L,b,A){let z="";A=Math.min(L.length,A);for(let nt=b;nt<A;++nt)z+=String.fromCharCode(L[nt]&127);return z}function Wt(L,b,A){let z="";A=Math.min(L.length,A);for(let nt=b;nt<A;++nt)z+=String.fromCharCode(L[nt]);return z}function bt(L,b,A){const z=L.length;(!b||b<0)&&(b=0),(!A||A<0||A>z)&&(A=z);let nt="";for(let I=b;I<A;++I)nt+=$t[L[I]];return nt}function xt(L,b,A){const z=L.slice(b,A);let nt="";for(let I=0;I<z.length-1;I+=2)nt+=String.fromCharCode(z[I]+z[I+1]*256);return nt}o.prototype.slice=function(b,A){const z=this.length;b=~~b,A=A===void 0?z:~~A,b<0?(b+=z,b<0&&(b=0)):b>z&&(b=z),A<0?(A+=z,A<0&&(A=0)):A>z&&(A=z),A<b&&(A=b);const nt=this.subarray(b,A);return Object.setPrototypeOf(nt,o.prototype),nt};function tt(L,b,A){if(L%1!==0||L<0)throw new RangeError("offset is not uint");if(L+b>A)throw new RangeError("Trying to access beyond buffer length")}o.prototype.readUintLE=o.prototype.readUIntLE=function(b,A,z){b=b>>>0,A=A>>>0,z||tt(b,A,this.length);let nt=this[b],I=1,N=0;for(;++N<A&&(I*=256);)nt+=this[b+N]*I;return nt},o.prototype.readUintBE=o.prototype.readUIntBE=function(b,A,z){b=b>>>0,A=A>>>0,z||tt(b,A,this.length);let nt=this[b+--A],I=1;for(;A>0&&(I*=256);)nt+=this[b+--A]*I;return nt},o.prototype.readUint8=o.prototype.readUInt8=function(b,A){return b=b>>>0,A||tt(b,1,this.length),this[b]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(b,A){return b=b>>>0,A||tt(b,2,this.length),this[b]|this[b+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(b,A){return b=b>>>0,A||tt(b,2,this.length),this[b]<<8|this[b+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),(this[b]|this[b+1]<<8|this[b+2]<<16)+this[b+3]*16777216},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),this[b]*16777216+(this[b+1]<<16|this[b+2]<<8|this[b+3])},o.prototype.readBigUInt64LE=Lt(function(b){b=b>>>0,pe(b,"offset");const A=this[b],z=this[b+7];(A===void 0||z===void 0)&&C(b,this.length-8);const nt=A+this[++b]*2**8+this[++b]*2**16+this[++b]*2**24,I=this[++b]+this[++b]*2**8+this[++b]*2**16+z*2**24;return BigInt(nt)+(BigInt(I)<<BigInt(32))}),o.prototype.readBigUInt64BE=Lt(function(b){b=b>>>0,pe(b,"offset");const A=this[b],z=this[b+7];(A===void 0||z===void 0)&&C(b,this.length-8);const nt=A*2**24+this[++b]*2**16+this[++b]*2**8+this[++b],I=this[++b]*2**24+this[++b]*2**16+this[++b]*2**8+z;return(BigInt(nt)<<BigInt(32))+BigInt(I)}),o.prototype.readIntLE=function(b,A,z){b=b>>>0,A=A>>>0,z||tt(b,A,this.length);let nt=this[b],I=1,N=0;for(;++N<A&&(I*=256);)nt+=this[b+N]*I;return I*=128,nt>=I&&(nt-=Math.pow(2,8*A)),nt},o.prototype.readIntBE=function(b,A,z){b=b>>>0,A=A>>>0,z||tt(b,A,this.length);let nt=A,I=1,N=this[b+--nt];for(;nt>0&&(I*=256);)N+=this[b+--nt]*I;return I*=128,N>=I&&(N-=Math.pow(2,8*A)),N},o.prototype.readInt8=function(b,A){return b=b>>>0,A||tt(b,1,this.length),this[b]&128?(255-this[b]+1)*-1:this[b]},o.prototype.readInt16LE=function(b,A){b=b>>>0,A||tt(b,2,this.length);const z=this[b]|this[b+1]<<8;return z&32768?z|4294901760:z},o.prototype.readInt16BE=function(b,A){b=b>>>0,A||tt(b,2,this.length);const z=this[b+1]|this[b]<<8;return z&32768?z|4294901760:z},o.prototype.readInt32LE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),this[b]|this[b+1]<<8|this[b+2]<<16|this[b+3]<<24},o.prototype.readInt32BE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),this[b]<<24|this[b+1]<<16|this[b+2]<<8|this[b+3]},o.prototype.readBigInt64LE=Lt(function(b){b=b>>>0,pe(b,"offset");const A=this[b],z=this[b+7];(A===void 0||z===void 0)&&C(b,this.length-8);const nt=this[b+4]+this[b+5]*2**8+this[b+6]*2**16+(z<<24);return(BigInt(nt)<<BigInt(32))+BigInt(A+this[++b]*2**8+this[++b]*2**16+this[++b]*2**24)}),o.prototype.readBigInt64BE=Lt(function(b){b=b>>>0,pe(b,"offset");const A=this[b],z=this[b+7];(A===void 0||z===void 0)&&C(b,this.length-8);const nt=(A<<24)+this[++b]*2**16+this[++b]*2**8+this[++b];return(BigInt(nt)<<BigInt(32))+BigInt(this[++b]*2**24+this[++b]*2**16+this[++b]*2**8+z)}),o.prototype.readFloatLE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),e.read(this,b,!0,23,4)},o.prototype.readFloatBE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),e.read(this,b,!1,23,4)},o.prototype.readDoubleLE=function(b,A){return b=b>>>0,A||tt(b,8,this.length),e.read(this,b,!0,52,8)},o.prototype.readDoubleBE=function(b,A){return b=b>>>0,A||tt(b,8,this.length),e.read(this,b,!1,52,8)};function it(L,b,A,z,nt,I){if(!o.isBuffer(L))throw new TypeError('"buffer" argument must be a Buffer instance');if(b>nt||b<I)throw new RangeError('"value" argument is out of bounds');if(A+z>L.length)throw new RangeError("Index out of range")}o.prototype.writeUintLE=o.prototype.writeUIntLE=function(b,A,z,nt){if(b=+b,A=A>>>0,z=z>>>0,!nt){const mt=Math.pow(2,8*z)-1;it(this,b,A,z,mt,0)}let I=1,N=0;for(this[A]=b&255;++N<z&&(I*=256);)this[A+N]=b/I&255;return A+z},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(b,A,z,nt){if(b=+b,A=A>>>0,z=z>>>0,!nt){const mt=Math.pow(2,8*z)-1;it(this,b,A,z,mt,0)}let I=z-1,N=1;for(this[A+I]=b&255;--I>=0&&(N*=256);)this[A+I]=b/N&255;return A+z},o.prototype.writeUint8=o.prototype.writeUInt8=function(b,A,z){return b=+b,A=A>>>0,z||it(this,b,A,1,255,0),this[A]=b&255,A+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(b,A,z){return b=+b,A=A>>>0,z||it(this,b,A,2,65535,0),this[A]=b&255,this[A+1]=b>>>8,A+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(b,A,z){return b=+b,A=A>>>0,z||it(this,b,A,2,65535,0),this[A]=b>>>8,this[A+1]=b&255,A+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(b,A,z){return b=+b,A=A>>>0,z||it(this,b,A,4,4294967295,0),this[A+3]=b>>>24,this[A+2]=b>>>16,this[A+1]=b>>>8,this[A]=b&255,A+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(b,A,z){return b=+b,A=A>>>0,z||it(this,b,A,4,4294967295,0),this[A]=b>>>24,this[A+1]=b>>>16,this[A+2]=b>>>8,this[A+3]=b&255,A+4};function Gt(L,b,A,z,nt){_e(b,z,nt,L,A,7);let I=Number(b&BigInt(4294967295));L[A++]=I,I=I>>8,L[A++]=I,I=I>>8,L[A++]=I,I=I>>8,L[A++]=I;let N=Number(b>>BigInt(32)&BigInt(4294967295));return L[A++]=N,N=N>>8,L[A++]=N,N=N>>8,L[A++]=N,N=N>>8,L[A++]=N,A}function Dt(L,b,A,z,nt){_e(b,z,nt,L,A,7);let I=Number(b&BigInt(4294967295));L[A+7]=I,I=I>>8,L[A+6]=I,I=I>>8,L[A+5]=I,I=I>>8,L[A+4]=I;let N=Number(b>>BigInt(32)&BigInt(4294967295));return L[A+3]=N,N=N>>8,L[A+2]=N,N=N>>8,L[A+1]=N,N=N>>8,L[A]=N,A+8}o.prototype.writeBigUInt64LE=Lt(function(b,A=0){return Gt(this,b,A,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=Lt(function(b,A=0){return Dt(this,b,A,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(b,A,z,nt){if(b=+b,A=A>>>0,!nt){const yt=Math.pow(2,8*z-1);it(this,b,A,z,yt-1,-yt)}let I=0,N=1,mt=0;for(this[A]=b&255;++I<z&&(N*=256);)b<0&&mt===0&&this[A+I-1]!==0&&(mt=1),this[A+I]=(b/N>>0)-mt&255;return A+z},o.prototype.writeIntBE=function(b,A,z,nt){if(b=+b,A=A>>>0,!nt){const yt=Math.pow(2,8*z-1);it(this,b,A,z,yt-1,-yt)}let I=z-1,N=1,mt=0;for(this[A+I]=b&255;--I>=0&&(N*=256);)b<0&&mt===0&&this[A+I+1]!==0&&(mt=1),this[A+I]=(b/N>>0)-mt&255;return A+z},o.prototype.writeInt8=function(b,A,z){return b=+b,A=A>>>0,z||it(this,b,A,1,127,-128),b<0&&(b=255+b+1),this[A]=b&255,A+1},o.prototype.writeInt16LE=function(b,A,z){return b=+b,A=A>>>0,z||it(this,b,A,2,32767,-32768),this[A]=b&255,this[A+1]=b>>>8,A+2},o.prototype.writeInt16BE=function(b,A,z){return b=+b,A=A>>>0,z||it(this,b,A,2,32767,-32768),this[A]=b>>>8,this[A+1]=b&255,A+2},o.prototype.writeInt32LE=function(b,A,z){return b=+b,A=A>>>0,z||it(this,b,A,4,2147483647,-2147483648),this[A]=b&255,this[A+1]=b>>>8,this[A+2]=b>>>16,this[A+3]=b>>>24,A+4},o.prototype.writeInt32BE=function(b,A,z){return b=+b,A=A>>>0,z||it(this,b,A,4,2147483647,-2147483648),b<0&&(b=4294967295+b+1),this[A]=b>>>24,this[A+1]=b>>>16,this[A+2]=b>>>8,this[A+3]=b&255,A+4},o.prototype.writeBigInt64LE=Lt(function(b,A=0){return Gt(this,b,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=Lt(function(b,A=0){return Dt(this,b,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Mt(L,b,A,z,nt,I){if(A+z>L.length)throw new RangeError("Index out of range");if(A<0)throw new RangeError("Index out of range")}function te(L,b,A,z,nt){return b=+b,A=A>>>0,nt||Mt(L,b,A,4),e.write(L,b,A,z,23,4),A+4}o.prototype.writeFloatLE=function(b,A,z){return te(this,b,A,!0,z)},o.prototype.writeFloatBE=function(b,A,z){return te(this,b,A,!1,z)};function re(L,b,A,z,nt){return b=+b,A=A>>>0,nt||Mt(L,b,A,8),e.write(L,b,A,z,52,8),A+8}o.prototype.writeDoubleLE=function(b,A,z){return re(this,b,A,!0,z)},o.prototype.writeDoubleBE=function(b,A,z){return re(this,b,A,!1,z)},o.prototype.copy=function(b,A,z,nt){if(!o.isBuffer(b))throw new TypeError("argument should be a Buffer");if(z||(z=0),!nt&&nt!==0&&(nt=this.length),A>=b.length&&(A=b.length),A||(A=0),nt>0&&nt<z&&(nt=z),nt===z||b.length===0||this.length===0)return 0;if(A<0)throw new RangeError("targetStart out of bounds");if(z<0||z>=this.length)throw new RangeError("Index out of range");if(nt<0)throw new RangeError("sourceEnd out of bounds");nt>this.length&&(nt=this.length),b.length-A<nt-z&&(nt=b.length-A+z);const I=nt-z;return this===b&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(A,z,nt):Uint8Array.prototype.set.call(b,this.subarray(z,nt),A),I},o.prototype.fill=function(b,A,z,nt){if(typeof b=="string"){if(typeof A=="string"?(nt=A,A=0,z=this.length):typeof z=="string"&&(nt=z,z=this.length),nt!==void 0&&typeof nt!="string")throw new TypeError("encoding must be a string");if(typeof nt=="string"&&!o.isEncoding(nt))throw new TypeError("Unknown encoding: "+nt);if(b.length===1){const N=b.charCodeAt(0);(nt==="utf8"&&N<128||nt==="latin1")&&(b=N)}}else typeof b=="number"?b=b&255:typeof b=="boolean"&&(b=Number(b));if(A<0||this.length<A||this.length<z)throw new RangeError("Out of range index");if(z<=A)return this;A=A>>>0,z=z===void 0?this.length:z>>>0,b||(b=0);let I;if(typeof b=="number")for(I=A;I<z;++I)this[I]=b;else{const N=o.isBuffer(b)?b:o.from(b,nt),mt=N.length;if(mt===0)throw new TypeError('The value "'+b+'" is invalid for argument "value"');for(I=0;I<z-A;++I)this[I+A]=N[I%mt]}return this};const jt={};function qt(L,b,A){jt[L]=class extends A{constructor(){super(),Object.defineProperty(this,"message",{value:b.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${L}]`,this.stack,delete this.name}get code(){return L}set code(nt){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:nt,writable:!0})}toString(){return`${this.name} [${L}]: ${this.message}`}}}qt("ERR_BUFFER_OUT_OF_BOUNDS",function(L){return L?`${L} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),qt("ERR_INVALID_ARG_TYPE",function(L,b){return`The "${L}" argument must be of type number. Received type ${typeof b}`},TypeError),qt("ERR_OUT_OF_RANGE",function(L,b,A){let z=`The value of "${L}" is out of range.`,nt=A;return Number.isInteger(A)&&Math.abs(A)>2**32?nt=ce(String(A)):typeof A=="bigint"&&(nt=String(A),(A>BigInt(2)**BigInt(32)||A<-(BigInt(2)**BigInt(32)))&&(nt=ce(nt)),nt+="n"),z+=` It must be ${b}. Received ${nt}`,z},RangeError);function ce(L){let b="",A=L.length;const z=L[0]==="-"?1:0;for(;A>=z+4;A-=3)b=`_${L.slice(A-3,A)}${b}`;return`${L.slice(0,A)}${b}`}function ne(L,b,A){pe(b,"offset"),(L[b]===void 0||L[b+A]===void 0)&&C(b,L.length-(A+1))}function _e(L,b,A,z,nt,I){if(L>A||L<b){const N=typeof b=="bigint"?"n":"";let mt;throw I>3?b===0||b===BigInt(0)?mt=`>= 0${N} and < 2${N} ** ${(I+1)*8}${N}`:mt=`>= -(2${N} ** ${(I+1)*8-1}${N}) and < 2 ** ${(I+1)*8-1}${N}`:mt=`>= ${b}${N} and <= ${A}${N}`,new jt.ERR_OUT_OF_RANGE("value",mt,L)}ne(z,nt,I)}function pe(L,b){if(typeof L!="number")throw new jt.ERR_INVALID_ARG_TYPE(b,"number",L)}function C(L,b,A){throw Math.floor(L)!==L?(pe(L,A),new jt.ERR_OUT_OF_RANGE(A||"offset","an integer",L)):b<0?new jt.ERR_BUFFER_OUT_OF_BOUNDS:new jt.ERR_OUT_OF_RANGE(A||"offset",`>= ${A?1:0} and <= ${b}`,L)}const At=/[^+/0-9A-Za-z-_]/g;function vt(L){if(L=L.split("=")[0],L=L.trim().replace(At,""),L.length<2)return"";for(;L.length%4!==0;)L=L+"=";return L}function K(L,b){b=b||1/0;let A;const z=L.length;let nt=null;const I=[];for(let N=0;N<z;++N){if(A=L.charCodeAt(N),A>55295&&A<57344){if(!nt){if(A>56319){(b-=3)>-1&&I.push(239,191,189);continue}else if(N+1===z){(b-=3)>-1&&I.push(239,191,189);continue}nt=A;continue}if(A<56320){(b-=3)>-1&&I.push(239,191,189),nt=A;continue}A=(nt-55296<<10|A-56320)+65536}else nt&&(b-=3)>-1&&I.push(239,191,189);if(nt=null,A<128){if((b-=1)<0)break;I.push(A)}else if(A<2048){if((b-=2)<0)break;I.push(A>>6|192,A&63|128)}else if(A<65536){if((b-=3)<0)break;I.push(A>>12|224,A>>6&63|128,A&63|128)}else if(A<1114112){if((b-=4)<0)break;I.push(A>>18|240,A>>12&63|128,A>>6&63|128,A&63|128)}else throw new Error("Invalid code point")}return I}function V(L){const b=[];for(let A=0;A<L.length;++A)b.push(L.charCodeAt(A)&255);return b}function lt(L,b){let A,z,nt;const I=[];for(let N=0;N<L.length&&!((b-=2)<0);++N)A=L.charCodeAt(N),z=A>>8,nt=A%256,I.push(nt),I.push(z);return I}function Et(L){return t.toByteArray(vt(L))}function Tt(L,b,A,z){let nt;for(nt=0;nt<z&&!(nt+A>=b.length||nt>=L.length);++nt)b[nt+A]=L[nt];return nt}function at(L,b){return L instanceof b||L!=null&&L.constructor!=null&&L.constructor.name!=null&&L.constructor.name===b.name}function Ut(L){return L!==L}const $t=function(){const L="0123456789abcdef",b=new Array(256);for(let A=0;A<16;++A){const z=A*16;for(let nt=0;nt<16;++nt)b[z+nt]=L[A]+L[nt]}return b}();function Lt(L){return typeof BigInt>"u"?ee:L}function ee(){throw new Error("BigInt not supported")}})(Mf);var Wy={exports:{}};(function(i,t){(function(e,r){i.exports=r()})(hi,function(){var e="1.13.6",r=typeof self=="object"&&self.self===self&&self||typeof hi=="object"&&hi.global===hi&&hi||Function("return this")()||{},n=Array.prototype,s=Object.prototype,a=typeof Symbol<"u"?Symbol.prototype:null,o=n.push,u=n.slice,d=s.toString,m=s.hasOwnProperty,l=typeof ArrayBuffer<"u",f=typeof DataView<"u",p=Array.isArray,y=Object.keys,v=Object.create,_=l&&ArrayBuffer.isView,w=isNaN,T=isFinite,E=!{toString:null}.propertyIsEnumerable("toString"),R=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],H=Math.pow(2,53)-1;function Y(M,O){return O=O==null?M.length-1:+O,function(){for(var q=Math.max(arguments.length-O,0),$=Array(q),ft=0;ft<q;ft++)$[ft]=arguments[ft+O];switch(O){case 0:return M.call(this,$);case 1:return M.call(this,arguments[0],$);case 2:return M.call(this,arguments[0],arguments[1],$)}var ht=Array(O+1);for(ft=0;ft<O;ft++)ht[ft]=arguments[ft];return ht[O]=$,M.apply(this,ht)}}function j(M){var O=typeof M;return O==="function"||O==="object"&&!!M}function et(M){return M===void 0}function J(M){return M===!0||M===!1||d.call(M)==="[object Boolean]"}function rt(M){var O="[object "+M+"]";return function(q){return d.call(q)===O}}var gt=rt("String"),X=rt("Number"),Q=rt("Date"),S=rt("RegExp"),ut=rt("Error"),Pt=rt("Symbol"),pt=rt("ArrayBuffer"),Wt=rt("Function"),bt=r.document&&r.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof bt!="function"&&(Wt=function(M){return typeof M=="function"||!1});var xt=Wt,tt=rt("Object"),it=f&&tt(new DataView(new ArrayBuffer(8))),Gt=typeof Map<"u"&&tt(new Map),Dt=rt("DataView"),Mt=it?function(M){return M!=null&&xt(M.getInt8)&&pt(M.buffer)}:Dt,te=p||rt("Array");function re(M,O){return M!=null&&m.call(M,O)}var jt=rt("Arguments");(function(){jt(arguments)||(jt=function(M){return re(M,"callee")})})();var qt=jt;function ce(M){return X(M)&&w(M)}function ne(M){return function(){return M}}function _e(M){return function(O){var q=M(O);return typeof q=="number"&&q>=0&&q<=H}}function pe(M){return function(O){return O?.[M]}}var C=pe("byteLength"),At=_e(C),vt=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,K=l?function(M){return _?_(M)&&!Mt(M):At(M)&&vt.test(d.call(M))}:ne(!1),V=pe("length");function lt(M,O){O=function(_t){for(var Bt={},se=_t.length,we=0;we<se;++we)Bt[_t[we]]=!0;return{contains:function(je){return Bt[je]===!0},push:function(je){return Bt[je]=!0,_t.push(je)}}}(O);var q=R.length,$=M.constructor,ft=xt($)&&$.prototype||s,ht="constructor";for(re(M,ht)&&!O.contains(ht)&&O.push(ht);q--;)(ht=R[q])in M&&M[ht]!==ft[ht]&&!O.contains(ht)&&O.push(ht)}function Et(M){if(!j(M))return[];if(y)return y(M);var O=[];for(var q in M)re(M,q)&&O.push(q);return E&&lt(M,O),O}function Tt(M,O){var q=Et(O),$=q.length;if(M==null)return!$;for(var ft=Object(M),ht=0;ht<$;ht++){var _t=q[ht];if(O[_t]!==ft[_t]||!(_t in ft))return!1}return!0}function at(M){return M instanceof at?M:this instanceof at?void(this._wrapped=M):new at(M)}function Ut(M){return new Uint8Array(M.buffer||M,M.byteOffset||0,C(M))}at.VERSION=e,at.prototype.value=function(){return this._wrapped},at.prototype.valueOf=at.prototype.toJSON=at.prototype.value,at.prototype.toString=function(){return String(this._wrapped)};var $t="[object DataView]";function Lt(M,O,q,$){if(M===O)return M!==0||1/M==1/O;if(M==null||O==null)return!1;if(M!=M)return O!=O;var ft=typeof M;return(ft==="function"||ft==="object"||typeof O=="object")&&function ht(_t,Bt,se,we){_t instanceof at&&(_t=_t._wrapped),Bt instanceof at&&(Bt=Bt._wrapped);var je=d.call(_t);if(je!==d.call(Bt))return!1;if(it&&je=="[object Object]"&&Mt(_t)){if(!Mt(Bt))return!1;je=$t}switch(je){case"[object RegExp]":case"[object String]":return""+_t==""+Bt;case"[object Number]":return+_t!=+_t?+Bt!=+Bt:+_t==0?1/+_t==1/Bt:+_t==+Bt;case"[object Date]":case"[object Boolean]":return+_t==+Bt;case"[object Symbol]":return a.valueOf.call(_t)===a.valueOf.call(Bt);case"[object ArrayBuffer]":case $t:return ht(Ut(_t),Ut(Bt),se,we)}var Fi=je==="[object Array]";if(!Fi&&K(_t)){if(C(_t)!==C(Bt))return!1;if(_t.buffer===Bt.buffer&&_t.byteOffset===Bt.byteOffset)return!0;Fi=!0}if(!Fi){if(typeof _t!="object"||typeof Bt!="object")return!1;var cn=_t.constructor,un=Bt.constructor;if(cn!==un&&!(xt(cn)&&cn instanceof cn&&xt(un)&&un instanceof un)&&"constructor"in _t&&"constructor"in Bt)return!1}we=we||[];for(var dr=(se=se||[]).length;dr--;)if(se[dr]===_t)return we[dr]===Bt;if(se.push(_t),we.push(Bt),Fi){if((dr=_t.length)!==Bt.length)return!1;for(;dr--;)if(!Lt(_t[dr],Bt[dr],se,we))return!1}else{var Ni,Uh=Et(_t);if(dr=Uh.length,Et(Bt).length!==dr)return!1;for(;dr--;)if(Ni=Uh[dr],!re(Bt,Ni)||!Lt(_t[Ni],Bt[Ni],se,we))return!1}return se.pop(),we.pop(),!0}(M,O,q,$)}function ee(M){if(!j(M))return[];var O=[];for(var q in M)O.push(q);return E&&lt(M,O),O}function L(M){var O=V(M);return function(q){if(q==null)return!1;var $=ee(q);if(V($))return!1;for(var ft=0;ft<O;ft++)if(!xt(q[M[ft]]))return!1;return M!==N||!xt(q[b])}}var b="forEach",A="has",z=["clear","delete"],nt=["get",A,"set"],I=z.concat(b,nt),N=z.concat(nt),mt=["add"].concat(z,b,A),yt=Gt?L(I):rt("Map"),Ct=Gt?L(N):rt("WeakMap"),zt=Gt?L(mt):rt("Set"),Vt=rt("WeakSet");function xe(M){for(var O=Et(M),q=O.length,$=Array(q),ft=0;ft<q;ft++)$[ft]=M[O[ft]];return $}function Be(M){for(var O={},q=Et(M),$=0,ft=q.length;$<ft;$++)O[M[q[$]]]=q[$];return O}function Ne(M){var O=[];for(var q in M)xt(M[q])&&O.push(q);return O.sort()}function ke(M,O){return function(q){var $=arguments.length;if(O&&(q=Object(q)),$<2||q==null)return q;for(var ft=1;ft<$;ft++)for(var ht=arguments[ft],_t=M(ht),Bt=_t.length,se=0;se<Bt;se++){var we=_t[se];O&&q[we]!==void 0||(q[we]=ht[we])}return q}}var Ze=ke(ee),Ei=ke(Et),_r=ke(ee,!0);function as(M){if(!j(M))return{};if(v)return v(M);var O=function(){};O.prototype=M;var q=new O;return O.prototype=null,q}function Fs(M){return te(M)?M:[M]}function Sn(M){return at.toPath(M)}function Ns(M,O){for(var q=O.length,$=0;$<q;$++){if(M==null)return;M=M[O[$]]}return q?M:void 0}function Ea(M,O,q){var $=Ns(M,Sn(O));return et($)?q:$}function Cn(M){return M}function Mn(M){return M=Ei({},M),function(O){return Tt(O,M)}}function In(M){return M=Sn(M),function(O){return Ns(O,M)}}function Bn(M,O,q){if(O===void 0)return M;switch(q??3){case 1:return function($){return M.call(O,$)};case 3:return function($,ft,ht){return M.call(O,$,ft,ht)};case 4:return function($,ft,ht,_t){return M.call(O,$,ft,ht,_t)}}return function(){return M.apply(O,arguments)}}function Ta(M,O,q){return M==null?Cn:xt(M)?Bn(M,O,q):j(M)&&!te(M)?Mn(M):In(M)}function Us(M,O){return Ta(M,O,1/0)}function Li(M,O,q){return at.iteratee!==Us?at.iteratee(M,O):Ta(M,O,q)}function Sa(){}function Hs(M,O){return O==null&&(O=M,M=0),M+Math.floor(Math.random()*(O-M+1))}at.toPath=Fs,at.iteratee=Us;var kn=Date.now||function(){return new Date().getTime()};function Ca(M){var O=function(ht){return M[ht]},q="(?:"+Et(M).join("|")+")",$=RegExp(q),ft=RegExp(q,"g");return function(ht){return ht=ht==null?"":""+ht,$.test(ht)?ht.replace(ft,O):ht}}var Vr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Ma=Ca(Vr),Ho=Ca(Be(Vr)),Go=at.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},Gs=/(.)^/,Wo={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},zo=/\\|'|\r|\n|\u2028|\u2029/g;function hr(M){return"\\"+Wo[M]}var Vo=/^\s*(\w|\$)+\s*$/,os=0;function Ia(M,O,q,$,ft){if(!($ instanceof O))return M.apply(q,ft);var ht=as(M.prototype),_t=M.apply(ht,ft);return j(_t)?_t:ht}var on=Y(function(M,O){var q=on.placeholder,$=function(){for(var ft=0,ht=O.length,_t=Array(ht),Bt=0;Bt<ht;Bt++)_t[Bt]=O[Bt]===q?arguments[ft++]:O[Bt];for(;ft<arguments.length;)_t.push(arguments[ft++]);return Ia(M,$,this,this,_t)};return $});on.placeholder=at;var Ba=Y(function(M,O,q){if(!xt(M))throw new TypeError("Bind must be called on a function");var $=Y(function(ft){return Ia(M,$,O,this,q.concat(ft))});return $}),Oi=_e(V);function Ir(M,O,q,$){if($=$||[],O||O===0){if(O<=0)return $.concat(M)}else O=1/0;for(var ft=$.length,ht=0,_t=V(M);ht<_t;ht++){var Bt=M[ht];if(Oi(Bt)&&(te(Bt)||qt(Bt)))if(O>1)Ir(Bt,O-1,q,$),ft=$.length;else for(var se=0,we=Bt.length;se<we;)$[ft++]=Bt[se++];else q||($[ft++]=Bt)}return $}var ka=Y(function(M,O){var q=(O=Ir(O,!1,!1)).length;if(q<1)throw new Error("bindAll must be passed function names");for(;q--;){var $=O[q];M[$]=Ba(M[$],M)}return M}),Ra=Y(function(M,O,q){return setTimeout(function(){return M.apply(null,q)},O)}),Mi=on(Ra,at,1);function Ws(M){return function(){return!M.apply(this,arguments)}}function Pa(M,O){var q;return function(){return--M>0&&(q=O.apply(this,arguments)),M<=1&&(O=null),q}}var Da=on(Pa,2);function hn(M,O,q){O=Li(O,q);for(var $,ft=Et(M),ht=0,_t=ft.length;ht<_t;ht++)if(O(M[$=ft[ht]],$,M))return $}function Ii(M){return function(O,q,$){q=Li(q,$);for(var ft=V(O),ht=M>0?0:ft-1;ht>=0&&ht<ft;ht+=M)if(q(O[ht],ht,O))return ht;return-1}}var ti=Ii(1),La=Ii(-1);function hs(M,O,q,$){for(var ft=(q=Li(q,$,1))(O),ht=0,_t=V(M);ht<_t;){var Bt=Math.floor((ht+_t)/2);q(M[Bt])<ft?ht=Bt+1:_t=Bt}return ht}function Bi(M,O,q){return function($,ft,ht){var _t=0,Bt=V($);if(typeof ht=="number")M>0?_t=ht>=0?ht:Math.max(ht+Bt,_t):Bt=ht>=0?Math.min(ht+1,Bt):ht+Bt+1;else if(q&&ht&&Bt)return $[ht=q($,ft)]===ft?ht:-1;if(ft!=ft)return(ht=O(u.call($,_t,Bt),ce))>=0?ht+_t:-1;for(ht=M>0?_t:Bt-1;ht>=0&&ht<Bt;ht+=M)if($[ht]===ft)return ht;return-1}}var ls=Bi(1,ti,hs),Oa=Bi(-1,La);function cs(M,O,q){var $=(Oi(M)?ti:hn)(M,O,q);if($!==void 0&&$!==-1)return M[$]}function lr(M,O,q){var $,ft;if(O=Bn(O,q),Oi(M))for($=0,ft=M.length;$<ft;$++)O(M[$],$,M);else{var ht=Et(M);for($=0,ft=ht.length;$<ft;$++)O(M[ht[$]],ht[$],M)}return M}function cr(M,O,q){O=Li(O,q);for(var $=!Oi(M)&&Et(M),ft=($||M).length,ht=Array(ft),_t=0;_t<ft;_t++){var Bt=$?$[_t]:_t;ht[_t]=O(M[Bt],Bt,M)}return ht}function us(M){var O=function(q,$,ft,ht){var _t=!Oi(q)&&Et(q),Bt=(_t||q).length,se=M>0?0:Bt-1;for(ht||(ft=q[_t?_t[se]:se],se+=M);se>=0&&se<Bt;se+=M){var we=_t?_t[se]:se;ft=$(ft,q[we],we,q)}return ft};return function(q,$,ft,ht){var _t=arguments.length>=3;return O(q,Bn($,ht,4),ft,_t)}}var ds=us(1),fs=us(-1);function Br(M,O,q){var $=[];return O=Li(O,q),lr(M,function(ft,ht,_t){O(ft,ht,_t)&&$.push(ft)}),$}function wr(M,O,q){O=Li(O,q);for(var $=!Oi(M)&&Et(M),ft=($||M).length,ht=0;ht<ft;ht++){var _t=$?$[ht]:ht;if(!O(M[_t],_t,M))return!1}return!0}function B(M,O,q){O=Li(O,q);for(var $=!Oi(M)&&Et(M),ft=($||M).length,ht=0;ht<ft;ht++){var _t=$?$[ht]:ht;if(O(M[_t],_t,M))return!0}return!1}function D(M,O,q,$){return Oi(M)||(M=xe(M)),(typeof q!="number"||$)&&(q=0),ls(M,O,q)>=0}var G=Y(function(M,O,q){var $,ft;return xt(O)?ft=O:(O=Sn(O),$=O.slice(0,-1),O=O[O.length-1]),cr(M,function(ht){var _t=ft;if(!_t){if($&&$.length&&(ht=Ns(ht,$)),ht==null)return;_t=ht[O]}return _t==null?_t:_t.apply(ht,q)})});function ot(M,O){return cr(M,In(O))}function It(M,O,q){var $,ft,ht=-1/0,_t=-1/0;if(O==null||typeof O=="number"&&typeof M[0]!="object"&&M!=null)for(var Bt=0,se=(M=Oi(M)?M:xe(M)).length;Bt<se;Bt++)($=M[Bt])!=null&&$>ht&&(ht=$);else O=Li(O,q),lr(M,function(we,je,Fi){((ft=O(we,je,Fi))>_t||ft===-1/0&&ht===-1/0)&&(ht=we,_t=ft)});return ht}var Ft=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Kt(M){return M?te(M)?u.call(M):gt(M)?M.match(Ft):Oi(M)?cr(M,Cn):xe(M):[]}function Qt(M,O,q){if(O==null||q)return Oi(M)||(M=xe(M)),M[Hs(M.length-1)];var $=Kt(M),ft=V($);O=Math.max(Math.min(O,ft),0);for(var ht=ft-1,_t=0;_t<O;_t++){var Bt=Hs(_t,ht),se=$[_t];$[_t]=$[Bt],$[Bt]=se}return $.slice(0,O)}function Ge(M,O){return function(q,$,ft){var ht=O?[[],[]]:{};return $=Li($,ft),lr(q,function(_t,Bt){var se=$(_t,Bt,q);M(ht,_t,se)}),ht}}var mi=Ge(function(M,O,q){re(M,q)?M[q].push(O):M[q]=[O]}),Wi=Ge(function(M,O,q){M[q]=O}),zi=Ge(function(M,O,q){re(M,q)?M[q]++:M[q]=1}),br=Ge(function(M,O,q){M[q?0:1].push(O)},!0);function ps(M,O,q){return O in q}var $i=Y(function(M,O){var q={},$=O[0];if(M==null)return q;xt($)?(O.length>1&&($=Bn($,O[1])),O=ee(M)):($=ps,O=Ir(O,!1,!1),M=Object(M));for(var ft=0,ht=O.length;ft<ht;ft++){var _t=O[ft],Bt=M[_t];$(Bt,_t,M)&&(q[_t]=Bt)}return q}),Vi=Y(function(M,O){var q,$=O[0];return xt($)?($=Ws($),O.length>1&&(q=O[1])):(O=cr(Ir(O,!1,!1),String),$=function(ft,ht){return!D(O,ht)}),$i(M,$,q)});function Rn(M,O,q){return u.call(M,0,Math.max(0,M.length-(O==null||q?1:O)))}function ur(M,O,q){return M==null||M.length<1?O==null||q?void 0:[]:O==null||q?M[0]:Rn(M,M.length-O)}function ln(M,O,q){return u.call(M,O==null||q?1:O)}var Fh=Y(function(M,O){return O=Ir(O,!0,!0),Br(M,function(q){return!D(O,q)})}),$c=Y(function(M,O){return Fh(M,O)});function Xe(M,O,q,$){J(O)||($=q,q=O,O=!1),q!=null&&(q=Li(q,$));for(var ft=[],ht=[],_t=0,Bt=V(M);_t<Bt;_t++){var se=M[_t],we=q?q(se,_t,M):se;O&&!q?(_t&&ht===we||ft.push(se),ht=we):q?D(ht,we)||(ht.push(we),ft.push(se)):D(ft,se)||ft.push(se)}return ft}var qe=Y(function(M){return Xe(Ir(M,!0,!0))});function Xo(M){for(var O=M&&It(M,V).length||0,q=Array(O),$=0;$<O;$++)q[$]=ot(M,$);return q}var Zc=Y(Xo);function jo(M,O){return M._chain?at(O).chain():O}function Nh(M){return lr(Ne(M),function(O){var q=at[O]=M[O];at.prototype[O]=function(){var $=[this._wrapped];return o.apply($,arguments),jo(this,q.apply(at,$))}}),at}lr(["pop","push","reverse","shift","sort","splice","unshift"],function(M){var O=n[M];at.prototype[M]=function(){var q=this._wrapped;return q!=null&&(O.apply(q,arguments),M!=="shift"&&M!=="splice"||q.length!==0||delete q[0]),jo(this,q)}}),lr(["concat","join","slice"],function(M){var O=n[M];at.prototype[M]=function(){var q=this._wrapped;return q!=null&&(q=O.apply(q,arguments)),jo(this,q)}});var Yo=Nh({__proto__:null,VERSION:e,restArguments:Y,isObject:j,isNull:function(M){return M===null},isUndefined:et,isBoolean:J,isElement:function(M){return!(!M||M.nodeType!==1)},isString:gt,isNumber:X,isDate:Q,isRegExp:S,isError:ut,isSymbol:Pt,isArrayBuffer:pt,isDataView:Mt,isArray:te,isFunction:xt,isArguments:qt,isFinite:function(M){return!Pt(M)&&T(M)&&!isNaN(parseFloat(M))},isNaN:ce,isTypedArray:K,isEmpty:function(M){if(M==null)return!0;var O=V(M);return typeof O=="number"&&(te(M)||gt(M)||qt(M))?O===0:V(Et(M))===0},isMatch:Tt,isEqual:function(M,O){return Lt(M,O)},isMap:yt,isWeakMap:Ct,isSet:zt,isWeakSet:Vt,keys:Et,allKeys:ee,values:xe,pairs:function(M){for(var O=Et(M),q=O.length,$=Array(q),ft=0;ft<q;ft++)$[ft]=[O[ft],M[O[ft]]];return $},invert:Be,functions:Ne,methods:Ne,extend:Ze,extendOwn:Ei,assign:Ei,defaults:_r,create:function(M,O){var q=as(M);return O&&Ei(q,O),q},clone:function(M){return j(M)?te(M)?M.slice():Ze({},M):M},tap:function(M,O){return O(M),M},get:Ea,has:function(M,O){for(var q=(O=Sn(O)).length,$=0;$<q;$++){var ft=O[$];if(!re(M,ft))return!1;M=M[ft]}return!!q},mapObject:function(M,O,q){O=Li(O,q);for(var $=Et(M),ft=$.length,ht={},_t=0;_t<ft;_t++){var Bt=$[_t];ht[Bt]=O(M[Bt],Bt,M)}return ht},identity:Cn,constant:ne,noop:Sa,toPath:Fs,property:In,propertyOf:function(M){return M==null?Sa:function(O){return Ea(M,O)}},matcher:Mn,matches:Mn,times:function(M,O,q){var $=Array(Math.max(0,M));O=Bn(O,q,1);for(var ft=0;ft<M;ft++)$[ft]=O(ft);return $},random:Hs,now:kn,escape:Ma,unescape:Ho,templateSettings:Go,template:function(M,O,q){!O&&q&&(O=q),O=_r({},O,at.templateSettings);var $=RegExp([(O.escape||Gs).source,(O.interpolate||Gs).source,(O.evaluate||Gs).source].join("|")+"|$","g"),ft=0,ht="__p+='";M.replace($,function(we,je,Fi,cn,un){return ht+=M.slice(ft,un).replace(zo,hr),ft=un+we.length,je?ht+=`'+
((__t=(`+je+`))==null?'':_.escape(__t))+
'`:Fi?ht+=`'+
((__t=(`+Fi+`))==null?'':__t)+
'`:cn&&(ht+=`';
`+cn+`
__p+='`),we}),ht+=`';
`;var _t,Bt=O.variable;if(Bt){if(!Vo.test(Bt))throw new Error("variable is not a bare identifier: "+Bt)}else ht=`with(obj||{}){
`+ht+`}
`,Bt="obj";ht=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+ht+`return __p;
`;try{_t=new Function(Bt,"_",ht)}catch(we){throw we.source=ht,we}var se=function(we){return _t.call(this,we,at)};return se.source="function("+Bt+`){
`+ht+"}",se},result:function(M,O,q){var $=(O=Sn(O)).length;if(!$)return xt(q)?q.call(M):q;for(var ft=0;ft<$;ft++){var ht=M?.[O[ft]];ht===void 0&&(ht=q,ft=$),M=xt(ht)?ht.call(M):ht}return M},uniqueId:function(M){var O=++os+"";return M?M+O:O},chain:function(M){var O=at(M);return O._chain=!0,O},iteratee:Us,partial:on,bind:Ba,bindAll:ka,memoize:function(M,O){var q=function($){var ft=q.cache,ht=""+(O?O.apply(this,arguments):$);return re(ft,ht)||(ft[ht]=M.apply(this,arguments)),ft[ht]};return q.cache={},q},delay:Ra,defer:Mi,throttle:function(M,O,q){var $,ft,ht,_t,Bt=0;q||(q={});var se=function(){Bt=q.leading===!1?0:kn(),$=null,_t=M.apply(ft,ht),$||(ft=ht=null)},we=function(){var je=kn();Bt||q.leading!==!1||(Bt=je);var Fi=O-(je-Bt);return ft=this,ht=arguments,Fi<=0||Fi>O?($&&(clearTimeout($),$=null),Bt=je,_t=M.apply(ft,ht),$||(ft=ht=null)):$||q.trailing===!1||($=setTimeout(se,Fi)),_t};return we.cancel=function(){clearTimeout($),Bt=0,$=ft=ht=null},we},debounce:function(M,O,q){var $,ft,ht,_t,Bt,se=function(){var je=kn()-ft;O>je?$=setTimeout(se,O-je):($=null,q||(_t=M.apply(Bt,ht)),$||(ht=Bt=null))},we=Y(function(je){return Bt=this,ht=je,ft=kn(),$||($=setTimeout(se,O),q&&(_t=M.apply(Bt,ht))),_t});return we.cancel=function(){clearTimeout($),$=ht=Bt=null},we},wrap:function(M,O){return on(O,M)},negate:Ws,compose:function(){var M=arguments,O=M.length-1;return function(){for(var q=O,$=M[O].apply(this,arguments);q--;)$=M[q].call(this,$);return $}},after:function(M,O){return function(){if(--M<1)return O.apply(this,arguments)}},before:Pa,once:Da,findKey:hn,findIndex:ti,findLastIndex:La,sortedIndex:hs,indexOf:ls,lastIndexOf:Oa,find:cs,detect:cs,findWhere:function(M,O){return cs(M,Mn(O))},each:lr,forEach:lr,map:cr,collect:cr,reduce:ds,foldl:ds,inject:ds,reduceRight:fs,foldr:fs,filter:Br,select:Br,reject:function(M,O,q){return Br(M,Ws(Li(O)),q)},every:wr,all:wr,some:B,any:B,contains:D,includes:D,include:D,invoke:G,pluck:ot,where:function(M,O){return Br(M,Mn(O))},max:It,min:function(M,O,q){var $,ft,ht=1/0,_t=1/0;if(O==null||typeof O=="number"&&typeof M[0]!="object"&&M!=null)for(var Bt=0,se=(M=Oi(M)?M:xe(M)).length;Bt<se;Bt++)($=M[Bt])!=null&&$<ht&&(ht=$);else O=Li(O,q),lr(M,function(we,je,Fi){((ft=O(we,je,Fi))<_t||ft===1/0&&ht===1/0)&&(ht=we,_t=ft)});return ht},shuffle:function(M){return Qt(M,1/0)},sample:Qt,sortBy:function(M,O,q){var $=0;return O=Li(O,q),ot(cr(M,function(ft,ht,_t){return{value:ft,index:$++,criteria:O(ft,ht,_t)}}).sort(function(ft,ht){var _t=ft.criteria,Bt=ht.criteria;if(_t!==Bt){if(_t>Bt||_t===void 0)return 1;if(_t<Bt||Bt===void 0)return-1}return ft.index-ht.index}),"value")},groupBy:mi,indexBy:Wi,countBy:zi,partition:br,toArray:Kt,size:function(M){return M==null?0:Oi(M)?M.length:Et(M).length},pick:$i,omit:Vi,first:ur,head:ur,take:ur,initial:Rn,last:function(M,O,q){return M==null||M.length<1?O==null||q?void 0:[]:O==null||q?M[M.length-1]:ln(M,Math.max(0,M.length-O))},rest:ln,tail:ln,drop:ln,compact:function(M){return Br(M,Boolean)},flatten:function(M,O){return Ir(M,O,!1)},without:$c,uniq:Xe,unique:Xe,union:qe,intersection:function(M){for(var O=[],q=arguments.length,$=0,ft=V(M);$<ft;$++){var ht=M[$];if(!D(O,ht)){var _t;for(_t=1;_t<q&&D(arguments[_t],ht);_t++);_t===q&&O.push(ht)}}return O},difference:Fh,unzip:Xo,transpose:Xo,zip:Zc,object:function(M,O){for(var q={},$=0,ft=V(M);$<ft;$++)O?q[M[$]]=O[$]:q[M[$][0]]=M[$][1];return q},range:function(M,O,q){O==null&&(O=M||0,M=0),q||(q=O<M?-1:1);for(var $=Math.max(Math.ceil((O-M)/q),0),ft=Array($),ht=0;ht<$;ht++,M+=q)ft[ht]=M;return ft},chunk:function(M,O){if(O==null||O<1)return[];for(var q=[],$=0,ft=M.length;$<ft;)q.push(u.call(M,$,$+=O));return q},mixin:Nh,default:at});return Yo._=Yo,Yo})})(Wy);const sr=Wy.exports,er={};er.ascii85={};er.ascii85.enc={0:"!",1:'"',2:"#",3:"$",4:"%",5:"&",6:"'",7:"(",8:")",9:"*",10:"+",11:",",12:"-",13:".",14:"/",15:"0",16:"1",17:"2",18:"3",19:"4",20:"5",21:"6",22:"7",23:"8",24:"9",25:":",26:";",27:"<",28:"=",29:">",30:"?",31:"@",32:"A",33:"B",34:"C",35:"D",36:"E",37:"F",38:"G",39:"H",40:"I",41:"J",42:"K",43:"L",44:"M",45:"N",46:"O",47:"P",48:"Q",49:"R",50:"S",51:"T",52:"U",53:"V",54:"W",55:"X",56:"Y",57:"Z",58:"[",59:"\\",60:"]",61:"^",62:"_",63:"`",64:"a",65:"b",66:"c",67:"d",68:"e",69:"f",70:"g",71:"h",72:"i",73:"j",74:"k",75:"l",76:"m",77:"n",78:"o",79:"p",80:"q",81:"r",82:"s",83:"t",84:"u"};er.ascii85.dec=sr.object(sr.map(sr.values(er.ascii85.enc),function(i){return i.charCodeAt(0)}),sr.map(sr.keys(er.ascii85.enc),function(i){return parseInt(i)}));er.z85={};er.z85.enc={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"a",11:"b",12:"c",13:"d",14:"e",15:"f",16:"g",17:"h",18:"i",19:"j",20:"k",21:"l",22:"m",23:"n",24:"o",25:"p",26:"q",27:"r",28:"s",29:"t",30:"u",31:"v",32:"w",33:"x",34:"y",35:"z",36:"A",37:"B",38:"C",39:"D",40:"E",41:"F",42:"G",43:"H",44:"I",45:"J",46:"K",47:"L",48:"M",49:"N",50:"O",51:"P",52:"Q",53:"R",54:"S",55:"T",56:"U",57:"V",58:"W",59:"X",60:"Y",61:"Z",62:".",63:"-",64:":",65:"+",66:"=",67:"^",68:"!",69:"/",70:"*",71:"?",72:"&",73:"<",74:">",75:"(",76:")",77:"[",78:"]",79:"{",80:"}",81:"@",82:"%",83:"$",84:"#"};er.z85.dec=sr.object(sr.map(sr.values(er.z85.enc),function(i){return i.charCodeAt(0)}),sr.map(sr.keys(er.z85.enc),function(i){return parseInt(i)}));er.ipv6={};er.ipv6.enc={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"A",11:"B",12:"C",13:"D",14:"E",15:"F",16:"G",17:"H",18:"I",19:"J",20:"K",21:"L",22:"M",23:"N",24:"O",25:"P",26:"Q",27:"R",28:"S",29:"T",30:"U",31:"V",32:"W",33:"X",34:"Y",35:"Z",36:"a",37:"b",38:"c",39:"d",40:"e",41:"f",42:"g",43:"h",44:"i",45:"j",46:"k",47:"l",48:"m",49:"n",50:"o",51:"p",52:"q",53:"r",54:"s",55:"t",56:"u",57:"v",58:"w",59:"x",60:"y",61:"z",62:"!",63:"#",64:"$",65:"%",66:"&",67:"(",68:")",69:"*",70:"+",71:"-",72:";",73:"<",74:"=",75:">",76:"?",77:"@",78:"^",79:"_",80:"`",81:"{",82:"|",83:"}",84:"~"};er.ipv6.dec=sr.object(sr.map(sr.values(er.ipv6.enc),function(i){return i.charCodeAt(0)}),sr.map(sr.keys(er.ipv6.enc),function(i){return parseInt(i)}));var hB=er,Gc={},Bf={exports:{}};(function(i,t){(function(){var e,r=0xdeadbeefcafe,n=(r&16777215)==15715070;function s(B,D,G){B!=null&&(typeof B=="number"?this.fromNumber(B,D,G):D==null&&typeof B!="string"?this.fromString(B,256):this.fromString(B,D))}function a(){return new s(null)}function o(B,D,G,ot,It,Ft){for(;--Ft>=0;){var Kt=D*this[B++]+G[ot]+It;It=Math.floor(Kt/67108864),G[ot++]=Kt&67108863}return It}function u(B,D,G,ot,It,Ft){for(var Kt=D&32767,Qt=D>>15;--Ft>=0;){var Ge=this[B]&32767,mi=this[B++]>>15,Wi=Qt*Ge+mi*Kt;Ge=Kt*Ge+((Wi&32767)<<15)+G[ot]+(It&1073741823),It=(Ge>>>30)+(Wi>>>15)+Qt*mi+(It>>>30),G[ot++]=Ge&1073741823}return It}function d(B,D,G,ot,It,Ft){for(var Kt=D&16383,Qt=D>>14;--Ft>=0;){var Ge=this[B]&16383,mi=this[B++]>>14,Wi=Qt*Ge+mi*Kt;Ge=Kt*Ge+((Wi&16383)<<14)+G[ot]+It,It=(Ge>>28)+(Wi>>14)+Qt*mi,G[ot++]=Ge&268435455}return It}var m=typeof navigator<"u";m&&n&&navigator.appName=="Microsoft Internet Explorer"?(s.prototype.am=u,e=30):m&&n&&navigator.appName!="Netscape"?(s.prototype.am=o,e=26):(s.prototype.am=d,e=28),s.prototype.DB=e,s.prototype.DM=(1<<e)-1,s.prototype.DV=1<<e;var l=52;s.prototype.FV=Math.pow(2,l),s.prototype.F1=l-e,s.prototype.F2=2*e-l;var f="0123456789abcdefghijklmnopqrstuvwxyz",p=new Array,y,v;for(y="0".charCodeAt(0),v=0;v<=9;++v)p[y++]=v;for(y="a".charCodeAt(0),v=10;v<36;++v)p[y++]=v;for(y="A".charCodeAt(0),v=10;v<36;++v)p[y++]=v;function _(B){return f.charAt(B)}function w(B,D){var G=p[B.charCodeAt(D)];return G??-1}function T(B){for(var D=this.t-1;D>=0;--D)B[D]=this[D];B.t=this.t,B.s=this.s}function E(B){this.t=1,this.s=B<0?-1:0,B>0?this[0]=B:B<-1?this[0]=B+this.DV:this.t=0}function R(B){var D=a();return D.fromInt(B),D}function H(B,D){var G;if(D==16)G=4;else if(D==8)G=3;else if(D==256)G=8;else if(D==2)G=1;else if(D==32)G=5;else if(D==4)G=2;else{this.fromRadix(B,D);return}this.t=0,this.s=0;for(var ot=B.length,It=!1,Ft=0;--ot>=0;){var Kt=G==8?B[ot]&255:w(B,ot);if(Kt<0){B.charAt(ot)=="-"&&(It=!0);continue}It=!1,Ft==0?this[this.t++]=Kt:Ft+G>this.DB?(this[this.t-1]|=(Kt&(1<<this.DB-Ft)-1)<<Ft,this[this.t++]=Kt>>this.DB-Ft):this[this.t-1]|=Kt<<Ft,Ft+=G,Ft>=this.DB&&(Ft-=this.DB)}G==8&&(B[0]&128)!=0&&(this.s=-1,Ft>0&&(this[this.t-1]|=(1<<this.DB-Ft)-1<<Ft)),this.clamp(),It&&s.ZERO.subTo(this,this)}function Y(){for(var B=this.s&this.DM;this.t>0&&this[this.t-1]==B;)--this.t}function j(B){if(this.s<0)return"-"+this.negate().toString(B);var D;if(B==16)D=4;else if(B==8)D=3;else if(B==2)D=1;else if(B==32)D=5;else if(B==4)D=2;else return this.toRadix(B);var G=(1<<D)-1,ot,It=!1,Ft="",Kt=this.t,Qt=this.DB-Kt*this.DB%D;if(Kt-- >0)for(Qt<this.DB&&(ot=this[Kt]>>Qt)>0&&(It=!0,Ft=_(ot));Kt>=0;)Qt<D?(ot=(this[Kt]&(1<<Qt)-1)<<D-Qt,ot|=this[--Kt]>>(Qt+=this.DB-D)):(ot=this[Kt]>>(Qt-=D)&G,Qt<=0&&(Qt+=this.DB,--Kt)),ot>0&&(It=!0),It&&(Ft+=_(ot));return It?Ft:"0"}function et(){var B=a();return s.ZERO.subTo(this,B),B}function J(){return this.s<0?this.negate():this}function rt(B){var D=this.s-B.s;if(D!=0)return D;var G=this.t;if(D=G-B.t,D!=0)return this.s<0?-D:D;for(;--G>=0;)if((D=this[G]-B[G])!=0)return D;return 0}function gt(B){var D=1,G;return(G=B>>>16)!=0&&(B=G,D+=16),(G=B>>8)!=0&&(B=G,D+=8),(G=B>>4)!=0&&(B=G,D+=4),(G=B>>2)!=0&&(B=G,D+=2),(G=B>>1)!=0&&(B=G,D+=1),D}function X(){return this.t<=0?0:this.DB*(this.t-1)+gt(this[this.t-1]^this.s&this.DM)}function Q(B,D){var G;for(G=this.t-1;G>=0;--G)D[G+B]=this[G];for(G=B-1;G>=0;--G)D[G]=0;D.t=this.t+B,D.s=this.s}function S(B,D){for(var G=B;G<this.t;++G)D[G-B]=this[G];D.t=Math.max(this.t-B,0),D.s=this.s}function ut(B,D){var G=B%this.DB,ot=this.DB-G,It=(1<<ot)-1,Ft=Math.floor(B/this.DB),Kt=this.s<<G&this.DM,Qt;for(Qt=this.t-1;Qt>=0;--Qt)D[Qt+Ft+1]=this[Qt]>>ot|Kt,Kt=(this[Qt]&It)<<G;for(Qt=Ft-1;Qt>=0;--Qt)D[Qt]=0;D[Ft]=Kt,D.t=this.t+Ft+1,D.s=this.s,D.clamp()}function Pt(B,D){D.s=this.s;var G=Math.floor(B/this.DB);if(G>=this.t){D.t=0;return}var ot=B%this.DB,It=this.DB-ot,Ft=(1<<ot)-1;D[0]=this[G]>>ot;for(var Kt=G+1;Kt<this.t;++Kt)D[Kt-G-1]|=(this[Kt]&Ft)<<It,D[Kt-G]=this[Kt]>>ot;ot>0&&(D[this.t-G-1]|=(this.s&Ft)<<It),D.t=this.t-G,D.clamp()}function pt(B,D){for(var G=0,ot=0,It=Math.min(B.t,this.t);G<It;)ot+=this[G]-B[G],D[G++]=ot&this.DM,ot>>=this.DB;if(B.t<this.t){for(ot-=B.s;G<this.t;)ot+=this[G],D[G++]=ot&this.DM,ot>>=this.DB;ot+=this.s}else{for(ot+=this.s;G<B.t;)ot-=B[G],D[G++]=ot&this.DM,ot>>=this.DB;ot-=B.s}D.s=ot<0?-1:0,ot<-1?D[G++]=this.DV+ot:ot>0&&(D[G++]=ot),D.t=G,D.clamp()}function Wt(B,D){var G=this.abs(),ot=B.abs(),It=G.t;for(D.t=It+ot.t;--It>=0;)D[It]=0;for(It=0;It<ot.t;++It)D[It+G.t]=G.am(0,ot[It],D,It,0,G.t);D.s=0,D.clamp(),this.s!=B.s&&s.ZERO.subTo(D,D)}function bt(B){for(var D=this.abs(),G=B.t=2*D.t;--G>=0;)B[G]=0;for(G=0;G<D.t-1;++G){var ot=D.am(G,D[G],B,2*G,0,1);(B[G+D.t]+=D.am(G+1,2*D[G],B,2*G+1,ot,D.t-G-1))>=D.DV&&(B[G+D.t]-=D.DV,B[G+D.t+1]=1)}B.t>0&&(B[B.t-1]+=D.am(G,D[G],B,2*G,0,1)),B.s=0,B.clamp()}function xt(B,D,G){var ot=B.abs();if(!(ot.t<=0)){var It=this.abs();if(It.t<ot.t){D?.fromInt(0),G!=null&&this.copyTo(G);return}G==null&&(G=a());var Ft=a(),Kt=this.s,Qt=B.s,Ge=this.DB-gt(ot[ot.t-1]);Ge>0?(ot.lShiftTo(Ge,Ft),It.lShiftTo(Ge,G)):(ot.copyTo(Ft),It.copyTo(G));var mi=Ft.t,Wi=Ft[mi-1];if(Wi!=0){var zi=Wi*(1<<this.F1)+(mi>1?Ft[mi-2]>>this.F2:0),br=this.FV/zi,ps=(1<<this.F1)/zi,$i=1<<this.F2,Vi=G.t,Rn=Vi-mi,ur=D??a();for(Ft.dlShiftTo(Rn,ur),G.compareTo(ur)>=0&&(G[G.t++]=1,G.subTo(ur,G)),s.ONE.dlShiftTo(mi,ur),ur.subTo(Ft,Ft);Ft.t<mi;)Ft[Ft.t++]=0;for(;--Rn>=0;){var ln=G[--Vi]==Wi?this.DM:Math.floor(G[Vi]*br+(G[Vi-1]+$i)*ps);if((G[Vi]+=Ft.am(0,ln,G,Rn,0,mi))<ln)for(Ft.dlShiftTo(Rn,ur),G.subTo(ur,G);G[Vi]<--ln;)G.subTo(ur,G)}D!=null&&(G.drShiftTo(mi,D),Kt!=Qt&&s.ZERO.subTo(D,D)),G.t=mi,G.clamp(),Ge>0&&G.rShiftTo(Ge,G),Kt<0&&s.ZERO.subTo(G,G)}}}function tt(B){var D=a();return this.abs().divRemTo(B,null,D),this.s<0&&D.compareTo(s.ZERO)>0&&B.subTo(D,D),D}function it(B){this.m=B}function Gt(B){return B.s<0||B.compareTo(this.m)>=0?B.mod(this.m):B}function Dt(B){return B}function Mt(B){B.divRemTo(this.m,null,B)}function te(B,D,G){B.multiplyTo(D,G),this.reduce(G)}function re(B,D){B.squareTo(D),this.reduce(D)}it.prototype.convert=Gt,it.prototype.revert=Dt,it.prototype.reduce=Mt,it.prototype.mulTo=te,it.prototype.sqrTo=re;function jt(){if(this.t<1)return 0;var B=this[0];if((B&1)==0)return 0;var D=B&3;return D=D*(2-(B&15)*D)&15,D=D*(2-(B&255)*D)&255,D=D*(2-((B&65535)*D&65535))&65535,D=D*(2-B*D%this.DV)%this.DV,D>0?this.DV-D:-D}function qt(B){this.m=B,this.mp=B.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<B.DB-15)-1,this.mt2=2*B.t}function ce(B){var D=a();return B.abs().dlShiftTo(this.m.t,D),D.divRemTo(this.m,null,D),B.s<0&&D.compareTo(s.ZERO)>0&&this.m.subTo(D,D),D}function ne(B){var D=a();return B.copyTo(D),this.reduce(D),D}function _e(B){for(;B.t<=this.mt2;)B[B.t++]=0;for(var D=0;D<this.m.t;++D){var G=B[D]&32767,ot=G*this.mpl+((G*this.mph+(B[D]>>15)*this.mpl&this.um)<<15)&B.DM;for(G=D+this.m.t,B[G]+=this.m.am(0,ot,B,D,0,this.m.t);B[G]>=B.DV;)B[G]-=B.DV,B[++G]++}B.clamp(),B.drShiftTo(this.m.t,B),B.compareTo(this.m)>=0&&B.subTo(this.m,B)}function pe(B,D){B.squareTo(D),this.reduce(D)}function C(B,D,G){B.multiplyTo(D,G),this.reduce(G)}qt.prototype.convert=ce,qt.prototype.revert=ne,qt.prototype.reduce=_e,qt.prototype.mulTo=C,qt.prototype.sqrTo=pe;function At(){return(this.t>0?this[0]&1:this.s)==0}function vt(B,D){if(B>4294967295||B<1)return s.ONE;var G=a(),ot=a(),It=D.convert(this),Ft=gt(B)-1;for(It.copyTo(G);--Ft>=0;)if(D.sqrTo(G,ot),(B&1<<Ft)>0)D.mulTo(ot,It,G);else{var Kt=G;G=ot,ot=Kt}return D.revert(G)}function K(B,D){var G;return B<256||D.isEven()?G=new it(D):G=new qt(D),this.exp(B,G)}s.prototype.copyTo=T,s.prototype.fromInt=E,s.prototype.fromString=H,s.prototype.clamp=Y,s.prototype.dlShiftTo=Q,s.prototype.drShiftTo=S,s.prototype.lShiftTo=ut,s.prototype.rShiftTo=Pt,s.prototype.subTo=pt,s.prototype.multiplyTo=Wt,s.prototype.squareTo=bt,s.prototype.divRemTo=xt,s.prototype.invDigit=jt,s.prototype.isEven=At,s.prototype.exp=vt,s.prototype.toString=j,s.prototype.negate=et,s.prototype.abs=J,s.prototype.compareTo=rt,s.prototype.bitLength=X,s.prototype.mod=tt,s.prototype.modPowInt=K,s.ZERO=R(0),s.ONE=R(1);function V(){var B=a();return this.copyTo(B),B}function lt(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Et(){return this.t==0?this.s:this[0]<<24>>24}function Tt(){return this.t==0?this.s:this[0]<<16>>16}function at(B){return Math.floor(Math.LN2*this.DB/Math.log(B))}function Ut(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function $t(B){if(B==null&&(B=10),this.signum()==0||B<2||B>36)return"0";var D=this.chunkSize(B),G=Math.pow(B,D),ot=R(G),It=a(),Ft=a(),Kt="";for(this.divRemTo(ot,It,Ft);It.signum()>0;)Kt=(G+Ft.intValue()).toString(B).substr(1)+Kt,It.divRemTo(ot,It,Ft);return Ft.intValue().toString(B)+Kt}function Lt(B,D){this.fromInt(0),D==null&&(D=10);for(var G=this.chunkSize(D),ot=Math.pow(D,G),It=!1,Ft=0,Kt=0,Qt=0;Qt<B.length;++Qt){var Ge=w(B,Qt);if(Ge<0){B.charAt(Qt)=="-"&&this.signum()==0&&(It=!0);continue}Kt=D*Kt+Ge,++Ft>=G&&(this.dMultiply(ot),this.dAddOffset(Kt,0),Ft=0,Kt=0)}Ft>0&&(this.dMultiply(Math.pow(D,Ft)),this.dAddOffset(Kt,0)),It&&s.ZERO.subTo(this,this)}function ee(B,D,G){if(typeof D=="number")if(B<2)this.fromInt(1);else for(this.fromNumber(B,G),this.testBit(B-1)||this.bitwiseTo(s.ONE.shiftLeft(B-1),mt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(D);)this.dAddOffset(2,0),this.bitLength()>B&&this.subTo(s.ONE.shiftLeft(B-1),this);else{var ot=new Array,It=B&7;ot.length=(B>>3)+1,D.nextBytes(ot),It>0?ot[0]&=(1<<It)-1:ot[0]=0,this.fromString(ot,256)}}function L(){var B=this.t,D=new Array;D[0]=this.s;var G=this.DB-B*this.DB%8,ot,It=0;if(B-- >0)for(G<this.DB&&(ot=this[B]>>G)!=(this.s&this.DM)>>G&&(D[It++]=ot|this.s<<this.DB-G);B>=0;)G<8?(ot=(this[B]&(1<<G)-1)<<8-G,ot|=this[--B]>>(G+=this.DB-8)):(ot=this[B]>>(G-=8)&255,G<=0&&(G+=this.DB,--B)),(ot&128)!=0&&(ot|=-256),It==0&&(this.s&128)!=(ot&128)&&++It,(It>0||ot!=this.s)&&(D[It++]=ot);return D}function b(B){return this.compareTo(B)==0}function A(B){return this.compareTo(B)<0?this:B}function z(B){return this.compareTo(B)>0?this:B}function nt(B,D,G){var ot,It,Ft=Math.min(B.t,this.t);for(ot=0;ot<Ft;++ot)G[ot]=D(this[ot],B[ot]);if(B.t<this.t){for(It=B.s&this.DM,ot=Ft;ot<this.t;++ot)G[ot]=D(this[ot],It);G.t=this.t}else{for(It=this.s&this.DM,ot=Ft;ot<B.t;++ot)G[ot]=D(It,B[ot]);G.t=B.t}G.s=D(this.s,B.s),G.clamp()}function I(B,D){return B&D}function N(B){var D=a();return this.bitwiseTo(B,I,D),D}function mt(B,D){return B|D}function yt(B){var D=a();return this.bitwiseTo(B,mt,D),D}function Ct(B,D){return B^D}function zt(B){var D=a();return this.bitwiseTo(B,Ct,D),D}function Vt(B,D){return B&~D}function xe(B){var D=a();return this.bitwiseTo(B,Vt,D),D}function Be(){for(var B=a(),D=0;D<this.t;++D)B[D]=this.DM&~this[D];return B.t=this.t,B.s=~this.s,B}function Ne(B){var D=a();return B<0?this.rShiftTo(-B,D):this.lShiftTo(B,D),D}function ke(B){var D=a();return B<0?this.lShiftTo(-B,D):this.rShiftTo(B,D),D}function Ze(B){if(B==0)return-1;var D=0;return(B&65535)==0&&(B>>=16,D+=16),(B&255)==0&&(B>>=8,D+=8),(B&15)==0&&(B>>=4,D+=4),(B&3)==0&&(B>>=2,D+=2),(B&1)==0&&++D,D}function Ei(){for(var B=0;B<this.t;++B)if(this[B]!=0)return B*this.DB+Ze(this[B]);return this.s<0?this.t*this.DB:-1}function _r(B){for(var D=0;B!=0;)B&=B-1,++D;return D}function as(){for(var B=0,D=this.s&this.DM,G=0;G<this.t;++G)B+=_r(this[G]^D);return B}function Fs(B){var D=Math.floor(B/this.DB);return D>=this.t?this.s!=0:(this[D]&1<<B%this.DB)!=0}function Sn(B,D){var G=s.ONE.shiftLeft(B);return this.bitwiseTo(G,D,G),G}function Ns(B){return this.changeBit(B,mt)}function Ea(B){return this.changeBit(B,Vt)}function Cn(B){return this.changeBit(B,Ct)}function Mn(B,D){for(var G=0,ot=0,It=Math.min(B.t,this.t);G<It;)ot+=this[G]+B[G],D[G++]=ot&this.DM,ot>>=this.DB;if(B.t<this.t){for(ot+=B.s;G<this.t;)ot+=this[G],D[G++]=ot&this.DM,ot>>=this.DB;ot+=this.s}else{for(ot+=this.s;G<B.t;)ot+=B[G],D[G++]=ot&this.DM,ot>>=this.DB;ot+=B.s}D.s=ot<0?-1:0,ot>0?D[G++]=ot:ot<-1&&(D[G++]=this.DV+ot),D.t=G,D.clamp()}function In(B){var D=a();return this.addTo(B,D),D}function Bn(B){var D=a();return this.subTo(B,D),D}function Ta(B){var D=a();return this.multiplyTo(B,D),D}function Us(){var B=a();return this.squareTo(B),B}function Li(B){var D=a();return this.divRemTo(B,D,null),D}function Sa(B){var D=a();return this.divRemTo(B,null,D),D}function Hs(B){var D=a(),G=a();return this.divRemTo(B,D,G),new Array(D,G)}function kn(B){this[this.t]=this.am(0,B-1,this,0,0,this.t),++this.t,this.clamp()}function Ca(B,D){if(B!=0){for(;this.t<=D;)this[this.t++]=0;for(this[D]+=B;this[D]>=this.DV;)this[D]-=this.DV,++D>=this.t&&(this[this.t++]=0),++this[D]}}function Vr(){}function Ma(B){return B}function Ho(B,D,G){B.multiplyTo(D,G)}function Go(B,D){B.squareTo(D)}Vr.prototype.convert=Ma,Vr.prototype.revert=Ma,Vr.prototype.mulTo=Ho,Vr.prototype.sqrTo=Go;function Gs(B){return this.exp(B,new Vr)}function Wo(B,D,G){var ot=Math.min(this.t+B.t,D);for(G.s=0,G.t=ot;ot>0;)G[--ot]=0;var It;for(It=G.t-this.t;ot<It;++ot)G[ot+this.t]=this.am(0,B[ot],G,ot,0,this.t);for(It=Math.min(B.t,D);ot<It;++ot)this.am(0,B[ot],G,ot,0,D-ot);G.clamp()}function zo(B,D,G){--D;var ot=G.t=this.t+B.t-D;for(G.s=0;--ot>=0;)G[ot]=0;for(ot=Math.max(D-this.t,0);ot<B.t;++ot)G[this.t+ot-D]=this.am(D-ot,B[ot],G,0,0,this.t+ot-D);G.clamp(),G.drShiftTo(1,G)}function hr(B){this.r2=a(),this.q3=a(),s.ONE.dlShiftTo(2*B.t,this.r2),this.mu=this.r2.divide(B),this.m=B}function Vo(B){if(B.s<0||B.t>2*this.m.t)return B.mod(this.m);if(B.compareTo(this.m)<0)return B;var D=a();return B.copyTo(D),this.reduce(D),D}function os(B){return B}function Ia(B){for(B.drShiftTo(this.m.t-1,this.r2),B.t>this.m.t+1&&(B.t=this.m.t+1,B.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);B.compareTo(this.r2)<0;)B.dAddOffset(1,this.m.t+1);for(B.subTo(this.r2,B);B.compareTo(this.m)>=0;)B.subTo(this.m,B)}function on(B,D){B.squareTo(D),this.reduce(D)}function Ba(B,D,G){B.multiplyTo(D,G),this.reduce(G)}hr.prototype.convert=Vo,hr.prototype.revert=os,hr.prototype.reduce=Ia,hr.prototype.mulTo=Ba,hr.prototype.sqrTo=on;function Oi(B,D){var G=B.bitLength(),ot,It=R(1),Ft;if(G<=0)return It;G<18?ot=1:G<48?ot=3:G<144?ot=4:G<768?ot=5:ot=6,G<8?Ft=new it(D):D.isEven()?Ft=new hr(D):Ft=new qt(D);var Kt=new Array,Qt=3,Ge=ot-1,mi=(1<<ot)-1;if(Kt[1]=Ft.convert(this),ot>1){var Wi=a();for(Ft.sqrTo(Kt[1],Wi);Qt<=mi;)Kt[Qt]=a(),Ft.mulTo(Wi,Kt[Qt-2],Kt[Qt]),Qt+=2}var zi=B.t-1,br,ps=!0,$i=a(),Vi;for(G=gt(B[zi])-1;zi>=0;){for(G>=Ge?br=B[zi]>>G-Ge&mi:(br=(B[zi]&(1<<G+1)-1)<<Ge-G,zi>0&&(br|=B[zi-1]>>this.DB+G-Ge)),Qt=ot;(br&1)==0;)br>>=1,--Qt;if((G-=Qt)<0&&(G+=this.DB,--zi),ps)Kt[br].copyTo(It),ps=!1;else{for(;Qt>1;)Ft.sqrTo(It,$i),Ft.sqrTo($i,It),Qt-=2;Qt>0?Ft.sqrTo(It,$i):(Vi=It,It=$i,$i=Vi),Ft.mulTo($i,Kt[br],It)}for(;zi>=0&&(B[zi]&1<<G)==0;)Ft.sqrTo(It,$i),Vi=It,It=$i,$i=Vi,--G<0&&(G=this.DB-1,--zi)}return Ft.revert(It)}function Ir(B){var D=this.s<0?this.negate():this.clone(),G=B.s<0?B.negate():B.clone();if(D.compareTo(G)<0){var ot=D;D=G,G=ot}var It=D.getLowestSetBit(),Ft=G.getLowestSetBit();if(Ft<0)return D;for(It<Ft&&(Ft=It),Ft>0&&(D.rShiftTo(Ft,D),G.rShiftTo(Ft,G));D.signum()>0;)(It=D.getLowestSetBit())>0&&D.rShiftTo(It,D),(It=G.getLowestSetBit())>0&&G.rShiftTo(It,G),D.compareTo(G)>=0?(D.subTo(G,D),D.rShiftTo(1,D)):(G.subTo(D,G),G.rShiftTo(1,G));return Ft>0&&G.lShiftTo(Ft,G),G}function ka(B){if(B<=0)return 0;var D=this.DV%B,G=this.s<0?B-1:0;if(this.t>0)if(D==0)G=this[0]%B;else for(var ot=this.t-1;ot>=0;--ot)G=(D*G+this[ot])%B;return G}function Ra(B){var D=B.isEven();if(this.isEven()&&D||B.signum()==0)return s.ZERO;for(var G=B.clone(),ot=this.clone(),It=R(1),Ft=R(0),Kt=R(0),Qt=R(1);G.signum()!=0;){for(;G.isEven();)G.rShiftTo(1,G),D?((!It.isEven()||!Ft.isEven())&&(It.addTo(this,It),Ft.subTo(B,Ft)),It.rShiftTo(1,It)):Ft.isEven()||Ft.subTo(B,Ft),Ft.rShiftTo(1,Ft);for(;ot.isEven();)ot.rShiftTo(1,ot),D?((!Kt.isEven()||!Qt.isEven())&&(Kt.addTo(this,Kt),Qt.subTo(B,Qt)),Kt.rShiftTo(1,Kt)):Qt.isEven()||Qt.subTo(B,Qt),Qt.rShiftTo(1,Qt);G.compareTo(ot)>=0?(G.subTo(ot,G),D&&It.subTo(Kt,It),Ft.subTo(Qt,Ft)):(ot.subTo(G,ot),D&&Kt.subTo(It,Kt),Qt.subTo(Ft,Qt))}if(ot.compareTo(s.ONE)!=0)return s.ZERO;if(Qt.compareTo(B)>=0)return Qt.subtract(B);if(Qt.signum()<0)Qt.addTo(B,Qt);else return Qt;return Qt.signum()<0?Qt.add(B):Qt}var Mi=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Ws=(1<<26)/Mi[Mi.length-1];function Pa(B){var D,G=this.abs();if(G.t==1&&G[0]<=Mi[Mi.length-1]){for(D=0;D<Mi.length;++D)if(G[0]==Mi[D])return!0;return!1}if(G.isEven())return!1;for(D=1;D<Mi.length;){for(var ot=Mi[D],It=D+1;It<Mi.length&&ot<Ws;)ot*=Mi[It++];for(ot=G.modInt(ot);D<It;)if(ot%Mi[D++]==0)return!1}return G.millerRabin(B)}function Da(B){var D=this.subtract(s.ONE),G=D.getLowestSetBit();if(G<=0)return!1;var ot=D.shiftRight(G);B=B+1>>1,B>Mi.length&&(B=Mi.length);for(var It=a(),Ft=0;Ft<B;++Ft){It.fromInt(Mi[Math.floor(Math.random()*Mi.length)]);var Kt=It.modPow(ot,this);if(Kt.compareTo(s.ONE)!=0&&Kt.compareTo(D)!=0){for(var Qt=1;Qt++<G&&Kt.compareTo(D)!=0;)if(Kt=Kt.modPowInt(2,this),Kt.compareTo(s.ONE)==0)return!1;if(Kt.compareTo(D)!=0)return!1}}return!0}s.prototype.chunkSize=at,s.prototype.toRadix=$t,s.prototype.fromRadix=Lt,s.prototype.fromNumber=ee,s.prototype.bitwiseTo=nt,s.prototype.changeBit=Sn,s.prototype.addTo=Mn,s.prototype.dMultiply=kn,s.prototype.dAddOffset=Ca,s.prototype.multiplyLowerTo=Wo,s.prototype.multiplyUpperTo=zo,s.prototype.modInt=ka,s.prototype.millerRabin=Da,s.prototype.clone=V,s.prototype.intValue=lt,s.prototype.byteValue=Et,s.prototype.shortValue=Tt,s.prototype.signum=Ut,s.prototype.toByteArray=L,s.prototype.equals=b,s.prototype.min=A,s.prototype.max=z,s.prototype.and=N,s.prototype.or=yt,s.prototype.xor=zt,s.prototype.andNot=xe,s.prototype.not=Be,s.prototype.shiftLeft=Ne,s.prototype.shiftRight=ke,s.prototype.getLowestSetBit=Ei,s.prototype.bitCount=as,s.prototype.testBit=Fs,s.prototype.setBit=Ns,s.prototype.clearBit=Ea,s.prototype.flipBit=Cn,s.prototype.add=In,s.prototype.subtract=Bn,s.prototype.multiply=Ta,s.prototype.divide=Li,s.prototype.remainder=Sa,s.prototype.divideAndRemainder=Hs,s.prototype.modPow=Oi,s.prototype.modInverse=Ra,s.prototype.pow=Gs,s.prototype.gcd=Ir,s.prototype.isProbablePrime=Pa,s.prototype.square=Us,s.prototype.Barrett=hr;var hn,Ii,ti;function La(B){Ii[ti++]^=B&255,Ii[ti++]^=B>>8&255,Ii[ti++]^=B>>16&255,Ii[ti++]^=B>>24&255,ti>=wr&&(ti-=wr)}function hs(){La(new Date().getTime())}if(Ii==null){Ii=new Array,ti=0;var Bi;if(typeof window<"u"&&window.crypto){if(window.crypto.getRandomValues){var ls=new Uint8Array(32);for(window.crypto.getRandomValues(ls),Bi=0;Bi<32;++Bi)Ii[ti++]=ls[Bi]}else if(navigator.appName=="Netscape"&&navigator.appVersion<"5"){var Oa=window.crypto.random(32);for(Bi=0;Bi<Oa.length;++Bi)Ii[ti++]=Oa.charCodeAt(Bi)&255}}for(;ti<wr;)Bi=Math.floor(65536*Math.random()),Ii[ti++]=Bi>>>8,Ii[ti++]=Bi&255;ti=0,hs()}function cs(){if(hn==null){for(hs(),hn=Br(),hn.init(Ii),ti=0;ti<Ii.length;++ti)Ii[ti]=0;ti=0}return hn.next()}function lr(B){var D;for(D=0;D<B.length;++D)B[D]=cs()}function cr(){}cr.prototype.nextBytes=lr;function us(){this.i=0,this.j=0,this.S=new Array}function ds(B){var D,G,ot;for(D=0;D<256;++D)this.S[D]=D;for(G=0,D=0;D<256;++D)G=G+this.S[D]+B[D%B.length]&255,ot=this.S[D],this.S[D]=this.S[G],this.S[G]=ot;this.i=0,this.j=0}function fs(){var B;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,B=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=B,this.S[B+this.S[this.i]&255]}us.prototype.init=ds,us.prototype.next=fs;function Br(){return new us}var wr=256;i.exports={default:s,BigInteger:s,SecureRandom:cr}}).call(hi)})(Bf);var Dh={},zy=Dh.falseIfInvalid=function(i){return function(){return this.valid?i.apply(this,arguments):!1}};Dh.isInSubnet=zy(function(i){return this.subnetMask<i.subnetMask?!1:this.mask(i.subnetMask)===i.mask()});Dh.isCorrect=function(i){return zy(function(){return this.addressMinusSuffix!==this.correctForm()?!1:this.subnetMask===i&&!this.parsedSubnet?!0:this.parsedSubnet===String(this.subnetMask)})};var ko={};(function(i){(function(){var t={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function e(o){return n(a(o),arguments)}function r(o,u){return e.apply(null,[o].concat(u||[]))}function n(o,u){var d=1,m=o.length,l,f="",p,y,v,_,w,T,E,R;for(p=0;p<m;p++)if(typeof o[p]=="string")f+=o[p];else if(typeof o[p]=="object"){if(v=o[p],v.keys)for(l=u[d],y=0;y<v.keys.length;y++){if(l==null)throw new Error(e('[sprintf] Cannot access property "%s" of undefined value "%s"',v.keys[y],v.keys[y-1]));l=l[v.keys[y]]}else v.param_no?l=u[v.param_no]:l=u[d++];if(t.not_type.test(v.type)&&t.not_primitive.test(v.type)&&l instanceof Function&&(l=l()),t.numeric_arg.test(v.type)&&typeof l!="number"&&isNaN(l))throw new TypeError(e("[sprintf] expecting number but found %T",l));switch(t.number.test(v.type)&&(E=l>=0),v.type){case"b":l=parseInt(l,10).toString(2);break;case"c":l=String.fromCharCode(parseInt(l,10));break;case"d":case"i":l=parseInt(l,10);break;case"j":l=JSON.stringify(l,null,v.width?parseInt(v.width):0);break;case"e":l=v.precision?parseFloat(l).toExponential(v.precision):parseFloat(l).toExponential();break;case"f":l=v.precision?parseFloat(l).toFixed(v.precision):parseFloat(l);break;case"g":l=v.precision?String(Number(l.toPrecision(v.precision))):parseFloat(l);break;case"o":l=(parseInt(l,10)>>>0).toString(8);break;case"s":l=String(l),l=v.precision?l.substring(0,v.precision):l;break;case"t":l=String(!!l),l=v.precision?l.substring(0,v.precision):l;break;case"T":l=Object.prototype.toString.call(l).slice(8,-1).toLowerCase(),l=v.precision?l.substring(0,v.precision):l;break;case"u":l=parseInt(l,10)>>>0;break;case"v":l=l.valueOf(),l=v.precision?l.substring(0,v.precision):l;break;case"x":l=(parseInt(l,10)>>>0).toString(16);break;case"X":l=(parseInt(l,10)>>>0).toString(16).toUpperCase();break}t.json.test(v.type)?f+=l:(t.number.test(v.type)&&(!E||v.sign)?(R=E?"+":"-",l=l.toString().replace(t.sign,"")):R="",w=v.pad_char?v.pad_char==="0"?"0":v.pad_char.charAt(1):" ",T=v.width-(R+l).length,_=v.width&&T>0?w.repeat(T):"",f+=v.align?R+l+_:w==="0"?R+_+l:_+R+l)}return f}var s=Object.create(null);function a(o){if(s[o])return s[o];for(var u=o,d,m=[],l=0;u;){if((d=t.text.exec(u))!==null)m.push(d[0]);else if((d=t.modulo.exec(u))!==null)m.push("%");else if((d=t.placeholder.exec(u))!==null){if(d[2]){l|=1;var f=[],p=d[2],y=[];if((y=t.key.exec(p))!==null)for(f.push(y[1]);(p=p.substring(y[0].length))!=="";)if((y=t.key_access.exec(p))!==null)f.push(y[1]);else if((y=t.index_access.exec(p))!==null)f.push(y[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");d[2]=f}else l|=2;if(l===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");m.push({placeholder:d[0],param_no:d[1],keys:d[2],sign:d[3],pad_char:d[4],align:d[5],width:d[6],precision:d[7],type:d[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");u=u.substring(d[0].length)}return s[o]=m}i.sprintf=e,i.vsprintf=r,typeof window<"u"&&(window.sprintf=e,window.vsprintf=r)})()})(ko);var xc={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(i,t){(function(){var e,r="4.17.21",n=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",o="Invalid `variable` option passed into `_.template`",u="__lodash_hash_undefined__",d=500,m="__lodash_placeholder__",l=1,f=2,p=4,y=1,v=2,_=1,w=2,T=4,E=8,R=16,H=32,Y=64,j=128,et=256,J=512,rt=30,gt="...",X=800,Q=16,S=1,ut=2,Pt=3,pt=1/0,Wt=9007199254740991,bt=17976931348623157e292,xt=0/0,tt=4294967295,it=tt-1,Gt=tt>>>1,Dt=[["ary",j],["bind",_],["bindKey",w],["curry",E],["curryRight",R],["flip",J],["partial",H],["partialRight",Y],["rearg",et]],Mt="[object Arguments]",te="[object Array]",re="[object AsyncFunction]",jt="[object Boolean]",qt="[object Date]",ce="[object DOMException]",ne="[object Error]",_e="[object Function]",pe="[object GeneratorFunction]",C="[object Map]",At="[object Number]",vt="[object Null]",K="[object Object]",V="[object Promise]",lt="[object Proxy]",Et="[object RegExp]",Tt="[object Set]",at="[object String]",Ut="[object Symbol]",$t="[object Undefined]",Lt="[object WeakMap]",ee="[object WeakSet]",L="[object ArrayBuffer]",b="[object DataView]",A="[object Float32Array]",z="[object Float64Array]",nt="[object Int8Array]",I="[object Int16Array]",N="[object Int32Array]",mt="[object Uint8Array]",yt="[object Uint8ClampedArray]",Ct="[object Uint16Array]",zt="[object Uint32Array]",Vt=/\b__p \+= '';/g,xe=/\b(__p \+=) '' \+/g,Be=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ne=/&(?:amp|lt|gt|quot|#39);/g,ke=/[&<>"']/g,Ze=RegExp(Ne.source),Ei=RegExp(ke.source),_r=/<%-([\s\S]+?)%>/g,as=/<%([\s\S]+?)%>/g,Fs=/<%=([\s\S]+?)%>/g,Sn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ns=/^\w*$/,Ea=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Cn=/[\\^$.*+?()[\]{}|]/g,Mn=RegExp(Cn.source),In=/^\s+/,Bn=/\s/,Ta=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Us=/\{\n\/\* \[wrapped with (.+)\] \*/,Li=/,? & /,Sa=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Hs=/[()=,{}\[\]\/\s]/,kn=/\\(\\)?/g,Ca=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Vr=/\w*$/,Ma=/^[-+]0x[0-9a-f]+$/i,Ho=/^0b[01]+$/i,Go=/^\[object .+?Constructor\]$/,Gs=/^0o[0-7]+$/i,Wo=/^(?:0|[1-9]\d*)$/,zo=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,hr=/($^)/,Vo=/['\n\r\u2028\u2029\\]/g,os="\\ud800-\\udfff",Ia="\\u0300-\\u036f",on="\\ufe20-\\ufe2f",Ba="\\u20d0-\\u20ff",Oi=Ia+on+Ba,Ir="\\u2700-\\u27bf",ka="a-z\\xdf-\\xf6\\xf8-\\xff",Ra="\\xac\\xb1\\xd7\\xf7",Mi="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ws="\\u2000-\\u206f",Pa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Da="A-Z\\xc0-\\xd6\\xd8-\\xde",hn="\\ufe0e\\ufe0f",Ii=Ra+Mi+Ws+Pa,ti="['\u2019]",La="["+os+"]",hs="["+Ii+"]",Bi="["+Oi+"]",ls="\\d+",Oa="["+Ir+"]",cs="["+ka+"]",lr="[^"+os+Ii+ls+Ir+ka+Da+"]",cr="\\ud83c[\\udffb-\\udfff]",us="(?:"+Bi+"|"+cr+")",ds="[^"+os+"]",fs="(?:\\ud83c[\\udde6-\\uddff]){2}",Br="[\\ud800-\\udbff][\\udc00-\\udfff]",wr="["+Da+"]",B="\\u200d",D="(?:"+cs+"|"+lr+")",G="(?:"+wr+"|"+lr+")",ot="(?:"+ti+"(?:d|ll|m|re|s|t|ve))?",It="(?:"+ti+"(?:D|LL|M|RE|S|T|VE))?",Ft=us+"?",Kt="["+hn+"]?",Qt="(?:"+B+"(?:"+[ds,fs,Br].join("|")+")"+Kt+Ft+")*",Ge="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",mi="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Wi=Kt+Ft+Qt,zi="(?:"+[Oa,fs,Br].join("|")+")"+Wi,br="(?:"+[ds+Bi+"?",Bi,fs,Br,La].join("|")+")",ps=RegExp(ti,"g"),$i=RegExp(Bi,"g"),Vi=RegExp(cr+"(?="+cr+")|"+br+Wi,"g"),Rn=RegExp([wr+"?"+cs+"+"+ot+"(?="+[hs,wr,"$"].join("|")+")",G+"+"+It+"(?="+[hs,wr+D,"$"].join("|")+")",wr+"?"+D+"+"+ot,wr+"+"+It,mi,Ge,ls,zi].join("|"),"g"),ur=RegExp("["+B+os+Oi+hn+"]"),ln=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Fh=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],$c=-1,Xe={};Xe[A]=Xe[z]=Xe[nt]=Xe[I]=Xe[N]=Xe[mt]=Xe[yt]=Xe[Ct]=Xe[zt]=!0,Xe[Mt]=Xe[te]=Xe[L]=Xe[jt]=Xe[b]=Xe[qt]=Xe[ne]=Xe[_e]=Xe[C]=Xe[At]=Xe[K]=Xe[Et]=Xe[Tt]=Xe[at]=Xe[Lt]=!1;var qe={};qe[Mt]=qe[te]=qe[L]=qe[b]=qe[jt]=qe[qt]=qe[A]=qe[z]=qe[nt]=qe[I]=qe[N]=qe[C]=qe[At]=qe[K]=qe[Et]=qe[Tt]=qe[at]=qe[Ut]=qe[mt]=qe[yt]=qe[Ct]=qe[zt]=!0,qe[ne]=qe[_e]=qe[Lt]=!1;var Xo={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Zc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},jo={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Nh={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Yo=parseFloat,M=parseInt,O=typeof hi=="object"&&hi&&hi.Object===Object&&hi,q=typeof self=="object"&&self&&self.Object===Object&&self,$=O||q||Function("return this")(),ft=t&&!t.nodeType&&t,ht=ft&&!0&&i&&!i.nodeType&&i,_t=ht&&ht.exports===ft,Bt=_t&&O.process,se=function(){try{var ct=ht&&ht.require&&ht.require("util").types;return ct||Bt&&Bt.binding&&Bt.binding("util")}catch{}}(),we=se&&se.isArrayBuffer,je=se&&se.isDate,Fi=se&&se.isMap,cn=se&&se.isRegExp,un=se&&se.isSet,dr=se&&se.isTypedArray;function Ni(ct,St,wt){switch(wt.length){case 0:return ct.call(St);case 1:return ct.call(St,wt[0]);case 2:return ct.call(St,wt[0],wt[1]);case 3:return ct.call(St,wt[0],wt[1],wt[2])}return ct.apply(St,wt)}function Uh(ct,St,wt,ie){for(var Ae=-1,We=ct==null?0:ct.length;++Ae<We;){var ki=ct[Ae];St(ie,ki,wt(ki),ct)}return ie}function kr(ct,St){for(var wt=-1,ie=ct==null?0:ct.length;++wt<ie&&St(ct[wt],wt,ct)!==!1;);return ct}function Ev(ct,St){for(var wt=ct==null?0:ct.length;wt--&&St(ct[wt],wt,ct)!==!1;);return ct}function Xf(ct,St){for(var wt=-1,ie=ct==null?0:ct.length;++wt<ie;)if(!St(ct[wt],wt,ct))return!1;return!0}function ms(ct,St){for(var wt=-1,ie=ct==null?0:ct.length,Ae=0,We=[];++wt<ie;){var ki=ct[wt];St(ki,wt,ct)&&(We[Ae++]=ki)}return We}function Hh(ct,St){var wt=ct==null?0:ct.length;return!!wt&&Fa(ct,St,0)>-1}function Qc(ct,St,wt){for(var ie=-1,Ae=ct==null?0:ct.length;++ie<Ae;)if(wt(St,ct[ie]))return!0;return!1}function si(ct,St){for(var wt=-1,ie=ct==null?0:ct.length,Ae=Array(ie);++wt<ie;)Ae[wt]=St(ct[wt],wt,ct);return Ae}function gs(ct,St){for(var wt=-1,ie=St.length,Ae=ct.length;++wt<ie;)ct[Ae+wt]=St[wt];return ct}function Jc(ct,St,wt,ie){var Ae=-1,We=ct==null?0:ct.length;for(ie&&We&&(wt=ct[++Ae]);++Ae<We;)wt=St(wt,ct[Ae],Ae,ct);return wt}function Tv(ct,St,wt,ie){var Ae=ct==null?0:ct.length;for(ie&&Ae&&(wt=ct[--Ae]);Ae--;)wt=St(wt,ct[Ae],Ae,ct);return wt}function tu(ct,St){for(var wt=-1,ie=ct==null?0:ct.length;++wt<ie;)if(St(ct[wt],wt,ct))return!0;return!1}var Sv=eu("length");function Cv(ct){return ct.split("")}function Mv(ct){return ct.match(Sa)||[]}function jf(ct,St,wt){var ie;return wt(ct,function(Ae,We,ki){if(St(Ae,We,ki))return ie=We,!1}),ie}function Gh(ct,St,wt,ie){for(var Ae=ct.length,We=wt+(ie?1:-1);ie?We--:++We<Ae;)if(St(ct[We],We,ct))return We;return-1}function Fa(ct,St,wt){return St===St?Hv(ct,St,wt):Gh(ct,Yf,wt)}function Iv(ct,St,wt,ie){for(var Ae=wt-1,We=ct.length;++Ae<We;)if(ie(ct[Ae],St))return Ae;return-1}function Yf(ct){return ct!==ct}function Kf(ct,St){var wt=ct==null?0:ct.length;return wt?ru(ct,St)/wt:xt}function eu(ct){return function(St){return St==null?e:St[ct]}}function iu(ct){return function(St){return ct==null?e:ct[St]}}function qf(ct,St,wt,ie,Ae){return Ae(ct,function(We,ki,Qe){wt=ie?(ie=!1,We):St(wt,We,ki,Qe)}),wt}function Bv(ct,St){var wt=ct.length;for(ct.sort(St);wt--;)ct[wt]=ct[wt].value;return ct}function ru(ct,St){for(var wt,ie=-1,Ae=ct.length;++ie<Ae;){var We=St(ct[ie]);We!==e&&(wt=wt===e?We:wt+We)}return wt}function nu(ct,St){for(var wt=-1,ie=Array(ct);++wt<ct;)ie[wt]=St(wt);return ie}function kv(ct,St){return si(St,function(wt){return[wt,ct[wt]]})}function $f(ct){return ct&&ct.slice(0,tp(ct)+1).replace(In,"")}function xr(ct){return function(St){return ct(St)}}function su(ct,St){return si(St,function(wt){return ct[wt]})}function Ko(ct,St){return ct.has(St)}function Zf(ct,St){for(var wt=-1,ie=ct.length;++wt<ie&&Fa(St,ct[wt],0)>-1;);return wt}function Qf(ct,St){for(var wt=ct.length;wt--&&Fa(St,ct[wt],0)>-1;);return wt}function Rv(ct,St){for(var wt=ct.length,ie=0;wt--;)ct[wt]===St&&++ie;return ie}var Pv=iu(Xo),Dv=iu(Zc);function Lv(ct){return"\\"+Nh[ct]}function Ov(ct,St){return ct==null?e:ct[St]}function Na(ct){return ur.test(ct)}function Fv(ct){return ln.test(ct)}function Nv(ct){for(var St,wt=[];!(St=ct.next()).done;)wt.push(St.value);return wt}function au(ct){var St=-1,wt=Array(ct.size);return ct.forEach(function(ie,Ae){wt[++St]=[Ae,ie]}),wt}function Jf(ct,St){return function(wt){return ct(St(wt))}}function ys(ct,St){for(var wt=-1,ie=ct.length,Ae=0,We=[];++wt<ie;){var ki=ct[wt];(ki===St||ki===m)&&(ct[wt]=m,We[Ae++]=wt)}return We}function Wh(ct){var St=-1,wt=Array(ct.size);return ct.forEach(function(ie){wt[++St]=ie}),wt}function Uv(ct){var St=-1,wt=Array(ct.size);return ct.forEach(function(ie){wt[++St]=[ie,ie]}),wt}function Hv(ct,St,wt){for(var ie=wt-1,Ae=ct.length;++ie<Ae;)if(ct[ie]===St)return ie;return-1}function Gv(ct,St,wt){for(var ie=wt+1;ie--;)if(ct[ie]===St)return ie;return ie}function Ua(ct){return Na(ct)?zv(ct):Sv(ct)}function Xr(ct){return Na(ct)?Vv(ct):Cv(ct)}function tp(ct){for(var St=ct.length;St--&&Bn.test(ct.charAt(St)););return St}var Wv=iu(jo);function zv(ct){for(var St=Vi.lastIndex=0;Vi.test(ct);)++St;return St}function Vv(ct){return ct.match(Vi)||[]}function Xv(ct){return ct.match(Rn)||[]}var jv=function ct(St){St=St==null?$:Ha.defaults($.Object(),St,Ha.pick($,Fh));var wt=St.Array,ie=St.Date,Ae=St.Error,We=St.Function,ki=St.Math,Qe=St.Object,ou=St.RegExp,Yv=St.String,Rr=St.TypeError,zh=wt.prototype,Kv=We.prototype,Ga=Qe.prototype,Vh=St["__core-js_shared__"],Xh=Kv.toString,Ye=Ga.hasOwnProperty,qv=0,ep=function(){var h=/[^.]+$/.exec(Vh&&Vh.keys&&Vh.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),jh=Ga.toString,$v=Xh.call(Qe),Zv=$._,Qv=ou("^"+Xh.call(Ye).replace(Cn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Yh=_t?St.Buffer:e,vs=St.Symbol,Kh=St.Uint8Array,ip=Yh?Yh.allocUnsafe:e,qh=Jf(Qe.getPrototypeOf,Qe),rp=Qe.create,np=Ga.propertyIsEnumerable,$h=zh.splice,sp=vs?vs.isConcatSpreadable:e,qo=vs?vs.iterator:e,zs=vs?vs.toStringTag:e,Zh=function(){try{var h=Ks(Qe,"defineProperty");return h({},"",{}),h}catch{}}(),Jv=St.clearTimeout!==$.clearTimeout&&St.clearTimeout,t_=ie&&ie.now!==$.Date.now&&ie.now,e_=St.setTimeout!==$.setTimeout&&St.setTimeout,Qh=ki.ceil,Jh=ki.floor,hu=Qe.getOwnPropertySymbols,i_=Yh?Yh.isBuffer:e,ap=St.isFinite,r_=zh.join,n_=Jf(Qe.keys,Qe),Ri=ki.max,Zi=ki.min,s_=ie.now,a_=St.parseInt,op=ki.random,o_=zh.reverse,lu=Ks(St,"DataView"),$o=Ks(St,"Map"),cu=Ks(St,"Promise"),Wa=Ks(St,"Set"),Zo=Ks(St,"WeakMap"),Qo=Ks(Qe,"create"),tl=Zo&&new Zo,za={},h_=qs(lu),l_=qs($o),c_=qs(cu),u_=qs(Wa),d_=qs(Zo),el=vs?vs.prototype:e,Jo=el?el.valueOf:e,hp=el?el.toString:e;function F(h){if(gi(h)&&!Ee(h)&&!(h instanceof Le)){if(h instanceof Pr)return h;if(Ye.call(h,"__wrapped__"))return lm(h)}return new Pr(h)}var Va=function(){function h(){}return function(c){if(!li(c))return{};if(rp)return rp(c);h.prototype=c;var g=new h;return h.prototype=e,g}}();function il(){}function Pr(h,c){this.__wrapped__=h,this.__actions__=[],this.__chain__=!!c,this.__index__=0,this.__values__=e}F.templateSettings={escape:_r,evaluate:as,interpolate:Fs,variable:"",imports:{_:F}},F.prototype=il.prototype,F.prototype.constructor=F,Pr.prototype=Va(il.prototype),Pr.prototype.constructor=Pr;function Le(h){this.__wrapped__=h,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=tt,this.__views__=[]}function f_(){var h=new Le(this.__wrapped__);return h.__actions__=fr(this.__actions__),h.__dir__=this.__dir__,h.__filtered__=this.__filtered__,h.__iteratees__=fr(this.__iteratees__),h.__takeCount__=this.__takeCount__,h.__views__=fr(this.__views__),h}function p_(){if(this.__filtered__){var h=new Le(this);h.__dir__=-1,h.__filtered__=!0}else h=this.clone(),h.__dir__*=-1;return h}function m_(){var h=this.__wrapped__.value(),c=this.__dir__,g=Ee(h),x=c<0,k=g?h.length:0,U=Mw(0,k,this.__views__),Z=U.start,st=U.end,dt=st-Z,kt=x?st:Z-1,Rt=this.__iteratees__,Nt=Rt.length,Zt=0,oe=Zi(dt,this.__takeCount__);if(!g||!x&&k==dt&&oe==dt)return Rp(h,this.__actions__);var ge=[];t:for(;dt--&&Zt<oe;){kt+=c;for(var Ce=-1,ye=h[kt];++Ce<Nt;){var Re=Rt[Ce],Oe=Re.iteratee,Tr=Re.type,nr=Oe(ye);if(Tr==ut)ye=nr;else if(!nr){if(Tr==S)continue t;break t}}ge[Zt++]=ye}return ge}Le.prototype=Va(il.prototype),Le.prototype.constructor=Le;function Vs(h){var c=-1,g=h==null?0:h.length;for(this.clear();++c<g;){var x=h[c];this.set(x[0],x[1])}}function g_(){this.__data__=Qo?Qo(null):{},this.size=0}function y_(h){var c=this.has(h)&&delete this.__data__[h];return this.size-=c?1:0,c}function v_(h){var c=this.__data__;if(Qo){var g=c[h];return g===u?e:g}return Ye.call(c,h)?c[h]:e}function __(h){var c=this.__data__;return Qo?c[h]!==e:Ye.call(c,h)}function w_(h,c){var g=this.__data__;return this.size+=this.has(h)?0:1,g[h]=Qo&&c===e?u:c,this}Vs.prototype.clear=g_,Vs.prototype.delete=y_,Vs.prototype.get=v_,Vs.prototype.has=__,Vs.prototype.set=w_;function Pn(h){var c=-1,g=h==null?0:h.length;for(this.clear();++c<g;){var x=h[c];this.set(x[0],x[1])}}function b_(){this.__data__=[],this.size=0}function x_(h){var c=this.__data__,g=rl(c,h);if(g<0)return!1;var x=c.length-1;return g==x?c.pop():$h.call(c,g,1),--this.size,!0}function A_(h){var c=this.__data__,g=rl(c,h);return g<0?e:c[g][1]}function E_(h){return rl(this.__data__,h)>-1}function T_(h,c){var g=this.__data__,x=rl(g,h);return x<0?(++this.size,g.push([h,c])):g[x][1]=c,this}Pn.prototype.clear=b_,Pn.prototype.delete=x_,Pn.prototype.get=A_,Pn.prototype.has=E_,Pn.prototype.set=T_;function Dn(h){var c=-1,g=h==null?0:h.length;for(this.clear();++c<g;){var x=h[c];this.set(x[0],x[1])}}function S_(){this.size=0,this.__data__={hash:new Vs,map:new($o||Pn),string:new Vs}}function C_(h){var c=ml(this,h).delete(h);return this.size-=c?1:0,c}function M_(h){return ml(this,h).get(h)}function I_(h){return ml(this,h).has(h)}function B_(h,c){var g=ml(this,h),x=g.size;return g.set(h,c),this.size+=g.size==x?0:1,this}Dn.prototype.clear=S_,Dn.prototype.delete=C_,Dn.prototype.get=M_,Dn.prototype.has=I_,Dn.prototype.set=B_;function Xs(h){var c=-1,g=h==null?0:h.length;for(this.__data__=new Dn;++c<g;)this.add(h[c])}function k_(h){return this.__data__.set(h,u),this}function R_(h){return this.__data__.has(h)}Xs.prototype.add=Xs.prototype.push=k_,Xs.prototype.has=R_;function jr(h){var c=this.__data__=new Pn(h);this.size=c.size}function P_(){this.__data__=new Pn,this.size=0}function D_(h){var c=this.__data__,g=c.delete(h);return this.size=c.size,g}function L_(h){return this.__data__.get(h)}function O_(h){return this.__data__.has(h)}function F_(h,c){var g=this.__data__;if(g instanceof Pn){var x=g.__data__;if(!$o||x.length<n-1)return x.push([h,c]),this.size=++g.size,this;g=this.__data__=new Dn(x)}return g.set(h,c),this.size=g.size,this}jr.prototype.clear=P_,jr.prototype.delete=D_,jr.prototype.get=L_,jr.prototype.has=O_,jr.prototype.set=F_;function lp(h,c){var g=Ee(h),x=!g&&$s(h),k=!g&&!x&&As(h),U=!g&&!x&&!k&&Ka(h),Z=g||x||k||U,st=Z?nu(h.length,Yv):[],dt=st.length;for(var kt in h)(c||Ye.call(h,kt))&&!(Z&&(kt=="length"||k&&(kt=="offset"||kt=="parent")||U&&(kt=="buffer"||kt=="byteLength"||kt=="byteOffset")||Nn(kt,dt)))&&st.push(kt);return st}function cp(h){var c=h.length;return c?h[bu(0,c-1)]:e}function N_(h,c){return gl(fr(h),js(c,0,h.length))}function U_(h){return gl(fr(h))}function uu(h,c,g){(g!==e&&!Yr(h[c],g)||g===e&&!(c in h))&&Ln(h,c,g)}function th(h,c,g){var x=h[c];(!(Ye.call(h,c)&&Yr(x,g))||g===e&&!(c in h))&&Ln(h,c,g)}function rl(h,c){for(var g=h.length;g--;)if(Yr(h[g][0],c))return g;return-1}function H_(h,c,g,x){return _s(h,function(k,U,Z){c(x,k,g(k),Z)}),x}function up(h,c){return h&&fn(c,Ui(c),h)}function G_(h,c){return h&&fn(c,mr(c),h)}function Ln(h,c,g){c=="__proto__"&&Zh?Zh(h,c,{configurable:!0,enumerable:!0,value:g,writable:!0}):h[c]=g}function du(h,c){for(var g=-1,x=c.length,k=wt(x),U=h==null;++g<x;)k[g]=U?e:ju(h,c[g]);return k}function js(h,c,g){return h===h&&(g!==e&&(h=h<=g?h:g),c!==e&&(h=h>=c?h:c)),h}function Dr(h,c,g,x,k,U){var Z,st=c&l,dt=c&f,kt=c&p;if(g&&(Z=k?g(h,x,k,U):g(h)),Z!==e)return Z;if(!li(h))return h;var Rt=Ee(h);if(Rt){if(Z=Bw(h),!st)return fr(h,Z)}else{var Nt=Qi(h),Zt=Nt==_e||Nt==pe;if(As(h))return Lp(h,st);if(Nt==K||Nt==Mt||Zt&&!k){if(Z=dt||Zt?{}:tm(h),!st)return dt?_w(h,G_(Z,h)):vw(h,up(Z,h))}else{if(!qe[Nt])return k?h:{};Z=kw(h,Nt,st)}}U||(U=new jr);var oe=U.get(h);if(oe)return oe;U.set(h,Z),Im(h)?h.forEach(function(ye){Z.add(Dr(ye,c,g,ye,h,U))}):Cm(h)&&h.forEach(function(ye,Re){Z.set(Re,Dr(ye,c,g,Re,h,U))});var ge=kt?dt?Ru:ku:dt?mr:Ui,Ce=Rt?e:ge(h);return kr(Ce||h,function(ye,Re){Ce&&(Re=ye,ye=h[Re]),th(Z,Re,Dr(ye,c,g,Re,h,U))}),Z}function W_(h){var c=Ui(h);return function(g){return dp(g,h,c)}}function dp(h,c,g){var x=g.length;if(h==null)return!x;for(h=Qe(h);x--;){var k=g[x],U=c[k],Z=h[k];if(Z===e&&!(k in h)||!U(Z))return!1}return!0}function fp(h,c,g){if(typeof h!="function")throw new Rr(a);return oh(function(){h.apply(e,g)},c)}function eh(h,c,g,x){var k=-1,U=Hh,Z=!0,st=h.length,dt=[],kt=c.length;if(!st)return dt;g&&(c=si(c,xr(g))),x?(U=Qc,Z=!1):c.length>=n&&(U=Ko,Z=!1,c=new Xs(c));t:for(;++k<st;){var Rt=h[k],Nt=g==null?Rt:g(Rt);if(Rt=x||Rt!==0?Rt:0,Z&&Nt===Nt){for(var Zt=kt;Zt--;)if(c[Zt]===Nt)continue t;dt.push(Rt)}else U(c,Nt,x)||dt.push(Rt)}return dt}var _s=Hp(dn),pp=Hp(pu,!0);function z_(h,c){var g=!0;return _s(h,function(x,k,U){return g=!!c(x,k,U),g}),g}function nl(h,c,g){for(var x=-1,k=h.length;++x<k;){var U=h[x],Z=c(U);if(Z!=null&&(st===e?Z===Z&&!Er(Z):g(Z,st)))var st=Z,dt=U}return dt}function V_(h,c,g,x){var k=h.length;for(g=Se(g),g<0&&(g=-g>k?0:k+g),x=x===e||x>k?k:Se(x),x<0&&(x+=k),x=g>x?0:km(x);g<x;)h[g++]=c;return h}function mp(h,c){var g=[];return _s(h,function(x,k,U){c(x,k,U)&&g.push(x)}),g}function Xi(h,c,g,x,k){var U=-1,Z=h.length;for(g||(g=Pw),k||(k=[]);++U<Z;){var st=h[U];c>0&&g(st)?c>1?Xi(st,c-1,g,x,k):gs(k,st):x||(k[k.length]=st)}return k}var fu=Gp(),gp=Gp(!0);function dn(h,c){return h&&fu(h,c,Ui)}function pu(h,c){return h&&gp(h,c,Ui)}function sl(h,c){return ms(c,function(g){return Un(h[g])})}function Ys(h,c){c=bs(c,h);for(var g=0,x=c.length;h!=null&&g<x;)h=h[pn(c[g++])];return g&&g==x?h:e}function yp(h,c,g){var x=c(h);return Ee(h)?x:gs(x,g(h))}function ir(h){return h==null?h===e?$t:vt:zs&&zs in Qe(h)?Cw(h):Hw(h)}function mu(h,c){return h>c}function X_(h,c){return h!=null&&Ye.call(h,c)}function j_(h,c){return h!=null&&c in Qe(h)}function Y_(h,c,g){return h>=Zi(c,g)&&h<Ri(c,g)}function gu(h,c,g){for(var x=g?Qc:Hh,k=h[0].length,U=h.length,Z=U,st=wt(U),dt=1/0,kt=[];Z--;){var Rt=h[Z];Z&&c&&(Rt=si(Rt,xr(c))),dt=Zi(Rt.length,dt),st[Z]=!g&&(c||k>=120&&Rt.length>=120)?new Xs(Z&&Rt):e}Rt=h[0];var Nt=-1,Zt=st[0];t:for(;++Nt<k&&kt.length<dt;){var oe=Rt[Nt],ge=c?c(oe):oe;if(oe=g||oe!==0?oe:0,!(Zt?Ko(Zt,ge):x(kt,ge,g))){for(Z=U;--Z;){var Ce=st[Z];if(!(Ce?Ko(Ce,ge):x(h[Z],ge,g)))continue t}Zt&&Zt.push(ge),kt.push(oe)}}return kt}function K_(h,c,g,x){return dn(h,function(k,U,Z){c(x,g(k),U,Z)}),x}function ih(h,c,g){c=bs(c,h),h=nm(h,c);var x=h==null?h:h[pn(Or(c))];return x==null?e:Ni(x,h,g)}function vp(h){return gi(h)&&ir(h)==Mt}function q_(h){return gi(h)&&ir(h)==L}function $_(h){return gi(h)&&ir(h)==qt}function rh(h,c,g,x,k){return h===c?!0:h==null||c==null||!gi(h)&&!gi(c)?h!==h&&c!==c:Z_(h,c,g,x,rh,k)}function Z_(h,c,g,x,k,U){var Z=Ee(h),st=Ee(c),dt=Z?te:Qi(h),kt=st?te:Qi(c);dt=dt==Mt?K:dt,kt=kt==Mt?K:kt;var Rt=dt==K,Nt=kt==K,Zt=dt==kt;if(Zt&&As(h)){if(!As(c))return!1;Z=!0,Rt=!1}if(Zt&&!Rt)return U||(U=new jr),Z||Ka(h)?Zp(h,c,g,x,k,U):Tw(h,c,dt,g,x,k,U);if(!(g&y)){var oe=Rt&&Ye.call(h,"__wrapped__"),ge=Nt&&Ye.call(c,"__wrapped__");if(oe||ge){var Ce=oe?h.value():h,ye=ge?c.value():c;return U||(U=new jr),k(Ce,ye,g,x,U)}}return Zt?(U||(U=new jr),Sw(h,c,g,x,k,U)):!1}function Q_(h){return gi(h)&&Qi(h)==C}function yu(h,c,g,x){var k=g.length,U=k,Z=!x;if(h==null)return!U;for(h=Qe(h);k--;){var st=g[k];if(Z&&st[2]?st[1]!==h[st[0]]:!(st[0]in h))return!1}for(;++k<U;){st=g[k];var dt=st[0],kt=h[dt],Rt=st[1];if(Z&&st[2]){if(kt===e&&!(dt in h))return!1}else{var Nt=new jr;if(x)var Zt=x(kt,Rt,dt,h,c,Nt);if(!(Zt===e?rh(Rt,kt,y|v,x,Nt):Zt))return!1}}return!0}function _p(h){if(!li(h)||Lw(h))return!1;var c=Un(h)?Qv:Go;return c.test(qs(h))}function J_(h){return gi(h)&&ir(h)==Et}function tw(h){return gi(h)&&Qi(h)==Tt}function ew(h){return gi(h)&&xl(h.length)&&!!Xe[ir(h)]}function wp(h){return typeof h=="function"?h:h==null?gr:typeof h=="object"?Ee(h)?Ap(h[0],h[1]):xp(h):Wm(h)}function vu(h){if(!ah(h))return n_(h);var c=[];for(var g in Qe(h))Ye.call(h,g)&&g!="constructor"&&c.push(g);return c}function iw(h){if(!li(h))return Uw(h);var c=ah(h),g=[];for(var x in h)x=="constructor"&&(c||!Ye.call(h,x))||g.push(x);return g}function _u(h,c){return h<c}function bp(h,c){var g=-1,x=pr(h)?wt(h.length):[];return _s(h,function(k,U,Z){x[++g]=c(k,U,Z)}),x}function xp(h){var c=Du(h);return c.length==1&&c[0][2]?im(c[0][0],c[0][1]):function(g){return g===h||yu(g,h,c)}}function Ap(h,c){return Ou(h)&&em(c)?im(pn(h),c):function(g){var x=ju(g,h);return x===e&&x===c?Yu(g,h):rh(c,x,y|v)}}function al(h,c,g,x,k){h!==c&&fu(c,function(U,Z){if(k||(k=new jr),li(U))rw(h,c,Z,g,al,x,k);else{var st=x?x(Nu(h,Z),U,Z+"",h,c,k):e;st===e&&(st=U),uu(h,Z,st)}},mr)}function rw(h,c,g,x,k,U,Z){var st=Nu(h,g),dt=Nu(c,g),kt=Z.get(dt);if(kt){uu(h,g,kt);return}var Rt=U?U(st,dt,g+"",h,c,Z):e,Nt=Rt===e;if(Nt){var Zt=Ee(dt),oe=!Zt&&As(dt),ge=!Zt&&!oe&&Ka(dt);Rt=dt,Zt||oe||ge?Ee(st)?Rt=st:wi(st)?Rt=fr(st):oe?(Nt=!1,Rt=Lp(dt,!0)):ge?(Nt=!1,Rt=Op(dt,!0)):Rt=[]:hh(dt)||$s(dt)?(Rt=st,$s(st)?Rt=Rm(st):(!li(st)||Un(st))&&(Rt=tm(dt))):Nt=!1}Nt&&(Z.set(dt,Rt),k(Rt,dt,x,U,Z),Z.delete(dt)),uu(h,g,Rt)}function Ep(h,c){var g=h.length;if(!!g)return c+=c<0?g:0,Nn(c,g)?h[c]:e}function Tp(h,c,g){c.length?c=si(c,function(U){return Ee(U)?function(Z){return Ys(Z,U.length===1?U[0]:U)}:U}):c=[gr];var x=-1;c=si(c,xr(me()));var k=bp(h,function(U,Z,st){var dt=si(c,function(kt){return kt(U)});return{criteria:dt,index:++x,value:U}});return Bv(k,function(U,Z){return yw(U,Z,g)})}function sw(h,c){return Sp(h,c,function(g,x){return Yu(h,x)})}function Sp(h,c,g){for(var x=-1,k=c.length,U={};++x<k;){var Z=c[x],st=Ys(h,Z);g(st,Z)&&nh(U,bs(Z,h),st)}return U}function aw(h){return function(c){return Ys(c,h)}}function wu(h,c,g,x){var k=x?Iv:Fa,U=-1,Z=c.length,st=h;for(h===c&&(c=fr(c)),g&&(st=si(h,xr(g)));++U<Z;)for(var dt=0,kt=c[U],Rt=g?g(kt):kt;(dt=k(st,Rt,dt,x))>-1;)st!==h&&$h.call(st,dt,1),$h.call(h,dt,1);return h}function Cp(h,c){for(var g=h?c.length:0,x=g-1;g--;){var k=c[g];if(g==x||k!==U){var U=k;Nn(k)?$h.call(h,k,1):Eu(h,k)}}return h}function bu(h,c){return h+Jh(op()*(c-h+1))}function ow(h,c,g,x){for(var k=-1,U=Ri(Qh((c-h)/(g||1)),0),Z=wt(U);U--;)Z[x?U:++k]=h,h+=g;return Z}function xu(h,c){var g="";if(!h||c<1||c>Wt)return g;do c%2&&(g+=h),c=Jh(c/2),c&&(h+=h);while(c);return g}function Me(h,c){return Uu(rm(h,c,gr),h+"")}function hw(h){return cp(qa(h))}function lw(h,c){var g=qa(h);return gl(g,js(c,0,g.length))}function nh(h,c,g,x){if(!li(h))return h;c=bs(c,h);for(var k=-1,U=c.length,Z=U-1,st=h;st!=null&&++k<U;){var dt=pn(c[k]),kt=g;if(dt==="__proto__"||dt==="constructor"||dt==="prototype")return h;if(k!=Z){var Rt=st[dt];kt=x?x(Rt,dt,st):e,kt===e&&(kt=li(Rt)?Rt:Nn(c[k+1])?[]:{})}th(st,dt,kt),st=st[dt]}return h}var Mp=tl?function(h,c){return tl.set(h,c),h}:gr,cw=Zh?function(h,c){return Zh(h,"toString",{configurable:!0,enumerable:!1,value:qu(c),writable:!0})}:gr;function uw(h){return gl(qa(h))}function Lr(h,c,g){var x=-1,k=h.length;c<0&&(c=-c>k?0:k+c),g=g>k?k:g,g<0&&(g+=k),k=c>g?0:g-c>>>0,c>>>=0;for(var U=wt(k);++x<k;)U[x]=h[x+c];return U}function dw(h,c){var g;return _s(h,function(x,k,U){return g=c(x,k,U),!g}),!!g}function ol(h,c,g){var x=0,k=h==null?x:h.length;if(typeof c=="number"&&c===c&&k<=Gt){for(;x<k;){var U=x+k>>>1,Z=h[U];Z!==null&&!Er(Z)&&(g?Z<=c:Z<c)?x=U+1:k=U}return k}return Au(h,c,gr,g)}function Au(h,c,g,x){var k=0,U=h==null?0:h.length;if(U===0)return 0;c=g(c);for(var Z=c!==c,st=c===null,dt=Er(c),kt=c===e;k<U;){var Rt=Jh((k+U)/2),Nt=g(h[Rt]),Zt=Nt!==e,oe=Nt===null,ge=Nt===Nt,Ce=Er(Nt);if(Z)var ye=x||ge;else kt?ye=ge&&(x||Zt):st?ye=ge&&Zt&&(x||!oe):dt?ye=ge&&Zt&&!oe&&(x||!Ce):oe||Ce?ye=!1:ye=x?Nt<=c:Nt<c;ye?k=Rt+1:U=Rt}return Zi(U,it)}function Ip(h,c){for(var g=-1,x=h.length,k=0,U=[];++g<x;){var Z=h[g],st=c?c(Z):Z;if(!g||!Yr(st,dt)){var dt=st;U[k++]=Z===0?0:Z}}return U}function Bp(h){return typeof h=="number"?h:Er(h)?xt:+h}function Ar(h){if(typeof h=="string")return h;if(Ee(h))return si(h,Ar)+"";if(Er(h))return hp?hp.call(h):"";var c=h+"";return c=="0"&&1/h==-pt?"-0":c}function ws(h,c,g){var x=-1,k=Hh,U=h.length,Z=!0,st=[],dt=st;if(g)Z=!1,k=Qc;else if(U>=n){var kt=c?null:Aw(h);if(kt)return Wh(kt);Z=!1,k=Ko,dt=new Xs}else dt=c?[]:st;t:for(;++x<U;){var Rt=h[x],Nt=c?c(Rt):Rt;if(Rt=g||Rt!==0?Rt:0,Z&&Nt===Nt){for(var Zt=dt.length;Zt--;)if(dt[Zt]===Nt)continue t;c&&dt.push(Nt),st.push(Rt)}else k(dt,Nt,g)||(dt!==st&&dt.push(Nt),st.push(Rt))}return st}function Eu(h,c){return c=bs(c,h),h=nm(h,c),h==null||delete h[pn(Or(c))]}function kp(h,c,g,x){return nh(h,c,g(Ys(h,c)),x)}function hl(h,c,g,x){for(var k=h.length,U=x?k:-1;(x?U--:++U<k)&&c(h[U],U,h););return g?Lr(h,x?0:U,x?U+1:k):Lr(h,x?U+1:0,x?k:U)}function Rp(h,c){var g=h;return g instanceof Le&&(g=g.value()),Jc(c,function(x,k){return k.func.apply(k.thisArg,gs([x],k.args))},g)}function Tu(h,c,g){var x=h.length;if(x<2)return x?ws(h[0]):[];for(var k=-1,U=wt(x);++k<x;)for(var Z=h[k],st=-1;++st<x;)st!=k&&(U[k]=eh(U[k]||Z,h[st],c,g));return ws(Xi(U,1),c,g)}function Pp(h,c,g){for(var x=-1,k=h.length,U=c.length,Z={};++x<k;){var st=x<U?c[x]:e;g(Z,h[x],st)}return Z}function Su(h){return wi(h)?h:[]}function Cu(h){return typeof h=="function"?h:gr}function bs(h,c){return Ee(h)?h:Ou(h,c)?[h]:hm(Ve(h))}var fw=Me;function xs(h,c,g){var x=h.length;return g=g===e?x:g,!c&&g>=x?h:Lr(h,c,g)}var Dp=Jv||function(h){return $.clearTimeout(h)};function Lp(h,c){if(c)return h.slice();var g=h.length,x=ip?ip(g):new h.constructor(g);return h.copy(x),x}function Mu(h){var c=new h.constructor(h.byteLength);return new Kh(c).set(new Kh(h)),c}function pw(h,c){var g=c?Mu(h.buffer):h.buffer;return new h.constructor(g,h.byteOffset,h.byteLength)}function mw(h){var c=new h.constructor(h.source,Vr.exec(h));return c.lastIndex=h.lastIndex,c}function gw(h){return Jo?Qe(Jo.call(h)):{}}function Op(h,c){var g=c?Mu(h.buffer):h.buffer;return new h.constructor(g,h.byteOffset,h.length)}function Fp(h,c){if(h!==c){var g=h!==e,x=h===null,k=h===h,U=Er(h),Z=c!==e,st=c===null,dt=c===c,kt=Er(c);if(!st&&!kt&&!U&&h>c||U&&Z&&dt&&!st&&!kt||x&&Z&&dt||!g&&dt||!k)return 1;if(!x&&!U&&!kt&&h<c||kt&&g&&k&&!x&&!U||st&&g&&k||!Z&&k||!dt)return-1}return 0}function yw(h,c,g){for(var x=-1,k=h.criteria,U=c.criteria,Z=k.length,st=g.length;++x<Z;){var dt=Fp(k[x],U[x]);if(dt){if(x>=st)return dt;var kt=g[x];return dt*(kt=="desc"?-1:1)}}return h.index-c.index}function Np(h,c,g,x){for(var k=-1,U=h.length,Z=g.length,st=-1,dt=c.length,kt=Ri(U-Z,0),Rt=wt(dt+kt),Nt=!x;++st<dt;)Rt[st]=c[st];for(;++k<Z;)(Nt||k<U)&&(Rt[g[k]]=h[k]);for(;kt--;)Rt[st++]=h[k++];return Rt}function Up(h,c,g,x){for(var k=-1,U=h.length,Z=-1,st=g.length,dt=-1,kt=c.length,Rt=Ri(U-st,0),Nt=wt(Rt+kt),Zt=!x;++k<Rt;)Nt[k]=h[k];for(var oe=k;++dt<kt;)Nt[oe+dt]=c[dt];for(;++Z<st;)(Zt||k<U)&&(Nt[oe+g[Z]]=h[k++]);return Nt}function fr(h,c){var g=-1,x=h.length;for(c||(c=wt(x));++g<x;)c[g]=h[g];return c}function fn(h,c,g,x){var k=!g;g||(g={});for(var U=-1,Z=c.length;++U<Z;){var st=c[U],dt=x?x(g[st],h[st],st,g,h):e;dt===e&&(dt=h[st]),k?Ln(g,st,dt):th(g,st,dt)}return g}function vw(h,c){return fn(h,Lu(h),c)}function _w(h,c){return fn(h,Qp(h),c)}function ll(h,c){return function(g,x){var k=Ee(g)?Uh:H_,U=c?c():{};return k(g,h,me(x,2),U)}}function Xa(h){return Me(function(c,g){var x=-1,k=g.length,U=k>1?g[k-1]:e,Z=k>2?g[2]:e;for(U=h.length>3&&typeof U=="function"?(k--,U):e,Z&&rr(g[0],g[1],Z)&&(U=k<3?e:U,k=1),c=Qe(c);++x<k;){var st=g[x];st&&h(c,st,x,U)}return c})}function Hp(h,c){return function(g,x){if(g==null)return g;if(!pr(g))return h(g,x);for(var k=g.length,U=c?k:-1,Z=Qe(g);(c?U--:++U<k)&&x(Z[U],U,Z)!==!1;);return g}}function Gp(h){return function(c,g,x){for(var k=-1,U=Qe(c),Z=x(c),st=Z.length;st--;){var dt=Z[h?st:++k];if(g(U[dt],dt,U)===!1)break}return c}}function ww(h,c,g){var x=c&_,k=sh(h);function U(){var Z=this&&this!==$&&this instanceof U?k:h;return Z.apply(x?g:this,arguments)}return U}function Wp(h){return function(c){c=Ve(c);var g=Na(c)?Xr(c):e,x=g?g[0]:c.charAt(0),k=g?xs(g,1).join(""):c.slice(1);return x[h]()+k}}function ja(h){return function(c){return Jc(Hm(Um(c).replace(ps,"")),h,"")}}function sh(h){return function(){var c=arguments;switch(c.length){case 0:return new h;case 1:return new h(c[0]);case 2:return new h(c[0],c[1]);case 3:return new h(c[0],c[1],c[2]);case 4:return new h(c[0],c[1],c[2],c[3]);case 5:return new h(c[0],c[1],c[2],c[3],c[4]);case 6:return new h(c[0],c[1],c[2],c[3],c[4],c[5]);case 7:return new h(c[0],c[1],c[2],c[3],c[4],c[5],c[6])}var g=Va(h.prototype),x=h.apply(g,c);return li(x)?x:g}}function bw(h,c,g){var x=sh(h);function k(){for(var U=arguments.length,Z=wt(U),st=U,dt=Ya(k);st--;)Z[st]=arguments[st];var kt=U<3&&Z[0]!==dt&&Z[U-1]!==dt?[]:ys(Z,dt);if(U-=kt.length,U<g)return Yp(h,c,cl,k.placeholder,e,Z,kt,e,e,g-U);var Rt=this&&this!==$&&this instanceof k?x:h;return Ni(Rt,this,Z)}return k}function zp(h){return function(c,g,x){var k=Qe(c);if(!pr(c)){var U=me(g,3);c=Ui(c),g=function(st){return U(k[st],st,k)}}var Z=h(c,g,x);return Z>-1?k[U?c[Z]:Z]:e}}function Vp(h){return Fn(function(c){var g=c.length,x=g,k=Pr.prototype.thru;for(h&&c.reverse();x--;){var U=c[x];if(typeof U!="function")throw new Rr(a);if(k&&!Z&&pl(U)=="wrapper")var Z=new Pr([],!0)}for(x=Z?x:g;++x<g;){U=c[x];var st=pl(U),dt=st=="wrapper"?Pu(U):e;dt&&Fu(dt[0])&&dt[1]==(j|E|H|et)&&!dt[4].length&&dt[9]==1?Z=Z[pl(dt[0])].apply(Z,dt[3]):Z=U.length==1&&Fu(U)?Z[st]():Z.thru(U)}return function(){var kt=arguments,Rt=kt[0];if(Z&&kt.length==1&&Ee(Rt))return Z.plant(Rt).value();for(var Nt=0,Zt=g?c[Nt].apply(this,kt):Rt;++Nt<g;)Zt=c[Nt].call(this,Zt);return Zt}})}function cl(h,c,g,x,k,U,Z,st,dt,kt){var Rt=c&j,Nt=c&_,Zt=c&w,oe=c&(E|R),ge=c&J,Ce=Zt?e:sh(h);function ye(){for(var Re=arguments.length,Oe=wt(Re),Tr=Re;Tr--;)Oe[Tr]=arguments[Tr];if(oe)var nr=Ya(ye),Sr=Rv(Oe,nr);if(x&&(Oe=Np(Oe,x,k,oe)),U&&(Oe=Up(Oe,U,Z,oe)),Re-=Sr,oe&&Re<kt){var bi=ys(Oe,nr);return Yp(h,c,cl,ye.placeholder,g,Oe,bi,st,dt,kt-Re)}var Kr=Nt?g:this,Gn=Zt?Kr[h]:h;return Re=Oe.length,st?Oe=Gw(Oe,st):ge&&Re>1&&Oe.reverse(),Rt&&dt<Re&&(Oe.length=dt),this&&this!==$&&this instanceof ye&&(Gn=Ce||sh(Gn)),Gn.apply(Kr,Oe)}return ye}function Xp(h,c){return function(g,x){return K_(g,h,c(x),{})}}function ul(h,c){return function(g,x){var k;if(g===e&&x===e)return c;if(g!==e&&(k=g),x!==e){if(k===e)return x;typeof g=="string"||typeof x=="string"?(g=Ar(g),x=Ar(x)):(g=Bp(g),x=Bp(x)),k=h(g,x)}return k}}function Iu(h){return Fn(function(c){return c=si(c,xr(me())),Me(function(g){var x=this;return h(c,function(k){return Ni(k,x,g)})})})}function dl(h,c){c=c===e?" ":Ar(c);var g=c.length;if(g<2)return g?xu(c,h):c;var x=xu(c,Qh(h/Ua(c)));return Na(c)?xs(Xr(x),0,h).join(""):x.slice(0,h)}function xw(h,c,g,x){var k=c&_,U=sh(h);function Z(){for(var st=-1,dt=arguments.length,kt=-1,Rt=x.length,Nt=wt(Rt+dt),Zt=this&&this!==$&&this instanceof Z?U:h;++kt<Rt;)Nt[kt]=x[kt];for(;dt--;)Nt[kt++]=arguments[++st];return Ni(Zt,k?g:this,Nt)}return Z}function jp(h){return function(c,g,x){return x&&typeof x!="number"&&rr(c,g,x)&&(g=x=e),c=Hn(c),g===e?(g=c,c=0):g=Hn(g),x=x===e?c<g?1:-1:Hn(x),ow(c,g,x,h)}}function fl(h){return function(c,g){return typeof c=="string"&&typeof g=="string"||(c=Fr(c),g=Fr(g)),h(c,g)}}function Yp(h,c,g,x,k,U,Z,st,dt,kt){var Rt=c&E,Nt=Rt?Z:e,Zt=Rt?e:Z,oe=Rt?U:e,ge=Rt?e:U;c|=Rt?H:Y,c&=~(Rt?Y:H),c&T||(c&=~(_|w));var Ce=[h,c,k,oe,Nt,ge,Zt,st,dt,kt],ye=g.apply(e,Ce);return Fu(h)&&sm(ye,Ce),ye.placeholder=x,am(ye,h,c)}function Bu(h){var c=ki[h];return function(g,x){if(g=Fr(g),x=x==null?0:Zi(Se(x),292),x&&ap(g)){var k=(Ve(g)+"e").split("e"),U=c(k[0]+"e"+(+k[1]+x));return k=(Ve(U)+"e").split("e"),+(k[0]+"e"+(+k[1]-x))}return c(g)}}var Aw=Wa&&1/Wh(new Wa([,-0]))[1]==pt?function(h){return new Wa(h)}:Qu;function Kp(h){return function(c){var g=Qi(c);return g==C?au(c):g==Tt?Uv(c):kv(c,h(c))}}function On(h,c,g,x,k,U,Z,st){var dt=c&w;if(!dt&&typeof h!="function")throw new Rr(a);var kt=x?x.length:0;if(kt||(c&=~(H|Y),x=k=e),Z=Z===e?Z:Ri(Se(Z),0),st=st===e?st:Se(st),kt-=k?k.length:0,c&Y){var Rt=x,Nt=k;x=k=e}var Zt=dt?e:Pu(h),oe=[h,c,g,x,k,Rt,Nt,U,Z,st];if(Zt&&Nw(oe,Zt),h=oe[0],c=oe[1],g=oe[2],x=oe[3],k=oe[4],st=oe[9]=oe[9]===e?dt?0:h.length:Ri(oe[9]-kt,0),!st&&c&(E|R)&&(c&=~(E|R)),!c||c==_)var ge=ww(h,c,g);else c==E||c==R?ge=bw(h,c,st):(c==H||c==(_|H))&&!k.length?ge=xw(h,c,g,x):ge=cl.apply(e,oe);var Ce=Zt?Mp:sm;return am(Ce(ge,oe),h,c)}function qp(h,c,g,x){return h===e||Yr(h,Ga[g])&&!Ye.call(x,g)?c:h}function $p(h,c,g,x,k,U){return li(h)&&li(c)&&(U.set(c,h),al(h,c,e,$p,U),U.delete(c)),h}function Ew(h){return hh(h)?e:h}function Zp(h,c,g,x,k,U){var Z=g&y,st=h.length,dt=c.length;if(st!=dt&&!(Z&&dt>st))return!1;var kt=U.get(h),Rt=U.get(c);if(kt&&Rt)return kt==c&&Rt==h;var Nt=-1,Zt=!0,oe=g&v?new Xs:e;for(U.set(h,c),U.set(c,h);++Nt<st;){var ge=h[Nt],Ce=c[Nt];if(x)var ye=Z?x(Ce,ge,Nt,c,h,U):x(ge,Ce,Nt,h,c,U);if(ye!==e){if(ye)continue;Zt=!1;break}if(oe){if(!tu(c,function(Re,Oe){if(!Ko(oe,Oe)&&(ge===Re||k(ge,Re,g,x,U)))return oe.push(Oe)})){Zt=!1;break}}else if(!(ge===Ce||k(ge,Ce,g,x,U))){Zt=!1;break}}return U.delete(h),U.delete(c),Zt}function Tw(h,c,g,x,k,U,Z){switch(g){case b:if(h.byteLength!=c.byteLength||h.byteOffset!=c.byteOffset)return!1;h=h.buffer,c=c.buffer;case L:return!(h.byteLength!=c.byteLength||!U(new Kh(h),new Kh(c)));case jt:case qt:case At:return Yr(+h,+c);case ne:return h.name==c.name&&h.message==c.message;case Et:case at:return h==c+"";case C:var st=au;case Tt:var dt=x&y;if(st||(st=Wh),h.size!=c.size&&!dt)return!1;var kt=Z.get(h);if(kt)return kt==c;x|=v,Z.set(h,c);var Rt=Zp(st(h),st(c),x,k,U,Z);return Z.delete(h),Rt;case Ut:if(Jo)return Jo.call(h)==Jo.call(c)}return!1}function Sw(h,c,g,x,k,U){var Z=g&y,st=ku(h),dt=st.length,kt=ku(c),Rt=kt.length;if(dt!=Rt&&!Z)return!1;for(var Nt=dt;Nt--;){var Zt=st[Nt];if(!(Z?Zt in c:Ye.call(c,Zt)))return!1}var oe=U.get(h),ge=U.get(c);if(oe&&ge)return oe==c&&ge==h;var Ce=!0;U.set(h,c),U.set(c,h);for(var ye=Z;++Nt<dt;){Zt=st[Nt];var Re=h[Zt],Oe=c[Zt];if(x)var Tr=Z?x(Oe,Re,Zt,c,h,U):x(Re,Oe,Zt,h,c,U);if(!(Tr===e?Re===Oe||k(Re,Oe,g,x,U):Tr)){Ce=!1;break}ye||(ye=Zt=="constructor")}if(Ce&&!ye){var nr=h.constructor,Sr=c.constructor;nr!=Sr&&"constructor"in h&&"constructor"in c&&!(typeof nr=="function"&&nr instanceof nr&&typeof Sr=="function"&&Sr instanceof Sr)&&(Ce=!1)}return U.delete(h),U.delete(c),Ce}function Fn(h){return Uu(rm(h,e,dm),h+"")}function ku(h){return yp(h,Ui,Lu)}function Ru(h){return yp(h,mr,Qp)}var Pu=tl?function(h){return tl.get(h)}:Qu;function pl(h){for(var c=h.name+"",g=za[c],x=Ye.call(za,c)?g.length:0;x--;){var k=g[x],U=k.func;if(U==null||U==h)return k.name}return c}function Ya(h){var c=Ye.call(F,"placeholder")?F:h;return c.placeholder}function me(){var h=F.iteratee||$u;return h=h===$u?wp:h,arguments.length?h(arguments[0],arguments[1]):h}function ml(h,c){var g=h.__data__;return Dw(c)?g[typeof c=="string"?"string":"hash"]:g.map}function Du(h){for(var c=Ui(h),g=c.length;g--;){var x=c[g],k=h[x];c[g]=[x,k,em(k)]}return c}function Ks(h,c){var g=Ov(h,c);return _p(g)?g:e}function Cw(h){var c=Ye.call(h,zs),g=h[zs];try{h[zs]=e;var x=!0}catch{}var k=jh.call(h);return x&&(c?h[zs]=g:delete h[zs]),k}var Lu=hu?function(h){return h==null?[]:(h=Qe(h),ms(hu(h),function(c){return np.call(h,c)}))}:Ju,Qp=hu?function(h){for(var c=[];h;)gs(c,Lu(h)),h=qh(h);return c}:Ju,Qi=ir;(lu&&Qi(new lu(new ArrayBuffer(1)))!=b||$o&&Qi(new $o)!=C||cu&&Qi(cu.resolve())!=V||Wa&&Qi(new Wa)!=Tt||Zo&&Qi(new Zo)!=Lt)&&(Qi=function(h){var c=ir(h),g=c==K?h.constructor:e,x=g?qs(g):"";if(x)switch(x){case h_:return b;case l_:return C;case c_:return V;case u_:return Tt;case d_:return Lt}return c});function Mw(h,c,g){for(var x=-1,k=g.length;++x<k;){var U=g[x],Z=U.size;switch(U.type){case"drop":h+=Z;break;case"dropRight":c-=Z;break;case"take":c=Zi(c,h+Z);break;case"takeRight":h=Ri(h,c-Z);break}}return{start:h,end:c}}function Iw(h){var c=h.match(Us);return c?c[1].split(Li):[]}function Jp(h,c,g){c=bs(c,h);for(var x=-1,k=c.length,U=!1;++x<k;){var Z=pn(c[x]);if(!(U=h!=null&&g(h,Z)))break;h=h[Z]}return U||++x!=k?U:(k=h==null?0:h.length,!!k&&xl(k)&&Nn(Z,k)&&(Ee(h)||$s(h)))}function Bw(h){var c=h.length,g=new h.constructor(c);return c&&typeof h[0]=="string"&&Ye.call(h,"index")&&(g.index=h.index,g.input=h.input),g}function tm(h){return typeof h.constructor=="function"&&!ah(h)?Va(qh(h)):{}}function kw(h,c,g){var x=h.constructor;switch(c){case L:return Mu(h);case jt:case qt:return new x(+h);case b:return pw(h,g);case A:case z:case nt:case I:case N:case mt:case yt:case Ct:case zt:return Op(h,g);case C:return new x;case At:case at:return new x(h);case Et:return mw(h);case Tt:return new x;case Ut:return gw(h)}}function Rw(h,c){var g=c.length;if(!g)return h;var x=g-1;return c[x]=(g>1?"& ":"")+c[x],c=c.join(g>2?", ":" "),h.replace(Ta,`{
/* [wrapped with `+c+`] */
`)}function Pw(h){return Ee(h)||$s(h)||!!(sp&&h&&h[sp])}function Nn(h,c){var g=typeof h;return c=c??Wt,!!c&&(g=="number"||g!="symbol"&&Wo.test(h))&&h>-1&&h%1==0&&h<c}function rr(h,c,g){if(!li(g))return!1;var x=typeof c;return(x=="number"?pr(g)&&Nn(c,g.length):x=="string"&&c in g)?Yr(g[c],h):!1}function Ou(h,c){if(Ee(h))return!1;var g=typeof h;return g=="number"||g=="symbol"||g=="boolean"||h==null||Er(h)?!0:Ns.test(h)||!Sn.test(h)||c!=null&&h in Qe(c)}function Dw(h){var c=typeof h;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?h!=="__proto__":h===null}function Fu(h){var c=pl(h),g=F[c];if(typeof g!="function"||!(c in Le.prototype))return!1;if(h===g)return!0;var x=Pu(g);return!!x&&h===x[0]}function Lw(h){return!!ep&&ep in h}var Ow=Vh?Un:td;function ah(h){var c=h&&h.constructor,g=typeof c=="function"&&c.prototype||Ga;return h===g}function em(h){return h===h&&!li(h)}function im(h,c){return function(g){return g==null?!1:g[h]===c&&(c!==e||h in Qe(g))}}function Fw(h){var c=wl(h,function(x){return g.size===d&&g.clear(),x}),g=c.cache;return c}function Nw(h,c){var g=h[1],x=c[1],k=g|x,U=k<(_|w|j),Z=x==j&&g==E||x==j&&g==et&&h[7].length<=c[8]||x==(j|et)&&c[7].length<=c[8]&&g==E;if(!(U||Z))return h;x&_&&(h[2]=c[2],k|=g&_?0:T);var st=c[3];if(st){var dt=h[3];h[3]=dt?Np(dt,st,c[4]):st,h[4]=dt?ys(h[3],m):c[4]}return st=c[5],st&&(dt=h[5],h[5]=dt?Up(dt,st,c[6]):st,h[6]=dt?ys(h[5],m):c[6]),st=c[7],st&&(h[7]=st),x&j&&(h[8]=h[8]==null?c[8]:Zi(h[8],c[8])),h[9]==null&&(h[9]=c[9]),h[0]=c[0],h[1]=k,h}function Uw(h){var c=[];if(h!=null)for(var g in Qe(h))c.push(g);return c}function Hw(h){return jh.call(h)}function rm(h,c,g){return c=Ri(c===e?h.length-1:c,0),function(){for(var x=arguments,k=-1,U=Ri(x.length-c,0),Z=wt(U);++k<U;)Z[k]=x[c+k];k=-1;for(var st=wt(c+1);++k<c;)st[k]=x[k];return st[c]=g(Z),Ni(h,this,st)}}function nm(h,c){return c.length<2?h:Ys(h,Lr(c,0,-1))}function Gw(h,c){for(var g=h.length,x=Zi(c.length,g),k=fr(h);x--;){var U=c[x];h[x]=Nn(U,g)?k[U]:e}return h}function Nu(h,c){if(!(c==="constructor"&&typeof h[c]=="function")&&c!="__proto__")return h[c]}var sm=om(Mp),oh=e_||function(h,c){return $.setTimeout(h,c)},Uu=om(cw);function am(h,c,g){var x=c+"";return Uu(h,Rw(x,Ww(Iw(x),g)))}function om(h){var c=0,g=0;return function(){var x=s_(),k=Q-(x-g);if(g=x,k>0){if(++c>=X)return arguments[0]}else c=0;return h.apply(e,arguments)}}function gl(h,c){var g=-1,x=h.length,k=x-1;for(c=c===e?x:c;++g<c;){var U=bu(g,k),Z=h[U];h[U]=h[g],h[g]=Z}return h.length=c,h}var hm=Fw(function(h){var c=[];return h.charCodeAt(0)===46&&c.push(""),h.replace(Ea,function(g,x,k,U){c.push(k?U.replace(kn,"$1"):x||g)}),c});function pn(h){if(typeof h=="string"||Er(h))return h;var c=h+"";return c=="0"&&1/h==-pt?"-0":c}function qs(h){if(h!=null){try{return Xh.call(h)}catch{}try{return h+""}catch{}}return""}function Ww(h,c){return kr(Dt,function(g){var x="_."+g[0];c&g[1]&&!Hh(h,x)&&h.push(x)}),h.sort()}function lm(h){if(h instanceof Le)return h.clone();var c=new Pr(h.__wrapped__,h.__chain__);return c.__actions__=fr(h.__actions__),c.__index__=h.__index__,c.__values__=h.__values__,c}function zw(h,c,g){(g?rr(h,c,g):c===e)?c=1:c=Ri(Se(c),0);var x=h==null?0:h.length;if(!x||c<1)return[];for(var k=0,U=0,Z=wt(Qh(x/c));k<x;)Z[U++]=Lr(h,k,k+=c);return Z}function Vw(h){for(var c=-1,g=h==null?0:h.length,x=0,k=[];++c<g;){var U=h[c];U&&(k[x++]=U)}return k}function Xw(){var h=arguments.length;if(!h)return[];for(var c=wt(h-1),g=arguments[0],x=h;x--;)c[x-1]=arguments[x];return gs(Ee(g)?fr(g):[g],Xi(c,1))}var jw=Me(function(h,c){return wi(h)?eh(h,Xi(c,1,wi,!0)):[]}),Yw=Me(function(h,c){var g=Or(c);return wi(g)&&(g=e),wi(h)?eh(h,Xi(c,1,wi,!0),me(g,2)):[]}),Kw=Me(function(h,c){var g=Or(c);return wi(g)&&(g=e),wi(h)?eh(h,Xi(c,1,wi,!0),e,g):[]});function qw(h,c,g){var x=h==null?0:h.length;return x?(c=g||c===e?1:Se(c),Lr(h,c<0?0:c,x)):[]}function $w(h,c,g){var x=h==null?0:h.length;return x?(c=g||c===e?1:Se(c),c=x-c,Lr(h,0,c<0?0:c)):[]}function Zw(h,c){return h&&h.length?hl(h,me(c,3),!0,!0):[]}function Qw(h,c){return h&&h.length?hl(h,me(c,3),!0):[]}function Jw(h,c,g,x){var k=h==null?0:h.length;return k?(g&&typeof g!="number"&&rr(h,c,g)&&(g=0,x=k),V_(h,c,g,x)):[]}function cm(h,c,g){var x=h==null?0:h.length;if(!x)return-1;var k=g==null?0:Se(g);return k<0&&(k=Ri(x+k,0)),Gh(h,me(c,3),k)}function um(h,c,g){var x=h==null?0:h.length;if(!x)return-1;var k=x-1;return g!==e&&(k=Se(g),k=g<0?Ri(x+k,0):Zi(k,x-1)),Gh(h,me(c,3),k,!0)}function dm(h){var c=h==null?0:h.length;return c?Xi(h,1):[]}function t1(h){var c=h==null?0:h.length;return c?Xi(h,pt):[]}function e1(h,c){var g=h==null?0:h.length;return g?(c=c===e?1:Se(c),Xi(h,c)):[]}function i1(h){for(var c=-1,g=h==null?0:h.length,x={};++c<g;){var k=h[c];x[k[0]]=k[1]}return x}function fm(h){return h&&h.length?h[0]:e}function r1(h,c,g){var x=h==null?0:h.length;if(!x)return-1;var k=g==null?0:Se(g);return k<0&&(k=Ri(x+k,0)),Fa(h,c,k)}function n1(h){var c=h==null?0:h.length;return c?Lr(h,0,-1):[]}var s1=Me(function(h){var c=si(h,Su);return c.length&&c[0]===h[0]?gu(c):[]}),a1=Me(function(h){var c=Or(h),g=si(h,Su);return c===Or(g)?c=e:g.pop(),g.length&&g[0]===h[0]?gu(g,me(c,2)):[]}),o1=Me(function(h){var c=Or(h),g=si(h,Su);return c=typeof c=="function"?c:e,c&&g.pop(),g.length&&g[0]===h[0]?gu(g,e,c):[]});function h1(h,c){return h==null?"":r_.call(h,c)}function Or(h){var c=h==null?0:h.length;return c?h[c-1]:e}function l1(h,c,g){var x=h==null?0:h.length;if(!x)return-1;var k=x;return g!==e&&(k=Se(g),k=k<0?Ri(x+k,0):Zi(k,x-1)),c===c?Gv(h,c,k):Gh(h,Yf,k,!0)}function c1(h,c){return h&&h.length?Ep(h,Se(c)):e}var u1=Me(pm);function pm(h,c){return h&&h.length&&c&&c.length?wu(h,c):h}function d1(h,c,g){return h&&h.length&&c&&c.length?wu(h,c,me(g,2)):h}function f1(h,c,g){return h&&h.length&&c&&c.length?wu(h,c,e,g):h}var p1=Fn(function(h,c){var g=h==null?0:h.length,x=du(h,c);return Cp(h,si(c,function(k){return Nn(k,g)?+k:k}).sort(Fp)),x});function m1(h,c){var g=[];if(!(h&&h.length))return g;var x=-1,k=[],U=h.length;for(c=me(c,3);++x<U;){var Z=h[x];c(Z,x,h)&&(g.push(Z),k.push(x))}return Cp(h,k),g}function Hu(h){return h==null?h:o_.call(h)}function g1(h,c,g){var x=h==null?0:h.length;return x?(g&&typeof g!="number"&&rr(h,c,g)?(c=0,g=x):(c=c==null?0:Se(c),g=g===e?x:Se(g)),Lr(h,c,g)):[]}function y1(h,c){return ol(h,c)}function v1(h,c,g){return Au(h,c,me(g,2))}function _1(h,c){var g=h==null?0:h.length;if(g){var x=ol(h,c);if(x<g&&Yr(h[x],c))return x}return-1}function w1(h,c){return ol(h,c,!0)}function b1(h,c,g){return Au(h,c,me(g,2),!0)}function x1(h,c){var g=h==null?0:h.length;if(g){var x=ol(h,c,!0)-1;if(Yr(h[x],c))return x}return-1}function A1(h){return h&&h.length?Ip(h):[]}function E1(h,c){return h&&h.length?Ip(h,me(c,2)):[]}function T1(h){var c=h==null?0:h.length;return c?Lr(h,1,c):[]}function S1(h,c,g){return h&&h.length?(c=g||c===e?1:Se(c),Lr(h,0,c<0?0:c)):[]}function C1(h,c,g){var x=h==null?0:h.length;return x?(c=g||c===e?1:Se(c),c=x-c,Lr(h,c<0?0:c,x)):[]}function M1(h,c){return h&&h.length?hl(h,me(c,3),!1,!0):[]}function I1(h,c){return h&&h.length?hl(h,me(c,3)):[]}var B1=Me(function(h){return ws(Xi(h,1,wi,!0))}),k1=Me(function(h){var c=Or(h);return wi(c)&&(c=e),ws(Xi(h,1,wi,!0),me(c,2))}),R1=Me(function(h){var c=Or(h);return c=typeof c=="function"?c:e,ws(Xi(h,1,wi,!0),e,c)});function P1(h){return h&&h.length?ws(h):[]}function D1(h,c){return h&&h.length?ws(h,me(c,2)):[]}function L1(h,c){return c=typeof c=="function"?c:e,h&&h.length?ws(h,e,c):[]}function Gu(h){if(!(h&&h.length))return[];var c=0;return h=ms(h,function(g){if(wi(g))return c=Ri(g.length,c),!0}),nu(c,function(g){return si(h,eu(g))})}function mm(h,c){if(!(h&&h.length))return[];var g=Gu(h);return c==null?g:si(g,function(x){return Ni(c,e,x)})}var O1=Me(function(h,c){return wi(h)?eh(h,c):[]}),F1=Me(function(h){return Tu(ms(h,wi))}),N1=Me(function(h){var c=Or(h);return wi(c)&&(c=e),Tu(ms(h,wi),me(c,2))}),U1=Me(function(h){var c=Or(h);return c=typeof c=="function"?c:e,Tu(ms(h,wi),e,c)}),H1=Me(Gu);function G1(h,c){return Pp(h||[],c||[],th)}function W1(h,c){return Pp(h||[],c||[],nh)}var z1=Me(function(h){var c=h.length,g=c>1?h[c-1]:e;return g=typeof g=="function"?(h.pop(),g):e,mm(h,g)});function gm(h){var c=F(h);return c.__chain__=!0,c}function V1(h,c){return c(h),h}function yl(h,c){return c(h)}var X1=Fn(function(h){var c=h.length,g=c?h[0]:0,x=this.__wrapped__,k=function(U){return du(U,h)};return c>1||this.__actions__.length||!(x instanceof Le)||!Nn(g)?this.thru(k):(x=x.slice(g,+g+(c?1:0)),x.__actions__.push({func:yl,args:[k],thisArg:e}),new Pr(x,this.__chain__).thru(function(U){return c&&!U.length&&U.push(e),U}))});function j1(){return gm(this)}function Y1(){return new Pr(this.value(),this.__chain__)}function K1(){this.__values__===e&&(this.__values__=Bm(this.value()));var h=this.__index__>=this.__values__.length,c=h?e:this.__values__[this.__index__++];return{done:h,value:c}}function q1(){return this}function $1(h){for(var c,g=this;g instanceof il;){var x=lm(g);x.__index__=0,x.__values__=e,c?k.__wrapped__=x:c=x;var k=x;g=g.__wrapped__}return k.__wrapped__=h,c}function Z1(){var h=this.__wrapped__;if(h instanceof Le){var c=h;return this.__actions__.length&&(c=new Le(this)),c=c.reverse(),c.__actions__.push({func:yl,args:[Hu],thisArg:e}),new Pr(c,this.__chain__)}return this.thru(Hu)}function Q1(){return Rp(this.__wrapped__,this.__actions__)}var J1=ll(function(h,c,g){Ye.call(h,g)?++h[g]:Ln(h,g,1)});function tb(h,c,g){var x=Ee(h)?Xf:z_;return g&&rr(h,c,g)&&(c=e),x(h,me(c,3))}function eb(h,c){var g=Ee(h)?ms:mp;return g(h,me(c,3))}var ib=zp(cm),rb=zp(um);function nb(h,c){return Xi(vl(h,c),1)}function sb(h,c){return Xi(vl(h,c),pt)}function ab(h,c,g){return g=g===e?1:Se(g),Xi(vl(h,c),g)}function ym(h,c){var g=Ee(h)?kr:_s;return g(h,me(c,3))}function vm(h,c){var g=Ee(h)?Ev:pp;return g(h,me(c,3))}var ob=ll(function(h,c,g){Ye.call(h,g)?h[g].push(c):Ln(h,g,[c])});function hb(h,c,g,x){h=pr(h)?h:qa(h),g=g&&!x?Se(g):0;var k=h.length;return g<0&&(g=Ri(k+g,0)),Al(h)?g<=k&&h.indexOf(c,g)>-1:!!k&&Fa(h,c,g)>-1}var lb=Me(function(h,c,g){var x=-1,k=typeof c=="function",U=pr(h)?wt(h.length):[];return _s(h,function(Z){U[++x]=k?Ni(c,Z,g):ih(Z,c,g)}),U}),cb=ll(function(h,c,g){Ln(h,g,c)});function vl(h,c){var g=Ee(h)?si:bp;return g(h,me(c,3))}function ub(h,c,g,x){return h==null?[]:(Ee(c)||(c=c==null?[]:[c]),g=x?e:g,Ee(g)||(g=g==null?[]:[g]),Tp(h,c,g))}var db=ll(function(h,c,g){h[g?0:1].push(c)},function(){return[[],[]]});function fb(h,c,g){var x=Ee(h)?Jc:qf,k=arguments.length<3;return x(h,me(c,4),g,k,_s)}function pb(h,c,g){var x=Ee(h)?Tv:qf,k=arguments.length<3;return x(h,me(c,4),g,k,pp)}function mb(h,c){var g=Ee(h)?ms:mp;return g(h,bl(me(c,3)))}function gb(h){var c=Ee(h)?cp:hw;return c(h)}function yb(h,c,g){(g?rr(h,c,g):c===e)?c=1:c=Se(c);var x=Ee(h)?N_:lw;return x(h,c)}function vb(h){var c=Ee(h)?U_:uw;return c(h)}function _b(h){if(h==null)return 0;if(pr(h))return Al(h)?Ua(h):h.length;var c=Qi(h);return c==C||c==Tt?h.size:vu(h).length}function wb(h,c,g){var x=Ee(h)?tu:dw;return g&&rr(h,c,g)&&(c=e),x(h,me(c,3))}var bb=Me(function(h,c){if(h==null)return[];var g=c.length;return g>1&&rr(h,c[0],c[1])?c=[]:g>2&&rr(c[0],c[1],c[2])&&(c=[c[0]]),Tp(h,Xi(c,1),[])}),_l=t_||function(){return $.Date.now()};function xb(h,c){if(typeof c!="function")throw new Rr(a);return h=Se(h),function(){if(--h<1)return c.apply(this,arguments)}}function _m(h,c,g){return c=g?e:c,c=h&&c==null?h.length:c,On(h,j,e,e,e,e,c)}function wm(h,c){var g;if(typeof c!="function")throw new Rr(a);return h=Se(h),function(){return--h>0&&(g=c.apply(this,arguments)),h<=1&&(c=e),g}}var Wu=Me(function(h,c,g){var x=_;if(g.length){var k=ys(g,Ya(Wu));x|=H}return On(h,x,c,g,k)}),bm=Me(function(h,c,g){var x=_|w;if(g.length){var k=ys(g,Ya(bm));x|=H}return On(c,x,h,g,k)});function xm(h,c,g){c=g?e:c;var x=On(h,E,e,e,e,e,e,c);return x.placeholder=xm.placeholder,x}function Am(h,c,g){c=g?e:c;var x=On(h,R,e,e,e,e,e,c);return x.placeholder=Am.placeholder,x}function Em(h,c,g){var x,k,U,Z,st,dt,kt=0,Rt=!1,Nt=!1,Zt=!0;if(typeof h!="function")throw new Rr(a);c=Fr(c)||0,li(g)&&(Rt=!!g.leading,Nt="maxWait"in g,U=Nt?Ri(Fr(g.maxWait)||0,c):U,Zt="trailing"in g?!!g.trailing:Zt);function oe(bi){var Kr=x,Gn=k;return x=k=e,kt=bi,Z=h.apply(Gn,Kr),Z}function ge(bi){return kt=bi,st=oh(Re,c),Rt?oe(bi):Z}function Ce(bi){var Kr=bi-dt,Gn=bi-kt,zm=c-Kr;return Nt?Zi(zm,U-Gn):zm}function ye(bi){var Kr=bi-dt,Gn=bi-kt;return dt===e||Kr>=c||Kr<0||Nt&&Gn>=U}function Re(){var bi=_l();if(ye(bi))return Oe(bi);st=oh(Re,Ce(bi))}function Oe(bi){return st=e,Zt&&x?oe(bi):(x=k=e,Z)}function Tr(){st!==e&&Dp(st),kt=0,x=dt=k=st=e}function nr(){return st===e?Z:Oe(_l())}function Sr(){var bi=_l(),Kr=ye(bi);if(x=arguments,k=this,dt=bi,Kr){if(st===e)return ge(dt);if(Nt)return Dp(st),st=oh(Re,c),oe(dt)}return st===e&&(st=oh(Re,c)),Z}return Sr.cancel=Tr,Sr.flush=nr,Sr}var Ab=Me(function(h,c){return fp(h,1,c)}),Eb=Me(function(h,c,g){return fp(h,Fr(c)||0,g)});function Tb(h){return On(h,J)}function wl(h,c){if(typeof h!="function"||c!=null&&typeof c!="function")throw new Rr(a);var g=function(){var x=arguments,k=c?c.apply(this,x):x[0],U=g.cache;if(U.has(k))return U.get(k);var Z=h.apply(this,x);return g.cache=U.set(k,Z)||U,Z};return g.cache=new(wl.Cache||Dn),g}wl.Cache=Dn;function bl(h){if(typeof h!="function")throw new Rr(a);return function(){var c=arguments;switch(c.length){case 0:return!h.call(this);case 1:return!h.call(this,c[0]);case 2:return!h.call(this,c[0],c[1]);case 3:return!h.call(this,c[0],c[1],c[2])}return!h.apply(this,c)}}function Sb(h){return wm(2,h)}var Cb=fw(function(h,c){c=c.length==1&&Ee(c[0])?si(c[0],xr(me())):si(Xi(c,1),xr(me()));var g=c.length;return Me(function(x){for(var k=-1,U=Zi(x.length,g);++k<U;)x[k]=c[k].call(this,x[k]);return Ni(h,this,x)})}),zu=Me(function(h,c){var g=ys(c,Ya(zu));return On(h,H,e,c,g)}),Tm=Me(function(h,c){var g=ys(c,Ya(Tm));return On(h,Y,e,c,g)}),Mb=Fn(function(h,c){return On(h,et,e,e,e,c)});function Ib(h,c){if(typeof h!="function")throw new Rr(a);return c=c===e?c:Se(c),Me(h,c)}function Bb(h,c){if(typeof h!="function")throw new Rr(a);return c=c==null?0:Ri(Se(c),0),Me(function(g){var x=g[c],k=xs(g,0,c);return x&&gs(k,x),Ni(h,this,k)})}function kb(h,c,g){var x=!0,k=!0;if(typeof h!="function")throw new Rr(a);return li(g)&&(x="leading"in g?!!g.leading:x,k="trailing"in g?!!g.trailing:k),Em(h,c,{leading:x,maxWait:c,trailing:k})}function Rb(h){return _m(h,1)}function Pb(h,c){return zu(Cu(c),h)}function Db(){if(!arguments.length)return[];var h=arguments[0];return Ee(h)?h:[h]}function Lb(h){return Dr(h,p)}function Ob(h,c){return c=typeof c=="function"?c:e,Dr(h,p,c)}function Fb(h){return Dr(h,l|p)}function Nb(h,c){return c=typeof c=="function"?c:e,Dr(h,l|p,c)}function Ub(h,c){return c==null||dp(h,c,Ui(c))}function Yr(h,c){return h===c||h!==h&&c!==c}var Hb=fl(mu),Gb=fl(function(h,c){return h>=c}),$s=vp(function(){return arguments}())?vp:function(h){return gi(h)&&Ye.call(h,"callee")&&!np.call(h,"callee")},Ee=wt.isArray,Wb=we?xr(we):q_;function pr(h){return h!=null&&xl(h.length)&&!Un(h)}function wi(h){return gi(h)&&pr(h)}function zb(h){return h===!0||h===!1||gi(h)&&ir(h)==jt}var As=i_||td,Vb=je?xr(je):$_;function Xb(h){return gi(h)&&h.nodeType===1&&!hh(h)}function jb(h){if(h==null)return!0;if(pr(h)&&(Ee(h)||typeof h=="string"||typeof h.splice=="function"||As(h)||Ka(h)||$s(h)))return!h.length;var c=Qi(h);if(c==C||c==Tt)return!h.size;if(ah(h))return!vu(h).length;for(var g in h)if(Ye.call(h,g))return!1;return!0}function Yb(h,c){return rh(h,c)}function Kb(h,c,g){g=typeof g=="function"?g:e;var x=g?g(h,c):e;return x===e?rh(h,c,e,g):!!x}function Vu(h){if(!gi(h))return!1;var c=ir(h);return c==ne||c==ce||typeof h.message=="string"&&typeof h.name=="string"&&!hh(h)}function qb(h){return typeof h=="number"&&ap(h)}function Un(h){if(!li(h))return!1;var c=ir(h);return c==_e||c==pe||c==re||c==lt}function Sm(h){return typeof h=="number"&&h==Se(h)}function xl(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=Wt}function li(h){var c=typeof h;return h!=null&&(c=="object"||c=="function")}function gi(h){return h!=null&&typeof h=="object"}var Cm=Fi?xr(Fi):Q_;function $b(h,c){return h===c||yu(h,c,Du(c))}function Zb(h,c,g){return g=typeof g=="function"?g:e,yu(h,c,Du(c),g)}function Qb(h){return Mm(h)&&h!=+h}function Jb(h){if(Ow(h))throw new Ae(s);return _p(h)}function tx(h){return h===null}function ex(h){return h==null}function Mm(h){return typeof h=="number"||gi(h)&&ir(h)==At}function hh(h){if(!gi(h)||ir(h)!=K)return!1;var c=qh(h);if(c===null)return!0;var g=Ye.call(c,"constructor")&&c.constructor;return typeof g=="function"&&g instanceof g&&Xh.call(g)==$v}var Xu=cn?xr(cn):J_;function ix(h){return Sm(h)&&h>=-Wt&&h<=Wt}var Im=un?xr(un):tw;function Al(h){return typeof h=="string"||!Ee(h)&&gi(h)&&ir(h)==at}function Er(h){return typeof h=="symbol"||gi(h)&&ir(h)==Ut}var Ka=dr?xr(dr):ew;function rx(h){return h===e}function nx(h){return gi(h)&&Qi(h)==Lt}function sx(h){return gi(h)&&ir(h)==ee}var ax=fl(_u),ox=fl(function(h,c){return h<=c});function Bm(h){if(!h)return[];if(pr(h))return Al(h)?Xr(h):fr(h);if(qo&&h[qo])return Nv(h[qo]());var c=Qi(h),g=c==C?au:c==Tt?Wh:qa;return g(h)}function Hn(h){if(!h)return h===0?h:0;if(h=Fr(h),h===pt||h===-pt){var c=h<0?-1:1;return c*bt}return h===h?h:0}function Se(h){var c=Hn(h),g=c%1;return c===c?g?c-g:c:0}function km(h){return h?js(Se(h),0,tt):0}function Fr(h){if(typeof h=="number")return h;if(Er(h))return xt;if(li(h)){var c=typeof h.valueOf=="function"?h.valueOf():h;h=li(c)?c+"":c}if(typeof h!="string")return h===0?h:+h;h=$f(h);var g=Ho.test(h);return g||Gs.test(h)?M(h.slice(2),g?2:8):Ma.test(h)?xt:+h}function Rm(h){return fn(h,mr(h))}function hx(h){return h?js(Se(h),-Wt,Wt):h===0?h:0}function Ve(h){return h==null?"":Ar(h)}var lx=Xa(function(h,c){if(ah(c)||pr(c)){fn(c,Ui(c),h);return}for(var g in c)Ye.call(c,g)&&th(h,g,c[g])}),Pm=Xa(function(h,c){fn(c,mr(c),h)}),El=Xa(function(h,c,g,x){fn(c,mr(c),h,x)}),cx=Xa(function(h,c,g,x){fn(c,Ui(c),h,x)}),ux=Fn(du);function dx(h,c){var g=Va(h);return c==null?g:up(g,c)}var fx=Me(function(h,c){h=Qe(h);var g=-1,x=c.length,k=x>2?c[2]:e;for(k&&rr(c[0],c[1],k)&&(x=1);++g<x;)for(var U=c[g],Z=mr(U),st=-1,dt=Z.length;++st<dt;){var kt=Z[st],Rt=h[kt];(Rt===e||Yr(Rt,Ga[kt])&&!Ye.call(h,kt))&&(h[kt]=U[kt])}return h}),px=Me(function(h){return h.push(e,$p),Ni(Dm,e,h)});function mx(h,c){return jf(h,me(c,3),dn)}function gx(h,c){return jf(h,me(c,3),pu)}function yx(h,c){return h==null?h:fu(h,me(c,3),mr)}function vx(h,c){return h==null?h:gp(h,me(c,3),mr)}function _x(h,c){return h&&dn(h,me(c,3))}function wx(h,c){return h&&pu(h,me(c,3))}function bx(h){return h==null?[]:sl(h,Ui(h))}function xx(h){return h==null?[]:sl(h,mr(h))}function ju(h,c,g){var x=h==null?e:Ys(h,c);return x===e?g:x}function Ax(h,c){return h!=null&&Jp(h,c,X_)}function Yu(h,c){return h!=null&&Jp(h,c,j_)}var Ex=Xp(function(h,c,g){c!=null&&typeof c.toString!="function"&&(c=jh.call(c)),h[c]=g},qu(gr)),Tx=Xp(function(h,c,g){c!=null&&typeof c.toString!="function"&&(c=jh.call(c)),Ye.call(h,c)?h[c].push(g):h[c]=[g]},me),Sx=Me(ih);function Ui(h){return pr(h)?lp(h):vu(h)}function mr(h){return pr(h)?lp(h,!0):iw(h)}function Cx(h,c){var g={};return c=me(c,3),dn(h,function(x,k,U){Ln(g,c(x,k,U),x)}),g}function Mx(h,c){var g={};return c=me(c,3),dn(h,function(x,k,U){Ln(g,k,c(x,k,U))}),g}var Ix=Xa(function(h,c,g){al(h,c,g)}),Dm=Xa(function(h,c,g,x){al(h,c,g,x)}),Bx=Fn(function(h,c){var g={};if(h==null)return g;var x=!1;c=si(c,function(U){return U=bs(U,h),x||(x=U.length>1),U}),fn(h,Ru(h),g),x&&(g=Dr(g,l|f|p,Ew));for(var k=c.length;k--;)Eu(g,c[k]);return g});function kx(h,c){return Lm(h,bl(me(c)))}var Rx=Fn(function(h,c){return h==null?{}:sw(h,c)});function Lm(h,c){if(h==null)return{};var g=si(Ru(h),function(x){return[x]});return c=me(c),Sp(h,g,function(x,k){return c(x,k[0])})}function Px(h,c,g){c=bs(c,h);var x=-1,k=c.length;for(k||(k=1,h=e);++x<k;){var U=h==null?e:h[pn(c[x])];U===e&&(x=k,U=g),h=Un(U)?U.call(h):U}return h}function Dx(h,c,g){return h==null?h:nh(h,c,g)}function Lx(h,c,g,x){return x=typeof x=="function"?x:e,h==null?h:nh(h,c,g,x)}var Om=Kp(Ui),Fm=Kp(mr);function Ox(h,c,g){var x=Ee(h),k=x||As(h)||Ka(h);if(c=me(c,4),g==null){var U=h&&h.constructor;k?g=x?new U:[]:li(h)?g=Un(U)?Va(qh(h)):{}:g={}}return(k?kr:dn)(h,function(Z,st,dt){return c(g,Z,st,dt)}),g}function Fx(h,c){return h==null?!0:Eu(h,c)}function Nx(h,c,g){return h==null?h:kp(h,c,Cu(g))}function Ux(h,c,g,x){return x=typeof x=="function"?x:e,h==null?h:kp(h,c,Cu(g),x)}function qa(h){return h==null?[]:su(h,Ui(h))}function Hx(h){return h==null?[]:su(h,mr(h))}function Gx(h,c,g){return g===e&&(g=c,c=e),g!==e&&(g=Fr(g),g=g===g?g:0),c!==e&&(c=Fr(c),c=c===c?c:0),js(Fr(h),c,g)}function Wx(h,c,g){return c=Hn(c),g===e?(g=c,c=0):g=Hn(g),h=Fr(h),Y_(h,c,g)}function zx(h,c,g){if(g&&typeof g!="boolean"&&rr(h,c,g)&&(c=g=e),g===e&&(typeof c=="boolean"?(g=c,c=e):typeof h=="boolean"&&(g=h,h=e)),h===e&&c===e?(h=0,c=1):(h=Hn(h),c===e?(c=h,h=0):c=Hn(c)),h>c){var x=h;h=c,c=x}if(g||h%1||c%1){var k=op();return Zi(h+k*(c-h+Yo("1e-"+((k+"").length-1))),c)}return bu(h,c)}var Vx=ja(function(h,c,g){return c=c.toLowerCase(),h+(g?Nm(c):c)});function Nm(h){return Ku(Ve(h).toLowerCase())}function Um(h){return h=Ve(h),h&&h.replace(zo,Pv).replace($i,"")}function Xx(h,c,g){h=Ve(h),c=Ar(c);var x=h.length;g=g===e?x:js(Se(g),0,x);var k=g;return g-=c.length,g>=0&&h.slice(g,k)==c}function jx(h){return h=Ve(h),h&&Ei.test(h)?h.replace(ke,Dv):h}function Yx(h){return h=Ve(h),h&&Mn.test(h)?h.replace(Cn,"\\$&"):h}var Kx=ja(function(h,c,g){return h+(g?"-":"")+c.toLowerCase()}),qx=ja(function(h,c,g){return h+(g?" ":"")+c.toLowerCase()}),$x=Wp("toLowerCase");function Zx(h,c,g){h=Ve(h),c=Se(c);var x=c?Ua(h):0;if(!c||x>=c)return h;var k=(c-x)/2;return dl(Jh(k),g)+h+dl(Qh(k),g)}function Qx(h,c,g){h=Ve(h),c=Se(c);var x=c?Ua(h):0;return c&&x<c?h+dl(c-x,g):h}function Jx(h,c,g){h=Ve(h),c=Se(c);var x=c?Ua(h):0;return c&&x<c?dl(c-x,g)+h:h}function tA(h,c,g){return g||c==null?c=0:c&&(c=+c),a_(Ve(h).replace(In,""),c||0)}function eA(h,c,g){return(g?rr(h,c,g):c===e)?c=1:c=Se(c),xu(Ve(h),c)}function iA(){var h=arguments,c=Ve(h[0]);return h.length<3?c:c.replace(h[1],h[2])}var rA=ja(function(h,c,g){return h+(g?"_":"")+c.toLowerCase()});function nA(h,c,g){return g&&typeof g!="number"&&rr(h,c,g)&&(c=g=e),g=g===e?tt:g>>>0,g?(h=Ve(h),h&&(typeof c=="string"||c!=null&&!Xu(c))&&(c=Ar(c),!c&&Na(h))?xs(Xr(h),0,g):h.split(c,g)):[]}var sA=ja(function(h,c,g){return h+(g?" ":"")+Ku(c)});function aA(h,c,g){return h=Ve(h),g=g==null?0:js(Se(g),0,h.length),c=Ar(c),h.slice(g,g+c.length)==c}function oA(h,c,g){var x=F.templateSettings;g&&rr(h,c,g)&&(c=e),h=Ve(h),c=El({},c,x,qp);var k=El({},c.imports,x.imports,qp),U=Ui(k),Z=su(k,U),st,dt,kt=0,Rt=c.interpolate||hr,Nt="__p += '",Zt=ou((c.escape||hr).source+"|"+Rt.source+"|"+(Rt===Fs?Ca:hr).source+"|"+(c.evaluate||hr).source+"|$","g"),oe="//# sourceURL="+(Ye.call(c,"sourceURL")?(c.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++$c+"]")+`
`;h.replace(Zt,function(ye,Re,Oe,Tr,nr,Sr){return Oe||(Oe=Tr),Nt+=h.slice(kt,Sr).replace(Vo,Lv),Re&&(st=!0,Nt+=`' +
__e(`+Re+`) +
'`),nr&&(dt=!0,Nt+=`';
`+nr+`;
__p += '`),Oe&&(Nt+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),kt=Sr+ye.length,ye}),Nt+=`';
`;var ge=Ye.call(c,"variable")&&c.variable;if(!ge)Nt=`with (obj) {
`+Nt+`
}
`;else if(Hs.test(ge))throw new Ae(o);Nt=(dt?Nt.replace(Vt,""):Nt).replace(xe,"$1").replace(Be,"$1;"),Nt="function("+(ge||"obj")+`) {
`+(ge?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(st?", __e = _.escape":"")+(dt?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Nt+`return __p
}`;var Ce=Gm(function(){return We(U,oe+"return "+Nt).apply(e,Z)});if(Ce.source=Nt,Vu(Ce))throw Ce;return Ce}function hA(h){return Ve(h).toLowerCase()}function lA(h){return Ve(h).toUpperCase()}function cA(h,c,g){if(h=Ve(h),h&&(g||c===e))return $f(h);if(!h||!(c=Ar(c)))return h;var x=Xr(h),k=Xr(c),U=Zf(x,k),Z=Qf(x,k)+1;return xs(x,U,Z).join("")}function uA(h,c,g){if(h=Ve(h),h&&(g||c===e))return h.slice(0,tp(h)+1);if(!h||!(c=Ar(c)))return h;var x=Xr(h),k=Qf(x,Xr(c))+1;return xs(x,0,k).join("")}function dA(h,c,g){if(h=Ve(h),h&&(g||c===e))return h.replace(In,"");if(!h||!(c=Ar(c)))return h;var x=Xr(h),k=Zf(x,Xr(c));return xs(x,k).join("")}function fA(h,c){var g=rt,x=gt;if(li(c)){var k="separator"in c?c.separator:k;g="length"in c?Se(c.length):g,x="omission"in c?Ar(c.omission):x}h=Ve(h);var U=h.length;if(Na(h)){var Z=Xr(h);U=Z.length}if(g>=U)return h;var st=g-Ua(x);if(st<1)return x;var dt=Z?xs(Z,0,st).join(""):h.slice(0,st);if(k===e)return dt+x;if(Z&&(st+=dt.length-st),Xu(k)){if(h.slice(st).search(k)){var kt,Rt=dt;for(k.global||(k=ou(k.source,Ve(Vr.exec(k))+"g")),k.lastIndex=0;kt=k.exec(Rt);)var Nt=kt.index;dt=dt.slice(0,Nt===e?st:Nt)}}else if(h.indexOf(Ar(k),st)!=st){var Zt=dt.lastIndexOf(k);Zt>-1&&(dt=dt.slice(0,Zt))}return dt+x}function pA(h){return h=Ve(h),h&&Ze.test(h)?h.replace(Ne,Wv):h}var mA=ja(function(h,c,g){return h+(g?" ":"")+c.toUpperCase()}),Ku=Wp("toUpperCase");function Hm(h,c,g){return h=Ve(h),c=g?e:c,c===e?Fv(h)?Xv(h):Mv(h):h.match(c)||[]}var Gm=Me(function(h,c){try{return Ni(h,e,c)}catch(g){return Vu(g)?g:new Ae(g)}}),gA=Fn(function(h,c){return kr(c,function(g){g=pn(g),Ln(h,g,Wu(h[g],h))}),h});function yA(h){var c=h==null?0:h.length,g=me();return h=c?si(h,function(x){if(typeof x[1]!="function")throw new Rr(a);return[g(x[0]),x[1]]}):[],Me(function(x){for(var k=-1;++k<c;){var U=h[k];if(Ni(U[0],this,x))return Ni(U[1],this,x)}})}function vA(h){return W_(Dr(h,l))}function qu(h){return function(){return h}}function _A(h,c){return h==null||h!==h?c:h}var wA=Vp(),bA=Vp(!0);function gr(h){return h}function $u(h){return wp(typeof h=="function"?h:Dr(h,l))}function xA(h){return xp(Dr(h,l))}function AA(h,c){return Ap(h,Dr(c,l))}var EA=Me(function(h,c){return function(g){return ih(g,h,c)}}),TA=Me(function(h,c){return function(g){return ih(h,g,c)}});function Zu(h,c,g){var x=Ui(c),k=sl(c,x);g==null&&!(li(c)&&(k.length||!x.length))&&(g=c,c=h,h=this,k=sl(c,Ui(c)));var U=!(li(g)&&"chain"in g)||!!g.chain,Z=Un(h);return kr(k,function(st){var dt=c[st];h[st]=dt,Z&&(h.prototype[st]=function(){var kt=this.__chain__;if(U||kt){var Rt=h(this.__wrapped__),Nt=Rt.__actions__=fr(this.__actions__);return Nt.push({func:dt,args:arguments,thisArg:h}),Rt.__chain__=kt,Rt}return dt.apply(h,gs([this.value()],arguments))})}),h}function SA(){return $._===this&&($._=Zv),this}function Qu(){}function CA(h){return h=Se(h),Me(function(c){return Ep(c,h)})}var MA=Iu(si),IA=Iu(Xf),BA=Iu(tu);function Wm(h){return Ou(h)?eu(pn(h)):aw(h)}function kA(h){return function(c){return h==null?e:Ys(h,c)}}var RA=jp(),PA=jp(!0);function Ju(){return[]}function td(){return!1}function DA(){return{}}function LA(){return""}function OA(){return!0}function FA(h,c){if(h=Se(h),h<1||h>Wt)return[];var g=tt,x=Zi(h,tt);c=me(c),h-=tt;for(var k=nu(x,c);++g<h;)c(g);return k}function NA(h){return Ee(h)?si(h,pn):Er(h)?[h]:fr(hm(Ve(h)))}function UA(h){var c=++qv;return Ve(h)+c}var HA=ul(function(h,c){return h+c},0),GA=Bu("ceil"),WA=ul(function(h,c){return h/c},1),zA=Bu("floor");function VA(h){return h&&h.length?nl(h,gr,mu):e}function XA(h,c){return h&&h.length?nl(h,me(c,2),mu):e}function jA(h){return Kf(h,gr)}function YA(h,c){return Kf(h,me(c,2))}function KA(h){return h&&h.length?nl(h,gr,_u):e}function qA(h,c){return h&&h.length?nl(h,me(c,2),_u):e}var $A=ul(function(h,c){return h*c},1),ZA=Bu("round"),QA=ul(function(h,c){return h-c},0);function JA(h){return h&&h.length?ru(h,gr):0}function tE(h,c){return h&&h.length?ru(h,me(c,2)):0}return F.after=xb,F.ary=_m,F.assign=lx,F.assignIn=Pm,F.assignInWith=El,F.assignWith=cx,F.at=ux,F.before=wm,F.bind=Wu,F.bindAll=gA,F.bindKey=bm,F.castArray=Db,F.chain=gm,F.chunk=zw,F.compact=Vw,F.concat=Xw,F.cond=yA,F.conforms=vA,F.constant=qu,F.countBy=J1,F.create=dx,F.curry=xm,F.curryRight=Am,F.debounce=Em,F.defaults=fx,F.defaultsDeep=px,F.defer=Ab,F.delay=Eb,F.difference=jw,F.differenceBy=Yw,F.differenceWith=Kw,F.drop=qw,F.dropRight=$w,F.dropRightWhile=Zw,F.dropWhile=Qw,F.fill=Jw,F.filter=eb,F.flatMap=nb,F.flatMapDeep=sb,F.flatMapDepth=ab,F.flatten=dm,F.flattenDeep=t1,F.flattenDepth=e1,F.flip=Tb,F.flow=wA,F.flowRight=bA,F.fromPairs=i1,F.functions=bx,F.functionsIn=xx,F.groupBy=ob,F.initial=n1,F.intersection=s1,F.intersectionBy=a1,F.intersectionWith=o1,F.invert=Ex,F.invertBy=Tx,F.invokeMap=lb,F.iteratee=$u,F.keyBy=cb,F.keys=Ui,F.keysIn=mr,F.map=vl,F.mapKeys=Cx,F.mapValues=Mx,F.matches=xA,F.matchesProperty=AA,F.memoize=wl,F.merge=Ix,F.mergeWith=Dm,F.method=EA,F.methodOf=TA,F.mixin=Zu,F.negate=bl,F.nthArg=CA,F.omit=Bx,F.omitBy=kx,F.once=Sb,F.orderBy=ub,F.over=MA,F.overArgs=Cb,F.overEvery=IA,F.overSome=BA,F.partial=zu,F.partialRight=Tm,F.partition=db,F.pick=Rx,F.pickBy=Lm,F.property=Wm,F.propertyOf=kA,F.pull=u1,F.pullAll=pm,F.pullAllBy=d1,F.pullAllWith=f1,F.pullAt=p1,F.range=RA,F.rangeRight=PA,F.rearg=Mb,F.reject=mb,F.remove=m1,F.rest=Ib,F.reverse=Hu,F.sampleSize=yb,F.set=Dx,F.setWith=Lx,F.shuffle=vb,F.slice=g1,F.sortBy=bb,F.sortedUniq=A1,F.sortedUniqBy=E1,F.split=nA,F.spread=Bb,F.tail=T1,F.take=S1,F.takeRight=C1,F.takeRightWhile=M1,F.takeWhile=I1,F.tap=V1,F.throttle=kb,F.thru=yl,F.toArray=Bm,F.toPairs=Om,F.toPairsIn=Fm,F.toPath=NA,F.toPlainObject=Rm,F.transform=Ox,F.unary=Rb,F.union=B1,F.unionBy=k1,F.unionWith=R1,F.uniq=P1,F.uniqBy=D1,F.uniqWith=L1,F.unset=Fx,F.unzip=Gu,F.unzipWith=mm,F.update=Nx,F.updateWith=Ux,F.values=qa,F.valuesIn=Hx,F.without=O1,F.words=Hm,F.wrap=Pb,F.xor=F1,F.xorBy=N1,F.xorWith=U1,F.zip=H1,F.zipObject=G1,F.zipObjectDeep=W1,F.zipWith=z1,F.entries=Om,F.entriesIn=Fm,F.extend=Pm,F.extendWith=El,Zu(F,F),F.add=HA,F.attempt=Gm,F.camelCase=Vx,F.capitalize=Nm,F.ceil=GA,F.clamp=Gx,F.clone=Lb,F.cloneDeep=Fb,F.cloneDeepWith=Nb,F.cloneWith=Ob,F.conformsTo=Ub,F.deburr=Um,F.defaultTo=_A,F.divide=WA,F.endsWith=Xx,F.eq=Yr,F.escape=jx,F.escapeRegExp=Yx,F.every=tb,F.find=ib,F.findIndex=cm,F.findKey=mx,F.findLast=rb,F.findLastIndex=um,F.findLastKey=gx,F.floor=zA,F.forEach=ym,F.forEachRight=vm,F.forIn=yx,F.forInRight=vx,F.forOwn=_x,F.forOwnRight=wx,F.get=ju,F.gt=Hb,F.gte=Gb,F.has=Ax,F.hasIn=Yu,F.head=fm,F.identity=gr,F.includes=hb,F.indexOf=r1,F.inRange=Wx,F.invoke=Sx,F.isArguments=$s,F.isArray=Ee,F.isArrayBuffer=Wb,F.isArrayLike=pr,F.isArrayLikeObject=wi,F.isBoolean=zb,F.isBuffer=As,F.isDate=Vb,F.isElement=Xb,F.isEmpty=jb,F.isEqual=Yb,F.isEqualWith=Kb,F.isError=Vu,F.isFinite=qb,F.isFunction=Un,F.isInteger=Sm,F.isLength=xl,F.isMap=Cm,F.isMatch=$b,F.isMatchWith=Zb,F.isNaN=Qb,F.isNative=Jb,F.isNil=ex,F.isNull=tx,F.isNumber=Mm,F.isObject=li,F.isObjectLike=gi,F.isPlainObject=hh,F.isRegExp=Xu,F.isSafeInteger=ix,F.isSet=Im,F.isString=Al,F.isSymbol=Er,F.isTypedArray=Ka,F.isUndefined=rx,F.isWeakMap=nx,F.isWeakSet=sx,F.join=h1,F.kebabCase=Kx,F.last=Or,F.lastIndexOf=l1,F.lowerCase=qx,F.lowerFirst=$x,F.lt=ax,F.lte=ox,F.max=VA,F.maxBy=XA,F.mean=jA,F.meanBy=YA,F.min=KA,F.minBy=qA,F.stubArray=Ju,F.stubFalse=td,F.stubObject=DA,F.stubString=LA,F.stubTrue=OA,F.multiply=$A,F.nth=c1,F.noConflict=SA,F.noop=Qu,F.now=_l,F.pad=Zx,F.padEnd=Qx,F.padStart=Jx,F.parseInt=tA,F.random=zx,F.reduce=fb,F.reduceRight=pb,F.repeat=eA,F.replace=iA,F.result=Px,F.round=ZA,F.runInContext=ct,F.sample=gb,F.size=_b,F.snakeCase=rA,F.some=wb,F.sortedIndex=y1,F.sortedIndexBy=v1,F.sortedIndexOf=_1,F.sortedLastIndex=w1,F.sortedLastIndexBy=b1,F.sortedLastIndexOf=x1,F.startCase=sA,F.startsWith=aA,F.subtract=QA,F.sum=JA,F.sumBy=tE,F.template=oA,F.times=FA,F.toFinite=Hn,F.toInteger=Se,F.toLength=km,F.toLower=hA,F.toNumber=Fr,F.toSafeInteger=hx,F.toString=Ve,F.toUpper=lA,F.trim=cA,F.trimEnd=uA,F.trimStart=dA,F.truncate=fA,F.unescape=pA,F.uniqueId=UA,F.upperCase=mA,F.upperFirst=Ku,F.each=ym,F.eachRight=vm,F.first=fm,Zu(F,function(){var h={};return dn(F,function(c,g){Ye.call(F.prototype,g)||(h[g]=c)}),h}(),{chain:!1}),F.VERSION=r,kr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(h){F[h].placeholder=F}),kr(["drop","take"],function(h,c){Le.prototype[h]=function(g){g=g===e?1:Ri(Se(g),0);var x=this.__filtered__&&!c?new Le(this):this.clone();return x.__filtered__?x.__takeCount__=Zi(g,x.__takeCount__):x.__views__.push({size:Zi(g,tt),type:h+(x.__dir__<0?"Right":"")}),x},Le.prototype[h+"Right"]=function(g){return this.reverse()[h](g).reverse()}}),kr(["filter","map","takeWhile"],function(h,c){var g=c+1,x=g==S||g==Pt;Le.prototype[h]=function(k){var U=this.clone();return U.__iteratees__.push({iteratee:me(k,3),type:g}),U.__filtered__=U.__filtered__||x,U}}),kr(["head","last"],function(h,c){var g="take"+(c?"Right":"");Le.prototype[h]=function(){return this[g](1).value()[0]}}),kr(["initial","tail"],function(h,c){var g="drop"+(c?"":"Right");Le.prototype[h]=function(){return this.__filtered__?new Le(this):this[g](1)}}),Le.prototype.compact=function(){return this.filter(gr)},Le.prototype.find=function(h){return this.filter(h).head()},Le.prototype.findLast=function(h){return this.reverse().find(h)},Le.prototype.invokeMap=Me(function(h,c){return typeof h=="function"?new Le(this):this.map(function(g){return ih(g,h,c)})}),Le.prototype.reject=function(h){return this.filter(bl(me(h)))},Le.prototype.slice=function(h,c){h=Se(h);var g=this;return g.__filtered__&&(h>0||c<0)?new Le(g):(h<0?g=g.takeRight(-h):h&&(g=g.drop(h)),c!==e&&(c=Se(c),g=c<0?g.dropRight(-c):g.take(c-h)),g)},Le.prototype.takeRightWhile=function(h){return this.reverse().takeWhile(h).reverse()},Le.prototype.toArray=function(){return this.take(tt)},dn(Le.prototype,function(h,c){var g=/^(?:filter|find|map|reject)|While$/.test(c),x=/^(?:head|last)$/.test(c),k=F[x?"take"+(c=="last"?"Right":""):c],U=x||/^find/.test(c);!k||(F.prototype[c]=function(){var Z=this.__wrapped__,st=x?[1]:arguments,dt=Z instanceof Le,kt=st[0],Rt=dt||Ee(Z),Nt=function(Re){var Oe=k.apply(F,gs([Re],st));return x&&Zt?Oe[0]:Oe};Rt&&g&&typeof kt=="function"&&kt.length!=1&&(dt=Rt=!1);var Zt=this.__chain__,oe=!!this.__actions__.length,ge=U&&!Zt,Ce=dt&&!oe;if(!U&&Rt){Z=Ce?Z:new Le(this);var ye=h.apply(Z,st);return ye.__actions__.push({func:yl,args:[Nt],thisArg:e}),new Pr(ye,Zt)}return ge&&Ce?h.apply(this,st):(ye=this.thru(Nt),ge?x?ye.value()[0]:ye.value():ye)})}),kr(["pop","push","shift","sort","splice","unshift"],function(h){var c=zh[h],g=/^(?:push|sort|unshift)$/.test(h)?"tap":"thru",x=/^(?:pop|shift)$/.test(h);F.prototype[h]=function(){var k=arguments;if(x&&!this.__chain__){var U=this.value();return c.apply(Ee(U)?U:[],k)}return this[g](function(Z){return c.apply(Ee(Z)?Z:[],k)})}}),dn(Le.prototype,function(h,c){var g=F[c];if(g){var x=g.name+"";Ye.call(za,x)||(za[x]=[]),za[x].push({name:c,func:g})}}),za[cl(e,w).name]=[{name:"wrapper",func:e}],Le.prototype.clone=f_,Le.prototype.reverse=p_,Le.prototype.value=m_,F.prototype.at=X1,F.prototype.chain=j1,F.prototype.commit=Y1,F.prototype.next=K1,F.prototype.plant=$1,F.prototype.reverse=Z1,F.prototype.toJSON=F.prototype.valueOf=F.prototype.value=Q1,F.prototype.first=F.prototype.head,qo&&(F.prototype[qo]=q1),F},Ha=jv();ht?((ht.exports=Ha)._=Ha,ft._=Ha):$._=Ha}).call(hi)})(xc,xc.exports);var xa={};xa.BITS=32;xa.GROUPS=4;xa.RE_ADDRESS=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g;xa.RE_SUBNET_STRING=/\/\d{1,2}$/;var Lh=Bf.exports.BigInteger,Vy=Dh,Ac=ko.sprintf,Wc=xc.exports,_n=xa;function Ke(i){this.valid=!1,this.address=i,this.groups=_n.GROUPS,this.v4=!0,this.subnet="/32",this.subnetMask=32;var t=_n.RE_SUBNET_STRING.exec(i);if(t){if(this.parsedSubnet=t[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,this.subnetMask<0||this.subnetMask>_n.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}i=i.replace(_n.RE_SUBNET_STRING,"")}this.addressMinusSuffix=i,this.parsedAddress=this.parse(i)}Ke.prototype.parse=function(i){var t=i.split(".");return i.match(_n.RE_ADDRESS)?this.valid=!0:this.error="Invalid IPv4 address.",t};Ke.prototype.isValid=function(){return this.valid};Ke.prototype.correctForm=function(){return this.parsedAddress.map(function(i){return parseInt(i,10)}).join(".")};Ke.prototype.isCorrect=Vy.isCorrect(_n.BITS);Ke.fromHex=function(i){var t=Wc.padStart(i.replace(/:/g,""),8,"0"),e=[],r;for(r=0;r<8;r+=2){var n=t.slice(r,r+2);e.push(parseInt(n,16))}return new Ke(e.join("."))};Ke.fromInteger=function(i){return Ke.fromHex(i.toString(16))};Ke.prototype.toHex=function(){return this.parsedAddress.map(function(i){return Ac("%02x",parseInt(i,10))}).join(":")};Ke.prototype.toArray=function(){return this.parsedAddress.map(function(i){return parseInt(i,10)})};Ke.prototype.toGroup6=function(){var i=[],t;for(t=0;t<_n.GROUPS;t+=2){var e=Ac("%02x%02x",parseInt(this.parsedAddress[t],10),parseInt(this.parsedAddress[t+1],10));i.push(Ac("%x",parseInt(e,16)))}return i.join(":")};Ke.prototype.bigInteger=function(){return this.valid?new Lh(this.parsedAddress.map(function(i){return Ac("%02x",parseInt(i,10))}).join(""),16):null};Ke.prototype._startAddress=function(){return new Lh(this.mask()+Wc.repeat("0",_n.BITS-this.subnetMask),2)};Ke.prototype.startAddress=function(){return Ke.fromBigInteger(this._startAddress())};Ke.prototype.startAddressExclusive=function(){var i=new Lh("1");return Ke.fromBigInteger(this._startAddress().add(i))};Ke.prototype._endAddress=function(){return new Lh(this.mask()+Wc.repeat("1",_n.BITS-this.subnetMask),2)};Ke.prototype.endAddress=function(){return Ke.fromBigInteger(this._endAddress())};Ke.prototype.endAddressExclusive=function(){var i=new Lh("1");return Ke.fromBigInteger(this._endAddress().subtract(i))};Ke.fromBigInteger=function(i){return Ke.fromInteger(parseInt(i.toString(),10))};Ke.prototype.mask=function(i){return i===void 0&&(i=this.subnetMask),this.getBitsBase2(0,i)};Ke.prototype.getBitsBase2=function(i,t){return this.binaryZeroPad().slice(i,t)};Ke.prototype.isInSubnet=Vy.isInSubnet;Ke.prototype.binaryZeroPad=function(){return Wc.padStart(this.bigInteger().toString(2),_n.BITS,"0")};var Xy=Ke,Mr={};Mr.BITS=128;Mr.GROUPS=8;Mr.SCOPES={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"};Mr.TYPES={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"};Mr.RE_BAD_CHARACTERS=/([^0-9a-f:\/%])/ig;Mr.RE_BAD_ADDRESS=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/ig;Mr.RE_SUBNET_STRING=/\/\d{1,3}(?=%|$)/;Mr.RE_ZONE_STRING=/%.*$/;Mr.RE_URL=new RegExp(/^\[{0,1}([0-9a-f:]+)\]{0,1}/);Mr.RE_URL_WITH_PORT=new RegExp(/\[([0-9a-f:]+)\]:([0-9]{1,5})/);var Nr={},jg;function lB(){if(jg)return Nr;jg=1;var i=Dh,t=Mr;return Nr.isValid=function(){return this.valid},Nr.isInSubnet=i.isInSubnet,Nr.isCorrect=i.isCorrect(t.BITS),Nr.isCanonical=i.falseIfInvalid(function(){return this.addressMinusSuffix===this.canonicalForm()}),Nr.isLinkLocal=i.falseIfInvalid(function(){return this.getBitsBase2(0,64)==="1111111010000000000000000000000000000000000000000000000000000000"}),Nr.isMulticast=i.falseIfInvalid(function(){return this.getType()==="Multicast"}),Nr.is4=i.falseIfInvalid(function(){return this.v4}),Nr.isTeredo=i.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2001::/32"))}),Nr.is6to4=i.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2002::/16"))}),Nr.isLoopback=i.falseIfInvalid(function(){return this.getType()==="Loopback"}),Nr}var mh={},Ro={},jy=ko.sprintf,cB=Ro.spanAllZeroes=function(i){return i.replace(/(0+)/g,'<span class="zero">$1</span>')};Ro.spanAll=function(i,t){t===void 0&&(t=0);var e=i.split("");return e.map(function(r,n){return jy('<span class="digit value-%s position-%d">%s</span>',r,n+t,cB(r))}).join("")};function Yy(i){return i.replace(/^(0+)/,'<span class="zero">$1</span>')}Ro.spanLeadingZeroes=function(i){var t=i.split(":");return t.map(function(e){return Yy(e)}).join(":")};Ro.simpleGroup=function(i,t){var e=i.split(":");return t||(t=0),e.map(function(r,n){return/group-v4/.test(r)?r:jy('<span class="hover-group group-%d">%s</span>',n+t,Yy(r))}).join(":")};var Yg;function uB(){if(Yg)return mh;Yg=1;var i=xa,t=Ro,e=ko.sprintf;return mh.href=function(r){return r===void 0?r="":r=e(":%s",r),e("http://[%s]%s/",this.correctForm(),r)},mh.link=function(r){r||(r={}),r.className===void 0&&(r.className=""),r.prefix===void 0&&(r.prefix="/#address="),r.v4===void 0&&(r.v4=!1);var n=this.correctForm;return r.v4&&(n=this.to4in6),r.className?e('<a href="%1$s%2$s" class="%3$s">%2$s</a>',r.prefix,n.call(this),r.className):e('<a href="%1$s%2$s">%2$s</a>',r.prefix,n.call(this))},mh.group=function(){var r=this.address.match(i.RE_ADDRESS),n;if(r){var s=r[0].split(".");this.address=this.address.replace(i.RE_ADDRESS,e('<span class="hover-group group-v4 group-6">%s</span>.<span class="hover-group group-v4 group-7">%s</span>',s.slice(0,2).join("."),s.slice(2,4).join(".")))}if(this.elidedGroups===0)return t.simpleGroup(this.address);var a=[],o=this.address.split("::");o[0].length?a.push(t.simpleGroup(o[0])):a.push("");var u=["hover-group"];for(n=this.elisionBegin;n<this.elisionBegin+this.elidedGroups;n++)u.push(e("group-%d",n));return a.push(e('<span class="%s"></span>',u.join(" "))),o[1].length?a.push(t.simpleGroup(o[1],this.elisionEnd)):a.push(""),a.join(":")},mh}var jl={},Kg;function dB(){if(Kg)return jl;Kg=1;var i=ko.sprintf,t=Mr;function e(a){return i("(%s)",a.join("|"))}function r(a){return a.length<4?i("0{0,%d}%s",4-a.length,a):a}function n(a){var o=[];a.forEach(function(d,m){var l=parseInt(d,16);l===0&&o.push(m)});var u=o.map(function(d){return a.map(function(m,l){if(l===d){var f=l===0||l===t.GROUPS-1?":":"";return e([r(m),f])}return r(m)}).join(":")});return u.push(a.map(r).join(":")),e(u)}function s(a,o,u){var d=o?"":":",m=u?"":":",l=[];!o&&!u&&l.push("::"),o&&u&&l.push(""),(u&&!o||!u&&o)&&l.push(":"),l.push(i("%s(:0{1,4}){1,%d}",d,a-1)),l.push(i("(0{1,4}:){1,%d}%s",a-1,m)),l.push(i("(0{1,4}:){%d}0{1,4}",a-1));for(var f=1;f<a-1;f++)for(var p=1;p<a-f;p++)l.push(i("(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}",p,a-p-f-1));return e(l)}return jl.regularExpressionString=function(a){a===void 0&&(a=!1);var o=[],u=new this.constructor(this.correctForm());if(u.elidedGroups===0)o.push(n(u.parsedAddress));else if(u.elidedGroups===t.GROUPS)o.push(s(t.GROUPS));else{var d=u.address.split("::");d[0].length&&o.push(n(d[0].split(":"))),o.push(s(u.elidedGroups,d[0].length!==0,d[1].length!==0)),d[1].length&&o.push(n(d[1].split(":"))),o=[o.join(":")]}return a||(o=[].concat("(?=^|\\b|[^\\w\\:])(",o,")(?=[^\\w\\:]|\\b|$)")),o.join("")},jl.regularExpression=function(a){return new RegExp(this.regularExpressionString(a),"i")},jl}var ar=Bf.exports.BigInteger,Qn=ko.sprintf,Tn=xc.exports,lf=xa,yi=Mr,xo=Xy;function fB(i){for(var t=/(\d+)(\d{3})/;t.test(i);)i=i.replace(t,"$1,$2");return i}function pB(i){return i=i.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2'),i=i.replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2'),i}function fe(i,t){t===void 0?this.groups=yi.GROUPS:this.groups=t,this.v4=!1,this.subnet="/128",this.subnetMask=128,this.zone="",this.address=i;var e=yi.RE_SUBNET_STRING.exec(i);if(e){if(this.parsedSubnet=e[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>yi.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}i=i.replace(yi.RE_SUBNET_STRING,"")}else if(/\//.test(i)){this.valid=!1,this.error="Invalid subnet mask.";return}var r=yi.RE_ZONE_STRING.exec(i);r&&(this.zone=r[0],i=i.replace(yi.RE_ZONE_STRING,"")),this.addressMinusSuffix=i,this.parsedAddress=this.parse(this.addressMinusSuffix)}Tn.merge(fe.prototype,lB());Tn.merge(fe.prototype,uB());Tn.merge(fe.prototype,dB());fe.fromBigInteger=function(i){var t=Tn.padStart(i.toString(16),32,"0"),e=[],r;for(r=0;r<yi.GROUPS;r++)e.push(t.slice(r*4,(r+1)*4));return new fe(e.join(":"))};fe.fromURL=function(i){var t,e,r;if(i.indexOf("[")!==-1&&i.indexOf("]:")!==-1){if(r=yi.RE_URL_WITH_PORT.exec(i),r===null)return{error:"failed to parse address with port",address:null,port:null};t=r[1],e=r[2]}else if(i.indexOf("/")!==-1){if(i=i.replace(/^[a-z0-9]+:\/\//,""),r=yi.RE_URL.exec(i),r===null)return{error:"failed to parse address from URL",address:null,port:null};t=r[1]}else t=i;return e?(e=parseInt(e,10),(e<0||e>65536)&&(e=null)):e=null,{address:new fe(t),port:e}};fe.fromAddress4=function(t){var t=new xo(t),e=yi.BITS-(lf.BITS-t.subnetMask);return new fe("::ffff:"+t.correctForm()+"/"+e)};fe.fromArpa=function(i){var t=i.replace(/(\.ip6\.arpa)?\.$/,""),e=7;if(t.length!==63)return t={error:"Not Valid 'ip6.arpa' form",address:null},t;t=t.split(".").reverse();for(var r=e;r>0;r--){var n=r*4;t.splice(n,0,":")}return t=t.join(""),new fe(t)};function mB(i,t){var e=[],r=[],n;for(n=0;n<i.length;n++)n<t[0]?e.push(i[n]):n>t[1]&&r.push(i[n]);return e.concat(["compact"]).concat(r)}fe.prototype.microsoftTranscription=function(){return Qn("%s.ipv6-literal.net",this.correctForm().replace(/:/g,"-"))};fe.prototype.mask=function(i){return i===void 0&&(i=this.subnetMask),this.getBitsBase2(0,i)};fe.prototype.possibleSubnets=function(i){i===void 0&&(i=128);var t=yi.BITS-this.subnetMask,e=Math.abs(i-yi.BITS),r=t-e;return r<0?"0":fB(new ar("2",10).pow(r).toString(10))};fe.prototype._startAddress=function(){return new ar(this.mask()+Tn.repeat("0",yi.BITS-this.subnetMask),2)};fe.prototype.startAddress=function(){return fe.fromBigInteger(this._startAddress())};fe.prototype.startAddressExclusive=function(){var i=new ar("1");return fe.fromBigInteger(this._startAddress().add(i))};fe.prototype._endAddress=function(){return new ar(this.mask()+Tn.repeat("1",yi.BITS-this.subnetMask),2)};fe.prototype.endAddress=function(){return fe.fromBigInteger(this._endAddress())};fe.prototype.endAddressExclusive=function(){var i=new ar("1");return fe.fromBigInteger(this._endAddress().subtract(i))};fe.prototype.getScope=function(){var i=yi.SCOPES[this.getBits(12,16)];return this.getType()==="Global unicast"&&i!=="Link local"&&(i="Global"),i};fe.prototype.getType=function(){var i=this;function t(e,r){return i.isInSubnet(new fe(r))}return Tn.find(yi.TYPES,t)||"Global unicast"};fe.prototype.getBits=function(i,t){return new ar(this.getBitsBase2(i,t),2)};fe.prototype.getBitsBase2=function(i,t){return this.binaryZeroPad().slice(i,t)};fe.prototype.getBitsBase16=function(i,t){var e=t-i;return e%4!==0?null:Tn.padStart(this.getBits(i,t).toString(16),e/4,"0")};fe.prototype.getBitsPastSubnet=function(){return this.getBitsBase2(this.subnetMask,yi.BITS)};fe.prototype.reverseForm=function(i){i||(i={});var t=Math.floor(this.subnetMask/4),e=this.canonicalForm().replace(/:/g,"").split("").slice(0,t).reverse().join(".");return t>0?i.omitSuffix?e:Qn("%s.ip6.arpa.",e):i.omitSuffix?"":"ip6.arpa."};fe.prototype.correctForm=function(){if(!this.parsedAddress)return null;var i,t=[],e=0,r=[];for(i=0;i<this.parsedAddress.length;i++){var n=parseInt(this.parsedAddress[i],16);n===0&&e++,n!==0&&e>0&&(e>1&&r.push([i-e,i-1]),e=0)}e>1&&r.push([this.parsedAddress.length-e,this.parsedAddress.length-1]);var s=r.map(function(u){return u[1]-u[0]+1});if(r.length>0){var a=s.indexOf(Tn.max(s));t=mB(this.parsedAddress,r[a])}else t=this.parsedAddress;for(i=0;i<t.length;i++)t[i]!=="compact"&&(t[i]=parseInt(t[i],16).toString(16));var o=t.join(":");return o=o.replace(/^compact$/,"::"),o=o.replace(/^compact|compact$/,":"),o=o.replace(/compact/,""),o};fe.prototype.binaryZeroPad=function(){return Tn.padStart(this.bigInteger().toString(2),yi.BITS,"0")};fe.prototype.parse4in6=function(i){var t=i.split(":"),e=t.slice(-1)[0],r=e.match(lf.RE_ADDRESS);if(r){for(var n=new xo(r[0]),s=0;s<n.groups;s++)if(/^0[0-9]+/.test(n.parsedAddress[s]))return this.valid=!1,this.error="IPv4 addresses can not have leading zeroes.",this.parseError=i.replace(lf.RE_ADDRESS,n.parsedAddress.map(pB).join(".")),null;this.v4=!0,t[t.length-1]=n.toGroup6(),i=t.join(":")}return i};fe.prototype.parse=function(i){if(i=this.parse4in6(i),this.error)return null;var t=i.match(yi.RE_BAD_CHARACTERS);if(t)return this.valid=!1,this.error=Qn("Bad character%s detected in address: %s",t.length>1?"s":"",t.join("")),this.parseError=i.replace(yi.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'),null;var e=i.match(yi.RE_BAD_ADDRESS);if(e)return this.valid=!1,this.error=Qn("Address failed regex: %s",e.join("")),this.parseError=i.replace(yi.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'),null;var r=[],n=i.split("::");if(n.length===2){var s=n[0].split(":"),a=n[1].split(":");s.length===1&&s[0]===""&&(s=[]),a.length===1&&a[0]===""&&(a=[]);var o=this.groups-(s.length+a.length);if(!o)return this.valid=!1,this.error="Error parsing groups",null;this.elidedGroups=o,this.elisionBegin=s.length,this.elisionEnd=s.length+this.elidedGroups,s.forEach(function(d){r.push(d)});for(var u=0;u<o;u++)r.push(0);a.forEach(function(d){r.push(d)})}else if(n.length===1)r=i.split(":"),this.elidedGroups=0;else return this.valid=!1,this.error="Too many :: groups found",null;return r=r.map(function(d){return Qn("%x",parseInt(d,16))}),r.length!==this.groups?(this.valid=!1,this.error="Incorrect number of groups found",null):(this.valid=!0,r)};function Ky(i){return Qn("%04x",parseInt(i,16))}fe.prototype.canonicalForm=function(){return this.valid?this.parsedAddress.map(Ky).join(":"):null};fe.prototype.decimal=function(){return this.valid?this.parsedAddress.map(function(i){return Qn("%05d",parseInt(i,16))}).join(":"):null};fe.prototype.bigInteger=function(){return this.valid?new ar(this.parsedAddress.map(Ky).join(""),16):null};fe.prototype.to4=function(){var i=this.binaryZeroPad().split("");return xo.fromHex(new ar(i.slice(96,128).join(""),2).toString(16))};fe.prototype.to4in6=function(){var i=this.to4(),t=new fe(this.parsedAddress.slice(0,6).join(":"),6),e=t.correctForm(),r="";return/:$/.test(e)||(r=":"),t.correctForm()+r+i.address};fe.prototype.inspectTeredo=function(){var i=this.getBitsBase16(0,32),t=this.getBits(80,96).xor(new ar("ffff",16)).toString(),e=xo.fromHex(this.getBitsBase16(32,64)),r=xo.fromHex(this.getBits(96,128).xor(new ar("ffffffff",16)).toString(16)),n=this.getBits(64,80),s=this.getBitsBase2(64,80),a=n.testBit(15),o=n.testBit(14),u=n.testBit(8),d=n.testBit(9),m=new ar(s.slice(2,6)+s.slice(8,16),2).toString(10);return{prefix:Qn("%s:%s",i.slice(0,4),i.slice(4,8)),server4:e.address,client4:r.address,flags:s,coneNat:a,microsoft:{reserved:o,universalLocal:d,groupIndividual:u,nonce:m},udpPort:t}};fe.prototype.inspect6to4=function(){var i=this.getBitsBase16(0,16),t=xo.fromHex(this.getBitsBase16(16,48));return{prefix:Qn("%s",i.slice(0,4)),gateway:t.address}};fe.prototype.to6to4=function(){if(!this.is4())return null;var i=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new fe(i)};fe.prototype.toByteArray=function(){var i=this.bigInteger().toByteArray();return i.length===17&&i[0]===0?i.slice(1):i};function qy(i){return i&255}fe.prototype.toUnsignedByteArray=function(){return this.toByteArray().map(qy)};fe.fromByteArray=function(i){return this.fromUnsignedByteArray(i.map(qy))};fe.fromUnsignedByteArray=function(i){for(var t=new ar("256",10),e=new ar("0",10),r=new ar("1",10),n=i.length-1;n>=0;n--)e=e.add(r.multiply(new ar(i[n].toString(10),10))),r=r.multiply(t);return fe.fromBigInteger(e)};var gB=fe;Gc.Address4=Xy;Gc.Address6=gB;Gc.v6={helpers:Ro};const{Buffer:Po}=Mf,zc=hB,$y=Gc.Address6,yB=Math.pow(2,32)-1,vB=85*85*85*85,_B=85*85*85,wB=85*85,bB=85,Zy="z85",ho=typeof window<"u"?window.BigInt:hi.BigInt,xB=[9,10,11,12,13,32],cf="<~",Qy="~>";function AB(i){return ho("0x"+Po.from(i).toString("hex"))}function EB(i,t){return new Array(1+i-t.length).join("0")+t}function Jy(i){const t=zc.ipv6.enc,e=[];for(let r=1;r<20;++r)e.push(t[Number(i%85n)]),i=i/85n;return e.push(t[Number(i)]),e.reverse().join("")}function TB(i){return i.length!==16?!1:Jy(AB(i))}function SB(i){const t=new $y(i);if(!t.isValid())return!1;const e=t.parsedAddress.map(function(n){return EB(4,n)}).join(""),r=ho(`0x${e}`);return Jy(r)}function tv(i){if(i.length!==20)return!1;const t=zc.ipv6.dec;let e=0;try{const r=i.split("").reduceRight(function(n,s){const a=ho(t[s.charCodeAt(0)]),o=ho(85)**ho(e++),u=a*o;return n+u},ho(0));return $y.fromBigInteger(r).correctForm()}catch{return!1}}function CB(i){return tv(i.toString())}function ev(i,t){if(t==="z85"&&i.length%4!==0)return!1;const e=zc[t].enc,r=i.length%4===0?0:4-i.length%4;let n="";for(let s=0;s<i.length;s+=4){let a=(i[s]<<24>>>0)+((s+1>i.length?0:i[s+1])<<16>>>0)+((s+2>i.length?0:i[s+2])<<8>>>0)+((s+3>i.length?0:i[s+3])<<0>>>0),o=[];for(let u=0;u<5;++u)o.unshift(e[a%85]),a=Math.floor(a/85);o=o.join(""),o==="!!!!!"&&t==="ascii85"&&(o="z"),n+=o}return(t==="ascii85"?cf:"")+n.substring(0,n.length-r)+(t==="ascii85"?Qy:"")}function MB(i,t){const e=Po.from(i,"utf8");return ev(e,t)}function iv(i,t){const e=zc[t].dec;let r=i.length;if(t==="ascii85"&&(r-=cf.length+Qy.length),t==="z85"&&r%5!==0)return!1;let n=r%5===0?0:5-r%5;const s=t==="ascii85"?cf.length:0,a=s+r,o=Po.alloc(4*Math.ceil((a-s)/5)),u=function(m){if(m<a)for(;xB.indexOf(i[m])!==-1;)n=(n+1)%5,m++;return m};let d=0;for(let m=s;m<a;){let l=0;const f=m;if(m=u(m),l=e[i[m]]*vB,m=u(m+1),l+=(m>=a?84:e[i[m]])*_B,m=u(m+1),l+=(m>=a?84:e[i[m]])*wB,m=u(m+1),l+=(m>=a?84:e[i[m]])*bB,m=u(m+1),l+=m>=a?84:e[i[m]],m=u(m+1),t==="z85"&&f+5!==m||l>yB||l<0)return!1;o.writeUInt32BE(l,d),d+=4}return o.slice(0,d-n)}function IB(i,t){t==="ascii85"&&(i=i.replace("z","!!!!!"));let e=Po.from(i,"utf8");return iv(e,t)}function BB(i,t){return t=t||Zy,["ascii85","z85","ipv6"].indexOf(t)===-1?!1:Po.isBuffer(i)?t==="ipv6"?TB(i):ev(i,t):typeof i=="string"?t==="ipv6"?SB(i):MB(i,t):!1}function kB(i,t){return t=t||Zy,["ascii85","z85","ipv6"].indexOf(t)===-1?!1:Po.isBuffer(i)?t==="ipv6"?CB(i):iv(i,t):typeof i=="string"?t==="ipv6"?tv(i):IB(i,t):!1}var rv={encode:BB,decode:kB},Wr="INUMBER",Do="IOP1",Lo="IOP2",Oo="IOP3",ts="IVAR",ya="IVARNAME",Ao="IFUNCALL",Vc="IFUNDEF",vr="IEXPR",kf="IEXPREVAL",Aa="IMEMBER",Xc="IENDSTATEMENT",Eo="IARRAY";function Ue(i,t){this.type=i,this.value=t??0}Ue.prototype.toString=function(){switch(this.type){case Wr:case Do:case Lo:case Oo:case ts:case ya:case Xc:return this.value;case Ao:return"CALL "+this.value;case Vc:return"DEF "+this.value;case Eo:return"ARRAY "+this.value;case Aa:return"."+this.value;default:return"Invalid Instruction"}};function jc(i){return new Ue(Do,i)}function ns(i){return new Ue(Lo,i)}function nv(i){return new Ue(Oo,i)}function uf(i,t,e,r,n){for(var s=[],a=[],o,u,d,m,l=0;l<i.length;l++){var f=i[l],p=f.type;if(p===Wr||p===ya)Array.isArray(f.value)?s.push.apply(s,uf(f.value.map(function(y){return new Ue(Wr,y)}).concat(new Ue(Eo,f.value.length)),t,e,r,n)):s.push(f);else if(p===ts&&n.hasOwnProperty(f.value))f=new Ue(Wr,n[f.value]),s.push(f);else if(p===Lo&&s.length>1)u=s.pop(),o=s.pop(),m=e[f.value],f=new Ue(Wr,m(o.value,u.value)),s.push(f);else if(p===Oo&&s.length>2)d=s.pop(),u=s.pop(),o=s.pop(),f.value==="?"?s.push(o.value?u.value:d.value):(m=r[f.value],f=new Ue(Wr,m(o.value,u.value,d.value)),s.push(f));else if(p===Do&&s.length>0)o=s.pop(),m=t[f.value],f=new Ue(Wr,m(o.value)),s.push(f);else if(p===vr){for(;s.length>0;)a.push(s.shift());a.push(new Ue(vr,uf(f.value,t,e,r,n)))}else if(p===Aa&&s.length>0)o=s.pop(),s.push(new Ue(Wr,o.value[f.value]));else{for(;s.length>0;)a.push(s.shift());a.push(f)}}for(;s.length>0;)a.push(s.shift());return a}function sv(i,t,e){for(var r=[],n=0;n<i.length;n++){var s=i[n],a=s.type;if(a===ts&&s.value===t)for(var o=0;o<e.tokens.length;o++){var u=e.tokens[o],d;u.type===Do?d=jc(u.value):u.type===Lo?d=ns(u.value):u.type===Oo?d=nv(u.value):d=new Ue(u.type,u.value),r.push(d)}else a===vr?r.push(new Ue(vr,sv(s.value,t,e))):r.push(s)}return r}function ha(i,t,e){var r=[],n,s,a,o,u,d;if(Rf(i))return zn(i,e);for(var m=i.length,l=0;l<m;l++){var f=i[l],p=f.type;if(p===Wr||p===ya)r.push(f.value);else if(p===Lo)s=r.pop(),n=r.pop(),f.value==="and"?r.push(n?!!ha(s,t,e):!1):f.value==="or"?r.push(n?!0:!!ha(s,t,e)):f.value==="="?(o=t.binaryOps[f.value],r.push(o(n,ha(s,t,e),e))):(o=t.binaryOps[f.value],r.push(o(zn(n,e),zn(s,e))));else if(p===Oo)a=r.pop(),s=r.pop(),n=r.pop(),f.value==="?"?r.push(ha(n?s:a,t,e)):(o=t.ternaryOps[f.value],r.push(o(zn(n,e),zn(s,e),zn(a,e))));else if(p===ts)if(f.value in t.functions)r.push(t.functions[f.value]);else if(f.value in t.unaryOps&&t.parser.isOperatorEnabled(f.value))r.push(t.unaryOps[f.value]);else{var y=e[f.value];if(y!==void 0)r.push(y);else throw new Error("undefined variable: "+f.value)}else if(p===Do)n=r.pop(),o=t.unaryOps[f.value],r.push(o(zn(n,e)));else if(p===Ao){for(d=f.value,u=[];d-- >0;)u.unshift(zn(r.pop(),e));if(o=r.pop(),o.apply&&o.call)r.push(o.apply(void 0,u));else throw new Error(o+" is not a function")}else if(p===Vc)r.push(function(){for(var v=r.pop(),_=[],w=f.value;w-- >0;)_.unshift(r.pop());var T=r.pop(),E=function(){for(var R=Object.assign({},e),H=0,Y=_.length;H<Y;H++)R[_[H]]=arguments[H];return ha(v,t,R)};return Object.defineProperty(E,"name",{value:T,writable:!1}),e[T]=E,E}());else if(p===vr)r.push(RB(f,t));else if(p===kf)r.push(f);else if(p===Aa)n=r.pop(),r.push(n[f.value]);else if(p===Xc)r.pop();else if(p===Eo){for(d=f.value,u=[];d-- >0;)u.unshift(r.pop());r.push(u)}else throw new Error("invalid Expression")}if(r.length>1)throw new Error("invalid Expression (parity)");return r[0]===0?0:zn(r[0],e)}function RB(i,t,e){return Rf(i)?i:{type:kf,value:function(r){return ha(i.value,t,r)}}}function Rf(i){return i&&i.type===kf}function zn(i,t){return Rf(i)?i.value(t):i}function Pf(i,t){for(var e=[],r,n,s,a,o,u,d=0;d<i.length;d++){var m=i[d],l=m.type;if(l===Wr)typeof m.value=="number"&&m.value<0?e.push("("+m.value+")"):Array.isArray(m.value)?e.push("["+m.value.map(qg).join(", ")+"]"):e.push(qg(m.value));else if(l===Lo)n=e.pop(),r=e.pop(),a=m.value,t?a==="^"?e.push("Math.pow("+r+", "+n+")"):a==="and"?e.push("(!!"+r+" && !!"+n+")"):a==="or"?e.push("(!!"+r+" || !!"+n+")"):a==="||"?e.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+r+"),("+n+")))"):a==="=="?e.push("("+r+" === "+n+")"):a==="!="?e.push("("+r+" !== "+n+")"):a==="["?e.push(r+"[("+n+") | 0]"):e.push("("+r+" "+a+" "+n+")"):a==="["?e.push(r+"["+n+"]"):e.push("("+r+" "+a+" "+n+")");else if(l===Oo)if(s=e.pop(),n=e.pop(),r=e.pop(),a=m.value,a==="?")e.push("("+r+" ? "+n+" : "+s+")");else throw new Error("invalid Expression");else if(l===ts||l===ya)e.push(m.value);else if(l===Do)r=e.pop(),a=m.value,a==="-"||a==="+"?e.push("("+a+r+")"):t?a==="not"?e.push("(!"+r+")"):a==="!"?e.push("fac("+r+")"):e.push(a+"("+r+")"):a==="!"?e.push("("+r+"!)"):e.push("("+a+" "+r+")");else if(l===Ao){for(u=m.value,o=[];u-- >0;)o.unshift(e.pop());a=e.pop(),e.push(a+"("+o.join(", ")+")")}else if(l===Vc){for(n=e.pop(),u=m.value,o=[];u-- >0;)o.unshift(e.pop());r=e.pop(),t?e.push("("+r+" = function("+o.join(", ")+") { return "+n+" })"):e.push("("+r+"("+o.join(", ")+") = "+n+")")}else if(l===Aa)r=e.pop(),e.push(r+"."+m.value);else if(l===Eo){for(u=m.value,o=[];u-- >0;)o.unshift(e.pop());e.push("["+o.join(", ")+"]")}else if(l===vr)e.push("("+Pf(m.value,t)+")");else if(l!==Xc)throw new Error("invalid Expression")}return e.length>1&&(t?e=[e.join(",")]:e=[e.join(";")]),String(e[0])}function qg(i){return typeof i=="string"?JSON.stringify(i).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):i}function lo(i,t){for(var e=0;e<i.length;e++)if(i[e]===t)return!0;return!1}function Df(i,t,e){e=e||{};for(var r=!!e.withMembers,n=null,s=0;s<i.length;s++){var a=i[s];a.type===ts||a.type===ya?!r&&!lo(t,a.value)?t.push(a.value):(n!==null&&(lo(t,n)||t.push(n)),n=a.value):a.type===Aa&&r&&n!==null?n+="."+a.value:a.type===vr?Df(a.value,t,e):n!==null&&(lo(t,n)||t.push(n),n=null)}n!==null&&!lo(t,n)&&t.push(n)}function sn(i,t){this.tokens=i,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}sn.prototype.simplify=function(i){return i=i||{},new sn(uf(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,i),this.parser)};sn.prototype.substitute=function(i,t){return t instanceof sn||(t=this.parser.parse(String(t))),new sn(sv(this.tokens,i,t),this.parser)};sn.prototype.evaluate=function(i){return i=i||{},ha(this.tokens,this,i)};sn.prototype.toString=function(){return Pf(this.tokens,!1)};sn.prototype.symbols=function(i){i=i||{};var t=[];return Df(this.tokens,t,i),t};sn.prototype.variables=function(i){i=i||{};var t=[];Df(this.tokens,t,i);var e=this.functions;return t.filter(function(r){return!(r in e)})};sn.prototype.toJSFunction=function(i,t){var e=this,r=new Function(i,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+Pf(this.simplify(t).tokens,!0)+"; }");return function(){return r.apply(e,arguments)}};var Bh="TEOF",ii="TOP",Yc="TNUMBER",av="TSTRING",es="TPAREN",To="TBRACKET",Kc="TCOMMA",Lf="TNAME",Of="TSEMICOLON";function ov(i,t,e){this.type=i,this.value=t,this.index=e}ov.prototype.toString=function(){return this.type+": "+this.value};function _i(i,t){this.pos=0,this.current=null,this.unaryOps=i.unaryOps,this.binaryOps=i.binaryOps,this.ternaryOps=i.ternaryOps,this.consts=i.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=i.options,this.parser=i}_i.prototype.newToken=function(i,t,e){return new ov(i,t,e??this.pos)};_i.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current};_i.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent};_i.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(Bh,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')};_i.prototype.isString=function(){var i=!1,t=this.pos,e=this.expression.charAt(t);if(e==="'"||e==='"')for(var r=this.expression.indexOf(e,t+1);r>=0&&this.pos<this.expression.length;){if(this.pos=r+1,this.expression.charAt(r-1)!=="\\"){var n=this.expression.substring(t+1,r);this.current=this.newToken(av,this.unescape(n),t),i=!0;break}r=this.expression.indexOf(e,r+1)}return i};_i.prototype.isParen=function(){var i=this.expression.charAt(this.pos);return i==="("||i===")"?(this.current=this.newToken(es,i),this.pos++,!0):!1};_i.prototype.isBracket=function(){var i=this.expression.charAt(this.pos);return(i==="["||i==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(To,i),this.pos++,!0):!1};_i.prototype.isComma=function(){var i=this.expression.charAt(this.pos);return i===","?(this.current=this.newToken(Kc,","),this.pos++,!0):!1};_i.prototype.isSemicolon=function(){var i=this.expression.charAt(this.pos);return i===";"?(this.current=this.newToken(Of,";"),this.pos++,!0):!1};_i.prototype.isConst=function(){for(var i=this.pos,t=i;t<this.expression.length;t++){var e=this.expression.charAt(t);if(e.toUpperCase()===e.toLowerCase()&&(t===this.pos||e!=="_"&&e!=="."&&(e<"0"||e>"9")))break}if(t>i){var r=this.expression.substring(i,t);if(r in this.consts)return this.current=this.newToken(Yc,this.consts[r]),this.pos+=r.length,!0}return!1};_i.prototype.isNamedOp=function(){for(var i=this.pos,t=i;t<this.expression.length;t++){var e=this.expression.charAt(t);if(e.toUpperCase()===e.toLowerCase()&&(t===this.pos||e!=="_"&&(e<"0"||e>"9")))break}if(t>i){var r=this.expression.substring(i,t);if(this.isOperatorEnabled(r)&&(r in this.binaryOps||r in this.unaryOps||r in this.ternaryOps))return this.current=this.newToken(ii,r),this.pos+=r.length,!0}return!1};_i.prototype.isName=function(){for(var i=this.pos,t=i,e=!1;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()){if(t===this.pos&&(r==="$"||r==="_")){r==="_"&&(e=!0);continue}else if(t===this.pos||!e||r!=="_"&&(r<"0"||r>"9"))break}else e=!0}if(e){var n=this.expression.substring(i,t);return this.current=this.newToken(Lf,n),this.pos+=n.length,!0}return!1};_i.prototype.isWhitespace=function(){for(var i=!1,t=this.expression.charAt(this.pos);(t===" "||t==="	"||t===`
`||t==="\r")&&(i=!0,this.pos++,!(this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return i};var PB=/^[0-9a-f]{4}$/i;_i.prototype.unescape=function(i){var t=i.indexOf("\\");if(t<0)return i;for(var e=i.substring(0,t);t>=0;){var r=i.charAt(++t);switch(r){case"'":e+="'";break;case'"':e+='"';break;case"\\":e+="\\";break;case"/":e+="/";break;case"b":e+="\b";break;case"f":e+="\f";break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"u":var n=i.substring(t+1,t+5);PB.test(n)||this.parseError("Illegal escape sequence: \\u"+n),e+=String.fromCharCode(parseInt(n,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+r+'"')}++t;var s=i.indexOf("\\",t);e+=i.substring(t,s<0?i.length:s),t=s}return e};_i.prototype.isComment=function(){var i=this.expression.charAt(this.pos);return i==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1};_i.prototype.isRadixInteger=function(){var i=this.pos;if(i>=this.expression.length-2||this.expression.charAt(i)!=="0")return!1;++i;var t,e;if(this.expression.charAt(i)==="x")t=16,e=/^[0-9a-f]$/i,++i;else if(this.expression.charAt(i)==="b")t=2,e=/^[01]$/i,++i;else return!1;for(var r=!1,n=i;i<this.expression.length;){var s=this.expression.charAt(i);if(e.test(s))i++,r=!0;else break}return r&&(this.current=this.newToken(Yc,parseInt(this.expression.substring(n,i),t)),this.pos=i),r};_i.prototype.isNumber=function(){for(var i=!1,t=this.pos,e=t,r=t,n=!1,s=!1,a;t<this.expression.length&&(a=this.expression.charAt(t),a>="0"&&a<="9"||!n&&a===".");)a==="."?n=!0:s=!0,t++,i=s;if(i&&(r=t),a==="e"||a==="E"){t++;for(var o=!0,u=!1;t<this.expression.length;){if(a=this.expression.charAt(t),o&&(a==="+"||a==="-"))o=!1;else if(a>="0"&&a<="9")u=!0,o=!1;else break;t++}u||(t=r)}return i?(this.current=this.newToken(Yc,parseFloat(this.expression.substring(e,t))),this.pos=t):this.pos=r,i};_i.prototype.isOperator=function(){var i=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(ii,t);else if(t==="\u2219"||t==="\u2022")this.current=this.newToken(ii,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(ii,">="),this.pos++):this.current=this.newToken(ii,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(ii,"<="),this.pos++):this.current=this.newToken(ii,"<");else if(t==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(ii,"||"),this.pos++;else return!1;else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(ii,"=="),this.pos++):this.current=this.newToken(ii,t);else if(t==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(ii,"!="),this.pos++):this.current=this.newToken(ii,t);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=i,!1)};_i.prototype.isOperatorEnabled=function(i){return this.parser.isOperatorEnabled(i)};_i.prototype.getCoordinates=function(){var i=0,t,e=-1;do i++,t=this.pos-e,e=this.expression.indexOf(`
`,e+1);while(e>=0&&e<this.pos);return{line:i,column:t}};_i.prototype.parseError=function(i){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+i)};function ni(i,t,e){this.parser=i,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=e.allowMemberAccess!==!1}ni.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()};ni.prototype.tokenMatches=function(i,t){return typeof t>"u"?!0:Array.isArray(t)?lo(t,i.value):typeof t=="function"?t(i):i.value===t};ni.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()};ni.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken};ni.prototype.accept=function(i,t){return this.nextToken.type===i&&this.tokenMatches(this.nextToken,t)?(this.next(),!0):!1};ni.prototype.expect=function(i,t){if(!this.accept(i,t)){var e=this.tokens.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: Expected "+(t||i))}};ni.prototype.parseAtom=function(i){var t=this.tokens.unaryOps;function e(n){return n.value in t}if(this.accept(Lf)||this.accept(ii,e))i.push(new Ue(ts,this.current.value));else if(this.accept(Yc))i.push(new Ue(Wr,this.current.value));else if(this.accept(av))i.push(new Ue(Wr,this.current.value));else if(this.accept(es,"("))this.parseExpression(i),this.expect(es,")");else if(this.accept(To,"["))if(this.accept(To,"]"))i.push(new Ue(Eo,0));else{var r=this.parseArrayList(i);i.push(new Ue(Eo,r))}else throw new Error("unexpected "+this.nextToken)};ni.prototype.parseExpression=function(i){var t=[];this.parseUntilEndStatement(i,t)||(this.parseVariableAssignmentExpression(t),!this.parseUntilEndStatement(i,t)&&this.pushExpression(i,t))};ni.prototype.pushExpression=function(i,t){for(var e=0,r=t.length;e<r;e++)i.push(t[e])};ni.prototype.parseUntilEndStatement=function(i,t){return this.accept(Of)?(this.nextToken&&this.nextToken.type!==Bh&&!(this.nextToken.type===es&&this.nextToken.value===")")&&t.push(new Ue(Xc)),this.nextToken.type!==Bh&&this.parseExpression(t),i.push(new Ue(vr,t)),!0):!1};ni.prototype.parseArrayList=function(i){for(var t=0;!this.accept(To,"]");)for(this.parseExpression(i),++t;this.accept(Kc);)this.parseExpression(i),++t;return t};ni.prototype.parseVariableAssignmentExpression=function(i){for(this.parseConditionalExpression(i);this.accept(ii,"=");){var t=i.pop(),e=[],r=i.length-1;if(t.type===Ao){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var n=0,s=t.value+1;n<s;n++){var a=r-n;i[a].type===ts&&(i[a]=new Ue(ya,i[a].value))}this.parseVariableAssignmentExpression(e),i.push(new Ue(vr,e)),i.push(new Ue(Vc,t.value));continue}if(t.type!==ts&&t.type!==Aa)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(e),i.push(new Ue(ya,t.value)),i.push(new Ue(vr,e)),i.push(ns("="))}};ni.prototype.parseConditionalExpression=function(i){for(this.parseOrExpression(i);this.accept(ii,"?");){var t=[],e=[];this.parseConditionalExpression(t),this.expect(ii,":"),this.parseConditionalExpression(e),i.push(new Ue(vr,t)),i.push(new Ue(vr,e)),i.push(nv("?"))}};ni.prototype.parseOrExpression=function(i){for(this.parseAndExpression(i);this.accept(ii,"or");){var t=[];this.parseAndExpression(t),i.push(new Ue(vr,t)),i.push(ns("or"))}};ni.prototype.parseAndExpression=function(i){for(this.parseComparison(i);this.accept(ii,"and");){var t=[];this.parseComparison(t),i.push(new Ue(vr,t)),i.push(ns("and"))}};var DB=["==","!=","<","<=",">=",">","in"];ni.prototype.parseComparison=function(i){for(this.parseAddSub(i);this.accept(ii,DB);){var t=this.current;this.parseAddSub(i),i.push(ns(t.value))}};var LB=["+","-","||"];ni.prototype.parseAddSub=function(i){for(this.parseTerm(i);this.accept(ii,LB);){var t=this.current;this.parseTerm(i),i.push(ns(t.value))}};var OB=["*","/","%"];ni.prototype.parseTerm=function(i){for(this.parseFactor(i);this.accept(ii,OB);){var t=this.current;this.parseFactor(i),i.push(ns(t.value))}};ni.prototype.parseFactor=function(i){var t=this.tokens.unaryOps;function e(n){return n.value in t}if(this.save(),this.accept(ii,e)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===es&&this.nextToken.value==="("){this.restore(),this.parseExponential(i);return}else if(this.nextToken.type===Of||this.nextToken.type===Kc||this.nextToken.type===Bh||this.nextToken.type===es&&this.nextToken.value===")"){this.restore(),this.parseAtom(i);return}}var r=this.current;this.parseFactor(i),i.push(jc(r.value))}else this.parseExponential(i)};ni.prototype.parseExponential=function(i){for(this.parsePostfixExpression(i);this.accept(ii,"^");)this.parseFactor(i),i.push(ns("^"))};ni.prototype.parsePostfixExpression=function(i){for(this.parseFunctionCall(i);this.accept(ii,"!");)i.push(jc("!"))};ni.prototype.parseFunctionCall=function(i){var t=this.tokens.unaryOps;function e(s){return s.value in t}if(this.accept(ii,e)){var r=this.current;this.parseAtom(i),i.push(jc(r.value))}else for(this.parseMemberExpression(i);this.accept(es,"(");)if(this.accept(es,")"))i.push(new Ue(Ao,0));else{var n=this.parseArgumentList(i);i.push(new Ue(Ao,n))}};ni.prototype.parseArgumentList=function(i){for(var t=0;!this.accept(es,")");)for(this.parseExpression(i),++t;this.accept(Kc);)this.parseExpression(i),++t;return t};ni.prototype.parseMemberExpression=function(i){for(this.parseAtom(i);this.accept(ii,".")||this.accept(To,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(Lf),i.push(new Ue(Aa,this.current.value))}else if(t.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(i),this.expect(To,"]"),i.push(ns("["))}else throw new Error("unexpected symbol: "+t.value)}};function FB(i,t){return Number(i)+Number(t)}function NB(i,t){return i-t}function UB(i,t){return i*t}function HB(i,t){return i/t}function GB(i,t){return i%t}function WB(i,t){return Array.isArray(i)&&Array.isArray(t)?i.concat(t):""+i+t}function zB(i,t){return i===t}function VB(i,t){return i!==t}function XB(i,t){return i>t}function jB(i,t){return i<t}function YB(i,t){return i>=t}function KB(i,t){return i<=t}function qB(i,t){return Boolean(i&&t)}function $B(i,t){return Boolean(i||t)}function ZB(i,t){return lo(t,i)}function QB(i){return(Math.exp(i)-Math.exp(-i))/2}function JB(i){return(Math.exp(i)+Math.exp(-i))/2}function tk(i){return i===1/0?1:i===-1/0?-1:(Math.exp(i)-Math.exp(-i))/(Math.exp(i)+Math.exp(-i))}function ek(i){return i===-1/0?i:Math.log(i+Math.sqrt(i*i+1))}function ik(i){return Math.log(i+Math.sqrt(i*i-1))}function rk(i){return Math.log((1+i)/(1-i))/2}function $g(i){return Math.log(i)*Math.LOG10E}function nk(i){return-i}function sk(i){return!i}function ak(i){return i<0?Math.ceil(i):Math.floor(i)}function ok(i){return Math.random()*(i||1)}function Zg(i){return Ff(i+1)}function hk(i){return isFinite(i)&&i===Math.round(i)}var lk=4.7421875,Md=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function Ff(i){var t,e;if(hk(i)){if(i<=0)return isFinite(i)?1/0:NaN;if(i>171)return 1/0;for(var r=i-2,n=i-1;r>1;)n*=r,r--;return n===0&&(n=1),n}if(i<.5)return Math.PI/(Math.sin(Math.PI*i)*Ff(1-i));if(i>=171.35)return 1/0;if(i>85){var s=i*i,a=s*i,o=a*i,u=o*i;return Math.sqrt(2*Math.PI/i)*Math.pow(i/Math.E,i)*(1+1/(12*i)+1/(288*s)-139/(51840*a)-571/(2488320*o)+163879/(209018880*u)+5246819/(75246796800*u*i))}--i,e=Md[0];for(var d=1;d<Md.length;++d)e+=Md[d]/(i+d);return t=i+lk+.5,Math.sqrt(2*Math.PI)*Math.pow(t,i+.5)*Math.exp(-t)*e}function ck(i){return Array.isArray(i)?i.length:String(i).length}function Qg(){for(var i=0,t=0,e=0;e<arguments.length;e++){var r=Math.abs(arguments[e]),n;t<r?(n=t/r,i=i*n*n+1,t=r):r>0?(n=r/t,i+=n*n):i+=r}return t===1/0?1/0:t*Math.sqrt(i)}function Jg(i,t,e){return i?t:e}function uk(i,t){return typeof t>"u"||+t==0?Math.round(i):(i=+i,t=-+t,isNaN(i)||!(typeof t=="number"&&t%1===0)?NaN:(i=i.toString().split("e"),i=Math.round(+(i[0]+"e"+(i[1]?+i[1]-t:-t))),i=i.toString().split("e"),+(i[0]+"e"+(i[1]?+i[1]+t:t))))}function dk(i,t,e){return e&&(e[i]=t),t}function fk(i,t){return i[t|0]}function pk(i){return arguments.length===1&&Array.isArray(i)?Math.max.apply(Math,i):Math.max.apply(Math,arguments)}function mk(i){return arguments.length===1&&Array.isArray(i)?Math.min.apply(Math,i):Math.min.apply(Math,arguments)}function gk(i,t){if(typeof i!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(e,r){return i(e,r)})}function yk(i,t,e){if(typeof i!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(e))throw new Error("Second argument to fold is not an array");return e.reduce(function(r,n,s){return i(r,n,s)},t)}function vk(i,t){if(typeof i!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(e,r){return i(e,r)})}function _k(i,t){if(!(Array.isArray(t)||typeof t=="string"))throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(i)}function wk(i,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(i)}function bk(i){return(i>0)-(i<0)||+i}var t0=1/3;function xk(i){return i<0?-Math.pow(-i,t0):Math.pow(i,t0)}function Ak(i){return Math.exp(i)-1}function Ek(i){return Math.log(1+i)}function Tk(i){return Math.log(i)/Math.LN2}function Os(i){this.options=i||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||QB,cosh:Math.cosh||JB,tanh:Math.tanh||tk,asinh:Math.asinh||ek,acosh:Math.acosh||ik,atanh:Math.atanh||rk,sqrt:Math.sqrt,cbrt:Math.cbrt||xk,log:Math.log,log2:Math.log2||Tk,ln:Math.log,lg:Math.log10||$g,log10:Math.log10||$g,expm1:Math.expm1||Ak,log1p:Math.log1p||Ek,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||ak,"-":nk,"+":Number,exp:Math.exp,not:sk,length:ck,"!":Zg,sign:Math.sign||bk},this.binaryOps={"+":FB,"-":NB,"*":UB,"/":HB,"%":GB,"^":Math.pow,"||":WB,"==":zB,"!=":VB,">":XB,"<":jB,">=":YB,"<=":KB,and:qB,or:$B,in:ZB,"=":dk,"[":fk},this.ternaryOps={"?":Jg},this.functions={random:ok,fac:Zg,min:mk,max:pk,hypot:Math.hypot||Qg,pyt:Math.hypot||Qg,pow:Math.pow,atan2:Math.atan2,if:Jg,gamma:Ff,roundTo:uk,map:gk,fold:yk,filter:vk,indexOf:_k,join:wk},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}Os.prototype.parse=function(i){var t=[],e=new ni(this,new _i(this,i),{allowMemberAccess:this.options.allowMemberAccess});return e.parseExpression(t),e.expect(Bh,"EOF"),new sn(t,this)};Os.prototype.evaluate=function(i,t){return this.parse(i).evaluate(t)};var hv=new Os;Os.parse=function(i){return hv.parse(i)};Os.evaluate=function(i,t){return hv.parse(i).evaluate(t)};var e0={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function Sk(i){return e0.hasOwnProperty(i)?e0[i]:i}Os.prototype.isOperatorEnabled=function(i){var t=Sk(i),e=this.options.operators||{};return!(t in e)||!!e[t]};const cc=[1,1/2,1/3,1/4,1/6,1/8,1/12,1/16,1/24,1/48];function Nf(i){for(let t=0;t<cc.length;t++)if(Math.abs(i-Math.round(i/cc[t])*cc[t])<.01)return t;return 9}function i0(i){return 4/cc[Nf(i)]}function co(i,t,e){return i*(1-e)+t*e}function Ja(i,t,e){return(e-i)/(t-i)}function Ec(i,t,e){return(i<<16)+(t<<8)+e}function Ck(i,t){let e=i>>16,r=i>>8&255,n=i&255;return e=or(e*t,0,255),r=or(r*t,0,255),n=or(n*t,0,255),Ec(e,r,n)}function he(i,t){return Math.round(i*Math.pow(10,t))/Math.pow(10,t)}function or(i,t,e){return Math.max(t,Math.min(e,i))}function lv(){const{userAgent:i}=navigator;let t=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],e;if(/trident/i.test(t[1]))return e=/\brv[ :]+(\d+)/g.exec(i)||[],`IE ${e[1]||""}`;if(t[1]==="Chrome"){if(e=i.match(/\b(OPR|Edge)\/(\d+)/),e!==null)return e.slice(1).join(" ").replace("OPR","Opera");if(e=i.match(/\b(Edg)\/(\d+)/),e!==null)return e.slice(1).join(" ").replace("Edg","Edge (Chromium)")}return t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],e=i.match(/version\/(\d+)/i),e!==null&&t.splice(1,1,e[1]),t.join(" ")}function Jr(i,t,e){if(e=e??(s=>s),i.length==0)return-1;if(t>=e(i[i.length-1])){let s=i.length-1;for(;s>0&&e(i[s-1])==t;)s--;return s}let r=0,n=i.length;for(;r<=n&&r<i.length;){let s=r+n>>>1;if(e(i[s])==t){for(;s>0&&e(i[s-1])==t;)s--;return s}e(i[s])<t&&(r=s+1),e(i[s])>t&&(n=s-1)}return Math.max(0,n)}function Tc(i){try{return Os.evaluate(i)}catch{return 0}}function Ci(i,t){let e=i.length;if(i.length!=0)for(;e--;)t(i[e],e)&&i[e].destroy()}function cv(i){if(i.length==0)return 0;const t=i.length,e=i.reduce((r,n)=>r+n)/t;return Math.sqrt(i.map(r=>Math.pow(r-e,2)).reduce((r,n)=>r+n)/t)}function Uf(i){if(i.length==0)return 0;i=[...i],i.sort((e,r)=>e-r);const t=Math.floor(i.length/2);return i.length%2?i[t]:(i[t-1]+i[t])/2}function Mk(i){return i.length==0?0:i.reduce((t,e)=>t+e)/i.length}function Hf(i){return i==""?"":i.slice(0,1).toUpperCase()+i.slice(1).toLowerCase()}function uv(i,t){return t?uv(t,i%t):t===0?i:NaN}function dv(i,t){return i*t/uv(i,t)}function r0(i){let t=1;for(let e=0;e<i.length;++e)t=dv(i[e],t);return t}function Ik(i){return i instanceof Error?i.message:String(i)}function uo(i){return!(!["Backspace","Tab","Escape","Enter","1","2","3","4","5","6","7","8","9","0","+","-","*","/",".","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Delete","x","c","a","A","C","X"].includes(i.key)||["X","C","A","a","c","x"].includes(i.key)&&!i.metaKey&&!i.ctrlKey)}function Ss(i,t){let e=Gf(i)[2];return t&&e.slice(-1*t.length)===t&&(e=e.slice(0,e.length-t.length)),e}function Gr(i){const t=Gf(i),e=t[0];let r=t[1];return!e&&!r?"":(r&&(r=r.slice(0,r.length-1)),e+r)}function wn(i){return Gf(i)[3]}const Bk=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^/]+?|)(\.[^./]*|))(?:[/]*)$/;function Gf(i){return Bk.exec(i).slice(1)}function Yl(i){let t=0,e=0,r=129;for(;(r&128)!=0;){const n=i.shift();if(!n)break;t=t|(n&127)<<7*e++,r=n}return t}function Kl(i){const t=[];let e=!1;for(;!e;){let r=i&127;i=i>>7,e=i==0,e||(r=r|128),t.push(r)}return t}function n0(i){if(i.startsWith("ArrowVortex:notes:")){const t=rv.decode("<~"+i.slice(18)+"~>","ascii85");if(t!==!1){const e=[...new Uint8Array(t.buffer)],r=(4-e.length%4)%4;if(e.push(...new Array(r).fill(0)),e.shift()!=0)return;const n=Yl(e),s=[];for(let a=0;a<n;a++){const o=e.shift();if(o==null)return;const u=o&127;if((o&128)!=0){const d=Yl(e),m=Yl(e),l=e.shift();if(l==null||l>4)continue;const f=["Hold","Mine","Roll","Lift","Fake"][l];if(d==m){if(f=="Hold"||f=="Roll")continue;s.push({type:f,beat:d/48,col:u})}else{if(f=="Mine"||f=="Fake"||f=="Lift")continue;s.push({type:f,beat:d/48,hold:(m-d)/48,col:u})}}else s.push({type:"Tap",beat:Yl(e)/48,col:u})}return s}}}function kk(i){const t=[0];t.push(...Kl(i.length));for(const e of i)if(e.type=="Tap"){const r=Math.round(e.beat*48);t.push(e.col),t.push(...Kl(r))}else{t.push(e.col+128);const r=Math.round(e.beat*48);let n=0;De(e)&&(n=e.hold);const s=Math.round(n*48)+r;t.push(...Kl(r)),t.push(...Kl(s)),t.push(["Hold","Mine","Roll","Lift","Fake"].indexOf(e.type))}return"ArrowVortex:notes:"+rv.encode(Mf.Buffer.from(t),"ascii85").slice(2,-2)}const Cc=class{static get view(){return this._view||(this._view=document.getElementById("waterfall")),this._view}static create(t){let e=1;if(this.messages[t]&&this.messages[t].type==""){const n=this.messages[t];clearTimeout(n.timeoutID),e=++n.count,this.view.removeChild(n.container)}const r=document.createElement("div");r.innerHTML=t,e>1&&(r.innerHTML+=` (${e})`),r.classList.add("waterfall-item"),Cc.messages[t]={type:"",container:r,timeoutID:setTimeout(()=>{r.classList.add("waterfall-exiting"),setTimeout(()=>{delete this.messages[t],this.view.removeChild(r)},500)},5e3),count:e},this.view.appendChild(r)}static createFormatted(t,e){let r=1;if(this.messages[t]&&this.messages[t].type==e){const s=this.messages[t];clearTimeout(s.timeoutID),r=++s.count,this.view.removeChild(s.container)}const n=document.createElement("div");n.innerHTML=`<div class='waterfall-${e}'>${Hf(e)}: </div>`+t,r>1&&(n.innerHTML+=` (${r})`),n.classList.add("waterfall-item"),console[e](t),Cc.messages[t]={type:e,container:n,timeoutID:setTimeout(()=>{n.classList.add("waterfall-exiting"),setTimeout(()=>{delete this.messages[t],this.view.removeChild(n)},500)},5e3),count:r},this.view.appendChild(n)}};let Fe=Cc;P(Fe,"_view"),P(Fe,"messages",{});class fv{constructor(){P(this,"cols",[])}keyDown(t){this.cols[t]=(this.cols[t]??0)+1}keyUp(t){this.cols[t]=(this.cols[t]??1)-1,this.cols[t]=Math.max(this.cols[t],0)}isPressed(t){return!!this.cols[t]}getHeldCols(){return this.cols.map((t,e)=>e).filter(t=>this.isPressed(t))}reset(){this.cols=[]}}const s0=["audio.rate","chart.snap","chart.CMod","play.timingCollection"],Rk=[];class mn{}P(mn,"general",{scrollSensitivity:1,mousePlacement:!1,smoothAnimations:!0,warnBeforeExit:!0}),P(mn,"chart",{CMod:!1,reverse:!1,zoom:1,speed:250,snap:1,hideWarpedArrows:!1,doSpeedChanges:!0,drawNoteFlash:!0,receptorYPos:-200,maxDrawBeats:20,maxDrawBeatsBack:10,waveform:{enabled:!0,color:6316402,opacity:.5,lineHeight:1},timingEventOrder:{left:["LABELS","FAKES","TIMESIGNATURES","DELAYS","WARPS","STOPS","BPMS"],right:["SPEEDS","SCROLLS","TICKCOUNTS","COMBOS","ATTACKS","BGCHANGES","FGCHANGES"]},renderTimingEvent:{BPMS:!0,STOPS:!0,DELAYS:!0,WARPS:!0,FAKES:!0,COMBOS:!0,SPEEDS:!0,LABELS:!0,SCROLLS:!0,TIMESIGNATURES:!0,TICKCOUNTS:!0,BGCHANGES:!0,FGCHANGES:!0,ATTACKS:!0}}),P(mn,"audio",{assistTick:!1,metronome:!1,rate:1,songVolume:.2,soundEffectVolume:.5,effectOffset:0}),P(mn,"play",{offset:0,visualOffset:0,hideBarlines:!1,judgmentTilt:!0,timingCollection:"ITG",timingWindowScale:1,timingWindowAdd:0,defaultTimingCollection:{"dance-single":"ITG","dance-double":"ITG","dance-3panel":"ITG","dance-solo":"ITG","dance-solodouble":"ITG"}}),P(mn,"performance",{antialiasing:!1,resolution:window.devicePixelRatio}),P(mn,"debug",{renderingStats:!1,showTimers:!1}),P(mn,"experimental",{speedChangeWaveform:!0});class W extends mn{static extractOptions(t,e){return Object.entries(t).reduce((r,n)=>{const s=e?e+".":"";return typeof n[1]=="object"?r=r.concat(this.extractOptions(n[1],s+n[0])):(n[0]=s+n[0],r.push([n[0],n[1]])),r},[])}static applyOption(t){if(typeof this.getDefaultOption(t[0])!=typeof t[1])return console.warn("Couldn't load option "+t[0]+": the value "+t[1]+" ("+typeof t[1]+")  does not match the type "+typeof this.getDefaultOption(t[0]));const e=t[0].split("."),r=e.pop();let n=this;for(const s of e)if(s in n)n=n[s];else return console.warn("Couldn't load option "+t[0]+": the id doesn't exist");n[r]=t[1]}static getDefaultOption(t){const e=t.split(".");let r=mn;for(const n of e)if(n in r)r=r[n];else return;if(!(typeof r!="string"&&typeof r!="number"&&typeof r!="boolean"))return r}static getOption(t){const e=t.split(".");let r=this;for(const n of e)if(n in r)r=r[n];else return;if(!(typeof r!="string"&&typeof r!="number"&&typeof r!="boolean"))return r}static saveOptions(){const t={};for(const e of this.extractOptions(this)){if(s0.includes(e[0]))continue;const r=this.getDefaultOption(e[0]);if(r==null){console.warn("Couldn't save option "+e[0]+": the id doesn't exist");continue}typeof r!=typeof e[1]?(console.warn("Couldn't save option "+e[0]+": the value "+e[1]+" does not match the type "+typeof this.getDefaultOption(e[0])),t[e[0]]=r):t[e[0]]=e[1]}localStorage.setItem("options",JSON.stringify(t))}static loadOptions(){const t=localStorage.getItem("options");if(!t)return;const e=JSON.parse(t);if(typeof e!="object")return console.error("Couldn't load options from storage");for(const r of Object.entries(e))s0.includes(r[0])||this.applyOption(r)}static clearSave(){localStorage.removeItem("options")}}const pv={};for(const i of Object.entries(mn))pv[i[0]]=JSON.parse(JSON.stringify(i[1]));Object.assign(W,pv);const Mc=class{constructor(t,e){P(this,"tHeight",0);P(this,"tWidth",0);P(this,"texture");P(this,"judgeNames",[]);this.judgeNames=e,this.loadTex(t)}async loadTex(t){const e=await oo.load(t);this.texture=e,this.tHeight=e.height,this.tWidth=e.width}getTexture(t,e){if(!this.judgeNames.includes(e.id))return;let r=0;const n=this.judgeNames.indexOf(e.id)*this.tHeight/this.judgeNames.length;return t>=0&&(r+=this.tWidth/2),this.texture.frame=new Te(r,n,this.tWidth/2,this.tHeight/this.judgeNames.length),this.texture}};let ri=Mc;P(ri,"ITG",new Mc("assets/judgment/judgmentITG.png",["w0","w1","w2","w3","w4","w5","miss"])),P(ri,"WATERFALL",new Mc("assets/judgment/judgmentWaterfall.png",["w0","w1","w2","w3","w4","w5","miss"]));class qc{constructor(t,e,r){P(this,"timingWindowMS");P(this,"dancePoints");P(this,"lifeChange");this.timingWindowMS=t,this.dancePoints=e,this.lifeChange=r}getTimingWindowMS(){return this.timingWindowMS*W.play.timingWindowScale+W.play.timingWindowAdd}}class ql extends qc{constructor(e,r){super(0,e,r);P(this,"target","dropped")}}class oa extends qc{constructor(e,r,n,s){super(r,n,s);P(this,"noteType");this.noteType=e}}new oa("Hold",0,0,0);class $l extends qc{constructor(e,r,n){super(e,r,n);P(this,"target","mine")}}class Hi extends qc{constructor(e,r,n,s,a,o,u){super(s,a,o);P(this,"id");P(this,"name");P(this,"color");P(this,"judgmentTexture");this.id=e,this.name=r,this.color=n,this.judgmentTexture=u}}const mv=new Hi("w0","Fantastic",183528,0,0,0,ri.ITG);class Zl extends Hi{constructor(t,e,r,n,s){super("miss",t,e,0,r,n,s)}}function va(i){return i.color!=null&&i.id!="miss"}function Jn(i){return i.color!=null&&i.id=="miss"}function ks(i){return!!i.noteType}function So(i){return i.target=="dropped"}function fa(i){return i.target=="mine"}const fo=class{constructor(t,e){P(this,"windows",[]);P(this,"holdWindows",{});P(this,"missWindow");P(this,"droppedWindow");P(this,"mineWindow");P(this,"hideLimitMS");this.missWindow=new Zl("Miss",16724016,-12,-.1,ri.ITG),this.droppedWindow=new ql(0,-.08),this.mineWindow=new $l(71.5,-1,-.05);for(const r of t)va(r)?this.windows.push(r):Jn(r)?this.missWindow=r:ks(r)?this.holdWindows[r.noteType]=r:So(r)?this.droppedWindow=r:fa(r)&&(this.mineWindow=r);this.windows.sort((r,n)=>r.timingWindowMS-n.timingWindowMS),this.hideLimitMS=e}judgeInput(t){for(const e of this.windows)if(e.getTimingWindowMS()/1e3>=Math.abs(t))return e;return this.missWindow}getHeldJudgement(t){return this.holdWindows[t.type]}getMissJudgment(){return this.missWindow}getDroppedJudgment(){return this.droppedWindow}getMineJudgment(){return this.mineWindow}shouldHideNote(t){return t.id!="miss"&&t.timingWindowMS<=this.hideLimitMS}maxWindowMS(){return this.windows.at(-1)?.getTimingWindowMS()??0}getMaxDancePoints(){return Math.max(...this.windows.map(t=>t.dancePoints),this.missWindow.dancePoints)}getMaxHoldDancePoints(t){return Math.max(this.holdWindows[t].dancePoints??0,this.droppedWindow.dancePoints)}getStandardWindows(){return[...this.windows]}getHoldWindows(){return[...Object.values(this.holdWindows)]}static getCollection(t){return this.COLLECTIONS[t]??this.COLLECTIONS.ITG}static getCollections(){return fo.COLLECTIONS}};let di=fo;P(di,"COLLECTIONS",{ITG:new fo([new Hi("w0","Fantastic",2215144,23,5,.008,ri.ITG),new Hi("w2","Excellent",14851096,44.5,4,.008,ri.ITG),new Hi("w3","Great",6736213,103.5,2,.004,ri.ITG),new Hi("w4","Decent",11820287,136.5,0,0,ri.ITG),new Hi("w5","Way Off",13206878,181.5,-6,-.05,ri.ITG),new Zl("Miss",16724016,-12,-.1,ri.ITG),new oa("Hold",321.5,5,-.008),new oa("Roll",351.5,5,-.008),new ql(0,-.08),new $l(71.5,-6,-.05)],103.5),FA:new fo([new Hi("w0","Fantastic",2215144,15,3.5,.008,ri.ITG),new Hi("w1","Fantastic",16777215,23,3,.008,ri.ITG),new Hi("w2","Excellent",14851096,44.5,2,.008,ri.ITG),new Hi("w3","Great",6736213,103.5,1,.004,ri.ITG),new Hi("w4","Decent",11820287,136.5,0,0,ri.ITG),new Hi("w5","Way Off",13206878,181.5,0,-.05,ri.ITG),new Zl("Miss",16724016,0,-.1,ri.ITG),new oa("Hold",321.5,1,-.008),new oa("Roll",351.5,1,-.008),new ql(0,-.08),new $l(71.5,-1,-.05)],103.5),WATERFALL:new fo([new Hi("w0","Masterful",16711870,15,10,.008,ri.WATERFALL),new Hi("w2","Awesome",16776960,30,9,.008,ri.WATERFALL),new Hi("w3","Solid",51200,50,6,.008,ri.WATERFALL),new Hi("w4","OK",33023,100,3,.004,ri.WATERFALL),new Hi("w5","Fault",8421504,160,0,0,ri.WATERFALL),new Zl("Miss",16724016,0,-.1,ri.WATERFALL),new oa("Hold",300,6,-.008),new oa("Roll",350,6,-.008),new ql(0,-.08),new $l(71.5,-3,-.05)],100)});class Pk{}class Fo extends Pk{constructor(){super(...arguments);P(this,"chordCohesion",new Map);P(this,"missNoteIndex",0);P(this,"holdProgress",[]);P(this,"heldCols",new fv);P(this,"collection",di.getCollection("ITG"))}update(e){if(!e.loadedChart||!e.chartView)return;const n=e.chartView.getTimeWithOffset()-this.collection.maxWindowMS()/1e3*W.audio.rate;let s=-1;for(;e.loadedChart.getNotedata()[this.missNoteIndex]&&e.loadedChart.getNotedata()[this.missNoteIndex].second<n;){const a=e.loadedChart.getNotedata()[this.missNoteIndex];if(a.beat!=s&&a.type!="Mine"&&!a.fake&&!a.gameplay.hasHit){s=a.beat,e.chartView.doJudgment(a,0,this.collection.getMissJudgment());const o=this.chordCohesion.get(a.beat);e.gameStats?.addDataPoint(o,this.collection.getMissJudgment(),0)}this.missNoteIndex++}for(const a of this.holdProgress)if(!(!a.hold||!a.gameplay.lastHoldActivation)){if(this.heldCols.isPressed(a.col)&&a.type=="Hold"&&(a.gameplay.lastHoldActivation=Date.now()),this.shouldDropHold(a,Date.now())){e.chartView.doJudgment(a,0,this.collection.getDroppedJudgment()),a.gameplay.droppedHoldBeat=e.getBeat(),this.holdProgress.splice(this.holdProgress.indexOf(a),1),e.gameStats?.addHoldDataPoint(a,this.collection.getDroppedJudgment());continue}e.chartView.getTimeWithOffset()>=e.chartView.chart.getSecondsFromBeat(a.beat+a.hold)&&(a.gameplay.hideNote=!0,e.chartView.doJudgment(a,0,this.collection.getHeldJudgement(a)),this.holdProgress.splice(this.holdProgress.indexOf(a),1),e.gameStats?.addHoldDataPoint(a,this.collection.getHeldJudgement(a)))}for(const a of this.heldCols.getHeldCols()){const o=this.getClosestNote(e.loadedChart.getNotedata(),e.chartView.getTimeWithOffset()-this.collection.getMineJudgment().getTimingWindowMS()/2e3,a,["Mine"],this.collection.getMineJudgment().getTimingWindowMS()/2);o&&(o.gameplay.hasHit=!0,o.gameplay.hideNote=!0,e.chartView.doJudgment(o,0,this.collection.getMineJudgment()),e.gameStats?.addDataPoint([o],this.collection.getMineJudgment(),0),e.mine.play())}}endPlay(e){if(!e.loadedChart||!e.chartView)return;this.collection=di.getCollection(W.play.timingCollection),this.chordCohesion.clear();for(const a of e.loadedChart.getNotedata())a.type=="Mine"||a.fake||(this.chordCohesion.has(a.beat)||this.chordCohesion.set(a.beat,[]),this.chordCohesion.get(a.beat).push(a));const n=e.chartView.getTimeWithOffset()-this.collection.maxWindowMS()/1e3*W.audio.rate;let s=Jr(e.loadedChart.getNotedata(),n,a=>a.second)+1;s>=1&&n<=e.loadedChart.getNotedata()[s-1].second&&s--,this.missNoteIndex=s,this.holdProgress=[],this.heldCols.reset()}keyDown(e,r){if(!e.loadedChart||!e.chartView)return;const n=e.chartView.getTimeWithOffset(),s=this.getClosestNote(e.loadedChart.getNotedata(),n,r,["Tap","Hold","Roll"]);this.heldCols.keyDown(r);for(const a of this.holdProgress)a.type=="Roll"&&a.col==r&&(a.gameplay.lastHoldActivation=Date.now());s?this.hitNote(e,s,n):e.chartView.keyDown(r)}keyUp(e,r){if(!e.loadedChart||!e.chartView)return;const n=e.chartView.getTimeWithOffset(),s=this.getClosestNote(e.loadedChart.getNotedata(),n,r,["Lift"]);this.heldCols.keyUp(r),e.chartView.keyUp(r),s&&this.hitNote(e,s,n)}shouldAssistTick(e){return!e.fake&&e.type!="Mine"}hitNote(e,r,n){r.gameplay.hasHit=!0,De(r)&&(r.gameplay.lastHoldActivation=Date.now(),e.chartView.activateHold(r.col),this.holdProgress.push(r));const s=this.chordCohesion.get(r.beat);if(s.every(a=>a.gameplay.hasHit)){const a=this.collection.judgeInput((n-r.second)/W.audio.rate),o=this.collection.shouldHideNote(a);s.forEach(u=>{e.chartView.doJudgment(u,(n-u.second)/W.audio.rate,a),o&&J2(u)&&(u.gameplay.hideNote=!0)}),e.gameStats?.addDataPoint(s,a,(n-r.second)/W.audio.rate)}}getClosestNote(e,r,n,s,a){a=a??this.collection.maxWindowMS(),a*=W.audio.rate;const o=r-a/1e3,u=r+a/1e3;let d=Jr(e,o,l=>l.second)+1;d>=1&&o<=e[d-1].second&&d--;let m;for(;e[d]&&e[d].second<=u;){const l=e[d];if(l.gameplay.hasHit||l.col!=n||l.fake||!s.includes(l.type)){d++;continue}(!m||Math.abs(l.second-r)<Math.abs(m.second-r))&&(m=l),d++}return m}shouldDropHold(e,r){if(!e.gameplay?.lastHoldActivation)return!1;const n=this.collection.getHeldJudgement(e);return n?r-e.gameplay.lastHoldActivation>=n.getTimingWindowMS():!1}}class Dk{}const Lk={1:"Tap",2:"Hold",4:"Roll",M:"Mine",F:"Fake",L:"Lift"},Ok={Tap:"1",Hold:"2",Roll:"4",Mine:"M",Fake:"F",Lift:"L"};class No extends Dk{serialize(t,e){if(t.length==0)return"";const r=[];let n=0;const s=t.filter(De),a=t.at(-1),o=a.beat+(De(a)?a.hold:0);let u=Math.ceil(o/4);o%4==0&&u++;for(let d=0;d<u;d++){let m="// measure "+d+`
`;const l=[];for(;t[n]?.beat<d*4+4;)l.push(t[n++]);const f=[];for(;s[0]?.beat+s[0]?.hold<d*4+4;)f.push(s.shift());const p=Math.max(4,dv(r0(l.map(y=>i0(y.beat))),r0(f.map(y=>i0(y.beat+y.hold)))));for(let y=0;y<p;y++){const v=d*4+4/p*y,_=new Array(e.numCols).fill("0");for(;he(l[0]?.beat??-1,3)==he(v,3);){const w=l.shift();_[w.col]=Ok[w.type]}for(;he(f[0]?.beat+f[0]?.hold,3)==he(v,3);){const w=f.shift();_[w.col]="3"}m+=_.join("")+`
`}r.push(m)}return r.join(",  ")}fromString(t){const e=t.split(","),r=[],n=[];for(let s=0;s<e.length;s++){const a=e[s].trim().split(`
`);for(let o=0;o<a.length;o++){const u=a[o].trim();let d=0;for(let m=0;m<u.length;m++){const l=s*4+o/a.length*4;let f=u[m];if(f=="D"&&(u[m+1]=="L"||u[m+1]=="M")&&(u[m+1]=="L"?f="3":f="M",m++),f!="0"&&f!="3"){const p={beat:l,col:d,type:Lk[f]};if(p.type==null){console.log("Unknown note type "+f+" at beat "+l+" col "+d);continue}(f=="2"||f=="4")&&(n[d]&&console.log("Missing end of hold/roll for note "+JSON.stringify(n[d])),n[d]=p),r.push(p)}f=="3"&&(n[d]?(n[d].hold=l-n[d].beat,n[d]=void 0):console.log("Extra end of hold/roll at beat "+l+" col "+d)),d++}}}return r}getStats(t,e){const r={npsGraph:this.getNPSPerMeasure(t,e),counts:{Taps:0,Jumps:0,Hands:0,Holds:0,Rolls:0,Mines:0,Fakes:0,Lifts:0}};let n=-1,s=0;const a=[];for(const u of t){if(u.beat!=n){let d=0;for(let m=0;m<a.length;m++)a[m]&&(n>a[m]?a[m]=void 0:a[m]<u.beat&&d++);s>1&&r.counts.Jumps++,s+d>2&&r.counts.Hands++,s=0,n=u.beat}if(u.type!="Mine"&&!u.fake&&s++,u.fake){r.counts.Fakes++;continue}switch(u.type){case"Tap":r.counts.Taps++;break;case"Hold":r.counts.Holds++;break;case"Roll":r.counts.Rolls++;break;case"Lift":r.counts.Lifts++;break;case"Mine":r.counts.Mines++;break}De(u)&&(a[u.col]=u.beat+u.hold)}let o=0;for(let u=0;u<a.length;u++)a[u]&&a[u]<t[t.length-1].beat&&o++;return s>1&&r.counts.Jumps++,s+o>2&&r.counts.Hands++,r}getNPSPerMeasure(t,e){const r=t[t.length-1]?.beat??0,n=[];let s=0;for(let a=0;a<r;a+=4){const o=e.getSecondsFromBeat(a+4)-e.getSecondsFromBeat(a);if(o<=.05){n.push(0);continue}let u=0;for(;t[s+1]&&t[s].beat<a+4;){const d=t[s].type;s++,!t[s].fake&&!t[s].warped&&(d=="Hold"||d=="Roll"||d=="Tap"||d=="Lift")&&u++}n.push(u/o)}return n}}class Fk extends be{constructor(e){super();P(this,"renderer");this.renderer=e}}const Nk=Ht.from("assets/noteskin/dance/mine/frame.png"),$e=class{static async initArrowTex(t){if(!this.loaded){this.noop_frag=await fetch("assets/noteskin/dance/shader/noop.frag").then(e=>e.text()),this.noop_vert=await fetch("assets/noteskin/dance/shader/noop.vert").then(e=>e.text()),this.arrow_gradient_frag=await fetch("assets/noteskin/dance/shader/arrow_gradient.frag").then(e=>e.text()),this.mine_gradient_frag=await fetch("assets/noteskin/dance/shader/mine_gradient.frag").then(e=>e.text()),this.lift_gradient_frag=await fetch("assets/noteskin/dance/shader/lift_gradient.frag").then(e=>e.text()),this.arrow_body_geometry=await this.loadGeometry("assets/noteskin/dance/tap/body.txt"),this.arrow_frame_geometry=await this.loadGeometry("assets/noteskin/dance/tap/frame.txt"),this.mine_body_geometry=await this.loadGeometry("assets/noteskin/dance/mine/body.txt"),this.lift_body_geometry=await this.loadGeometry("assets/noteskin/dance/lift/body.txt");{const e=yr.from(this.noop_vert,this.noop_frag,{sampler0:this.arrow_parts_texture}),r=new Ms($e.arrow_frame_geometry,e);r.x=32,r.y=32,r.rotation=-Math.PI/2,this.arrow_frame=r}for(let e=0;e<8;e++){const r=yr.from(this.noop_vert,this.arrow_gradient_frag,{sampler0:this.arrow_parts_texture,time:0,quant:e}),n=new Ie($e.arrow_frame_tex);n.x=e%3*64,n.y=Math.floor(e/3)*64;const s=new Ms($e.arrow_body_geometry,r);s.x=e%3*64+32,s.y=Math.floor(e/3)*64+32,s.rotation=-Math.PI/2,s.name="body"+e,$e.arrow_container.addChild(n),$e.arrow_container.addChild(s)}for(let e=0;e<8;e++){const r=yr.from(this.noop_vert,this.lift_gradient_frag,{sampler0:this.lift_parts_texture,time:0,quant:e}),n=new Ms($e.lift_body_geometry,r);n.x=e%3*64+32,n.y=Math.floor(e/3)*64+32,n.rotation=-Math.PI/2,n.name="body"+e,$e.lift_container.addChild(n)}{const e=yr.from(this.noop_vert,this.mine_gradient_frag,{sampler0:this.mine_parts_texture,time:0}),r=new Ms($e.mine_body_geometry,e),n=new Ie(Nk);n.width=64,n.height=64,n.anchor.set(.5),n.pivot.y=3,$e.mine_container.position.set(32),$e.mine_container.addChild(r),$e.mine_container.addChild(n)}t.ticker.add(()=>{t.renderer.render($e.arrow_frame,{renderTexture:$e.arrow_frame_tex}),t.renderer.render($e.arrow_container,{renderTexture:$e.arrow_tex}),t.renderer.render($e.mine_container,{renderTexture:$e.mine_tex}),t.renderer.render($e.lift_container,{renderTexture:$e.lift_tex})}),this.loaded=!0}}static async loadGeometry(t){try{const r=(await fetch(t).then(d=>d.text())).split(`
`),n=parseInt(r[0]),s=parseInt(r[n+1]),a=[],o=[],u=[];for(let d=0;d<n;d++){const m=/(-?[0-9.]+)\s+(-?[0-9.]+)\s+(-?[0-9.]+)\s+(-?[0-9.]+)/.exec(r[d+1]);if(m)a.push(parseFloat(m[1])),a.push(parseFloat(m[2])),o.push(parseFloat(m[3])),o.push(parseFloat(m[4]));else throw Error("Failed to load vertex "+r[d+1])}for(let d=0;d<s;d++){const m=/(-?[0-9.]+)\s+(-?[0-9.]+)\s+(-?[0-9.]+)/.exec(r[d+2+n]);if(m)u.push(parseFloat(m[1])),u.push(parseFloat(m[2])),u.push(parseFloat(m[3]));else throw Error("Failed to load triangle "+r[d+2+n])}return new An().addAttribute("aVertexPosition",a,2).addAttribute("aUvs",o,2).addIndex(u)}catch(e){return console.error(e),new An}}static setArrowTexTime(t,e){if(!!this.loaded){for(let r=0;r<8;r++){const n=$e.arrow_container.getChildByName("body"+r);n.shader.uniforms.time=t;const s=$e.lift_container.getChildByName("body"+r);s.shader.uniforms.time=t}$e.mine_container.children[0].shader.uniforms.time=e,$e.mine_container.rotation=e%1*Math.PI*2}}static setNoteTex(t,e,r){if(e.type=="Mine")t.texture=$e.mine_tex;else{const n=Math.min(Nf(r.getBeatOfMeasure(e.beat)),7);t.texture=new Ht(e.type=="Lift"?$e.lift_tex.baseTexture:$e.arrow_tex.baseTexture,new Te(n%3*64,Math.floor(n/3)*64,64,64))}}};let ei=$e;P(ei,"noop_frag"),P(ei,"noop_vert"),P(ei,"arrow_gradient_frag"),P(ei,"mine_gradient_frag"),P(ei,"lift_gradient_frag"),P(ei,"arrow_parts_texture",Pe.from("assets/noteskin/dance/tap/parts.png")),P(ei,"mine_parts_texture",Pe.from("assets/noteskin/dance/mine/parts.png")),P(ei,"lift_parts_texture",Pe.from("assets/noteskin/dance/lift/parts.png")),P(ei,"arrow_body_geometry"),P(ei,"arrow_frame_geometry"),P(ei,"lift_body_geometry"),P(ei,"mine_body_geometry"),P(ei,"arrow_frame_tex",Di.create({width:64,height:64,resolution:W.performance.resolution})),P(ei,"arrow_frame"),P(ei,"arrow_tex",Di.create({width:192,height:192,resolution:W.performance.resolution})),P(ei,"arrow_container",new be),P(ei,"lift_tex",Di.create({width:192,height:192,resolution:W.performance.resolution})),P(ei,"lift_container",new be),P(ei,"mine_tex",Di.create({width:64,height:64,resolution:W.performance.resolution})),P(ei,"mine_container",new be),P(ei,"loaded",!1);const Uk=Ht.from("assets/noteskin/dance/hold/body.png"),Hk=Ht.from("assets/noteskin/dance/hold/cap.png"),Gk=Ht.from("assets/noteskin/dance/roll/body.png"),Wk=Ht.from("assets/noteskin/dance/roll/cap.png"),a0={Fake:Ht.from("assets/noteskin/dance/icon/fake.png")};class zk extends be{constructor(){super();P(this,"note");P(this,"icon");this.note=new Ie,this.note.anchor.set(.5),this.addChild(this.note)}}class Vk extends be{constructor(){super(...arguments);P(this,"holdBody");P(this,"holdCap")}}class Xk extends be{constructor(){super();P(this,"type","");P(this,"hold");P(this,"item");P(this,"selection");this.hold=new Vk,this.item=new zk,this.selection=new Ie(Ht.WHITE),this.selection.alpha=0,this.addChild(this.hold),this.addChild(this.item),this.addChild(this.selection)}}class Gi{static createArrow(){const t=new Xk;return t.interactive=!0,t}static setHoldLength(t,e){t.type!="Roll"&&t.type!="Hold"||(t.hold.holdBody.height=e,t.hold.holdBody.y=e,t.hold.holdCap.y=e,t.selection.height=64+e)}static setHoldBrightness(t,e){t.type!="Roll"&&t.type!="Hold"||(t.hold.holdBody.tint=Ec(e*255,e*255,e*255),t.hold.holdCap.tint=Ec(e*255,e*255,e*255))}static hideFakeIcon(t,e){t.type=="Fake"&&(t.item.icon.visible=!e)}static setData(t,e,r,n){const s=r.col,a=r.type;if(ei.setNoteTex(e.item.note,r,n),a=="Mine"?e.item.note.rotation=0:e.item.note.rotation=t.getRotFromCol(s),a=="Hold"||a=="Roll"){if(!e.hold.holdBody||!e.hold.holdCap){const o=new Cf(Ht.EMPTY,64,0);o.tileScale.x=.5,o.tileScale.y=.5,o.uvRespectAnchor=!0,o.anchor.y=1,o.x=-32;const u=new Ie;u.width=64,u.height=32,u.anchor.x=.5,e.hold.holdBody=o,e.hold.holdCap=u,e.hold.addChild(o),e.hold.addChild(u)}e.hold.holdBody.texture=a=="Hold"?Uk:Gk,e.hold.holdCap.texture=a=="Hold"?Hk:Wk,Gi.setHoldBrightness(e,.8),e.hold.visible=!0}else e.hold.visible=!1;if(a0[a]){if(e.item.icon&&e.type!=r.type&&(e.item.icon.destroy(),e.item.icon=void 0),!e.item.icon){const o=new Ie(a0[a]);o.width=32,o.height=32,o.anchor.set(.5),o.alpha=.9,e.item.icon=o,e.item.addChild(o)}e.item.icon.visible=!0}else e.item.icon&&(e.item.icon.visible=!1);e.selection.x=-32,e.selection.y=-32,e.selection.width=64,e.selection.height=64,e.type=r.type}}const la=class extends be{constructor(e,r){super();P(this,"children",[]);P(this,"renderer");P(this,"notefield");la.held_tex||this.loadTex(),this.notefield=e,this.renderer=r}async loadTex(){let e=0,r=0;const n=await oo.load("assets/noteskin/dance/hold_judgment.png");e=n.height,r=n.width,la.held_tex=new Ht(n,new Te(0,0,r,e/2)),la.dropped_tex=new Ht(n,new Te(0,e/2,r,e/2))}renderThis(){this.y=W.chart.receptorYPos/W.chart.zoom+48,this.scale.y=W.chart.reverse?-1:1;for(const e of this.children){const r=(Date.now()-e.createTime)/1e3;if(r<.1){const n=1-(1-r/.1)*(1-r/.1);e.scale.set(.3*n)}else if(r>.6&&r<.8){const n=(r-.6)/.2*(r-.6)/.2;e.scale.set(.3*(1-n))}}Ci(this.children,e=>Date.now()-e.createTime>800)}addJudge(e,r){if(!So(r)&&!ks(r))return;const n=new Ie(So(r)?la.dropped_tex:la.held_tex);n.anchor.set(.5),n.x=this.notefield.getColX(e),n.createTime=Date.now(),n.scale.set(0),this.addChild(n)}};let wh=la;P(wh,"held_tex"),P(wh,"dropped_tex");const jn=class extends Io{static get instance(){return jn._instance||(jn._instance=new jn),jn._instance}static emit(t,...e){return jn.instance.emit(t,...e)}static on(t,e,r){jn.instance.on(t,e,r)}static off(t,e,r,n){jn.instance.off(t,e,r,n)}};let ve=jn;P(ve,"_instance");class jk extends be{constructor(e,r){super();P(this,"children",[]);P(this,"notefield");P(this,"renderer");P(this,"noteMap",new Map);this.renderer=r,this.notefield=e,this.sortableChildren=!0;const n=()=>{this.children.forEach(s=>Gi.setData(this.notefield,s,s.note,this.renderer.chart.timingData))};ve.on("timeSigChanged",n),this.on("destroyed",()=>[ve.off("timeSigChanged",n)])}renderThis(e,r,n){this.children.forEach(a=>a.marked=!1);const s=this.renderer.chartManager.getTime();for(const a of this.renderer.chart.getNotedata()){if(a.gameplay?.hideNote||W.chart.CMod&&W.chart.hideWarpedArrows&&a.warped||a.beat+(De(a)?a.hold:0)<r)continue;if(a.beat>n)break;const[o,u,d,m]=this.checkBounds(a,e);if(u)break;if(o)continue;const l=this.getNote(a);if(l.deactivated=!1,l.marked=!0,l.dirtyTime=Date.now(),l.y=d,l.item.scale.y=W.chart.reverse?-1:1,De(a))if(Gi.setHoldLength(l,m),a.gameplay?.lastHoldActivation){let y=(Date.now()-a.gameplay.lastHoldActivation)/di.getCollection(W.play.timingCollection).getHeldJudgement(a).getTimingWindowMS();y=Math.min(1.2,y),Gi.setHoldBrightness(l,1-y*.7)}else Gi.setHoldBrightness(l,.8);a.type=="Fake"&&Gi.hideFakeIcon(l,this.renderer.chartManager.getMode()==Ot.Play);const f=this.renderer.chartManager.getMode()!=Ot.Play&&(this.renderer.chartManager.selection.notes.includes(a)||this.renderer.chartManager.selection.inProgressNotes.includes(a));l.selection.alpha=f?Math.sin(Date.now()/320)*.1+.3:0;const p=this.renderer.selectionTest(l);!f&&p&&this.renderer.chartManager.addNoteToDragSelection(a),f&&!p&&this.renderer.chartManager.removeNoteFromDragSelection(a),this.renderer.chartManager.selection.shift&&f?l.visible=!1:l.visible=!0}ei.setArrowTexTime(e,s),this.children.filter(a=>!a.deactivated&&!a.marked).forEach(a=>{a.deactivated=!0,a.visible=!1,this.noteMap.delete(a.note)}),Ci(this.children,a=>Date.now()-a.dirtyTime>5e3)}checkBounds(e,r){let n=W.chart.receptorYPos/W.chart.zoom;(!De(e)||!e.gameplay?.lastHoldActivation||r<e.beat)&&(n=this.renderer.getYPos(e.beat)),De(e)&&e.gameplay?.droppedHoldBeat&&(n=this.renderer.getYPos(e.gameplay.droppedHoldBeat));const s=this.renderer.getYPos(e.beat+(De(e)?e.hold:0));return De(e)&&!e.gameplay?.droppedHoldBeat&&e.gameplay?.lastHoldActivation&&e.beat+e.hold<r?[!0,!1,n,s-n]:s<this.renderer.getUpperBound()?[!0,!1,n,s-n]:n>this.renderer.getLowerBound()?e.beat<r||this.renderer.isNegScroll(e.beat)?[!0,!1,n,s-n]:[!0,!0,n,s-n]:[!1,!1,n,s-n]}getNote(e){if(this.noteMap.get(e))return this.noteMap.get(e);let r;for(const n of this.children)if(n.deactivated){r=n;break}return r||(r=Gi.createArrow(),r.zIndex=e.beat,this.addChild(r)),r.note=e,r.visible=!0,r.zIndex=e.beat,Gi.setData(this.notefield,r,e,this.renderer.chart.timingData),r.x=this.notefield.getColX(e.col),this.renderer.registerDragNote(r),this.noteMap.set(e,r),r}}const Yk=Ht.from("assets/noteskin/dance/flash/hold.png"),Id={w0:Ht.from("assets/noteskin/dance/flash/fantastic.png"),w1:Ht.from("assets/noteskin/dance/flash/white_fantastic.png"),w2:Ht.from("assets/noteskin/dance/flash/excellent.png"),w3:Ht.from("assets/noteskin/dance/flash/great.png"),w4:Ht.from("assets/noteskin/dance/flash/decent.png"),w5:Ht.from("assets/noteskin/dance/flash/way_off.png"),mine:Ht.from("assets/noteskin/dance/flash/mine.png")};class Kk extends be{constructor(e){super();P(this,"notefield");P(this,"children",[]);this.notefield=e}renderThis(){this.y=W.chart.receptorYPos/W.chart.zoom,this.scale.y=W.chart.reverse?-1:1;for(const e of this.children)switch(e.type){case"flash":{const r=(Date.now()-e.createTime)/150;e.scale.set(1.1-r*.1),e.alpha=1.2-r*1.2;break}case"mine":{const r=(Date.now()-e.createTime)/600;e.rotation=r*-Math.PI,e.alpha=Math.min(1,2-2*r);break}case"hold":e.alpha=Math.sin(Date.now())*.2+1.2}Ci(this.children,e=>Date.now()-e.createTime>150&&e.type=="flash"),Ci(this.children,e=>Date.now()-e.createTime>600&&e.type=="hold")}addFlash(e,r){if(!W.chart.drawNoteFlash)return;let n;if(va(r)&&(n=Id[r.id]),fa(r)&&(n=Id.mine),ks(r)&&(n=Id.w2),(ks(r)||So(r))&&Ci(this.children,a=>a.type=="hold"&&a.col==e),!n)return;const s=new Ie(n);s.anchor.set(.5),s.rotation=this.notefield.getRotFromCol(e),s.x=this.notefield.getColX(e),s.createTime=Date.now(),s.type="flash",s.col=e,fa(r)&&(s.type="mine",s.blendMode=ue.ADD),this.addChild(s)}activateHold(e){if(!W.chart.drawNoteFlash)return;const r=new Ie(Yk);r.anchor.set(.5),r.rotation=this.notefield.getRotFromCol(e),r.x=this.notefield.getColX(e),r.type="hold",r.col=e,this.addChild(r)}reset(){Ci(this.children,e=>e.type=="hold")}}const qk=Ht.from("assets/noteskin/dance/receptor.png");class $k extends be{constructor(e){super();P(this,"notefield");P(this,"receptors",new be);P(this,"pressedCols",new fv);P(this,"children",[]);this.notefield=e;for(let r=0;r<this.notefield.getNumCols();r++){const n=new Ie(qk);n.width=69,n.height=69,n.anchor.set(.5),n.x=this.notefield.getColX(r),n.rotation=this.notefield.getRotFromCol(r),n.lastPressedTime=-1,n.pressed=!1,this.receptors.addChild(n)}this.addChild(this.receptors)}renderThis(e){this.y=W.chart.receptorYPos/W.chart.zoom,this.scale.y=W.chart.reverse?-1:1;for(const r of this.receptors.children){const n=r,s=Math.min(1,Math.max(1-(e+1e5)%1,.5+(n.pressed?.1:0)))*255;let a=1;Date.now()-n.lastPressedTime<110&&(a=(Date.now()-n.lastPressedTime)/110*.25+.75),n.scale.set(a*.5),n.tint=Ec(s,s,s)}}keyDown(e){const r=this.pressedCols.isPressed(e);this.pressedCols.keyDown(e);const n=this.receptors.children[e];n.pressed=!0,r||(n.lastPressedTime=Date.now())}keyUp(e){this.pressedCols.keyUp(e);const r=this.receptors.children[e];r.pressed=this.pressedCols.isPressed(e)}}class Zk extends be{constructor(e,r){super();P(this,"children",[]);P(this,"notefield");P(this,"renderer");P(this,"noteMap",new Map);P(this,"lastColShift",0);P(this,"lastBeatShift",0);this.renderer=r,this.notefield=e,this.sortableChildren=!0}renderThis(e,r,n){if(!this.renderer.chartManager.selection.shift){Ci(this.children,()=>!0),this.lastBeatShift=0,this.lastColShift=0,this.noteMap.clear();return}const s=this.renderer.chartManager.selection.shift.beatShift,a=this.renderer.chartManager.selection.shift.columnShift;(this.lastBeatShift!=s||this.lastColShift!=a)&&(this.lastBeatShift=s,this.lastColShift=a,this.children.forEach(o=>{Gi.setData(this.notefield,o,{beat:o.note.beat+s,col:o.note.col+a,type:o.note.type},this.renderer.chart.timingData),o.x=this.notefield.getColX(o.note.col+a)})),this.visible=!0,this.children.forEach(o=>o.marked=!1);for(const o of this.renderer.chartManager.selection.notes){if(o.beat+s+(De(o)?o.hold:0)<r||o.beat+s>n)continue;const[u,d,m,l]=this.checkBounds(o,e);if(d||u)continue;const f=this.getNote(o);f.deactivated=!1,f.marked=!0,f.dirtyTime=Date.now(),f.y=m,f.selection.alpha=Math.sin(Date.now()/320)*.1+.3,f.item.scale.y=W.chart.reverse?-1:1,De(o)&&(Gi.setHoldLength(f,l),Gi.setHoldBrightness(f,.8))}this.children.filter(o=>!o.deactivated&&!o.marked).forEach(o=>{o.deactivated=!0,o.visible=!1,this.noteMap.delete(o.note)}),Ci(this.children,o=>Date.now()-o.dirtyTime>5e3)}checkBounds(e,r){const n=e.beat+this.renderer.chartManager.selection.shift.beatShift,s=this.renderer.getYPos(n),a=this.renderer.getYPos(n+(De(e)?e.hold:0));return a<this.renderer.getUpperBound()?[!0,!1,s,a-s]:s>this.renderer.getLowerBound()?n<r||this.renderer.isNegScroll(n)?[!0,!1,s,a-s]:[!0,!0,s,a-s]:[!1,!1,s,a-s]}getNote(e){if(this.noteMap.get(e))return this.noteMap.get(e);let r;for(const n of this.children)if(n.deactivated){r=n;break}return r||(r=Gi.createArrow()),r.note=e,r.visible=!0,r.zIndex=e.beat,Gi.setData(this.notefield,r,{beat:e.beat+this.renderer.chartManager.selection.shift.beatShift,col:e.col+this.renderer.chartManager.selection.shift.columnShift,type:e.type},this.renderer.chart.timingData),r.x=this.notefield.getColX(e.col+this.renderer.chartManager.selection.shift.columnShift),r.alpha=.4,r.interactive=!0,this.noteMap.set(e,r),this.addChild(r),r}}class Uo extends Fk{constructor(e){super(e);P(this,"receptors");P(this,"notes");P(this,"selectionNotes");P(this,"flashes");P(this,"holdJudges");P(this,"ghostNote");P(this,"ghostNoteEntry");ei.initArrowTex(e.chartManager.app),this.receptors=new $k(this),this.notes=new jk(this,e),this.selectionNotes=new Zk(this,e),this.flashes=new Kk(this),this.holdJudges=new wh(this,e),this.ghostNote=Gi.createArrow(),this.ghostNote.visible=!1,this.ghostNote.alpha=.4,this.addChild(this.receptors,this.ghostNote,this.notes,this.selectionNotes,this.flashes,this.holdJudges)}setGhostNote(e){if(this.ghostNoteEntry=e,!e){this.ghostNote.visible=!1;return}Gi.setData(this,this.ghostNote,e,this.renderer.chart.timingData),this.ghostNote.x=this.getColX(e.col)}getNoteSprite(e){const r=Gi.createArrow();return Gi.setData(this,r,e,this.renderer.chart.timingData),r}update(e,r,n){this.receptors.renderThis(e),this.notes.renderThis(e,r,n),this.selectionNotes.renderThis(e,r,n),this.flashes.renderThis(),this.holdJudges.renderThis(),this.ghostNoteEntry&&(this.ghostNote.y=this.renderer.getYPos(this.ghostNoteEntry.beat),this.ghostNote.item.scale.y=W.chart.reverse?-1:1,this.ghostNote.visible=W.general.mousePlacement&&this.renderer.chartManager.getMode()==Ot.Edit&&this.ghostNoteEntry.beat>=r&&this.ghostNoteEntry.beat<=n&&this.ghostNoteEntry.beat>=0)}doJudge(e,r){this.flashes.addFlash(e,r),this.holdJudges.addJudge(e,r)}endPlay(){this.flashes.reset()}keyDown(e){this.receptors.keyDown(e)}keyUp(e){this.receptors.keyUp(e)}activateHold(e){this.flashes.activateHold(e)}getColX(e){return(e-this.getNumCols()/2+.5)*64}getNumCols(){return this.renderer.chart.gameType.numCols}getRotFromCol(e){let r=[0,-90,90,180];return this.getNumCols()==3&&(r=[45,-90,135]),(this.getNumCols()==6||this.getNumCols()==12)&&(r=[0,45,-90,90,135,180]),this.getNumCols()==8&&(r=[0,-90,90,180,0,-90,90,180]),r[e%r.length]/180*Math.PI}}const Ic=class{static register(t){Ic.gameTypes[t.id]=t,this.priority.push(t)}static getPriority(){return this.priority}static getGameType(t){return Ic.gameTypes[t]}};let Si=Ic;P(Si,"gameTypes",{}),P(Si,"priority",[]);Si.register({id:"dance-single",numCols:4,notefieldWidth:4*64,gameLogic:new Fo,parser:new No,notefield:Uo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[3,1,2,0],vertical:[0,2,1,3]}});Si.register({id:"dance-double",numCols:8,notefieldWidth:8*64,gameLogic:new Fo,parser:new No,notefield:Uo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[3,1,2,0,7,5,6,4],vertical:[0,2,1,3,4,6,5,7]}});Si.register({id:"dance-couple",numCols:8,notefieldWidth:8*64,gameLogic:new Fo,parser:new No,notefield:Uo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[3,1,2,0,7,5,6,4],vertical:[0,2,1,3,4,6,5,7]}});Si.register({id:"dance-solo",numCols:6,notefieldWidth:6*64,gameLogic:new Fo,parser:new No,notefield:Uo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[5,4,2,3,1,0],vertical:[0,1,3,2,4,5]}});Si.register({id:"dance-solodouble",numCols:12,notefieldWidth:12*64,gameLogic:new Fo,parser:new No,notefield:Uo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[5,4,2,3,1,0,11,10,8,9,7,6],vertical:[0,1,3,2,4,5,6,7,9,8,10,11]}});Si.register({id:"dance-3panel",numCols:3,notefieldWidth:3*64,gameLogic:new Fo,parser:new No,notefield:Uo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[2,1,0],vertical:[0,1,2]}});const tn=["Beginner","Easy","Medium","Hard","Challenge","Edit"],Vf=class{constructor(t){P(this,"items",[]);P(this,"itemIndex",0);P(this,"limit",0);P(this,"app");this.app=t,Vf.instance=this}run(t){t.action(this.app),this.items.splice(this.itemIndex,this.items.length-this.itemIndex,t),this.itemIndex++}undo(){!this.items[this.itemIndex-1]||(this.items[this.itemIndex-1].undo(this.app),this.itemIndex--,ve.emit("undo"))}redo(){!this.items[this.itemIndex]||(this.items[this.itemIndex].redo?this.items[this.itemIndex].redo(this.app):this.items[this.itemIndex].action(this.app),this.itemIndex++,ve.emit("redo"))}reset(){this.itemIndex=0,this.items=[]}canUndo(){return this.itemIndex>0}canRedo(){return this.itemIndex!=this.items.length}setLimit(){this.limit=this.itemIndex}isDirty(){return this.itemIndex!=this.limit}};let tr=Vf;P(tr,"instance");const Sc=["BPMS","STOPS","WARPS","DELAYS","LABELS","SPEEDS","SCROLLS","TICKCOUNTS","TIMESIGNATURES","COMBOS","FAKES","ATTACKS","BGCHANGES","FGCHANGES"];class gv{constructor(t,e){P(this,"_fallback");P(this,"_cache",{events:{},warpedBeats:{}});P(this,"_chart");P(this,"events",{});P(this,"offset");this._fallback=t,this._chart=e}parse(t,e){var n;if(t=="OFFSET"){this.offset=parseFloat(e);return}(n=this.events)[t]||(n[t]=[]);let r=e.replaceAll(/[\n\r\t]/g,"").split(",");t=="ATTACKS"&&(r=[e.replaceAll(/[\n\r\t]/g,"")]);for(const s of r){if(t=="ATTACKS"){let u;const d=/TIME=([\d.]+):(END|LEN)=([\d.]+):MODS=([^:]+)/g;for(;(u=d.exec(s))!=null;){const m={type:"ATTACKS",second:parseFloat(u[1]),endType:u[2],value:parseFloat(u[3]),mods:u[4]};this._insert("ATTACKS",m,!1)}return}const a=s.split("=");if(a.length<2)continue;let o;switch(t){case"BPMS":case"STOPS":case"WARPS":case"DELAYS":case"SCROLLS":case"TICKCOUNTS":case"FAKES":o={type:t,beat:parseFloat(a[0]),value:parseFloat(a[1])};break;case"LABELS":o={type:t,beat:parseFloat(a[0]),value:a[1]};break;case"SPEEDS":o={type:t,beat:parseFloat(a[0]),value:parseFloat(a[1]),delay:parseFloat(a[2]),unit:a[3]=="0"?"B":"T"};break;case"TIMESIGNATURES":o={type:t,beat:parseFloat(a[0]),upper:parseInt(a[1]),lower:parseInt(a[2])};break;case"COMBOS":o={type:t,beat:parseFloat(a[0]),hitMult:parseInt(a[1]),missMult:parseInt(a[2]??a[1])};break;case"BGCHANGES":case"FGCHANGES":o={type:t,beat:parseFloat(a[0]),file:a[1],updateRate:parseFloat(a[2]),crossFade:a[3]=="1",stretchRewind:a[4]=="1",stretchNoLoop:a[5]=="1",effect:a[6],file2:a[7],transition:a[8],color1:a[9],color2:a[10]}}this._insert(t,o,!1)}}_insert(t,e,r){this.binsert(t,e),(r??!0)&&this.reloadCache(t)}delete(t,e,r){const n=t?this:this._fallback;if(!n.events[e])return;r=he(r,3);const s=n.bindex(e,{type:e,beat:r,second:r});if(s==-1||s==0&&e=="BPMS")return;const a=n.events[e][s];tr.instance.run({action:()=>{n._delete(!0,a),n.reloadCache(e),this!=n&&this.reloadCache(e),ve.emit("timingModified")},undo:()=>{n._insert(a.type,a),n.reloadCache(e),this!=n&&this.reloadCache(e),ve.emit("timingModified")}})}_delete(t,e,r){if(!t){this._fallback._delete(!0,e,r),(r??!0)&&this.reloadCache(e.type);return}if(!this.events[e.type])return;const n=this.bindex(e.type,e);n>-1&&(this.events[e.type].splice(n,1),(r??!0)&&this.reloadCache(e.type))}isDuplicate(t,e){if(["STOPS","WARPS","DELAYS","FAKES","BGCHANGES","FGCHANGES"].includes(t.type)||e.type!=t.type)return!1;switch(t.type){case"BPMS":case"SCROLLS":case"TICKCOUNTS":case"LABELS":case"SPEEDS":return e.type==t.type&&t.value==e.value;case"TIMESIGNATURES":return e.type==t.type&&t.upper==e.upper&&t.lower==e.lower;case"COMBOS":return e.type==t.type&&t.hitMult==e.hitMult&&t.missMult==e.missMult;default:return!1}}isNullEvent(t){switch(t.type){case"BPMS":case"TICKCOUNTS":case"TIMESIGNATURES":case"COMBOS":return!1;case"STOPS":case"WARPS":case"DELAYS":case"SCROLLS":case"FAKES":return t.value==0;case"LABELS":case"ATTACKS":return t.value=="";case"SPEEDS":return t.value==1&&t.delay==0&&t.unit=="B";case"FGCHANGES":case"BGCHANGES":return t.file==""&&t.file2==""}}insert(t,e,r,n){const s=t?this:this._fallback;if(e=="OFFSET"){s.offset=r,this.reloadCache("OFFSET");return}if(Object.keys(r).length==0)return;s.events[e]||(t?s.events[e]=JSON.parse(JSON.stringify(this._fallback.events[e])):s.events[e]=[]),n=he(n,3);const a=s.getTimingEventAtBeat(e,n),o={type:e,beat:n},u=[],d=[];a?.beat==n&&u.push(a);const m=s.getTimingEventAtBeat(e,n-.001);if(Object.assign(o,r),this.isNullEvent(o))return;(!m||!this.isDuplicate(m,o))&&d.push(o);const l=this.getTimingData(e),f=l[s.searchCache(l,"beat",n)+1];f&&this.isDuplicate(o,f)&&u.push(f),(u.length||d.length)&&tr.instance.run({action:()=>{for(const p of u)this._delete(t,p);for(const p of d)s._insert(e,p);this.reloadCache(e),ve.emit("timingModified"),ve.emit("chartModified"),e=="TIMESIGNATURES"&&ve.emit("timeSigChanged")},undo:()=>{for(const p of d)this._delete(t,p);for(const p of u)s._insert(e,p);this.reloadCache(e),ve.emit("timingModified"),ve.emit("chartModified"),e=="TIMESIGNATURES"&&ve.emit("timeSigChanged")}})}buildBeatTimingDataCache(){const t=[];let e=this.getTimingData("BPMS","STOPS","WARPS","DELAYS");e=e.concat(this.getTimingData("WARPS").map(s=>({type:"WARP_DEST",beat:s.beat+s.value,value:s.value})));const r=["WARP_DEST","BPMS","STOPS","WARPS","DELAYS"];e.sort((s,a)=>s.beat==a.beat?r.indexOf(s.type)-r.indexOf(a.type):s.beat-a.beat);const n=this.getTimingData("OFFSET");t.push({beat:0,secondBefore:-n,secondOf:-n,secondAfter:-n,secondClamp:-n,bpm:this.getTimingData("BPMS")[0]?.value??120,warped:!1});for(const s of e){if(t.at(-1)?.beat!=s.beat){t.at(-1).secondClamp=Math.max(Math.max(t.at(-2)?.secondClamp??-n,t.at(-2)?.secondAfter??-n),t.at(-1).secondBefore);let a=(s.beat-t.at(-1).beat)*60/t.at(-1).bpm;t.at(-1).warped&&(a=0),t.push({beat:s.beat,secondBefore:t.at(-1).secondAfter+a,secondOf:t.at(-1).secondAfter+a,secondAfter:t.at(-1).secondAfter+a,secondClamp:0,bpm:t.at(-1).bpm,warped:t.at(-1).warped})}s.type=="WARPS"&&(t.at(-1).warped=!0),s.type=="WARP_DEST"&&(t.at(-1).warped=!1),s.type=="BPMS"&&(t.at(-1).bpm=s.value),s.type=="STOPS"&&(t.at(-1).secondAfter+=s.value),s.type=="DELAYS"&&(t.at(-1).secondOf+=s.value,t.at(-1).secondAfter+=s.value)}t.at(-1).secondClamp=Math.max(t.at(-2)?.secondClamp??-n,t.at(-1).secondBefore),this._cache.beatTiming=t,this._cache.warpedBeats={}}buildEffectiveBeatTimingDataCache(){const t=this.getTimingData("SCROLLS");let e=0;if(t.length==0){this._cache.effectiveBeatTiming=[];return}e=t[0].beat;for(let r=0;r<t.length-1;r++){const n=t[r],s=t[r+1].beat-n.beat;n.effectiveBeat=e,e+=n.value*s}t[t.length-1].effectiveBeat=e,this._cache.effectiveBeatTiming=t}buildMeasureTimingCache(){const t=this.getTimingData("TIMESIGNATURES");(t.length==0||t[0].beat!=0)&&t.push({type:"TIMESIGNATURES",beat:0,lower:4,upper:4});const e=[];let r=0;for(let n=0;n<t.length;n++){const s=t[n],a=4/s.lower*s.upper;e.push({measure:r,beat:s.beat,beatsPerMeasure:a,divisionLength:4/s.lower,numDivisions:s.upper});const o=t[n+1]?.beat-s.beat;r+=Math.ceil(o/a)}this._cache.measureTiming=e}buildSpeedsTimingDataCache(){const t=this.getTimingData("SPEEDS").map(e=>({type:e.type,beat:e.beat,value:e.value,delay:e.delay,unit:e.unit,second:this.getSecondsFromBeat(e.beat)}));this._cache.speeds=t}buildTimingDataCache(){Sc.forEach(t=>{this._cache.events[t]=this.events[t]??this._fallback?.events[t]??[]}),this._cache.sortedEvents=Sc.map(t=>this._cache.events[t]).flat().sort((t,e)=>t.beat-e.beat);for(const t of this._cache.sortedEvents)t.type=="DELAYS"?t.second=this.getSecondsFromBeat(t.beat,"before"):t.second=this.getSecondsFromBeat(t.beat),t.type=="ATTACKS"&&(t.beat=this.getBeatFromSeconds(t.second))}searchCache(t,e,r){return Jr(t,r,n=>n[e])}getBeatFromSeconds(t){if(!isFinite(t))return 0;if(this._cache.beatTiming==null&&this.buildBeatTimingDataCache(),t+this.getTimingData("OFFSET")<0)return(t+this.getTimingData("OFFSET"))*this._cache.beatTiming[0].bpm/60;const e=this._cache.beatTiming,r=this.searchCache(e,"secondClamp",t),n=e[r],s=Math.max(0,t-n.secondAfter);return n.beat+s*n.bpm/60}getSecondsFromBeat(t,e){if(e||(e=""),!isFinite(t))return 0;this._cache.beatTiming==null&&this.buildBeatTimingDataCache();const r=Math.floor(t*1e3)/1e3;if(t<=0){const d=this._cache.beatTiming[0].bpm;return-this.getTimingData("OFFSET")+t*60/d}const n=this._cache.beatTiming,s=this.searchCache(n,"beat",r),a=n[s];if(a.beat==r){if(e=="noclamp"||e=="")return a.secondOf;if(e=="before")return a.secondBefore;if(e=="after")return a.secondAfter}let u=(t-a.beat)*60/a.bpm;return a.warped&&(u=0),e=="noclamp"?a.secondAfter+u:Math.max(a.secondClamp,a.secondAfter+u)}isBeatWarped(t){if(!isFinite(t))return!1;const e=Math.floor(t*1e3)/1e3;if(this._cache.warpedBeats[e])return this._cache.warpedBeats[e];this._cache.beatTiming==null&&this.buildBeatTimingDataCache();const r=this._cache.beatTiming,n=this.searchCache(r,"beat",e),s=r[n],a=s.beat==e?s.secondClamp:Math.max(s.secondAfter,s.secondClamp);return s.secondOf<s.secondAfter?(this._cache.warpedBeats[e]=!1,!1):s.warped||this.getSecondsFromBeat(t,"noclamp")<a?(this._cache.warpedBeats[e]=!0,!0):(this._cache.warpedBeats[e]=!1,!1)}isBeatFaked(t){if(!isFinite(t))return!1;const e=Math.floor(t*1e3)/1e3;if(this.isBeatWarped(t))return!0;const r=this.getTimingData("FAKES");if(r==null)return!1;for(const n of r)if(e>=n.beat&&e<n.beat+n.value)return!0;return!1}getMeasure(t){if(!isFinite(t))return 0;this._cache.measureTiming==null&&this.buildMeasureTimingCache();const e=this._cache.measureTiming;if(e.length==0)return Math.floor(t/4);const r=this.searchCache(e,"beat",t),n=e[r],s=t-n.beat;return n.measure+s/n.beatsPerMeasure}getDivisionLength(t){if(!isFinite(t))return 1;this._cache.measureTiming==null&&this.buildMeasureTimingCache();const e=this._cache.measureTiming;if(e.length==0)return 1;const r=this.searchCache(e,"beat",t);return e[r].divisionLength}getMeasureLength(t){if(!isFinite(t))return 1;this._cache.measureTiming==null&&this.buildMeasureTimingCache();const e=this._cache.measureTiming;if(e.length==0)return 1;const r=this.searchCache(e,"beat",t),n=e[r];return n.divisionLength*n.numDivisions}getBeatOfMeasure(t){if(!isFinite(t))return 0;this._cache.measureTiming==null&&this.buildMeasureTimingCache();const e=this._cache.measureTiming;if(e.length==0)return t%4;const r=this.searchCache(e,"beat",t),n=e[r];return(t-n.beat)%n.beatsPerMeasure}getBeatFromMeasure(t){if(!isFinite(t))return 0;this._cache.measureTiming==null&&this.buildMeasureTimingCache();const e=this._cache.measureTiming;if(e.length==0)return t*4;const r=this.searchCache(e,"measure",t),n=e[r],s=t-n.measure;return n.measure+s*n.beatsPerMeasure}getDivisionOfMeasure(t){return isFinite(t)?this.getBeatOfMeasure(t)/this.getDivisionLength(t):0}getEffectiveBeat(t){if(!isFinite(t))return 0;this._cache.effectiveBeatTiming==null&&this.buildEffectiveBeatTimingDataCache();const e=this._cache.effectiveBeatTiming;if(e.length==0)return t;const r=this.searchCache(e,"beat",t),n=e[r];if(r==0&&n.beat>t)return t;let s=n.effectiveBeat;const a=t-n.beat;return s+=a*n.value,s}getBeatFromEffectiveBeat(t){if(!isFinite(t))return 0;this._cache.effectiveBeatTiming==null&&this.buildEffectiveBeatTimingDataCache();const e=this._cache.effectiveBeatTiming;if(e.length==0)return t;let r=0;for(;e[r+1]&&(e[r].value<=0||e[r+1].effectiveBeat<=t);)r++;let s=(t-e[r].effectiveBeat)/e[r].value;return isFinite(s)||(s=0),e[r].beat+s}getSpeedMult(t,e){if(!isFinite(t)||!isFinite(e))return 0;this._cache.speeds==null&&this.buildSpeedsTimingDataCache();const r=this._cache.speeds;if(r.length==0)return 1;const n=this.searchCache(r,"beat",t),s=r[n];if(s==null)return 1;let a=t-s.beat;s.unit=="T"&&(a=e-s.second);let o=or(a/s.delay,0,1);s.delay==0&&(o=1);const u=r[n-1]?.value??1;return o*(s.value-u)+u}getBPM(t){return this.getBPMEvent(t)?.value??120}getBPMEvent(t){if(!isFinite(t))return;this._cache.beatTiming==null&&this.buildBeatTimingDataCache();const e=this.getTimingData("BPMS");if(e.length!=0)return e[this.searchCache(e,"beat",t)]}getTimingEventAtBeat(t,e){const r=this.getTimingData(t);if(!Array.isArray(r))return;const n=r[this.searchCache(r,"beat",e)];if(!(n?.beat&&n.beat>e))return n}reloadCache(t){this.buildTimingDataCache(),(t==null||t=="OFFSET"||["WARPS","STOPS","DELAYS","BPMS"].includes(t))&&this.buildBeatTimingDataCache(),(t==null||t=="SCROLLS")&&this.buildEffectiveBeatTimingDataCache(),(t==null||t=="TIMESIGNATURES")&&this.buildMeasureTimingCache(),(t==null||t=="SPEEDS")&&this.buildSpeedsTimingDataCache(),this._chart?.recalculateNotes()}binsert(t,e){let r="beat";const n=this.events[t];t=="ATTACKS"&&(r="second");let s=0,a=n.length;for(;s<a;){const o=s+a>>>1;n[o][r]<e[r]?s=o+1:a=o}n.splice(s,0,e)}bindex(t,e){let r="beat";const n=this.events[t];t=="ATTACKS"&&(r="second");let s=0,a=n.length;for(;s<=a&&s<n.length;){const o=s+a>>>1;if(n[o][r]==e[r])return o;n[o][r]<e[r]&&(s=o+1),n[o][r]>e[r]&&(a=o-1)}return-1}getBeatTiming(){return[...this._cache.beatTiming]}getTimingData(...t){return t.length==0?this._cache.sortedEvents:t.includes("OFFSET")?this.offset??this._fallback?.offset??0:t.length==1&&t[0]in this._cache.events?this._cache.events[t[0]]:(this._cache.sortedEvents==null&&this.buildTimingDataCache(),this._cache.sortedEvents.filter(r=>t.includes(r.type)))}isEmpty(){for(const t of Object.values(this.events))if(t)return!1;return!0}serialize(t){let e="";this.offset&&(e+="#OFFSET:"+this.offset+`;
`);let r=["BPMS","STOPS","WARPS","DELAYS","SPEEDS","SCROLLS","TICKCOUNTS","TIMESIGNATURES","LABELS","COMBOS","FAKES","BGCHANGES","FGCHANGES","ATTACKS"];t=="sm"&&(r=["BPMS","STOPS","TIMESIGNATURES","BGCHANGES","FGCHANGES","ATTACKS"]);for(const n of r)e+=this.formatProperty(t,n);return e}formatProperty(t,e){if(!this._fallback&&!this.events[e])return"";let n="";switch(e){case"ATTACKS":{n=this.getTimingData(e).map(a=>`TIME=${a.second}${a.endType}=${a.value}:MODS=${a.mods}`).join(`:
`);break}case"BGCHANGES":case"FGCHANGES":{n=this.getTimingData(e).map(a=>`${a.beat}=${a.file}=${he(a.updateRate,3).toFixed(3)}=${Number(a.crossFade)}=${Number(a.stretchRewind)}=${Number(a.stretchNoLoop)}=${a.effect}=${a.file2}=${a.transition}=${a.color1}=${a.color2}`).join(`,
`);break}case"BPMS":case"DELAYS":case"FAKES":case"SCROLLS":case"WARPS":{n=this.getTimingData(e).map(a=>`${he(a.beat,3).toFixed(3)}=${he(a.value,3).toFixed(3)}`).join(`,
`);break}case"STOPS":{let s=this.getTimingData(e);if(t=="sm"){const o=this.getTimingData("WARPS").map(u=>{const d=this.getBPM(u.beat);return{type:"STOPS",beat:u.beat,value:-60/d*u.value}});s=s.concat(o)}n=s.map(a=>`${he(a.beat,3).toFixed(3)}=${he(a.value,3).toFixed(3)}`).join(`,
`);break}case"COMBOS":{n=this.getTimingData(e).map(a=>a.hitMult==a.missMult?`${he(a.beat,3).toFixed(3)}=${a.hitMult}`:`${he(a.beat,3).toFixed(3)}=${a.hitMult}=${a.missMult}`).join(`,
`);break}case"LABELS":case"TICKCOUNTS":{n=this.getTimingData(e).map(a=>`${he(a.beat,3).toFixed(3)}=${a.value}`).join(`,
`);break}case"SPEEDS":{n=this.getTimingData(e).map(a=>`${he(a.beat,3).toFixed(3)}=${he(a.value,3).toFixed(3)}=${he(a.delay,3).toFixed(3)}=${a.unit=="B"?0:1}`).join(`,
`);break}case"TIMESIGNATURES":{n=this.getTimingData(e).map(a=>`${he(a.beat,3).toFixed(3)}=${a.upper}=${a.lower}`).join(`,
`);break}}return n.includes(",")&&(n+=`
`),"#"+e+":"+n+`;
`}}class yv{constructor(t,e){P(this,"gameType",Si.getPriority()[0]);P(this,"description","");P(this,"difficulty","Beginner");P(this,"meter",1);P(this,"meterF",1);P(this,"radarValues","0,0,0,0,0");P(this,"chartName","");P(this,"chartStyle","");P(this,"credit","");P(this,"music");P(this,"timingData");P(this,"sm");P(this,"other_properties",{});P(this,"notedata",[]);P(this,"_notedataStats");if(this.timingData=new gv(t.timingData,this),this.sm=t,!e){this.recalculateStats();return}if(t._type=="ssc"){const r=e;for(const s in r)(s=="OFFSET"||Sc.includes(s))&&this.timingData.parse(s,r[s]);this.timingData.reloadCache();const n=Si.getGameType(r.STEPSTYPE);if(!n)throw Error("Unknown step type "+r.STEPSTYPE);if(this.gameType=n,this.description=r.DESCRIPTION??"",tn.includes(r.DIFFICULTY))this.difficulty=r.DIFFICULTY;else throw Error("Unknown chart difficulty "+r.DIFFICULTY);this.meter=parseInt(r.METER),(!isFinite(this.meter)||this.meter<0)&&(this.meter=0),this.meterF=parseFloat(r.METERF),(!isFinite(this.meterF)||this.meterF<0)&&(this.meterF=this.meter),this.radarValues=r.RADARVALUES??"",this.notedata=n.parser.fromString(r.NOTES).map(s=>this.computeNote(s))??[],this.credit=r.CREDIT??"",this.chartName=r.CHARTNAME??"",this.chartStyle=r.CHARTSTYLE??"",this.music=r.MUSIC;for(const s in r)["STEPSTYPE","DESCRIPTION","DIFFICULTY","METER","METERF","RADARVALUES","CREDIT","CHARTNAME","CHARTSTYLE","MUSIC","NOTES","NOTEDATA"].includes(s)||(this.other_properties[s]=r[s])}else{const r=/([\w\d-]+):[\s ]*([^:]*):[\s ]*([\w\d]+):[\s ]*([\d]+):[\s ]*([\d.,]*):[\s ]*([\w\d\s, ]*)/g.exec(e.trim());if(r!=null){const n=Si.getGameType(r[1]);if(!n)throw Error("Unknown step type "+r[1]);if(this.gameType=n,this.description=r[2]??"",tn.includes(r[3]))this.difficulty=r[3];else throw Error("Unknown chart difficulty "+r[3]);this.meter=parseInt(r[4]),(!isFinite(this.meter)||this.meter<0)&&(this.meter=0),this.meterF=this.meter,this.radarValues=r[5]??"",this.notedata=n.parser.fromString(r[6]).map(s=>this.computeNote(s))??[]}else throw Error("Failed to load sm chart!")}this.recalculateStats()}getNotedataStats(){return this._notedataStats}getSecondsFromBeat(t,e){return this.timingData.getSecondsFromBeat(t,e)}getBeatFromSeconds(t){return this.timingData.getBeatFromSeconds(t)}getBeatFromEffectiveBeat(t){return this.timingData.getBeatFromEffectiveBeat(t)}isBeatWarped(t){return this.timingData.isBeatWarped(t)}isBeatFaked(t){return this.timingData.isBeatFaked(t)}getNoteIndex(t){if(this.notedata.includes(t))return this.notedata.indexOf(t);for(let e=0;e<this.notedata.length;e++){const r=this.notedata[e];if(r.beat==t.beat&&r.col==t.col&&r.type==t.type)return e}return-1}addNote(t){t.beat=Math.round(t.beat*48)/48,De(t)&&(t.hold=Math.round(t.hold*48)/48);const e=this.computeNote(t);let r=Jr(this.notedata,t.beat,n=>n.beat)+1;return r>=1&&this.notedata[r-1].beat>t.beat&&r--,this.notedata.splice(r,0,e),ve.emit("chartModified"),e}addNotes(t){const e=t.map(r=>{r.beat=Math.round(r.beat*48)/48,De(r)&&(r.hold=Math.round(r.hold*48)/48);const n=this.computeNote(r);let s=Jr(this.notedata,r.beat,a=>a.beat)+1;return s>=1&&this.notedata[s-1].beat>r.beat&&s--,this.notedata.splice(s,0,n),n});return ve.emit("chartModified"),e}computeNote(t){return Object.assign(t,{warped:this.timingData.isBeatWarped(t.beat),fake:t.type=="Fake"||this.timingData.isBeatFaked(t.beat),second:this.timingData.getSecondsFromBeat(t.beat)})}modifyNote(t,e){const r=this.getNoteIndex(t);if(r==-1)return;const n=Object.assign({},this.notedata[r]);this.notedata.splice(r,1),Object.assign(n,e),this.addNote(n),ve.emit("chartModified")}removeNote(t){const e=this.getNoteIndex(t);if(e==-1)return;const r=this.notedata.splice(e,1);return ve.emit("chartModified"),r[0]}removeNotes(t){const e=t.map(r=>{const n=this.getNoteIndex(r);return n==-1?void 0:this.notedata.splice(n,1)[0]}).filter(r=>r!=null);return ve.emit("chartModified"),e}setNotedata(t){this.notedata=t,ve.emit("chartModified")}getNotedata(){return this.notedata}recalculateNotes(){this.notedata=this.notedata.map(t=>this.computeNote(t))}recalculateStats(){this._notedataStats=this.gameType.parser.getStats(this.notedata,this.timingData)}getMusicPath(){return this.music??this.sm.properties.MUSIC??""}toString(){return this.difficulty+" "+this.meter}serialize(t){let e="//---------------"+this.gameType.id+" - "+this.description+`---------------
`;if(t=="sm")e+=`#NOTES:
`,e+=`     ${this.gameType.id}:
`,e+=`     ${this.description}:
`,e+=`     ${this.difficulty}:
`,e+=`     ${this.meter}:
`,e+=`     ${this.radarValues}:
`;else{e+=`#NOTEDATA:;
`,e+=`#CHARTNAME:${this.chartName};
`,e+=`#CHARTSTYLE:${this.chartStyle};
`,e+=`#CREDIT:${this.credit};
`,this.music&&(e+=`#MUSIC:${this.music};
`),e+=`#STEPSTYPE:${this.gameType.id};
`,e+=`#DESCRIPTION:${this.description};
`,e+=`#DIFFICULTY:${this.difficulty};
`,e+=`#METER:${this.meter};
`,e+=`#METERF:${this.meterF};
`,e+=`#RADARVALUES:${this.radarValues};
`;for(const r in this.other_properties)e+=`#${r}:${this.other_properties[r]};
`;e+=`#NOTES:
`}return e+=this.gameType.parser.serialize(this.notedata,this.gameType)+`;
`,e}}var oi=(i=>(i.SELECT_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAArUlEQVR4nO3YQQ6CQBBE0X8PXKrn9DqGcDNNZC5QhGR2agQk6Z5QL+l9FwULGszMzN6dgB4ogFbOjQTLPzcsniZE/+fy4SHKTgHCQijZFGAALq0GUJ35u+xaDiDg3nqA15YA0bR2HwfYmdxAMLmBYHIDweQGgskNBJMbCCY3EExuIJgO18DY+k/9kGBRfZn57PnTFXgkWFYfDltnFurqESnD6zTWJ794eTMzO44JY84XrlhT/UgAAAAASUVORK5CYII=",i.REVERT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAACY0lEQVR4nO2aTUhVQRiGn1pYSVqLBM0WbQpNuLcoRIhS3AVFEEWLtiEKRRAUghAXidyoRNAf7XPhwqSfRW2jRVw0cpVCBJrR36KIfggqDswFGQY7Z+65986Zbx74tud+73PnnDNnZiAQCAQCgYAFm4BuYCMC2QO8B/4CS8BWBLEb+KTCl+ocQsgbwkc1hJDwHw3hRQjIrxLeewH5/4T3WkAuRnhvBeRihvdSQC5BeO8EtAPvEoT3SkC7RXhvBHQAHyzCR/UWKFahngJTwE01++wBNqQloGgZvtb1HXgInATqyhHw2YEw5dYycMZWxJADAdKqOWCfjYRRyx+8DeytQu0Hjqp/+Q4wv0pPv4DT1ZJQoHa0qZ6/pvmGGsuQgBJb1Kj4Y+jvbKUlFHCHE8BPrb/f6pWZmCsZFIAK+0Xr8Q3QUKmRUMA9jhhuh8u2FxvLoICIa1qf34CmSkgo4Cbr1eRoZa+D5VxwPGMCIi4aJkmkLeES7tKohn6p1+i50Jy2hMO4zSOt31NpXHQAmAb6cZ/zmoAbCKNHE3APYezSBDxDGE2agAWEsV0T8AJhdGoCHiOM45qAuwjjuiZgGGG80gQcQhBdhmX0egTxQBMwiSAOGhZFehHCZrUMtjL8c2ANAqgD7mvho5FwAAE0AE8MaxbRq9B7OoBZQ/himrvILtICXDXsB5Q+fFrxjLXATrX3N602PkxrlS+BbTjMOmBEfZ/HPSQRzep+xNirmMjCQe7BGEGS1mvgGBnhVorBZ4C+ck+J1OLkue3JlEV1NOaCevpnlsaEhyR2ZOHeDgQCgUAA9/kHkepiJFq7BJgAAAAASUVORK5CYII=",i.ADD_FOLDER="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAvUlEQVRIie2UTQ7CIBBGnz8rb+Mt2hqv4TGMmt4Kexl7gUa3TXBRTAALQqGJJr5kNpR+r8ykwJ9vogJaQDrqlCrwhWeRfAoPrRYo5xRI4OYTpGLkLDMEevl9wXqGzC2wH3uQa8gGOVpUAALoVAmGW+GNKSc44v4XLqmCwgpcqfVeWzNOEisQAYJGfyHkspPARu3vrGCbHrjrQz4oSSiLiL2TuBLZoljKAMEuRQBwxj2rOjX8RcXQioeqBu3Ln4QChU8M4+FlAAAAAElFTkSuQmCC",i.CHEVRON="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAbklEQVRIie2PMQqAMAxFXwfP6qJVPIjYzcOKdUkhQ0BaCoLkLS3k818CjuN8ztApYzIDl7xvmalFsAIZuIFozKPMMrC0CAJwKIkuGVX5KdkmLEm3ci1JSlLKU49yLSmXVG1es0EANvnvInKcP/AA784fpjlWwNQAAAAASUVORK5CYII=",i.EDIT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAABqUlEQVRIia3VO2hUQRTG8d+GEC0sRMVKU4naKAQrESEoWBiwshALtREsLQQRGytNt2CvaCPiI52NaK92NlG0kFXw1fgIanztWsy57ma5l52b3APDcGfO+X+z5357h2ZiD9oYa4i3JPZjAT1cbVrkCH4F/HfMV5oSOYW/AZ3FXg3+krMB6uL0wPqKRVrSy+xJrTlakrNPv13tOvBxXI/C75ipyDsXOT8wnQtfhTtRuCA5pyyOSW37g8O58DW4H/APmKrIOyS1pouTufB1eBTwDrZW5E1LLenhfC58Es+j6BM2V+RN4UvkXc6Fb8frKHqr2hFb8D72b8i05S58jKKH0ju4NCDSiryNeBHrDyQjjIwd+BpF85gY2Cv838ZaPI3nx3GIrJiNomJcGNovRN7F/AwbcuFwcUhgWGQCr2L9jWSE7GjhZYlA8TFr4Vo8f8bOOnDSv7MMXownMX/D7rpwuDlCoPjAHVwOfD0WR8C7OFEXPB7zceU+7uBuHOA27tUVKGJe/6Q/cQsHNHD1jUnuWJQ8fQabpItkNeb079zljiWxTfJ9Z4XQ/+MfA5yyJxzqcDgAAAAASUVORK5CYII=",i.ADD_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAABiElEQVRoge2YMU7DMBSGvwQJVO7CwN1YYEFUMAMdYCpHYUMcgg49A3SgEggGE2GskNh5frYr+ZOsppWS93+q9WIbKpWKD4fAHFgBH8BX4NgCt0CbOjiY8M8BYYfGkgwS8wjBs0qsrOKnwH7g/dkl7DkfGh4K+CfsotL7lz3f1SViCjTAnfPbA8oSMQUgg0RsAUgsoSEACSW0BCCRhFRgrA23KHcnqYD9Ijwjg4RU4MJ5RshYSIJ3SAVmwNM/AcfGuyR4h1QAjMQ58EL4cnyQxqO4279T4F0zywYjJlUgN1VgF4jRRkM5Ag5+PgcptY16U+IUajFLiA2RzpJSTqEGuHdqipfXqQT6wkeRSCEwFF4soS3gE14koS2wcGr0bWxEewRtgTf+hm2dmu5u7TW0gLbAFaZl3vA7PdyaLaalboBL++ZSX2R1P7Az+Ah8WtdTjtdV8RFYW9cnFCgxhuRcJ3R0RO18knOdIgQ6iannOkUIpGaLCT96Mrenn2USM+AYuAYeM2epDPINL56D04/lX9sAAAAASUVORK5CYII=",i.MENU_VERTICAL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+ElEQVR4nO3XS04CQRSF4X+kYx8h0UWIM5vFoIxVdkCgmbMDlSWBsAchLMLWVHI76ZC2pnLgfMlNOqlJn1TdeoCZmZnZSbqNknUPrICfqCXQRcw1sG2EqGsHdBAybAlR1wtCZpkgaUzGUyZIHyFne43ebPg0JuUSeAe+ot6Ai//+KTsWPaCMKhBVAlWj0dP3GMGZqFp2rUptZqaZcyTNlIwyE2SCkOKPpfUNPCBmvBcmhRghqohlNlGcCTtUV8Ac2ER9xEVSyjmwbtm1PtWu8YPMOfKIkNmxPHVfM0GeEWv0bUuIjWLDd+ONXodYAHcIu4kyMzMzOzW/IiF2pLfCTcAAAAAASUVORK5CYII=",i.COPY="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVR4nO2YQUoDQRBFHwiDB5AsXCSexYxeIVfwCDlE1hoXuUBuodl4CDGOgSyySrIKGGgZ6EAxTBZOVzc21oPe9OJX/eqqgSkwDMPIiT4wBhbAGjgCTuFsgBnQi5X4JTABDkoJnzvvwJV28nVV3iIn7sSZa1e+mfwrMAKugQv+OBOR+DfwQGYDexAGZPI3wDOwUhxk58/R606BQYiBsRB9Eff3wD7RPOyAsquBhRAaicqnSt4JE3U3/Jq1EKkHFt82p7sP4BYo0KUAhsBSxHrqIiR7+/S1WYm7OvmYDEWsqouAfMY2U9qVb1I0BlvFQNtdTFxIPDOggLMXwGYgCGcthLVQEM5aCGuhIJy1ENZCQbh/3UKb3A3McjfQ87vKbA3gF63zXP+J2/hKuJUoRaxPLdGpEF36IDH2QneNvdCjlvjAb8pSbua2XTdz5ygTmtj6BZc6ff+sVaTtdOX1VStvGIaBOj8GcNhDDTqXrgAAAABJRU5ErkJggg==",i.TRASH="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAABdElEQVRoge2YsU7DMBRFDwxlgb0wlB9BLMDXtFvhE2BAogNDxR+1S+ETEBJiLqVSU6lVGOwoJsQhDnEc0DvSU63c+OXeuElVgyAIddMBBsAUWOqaAH2ttZoj4AmILfWoz2kleyiDNvNJzWjpSgxITUbAEDjUdamPJXo/kMdCpqQGhzn6laFPGvRVmg9Sg90cvWvoiyYM3QArfv5O+64VcG0zuVNwfAHsu+f2whI4yBN2LRNi4B714IUmQnnJxbYCecQV57ngfA3bCvwZJEBoJECGO9R7+9ZRawTzx8XGWutrR83lGl+o+zVadM5v5+ciz0BoJEBoJEBoJEBoJEBoJEBoJECGKPNZVqtM3QFGqD2ckaNWGdlWCY1LgK0x9rG/b/bcWs/K4BLgzRifOMwry6kxfvXQnwfSP9zPwDn1rEQHuNA9k/7jGvp+4xh4x21rvErNgZ6PAKDuus8Qc+DMl/mEHmqJX4BNDaY3utcYj3deEP4rn4hExm+tmh+HAAAAAElFTkSuQmCC",i.IMAGE_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAB8UlEQVRYhd3WTYjNURjH8c9IozRlwUITTbMRNlNWxksWjKxkYbJQY6mUTCKxmDSkZiezm421KQsRFkgpL7Eg2Si3RJOFl5SIzVicc5t7p/9xz//O/5r41el2nnOe83zv8/zPC4usrgLbBPrbXO8DTuHHQgBm8QjvSwZfg0HcxV58L+nfBDDcht9w9P2IO1ie47SkjUCttBMDuIWexQB4gV3YiJutIDoB0AixoRVEpwCyIaoE+BV/Zxvac6zCdlwoclpaIcBt7EN3wdhxrO40wE9cS4wlt3Unv4EslQE4g5nYTlcFkFuCAxjH2dg/hzeY/lsAQ7iH87G/A7sbAPqFe6VWFiC3BDXheF0v7OsBIQOwEvdxpWzwlIouox48Mbe/H0dbF67jU7RvSaw5LVGu3Ax8w9aGti3aTmCPcP0+xdHM9f6o1HXcHQPXoQeF0+9k7I/Efm+BbzIDZQDG4tjLGOwtbph71CwTXkTjZQByS7ACo5jCK1yOgQ9FKMJJOIXDEaZtFWVgDF8iCKxDX4Fvr1CGkXn2BWWg/u8v4mu0vRZKMF8zuIpjGetmA4zGeZcy15zEJukt2aSck/CIkIXPmQB1HcTDKgD2S9zlLfQsZ1IOwIM2gmfrn3oP/J8AqW9gc8Vx1uJd7uSa5qd1VW2iKNhvOK12/OBuEgoAAAAASUVORK5CYII=",i.AUDIO_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAADFElEQVRoge2ZzWsTQQDFf200qVrBUBAURU/aVgTFSvUoXsQqgoIUFDx68SKieBILeujJFhH/AD0VRBD8REHBD/zCIqUm6kG0UqltE0FFqqkedif7Nuymm2bTbWUfLLy8+dj3kpndmQnEiBEjxv+KDuAx8BroBlLR2qkMx4BJ4K9c5yN1FBD1QA9u4+bKVdjXPOA6kAf2h+jRFymgD7fp+yWfK0GztPsKNIbm1ANp4AFus31YoaYbIAG8l7YnwzJbiuVAP26jvVjDCaYfAOCQtB0FFldrthTrgSG5ySTWBFYEDbAHa7zfBBpsLQFkpf2JUFzb2Gbf0HT+C+j0qBc0wFWpd1j0g6K/qc6yg04sw6bjPFYgLwQNcETqZXGGYAoYk7JN5TpZAHRhTZ4/JTf3u4awhpIfggZYhDXOTd1dUnZR9HPlzD8MaNpcA8DKKYxVMonPSN3Lom8V/aNf464KjBewXjLpAKa8AqSAO8AXYIfoLVI3DyRtvQ4YlrIVXjfSZ+5xYH4Ac0HgFaBNtIxt0GBAyraLrpN8rxHrpcJq4b3A7+q9+2IQ+GHztcAWKbstXCfsE+HthmiAhPCJKg1OhZ/ANfm8U/hL4RuFPxfeYogGmGlcEd4uvF/4GuHDwpsMiTKAvpTU6IhwfUiMCm/CA9WsWcrBr99G0b+JnsDZS+RK9IKtF0NG+Qso6ny435dZ1KMMsEr4uPAlOCHyoqdx/BbrRxmgWXhW+FLhOoR03M+KAPuEPxW+Qfhb4cuEjxmiAQrCk9QWC4Hd8vmGcH15vRK+WfigIRrgg/Cj1DZEK84eN4P7F9C10Qvh+rZ+5tXpaWZuMZcE7mI9DvUt3Cp1c7i/xM9S5rmYmw3L6bNS95Lo7aJ/KtdBA3AKeEc0GxrdeXVI2QXRfTc0laDWW8oMzvxM4t6ptVVjXDFTm/oDooe2qTcI+1glB9zCfaySkfahHqsYzOmDLYM5fbRoEPbh7jppN0KND3cNyh2vj5dp54UkcA/4jvfDoabw+oOjZ5p9Rbbg7AAeYT1Fuqn9AjFGjBgxIsA/jvJ6jenUZ2YAAAAASUVORK5CYII=",i.SM_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAcpJREFUeF7tmFGOwkAMQ+H+h95V2S2qqlKcsZ101PADQpPEfnFHgufj5q/nzf0/GkAn4OYE+hG4eQD6EuxHIOER+CFnWJdkbf5vfAEwOoephbiPCoOaN4A/AswWmVpoSZ0ACBN3iNkiUwup7gRAmLhDzBaZWkh1JwDCxB1itsjUQqo7ARAm7hCzRaYWUq1KwJlQxoSr7xuOAsD2x85RPweAbzOh7S+HWACrkKXP9vNWgBoAMjMFwJHhT9+Ngt7DQ2faAXza9vrjZ5suVQIiM60AzoSsg/cxZRMQnWkDgAjZQ2DumuhlF9H30hnZTLj5ycWIbsg+EwUwIgQ16TgH60UAwM0cToiekG4EwNHNTuhKKYXMZ9wBKW53Q2DzUQAzJCFkfgTAlSGEzY8CuCKEIfMMgCtBGDbPArgCBMq8AkAlBNq8CkAFBIl5JYBMCDLzagAZEKTmHQCcEOTmXQAcECzmnQCUEGzm3QAUEKzmMwAwEOzmswCMQEgxnwkgAiHNfDYABEKq+QoAZxDSzVcBOIJQYr4SwBbC8rlMC/qv8CpS/V62+VLqaopMv+oEMNoltQ1AgnHiJp2AiZcnkd4JkGCcuEknYOLlSaT/AqRIb0Fn6qw5AAAAAElFTkSuQmCC",i.UNKNOWN_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QA/wD/AP+gvaeTAAAA+UlEQVR4nO2awQqCQBgGv6KeM+rU+1/L7F4RreY/W86ABw/ujsMPImwiIiLSwlh0XZIcit6piaoAY5JbknPNa31OZYAuI1QH6C7Co9zS63cXgQrQTYTqAMOL+9MC+35MdYBjniOgk1AdIOksAhEg6SgCFSDpJAIZIOkgAvkZfHcNmfDvsJkoOHeNlvVbuCbZtzzwbwGSRp/tzM1+nh0t8ILWiZo1MaufAAPQAjQGoAVoDEAL0BiAFqAxAC1AYwBagMYAtACNAWgBGgPQAjQGoAVoDEAL0BiAFqAxAC1AYwBagMYAtADNN84HLHFOqIzVT4ABaAERERGOO8QV911rDPw7AAAAAElFTkSuQmCC",i.MINIMIZE_WINDOW="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAANtJREFUaEPtlbsNwlAQBMcRLQC10QZEiAAi0wa0xqcMdIiICGmejZ60znfPN3OWBzp/hs7fnyzwb4MxEAOSQE5IAtTxGNAIZUEMSIA6HgMaoSyIAQlQx2NAI5QFMSAB6ngMaISyIAYkQB2PAY1QFsSABKjjMaARyoIYkAB1PAY0QlkQAxKgjseARigLysACOAEbYCX75oo/gCuwrwXOwHauyY3njLVAbbNsXDxX3bMWuHd0Ot9gbrXACOzmQtZ4zvuE6iM+fj7ideMBU9XV1VyAQ/4DUyH+tbd7Ay+Srg0YYU5a1gAAAABJRU5ErkJggg==",i.CLOSE_WINDOW="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAA35JREFUaEPtmbfrFUEQxz+/0pwwFNoqmMCcc46olY1/m7U2Ys45IWIuDFiJCYyYC0X5ypwcx93t7O57yIO37c3Ofr8zszvhBujxNdDj+OkT+N8e7HugVzywGtgLPAB2A1+6BHw4sB+YBuwBLoTO8YTQMuAYMNSUXQM2AZ9CyiO/jwBOAAtt3zdgG3CuTU+IwFLgeAl8oesWsA74EAmySVzgTwILKgJBEm0ElpvlhzScegPYCHzMJDEKOAXMbdDzFdgMXKr73kbgFTAhAO4msCHDE6OB08DswDkvgImxBK4ASxzWVTitB947ZMsiYwz8LMc+XeZVsQRGmmvnOQ64a3firUNWIgobWX6OQ/6O6X4XS0DyIqHLNd9x0D076E1AdixwBpjp0HnbdDZ6N/QK6YymF6Lu/IfAGkD3p26NM/AzHOBdoekhUJAov9Ft5z8ClPiqJAT+LDDdAd6da7wEdKaypEgscgB4bCRemux4A68MG1pu8FIUQ0DyyglHgJUhFMATI/HTsulUx56rluU/O2T/isQS0J5hluCUpUNLJLQmhwSBi8AWQInLvVIISPlg4LBZ2H1Yi+Bly7bRRWIqgYLEIXt1ckioRJDlo8GnhlAZrDxxEFibyEA10A7ge+L+pDtQPWuQkVB1GrOUIHfmgO+EBwrAInHACjsPCZXou4AfHuE2mZw7UNYbk621TyWCwi67n+gEASU4hUPRSXmN2pGmKJdAKviCZDaJHALKyuqV1bnlrOvW2SX12KkEOgW+IJ5MIoWASgkVdYsdZlfLqeVpilTEqcd210Epz6gsfxRY4QCvTkovza+GiUOdimgSMR6IqUQL8EUnpWdWWdfT2UWR8BKIAa/+WJav9rBdIeEhoHpHYePpAZrAF+ESQ8LVG4QICLwamNqRRiWIQ+AL8ZhpR5BEG4EY8JpIqJmvHX3U3NaOkWgjoFpfw9XQ8lq+qsc7ldM+NU/b64C0EXgGTAqgj7V8HQnNiELTuedNWNoIKO4V/wqluiXwem2807gmW8gTbSQ0od4KnI/1gOSr/wYKHfct5nPBly+2Ro3VCbU6NYWx5km1K/QKaVN1zK7BlbzzOnQ5Ir/rYpdJCLziXt5pXB4C2qxQ2Qc8NXeG5p+R2P+Ja2Ktx2OK/cpqBa9dXgKF7O9UZN3aF0OgWxiy9PYJZJmvA5v7HuiAEbNU/AEymbExfA8cowAAAABJRU5ErkJggg==",i.SKIP_START="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEklEQVR4nO3YPy4FURTH8asQFBKvsAeNbQixBxqVxi70lqK2BZUlPKJ50SlQ+Ih4JMZ48+fOTDKT8+2/v3PO5M6deyelIAiCIAiC4A84xgPucZTGhq/Gv5m3zJhhO6OHWWtfgYbuOi7xhlecDelnDYA93Bb0xVB+1gA4wXPRHcr/RZMA7OK6rPAQfil1A3CAx1XF+/T/pSoAW7jCe1XxPvxKVgVgH3d1Cvfh16IsAGu4WG5tjejCb0RJxiZumhbuyk9NKck4z2g+208xgJEvoTT2lzhNYRudzIdsEkeJyRzmJnGcrnEheUoD+T/kPIHClfAFp0P6XV7qd7DRxs32P3+lLIeY47BVSBAEQRAEQZD65ANrrC3m/GFNbwAAAABJRU5ErkJggg==",i.SKIP_END="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBklEQVR4nO3XPWpCQRTF8RskEBBBy+wgvZuICNlCKgsrt5AqC3m7kGzB3l6tREgnUYt/GHyveJBq7pvRIefXn8sceB9zzURERETk7gBTYAdsgUnskAEwchwiOs/14I1NzIAZcALOwCfwmDnfElPg0B7BCnjJmHcX+MsRWAAPufPWUYHGEnjOmbeOCwR74C1X3hIUaFRAP3XeEhYI1sA4Zd4SFwguwAfQS5G3DAUaX8BT13nLWCCYd503FfgHj9Cl5Jd4XfJntCr1R7Yv+SqxLPUydyzpOv3tXEi8eXeBd+CnXgtjVkJv3legHhJ+KMOosDOPd6m/NWBSl9gAr7c+j4iIiIjdoV+nEzteGs3QogAAAABJRU5ErkJggg==",i.PLAY="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA40lEQVR4nO3YMS5EURQG4ENBr9dKsAMq9qCdLdgBSh1rsIVZAjZhelrTITGf3GIiCsm8mZd593K+7nXnb/7890WklFJKKQ0HGzjGKTajNbj17R770RK8+al8X2IrWuB3TziJhgMUM9xhJ2plMc84i4YDzI2xGzXR3SvOq6lcy3vAQcsBig9cY7vVAMNXrv584qLlAHN7GaAL/ZmVDRXr1tPxkzLH1378f6/RRxwOdvgKAaYtT4lxq2PuBaOokT/8oJkMVo0rPurfcTVoNXaBm+o2/hI/to7KHK6mGlNKKaWUYiFft4ARJbTJcIwAAAAASUVORK5CYII=",i.STOP="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAo0lEQVR4nO3YQQrCQAyF4XcQXffsFsGLqdhe4C8BFzLgYiAJFN53gc4/6WYimZmZ2UkAV+AO7OTbgQewVB7+Rb13fKsiIG6+y1oRUPHb/LNVBLSSAwaewCRlo5kcMPAEJikbzeSAgScwSdloJgcMPIFJykYzOWDgCUzSyR/1n4qAWDp1uVUELN+lU7UncEkP+NnOrbG3KTj4FjdfdngzMzNTvgMULRo3zp7/ZwAAAABJRU5ErkJggg==",i.RECORD="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMElEQVR4nO2XPU7DQBBG3yUo+AniOkgQcQ3ID2ehA4EoKOlDuAmOcgpiOhJ9yNIUlguwE+/YEfOkkSxX39sdz3ohCIIgCIIgaAXBqWAieBdkgi+rzN6NBQP6huBY8CBYC/RHbQSvgjP6gOBKkNcIXq2VYNh1+Ftb0abhy7sx7XLldwlflvDdCcHJlm3zWzsdeQo8txheVo+eo7LOtGla62JnPQSmCcLLauQhME8oMPMQWCYUyDwE2pw+qlS+7wKfHgKLhAIfHgJ7/xGPEwpcewgMEh1k3y4HmUk8JRC4dwlfusCs2pw+gkM3AZM4b6mVNoJL1/CV/6JdLzSTTsKXJIZbtlPRNhf0AcGB4M4mSZ1Vf3Hv+QY3tZHgrThV7bcjt+eZ4MZtVAZBEARBEPwDfgDcyqJBiCPoQAAAAABJRU5ErkJggg==",i.PLAYTEST="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGklEQVR4nO3YQUoDMRTG8Y8W7NauXanHsL1JEfeKF9NTuLBTF7YHUTftCC2VvwSzKNKhJkLzpn0/CAwhMO+bFxIYyTnnDgrQA+6BCljEEZ7vgBNZBpwBM5pNwxoZ/vIzdns12Ql+ts1f3coaYJIQYCxrgHlCgLmsAT4TAixkDfCSEKCSNcBNQoBrWQN044W1yzislUVAPxbY5Bk4lWVABxhtKT7MddQW/KK2wQMU5h0ozWQHgEvgEfiI4yHMtSIAcAG8bznf34Bz8wGcO0bAEHgCavavju8e/Kf4L8pbZ4WI6a2Y5AQosW2arHICmCIPUJiOsQM1dizbfoxWOQEG8RIpbQ1cJQfYCBF+m68KFL6Mf/ryinfOOe3DN5wZTw/aQ/uuAAAAAElFTkSuQmCC",i.ADD="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7UlEQVR4nO2ZS07CUBSGCT4GDn2MQHch0YUYjC4EwwLAuRA0LsGIAxUHrkKjC/AxEnBMnXzm6DUhFeJ9tb3EfkmTJoXb/2/a03P+Fgo5OTnOAHPANlAHzoFH4B34UJvsP6hj8pstoBiC8HXgEHjFnBegCZSzEL4GnAAR7kRAB1hNS/weMMQ/A2A3SeELwCnJcyzn8i1+CeiRHtdyTp9XPk3xP9wCiz4MpHHbTKPjKn6f7Knail8B+lmr57vimZdYVedDoW0qvuzpJeWLCNgwMSDtgStXQEldDB9VrGnSmNn0NnHKsZ7JlWetBlB1lc5MWNcHFR0D0u6GauBAx0A3YANnOgZk8AjVwL2OgaFNtflz4d/nsalOfZ2FTeu/9USFeXUa/QsDQ8NFezYmlPibJG6hmX+Iu7NeRusBG6jpGJDQKVQDmzoGiip0Cq2Ze9JO81Ri5spXdbKsNpNoaIkPdKAZGb/tVdwXCkdG4pWB5UCG+oF1bipZZdbqgR0r8WMmJKvMipaT+LEZ+SID8VfAvLOBsXBXAte0uPQW7sZC3jQqU8vblZ9ipJpQdXpzfmANc9O2esG4MpI6L2U7FfExIyXVdkjoZIr8p2EzTydhRBrAiuQ20rPL4KEmu0htsn+njtWkqwziM2tOTmH2+QRxCeic7ZLqUgAAAABJRU5ErkJggg==",i.SPEED="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYklEQVR4nO2ZS04bQRCGrcAmu0BWAYM4BCE5R4QQJ+G55bEFEZQLZIEgCYiHcw4QF0hgQWJgazubLyqpIjWOx1M93fNAml8aaTRWd/9/TXVP/eVGo0aNGsEAXgDvgTXgK3ANPAJ/9HrUZ1+AVeCdjGmUDaAJbAO3+OMG2AImyyD+GvgE9AhHF9gHxosivwjcEx9tYCFP4qMadSvOJT00zVoe4z7KWrHJvwTOPCPadMZPeY49lTVjRt6XfKiAfyLC34Rn2rhoafoI+e8Z59iLsWH7cQFMa37LfSiOVWjSXpkPOSrvU1JDhITgwE0TFdGP38BYzNSZiiTgCfmUveKXShqJXkpuz3gej2nkRzWdkj52Ez4CpDzIC0nkD1LGbfoUZj9zIn84gPwI8NkwVuqtEYsAqSqrFHkXcxYB61Qr8i6WLQK+UU3ygiOLADEeoZATbGnQyZEhbVxcWQQ8RKgqB75qI/nzIeu1LQJ6EYqygWe2MfLNIet1SxMgz4xjm6ECHiJUlf+lELBiHNsasl67yE28rFGf0PsY/vnKIkDaIlXFoUWA9HaqiiWLAGk6VRWzZRdzIfhh7uZpx6xq2DCRVwGTaiIowBNfGObreBkaFSHtPnL2xNb5dr3IO6Ze2n15eWLrfL8ymXqdcCEnT+wz34dM5B0R0qssCztB5B3zUcbX+Sxak1ebu9KrLAon0Zq7fWZkrwDyu6buQ4CQeT0ZYuMueMN6iBjTt5H0sfNBR6P+qhDyfUKk1t/MWDtJbbMBvCmceEIBOKeu60iMhzq7nl5yf6m/ibl5W4m/WWvUaDx//AV2V/CQip4uIQAAAABJRU5ErkJggg==",i.UNDO="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeklEQVR4nO3Wv0tXURjH8dtgEuJaoEMSguBQBNUiVGv9D41uTg3S9EWiobGpv6Gh0Mk/IAyKnIxoq8SiEm0Q7IdErzh4S9Hvr6vnDMHzXi/3+Zz3c89zzq2qIAiCIAiCIAiCGixhGaerBmAA19HCAl7jK3bwDR+wgnnM4ipONsnodyF/edWPBCbxEBuas44HuFBCoKsEJupO/5aHJ6lmboFDEvVWuVtvjdzs4H7KyCnwTwIjeKE8zzGWU0A9lGkQu5GGdREzmMI4hnAKo7hcP3uE7R61vuB8ToFufMLttNgGOcOYxvsuddPBcLGkwC/MpQ437tRe3iDu4GeHjM/p65UQ+JjO/aMuvE3uJbztkPWs78FuINDXPdFQYgRvOuTdyy1QSuIMVttkfce53AKlJK7gR5usxyUESkm02uSkQR8sIZBdwu7d8e5AxiZO9Hpx7RgSL3MJJHANW/u6f6vqBW4cQ+JplRm7vzA3cTZ37SAIgiAIgiAIqv+aP0/ezoLd5BjTAAAAAElFTkSuQmCC",i.REDO="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABi0lEQVR4nO3WPWsUURSH8Y2oIJKYRhdiEa1SCJqXVvAzuEXMB5B8BEuLiKRIk8pSLC1WSJMqBEIgasoglmKRYBaVFEGEpPAnK7dY193ZndlZWOE87cw59/nfe+alUgmCIAiCIAiCICgILuM+nmADBzjET5zjBB/Ttad4gEs51xjHduqTqzar6V2s45v8fMcL3OlTfq+ltjqo+EzazTL4lXrN9ClfPEAalbU0FmVzjmet49FFvlgATON9hsBXvMIy5nETV5pCuI4FPMYbnGb02cdUhnz+AJhLM9uJXdSap5PzJBfxoUvPoxTEwAFwr4v8JzzMtRP/9r6AR/iSIVs8QBqbTm+YOiYGkW9bp4qtUgOk2X3boXilLPG29a6hUWaA1Q6Fz4ckP57xwOYPgNs4ayuqD0n+KnZyyPcV4HVbwWdMjsDO9w6AW+nr2EpthOR7Bpj1N+8wNkLyPQOM4eWf2zhu/rCVKZ/W2FScH339jeIGLpYtn3o3vyNFaGBpGE5BEARBEARBEFT+S34DOXeCiMi4hZkAAAAASUVORK5CYII=",i.CUT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACxElEQVR4nO2YvWsUQRiHRwMKKojkQxMUOzWiXbCxU7BQMRFRrCKKtQqXiF8EY+dfYEQrxcZW/QdEbMydWhhQLERR8QPWJIrBmHtk2PdgGXZnZ/d2zyn2gYMQZmZ/M/N+zatURUVFhbcAvcA1oAH8lJ/+exLoUT4DHAZmSeYHMKI8Fr9EOkvebYLQbGwnbxJ4ZU6ENh9lAagB/fKryf+iXC1Jy3JgFHgDfAGOu0x6boirxYwZN8Y0ShC/B6gb3/nsMnHOmNQfM2bAGDNXoPBB4EGCub5yWUDbdJR1DhsIChC+HrgBLCaI15axw2Uh89rOOJjQszaErwIux9x8i4/AKe0PrgteMhbQDnsO6JaTH49x4gs5HfQE8CFB+C8JKGuyLtwHfMOdr1nDKLBXMnpSbrkDbMx6KNEPHLLYYpQ/wIEM624HHlnWewwM5RZufGw/MJ+ygVHHtTYANy2H8hY4Uohw48Pa5u8CTUs9dB5YaXHQK5aDCCQxrihcvCFkCHhquYn3kjGXRRz0KPAuYfyi3EhfqcKNTWhRpyWlJ/EEOAm8sIzRSWpbx4Sb6LCma5+YUJrGjPYr5QvAlpSI0kKH5LNAl/IJYDUwIaE0jt/AdWCt8gmgS1K7TvFx6Ih1D9isfAPYB7xMceJdlvm7gVu64uy08EHgvmsYjZm/ScqDZkfDKOEL7DbwN08ikzW2At8tiWyslESma5yCS4mpjpUSwLDl1KNoQQe9KuYIy+mkK08qp3tzlNPm27tFs61yWl5HWbsSF3160NRzdCWms24gw5PyU9YnZZCjK1HUo34q5VG/s6y2ymy7GzAc/WHCJmZUGjHONeZgQnVVTmOrYZqTy0TdOo+yIMlmwNKVKLu1+Fpqr2Muk3okw7qifaZb+QQwkqG9Pqx8hHATQcrJ+yneMKdJyQ3zEqGm5Unpl9lUVFRUqP/BP5CqMiH1c5cpAAAAAElFTkSuQmCC",i.COPY_WHITE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2klEQVR4nO2YQQrCMBBFcxBd9yr2qBbBO9mtis0FngS60CiV4JAx9b9tFpmX+WFgQhBCvABsgQMQqccI9MGo+As+nCwE0svTskD0Kh7YWQg8EVoDCTjDP3SAunMiAkegMxFwnBPXdLeFgOecGCwEvOZEYrIQWDy3htL7JGAM6kCG/kAhKEIZilAhKEIZilAhKEIZilAhKEIZilCFCI1Lu8oWOtDPEm93lT8v8AkJFII6sMIIRfy4WQikRasXewuBbl601uYMbL4WeNhQD2lXWaHwKb28WfFCrIw7KN2RSPl95zsAAAAASUVORK5CYII=",i.PASTE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHklEQVR4nO3ZQUoDQRCF4Ua8gC41rnMVPYSoxzMIgopXEPUWcatiZuH2l4JeTBokdlXsacL7YFYz01PVr1bTKcmOAfaBK+AV+M7XC3Bp91LPgMNc7G+egYPUI2AvF7jJkz2begNc8HfnrYo6AW6AgXoPwDEwAx4d7w/ALTCPFP+B36xYy+vT3vc0YDsfcTRay5KIWHga8IzN2F0eH7vug2utPA2s2XQ/KlV+Xw0Ab1sMYDlFAmdbamIJnDZv4L+hBgpKoPUGogRiUAKF4IYqgdR8BpXAOiWQNEJ10AgVUmNEv68GglACheiOKoFaSiCI6AjvQgID/fjyNGCHC7249jQwz4cLU3sfH5bUNmEnKwv7Pz9B4SvbeXfxIiKphR8IWaCtfT4/XAAAAABJRU5ErkJggg==",i))(oi||{});const Qk="modulepreload",Jk=function(i,t){return new URL(i,t).href},o0={},_a=function(t,e,r){if(!e||e.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(e.map(s=>{if(s=Jk(s,r),s in o0)return;o0[s]=!0;const a=s.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!r)for(let m=n.length-1;m>=0;m--){const l=n[m];if(l.href===s&&(!a||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${o}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":Qk,a||(d.as="script",d.crossOrigin=""),d.href=s,document.head.appendChild(d),a)return new Promise((m,l)=>{d.addEventListener("load",m),d.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())},h0=globalThis.showDirectoryPicker;async function tR(i={}){if(h0&&!i._preferPolyfill)return h0(i);const t=document.createElement("input");t.type="file",t.webkitdirectory=!0,t.multiple=!0,t.style.position="fixed",t.style.top="-100000px",t.style.left="-100000px",document.body.appendChild(t);const{makeDirHandleFromFileList:e}=await _a(()=>import("./util.c95f34f1.js"),[],import.meta.url);return new Promise((r,n)=>{t.addEventListener("change",()=>{e(t.files).then(r).catch(n),document.body.removeChild(t)}),t.click()})}const l0=globalThis.showOpenFilePicker;async function eR(i={}){if(l0&&!i._preferPolyfill)return l0(i);const t=document.createElement("input");t.type="file",t.multiple=!!i.multiple,t.accept=(i.accepts||[]).map(r=>[...(r.extensions||[]).map(n=>"."+n),...r.mimeTypes||[]]).flat().join(","),t.style.position="fixed",t.style.top="-100000px",t.style.left="-100000px",document.body.appendChild(t);const{makeFileHandlesFromFileList:e}=await _a(()=>import("./util.c95f34f1.js"),[],import.meta.url);return new Promise((r,n)=>{t.addEventListener("change",()=>{e(t.files).then(r).catch(n),document.body.removeChild(t)}),t.click()})}const c0=globalThis.showSaveFilePicker;async function iR(i={}){if(c0&&!i._preferPolyfill)return c0(i);const{FileSystemFileHandle:t}=await _a(()=>Promise.resolve().then(()=>rR),void 0,import.meta.url),{FileHandle:e}=await _a(()=>import("./downloader.9d5591da.js"),["./downloader.9d5591da.js","./util.c95f34f1.js"],import.meta.url);return new t(new e(i.suggestedName))}const to=Symbol("adapter");class Wf{constructor(t){this.kind=t.kind,this.name=t.name,this[to]=t}get isFile(){return this.kind==="file"}get isDirectory(){return this.kind==="directory"}async queryPermission(t={mode:"read"}){const e=this[to];if(e.queryPermission)return e.queryPermission(t);if(t.mode==="read")return"granted";if(t.mode==="readwrite")return e.writable?"granted":"denied";throw new TypeError(`Mode ${t.mode} must be 'read' or 'readwrite'`)}async requestPermission(t={mode:"read"}){const e=this[to];if(e.requestPermission)return e.requestPermission(t);if(t.mode==="read")return"granted";if(t.mode==="readwrite")return e.writable?"granted":"denied";throw new TypeError(`Mode ${t.mode} must be 'read' or 'readwrite'`)}async isSameEntry(t){return this===t?!0:this.kind!==t.kind||!t[to]?!1:await this[to].isSameEntry(t[to])}}Object.defineProperty(Wf.prototype,Symbol.toStringTag,{value:"FileSystemHandle",writable:!1,enumerable:!1,configurable:!0});const Bd=Symbol("adapter");class Co extends Wf{constructor(t){super(t),this.kind="file",this[Bd]=t}async createWritable(t={}){const{FileSystemWritableFileStream:e}=await _a(()=>import("./FileSystemWritableFileStream.b600caaf.js"),["./FileSystemWritableFileStream.b600caaf.js","./web-streams-ponyfill.6e34fb66.js"],import.meta.url);return new e(await this[Bd].createWritable(t))}async getFile(){return this[Bd].getFile()}}Object.defineProperty(Co.prototype,Symbol.toStringTag,{value:"FileSystemFileHandle",writable:!1,enumerable:!1,configurable:!0});Object.defineProperties(Co.prototype,{createWritable:{enumerable:!0},getFile:{enumerable:!0}});const rR=Object.freeze(Object.defineProperty({__proto__:null,FileSystemFileHandle:Co,default:Co},Symbol.toStringTag,{value:"Module"})),eo=Symbol("adapter");class Ls extends Wf{constructor(t){super(t),this.kind="directory",this[eo]=t}async getDirectoryHandle(t,e={}){if(t==="")throw new TypeError("Name can't be an empty string.");if(t==="."||t===".."||t.includes("/"))throw new TypeError("Name contains invalid characters.");return new Ls(await this[eo].getDirectoryHandle(t,e))}getDirectory(t,e={}){return this.getDirectoryHandle(t,e)}async*entries(){for await(const[t,e]of this[eo].entries())yield[e.name,e.kind==="file"?new Co(e):new Ls(e)]}async*getEntries(){return this.entries()}async*keys(){for await(const[t]of this[eo].entries())yield t}async*values(){for await(const[t,e]of this.entries())yield e}async getFileHandle(t,e={}){if(t==="")throw new TypeError("Name can't be an empty string.");if(t==="."||t===".."||t.includes("/"))throw new TypeError("Name contains invalid characters.");return e.create=!!e.create,new Co(await this[eo].getFileHandle(t,e))}getFile(t,e={}){return this.getFileHandle(t,e)}async removeEntry(t,e={}){if(t==="")throw new TypeError("Name can't be an empty string.");if(t==="."||t===".."||t.includes("/"))throw new TypeError("Name contains invalid characters.");return e.recursive=!!e.recursive,this[eo].removeEntry(t,e)}async resolve(t){if(await t.isSameEntry(this))return[];const e=[{handle:this,path:[]}];for(;e.length;){let{handle:r,path:n}=e.pop();for await(const s of r.values()){if(await s.isSameEntry(t))return[...n,s.name];s.kind==="directory"&&e.push({handle:s,path:[...n,s.name]})}}return null}[Symbol.asyncIterator](){return this.entries()}}Object.defineProperty(Ls.prototype,Symbol.toStringTag,{value:"FileSystemDirectoryHandle",writable:!1,enumerable:!1,configurable:!0});Object.defineProperties(Ls.prototype,{getDirectoryHandle:{enumerable:!0},entries:{enumerable:!0},getFileHandle:{enumerable:!0},removeEntry:{enumerable:!0}});const ZR=Object.freeze(Object.defineProperty({__proto__:null,FileSystemDirectoryHandle:Ls,default:Ls},Symbol.toStringTag,{value:"Module"}));async function kd(i,t={}){var e,r,n,s;if(!i){if(!(!((e=globalThis.navigator)===null||e===void 0)&&e.storage)&&((r=globalThis.location)===null||r===void 0?void 0:r.protocol)==="http:")throw new Error("Native getDirectory not supported in HTTP context. Please use HTTPS instead or provide an adapter.");if(!(!((s=(n=globalThis.navigator)===null||n===void 0?void 0:n.storage)===null||s===void 0)&&s.getDirectory))throw new Error("Native StorageManager.getDirectory() is not supported in current environment. Please provide an adapter instead.");return globalThis.navigator.storage.getDirectory()}const a=await i,o=typeof a=="function"?await a(t):await a.default(t);return new Ls(o)}var Rd,Pd;const nR={adapter:{cache:!!(globalThis.CacheStorage&&globalThis.caches instanceof CacheStorage),native:typeof((Pd=(Rd=globalThis.navigator)===null||Rd===void 0?void 0:Rd.storage)===null||Pd===void 0?void 0:Pd.getDirectory)=="function",sandbox:typeof window<"u"&&typeof window.webkitRequestFileSystem=="function"}};let u0=i=>typeof i=="object"&&i!=null&&i.nodeType===1,d0=(i,t)=>(!t||i!=="hidden")&&i!=="visible"&&i!=="clip",Dd=(i,t)=>{if(i.clientHeight<i.scrollHeight||i.clientWidth<i.scrollWidth){let e=getComputedStyle(i,null);return d0(e.overflowY,t)||d0(e.overflowX,t)||(r=>{let n=(s=>{if(!s.ownerDocument||!s.ownerDocument.defaultView)return null;try{return s.ownerDocument.defaultView.frameElement}catch{return null}})(r);return!!n&&(n.clientHeight<r.scrollHeight||n.clientWidth<r.scrollWidth)})(i)}return!1},Ql=(i,t,e,r,n,s,a,o)=>s<i&&a>t||s>i&&a<t?0:s<=i&&o<=e||a>=t&&o>=e?s-i-r:a>t&&o<e||s<i&&o>e?a-t+n:0,sR=i=>{let t=i.parentElement;return t??(i.getRootNode().host||null)};var f0=(i,t)=>{var e,r,n,s,a,o;if(typeof document>"u")return[];let{scrollMode:u,block:d,inline:m,boundary:l,skipOverflowHiddenElements:f}=t,p=typeof l=="function"?l:S=>S!==l;if(!u0(i))throw new TypeError("Invalid target");let y=document.scrollingElement||document.documentElement,v=[],_=i;for(;u0(_)&&p(_);){if(_=sR(_),_===y){v.push(_);break}_!=null&&_===document.body&&Dd(_)&&!Dd(document.documentElement)||_!=null&&Dd(_,f)&&v.push(_)}let w=(r=(e=window.visualViewport)==null?void 0:e.width)!=null?r:innerWidth,T=(s=(n=window.visualViewport)==null?void 0:n.height)!=null?s:innerHeight,E=(a=window.scrollX)!=null?a:pageXOffset,R=(o=window.scrollY)!=null?o:pageYOffset,{height:H,width:Y,top:j,right:et,bottom:J,left:rt}=i.getBoundingClientRect(),gt=d==="start"||d==="nearest"?j:d==="end"?J:j+H/2,X=m==="center"?rt+Y/2:m==="end"?et:rt,Q=[];for(let S=0;S<v.length;S++){let ut=v[S],{height:Pt,width:pt,top:Wt,right:bt,bottom:xt,left:tt}=ut.getBoundingClientRect();if(u==="if-needed"&&j>=0&&rt>=0&&J<=T&&et<=w&&j>=Wt&&J<=xt&&rt>=tt&&et<=bt)return Q;let it=getComputedStyle(ut),Gt=parseInt(it.borderLeftWidth,10),Dt=parseInt(it.borderTopWidth,10),Mt=parseInt(it.borderRightWidth,10),te=parseInt(it.borderBottomWidth,10),re=0,jt=0,qt="offsetWidth"in ut?ut.offsetWidth-ut.clientWidth-Gt-Mt:0,ce="offsetHeight"in ut?ut.offsetHeight-ut.clientHeight-Dt-te:0,ne="offsetWidth"in ut?ut.offsetWidth===0?0:pt/ut.offsetWidth:0,_e="offsetHeight"in ut?ut.offsetHeight===0?0:Pt/ut.offsetHeight:0;if(y===ut)re=d==="start"?gt:d==="end"?gt-T:d==="nearest"?Ql(R,R+T,T,Dt,te,R+gt,R+gt+H,H):gt-T/2,jt=m==="start"?X:m==="center"?X-w/2:m==="end"?X-w:Ql(E,E+w,w,Gt,Mt,E+X,E+X+Y,Y),re=Math.max(0,re+R),jt=Math.max(0,jt+E);else{re=d==="start"?gt-Wt-Dt:d==="end"?gt-xt+te+ce:d==="nearest"?Ql(Wt,xt,Pt,Dt,te+ce,gt,gt+H,H):gt-(Wt+Pt/2)+ce/2,jt=m==="start"?X-tt-Gt:m==="center"?X-(tt+pt/2)+qt/2:m==="end"?X-bt+Mt+qt:Ql(tt,bt,pt,Gt,Mt+qt,X,X+Y,Y);let{scrollLeft:pe,scrollTop:C}=ut;re=Math.max(0,Math.min(C+re/_e,ut.scrollHeight-Pt/_e+ce)),jt=Math.max(0,Math.min(pe+jt/ne,ut.scrollWidth-pt/ne+qt)),gt+=C-re,X+=pe-jt}Q.push({el:ut,top:re,left:jt})}return Q};let aR=i=>i===!1?{block:"end",inline:"nearest"}:(t=>t===Object(t)&&Object.keys(t).length!==0)(i)?i:{block:"start",inline:"nearest"};function Ld(i,t){let e=i.isConnected||i.ownerDocument.documentElement.contains(i);if((a=>typeof a=="object"&&typeof a.behavior=="function")(t))return t.behavior(e?f0(i,t):[]);if(!e)return;let r=aR(t),n=f0(i,r),s="scrollBehavior"in document.body.style;n.forEach(a=>{let{el:o,top:u,left:d}=a;o.scroll&&s?o.scroll({top:u,left:d,behavior:r.behavior}):(o.scrollTop=u,o.scrollLeft=d)})}function Jl(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var vv={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(i,t){(function(e){i.exports=e()})(function(){return function e(r,n,s){function a(d,m){if(!n[d]){if(!r[d]){var l=typeof Jl=="function"&&Jl;if(!m&&l)return l(d,!0);if(o)return o(d,!0);var f=new Error("Cannot find module '"+d+"'");throw f.code="MODULE_NOT_FOUND",f}var p=n[d]={exports:{}};r[d][0].call(p.exports,function(y){var v=r[d][1][y];return a(v||y)},p,p.exports,e,r,n,s)}return n[d].exports}for(var o=typeof Jl=="function"&&Jl,u=0;u<s.length;u++)a(s[u]);return a}({1:[function(e,r,n){var s=e("./utils"),a=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(u){for(var d,m,l,f,p,y,v,_=[],w=0,T=u.length,E=T,R=s.getTypeOf(u)!=="string";w<u.length;)E=T-w,l=R?(d=u[w++],m=w<T?u[w++]:0,w<T?u[w++]:0):(d=u.charCodeAt(w++),m=w<T?u.charCodeAt(w++):0,w<T?u.charCodeAt(w++):0),f=d>>2,p=(3&d)<<4|m>>4,y=1<E?(15&m)<<2|l>>6:64,v=2<E?63&l:64,_.push(o.charAt(f)+o.charAt(p)+o.charAt(y)+o.charAt(v));return _.join("")},n.decode=function(u){var d,m,l,f,p,y,v=0,_=0,w="data:";if(u.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var T,E=3*(u=u.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(u.charAt(u.length-1)===o.charAt(64)&&E--,u.charAt(u.length-2)===o.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=a.uint8array?new Uint8Array(0|E):new Array(0|E);v<u.length;)d=o.indexOf(u.charAt(v++))<<2|(f=o.indexOf(u.charAt(v++)))>>4,m=(15&f)<<4|(p=o.indexOf(u.charAt(v++)))>>2,l=(3&p)<<6|(y=o.indexOf(u.charAt(v++))),T[_++]=d,p!==64&&(T[_++]=m),y!==64&&(T[_++]=l);return T}},{"./support":30,"./utils":32}],2:[function(e,r,n){var s=e("./external"),a=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),u=e("./stream/DataLengthProbe");function d(m,l,f,p,y){this.compressedSize=m,this.uncompressedSize=l,this.crc32=f,this.compression=p,this.compressedContent=y}d.prototype={getContentWorker:function(){var m=new a(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new u("data_length")),l=this;return m.on("end",function(){if(this.streamInfo.data_length!==l.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),m},getCompressedWorker:function(){return new a(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(m,l,f){return m.pipe(new o).pipe(new u("uncompressedSize")).pipe(l.compressWorker(f)).pipe(new u("compressedSize")).withStreamInfo("compression",l)},r.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,r,n){var s=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,r,n){var s=e("./utils"),a=function(){for(var o,u=[],d=0;d<256;d++){o=d;for(var m=0;m<8;m++)o=1&o?3988292384^o>>>1:o>>>1;u[d]=o}return u}();r.exports=function(o,u){return o!==void 0&&o.length?s.getTypeOf(o)!=="string"?function(d,m,l,f){var p=a,y=f+l;d^=-1;for(var v=f;v<y;v++)d=d>>>8^p[255&(d^m[v])];return-1^d}(0|u,o,o.length,0):function(d,m,l,f){var p=a,y=f+l;d^=-1;for(var v=f;v<y;v++)d=d>>>8^p[255&(d^m.charCodeAt(v))];return-1^d}(0|u,o,o.length,0):0}},{"./utils":32}],5:[function(e,r,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,r,n){var s=null;s=typeof Promise<"u"?Promise:e("lie"),r.exports={Promise:s}},{lie:37}],7:[function(e,r,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=e("pako"),o=e("./utils"),u=e("./stream/GenericWorker"),d=s?"uint8array":"array";function m(l,f){u.call(this,"FlateWorker/"+l),this._pako=null,this._pakoAction=l,this._pakoOptions=f,this.meta={}}n.magic="\b\0",o.inherits(m,u),m.prototype.processChunk=function(l){this.meta=l.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(d,l.data),!1)},m.prototype.flush=function(){u.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},m.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this._pako=null},m.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var l=this;this._pako.onData=function(f){l.push({data:f,meta:l.meta})}},n.compressWorker=function(l){return new m("Deflate",l)},n.uncompressWorker=function(){return new m("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,r,n){function s(p,y){var v,_="";for(v=0;v<y;v++)_+=String.fromCharCode(255&p),p>>>=8;return _}function a(p,y,v,_,w,T){var E,R,H=p.file,Y=p.compression,j=T!==d.utf8encode,et=o.transformTo("string",T(H.name)),J=o.transformTo("string",d.utf8encode(H.name)),rt=H.comment,gt=o.transformTo("string",T(rt)),X=o.transformTo("string",d.utf8encode(rt)),Q=J.length!==H.name.length,S=X.length!==rt.length,ut="",Pt="",pt="",Wt=H.dir,bt=H.date,xt={crc32:0,compressedSize:0,uncompressedSize:0};y&&!v||(xt.crc32=p.crc32,xt.compressedSize=p.compressedSize,xt.uncompressedSize=p.uncompressedSize);var tt=0;y&&(tt|=8),j||!Q&&!S||(tt|=2048);var it=0,Gt=0;Wt&&(it|=16),w==="UNIX"?(Gt=798,it|=function(Mt,te){var re=Mt;return Mt||(re=te?16893:33204),(65535&re)<<16}(H.unixPermissions,Wt)):(Gt=20,it|=function(Mt){return 63&(Mt||0)}(H.dosPermissions)),E=bt.getUTCHours(),E<<=6,E|=bt.getUTCMinutes(),E<<=5,E|=bt.getUTCSeconds()/2,R=bt.getUTCFullYear()-1980,R<<=4,R|=bt.getUTCMonth()+1,R<<=5,R|=bt.getUTCDate(),Q&&(Pt=s(1,1)+s(m(et),4)+J,ut+="up"+s(Pt.length,2)+Pt),S&&(pt=s(1,1)+s(m(gt),4)+X,ut+="uc"+s(pt.length,2)+pt);var Dt="";return Dt+=`
\0`,Dt+=s(tt,2),Dt+=Y.magic,Dt+=s(E,2),Dt+=s(R,2),Dt+=s(xt.crc32,4),Dt+=s(xt.compressedSize,4),Dt+=s(xt.uncompressedSize,4),Dt+=s(et.length,2),Dt+=s(ut.length,2),{fileRecord:l.LOCAL_FILE_HEADER+Dt+et+ut,dirRecord:l.CENTRAL_FILE_HEADER+s(Gt,2)+Dt+s(gt.length,2)+"\0\0\0\0"+s(it,4)+s(_,4)+et+ut+gt}}var o=e("../utils"),u=e("../stream/GenericWorker"),d=e("../utf8"),m=e("../crc32"),l=e("../signature");function f(p,y,v,_){u.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=v,this.encodeFileName=_,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(f,u),f.prototype.push=function(p){var y=p.meta.percent||0,v=this.entriesCount,_=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,u.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:v?(y+100*(v-_-1))/v:100}}))},f.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var y=this.streamFiles&&!p.file.dir;if(y){var v=a(p,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:v.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(p){this.accumulate=!1;var y=this.streamFiles&&!p.file.dir,v=a(p,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(v.dirRecord),y)this.push({data:function(_){return l.DATA_DESCRIPTOR+s(_.crc32,4)+s(_.compressedSize,4)+s(_.uncompressedSize,4)}(p),meta:{percent:100}});else for(this.push({data:v.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var p=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var v=this.bytesWritten-p,_=function(w,T,E,R,H){var Y=o.transformTo("string",H(R));return l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(T,4)+s(E,4)+s(Y.length,2)+Y}(this.dirRecords.length,v,p,this.zipComment,this.encodeFileName);this.push({data:_,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(p){this._sources.push(p);var y=this;return p.on("data",function(v){y.processChunk(v)}),p.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),p.on("error",function(v){y.error(v)}),this},f.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(p){var y=this._sources;if(!u.prototype.error.call(this,p))return!1;for(var v=0;v<y.length;v++)try{y[v].error(p)}catch{}return!0},f.prototype.lock=function(){u.prototype.lock.call(this);for(var p=this._sources,y=0;y<p.length;y++)p[y].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,r,n){var s=e("../compressions"),a=e("./ZipFileWorker");n.generateWorker=function(o,u,d){var m=new a(u.streamFiles,d,u.platform,u.encodeFileName),l=0;try{o.forEach(function(f,p){l++;var y=function(T,E){var R=T||E,H=s[R];if(!H)throw new Error(R+" is not a valid compression method !");return H}(p.options.compression,u.compression),v=p.options.compressionOptions||u.compressionOptions||{},_=p.dir,w=p.date;p._compressWorker(y,v).withStreamInfo("file",{name:f,dir:_,date:w,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(m)}),m.entriesCount=l}catch(f){m.error(f)}return m}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,r,n){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new s;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}(s.prototype=e("./object")).loadAsync=e("./load"),s.support=e("./support"),s.defaults=e("./defaults"),s.version="3.10.1",s.loadAsync=function(a,o){return new s().loadAsync(a,o)},s.external=e("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,r,n){var s=e("./utils"),a=e("./external"),o=e("./utf8"),u=e("./zipEntries"),d=e("./stream/Crc32Probe"),m=e("./nodejsUtils");function l(f){return new a.Promise(function(p,y){var v=f.decompressed.getContentWorker().pipe(new d);v.on("error",function(_){y(_)}).on("end",function(){v.streamInfo.crc32!==f.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}r.exports=function(f,p){var y=this;return p=s.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),m.isNode&&m.isStream(f)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,p.optimizedBinaryString,p.base64).then(function(v){var _=new u(p);return _.load(v),_}).then(function(v){var _=[a.Promise.resolve(v)],w=v.files;if(p.checkCRC32)for(var T=0;T<w.length;T++)_.push(l(w[T]));return a.Promise.all(_)}).then(function(v){for(var _=v.shift(),w=_.files,T=0;T<w.length;T++){var E=w[T],R=E.fileNameStr,H=s.resolve(E.fileNameStr);y.file(H,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:p.createFolders}),E.dir||(y.file(H).unsafeOriginalName=R)}return _.zipComment.length&&(y.comment=_.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,r,n){var s=e("../utils"),a=e("../stream/GenericWorker");function o(u,d){a.call(this,"Nodejs stream input adapter for "+u),this._upstreamEnded=!1,this._bindStream(d)}s.inherits(o,a),o.prototype._bindStream=function(u){var d=this;(this._stream=u).pause(),u.on("data",function(m){d.push({data:m,meta:{percent:0}})}).on("error",function(m){d.isPaused?this.generatedError=m:d.error(m)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,r,n){var s=e("readable-stream").Readable;function a(o,u,d){s.call(this,u),this._helper=o;var m=this;o.on("data",function(l,f){m.push(l)||m._helper.pause(),d&&d(f)}).on("error",function(l){m.emit("error",l)}).on("end",function(){m.push(null)})}e("../utils").inherits(a,s),a.prototype._read=function(){this._helper.resume()},r.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,r,n){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,a);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,a)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var a=new Buffer(s);return a.fill(0),a},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(e,r,n){function s(H,Y,j){var et,J=o.getTypeOf(Y),rt=o.extend(j||{},m);rt.date=rt.date||new Date,rt.compression!==null&&(rt.compression=rt.compression.toUpperCase()),typeof rt.unixPermissions=="string"&&(rt.unixPermissions=parseInt(rt.unixPermissions,8)),rt.unixPermissions&&16384&rt.unixPermissions&&(rt.dir=!0),rt.dosPermissions&&16&rt.dosPermissions&&(rt.dir=!0),rt.dir&&(H=w(H)),rt.createFolders&&(et=_(H))&&T.call(this,et,!0);var gt=J==="string"&&rt.binary===!1&&rt.base64===!1;j&&j.binary!==void 0||(rt.binary=!gt),(Y instanceof l&&Y.uncompressedSize===0||rt.dir||!Y||Y.length===0)&&(rt.base64=!1,rt.binary=!0,Y="",rt.compression="STORE",J="string");var X=null;X=Y instanceof l||Y instanceof u?Y:y.isNode&&y.isStream(Y)?new v(H,Y):o.prepareContent(H,Y,rt.binary,rt.optimizedBinaryString,rt.base64);var Q=new f(H,X,rt);this.files[H]=Q}var a=e("./utf8"),o=e("./utils"),u=e("./stream/GenericWorker"),d=e("./stream/StreamHelper"),m=e("./defaults"),l=e("./compressedObject"),f=e("./zipObject"),p=e("./generate"),y=e("./nodejsUtils"),v=e("./nodejs/NodejsStreamInputAdapter"),_=function(H){H.slice(-1)==="/"&&(H=H.substring(0,H.length-1));var Y=H.lastIndexOf("/");return 0<Y?H.substring(0,Y):""},w=function(H){return H.slice(-1)!=="/"&&(H+="/"),H},T=function(H,Y){return Y=Y!==void 0?Y:m.createFolders,H=w(H),this.files[H]||s.call(this,H,null,{dir:!0,createFolders:Y}),this.files[H]};function E(H){return Object.prototype.toString.call(H)==="[object RegExp]"}var R={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(H){var Y,j,et;for(Y in this.files)et=this.files[Y],(j=Y.slice(this.root.length,Y.length))&&Y.slice(0,this.root.length)===this.root&&H(j,et)},filter:function(H){var Y=[];return this.forEach(function(j,et){H(j,et)&&Y.push(et)}),Y},file:function(H,Y,j){if(arguments.length!==1)return H=this.root+H,s.call(this,H,Y,j),this;if(E(H)){var et=H;return this.filter(function(rt,gt){return!gt.dir&&et.test(rt)})}var J=this.files[this.root+H];return J&&!J.dir?J:null},folder:function(H){if(!H)return this;if(E(H))return this.filter(function(J,rt){return rt.dir&&H.test(J)});var Y=this.root+H,j=T.call(this,Y),et=this.clone();return et.root=j.name,et},remove:function(H){H=this.root+H;var Y=this.files[H];if(Y||(H.slice(-1)!=="/"&&(H+="/"),Y=this.files[H]),Y&&!Y.dir)delete this.files[H];else for(var j=this.filter(function(J,rt){return rt.name.slice(0,H.length)===H}),et=0;et<j.length;et++)delete this.files[j[et].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(H){var Y,j={};try{if((j=o.extend(H||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=j.type.toLowerCase(),j.compression=j.compression.toUpperCase(),j.type==="binarystring"&&(j.type="string"),!j.type)throw new Error("No output type specified.");o.checkSupport(j.type),j.platform!=="darwin"&&j.platform!=="freebsd"&&j.platform!=="linux"&&j.platform!=="sunos"||(j.platform="UNIX"),j.platform==="win32"&&(j.platform="DOS");var et=j.comment||this.comment||"";Y=p.generateWorker(this,j,et)}catch(J){(Y=new u("error")).error(J)}return new d(Y,j.type||"string",j.mimeType)},generateAsync:function(H,Y){return this.generateInternalStream(H).accumulate(Y)},generateNodeStream:function(H,Y){return(H=H||{}).type||(H.type="nodebuffer"),this.generateInternalStream(H).toNodejsStream(Y)}};r.exports=R},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,r,n){r.exports=e("stream")},{stream:void 0}],17:[function(e,r,n){var s=e("./DataReader");function a(o){s.call(this,o);for(var u=0;u<this.data.length;u++)o[u]=255&o[u]}e("../utils").inherits(a,s),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var u=o.charCodeAt(0),d=o.charCodeAt(1),m=o.charCodeAt(2),l=o.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===u&&this.data[f+1]===d&&this.data[f+2]===m&&this.data[f+3]===l)return f-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var u=o.charCodeAt(0),d=o.charCodeAt(1),m=o.charCodeAt(2),l=o.charCodeAt(3),f=this.readData(4);return u===f[0]&&d===f[1]&&m===f[2]&&l===f[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,u},r.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,r,n){var s=e("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var u,d=0;for(this.checkOffset(o),u=this.index+o-1;u>=this.index;u--)d=(d<<8)+this.byteAt(u);return this.index+=o,d},readString:function(o){return s.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},r.exports=a},{"../utils":32}],19:[function(e,r,n){var s=e("./Uint8ArrayReader");function a(o){s.call(this,o)}e("../utils").inherits(a,s),a.prototype.readData=function(o){this.checkOffset(o);var u=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,u},r.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,r,n){var s=e("./DataReader");function a(o){s.call(this,o)}e("../utils").inherits(a,s),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var u=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,u},r.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,r,n){var s=e("./ArrayReader");function a(o){s.call(this,o)}e("../utils").inherits(a,s),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,u},r.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,r,n){var s=e("../utils"),a=e("../support"),o=e("./ArrayReader"),u=e("./StringReader"),d=e("./NodeBufferReader"),m=e("./Uint8ArrayReader");r.exports=function(l){var f=s.getTypeOf(l);return s.checkSupport(f),f!=="string"||a.uint8array?f==="nodebuffer"?new d(l):a.uint8array?new m(s.transformTo("uint8array",l)):new o(s.transformTo("array",l)):new u(l)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,r,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,r,n){var s=e("./GenericWorker"),a=e("../utils");function o(u){s.call(this,"ConvertWorker to "+u),this.destType=u}a.inherits(o,s),o.prototype.processChunk=function(u){this.push({data:a.transformTo(this.destType,u.data),meta:u.meta})},r.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,r,n){var s=e("./GenericWorker"),a=e("../crc32");function o(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,s),o.prototype.processChunk=function(u){this.streamInfo.crc32=a(u.data,this.streamInfo.crc32||0),this.push(u)},r.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,r,n){var s=e("../utils"),a=e("./GenericWorker");function o(u){a.call(this,"DataLengthProbe for "+u),this.propName=u,this.withStreamInfo(u,0)}s.inherits(o,a),o.prototype.processChunk=function(u){if(u){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+u.data.length}a.prototype.processChunk.call(this,u)},r.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,r,n){var s=e("../utils"),a=e("./GenericWorker");function o(u){a.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(m){d.dataIsReady=!0,d.data=m,d.max=m&&m.length||0,d.type=s.getTypeOf(m),d.isPaused||d._tickAndRepeat()},function(m){d.error(m)})}s.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,d);break;case"uint8array":u=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":u=this.data.slice(this.index,d)}return this.index=d,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,r,n){function s(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,o){return this._listeners[a].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,o){if(this._listeners[a])for(var u=0;u<this._listeners[a].length;u++)this._listeners[a][u].call(this,o)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(u){o.processChunk(u)}),a.on("end",function(){o.end()}),a.on("error",function(u){o.error(u)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},r.exports=s},{}],29:[function(e,r,n){var s=e("../utils"),a=e("./ConvertWorker"),o=e("./GenericWorker"),u=e("../base64"),d=e("../support"),m=e("../external"),l=null;if(d.nodestream)try{l=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(y,v){return new m.Promise(function(_,w){var T=[],E=y._internalType,R=y._outputType,H=y._mimeType;y.on("data",function(Y,j){T.push(Y),v&&v(j)}).on("error",function(Y){T=[],w(Y)}).on("end",function(){try{var Y=function(j,et,J){switch(j){case"blob":return s.newBlob(s.transformTo("arraybuffer",et),J);case"base64":return u.encode(et);default:return s.transformTo(j,et)}}(R,function(j,et){var J,rt=0,gt=null,X=0;for(J=0;J<et.length;J++)X+=et[J].length;switch(j){case"string":return et.join("");case"array":return Array.prototype.concat.apply([],et);case"uint8array":for(gt=new Uint8Array(X),J=0;J<et.length;J++)gt.set(et[J],rt),rt+=et[J].length;return gt;case"nodebuffer":return Buffer.concat(et);default:throw new Error("concat : unsupported type '"+j+"'")}}(E,T),H);_(Y)}catch(j){w(j)}T=[]}).resume()})}function p(y,v,_){var w=v;switch(v){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=v,this._mimeType=_,s.checkSupport(w),this._worker=y.pipe(new a(w)),y.lock()}catch(T){this._worker=new o("error"),this._worker.error(T)}}p.prototype={accumulate:function(y){return f(this,y)},on:function(y,v){var _=this;return y==="data"?this._worker.on(y,function(w){v.call(_,w.data,w.meta)}):this._worker.on(y,function(){s.delay(v,arguments,_)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:this._outputType!=="nodebuffer"},y)}},r.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,r,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var s=new ArrayBuffer(0);try{n.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(s),n.blob=a.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(e,r,n){for(var s=e("./utils"),a=e("./support"),o=e("./nodejsUtils"),u=e("./stream/GenericWorker"),d=new Array(256),m=0;m<256;m++)d[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;d[254]=d[254]=1;function l(){u.call(this,"utf-8 decode"),this.leftOver=null}function f(){u.call(this,"utf-8 encode")}n.utf8encode=function(p){return a.nodebuffer?o.newBufferFrom(p,"utf-8"):function(y){var v,_,w,T,E,R=y.length,H=0;for(T=0;T<R;T++)(64512&(_=y.charCodeAt(T)))==55296&&T+1<R&&(64512&(w=y.charCodeAt(T+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),T++),H+=_<128?1:_<2048?2:_<65536?3:4;for(v=a.uint8array?new Uint8Array(H):new Array(H),T=E=0;E<H;T++)(64512&(_=y.charCodeAt(T)))==55296&&T+1<R&&(64512&(w=y.charCodeAt(T+1)))==56320&&(_=65536+(_-55296<<10)+(w-56320),T++),_<128?v[E++]=_:(_<2048?v[E++]=192|_>>>6:(_<65536?v[E++]=224|_>>>12:(v[E++]=240|_>>>18,v[E++]=128|_>>>12&63),v[E++]=128|_>>>6&63),v[E++]=128|63&_);return v}(p)},n.utf8decode=function(p){return a.nodebuffer?s.transformTo("nodebuffer",p).toString("utf-8"):function(y){var v,_,w,T,E=y.length,R=new Array(2*E);for(v=_=0;v<E;)if((w=y[v++])<128)R[_++]=w;else if(4<(T=d[w]))R[_++]=65533,v+=T-1;else{for(w&=T===2?31:T===3?15:7;1<T&&v<E;)w=w<<6|63&y[v++],T--;1<T?R[_++]=65533:w<65536?R[_++]=w:(w-=65536,R[_++]=55296|w>>10&1023,R[_++]=56320|1023&w)}return R.length!==_&&(R.subarray?R=R.subarray(0,_):R.length=_),s.applyFromCharCode(R)}(p=s.transformTo(a.uint8array?"uint8array":"array",p))},s.inherits(l,u),l.prototype.processChunk=function(p){var y=s.transformTo(a.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var v=y;(y=new Uint8Array(v.length+this.leftOver.length)).set(this.leftOver,0),y.set(v,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var _=function(T,E){var R;for((E=E||T.length)>T.length&&(E=T.length),R=E-1;0<=R&&(192&T[R])==128;)R--;return R<0||R===0?E:R+d[T[R]]>E?R:E}(y),w=y;_!==y.length&&(a.uint8array?(w=y.subarray(0,_),this.leftOver=y.subarray(_,y.length)):(w=y.slice(0,_),this.leftOver=y.slice(_,y.length))),this.push({data:n.utf8decode(w),meta:p.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=l,s.inherits(f,u),f.prototype.processChunk=function(p){this.push({data:n.utf8encode(p.data),meta:p.meta})},n.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,r,n){var s=e("./support"),a=e("./base64"),o=e("./nodejsUtils"),u=e("./external");function d(v){return v}function m(v,_){for(var w=0;w<v.length;++w)_[w]=255&v.charCodeAt(w);return _}e("setimmediate"),n.newBlob=function(v,_){n.checkSupport("blob");try{return new Blob([v],{type:_})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(v),w.getBlob(_)}catch{throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(v,_,w){var T=[],E=0,R=v.length;if(R<=w)return String.fromCharCode.apply(null,v);for(;E<R;)_==="array"||_==="nodebuffer"?T.push(String.fromCharCode.apply(null,v.slice(E,Math.min(E+w,R)))):T.push(String.fromCharCode.apply(null,v.subarray(E,Math.min(E+w,R)))),E+=w;return T.join("")},stringifyByChar:function(v){for(var _="",w=0;w<v.length;w++)_+=String.fromCharCode(v[w]);return _},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function f(v){var _=65536,w=n.getTypeOf(v),T=!0;if(w==="uint8array"?T=l.applyCanBeUsed.uint8array:w==="nodebuffer"&&(T=l.applyCanBeUsed.nodebuffer),T)for(;1<_;)try{return l.stringifyByChunk(v,w,_)}catch{_=Math.floor(_/2)}return l.stringifyByChar(v)}function p(v,_){for(var w=0;w<v.length;w++)_[w]=v[w];return _}n.applyFromCharCode=f;var y={};y.string={string:d,array:function(v){return m(v,new Array(v.length))},arraybuffer:function(v){return y.string.uint8array(v).buffer},uint8array:function(v){return m(v,new Uint8Array(v.length))},nodebuffer:function(v){return m(v,o.allocBuffer(v.length))}},y.array={string:f,array:d,arraybuffer:function(v){return new Uint8Array(v).buffer},uint8array:function(v){return new Uint8Array(v)},nodebuffer:function(v){return o.newBufferFrom(v)}},y.arraybuffer={string:function(v){return f(new Uint8Array(v))},array:function(v){return p(new Uint8Array(v),new Array(v.byteLength))},arraybuffer:d,uint8array:function(v){return new Uint8Array(v)},nodebuffer:function(v){return o.newBufferFrom(new Uint8Array(v))}},y.uint8array={string:f,array:function(v){return p(v,new Array(v.length))},arraybuffer:function(v){return v.buffer},uint8array:d,nodebuffer:function(v){return o.newBufferFrom(v)}},y.nodebuffer={string:f,array:function(v){return p(v,new Array(v.length))},arraybuffer:function(v){return y.nodebuffer.uint8array(v).buffer},uint8array:function(v){return p(v,new Uint8Array(v.length))},nodebuffer:d},n.transformTo=function(v,_){if(_=_||"",!v)return _;n.checkSupport(v);var w=n.getTypeOf(_);return y[w][v](_)},n.resolve=function(v){for(var _=v.split("/"),w=[],T=0;T<_.length;T++){var E=_[T];E==="."||E===""&&T!==0&&T!==_.length-1||(E===".."?w.pop():w.push(E))}return w.join("/")},n.getTypeOf=function(v){return typeof v=="string"?"string":Object.prototype.toString.call(v)==="[object Array]"?"array":s.nodebuffer&&o.isBuffer(v)?"nodebuffer":s.uint8array&&v instanceof Uint8Array?"uint8array":s.arraybuffer&&v instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(v){if(!s[v.toLowerCase()])throw new Error(v+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(v){var _,w,T="";for(w=0;w<(v||"").length;w++)T+="\\x"+((_=v.charCodeAt(w))<16?"0":"")+_.toString(16).toUpperCase();return T},n.delay=function(v,_,w){setImmediate(function(){v.apply(w||null,_||[])})},n.inherits=function(v,_){function w(){}w.prototype=_.prototype,v.prototype=new w},n.extend=function(){var v,_,w={};for(v=0;v<arguments.length;v++)for(_ in arguments[v])Object.prototype.hasOwnProperty.call(arguments[v],_)&&w[_]===void 0&&(w[_]=arguments[v][_]);return w},n.prepareContent=function(v,_,w,T,E){return u.Promise.resolve(_).then(function(R){return s.blob&&(R instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(R))!==-1)&&typeof FileReader<"u"?new u.Promise(function(H,Y){var j=new FileReader;j.onload=function(et){H(et.target.result)},j.onerror=function(et){Y(et.target.error)},j.readAsArrayBuffer(R)}):R}).then(function(R){var H=n.getTypeOf(R);return H?(H==="arraybuffer"?R=n.transformTo("uint8array",R):H==="string"&&(E?R=a.decode(R):w&&T!==!0&&(R=function(Y){return m(Y,s.uint8array?new Uint8Array(Y.length):new Array(Y.length))}(R))),R):u.Promise.reject(new Error("Can't read the data of '"+v+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,r,n){var s=e("./reader/readerFor"),a=e("./utils"),o=e("./signature"),u=e("./zipEntry"),d=e("./support");function m(l){this.files=[],this.loadOptions=l}m.prototype={checkSignature:function(l){if(!this.reader.readAndCheckSignature(l)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(f)+", expected "+a.pretty(l)+")")}},isSignature:function(l,f){var p=this.reader.index;this.reader.setIndex(l);var y=this.reader.readString(4)===f;return this.reader.setIndex(p),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var l=this.reader.readData(this.zipCommentLength),f=d.uint8array?"uint8array":"array",p=a.transformTo(f,l);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var l,f,p,y=this.zip64EndOfCentralSize-44;0<y;)l=this.reader.readInt(2),f=this.reader.readInt(4),p=this.reader.readData(f),this.zip64ExtensibleData[l]={id:l,length:f,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var l,f;for(l=0;l<this.files.length;l++)f=this.files[l],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var l;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(l=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(l);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var l=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(l<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(l);var f=l;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(l=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(l),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var y=f-p;if(0<y)this.isSignature(f,o.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(l){this.reader=s(l)},load:function(l){this.prepareReader(l),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=m},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,r,n){var s=e("./reader/readerFor"),a=e("./utils"),o=e("./compressedObject"),u=e("./crc32"),d=e("./utf8"),m=e("./compressions"),l=e("./support");function f(p,y){this.options=p,this.loadOptions=y}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var y,v;if(p.skip(22),this.fileNameLength=p.readInt(2),v=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(v),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=function(_){for(var w in m)if(Object.prototype.hasOwnProperty.call(m,w)&&m[w].magic===_)return m[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,y,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var y=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(y),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=s(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var y,v,_,w=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<w;)y=p.readInt(2),v=p.readInt(2),_=p.readData(v),this.extraFields[y]={id:y,length:v,value:_};p.setIndex(w)},handleUTF8:function(){var p=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var v=a.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(v)}var _=this.findExtraFieldUnicodeComment();if(_!==null)this.fileCommentStr=_;else{var w=a.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var y=s(p.value);return y.readInt(1)!==1||u(this.fileName)!==y.readInt(4)?null:d.utf8decode(y.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var y=s(p.value);return y.readInt(1)!==1||u(this.fileComment)!==y.readInt(4)?null:d.utf8decode(y.readData(p.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,r,n){function s(y,v,_){this.name=y,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=v,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}}var a=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),u=e("./utf8"),d=e("./compressedObject"),m=e("./stream/GenericWorker");s.prototype={internalStream:function(y){var v=null,_="string";try{if(!y)throw new Error("No output type specified.");var w=(_=y.toLowerCase())==="string"||_==="text";_!=="binarystring"&&_!=="text"||(_="string"),v=this._decompressWorker();var T=!this._dataBinary;T&&!w&&(v=v.pipe(new u.Utf8EncodeWorker)),!T&&w&&(v=v.pipe(new u.Utf8DecodeWorker))}catch(E){(v=new m("error")).error(E)}return new a(v,_,"")},async:function(y,v){return this.internalStream(y).accumulate(v)},nodeStream:function(y,v){return this.internalStream(y||"nodebuffer").toNodejsStream(v)},_compressWorker:function(y,v){if(this._data instanceof d&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new u.Utf8EncodeWorker)),d.createWorkerFrom(_,y,v)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof m?this._data:new o(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<l.length;p++)s.prototype[l[p]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,r,n){(function(s){var a,o,u=s.MutationObserver||s.WebKitMutationObserver;if(u){var d=0,m=new u(y),l=s.document.createTextNode("");m.observe(l,{characterData:!0}),a=function(){l.data=d=++d%2}}else if(s.setImmediate||s.MessageChannel===void 0)a="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var v=s.document.createElement("script");v.onreadystatechange=function(){y(),v.onreadystatechange=null,v.parentNode.removeChild(v),v=null},s.document.documentElement.appendChild(v)}:function(){setTimeout(y,0)};else{var f=new s.MessageChannel;f.port1.onmessage=y,a=function(){f.port2.postMessage(0)}}var p=[];function y(){var v,_;o=!0;for(var w=p.length;w;){for(_=p,p=[],v=-1;++v<w;)_[v]();w=p.length}o=!1}r.exports=function(v){p.push(v)!==1||o||a()}}).call(this,typeof hi<"u"?hi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,r,n){var s=e("immediate");function a(){}var o={},u=["REJECTED"],d=["FULFILLED"],m=["PENDING"];function l(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,w!==a&&v(this,w)}function f(w,T,E){this.promise=w,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function p(w,T,E){s(function(){var R;try{R=T(E)}catch(H){return o.reject(w,H)}R===w?o.reject(w,new TypeError("Cannot resolve promise with itself")):o.resolve(w,R)})}function y(w){var T=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof T=="function")return function(){T.apply(w,arguments)}}function v(w,T){var E=!1;function R(j){E||(E=!0,o.reject(w,j))}function H(j){E||(E=!0,o.resolve(w,j))}var Y=_(function(){T(H,R)});Y.status==="error"&&R(Y.value)}function _(w,T){var E={};try{E.value=w(T),E.status="success"}catch(R){E.status="error",E.value=R}return E}(r.exports=l).prototype.finally=function(w){if(typeof w!="function")return this;var T=this.constructor;return this.then(function(E){return T.resolve(w()).then(function(){return E})},function(E){return T.resolve(w()).then(function(){throw E})})},l.prototype.catch=function(w){return this.then(null,w)},l.prototype.then=function(w,T){if(typeof w!="function"&&this.state===d||typeof T!="function"&&this.state===u)return this;var E=new this.constructor(a);return this.state!==m?p(E,this.state===d?w:T,this.outcome):this.queue.push(new f(E,w,T)),E},f.prototype.callFulfilled=function(w){o.resolve(this.promise,w)},f.prototype.otherCallFulfilled=function(w){p(this.promise,this.onFulfilled,w)},f.prototype.callRejected=function(w){o.reject(this.promise,w)},f.prototype.otherCallRejected=function(w){p(this.promise,this.onRejected,w)},o.resolve=function(w,T){var E=_(y,T);if(E.status==="error")return o.reject(w,E.value);var R=E.value;if(R)v(w,R);else{w.state=d,w.outcome=T;for(var H=-1,Y=w.queue.length;++H<Y;)w.queue[H].callFulfilled(T)}return w},o.reject=function(w,T){w.state=u,w.outcome=T;for(var E=-1,R=w.queue.length;++E<R;)w.queue[E].callRejected(T);return w},l.resolve=function(w){return w instanceof this?w:o.resolve(new this(a),w)},l.reject=function(w){var T=new this(a);return o.reject(T,w)},l.all=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=w.length,R=!1;if(!E)return this.resolve([]);for(var H=new Array(E),Y=0,j=-1,et=new this(a);++j<E;)J(w[j],j);return et;function J(rt,gt){T.resolve(rt).then(function(X){H[gt]=X,++Y!==E||R||(R=!0,o.resolve(et,H))},function(X){R||(R=!0,o.reject(et,X))})}},l.race=function(w){var T=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=w.length,R=!1;if(!E)return this.resolve([]);for(var H=-1,Y=new this(a);++H<E;)j=w[H],T.resolve(j).then(function(et){R||(R=!0,o.resolve(Y,et))},function(et){R||(R=!0,o.reject(Y,et))});var j;return Y}},{immediate:36}],38:[function(e,r,n){var s={};(0,e("./lib/utils/common").assign)(s,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,r,n){var s=e("./zlib/deflate"),a=e("./utils/common"),o=e("./utils/strings"),u=e("./zlib/messages"),d=e("./zlib/zstream"),m=Object.prototype.toString,l=0,f=-1,p=0,y=8;function v(w){if(!(this instanceof v))return new v(w);this.options=a.assign({level:f,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},w||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var E=s.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(E!==l)throw new Error(u[E]);if(T.header&&s.deflateSetHeader(this.strm,T.header),T.dictionary){var R;if(R=typeof T.dictionary=="string"?o.string2buf(T.dictionary):m.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(E=s.deflateSetDictionary(this.strm,R))!==l)throw new Error(u[E]);this._dict_set=!0}}function _(w,T){var E=new v(T);if(E.push(w,!0),E.err)throw E.msg||u[E.err];return E.result}v.prototype.push=function(w,T){var E,R,H=this.strm,Y=this.options.chunkSize;if(this.ended)return!1;R=T===~~T?T:T===!0?4:0,typeof w=="string"?H.input=o.string2buf(w):m.call(w)==="[object ArrayBuffer]"?H.input=new Uint8Array(w):H.input=w,H.next_in=0,H.avail_in=H.input.length;do{if(H.avail_out===0&&(H.output=new a.Buf8(Y),H.next_out=0,H.avail_out=Y),(E=s.deflate(H,R))!==1&&E!==l)return this.onEnd(E),!(this.ended=!0);H.avail_out!==0&&(H.avail_in!==0||R!==4&&R!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(H.output,H.next_out))):this.onData(a.shrinkBuf(H.output,H.next_out)))}while((0<H.avail_in||H.avail_out===0)&&E!==1);return R===4?(E=s.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===l):R!==2||(this.onEnd(l),!(H.avail_out=0))},v.prototype.onData=function(w){this.chunks.push(w)},v.prototype.onEnd=function(w){w===l&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},n.Deflate=v,n.deflate=_,n.deflateRaw=function(w,T){return(T=T||{}).raw=!0,_(w,T)},n.gzip=function(w,T){return(T=T||{}).gzip=!0,_(w,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,r,n){var s=e("./zlib/inflate"),a=e("./utils/common"),o=e("./utils/strings"),u=e("./zlib/constants"),d=e("./zlib/messages"),m=e("./zlib/zstream"),l=e("./zlib/gzheader"),f=Object.prototype.toString;function p(v){if(!(this instanceof p))return new p(v);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},v||{});var _=this.options;_.raw&&0<=_.windowBits&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),!(0<=_.windowBits&&_.windowBits<16)||v&&v.windowBits||(_.windowBits+=32),15<_.windowBits&&_.windowBits<48&&(15&_.windowBits)==0&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,_.windowBits);if(w!==u.Z_OK)throw new Error(d[w]);this.header=new l,s.inflateGetHeader(this.strm,this.header)}function y(v,_){var w=new p(_);if(w.push(v,!0),w.err)throw w.msg||d[w.err];return w.result}p.prototype.push=function(v,_){var w,T,E,R,H,Y,j=this.strm,et=this.options.chunkSize,J=this.options.dictionary,rt=!1;if(this.ended)return!1;T=_===~~_?_:_===!0?u.Z_FINISH:u.Z_NO_FLUSH,typeof v=="string"?j.input=o.binstring2buf(v):f.call(v)==="[object ArrayBuffer]"?j.input=new Uint8Array(v):j.input=v,j.next_in=0,j.avail_in=j.input.length;do{if(j.avail_out===0&&(j.output=new a.Buf8(et),j.next_out=0,j.avail_out=et),(w=s.inflate(j,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&J&&(Y=typeof J=="string"?o.string2buf(J):f.call(J)==="[object ArrayBuffer]"?new Uint8Array(J):J,w=s.inflateSetDictionary(this.strm,Y)),w===u.Z_BUF_ERROR&&rt===!0&&(w=u.Z_OK,rt=!1),w!==u.Z_STREAM_END&&w!==u.Z_OK)return this.onEnd(w),!(this.ended=!0);j.next_out&&(j.avail_out!==0&&w!==u.Z_STREAM_END&&(j.avail_in!==0||T!==u.Z_FINISH&&T!==u.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=o.utf8border(j.output,j.next_out),R=j.next_out-E,H=o.buf2string(j.output,E),j.next_out=R,j.avail_out=et-R,R&&a.arraySet(j.output,j.output,E,R,0),this.onData(H)):this.onData(a.shrinkBuf(j.output,j.next_out)))),j.avail_in===0&&j.avail_out===0&&(rt=!0)}while((0<j.avail_in||j.avail_out===0)&&w!==u.Z_STREAM_END);return w===u.Z_STREAM_END&&(T=u.Z_FINISH),T===u.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===u.Z_OK):T!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),!(j.avail_out=0))},p.prototype.onData=function(v){this.chunks.push(v)},p.prototype.onEnd=function(v){v===u.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},n.Inflate=p,n.inflate=y,n.inflateRaw=function(v,_){return(_=_||{}).raw=!0,y(v,_)},n.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,r,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(u){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var m=d.shift();if(m){if(typeof m!="object")throw new TypeError(m+"must be non-object");for(var l in m)m.hasOwnProperty(l)&&(u[l]=m[l])}}return u},n.shrinkBuf=function(u,d){return u.length===d?u:u.subarray?u.subarray(0,d):(u.length=d,u)};var a={arraySet:function(u,d,m,l,f){if(d.subarray&&u.subarray)u.set(d.subarray(m,m+l),f);else for(var p=0;p<l;p++)u[f+p]=d[m+p]},flattenChunks:function(u){var d,m,l,f,p,y;for(d=l=0,m=u.length;d<m;d++)l+=u[d].length;for(y=new Uint8Array(l),d=f=0,m=u.length;d<m;d++)p=u[d],y.set(p,f),f+=p.length;return y}},o={arraySet:function(u,d,m,l,f){for(var p=0;p<l;p++)u[f+p]=d[m+p]},flattenChunks:function(u){return[].concat.apply([],u)}};n.setTyped=function(u){u?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,a)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(s)},{}],42:[function(e,r,n){var s=e("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var u=new s.Buf8(256),d=0;d<256;d++)u[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function m(l,f){if(f<65537&&(l.subarray&&o||!l.subarray&&a))return String.fromCharCode.apply(null,s.shrinkBuf(l,f));for(var p="",y=0;y<f;y++)p+=String.fromCharCode(l[y]);return p}u[254]=u[254]=1,n.string2buf=function(l){var f,p,y,v,_,w=l.length,T=0;for(v=0;v<w;v++)(64512&(p=l.charCodeAt(v)))==55296&&v+1<w&&(64512&(y=l.charCodeAt(v+1)))==56320&&(p=65536+(p-55296<<10)+(y-56320),v++),T+=p<128?1:p<2048?2:p<65536?3:4;for(f=new s.Buf8(T),v=_=0;_<T;v++)(64512&(p=l.charCodeAt(v)))==55296&&v+1<w&&(64512&(y=l.charCodeAt(v+1)))==56320&&(p=65536+(p-55296<<10)+(y-56320),v++),p<128?f[_++]=p:(p<2048?f[_++]=192|p>>>6:(p<65536?f[_++]=224|p>>>12:(f[_++]=240|p>>>18,f[_++]=128|p>>>12&63),f[_++]=128|p>>>6&63),f[_++]=128|63&p);return f},n.buf2binstring=function(l){return m(l,l.length)},n.binstring2buf=function(l){for(var f=new s.Buf8(l.length),p=0,y=f.length;p<y;p++)f[p]=l.charCodeAt(p);return f},n.buf2string=function(l,f){var p,y,v,_,w=f||l.length,T=new Array(2*w);for(p=y=0;p<w;)if((v=l[p++])<128)T[y++]=v;else if(4<(_=u[v]))T[y++]=65533,p+=_-1;else{for(v&=_===2?31:_===3?15:7;1<_&&p<w;)v=v<<6|63&l[p++],_--;1<_?T[y++]=65533:v<65536?T[y++]=v:(v-=65536,T[y++]=55296|v>>10&1023,T[y++]=56320|1023&v)}return m(T,y)},n.utf8border=function(l,f){var p;for((f=f||l.length)>l.length&&(f=l.length),p=f-1;0<=p&&(192&l[p])==128;)p--;return p<0||p===0?f:p+u[l[p]]>f?p:f}},{"./common":41}],43:[function(e,r,n){r.exports=function(s,a,o,u){for(var d=65535&s|0,m=s>>>16&65535|0,l=0;o!==0;){for(o-=l=2e3<o?2e3:o;m=m+(d=d+a[u++]|0)|0,--l;);d%=65521,m%=65521}return d|m<<16|0}},{}],44:[function(e,r,n){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,r,n){var s=function(){for(var a,o=[],u=0;u<256;u++){a=u;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;o[u]=a}return o}();r.exports=function(a,o,u,d){var m=s,l=d+u;a^=-1;for(var f=d;f<l;f++)a=a>>>8^m[255&(a^o[f])];return-1^a}},{}],46:[function(e,r,n){var s,a=e("../utils/common"),o=e("./trees"),u=e("./adler32"),d=e("./crc32"),m=e("./messages"),l=0,f=4,p=0,y=-2,v=-1,_=4,w=2,T=8,E=9,R=286,H=30,Y=19,j=2*R+1,et=15,J=3,rt=258,gt=rt+J+1,X=42,Q=113,S=1,ut=2,Pt=3,pt=4;function Wt(C,At){return C.msg=m[At],At}function bt(C){return(C<<1)-(4<C?9:0)}function xt(C){for(var At=C.length;0<=--At;)C[At]=0}function tt(C){var At=C.state,vt=At.pending;vt>C.avail_out&&(vt=C.avail_out),vt!==0&&(a.arraySet(C.output,At.pending_buf,At.pending_out,vt,C.next_out),C.next_out+=vt,At.pending_out+=vt,C.total_out+=vt,C.avail_out-=vt,At.pending-=vt,At.pending===0&&(At.pending_out=0))}function it(C,At){o._tr_flush_block(C,0<=C.block_start?C.block_start:-1,C.strstart-C.block_start,At),C.block_start=C.strstart,tt(C.strm)}function Gt(C,At){C.pending_buf[C.pending++]=At}function Dt(C,At){C.pending_buf[C.pending++]=At>>>8&255,C.pending_buf[C.pending++]=255&At}function Mt(C,At){var vt,K,V=C.max_chain_length,lt=C.strstart,Et=C.prev_length,Tt=C.nice_match,at=C.strstart>C.w_size-gt?C.strstart-(C.w_size-gt):0,Ut=C.window,$t=C.w_mask,Lt=C.prev,ee=C.strstart+rt,L=Ut[lt+Et-1],b=Ut[lt+Et];C.prev_length>=C.good_match&&(V>>=2),Tt>C.lookahead&&(Tt=C.lookahead);do if(Ut[(vt=At)+Et]===b&&Ut[vt+Et-1]===L&&Ut[vt]===Ut[lt]&&Ut[++vt]===Ut[lt+1]){lt+=2,vt++;do;while(Ut[++lt]===Ut[++vt]&&Ut[++lt]===Ut[++vt]&&Ut[++lt]===Ut[++vt]&&Ut[++lt]===Ut[++vt]&&Ut[++lt]===Ut[++vt]&&Ut[++lt]===Ut[++vt]&&Ut[++lt]===Ut[++vt]&&Ut[++lt]===Ut[++vt]&&lt<ee);if(K=rt-(ee-lt),lt=ee-rt,Et<K){if(C.match_start=At,Tt<=(Et=K))break;L=Ut[lt+Et-1],b=Ut[lt+Et]}}while((At=Lt[At&$t])>at&&--V!=0);return Et<=C.lookahead?Et:C.lookahead}function te(C){var At,vt,K,V,lt,Et,Tt,at,Ut,$t,Lt=C.w_size;do{if(V=C.window_size-C.lookahead-C.strstart,C.strstart>=Lt+(Lt-gt)){for(a.arraySet(C.window,C.window,Lt,Lt,0),C.match_start-=Lt,C.strstart-=Lt,C.block_start-=Lt,At=vt=C.hash_size;K=C.head[--At],C.head[At]=Lt<=K?K-Lt:0,--vt;);for(At=vt=Lt;K=C.prev[--At],C.prev[At]=Lt<=K?K-Lt:0,--vt;);V+=Lt}if(C.strm.avail_in===0)break;if(Et=C.strm,Tt=C.window,at=C.strstart+C.lookahead,Ut=V,$t=void 0,$t=Et.avail_in,Ut<$t&&($t=Ut),vt=$t===0?0:(Et.avail_in-=$t,a.arraySet(Tt,Et.input,Et.next_in,$t,at),Et.state.wrap===1?Et.adler=u(Et.adler,Tt,$t,at):Et.state.wrap===2&&(Et.adler=d(Et.adler,Tt,$t,at)),Et.next_in+=$t,Et.total_in+=$t,$t),C.lookahead+=vt,C.lookahead+C.insert>=J)for(lt=C.strstart-C.insert,C.ins_h=C.window[lt],C.ins_h=(C.ins_h<<C.hash_shift^C.window[lt+1])&C.hash_mask;C.insert&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[lt+J-1])&C.hash_mask,C.prev[lt&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=lt,lt++,C.insert--,!(C.lookahead+C.insert<J)););}while(C.lookahead<gt&&C.strm.avail_in!==0)}function re(C,At){for(var vt,K;;){if(C.lookahead<gt){if(te(C),C.lookahead<gt&&At===l)return S;if(C.lookahead===0)break}if(vt=0,C.lookahead>=J&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+J-1])&C.hash_mask,vt=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),vt!==0&&C.strstart-vt<=C.w_size-gt&&(C.match_length=Mt(C,vt)),C.match_length>=J)if(K=o._tr_tally(C,C.strstart-C.match_start,C.match_length-J),C.lookahead-=C.match_length,C.match_length<=C.max_lazy_match&&C.lookahead>=J){for(C.match_length--;C.strstart++,C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+J-1])&C.hash_mask,vt=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart,--C.match_length!=0;);C.strstart++}else C.strstart+=C.match_length,C.match_length=0,C.ins_h=C.window[C.strstart],C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+1])&C.hash_mask;else K=o._tr_tally(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++;if(K&&(it(C,!1),C.strm.avail_out===0))return S}return C.insert=C.strstart<J-1?C.strstart:J-1,At===f?(it(C,!0),C.strm.avail_out===0?Pt:pt):C.last_lit&&(it(C,!1),C.strm.avail_out===0)?S:ut}function jt(C,At){for(var vt,K,V;;){if(C.lookahead<gt){if(te(C),C.lookahead<gt&&At===l)return S;if(C.lookahead===0)break}if(vt=0,C.lookahead>=J&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+J-1])&C.hash_mask,vt=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),C.prev_length=C.match_length,C.prev_match=C.match_start,C.match_length=J-1,vt!==0&&C.prev_length<C.max_lazy_match&&C.strstart-vt<=C.w_size-gt&&(C.match_length=Mt(C,vt),C.match_length<=5&&(C.strategy===1||C.match_length===J&&4096<C.strstart-C.match_start)&&(C.match_length=J-1)),C.prev_length>=J&&C.match_length<=C.prev_length){for(V=C.strstart+C.lookahead-J,K=o._tr_tally(C,C.strstart-1-C.prev_match,C.prev_length-J),C.lookahead-=C.prev_length-1,C.prev_length-=2;++C.strstart<=V&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+J-1])&C.hash_mask,vt=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),--C.prev_length!=0;);if(C.match_available=0,C.match_length=J-1,C.strstart++,K&&(it(C,!1),C.strm.avail_out===0))return S}else if(C.match_available){if((K=o._tr_tally(C,0,C.window[C.strstart-1]))&&it(C,!1),C.strstart++,C.lookahead--,C.strm.avail_out===0)return S}else C.match_available=1,C.strstart++,C.lookahead--}return C.match_available&&(K=o._tr_tally(C,0,C.window[C.strstart-1]),C.match_available=0),C.insert=C.strstart<J-1?C.strstart:J-1,At===f?(it(C,!0),C.strm.avail_out===0?Pt:pt):C.last_lit&&(it(C,!1),C.strm.avail_out===0)?S:ut}function qt(C,At,vt,K,V){this.good_length=C,this.max_lazy=At,this.nice_length=vt,this.max_chain=K,this.func=V}function ce(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*j),this.dyn_dtree=new a.Buf16(2*(2*H+1)),this.bl_tree=new a.Buf16(2*(2*Y+1)),xt(this.dyn_ltree),xt(this.dyn_dtree),xt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(et+1),this.heap=new a.Buf16(2*R+1),xt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*R+1),xt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ne(C){var At;return C&&C.state?(C.total_in=C.total_out=0,C.data_type=w,(At=C.state).pending=0,At.pending_out=0,At.wrap<0&&(At.wrap=-At.wrap),At.status=At.wrap?X:Q,C.adler=At.wrap===2?0:1,At.last_flush=l,o._tr_init(At),p):Wt(C,y)}function _e(C){var At=ne(C);return At===p&&function(vt){vt.window_size=2*vt.w_size,xt(vt.head),vt.max_lazy_match=s[vt.level].max_lazy,vt.good_match=s[vt.level].good_length,vt.nice_match=s[vt.level].nice_length,vt.max_chain_length=s[vt.level].max_chain,vt.strstart=0,vt.block_start=0,vt.lookahead=0,vt.insert=0,vt.match_length=vt.prev_length=J-1,vt.match_available=0,vt.ins_h=0}(C.state),At}function pe(C,At,vt,K,V,lt){if(!C)return y;var Et=1;if(At===v&&(At=6),K<0?(Et=0,K=-K):15<K&&(Et=2,K-=16),V<1||E<V||vt!==T||K<8||15<K||At<0||9<At||lt<0||_<lt)return Wt(C,y);K===8&&(K=9);var Tt=new ce;return(C.state=Tt).strm=C,Tt.wrap=Et,Tt.gzhead=null,Tt.w_bits=K,Tt.w_size=1<<Tt.w_bits,Tt.w_mask=Tt.w_size-1,Tt.hash_bits=V+7,Tt.hash_size=1<<Tt.hash_bits,Tt.hash_mask=Tt.hash_size-1,Tt.hash_shift=~~((Tt.hash_bits+J-1)/J),Tt.window=new a.Buf8(2*Tt.w_size),Tt.head=new a.Buf16(Tt.hash_size),Tt.prev=new a.Buf16(Tt.w_size),Tt.lit_bufsize=1<<V+6,Tt.pending_buf_size=4*Tt.lit_bufsize,Tt.pending_buf=new a.Buf8(Tt.pending_buf_size),Tt.d_buf=1*Tt.lit_bufsize,Tt.l_buf=3*Tt.lit_bufsize,Tt.level=At,Tt.strategy=lt,Tt.method=vt,_e(C)}s=[new qt(0,0,0,0,function(C,At){var vt=65535;for(vt>C.pending_buf_size-5&&(vt=C.pending_buf_size-5);;){if(C.lookahead<=1){if(te(C),C.lookahead===0&&At===l)return S;if(C.lookahead===0)break}C.strstart+=C.lookahead,C.lookahead=0;var K=C.block_start+vt;if((C.strstart===0||C.strstart>=K)&&(C.lookahead=C.strstart-K,C.strstart=K,it(C,!1),C.strm.avail_out===0)||C.strstart-C.block_start>=C.w_size-gt&&(it(C,!1),C.strm.avail_out===0))return S}return C.insert=0,At===f?(it(C,!0),C.strm.avail_out===0?Pt:pt):(C.strstart>C.block_start&&(it(C,!1),C.strm.avail_out),S)}),new qt(4,4,8,4,re),new qt(4,5,16,8,re),new qt(4,6,32,32,re),new qt(4,4,16,16,jt),new qt(8,16,32,32,jt),new qt(8,16,128,128,jt),new qt(8,32,128,256,jt),new qt(32,128,258,1024,jt),new qt(32,258,258,4096,jt)],n.deflateInit=function(C,At){return pe(C,At,T,15,8,0)},n.deflateInit2=pe,n.deflateReset=_e,n.deflateResetKeep=ne,n.deflateSetHeader=function(C,At){return C&&C.state?C.state.wrap!==2?y:(C.state.gzhead=At,p):y},n.deflate=function(C,At){var vt,K,V,lt;if(!C||!C.state||5<At||At<0)return C?Wt(C,y):y;if(K=C.state,!C.output||!C.input&&C.avail_in!==0||K.status===666&&At!==f)return Wt(C,C.avail_out===0?-5:y);if(K.strm=C,vt=K.last_flush,K.last_flush=At,K.status===X)if(K.wrap===2)C.adler=0,Gt(K,31),Gt(K,139),Gt(K,8),K.gzhead?(Gt(K,(K.gzhead.text?1:0)+(K.gzhead.hcrc?2:0)+(K.gzhead.extra?4:0)+(K.gzhead.name?8:0)+(K.gzhead.comment?16:0)),Gt(K,255&K.gzhead.time),Gt(K,K.gzhead.time>>8&255),Gt(K,K.gzhead.time>>16&255),Gt(K,K.gzhead.time>>24&255),Gt(K,K.level===9?2:2<=K.strategy||K.level<2?4:0),Gt(K,255&K.gzhead.os),K.gzhead.extra&&K.gzhead.extra.length&&(Gt(K,255&K.gzhead.extra.length),Gt(K,K.gzhead.extra.length>>8&255)),K.gzhead.hcrc&&(C.adler=d(C.adler,K.pending_buf,K.pending,0)),K.gzindex=0,K.status=69):(Gt(K,0),Gt(K,0),Gt(K,0),Gt(K,0),Gt(K,0),Gt(K,K.level===9?2:2<=K.strategy||K.level<2?4:0),Gt(K,3),K.status=Q);else{var Et=T+(K.w_bits-8<<4)<<8;Et|=(2<=K.strategy||K.level<2?0:K.level<6?1:K.level===6?2:3)<<6,K.strstart!==0&&(Et|=32),Et+=31-Et%31,K.status=Q,Dt(K,Et),K.strstart!==0&&(Dt(K,C.adler>>>16),Dt(K,65535&C.adler)),C.adler=1}if(K.status===69)if(K.gzhead.extra){for(V=K.pending;K.gzindex<(65535&K.gzhead.extra.length)&&(K.pending!==K.pending_buf_size||(K.gzhead.hcrc&&K.pending>V&&(C.adler=d(C.adler,K.pending_buf,K.pending-V,V)),tt(C),V=K.pending,K.pending!==K.pending_buf_size));)Gt(K,255&K.gzhead.extra[K.gzindex]),K.gzindex++;K.gzhead.hcrc&&K.pending>V&&(C.adler=d(C.adler,K.pending_buf,K.pending-V,V)),K.gzindex===K.gzhead.extra.length&&(K.gzindex=0,K.status=73)}else K.status=73;if(K.status===73)if(K.gzhead.name){V=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>V&&(C.adler=d(C.adler,K.pending_buf,K.pending-V,V)),tt(C),V=K.pending,K.pending===K.pending_buf_size)){lt=1;break}lt=K.gzindex<K.gzhead.name.length?255&K.gzhead.name.charCodeAt(K.gzindex++):0,Gt(K,lt)}while(lt!==0);K.gzhead.hcrc&&K.pending>V&&(C.adler=d(C.adler,K.pending_buf,K.pending-V,V)),lt===0&&(K.gzindex=0,K.status=91)}else K.status=91;if(K.status===91)if(K.gzhead.comment){V=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>V&&(C.adler=d(C.adler,K.pending_buf,K.pending-V,V)),tt(C),V=K.pending,K.pending===K.pending_buf_size)){lt=1;break}lt=K.gzindex<K.gzhead.comment.length?255&K.gzhead.comment.charCodeAt(K.gzindex++):0,Gt(K,lt)}while(lt!==0);K.gzhead.hcrc&&K.pending>V&&(C.adler=d(C.adler,K.pending_buf,K.pending-V,V)),lt===0&&(K.status=103)}else K.status=103;if(K.status===103&&(K.gzhead.hcrc?(K.pending+2>K.pending_buf_size&&tt(C),K.pending+2<=K.pending_buf_size&&(Gt(K,255&C.adler),Gt(K,C.adler>>8&255),C.adler=0,K.status=Q)):K.status=Q),K.pending!==0){if(tt(C),C.avail_out===0)return K.last_flush=-1,p}else if(C.avail_in===0&&bt(At)<=bt(vt)&&At!==f)return Wt(C,-5);if(K.status===666&&C.avail_in!==0)return Wt(C,-5);if(C.avail_in!==0||K.lookahead!==0||At!==l&&K.status!==666){var Tt=K.strategy===2?function(at,Ut){for(var $t;;){if(at.lookahead===0&&(te(at),at.lookahead===0)){if(Ut===l)return S;break}if(at.match_length=0,$t=o._tr_tally(at,0,at.window[at.strstart]),at.lookahead--,at.strstart++,$t&&(it(at,!1),at.strm.avail_out===0))return S}return at.insert=0,Ut===f?(it(at,!0),at.strm.avail_out===0?Pt:pt):at.last_lit&&(it(at,!1),at.strm.avail_out===0)?S:ut}(K,At):K.strategy===3?function(at,Ut){for(var $t,Lt,ee,L,b=at.window;;){if(at.lookahead<=rt){if(te(at),at.lookahead<=rt&&Ut===l)return S;if(at.lookahead===0)break}if(at.match_length=0,at.lookahead>=J&&0<at.strstart&&(Lt=b[ee=at.strstart-1])===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]){L=at.strstart+rt;do;while(Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&ee<L);at.match_length=rt-(L-ee),at.match_length>at.lookahead&&(at.match_length=at.lookahead)}if(at.match_length>=J?($t=o._tr_tally(at,1,at.match_length-J),at.lookahead-=at.match_length,at.strstart+=at.match_length,at.match_length=0):($t=o._tr_tally(at,0,at.window[at.strstart]),at.lookahead--,at.strstart++),$t&&(it(at,!1),at.strm.avail_out===0))return S}return at.insert=0,Ut===f?(it(at,!0),at.strm.avail_out===0?Pt:pt):at.last_lit&&(it(at,!1),at.strm.avail_out===0)?S:ut}(K,At):s[K.level].func(K,At);if(Tt!==Pt&&Tt!==pt||(K.status=666),Tt===S||Tt===Pt)return C.avail_out===0&&(K.last_flush=-1),p;if(Tt===ut&&(At===1?o._tr_align(K):At!==5&&(o._tr_stored_block(K,0,0,!1),At===3&&(xt(K.head),K.lookahead===0&&(K.strstart=0,K.block_start=0,K.insert=0))),tt(C),C.avail_out===0))return K.last_flush=-1,p}return At!==f?p:K.wrap<=0?1:(K.wrap===2?(Gt(K,255&C.adler),Gt(K,C.adler>>8&255),Gt(K,C.adler>>16&255),Gt(K,C.adler>>24&255),Gt(K,255&C.total_in),Gt(K,C.total_in>>8&255),Gt(K,C.total_in>>16&255),Gt(K,C.total_in>>24&255)):(Dt(K,C.adler>>>16),Dt(K,65535&C.adler)),tt(C),0<K.wrap&&(K.wrap=-K.wrap),K.pending!==0?p:1)},n.deflateEnd=function(C){var At;return C&&C.state?(At=C.state.status)!==X&&At!==69&&At!==73&&At!==91&&At!==103&&At!==Q&&At!==666?Wt(C,y):(C.state=null,At===Q?Wt(C,-3):p):y},n.deflateSetDictionary=function(C,At){var vt,K,V,lt,Et,Tt,at,Ut,$t=At.length;if(!C||!C.state||(lt=(vt=C.state).wrap)===2||lt===1&&vt.status!==X||vt.lookahead)return y;for(lt===1&&(C.adler=u(C.adler,At,$t,0)),vt.wrap=0,$t>=vt.w_size&&(lt===0&&(xt(vt.head),vt.strstart=0,vt.block_start=0,vt.insert=0),Ut=new a.Buf8(vt.w_size),a.arraySet(Ut,At,$t-vt.w_size,vt.w_size,0),At=Ut,$t=vt.w_size),Et=C.avail_in,Tt=C.next_in,at=C.input,C.avail_in=$t,C.next_in=0,C.input=At,te(vt);vt.lookahead>=J;){for(K=vt.strstart,V=vt.lookahead-(J-1);vt.ins_h=(vt.ins_h<<vt.hash_shift^vt.window[K+J-1])&vt.hash_mask,vt.prev[K&vt.w_mask]=vt.head[vt.ins_h],vt.head[vt.ins_h]=K,K++,--V;);vt.strstart=K,vt.lookahead=J-1,te(vt)}return vt.strstart+=vt.lookahead,vt.block_start=vt.strstart,vt.insert=vt.lookahead,vt.lookahead=0,vt.match_length=vt.prev_length=J-1,vt.match_available=0,C.next_in=Tt,C.input=at,C.avail_in=Et,vt.wrap=lt,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,r,n){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,r,n){r.exports=function(s,a){var o,u,d,m,l,f,p,y,v,_,w,T,E,R,H,Y,j,et,J,rt,gt,X,Q,S,ut;o=s.state,u=s.next_in,S=s.input,d=u+(s.avail_in-5),m=s.next_out,ut=s.output,l=m-(a-s.avail_out),f=m+(s.avail_out-257),p=o.dmax,y=o.wsize,v=o.whave,_=o.wnext,w=o.window,T=o.hold,E=o.bits,R=o.lencode,H=o.distcode,Y=(1<<o.lenbits)-1,j=(1<<o.distbits)-1;t:do{E<15&&(T+=S[u++]<<E,E+=8,T+=S[u++]<<E,E+=8),et=R[T&Y];e:for(;;){if(T>>>=J=et>>>24,E-=J,(J=et>>>16&255)===0)ut[m++]=65535&et;else{if(!(16&J)){if((64&J)==0){et=R[(65535&et)+(T&(1<<J)-1)];continue e}if(32&J){o.mode=12;break t}s.msg="invalid literal/length code",o.mode=30;break t}rt=65535&et,(J&=15)&&(E<J&&(T+=S[u++]<<E,E+=8),rt+=T&(1<<J)-1,T>>>=J,E-=J),E<15&&(T+=S[u++]<<E,E+=8,T+=S[u++]<<E,E+=8),et=H[T&j];i:for(;;){if(T>>>=J=et>>>24,E-=J,!(16&(J=et>>>16&255))){if((64&J)==0){et=H[(65535&et)+(T&(1<<J)-1)];continue i}s.msg="invalid distance code",o.mode=30;break t}if(gt=65535&et,E<(J&=15)&&(T+=S[u++]<<E,(E+=8)<J&&(T+=S[u++]<<E,E+=8)),p<(gt+=T&(1<<J)-1)){s.msg="invalid distance too far back",o.mode=30;break t}if(T>>>=J,E-=J,(J=m-l)<gt){if(v<(J=gt-J)&&o.sane){s.msg="invalid distance too far back",o.mode=30;break t}if(Q=w,(X=0)===_){if(X+=y-J,J<rt){for(rt-=J;ut[m++]=w[X++],--J;);X=m-gt,Q=ut}}else if(_<J){if(X+=y+_-J,(J-=_)<rt){for(rt-=J;ut[m++]=w[X++],--J;);if(X=0,_<rt){for(rt-=J=_;ut[m++]=w[X++],--J;);X=m-gt,Q=ut}}}else if(X+=_-J,J<rt){for(rt-=J;ut[m++]=w[X++],--J;);X=m-gt,Q=ut}for(;2<rt;)ut[m++]=Q[X++],ut[m++]=Q[X++],ut[m++]=Q[X++],rt-=3;rt&&(ut[m++]=Q[X++],1<rt&&(ut[m++]=Q[X++]))}else{for(X=m-gt;ut[m++]=ut[X++],ut[m++]=ut[X++],ut[m++]=ut[X++],2<(rt-=3););rt&&(ut[m++]=ut[X++],1<rt&&(ut[m++]=ut[X++]))}break}}break}}while(u<d&&m<f);u-=rt=E>>3,T&=(1<<(E-=rt<<3))-1,s.next_in=u,s.next_out=m,s.avail_in=u<d?d-u+5:5-(u-d),s.avail_out=m<f?f-m+257:257-(m-f),o.hold=T,o.bits=E}},{}],49:[function(e,r,n){var s=e("../utils/common"),a=e("./adler32"),o=e("./crc32"),u=e("./inffast"),d=e("./inftrees"),m=1,l=2,f=0,p=-2,y=1,v=852,_=592;function w(X){return(X>>>24&255)+(X>>>8&65280)+((65280&X)<<8)+((255&X)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(X){var Q;return X&&X.state?(Q=X.state,X.total_in=X.total_out=Q.total=0,X.msg="",Q.wrap&&(X.adler=1&Q.wrap),Q.mode=y,Q.last=0,Q.havedict=0,Q.dmax=32768,Q.head=null,Q.hold=0,Q.bits=0,Q.lencode=Q.lendyn=new s.Buf32(v),Q.distcode=Q.distdyn=new s.Buf32(_),Q.sane=1,Q.back=-1,f):p}function R(X){var Q;return X&&X.state?((Q=X.state).wsize=0,Q.whave=0,Q.wnext=0,E(X)):p}function H(X,Q){var S,ut;return X&&X.state?(ut=X.state,Q<0?(S=0,Q=-Q):(S=1+(Q>>4),Q<48&&(Q&=15)),Q&&(Q<8||15<Q)?p:(ut.window!==null&&ut.wbits!==Q&&(ut.window=null),ut.wrap=S,ut.wbits=Q,R(X))):p}function Y(X,Q){var S,ut;return X?(ut=new T,(X.state=ut).window=null,(S=H(X,Q))!==f&&(X.state=null),S):p}var j,et,J=!0;function rt(X){if(J){var Q;for(j=new s.Buf32(512),et=new s.Buf32(32),Q=0;Q<144;)X.lens[Q++]=8;for(;Q<256;)X.lens[Q++]=9;for(;Q<280;)X.lens[Q++]=7;for(;Q<288;)X.lens[Q++]=8;for(d(m,X.lens,0,288,j,0,X.work,{bits:9}),Q=0;Q<32;)X.lens[Q++]=5;d(l,X.lens,0,32,et,0,X.work,{bits:5}),J=!1}X.lencode=j,X.lenbits=9,X.distcode=et,X.distbits=5}function gt(X,Q,S,ut){var Pt,pt=X.state;return pt.window===null&&(pt.wsize=1<<pt.wbits,pt.wnext=0,pt.whave=0,pt.window=new s.Buf8(pt.wsize)),ut>=pt.wsize?(s.arraySet(pt.window,Q,S-pt.wsize,pt.wsize,0),pt.wnext=0,pt.whave=pt.wsize):(ut<(Pt=pt.wsize-pt.wnext)&&(Pt=ut),s.arraySet(pt.window,Q,S-ut,Pt,pt.wnext),(ut-=Pt)?(s.arraySet(pt.window,Q,S-ut,ut,0),pt.wnext=ut,pt.whave=pt.wsize):(pt.wnext+=Pt,pt.wnext===pt.wsize&&(pt.wnext=0),pt.whave<pt.wsize&&(pt.whave+=Pt))),0}n.inflateReset=R,n.inflateReset2=H,n.inflateResetKeep=E,n.inflateInit=function(X){return Y(X,15)},n.inflateInit2=Y,n.inflate=function(X,Q){var S,ut,Pt,pt,Wt,bt,xt,tt,it,Gt,Dt,Mt,te,re,jt,qt,ce,ne,_e,pe,C,At,vt,K,V=0,lt=new s.Buf8(4),Et=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!X||!X.state||!X.output||!X.input&&X.avail_in!==0)return p;(S=X.state).mode===12&&(S.mode=13),Wt=X.next_out,Pt=X.output,xt=X.avail_out,pt=X.next_in,ut=X.input,bt=X.avail_in,tt=S.hold,it=S.bits,Gt=bt,Dt=xt,At=f;t:for(;;)switch(S.mode){case y:if(S.wrap===0){S.mode=13;break}for(;it<16;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}if(2&S.wrap&&tt===35615){lt[S.check=0]=255&tt,lt[1]=tt>>>8&255,S.check=o(S.check,lt,2,0),it=tt=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&tt)<<8)+(tt>>8))%31){X.msg="incorrect header check",S.mode=30;break}if((15&tt)!=8){X.msg="unknown compression method",S.mode=30;break}if(it-=4,C=8+(15&(tt>>>=4)),S.wbits===0)S.wbits=C;else if(C>S.wbits){X.msg="invalid window size",S.mode=30;break}S.dmax=1<<C,X.adler=S.check=1,S.mode=512&tt?10:12,it=tt=0;break;case 2:for(;it<16;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}if(S.flags=tt,(255&S.flags)!=8){X.msg="unknown compression method",S.mode=30;break}if(57344&S.flags){X.msg="unknown header flags set",S.mode=30;break}S.head&&(S.head.text=tt>>8&1),512&S.flags&&(lt[0]=255&tt,lt[1]=tt>>>8&255,S.check=o(S.check,lt,2,0)),it=tt=0,S.mode=3;case 3:for(;it<32;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}S.head&&(S.head.time=tt),512&S.flags&&(lt[0]=255&tt,lt[1]=tt>>>8&255,lt[2]=tt>>>16&255,lt[3]=tt>>>24&255,S.check=o(S.check,lt,4,0)),it=tt=0,S.mode=4;case 4:for(;it<16;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}S.head&&(S.head.xflags=255&tt,S.head.os=tt>>8),512&S.flags&&(lt[0]=255&tt,lt[1]=tt>>>8&255,S.check=o(S.check,lt,2,0)),it=tt=0,S.mode=5;case 5:if(1024&S.flags){for(;it<16;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}S.length=tt,S.head&&(S.head.extra_len=tt),512&S.flags&&(lt[0]=255&tt,lt[1]=tt>>>8&255,S.check=o(S.check,lt,2,0)),it=tt=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags&&(bt<(Mt=S.length)&&(Mt=bt),Mt&&(S.head&&(C=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Array(S.head.extra_len)),s.arraySet(S.head.extra,ut,pt,Mt,C)),512&S.flags&&(S.check=o(S.check,ut,Mt,pt)),bt-=Mt,pt+=Mt,S.length-=Mt),S.length))break t;S.length=0,S.mode=7;case 7:if(2048&S.flags){if(bt===0)break t;for(Mt=0;C=ut[pt+Mt++],S.head&&C&&S.length<65536&&(S.head.name+=String.fromCharCode(C)),C&&Mt<bt;);if(512&S.flags&&(S.check=o(S.check,ut,Mt,pt)),bt-=Mt,pt+=Mt,C)break t}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(bt===0)break t;for(Mt=0;C=ut[pt+Mt++],S.head&&C&&S.length<65536&&(S.head.comment+=String.fromCharCode(C)),C&&Mt<bt;);if(512&S.flags&&(S.check=o(S.check,ut,Mt,pt)),bt-=Mt,pt+=Mt,C)break t}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;it<16;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}if(tt!==(65535&S.check)){X.msg="header crc mismatch",S.mode=30;break}it=tt=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),X.adler=S.check=0,S.mode=12;break;case 10:for(;it<32;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}X.adler=S.check=w(tt),it=tt=0,S.mode=11;case 11:if(S.havedict===0)return X.next_out=Wt,X.avail_out=xt,X.next_in=pt,X.avail_in=bt,S.hold=tt,S.bits=it,2;X.adler=S.check=1,S.mode=12;case 12:if(Q===5||Q===6)break t;case 13:if(S.last){tt>>>=7&it,it-=7&it,S.mode=27;break}for(;it<3;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}switch(S.last=1&tt,it-=1,3&(tt>>>=1)){case 0:S.mode=14;break;case 1:if(rt(S),S.mode=20,Q!==6)break;tt>>>=2,it-=2;break t;case 2:S.mode=17;break;case 3:X.msg="invalid block type",S.mode=30}tt>>>=2,it-=2;break;case 14:for(tt>>>=7&it,it-=7&it;it<32;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}if((65535&tt)!=(tt>>>16^65535)){X.msg="invalid stored block lengths",S.mode=30;break}if(S.length=65535&tt,it=tt=0,S.mode=15,Q===6)break t;case 15:S.mode=16;case 16:if(Mt=S.length){if(bt<Mt&&(Mt=bt),xt<Mt&&(Mt=xt),Mt===0)break t;s.arraySet(Pt,ut,pt,Mt,Wt),bt-=Mt,pt+=Mt,xt-=Mt,Wt+=Mt,S.length-=Mt;break}S.mode=12;break;case 17:for(;it<14;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}if(S.nlen=257+(31&tt),tt>>>=5,it-=5,S.ndist=1+(31&tt),tt>>>=5,it-=5,S.ncode=4+(15&tt),tt>>>=4,it-=4,286<S.nlen||30<S.ndist){X.msg="too many length or distance symbols",S.mode=30;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;it<3;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}S.lens[Et[S.have++]]=7&tt,tt>>>=3,it-=3}for(;S.have<19;)S.lens[Et[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,vt={bits:S.lenbits},At=d(0,S.lens,0,19,S.lencode,0,S.work,vt),S.lenbits=vt.bits,At){X.msg="invalid code lengths set",S.mode=30;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;qt=(V=S.lencode[tt&(1<<S.lenbits)-1])>>>16&255,ce=65535&V,!((jt=V>>>24)<=it);){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}if(ce<16)tt>>>=jt,it-=jt,S.lens[S.have++]=ce;else{if(ce===16){for(K=jt+2;it<K;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}if(tt>>>=jt,it-=jt,S.have===0){X.msg="invalid bit length repeat",S.mode=30;break}C=S.lens[S.have-1],Mt=3+(3&tt),tt>>>=2,it-=2}else if(ce===17){for(K=jt+3;it<K;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}it-=jt,C=0,Mt=3+(7&(tt>>>=jt)),tt>>>=3,it-=3}else{for(K=jt+7;it<K;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}it-=jt,C=0,Mt=11+(127&(tt>>>=jt)),tt>>>=7,it-=7}if(S.have+Mt>S.nlen+S.ndist){X.msg="invalid bit length repeat",S.mode=30;break}for(;Mt--;)S.lens[S.have++]=C}}if(S.mode===30)break;if(S.lens[256]===0){X.msg="invalid code -- missing end-of-block",S.mode=30;break}if(S.lenbits=9,vt={bits:S.lenbits},At=d(m,S.lens,0,S.nlen,S.lencode,0,S.work,vt),S.lenbits=vt.bits,At){X.msg="invalid literal/lengths set",S.mode=30;break}if(S.distbits=6,S.distcode=S.distdyn,vt={bits:S.distbits},At=d(l,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,vt),S.distbits=vt.bits,At){X.msg="invalid distances set",S.mode=30;break}if(S.mode=20,Q===6)break t;case 20:S.mode=21;case 21:if(6<=bt&&258<=xt){X.next_out=Wt,X.avail_out=xt,X.next_in=pt,X.avail_in=bt,S.hold=tt,S.bits=it,u(X,Dt),Wt=X.next_out,Pt=X.output,xt=X.avail_out,pt=X.next_in,ut=X.input,bt=X.avail_in,tt=S.hold,it=S.bits,S.mode===12&&(S.back=-1);break}for(S.back=0;qt=(V=S.lencode[tt&(1<<S.lenbits)-1])>>>16&255,ce=65535&V,!((jt=V>>>24)<=it);){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}if(qt&&(240&qt)==0){for(ne=jt,_e=qt,pe=ce;qt=(V=S.lencode[pe+((tt&(1<<ne+_e)-1)>>ne)])>>>16&255,ce=65535&V,!(ne+(jt=V>>>24)<=it);){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}tt>>>=ne,it-=ne,S.back+=ne}if(tt>>>=jt,it-=jt,S.back+=jt,S.length=ce,qt===0){S.mode=26;break}if(32&qt){S.back=-1,S.mode=12;break}if(64&qt){X.msg="invalid literal/length code",S.mode=30;break}S.extra=15&qt,S.mode=22;case 22:if(S.extra){for(K=S.extra;it<K;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}S.length+=tt&(1<<S.extra)-1,tt>>>=S.extra,it-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;qt=(V=S.distcode[tt&(1<<S.distbits)-1])>>>16&255,ce=65535&V,!((jt=V>>>24)<=it);){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}if((240&qt)==0){for(ne=jt,_e=qt,pe=ce;qt=(V=S.distcode[pe+((tt&(1<<ne+_e)-1)>>ne)])>>>16&255,ce=65535&V,!(ne+(jt=V>>>24)<=it);){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}tt>>>=ne,it-=ne,S.back+=ne}if(tt>>>=jt,it-=jt,S.back+=jt,64&qt){X.msg="invalid distance code",S.mode=30;break}S.offset=ce,S.extra=15&qt,S.mode=24;case 24:if(S.extra){for(K=S.extra;it<K;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}S.offset+=tt&(1<<S.extra)-1,tt>>>=S.extra,it-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){X.msg="invalid distance too far back",S.mode=30;break}S.mode=25;case 25:if(xt===0)break t;if(Mt=Dt-xt,S.offset>Mt){if((Mt=S.offset-Mt)>S.whave&&S.sane){X.msg="invalid distance too far back",S.mode=30;break}te=Mt>S.wnext?(Mt-=S.wnext,S.wsize-Mt):S.wnext-Mt,Mt>S.length&&(Mt=S.length),re=S.window}else re=Pt,te=Wt-S.offset,Mt=S.length;for(xt<Mt&&(Mt=xt),xt-=Mt,S.length-=Mt;Pt[Wt++]=re[te++],--Mt;);S.length===0&&(S.mode=21);break;case 26:if(xt===0)break t;Pt[Wt++]=S.length,xt--,S.mode=21;break;case 27:if(S.wrap){for(;it<32;){if(bt===0)break t;bt--,tt|=ut[pt++]<<it,it+=8}if(Dt-=xt,X.total_out+=Dt,S.total+=Dt,Dt&&(X.adler=S.check=S.flags?o(S.check,Pt,Dt,Wt-Dt):a(S.check,Pt,Dt,Wt-Dt)),Dt=xt,(S.flags?tt:w(tt))!==S.check){X.msg="incorrect data check",S.mode=30;break}it=tt=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;it<32;){if(bt===0)break t;bt--,tt+=ut[pt++]<<it,it+=8}if(tt!==(4294967295&S.total)){X.msg="incorrect length check",S.mode=30;break}it=tt=0}S.mode=29;case 29:At=1;break t;case 30:At=-3;break t;case 31:return-4;case 32:default:return p}return X.next_out=Wt,X.avail_out=xt,X.next_in=pt,X.avail_in=bt,S.hold=tt,S.bits=it,(S.wsize||Dt!==X.avail_out&&S.mode<30&&(S.mode<27||Q!==4))&&gt(X,X.output,X.next_out,Dt-X.avail_out)?(S.mode=31,-4):(Gt-=X.avail_in,Dt-=X.avail_out,X.total_in+=Gt,X.total_out+=Dt,S.total+=Dt,S.wrap&&Dt&&(X.adler=S.check=S.flags?o(S.check,Pt,Dt,X.next_out-Dt):a(S.check,Pt,Dt,X.next_out-Dt)),X.data_type=S.bits+(S.last?64:0)+(S.mode===12?128:0)+(S.mode===20||S.mode===15?256:0),(Gt==0&&Dt===0||Q===4)&&At===f&&(At=-5),At)},n.inflateEnd=function(X){if(!X||!X.state)return p;var Q=X.state;return Q.window&&(Q.window=null),X.state=null,f},n.inflateGetHeader=function(X,Q){var S;return X&&X.state?(2&(S=X.state).wrap)==0?p:((S.head=Q).done=!1,f):p},n.inflateSetDictionary=function(X,Q){var S,ut=Q.length;return X&&X.state?(S=X.state).wrap!==0&&S.mode!==11?p:S.mode===11&&a(1,Q,ut,0)!==S.check?-3:gt(X,Q,ut,ut)?(S.mode=31,-4):(S.havedict=1,f):p},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,r,n){var s=e("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(m,l,f,p,y,v,_,w){var T,E,R,H,Y,j,et,J,rt,gt=w.bits,X=0,Q=0,S=0,ut=0,Pt=0,pt=0,Wt=0,bt=0,xt=0,tt=0,it=null,Gt=0,Dt=new s.Buf16(16),Mt=new s.Buf16(16),te=null,re=0;for(X=0;X<=15;X++)Dt[X]=0;for(Q=0;Q<p;Q++)Dt[l[f+Q]]++;for(Pt=gt,ut=15;1<=ut&&Dt[ut]===0;ut--);if(ut<Pt&&(Pt=ut),ut===0)return y[v++]=20971520,y[v++]=20971520,w.bits=1,0;for(S=1;S<ut&&Dt[S]===0;S++);for(Pt<S&&(Pt=S),X=bt=1;X<=15;X++)if(bt<<=1,(bt-=Dt[X])<0)return-1;if(0<bt&&(m===0||ut!==1))return-1;for(Mt[1]=0,X=1;X<15;X++)Mt[X+1]=Mt[X]+Dt[X];for(Q=0;Q<p;Q++)l[f+Q]!==0&&(_[Mt[l[f+Q]]++]=Q);if(j=m===0?(it=te=_,19):m===1?(it=a,Gt-=257,te=o,re-=257,256):(it=u,te=d,-1),X=S,Y=v,Wt=Q=tt=0,R=-1,H=(xt=1<<(pt=Pt))-1,m===1&&852<xt||m===2&&592<xt)return 1;for(;;){for(et=X-Wt,rt=_[Q]<j?(J=0,_[Q]):_[Q]>j?(J=te[re+_[Q]],it[Gt+_[Q]]):(J=96,0),T=1<<X-Wt,S=E=1<<pt;y[Y+(tt>>Wt)+(E-=T)]=et<<24|J<<16|rt|0,E!==0;);for(T=1<<X-1;tt&T;)T>>=1;if(T!==0?(tt&=T-1,tt+=T):tt=0,Q++,--Dt[X]==0){if(X===ut)break;X=l[f+_[Q]]}if(Pt<X&&(tt&H)!==R){for(Wt===0&&(Wt=Pt),Y+=S,bt=1<<(pt=X-Wt);pt+Wt<ut&&!((bt-=Dt[pt+Wt])<=0);)pt++,bt<<=1;if(xt+=1<<pt,m===1&&852<xt||m===2&&592<xt)return 1;y[R=tt&H]=Pt<<24|pt<<16|Y-v|0}}return tt!==0&&(y[Y+tt]=X-Wt<<24|64<<16|0),w.bits=Pt,0}},{"../utils/common":41}],51:[function(e,r,n){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,r,n){var s=e("../utils/common"),a=0,o=1;function u(V){for(var lt=V.length;0<=--lt;)V[lt]=0}var d=0,m=29,l=256,f=l+1+m,p=30,y=19,v=2*f+1,_=15,w=16,T=7,E=256,R=16,H=17,Y=18,j=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],et=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],J=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],rt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],gt=new Array(2*(f+2));u(gt);var X=new Array(2*p);u(X);var Q=new Array(512);u(Q);var S=new Array(256);u(S);var ut=new Array(m);u(ut);var Pt,pt,Wt,bt=new Array(p);function xt(V,lt,Et,Tt,at){this.static_tree=V,this.extra_bits=lt,this.extra_base=Et,this.elems=Tt,this.max_length=at,this.has_stree=V&&V.length}function tt(V,lt){this.dyn_tree=V,this.max_code=0,this.stat_desc=lt}function it(V){return V<256?Q[V]:Q[256+(V>>>7)]}function Gt(V,lt){V.pending_buf[V.pending++]=255&lt,V.pending_buf[V.pending++]=lt>>>8&255}function Dt(V,lt,Et){V.bi_valid>w-Et?(V.bi_buf|=lt<<V.bi_valid&65535,Gt(V,V.bi_buf),V.bi_buf=lt>>w-V.bi_valid,V.bi_valid+=Et-w):(V.bi_buf|=lt<<V.bi_valid&65535,V.bi_valid+=Et)}function Mt(V,lt,Et){Dt(V,Et[2*lt],Et[2*lt+1])}function te(V,lt){for(var Et=0;Et|=1&V,V>>>=1,Et<<=1,0<--lt;);return Et>>>1}function re(V,lt,Et){var Tt,at,Ut=new Array(_+1),$t=0;for(Tt=1;Tt<=_;Tt++)Ut[Tt]=$t=$t+Et[Tt-1]<<1;for(at=0;at<=lt;at++){var Lt=V[2*at+1];Lt!==0&&(V[2*at]=te(Ut[Lt]++,Lt))}}function jt(V){var lt;for(lt=0;lt<f;lt++)V.dyn_ltree[2*lt]=0;for(lt=0;lt<p;lt++)V.dyn_dtree[2*lt]=0;for(lt=0;lt<y;lt++)V.bl_tree[2*lt]=0;V.dyn_ltree[2*E]=1,V.opt_len=V.static_len=0,V.last_lit=V.matches=0}function qt(V){8<V.bi_valid?Gt(V,V.bi_buf):0<V.bi_valid&&(V.pending_buf[V.pending++]=V.bi_buf),V.bi_buf=0,V.bi_valid=0}function ce(V,lt,Et,Tt){var at=2*lt,Ut=2*Et;return V[at]<V[Ut]||V[at]===V[Ut]&&Tt[lt]<=Tt[Et]}function ne(V,lt,Et){for(var Tt=V.heap[Et],at=Et<<1;at<=V.heap_len&&(at<V.heap_len&&ce(lt,V.heap[at+1],V.heap[at],V.depth)&&at++,!ce(lt,Tt,V.heap[at],V.depth));)V.heap[Et]=V.heap[at],Et=at,at<<=1;V.heap[Et]=Tt}function _e(V,lt,Et){var Tt,at,Ut,$t,Lt=0;if(V.last_lit!==0)for(;Tt=V.pending_buf[V.d_buf+2*Lt]<<8|V.pending_buf[V.d_buf+2*Lt+1],at=V.pending_buf[V.l_buf+Lt],Lt++,Tt===0?Mt(V,at,lt):(Mt(V,(Ut=S[at])+l+1,lt),($t=j[Ut])!==0&&Dt(V,at-=ut[Ut],$t),Mt(V,Ut=it(--Tt),Et),($t=et[Ut])!==0&&Dt(V,Tt-=bt[Ut],$t)),Lt<V.last_lit;);Mt(V,E,lt)}function pe(V,lt){var Et,Tt,at,Ut=lt.dyn_tree,$t=lt.stat_desc.static_tree,Lt=lt.stat_desc.has_stree,ee=lt.stat_desc.elems,L=-1;for(V.heap_len=0,V.heap_max=v,Et=0;Et<ee;Et++)Ut[2*Et]!==0?(V.heap[++V.heap_len]=L=Et,V.depth[Et]=0):Ut[2*Et+1]=0;for(;V.heap_len<2;)Ut[2*(at=V.heap[++V.heap_len]=L<2?++L:0)]=1,V.depth[at]=0,V.opt_len--,Lt&&(V.static_len-=$t[2*at+1]);for(lt.max_code=L,Et=V.heap_len>>1;1<=Et;Et--)ne(V,Ut,Et);for(at=ee;Et=V.heap[1],V.heap[1]=V.heap[V.heap_len--],ne(V,Ut,1),Tt=V.heap[1],V.heap[--V.heap_max]=Et,V.heap[--V.heap_max]=Tt,Ut[2*at]=Ut[2*Et]+Ut[2*Tt],V.depth[at]=(V.depth[Et]>=V.depth[Tt]?V.depth[Et]:V.depth[Tt])+1,Ut[2*Et+1]=Ut[2*Tt+1]=at,V.heap[1]=at++,ne(V,Ut,1),2<=V.heap_len;);V.heap[--V.heap_max]=V.heap[1],function(b,A){var z,nt,I,N,mt,yt,Ct=A.dyn_tree,zt=A.max_code,Vt=A.stat_desc.static_tree,xe=A.stat_desc.has_stree,Be=A.stat_desc.extra_bits,Ne=A.stat_desc.extra_base,ke=A.stat_desc.max_length,Ze=0;for(N=0;N<=_;N++)b.bl_count[N]=0;for(Ct[2*b.heap[b.heap_max]+1]=0,z=b.heap_max+1;z<v;z++)ke<(N=Ct[2*Ct[2*(nt=b.heap[z])+1]+1]+1)&&(N=ke,Ze++),Ct[2*nt+1]=N,zt<nt||(b.bl_count[N]++,mt=0,Ne<=nt&&(mt=Be[nt-Ne]),yt=Ct[2*nt],b.opt_len+=yt*(N+mt),xe&&(b.static_len+=yt*(Vt[2*nt+1]+mt)));if(Ze!==0){do{for(N=ke-1;b.bl_count[N]===0;)N--;b.bl_count[N]--,b.bl_count[N+1]+=2,b.bl_count[ke]--,Ze-=2}while(0<Ze);for(N=ke;N!==0;N--)for(nt=b.bl_count[N];nt!==0;)zt<(I=b.heap[--z])||(Ct[2*I+1]!==N&&(b.opt_len+=(N-Ct[2*I+1])*Ct[2*I],Ct[2*I+1]=N),nt--)}}(V,lt),re(Ut,L,V.bl_count)}function C(V,lt,Et){var Tt,at,Ut=-1,$t=lt[1],Lt=0,ee=7,L=4;for($t===0&&(ee=138,L=3),lt[2*(Et+1)+1]=65535,Tt=0;Tt<=Et;Tt++)at=$t,$t=lt[2*(Tt+1)+1],++Lt<ee&&at===$t||(Lt<L?V.bl_tree[2*at]+=Lt:at!==0?(at!==Ut&&V.bl_tree[2*at]++,V.bl_tree[2*R]++):Lt<=10?V.bl_tree[2*H]++:V.bl_tree[2*Y]++,Ut=at,L=(Lt=0)===$t?(ee=138,3):at===$t?(ee=6,3):(ee=7,4))}function At(V,lt,Et){var Tt,at,Ut=-1,$t=lt[1],Lt=0,ee=7,L=4;for($t===0&&(ee=138,L=3),Tt=0;Tt<=Et;Tt++)if(at=$t,$t=lt[2*(Tt+1)+1],!(++Lt<ee&&at===$t)){if(Lt<L)for(;Mt(V,at,V.bl_tree),--Lt!=0;);else at!==0?(at!==Ut&&(Mt(V,at,V.bl_tree),Lt--),Mt(V,R,V.bl_tree),Dt(V,Lt-3,2)):Lt<=10?(Mt(V,H,V.bl_tree),Dt(V,Lt-3,3)):(Mt(V,Y,V.bl_tree),Dt(V,Lt-11,7));Ut=at,L=(Lt=0)===$t?(ee=138,3):at===$t?(ee=6,3):(ee=7,4)}}u(bt);var vt=!1;function K(V,lt,Et,Tt){Dt(V,(d<<1)+(Tt?1:0),3),function(at,Ut,$t,Lt){qt(at),Lt&&(Gt(at,$t),Gt(at,~$t)),s.arraySet(at.pending_buf,at.window,Ut,$t,at.pending),at.pending+=$t}(V,lt,Et,!0)}n._tr_init=function(V){vt||(function(){var lt,Et,Tt,at,Ut,$t=new Array(_+1);for(at=Tt=0;at<m-1;at++)for(ut[at]=Tt,lt=0;lt<1<<j[at];lt++)S[Tt++]=at;for(S[Tt-1]=at,at=Ut=0;at<16;at++)for(bt[at]=Ut,lt=0;lt<1<<et[at];lt++)Q[Ut++]=at;for(Ut>>=7;at<p;at++)for(bt[at]=Ut<<7,lt=0;lt<1<<et[at]-7;lt++)Q[256+Ut++]=at;for(Et=0;Et<=_;Et++)$t[Et]=0;for(lt=0;lt<=143;)gt[2*lt+1]=8,lt++,$t[8]++;for(;lt<=255;)gt[2*lt+1]=9,lt++,$t[9]++;for(;lt<=279;)gt[2*lt+1]=7,lt++,$t[7]++;for(;lt<=287;)gt[2*lt+1]=8,lt++,$t[8]++;for(re(gt,f+1,$t),lt=0;lt<p;lt++)X[2*lt+1]=5,X[2*lt]=te(lt,5);Pt=new xt(gt,j,l+1,f,_),pt=new xt(X,et,0,p,_),Wt=new xt(new Array(0),J,0,y,T)}(),vt=!0),V.l_desc=new tt(V.dyn_ltree,Pt),V.d_desc=new tt(V.dyn_dtree,pt),V.bl_desc=new tt(V.bl_tree,Wt),V.bi_buf=0,V.bi_valid=0,jt(V)},n._tr_stored_block=K,n._tr_flush_block=function(V,lt,Et,Tt){var at,Ut,$t=0;0<V.level?(V.strm.data_type===2&&(V.strm.data_type=function(Lt){var ee,L=4093624447;for(ee=0;ee<=31;ee++,L>>>=1)if(1&L&&Lt.dyn_ltree[2*ee]!==0)return a;if(Lt.dyn_ltree[18]!==0||Lt.dyn_ltree[20]!==0||Lt.dyn_ltree[26]!==0)return o;for(ee=32;ee<l;ee++)if(Lt.dyn_ltree[2*ee]!==0)return o;return a}(V)),pe(V,V.l_desc),pe(V,V.d_desc),$t=function(Lt){var ee;for(C(Lt,Lt.dyn_ltree,Lt.l_desc.max_code),C(Lt,Lt.dyn_dtree,Lt.d_desc.max_code),pe(Lt,Lt.bl_desc),ee=y-1;3<=ee&&Lt.bl_tree[2*rt[ee]+1]===0;ee--);return Lt.opt_len+=3*(ee+1)+5+5+4,ee}(V),at=V.opt_len+3+7>>>3,(Ut=V.static_len+3+7>>>3)<=at&&(at=Ut)):at=Ut=Et+5,Et+4<=at&&lt!==-1?K(V,lt,Et,Tt):V.strategy===4||Ut===at?(Dt(V,2+(Tt?1:0),3),_e(V,gt,X)):(Dt(V,4+(Tt?1:0),3),function(Lt,ee,L,b){var A;for(Dt(Lt,ee-257,5),Dt(Lt,L-1,5),Dt(Lt,b-4,4),A=0;A<b;A++)Dt(Lt,Lt.bl_tree[2*rt[A]+1],3);At(Lt,Lt.dyn_ltree,ee-1),At(Lt,Lt.dyn_dtree,L-1)}(V,V.l_desc.max_code+1,V.d_desc.max_code+1,$t+1),_e(V,V.dyn_ltree,V.dyn_dtree)),jt(V),Tt&&qt(V)},n._tr_tally=function(V,lt,Et){return V.pending_buf[V.d_buf+2*V.last_lit]=lt>>>8&255,V.pending_buf[V.d_buf+2*V.last_lit+1]=255&lt,V.pending_buf[V.l_buf+V.last_lit]=255&Et,V.last_lit++,lt===0?V.dyn_ltree[2*Et]++:(V.matches++,lt--,V.dyn_ltree[2*(S[Et]+l+1)]++,V.dyn_dtree[2*it(lt)]++),V.last_lit===V.lit_bufsize-1},n._tr_align=function(V){Dt(V,2,3),Mt(V,E,gt),function(lt){lt.bi_valid===16?(Gt(lt,lt.bi_buf),lt.bi_buf=0,lt.bi_valid=0):8<=lt.bi_valid&&(lt.pending_buf[lt.pending++]=255&lt.bi_buf,lt.bi_buf>>=8,lt.bi_valid-=8)}(V)}},{"../utils/common":41}],53:[function(e,r,n){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,r,n){(function(s){(function(a,o){if(!a.setImmediate){var u,d,m,l,f=1,p={},y=!1,v=a.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(a);_=_&&_.setTimeout?_:a,u={}.toString.call(a.process)==="[object process]"?function(R){process.nextTick(function(){T(R)})}:function(){if(a.postMessage&&!a.importScripts){var R=!0,H=a.onmessage;return a.onmessage=function(){R=!1},a.postMessage("","*"),a.onmessage=H,R}}()?(l="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",E,!1):a.attachEvent("onmessage",E),function(R){a.postMessage(l+R,"*")}):a.MessageChannel?((m=new MessageChannel).port1.onmessage=function(R){T(R.data)},function(R){m.port2.postMessage(R)}):v&&"onreadystatechange"in v.createElement("script")?(d=v.documentElement,function(R){var H=v.createElement("script");H.onreadystatechange=function(){T(R),H.onreadystatechange=null,d.removeChild(H),H=null},d.appendChild(H)}):function(R){setTimeout(T,0,R)},_.setImmediate=function(R){typeof R!="function"&&(R=new Function(""+R));for(var H=new Array(arguments.length-1),Y=0;Y<H.length;Y++)H[Y]=arguments[Y+1];var j={callback:R,args:H};return p[f]=j,u(f),f++},_.clearImmediate=w}function w(R){delete p[R]}function T(R){if(y)setTimeout(T,0,R);else{var H=p[R];if(H){y=!0;try{(function(Y){var j=Y.callback,et=Y.args;switch(et.length){case 0:j();break;case 1:j(et[0]);break;case 2:j(et[0],et[1]);break;case 3:j(et[0],et[1],et[2]);break;default:j.apply(o,et)}})(H)}finally{w(R),y=!1}}}}function E(R){R.source===a&&typeof R.data=="string"&&R.data.indexOf(l)===0&&T(+R.data.slice(l.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof hi<"u"?hi:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(vv);const oR=vv.exports;class uc{static _init(){const t=`
      function resolvePath(path) {
        let pathParts = path.split("/")
        pathParts = pathParts.filter(item => item != "." && item != "")
        while (pathParts.indexOf("..") > -1) {
          const ind = pathParts.indexOf("..")
          if (ind == 0) {
            throw Error("Path" + pathParts.join("/") + "is invalid!")
          }
          pathParts.splice(ind - 1, 2)
        }
        return pathParts.join("/")
      }
      
      async function getFileHandle(path, options) {
        try {
          const pathParts = resolvePath(path).split("/")
          const filename = pathParts.pop()
          const dirHandle = await getDirectoryHandle(
            pathParts.join("/"),
            options
          )
          if (!dirHandle) return undefined
          return await dirHandle.getFileHandle(filename, options)
        } catch (err) {
          console.log(err)
          return undefined
        }
      }
      
      async function getDirectoryHandle(path, options, dir){
        dir ||= await navigator.storage.getDirectory()
        if (path == "" || path == ".") return dir
        try {
          const pathParts = resolvePath(path).split("/")
          const dirname = pathParts.shift()
          const dirHandle = await dir.getDirectoryHandle(dirname, options)
          if (!dirHandle) return undefined
          if (pathParts.length == 0) return dirHandle
          return getDirectoryHandle(pathParts.join("/"), options, dirHandle)
        } catch (err) {
          console.log(err)
          return undefined
        }
      }
      
      async function writeFile(path, arrayBuffer) {
        const handle = await getFileHandle(path)
        const accessHandle = await handle.createSyncAccessHandle();
        const writeSize = accessHandle.write(arrayBuffer, { "at": 0 });
        await accessHandle.flush();
        const fileSize = await accessHandle.getSize();
        // Read file content to a buffer.
        const readBuffer = new ArrayBuffer(fileSize);
        const readSize = accessHandle.read(readBuffer, { "at": 0 });
        console.log(readSize)
        await accessHandle.close();
      }
      
      self.onmessage = function(e){
        writeFile(e.data[1],e.data[2]).then(()=>{
          postMessage(e.data[0])
        })
      }
      `,e=new Blob([t],{type:"application/javascript"});this._worker=new Worker(URL.createObjectURL(e)),this._worker.onmessage=r=>{const n=r.data;console.log("Finished job "+n),this.map.has(n)&&this.map.get(n)()}}static get worker(){return this._worker||this._init(),this._worker}static async writeHandle(t,e){const r=this.workID++;console.log("Starting work write "+t+", id: "+r);const n=new Promise(o=>this.map.set(r,o)),s=new TextEncoder,a=typeof e=="string"?s.encode(e):await e.arrayBuffer();return this.worker.postMessage([r,t,a]),n}}P(uc,"_worker"),P(uc,"workID",0),P(uc,"map",new Map);class ze{static get root(){return this._root||this.init(),this._root}static async init(){window.nw?(this._root=await kd(_a(()=>import("./NodeAdapter.9edc549e.js"),["./NodeAdapter.9edc549e.js","./util.c95f34f1.js"],import.meta.url),"/"),this.persistentFiles=!0):nR.adapter.native&&!lv().includes("Safari")?(this._root=await kd(),this.persistentFiles=!0):this._root=await kd(_a(()=>import("./memory.e35efa41.js"),["./memory.e35efa41.js","./util.c95f34f1.js"],import.meta.url))}static isPersistent(){return this.persistentFiles}static async uploadHandle(t,e){let r;if(typeof e=="string"){const n=await this.getDirectoryHandle(e,{create:!0});if(!n)return;r=n}else r=e??this.root;if(t.kind=="file"){const n=await r.getFileHandle(t.name,{create:!0});await this.writeFile(n,await t.getFile())}else{const n=await r.getDirectoryHandle(t.name,{create:!0}),s=[];for await(const a of t.values())s.push(this.uploadHandle(a,n));await Promise.all(s)}}static async uploadFiles(t,e){let r;if(typeof e=="string"){const n=await this.getDirectoryHandle(e,{create:!0});if(!n)return;r=n}else r=e??this.root;if(t.isFile){const n=t;if(n.name==".DS_Store")return;n.file(async s=>{const a=await r.getFileHandle(s.name,{create:!0});await this.writeHandle(a,s)})}else if(t.isDirectory){const n=t.createReader(),s=await r.getDirectoryHandle(t.name,{create:!0});for await(const a of s.values())await s.removeEntry(a.name,{recursive:!0});n.readEntries(async a=>{const o=[];for(let u=0;u<a.length;u++)o.push(this.uploadFiles(a[u],s));await Promise.all(o)})}}static async handleDropEvent(t,e){t.stopPropagation(),t.preventDefault();const r=t.dataTransfer.items;if(!e){e="";for(let a=0;a<r.length;a++){const o=r[a].webkitGetAsEntry();if(o?.isFile&&(o.name.endsWith(".sm")||o.name.endsWith(".ssc"))){e="New Song";break}}}const n=[];for(let a=0;a<r.length;a++){const o=r[a].webkitGetAsEntry();!o||n.push(this.uploadFiles(o,e))}let s;return r.length==1&&r[0].webkitGetAsEntry().isDirectory&&(s=r[0].webkitGetAsEntry().name),await Promise.all(n),s}static async uploadDir(t,e){let r;if(typeof e=="string"){const s=await this.getDirectoryHandle(e);if(!s)return;r=s}else r=e??this.root;const n=await r.getDirectoryHandle(t.name,{create:!0});for await(const s of t.values())if(s.kind=="file"){const a=await n.getFileHandle(s.name,{create:!0}),o=await s.getFile();await this.writeHandle(a,o)}else await this.uploadDir(s,n)}static async getDirectoryHandle(t,e,r){if(r||(r=this.root),t==""||t==".")return r;try{const n=this.resolvePath(t).split("/"),s=n.shift(),a=await r.getDirectoryHandle(s,e);return a?n.length==0?a:this.getDirectoryHandle(n.join("/"),e,a):void 0}catch(n){console.log(n);return}}static async getFileHandle(t,e){try{const r=this.resolvePath(t).split("/"),n=r.pop(),s=await this.getDirectoryHandle(r.join("/"),e);return s?await s.getFileHandle(n,e):void 0}catch(r){console.log(r);return}}static async getFileHandleRelativeTo(t,e){try{return wn(t)!=""&&(t=Gr(t)),this.getFileHandle(this.resolvePath(t+"/"+e))}catch(r){console.log(r);return}}static async getDirectoryFiles(t){try{let e;if(typeof t=="string"){if(e=await this.getDirectoryHandle(t),!e)return[]}else e=t;const r=[];for await(const n of e.values())n.kind=="file"&&r.push(n);return r}catch(e){return console.log(e),[]}}static async getDirectoryFolders(t){try{let e;if(typeof t=="string"){if(e=await this.getDirectoryHandle(t),!e)return[]}else e=t;const r=[];for await(const n of e.values())n.kind=="directory"&&r.push(n);return r}catch(e){return console.log(e),[]}}static async writeFile(t,e){let r;if(typeof t=="string"){if(r=await this.getFileHandle(t,{create:!0}),!r)return}else r=t;await this.writeHandle(r,e)}static async removeFile(t,e){try{const r=Gr(t),n=await this.getDirectoryHandle(r);if(!n)return;await n.removeEntry(Ss(t),e)}catch(r){console.log(r);return}}static async removeDirectory(t){return this.removeFile(t,{recursive:!0})}static async remove(t){return wn(t)==""?this.removeDirectory(t):this.removeFile(t)}static resolvePath(t){let e=t.split("/");for(e=e.filter(r=>r!="."&&r!="");e.indexOf("..")>-1;){const r=e.indexOf("..");if(r==0)throw Error("Path"+e.join("/")+"is invalid!");e.splice(r-1,2)}return e.join("/")}static async zipDirectory(t,e){const r=e??new oR,n=wn(t)==""?t:Gr(t),s=await this.getDirectoryHandle(n);if(!!s){for(const a of await this.getDirectoryFiles(s))r.file(a.name,await a.getFile());for(const a of await this.getDirectoryFolders(s)){const o=r.folder(a.name);if(!o){console.error("Failed to zip folder "+t+"/"+a.name);continue}this.zipDirectory(t+"/"+a.name,o)}return r}}static async saveDirectory(t){const e=wn(t)==""?t:Gr(t);Fe.create("Exporting "+e+".zip");const r=await iR({_preferPolyfill:!1,suggestedName:`${e}.zip`,types:[{accept:{"application/zip":[".zip"]}}],excludeAcceptAllOption:!1}),n=await this.zipDirectory(t);!n||await n.generateAsync({type:"blob"}).then(async s=>{await this.writeHandle(r,s)})}static async renameFile(t,e){try{const r=await this.getDirectoryHandle(Gr(t)),n=await this.getDirectoryHandle(Gr(e),{create:!0}),s=await this.getFileHandle(t);if(!r||!n||!s)return;await this.copyToHandle(n,s,Ss(e)),await r.removeEntry(Ss(t))}catch(r){console.log(r)}}static async renameDirectory(t,e){if(!e.startsWith(t))try{const r=await this.getDirectoryHandle(Gr(t)),n=await this.getDirectoryHandle(Gr(e),{create:!0}),s=await this.getDirectoryHandle(t);if(!r||!n||!s)return;await this.copyToHandle(n,s,Ss(e)),await r.removeEntry(Ss(t),{recursive:!0})}catch(r){console.log(r)}}static async copyToHandle(t,e,r){try{if(e.kind=="directory"){const n=await t.getDirectoryHandle(r??e.name,{create:!0}),s=[];for await(const a of e.values())s.push(this.copyToHandle(n,a));await Promise.all(s)}else{const n=await e.getFile(),s=await t.getFileHandle(r??e.name,{create:!0});await this.writeHandle(s,n)}}catch(n){console.log(n)}}static getRelativePath(t,e){const r=t.split("/"),n=e.split("/"),s=Math.min(r.length,n.length);let a=s;for(let u=0;u<s;u++)if(r[u]!==n[u]){a=u;break}if(a==0)return e;let o=[];for(let u=a;u<r.length;u++)o.push("..");return o=o.concat(n.slice(a)),o.join("/")}static async writeHandle(t,e){if(t.createWritable){const r=await t.createWritable();await r.write(e),await r.close()}else{const r=await this.root.resolve(t);if(!r)return;await uc.writeHandle(r.join("/"),e)}}}P(ze,"_root"),P(ze,"persistentFiles",!1);ze.root;class ss{constructor(t){P(this,"windowManager");P(this,"options");P(this,"windowElement");P(this,"viewElement");P(this,"block",t=>{!t.target||this.windowElement.contains(t.target)||(t.stopImmediatePropagation(),t.preventDefault())});P(this,"handleDrag",t=>{const e=parseInt(this.windowElement.style.left.slice(0,-2))+t.movementX,r=parseInt(this.windowElement.style.top.slice(0,-2))+t.movementY;this.windowElement.style.left=e+"px",this.windowElement.style.top=r+"px",this.clampPosition()});this.options=t;const e=document.createElement("div"),r=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div");if(e.appendChild(n),e.appendChild(r),e.style.width=t.width+"px",e.style.left=window.innerWidth/2-t.width/2+"px",e.style.top=window.innerHeight/2-t.height/2+"px",e.classList.add("unselectable","window"),r.classList.add("view"),r.style.height=t.height+"px",r.style.width=t.width+"px",n.classList.add("navbar"),n.appendChild(s),!t.disableClose){const a=document.createElement("img"),o=document.createElement("img");a.classList.add("unselectable"),a.draggable=!1,a.src=oi.MINIMIZE_WINDOW,a.onclick=()=>{r.style.height!="0px"?r.style.height="0px":r.style.height=t.height+"px",this.clampPosition()},o.classList.add("unselectable"),o.draggable=!1,o.src=oi.CLOSE_WINDOW,o.onclick=()=>this.closeWindow(),n.appendChild(a),n.appendChild(o)}s.innerText=t.title,s.classList.add("title"),e.addEventListener("mousedown",()=>this.focus()),t.blocking&&(window.addEventListener("mousedown",this.block,!0),document.getElementById("blocker").style.display="block",e.dataset.blocking="block"),s.addEventListener("mousedown",()=>{window.addEventListener("mousemove",this.handleDrag),window.addEventListener("mouseup",()=>window.removeEventListener("mousemove",this.handleDrag))}),this.focus(),e.classList.add("focused"),this.windowElement=e,this.viewElement=r}addToManager(t){this.windowManager=t,t.view.appendChild(this.windowElement),this.focus()}onClose(){}closeWindow(){this.windowManager&&(this.onClose(),this.windowManager.removeWindow(this),this.windowElement.classList.add("exiting"),window.removeEventListener("mousedown",this.block,!0),this.options.blocking&&this.windowManager.windows.filter(t=>t.options.blocking).length==0&&(document.getElementById("blocker").style.display="none"),setTimeout(()=>this.windowManager.view.removeChild(this.windowElement),40))}focus(){if(this.windowManager==null)return;this.windowManager.unfocusAll(),this.windowElement.classList.add("focused");const t=Array.from(this.windowManager.view.children).map(e=>e).filter(e=>e!=this.windowElement);t.sort((e,r)=>parseInt(e.style.zIndex)-parseInt(r.style.zIndex)),t.push(this.windowElement);for(let e=0;e<t.length;e++)t[e].style.zIndex=((t[e].dataset.blocking?10001:0)+e).toString()}unfocus(){this.windowManager!=null&&this.windowElement.classList.remove("focused")}clampPosition(){if(this.windowManager==null)return;const t=parseInt(this.windowElement.style.left.slice(0,-2)),e=parseInt(this.windowElement.style.top.slice(0,-2)),r=this.windowManager.app.view.getBoundingClientRect();this.windowElement.style.left=or(t,r.left,r.width-this.windowElement.clientWidth+r.left)+"px",this.windowElement.style.top=or(e,r.top,r.height-this.windowElement.clientHeight+r.top)+"px"}}class Oh extends ss{constructor(e,r,n){super({title:r.title,width:500,height:400,disableClose:r.disableClose,win_id:"file_selector"+Math.random(),blocking:!0});P(this,"app");P(this,"dirOptions");P(this,"fileDropPath","");P(this,"draggedElement");P(this,"draggedCopy");P(this,"keyHandler");P(this,"dropHandler");P(this,"mouseHandler");P(this,"dragHandler");this.app=e,this.dirOptions=r,r.accepted_file_types||(r.accepted_file_types=[]),this.keyHandler=this.handleKeyEvent.bind(this),this.dropHandler=this.handleDropEvent.bind(this),this.mouseHandler=this.handleMouseEvent.bind(this),this.dragHandler=this.handleDragEvent.bind(this),this.initView().then(()=>{n&&this.selectPath(n),r.onload?.()})}async initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const r=document.createElement("div");r.classList.add("menu-options");const n=document.createElement("div");n.classList.add("menu-left");const s=document.createElement("div");s.classList.add("menu-right"),r.appendChild(n),r.appendChild(s);const a=document.createElement("button");a.innerText="Cancel",a.onclick=()=>{window.removeEventListener("keydown",this.keyHandler,!0),window.removeEventListener("drop",this.dropHandler,!0),this.closeWindow()};const o=document.createElement("button");o.innerText="Select",o.classList.add("confirm"),o.onclick=()=>this.confirmFile(),o.disabled=!0,n.appendChild(a),s.appendChild(o);const u=document.createElement("div");u.classList.add("dir-selector"),u.onclick=T=>{T.target==u&&this.selectElement(void 0)};const d=document.createElement("div");d.classList.add("file-options");const m=document.createElement("button"),l=document.createElement("img");l.src=oi.ADD_FILE,l.classList.add("icon"),m.appendChild(l),m.appendChild(document.createTextNode("Upload files")),d.appendChild(m),m.onclick=async()=>{const T=this.fileDropPath,E=await eR({_preferPolyfill:!1,excludeAcceptAllOption:!1,multiple:!0}),H=this.viewElement.querySelector(".info.selected")?.dataset.path??"",Y=[];for(const j of E)Y.push(ze.uploadHandle(j,H));await Promise.all(Y),await this.refreshDirectory(T),this.getAcceptableFile(T).then(j=>this.selectPath(j))};const f=document.createElement("button"),p=document.createElement("img");p.src=oi.ADD_FOLDER,p.classList.add("icon"),f.appendChild(p),f.appendChild(document.createTextNode("Upload folder")),d.appendChild(f),f.onclick=async()=>{const T=this.fileDropPath,E=await tR({_preferPolyfill:!1}),H=this.viewElement.querySelector(".info.selected")?.dataset.path??"";await ze.uploadHandle(E,H),await this.refreshDirectory(T),this.getAcceptableFile(T==""?E.name:T+"/"+E.name).then(Y=>this.selectPath(Y))};const y=document.createElement("button");y.classList.add("rename");const v=document.createElement("img");v.src=oi.EDIT,v.classList.add("icon"),y.appendChild(v),y.appendChild(document.createTextNode("Rename")),y.disabled=!0,y.onclick=()=>{const T=this.viewElement.querySelector(".info.selected");!T?.dataset.path||this.startEditing(T.querySelector("textarea"))},d.appendChild(y);const _=document.createElement("button");_.classList.add("delete");const w=document.createElement("img");w.src=oi.TRASH,w.classList.add("icon"),_.appendChild(w),_.appendChild(document.createTextNode("Delete")),_.disabled=!0,_.onclick=()=>{const T=this.viewElement.querySelector(".info.selected"),E=T?.dataset.path;if(!E)return;const R=T.parentElement.classList.contains("folder");ze[R?"removeDirectory":"removeFile"](E).then(()=>{const H=this.getElement(E);!H||(H.parentElement?.remove(),_.disabled=!0,y.disabled=!0)})},d.appendChild(_),e.appendChild(u),e.appendChild(d),e.appendChild(r),this.viewElement.appendChild(e),window.addEventListener("keydown",this.keyHandler,!0),window.addEventListener("drop",this.dropHandler,!0),window.addEventListener("mousemove",this.dragHandler,!0),this.viewElement.addEventListener("dragover",this.mouseHandler),await this.createDiv("").then(T=>u.replaceChildren(...T))}async expand(e){if(!e.parentElement.classList.contains("folder"))return;e.parentElement.classList.remove("collapsed");const r=e.nextSibling;await this.createDiv(e.dataset.path).then(n=>{r.replaceChildren(...n)})}collapse(e){if(!e.parentElement.classList.contains("folder"))return;e.parentElement.classList.add("collapsed"),e.nextSibling.replaceChildren()}selectElement(e){if(this.viewElement.querySelector(".info.selected")?.classList.remove("selected"),!e){this.viewElement.querySelector(".delete").disabled=!0,this.viewElement.querySelector(".rename").disabled=!0;return}e.classList.add("selected"),Ld(e,{scrollMode:"if-needed",block:"nearest",inline:"nearest"});const r=this.viewElement.querySelector("button.confirm"),n=e.dataset.path;r.disabled=!0,n&&(r.disabled=!this.acceptableFileType(n),this.viewElement.querySelector(".delete").disabled=!1,this.viewElement.querySelector(".rename").disabled=!1)}async createDiv(e){const r=await ze.getDirectoryFolders(e);let n=await ze.getDirectoryFiles(e);return r.sort((s,a)=>s.name.toLowerCase().localeCompare(a.name.toLowerCase())),n.sort((s,a)=>s.name.toLowerCase().localeCompare(a.name.toLowerCase())),n=n.filter(s=>wn(s.name)!=".crswap"),r.map(s=>this.createBaseElement(e,s)).concat(n.map(s=>this.createBaseElement(e,s)))}createBaseElement(e,r){e!=""&&(e+="/");const n=document.createElement("div");n.classList.add("item");const s=document.createElement("div");if(s.classList.add("info"),n.appendChild(s),r.kind=="directory"){const o=document.createElement("img");o.classList.add("icon"),o.classList.add("folder-icon"),o.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAbklEQVRIie2PMQqAMAxFXwfP6qJVPIjYzcOKdUkhQ0BaCoLkLS3k818CjuN8ztApYzIDl7xvmalFsAIZuIFozKPMMrC0CAJwKIkuGVX5KdkmLEm3ci1JSlLKU49yLSmXVG1es0EANvnvInKcP/AA784fpjlWwNQAAAAASUVORK5CYII=",s.appendChild(o);const u=document.createElement("div");u.classList.add("children"),n.appendChild(u),n.classList.add("folder"),n.classList.add("collapsed"),s.addEventListener("click",d=>{const m=d.target;m?.classList.contains("options-icon")||m.tagName=="TEXTAREA"&&!m.disabled||(n.classList.contains("collapsed")?this.expand(s):this.collapse(s))})}else{this.acceptableFileType(r.name)||s.classList.add("disabled");const o=document.createElement("img");o.src=this.getIcon(r.name),o.classList.add("icon"),s.appendChild(o)}s.dataset.path=e+r.name;const a=document.createElement("textarea");return a.rows=1,a.disabled=!0,a.autocomplete="off",a.autocapitalize="off",a.spellcheck=!1,a.innerText=r.name,a.style.pointerEvents="none",a.classList.add("title"),s.appendChild(a),s.addEventListener("click",()=>this.selectElement(s)),s.addEventListener("mousedown",()=>this.startDragging(s)),s.ondblclick=()=>this.confirmFile(),n}confirmFile(){const r=this.viewElement.querySelector(".info.selected")?.dataset.path;!r||this.acceptableFileType(r)&&(this.dirOptions.callback?.(r),window.removeEventListener("keydown",this.keyHandler,!0),window.removeEventListener("drop",this.dropHandler,!0),window.removeEventListener("mousemove",this.dragHandler,!0),this.closeWindow())}acceptableFileType(e){return this.dirOptions.accepted_file_types.length==0||this.dirOptions.accepted_file_types.includes(wn(e))}getIcon(e){const r=wn(e);return r==""&&!e.startsWith(".")?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAY0lEQVRIiWNgGAWDCXgwMDA8ZmBg+I8DN1BqwSM8hlPFEpgh2EA4AwPDbyIc8B/qUA9SLSDHEpItIBagmMNEBQPxglELRi0YtQDVgsdQmpiiAB9GNgsFeDAQV6KSXdiNgoEBAG+iU6T/ixEpAAAAAElFTkSuQmCC":Hy.includes(r)?oi.IMAGE_FILE:Uc.includes(r)?oi.AUDIO_FILE:[".sm",".ssc"].includes(r)?oi.SM_FILE:oi.UNKNOWN_FILE}startEditing(e){const r=e.value,n=!!e.parentElement?.parentElement?.classList.contains("folder"),s=e.parentElement?.dataset.path??"",a=Gr(s);e.value=s.split("/").at(-1)??"",window.removeEventListener("keydown",this.keyHandler,!0),e.disabled=!1,e.style.pointerEvents="",e.focus(),e.addEventListener("keypress",o=>{o.code=="Enter"&&(o.preventDefault(),o.stopImmediatePropagation(),e.blur())},!0),e.addEventListener("blur",async()=>{if(window.addEventListener("keydown",this.keyHandler,!0),e.disabled=!0,e.style.pointerEvents="none",e.value.startsWith(".")){e.value=r;return}e.value=e.value.replaceAll("/","");const o=a==""?e.value:a+"/"+e.value;o!=s&&(e.parentElement.dataset.path=o,await ze[n?"renameDirectory":"renameFile"](s,o),this.refreshDirectory(a),e.value.length>32&&(e.value=e.value.slice(0,32)+"..."))})}async refreshDirectory(e){const r=this.viewElement.querySelector(".dir-selector");if(!r)return;let n=r.querySelector("div[data-path='"+this.escapeSelector(e)+"']")?.nextSibling;if(e==""&&(n=r),!n)return;const s=Array.from(n.parentElement.querySelectorAll(".folder:not(.collapsed)")).map(a=>a.children[0].dataset.path);await this.createDiv(e).then(a=>n.replaceChildren(...a)),await Promise.all(s.map(a=>this.expand(r.querySelector("div[data-path='"+this.escapeSelector(a)+"']"))))}getElement(e){const r=this.viewElement.querySelector(".dir-selector");return r?r.querySelector("div[data-path='"+this.escapeSelector(e)+"']"):null}async getAcceptableFile(e){const r=await ze.getDirectoryHandle(e);if(!r)return;const n=[{path:e,handle:r}];for(;n.length>0;){const s=n.shift(),a=s.handle;for await(const o of a.values()){const u=s.path==""?"":s.path+"/";if(o.kind=="directory")n.push({path:u+o.name,handle:o});else if(this.acceptableFileType(o.name))return u+o.name}}}async selectPath(e){if(!e)return;const r=this.viewElement.querySelector(".dir-selector");if(!r)return;const n=e.split("/");n.pop();const s=[];for(;n.length>0;){s.push(n.shift());const o=r.querySelector("div[data-path='"+this.escapeSelector(s.join("/"))+"']");if(!o)return;await this.expand(o)}const a=r.querySelector("div[data-path='"+this.escapeSelector(e)+"']");!a||this.selectElement(a)}handleKeyEvent(e){if(!this.windowElement.classList.contains("focused"))return;const r=this.viewElement.querySelector(".info.selected");if(r==null){if(e.code.startsWith("Arrow")){const n=this.viewElement.querySelector(".info");n&&this.selectElement(n)}return}if(e.code=="ArrowUp"){e.preventDefault(),e.stopImmediatePropagation();const n=r.parentElement;let s=n.previousSibling?.querySelector(".info");s&&!s.parentElement.classList.contains("collapsed")&&s.parentElement.classList.contains("folder")&&(s=s.parentElement.querySelector(".children").lastChild.querySelector(".info")),!s&&n.parentElement.classList.contains("children")&&(s=n.parentElement.parentElement.querySelector(".info")),s&&(this.selectElement(s),Ld(s,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}if(e.code=="ArrowDown"){e.preventDefault(),e.stopImmediatePropagation();const n=r.parentElement;let s;n.classList.contains("folder")&&!n.classList.contains("collapsed")&&(s=n.querySelector(".children").children[0].querySelector(".info")),s||(s=r.parentElement.nextSibling?.querySelector(".info")),!s&&n.parentElement.classList.contains("children")&&(s=n.parentElement.parentElement.nextSibling.querySelector(".info")),s&&(this.selectElement(s),Ld(s,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}if(e.code=="ArrowLeft"&&(e.preventDefault(),e.stopImmediatePropagation(),this.collapse(r)),e.code=="ArrowRight"&&(e.preventDefault(),e.stopImmediatePropagation(),this.expand(r)),e.code=="Enter"&&(e.preventDefault(),e.stopImmediatePropagation(),r.parentElement?.querySelector(".title")&&this.startEditing(r.parentElement?.querySelector(".title"))),e.code=="Delete"||e.code=="Backspace"){const n=this.viewElement.querySelector(".info.selected"),s=n?.dataset.path;if(!s)return;const a=n.parentElement.classList.contains("folder");ze[a?"removeDirectory":"removeFile"](s).then(()=>{const o=this.getElement(s);!o||(o.parentElement?.remove(),this.viewElement.querySelector(".delete").disabled=!0,this.viewElement.querySelector(".rename").disabled=!0)})}}startDragging(e){const r=e;r.totalMovementX=0,r.totalMovementY=0,this.draggedElement=r;const n=()=>{this.stopDragging(),window.removeEventListener("mouseup",n)};window.addEventListener("mouseup",n)}handleDragEvent(e){if(!!this.draggedElement){if(this.draggedElement.totalMovementX+=e.movementX,this.draggedElement.totalMovementY+=e.movementY,!this.draggedCopy)if(Math.abs(this.draggedElement.totalMovementX)+Math.abs(this.draggedElement.totalMovementY)>8){this.viewElement.addEventListener("mousemove",this.mouseHandler),this.draggedCopy=this.draggedElement.parentElement.cloneNode(!0),this.draggedCopy.style.position="fixed";const r=this.draggedElement.getBoundingClientRect();this.draggedCopy.style.top=r.top+this.draggedElement.totalMovementY+"px",this.draggedCopy.style.left=r.left+this.draggedElement.totalMovementX+"px",this.draggedCopy.style.width=r.width+"px",this.draggedCopy.style.boxShadow="3px 3px 3px #222",this.draggedCopy.querySelector(".children")&&this.draggedCopy.removeChild(this.draggedCopy.querySelector(".children")),this.viewElement.appendChild(this.draggedCopy)}else return;this.draggedCopy.style.top=parseFloat(this.draggedCopy.style.top.slice(0,-2))+e.movementY+"px",this.draggedCopy.style.left=parseFloat(this.draggedCopy.style.left.slice(0,-2))+e.movementX+"px"}}async stopDragging(){if(this.draggedCopy){this.draggedCopy.remove(),this.viewElement.removeEventListener("mousemove",this.mouseHandler);const e=this.draggedCopy.classList.contains("folder"),r=this.draggedElement.dataset.path,n=this.fileDropPath==""?Ss(this.draggedElement.dataset.path):this.fileDropPath+"/"+Ss(this.draggedElement.dataset.path);await ze[e?"renameDirectory":"renameFile"](r,n),await this.refreshDirectory(Gr(r)),await this.refreshDirectory(Gr(n)),this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),this.fileDropPath=""}this.draggedCopy=void 0,this.draggedElement=void 0}handleDropEvent(e){e.preventDefault(),e.stopImmediatePropagation(),this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),e.target.closest(".dir-selector")&&ze.handleDropEvent(e,this.fileDropPath).then(async r=>{await this.refreshDirectory(this.fileDropPath),this.getAcceptableFile(r??this.fileDropPath).then(n=>this.selectPath(n)),this.fileDropPath=""})}handleMouseEvent(e){const r=this.viewElement.querySelector(".dir-selector");let n=Array.from(r.querySelectorAll("div.item.folder"));const s=this.viewElement.querySelector(".outlined");n=n.filter(a=>!a.parentElement.closest(".collapsed")),n.reverse(),n.push(r);for(const a of n){const o=a.getBoundingClientRect();if(e.clientX>=o.x&&e.clientX<=o.x+o.width&&e.clientY>=o.y&&e.clientY<=o.y+o.height){s!=a&&s?.classList.remove("outlined");const u=a.querySelector(".info");this.fileDropPath=u?.dataset.path??"",a.classList.contains("dir-selector")&&(this.fileDropPath=""),a.classList.add("outlined");return}}this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),this.fileDropPath=""}escapeSelector(e){return e.replaceAll(/'/g,"\\'")}}function _v(){const i=document.createElement("div");return i.spellcheck=!1,i.contentEditable="true",i.classList.add("inlineEdit"),i.onkeydown=t=>{t.key=="Enter"&&i.blur()},i}function tc(i,t){return{title:i,element:e=>{const r=_v();return r.onblur=()=>{const n=e[t];tr.instance.run({action:()=>{e[t]=r.innerText},undo:()=>{e[t]=n}}),r.scrollLeft=0},r.innerText=e[t],r}}}const hR={name:tc("Name","chartName"),credit:tc("Artist","credit"),style:tc("Style","chartStyle"),description:tc("Description","description"),music:{title:"Music File",element:(i,t)=>{const e=document.createElement("div");e.classList.add("flex-row","flex-column-gap","flex-static","hide-buttons");const r=()=>{if(n.innerText==(i.music??t.chartManager.loadedSM.properties.MUSIC??""))return;const d=t.chartManager.chartAudio.isPlaying();if(n.innerText==""||n.innerText==t.chartManager.loadedSM.properties.MUSIC){i.music=void 0,n.innerText=t.chartManager.loadedSM.properties.MUSIC+"",t.chartManager.loadAudio(),d&&t.chartManager.chartAudio.play();return}const m=i.music;tr.instance.run({action:()=>i.music=n.innerText==t.chartManager.loadedSM.properties.MUSIC?void 0:n.innerText,undo:()=>i.music=m}),t.chartManager.loadAudio(),d&&t.chartManager.chartAudio.play()},n=_v();n.style.flex="1",n.onblur=r,n.innerText=i.music??t.chartManager.loadedSM.properties.MUSIC??"";const s=document.createElement("button");s.onclick=()=>{const d=t.chartManager.smPath.split("/").slice(0,-1).join("/");if(window.nw){const m=document.createElement("input");m.type="file",m.accept="audio/*",m.onchange=()=>{n.innerText=ze.getRelativePath(d,m.value),r()},m.click()}else t.windowManager.openWindow(new Oh(t,{title:"Select an audio file...",accepted_file_types:Uc,disableClose:!0,callback:m=>{n.innerText=ze.getRelativePath(d,m),r()}},d+"/"+(i.music??t.chartManager.loadedSM.properties.MUSIC??"")))};const a=document.createElement("img");a.classList.add("icon"),a.style.height="12px",a.src=oi.SELECT_FILE,s.appendChild(a);const o=document.createElement("button");o.onclick=()=>{n.innerText!=(t.chartManager.loadedSM.properties.MUSIC??"")&&(n.innerText=t.chartManager.loadedSM.properties.MUSIC??"",r())};const u=document.createElement("img");return u.classList.add("icon"),u.style.height="12px",u.src=oi.REVERT,o.appendChild(u),e.appendChild(n),e.appendChild(s),e.appendChild(o),e}}};class is{constructor(t,e,r){P(this,"view");P(this,"items",[]);P(this,"selectedItem");P(this,"onChangeHandlers",[]);this.view=t,t.classList.add("dropdown"),this.items=e??[],this.selectedItem=r??this.items[0];const n=document.createElement("div");n.classList.add("dropdown-selected");const s=document.createElement("div");s.classList.add("dropdown-items"),s.style.height="",n.onclick=()=>{if(!n.classList.contains("disabled")){if(this.items.length==0){s.style.height="";return}this.createDropdown(),s.style.height==""?(s.style.width=Math.max(s.scrollWidth,n.clientWidth)+"px",s.style.height=s.scrollHeight+"px",Array.from(s.children).forEach((a,o)=>{a.style.animationDelay=o*.02+"s"})):s.style.height=""}},window.addEventListener("click",a=>{const o=a.target;(!o.closest(".dropdown")||o.closest(".dropdown")!=t)&&(s.style.height="")}),this.view.appendChild(n),this.view.appendChild(s),this.setSelected()}static create(t,e){return new is(document.createElement("div"),t,e)}onChange(t){this.onChangeHandlers.push(t)}removeHandler(t){!this.onChangeHandlers.includes(t)||this.onChangeHandlers.splice(this.onChangeHandlers.indexOf(t),1)}setItems(t){this.items=t,t.includes(this.selectedItem)||(this.selectedItem=this.items[0],this.setSelected())}setSelected(t){this.selectedItem=t??this.selectedItem;const e=this.view.querySelector(".dropdown-selected");e.innerText=this.selectedItem?this.selectedItem+"":""}closeDropdown(){const t=this.view.querySelector(".dropdown-items");!t||(t.style.height="")}get value(){return this.selectedItem}get disabled(){return this.view.querySelector(".dropdown-selected").classList.contains("disabled")}set disabled(t){t?this.view.querySelector(".dropdown-selected").classList.add("disabled"):this.view.querySelector(".dropdown-selected").classList.remove("disabled")}createDropdown(){const t=this.view.querySelector(".dropdown-items"),e=this.items.map(r=>{const n=document.createElement("div");return n.classList.add("dropdown-item"),n.innerText=r+"",n.onclick=()=>{t.style.height="",this.selectedItem!=r&&(this.setSelected(r),this.onChangeHandlers.forEach(s=>s(r)))},n});t.replaceChildren(...e)}}class wv extends ss{constructor(e,r,n,s){super({title:r,width:300,height:100,disableClose:!0,win_id:"confirm",blocking:!0});P(this,"app");P(this,"buttonOptions");P(this,"message");P(this,"resolve");P(this,"resolved",new Promise(e=>this.resolve=e));this.app=e,this.message=n,this.buttonOptions=s,this.initView()}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("confirmation");const e=document.createElement("div");e.classList.add("padding");const r=document.createElement("div");r.classList.add("label"),r.innerText=this.message,e.appendChild(r);const n=document.createElement("div");n.classList.add("menu-options"),this.buttonOptions.forEach(s=>{const a=document.createElement("button");a.innerText=s.label,a.onclick=()=>{s.callback?.(),this.resolve?.(s.label),this.closeWindow()},s.type!="default"&&a.classList.add(s.type),n.append(a)}),e.appendChild(n),this.viewElement.appendChild(e)}}class bv extends ss{constructor(e,r){super({title:"Chart List",width:500,height:400,win_id:"chart_list"});P(this,"app");P(this,"gameType");P(this,"chartList");P(this,"chartInfo");P(this,"gameTypeDropdown");P(this,"smLoadHandler",()=>{this.gameTypeDropdown.setItems(Si.getPriority().map(e=>{const r=this.app.chartManager.loadedSM?.charts[e.id]??[];return e.id+" ("+r.length+")"})),this.gameTypeDropdown.setSelected(this.gameType.id+" ("+(this.app.chartManager.loadedSM?.charts[this.gameType.id]??[]).length+") "),this.gameType=this.app.chartManager.loadedChart?.gameType??this.gameType,this.loadCharts()});this.app=e,this.gameType=r??e.chartManager.loadedChart?.gameType??Si.getPriority()[0],this.initView(),ve.on("smLoadedAfter",this.smLoadHandler)}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const r=document.createElement("div");r.classList.add("chart-view-type-wrapper");const n=document.createElement("div");n.classList.add("chart-view-type-label"),n.innerText="Game Type:",this.gameTypeDropdown=is.create(Si.getPriority().map(a=>{const o=this.app.chartManager.loadedSM?.charts[a.id]??[];return a.id+" ("+o.length+")"}),this.gameType.id+" ("+(this.app.chartManager.loadedSM?.charts[this.gameType.id]??[]).length+") "),this.gameTypeDropdown.onChange(a=>{this.gameType=Si.getGameType(a.split(" ")[0])??this.gameType,this.loadCharts()}),r.appendChild(n),r.appendChild(this.gameTypeDropdown.view);const s=document.createElement("div");s.classList.add("chart-view-scroller"),e.appendChild(r),e.appendChild(s),this.chartList=document.createElement("div"),this.chartList.classList.add("chart-list"),this.chartInfo=document.createElement("div"),this.chartInfo.classList.add("chart-info"),s.appendChild(this.chartList),s.appendChild(this.chartInfo),this.viewElement.appendChild(e),this.loadCharts()}onClose(){ve.off("smLoadedAfter",this.smLoadHandler)}loadCharts(){const e=this.app.chartManager.loadedSM?.charts[this.gameType.id]??[],r=[];this.gameTypeDropdown.setItems(Si.getPriority().map(o=>{const u=this.app.chartManager.loadedSM?.charts[o.id]??[];return o.id+" ("+u.length+")"})),this.gameTypeDropdown.setSelected(this.gameType.id+" ("+(this.app.chartManager.loadedSM?.charts[this.gameType.id]??[]).length+") "),e.forEach(o=>{const u=document.createElement("div");u.classList.add("chart-list-item"),u.chart=o,this.app.chartManager.loadedChart==o&&u.classList.add("selected"),u.onclick=()=>{u.chart!=this.app.chartManager.loadedChart&&(this.app.chartManager.loadChart(u.chart),this.chartList.querySelectorAll(".selected").forEach(p=>p.classList.remove("selected")),u.classList.add("selected"))},u.onmouseenter=()=>{this.loadChartDetails(u.chart)},u.onmouseleave=()=>{this.loadChartDetails()};const d=document.createElement("div");d.innerText=o.meter+"",d.classList.add("title",o.difficulty);const m=document.createElement("div");m.classList.add("chart-list-info");const l=document.createElement("div");l.innerText=o.credit,l.classList.add("title","chart-credit");const f=document.createElement("div");f.innerText=o.getNotedata().length+"",f.classList.add("title","chart-step-count"),m.appendChild(l),m.appendChild(f),u.appendChild(d),u.appendChild(m),r.push(u)});const n=document.createElement("div");n.classList.add("chart-list-item");const s=document.createElement("div");s.innerText="+",s.classList.add("title");const a=document.createElement("div");a.classList.add("chart-list-info"),a.innerText="New Blank Chart",n.appendChild(s),n.appendChild(a),n.onclick=()=>{const o=new yv(this.app.chartManager.loadedSM);o.gameType=this.gameType,this.app.chartManager.loadedSM.addChart(o),this.app.chartManager.loadChart(o),this.loadCharts()},this.chartList.replaceChildren(...r,n),this.loadChartDetails()}loadChartDetails(e){if(e=e??this.app.chartManager.loadedChart,e?.gameType.id!=this.gameType.id){this.chartInfo.replaceChildren();return}if(!e)return;const r=()=>this.app.chartManager.loadedSM.charts[e.gameType.id].sort((_,w)=>tn.indexOf(_.difficulty)==tn.indexOf(w.difficulty)?_.meter-w.meter:tn.indexOf(_.difficulty)-tn.indexOf(w.difficulty)),n=document.createElement("div");n.classList.add("chart-info-main");const s=is.create(tn,e.difficulty);s.view.classList.add("no-border","white"),s.onChange(_=>{const w=e.difficulty;tr.instance.run({action:()=>{e.difficulty=_,r(),this.loadCharts()},undo:()=>{e.difficulty=w,r(),this.loadCharts()}})});const a=document.createElement("div");a.spellcheck=!1,a.contentEditable="true",a.classList.add("inlineEdit","chart-meter"),a.onkeydown=_=>{uo(_)||_.preventDefault(),_.key=="Enter"&&a.blur()},a.onblur=()=>{let _=Math.round(Tc(a.innerText));_=or(1,_,2**31-1);const w=e.meter;tr.instance.run({action:()=>{e.meter=_,r(),this.loadCharts()},undo:()=>{e.meter=w,r(),this.loadCharts()}}),a.scrollLeft=0},a.innerText=e.meter+"";const o=document.createElement("div");o.classList.add("chart-properties"),n.appendChild(s.view),n.appendChild(a),Object.values(hR).forEach(_=>{const w=document.createElement("div");w.classList.add("label"),w.innerText=_.title;const T=_.element(e,this.app);_.title=="Artist"&&T.addEventListener("blur",()=>this.loadCharts()),o.appendChild(w),o.appendChild(T)});const u=e.getNotedataStats(),d=document.createElement("div");d.classList.add("chart-info-grid-item");const m=document.createElement("div");m.innerText="Peak NPS",m.classList.add("title","chart-info-grid-label");const l=document.createElement("div");l.innerText=Math.max(Math.max(...u.npsGraph),0).toFixed(2)+"",l.classList.add("title","chart-info-grid-count"),d.appendChild(m),d.appendChild(l);const f=document.createElement("div");f.classList.add("chart-info-grid"),Object.entries(u.counts).forEach(_=>{const w=document.createElement("div");w.classList.add("chart-info-grid-item");const T=document.createElement("div");T.innerText=_[0],T.classList.add("title","chart-info-grid-label");const E=document.createElement("div");E.innerText=_[1]+"",E.classList.add("title","chart-info-grid-count"),w.appendChild(T),w.appendChild(E),f.appendChild(w)});const p=document.createElement("div");p.classList.add("menu-options");const y=document.createElement("button");y.innerText="Duplicate Chart",y.onclick=()=>{const _=Object.assign(Object.create(Object.getPrototypeOf(e)),e);_.setNotedata(e.getNotedata().map(w=>e.computeNote(w))??[]),this.app.chartManager.loadedSM.addChart(_),this.app.chartManager.loadChart(_),this.loadCharts()},p.append(y);const v=document.createElement("button");v.innerText="Delete Chart",v.onclick=()=>{this.app.windowManager.openWindow(new wv(this.app,"Delete chart","Are you sure you want to delete this chart?",[{type:"default",label:"Cancel"},{type:"delete",label:"Delete",callback:()=>{this.app.chartManager.loadedSM.removeChart(e)&&(this.app.chartManager.loadChart(),this.gameType=this.app.chartManager.loadedChart?.gameType??this.gameType,this.loadCharts())}}]))},v.classList.add("delete"),p.append(v),this.chartInfo.replaceChildren(n,o,d,f,p)}}class lR extends ss{constructor(e){super({title:"Audio Equalizer",width:600,height:200,win_id:"audio-eq"});P(this,"app");this.app=e,this.initView()}initView(){this.viewElement.replaceChildren();const e=document.createElement("canvas");this.viewElement.appendChild(e);const r=this.drawEQ(e);requestAnimationFrame(r)}drawEQ(e){const r=e.getContext("2d"),n=[20,30,40,50,60,70,80,90,100,200,300,400,500,600,700,800,900,1e3,2e3,3e3,4e3,5e3,6e3,7e3,8e3,9e3,1e4],s=["20","30","40","50","60","","80","","100","200","300","400","500","600","","800","","1k","2k","3k","4k","5k","6k","","8k","","10k"],a=[];for(const u of n)a.push(Math.floor(Math.log(u/20)/Math.log(500)*1170));r.canvas.width=1200,r.canvas.height=400;const o=()=>{if(!this.app.chartManager.chartAudio)return;r.fillStyle="rgba(0, 0, 0, 1)",r.fillRect(0,0,e.width,e.height);const u=this.app.chartManager.chartAudio.getFrequencyData();r.fillStyle="rgb(0, 50, 150)";for(let d=0;d<1200;d++){const l=Math.pow(500,d/1170)*20/this.app.chartManager.chartAudio.getSampleRate()*2*this.app.chartManager.chartAudio.getFFTSize(),f=u[Math.floor(l)]/255;r.fillRect(d,400-f*500,1,f*500)}r.fillStyle="rgba(0, 100, 150, 1)",r.font="22px Assistant";for(let d=0;d<n.length;d++){let m=a[d];r.fillRect(m,0,1,400),d==n.length-1&&(m-=20),r.fillText(s[d],m,200)}for(let d=-10;d<10;d+=2){const m=-d*20+200;r.fillRect(0,m,1200,1),d!=0&&r.fillText(d+"",0,m)}r.fillRect(0,200,1200,1),r.fillStyle="rgba(0, 100, 150,0.5)",e.closest("#windows")&&requestAnimationFrame(o)};return o}}class cR extends ss{constructor(e){super({title:"Offset Adjuster",width:300,height:200,win_id:"offset",blocking:!0});P(this,"app");P(this,"metronomeInterval");P(this,"startTime");P(this,"me_high",new ua.Howl({src:"assets/sound/metronome_high.ogg",volume:W.audio.soundEffectVolume}));P(this,"me_low",new ua.Howl({src:"assets/sound/metronome_low.ogg",volume:W.audio.soundEffectVolume}));P(this,"tickLines",[]);P(this,"resultLines",[]);P(this,"previousOffsets",[]);P(this,"keyHandler");this.app=e,this.initView(),this.startTime=performance.now();let r=this.startTime+500;this.tickLines.push({time:r+500*1,beat:0}),this.tickLines.push({time:r+500*2,beat:1}),this.tickLines.push({time:r+500*3,beat:2}),this.tickLines.push({time:r+500*4,beat:3});let n=0;this.metronomeInterval=setInterval(()=>{const s=performance.now();if(s-r>500){for(r=s,(n%4==0?this.me_high:this.me_low).play();this.tickLines[0]?.time+1e3<s;)this.tickLines.shift();this.tickLines.push({time:r+500*4,beat:n+4}),n++}this.resultLines=this.resultLines.filter(a=>s-a.startTime<8e3)},5),this.keyHandler=s=>{if(s.code.startsWith("Digit")||s.code.startsWith("Key")||s.code=="Space"){let a=this.tickLines[0];const o=performance.now();for(const d of this.tickLines)if(o-d.time+W.play.offset*1e3<300){a=d;break}s.preventDefault();const u=o-a.time+W.play.offset*1e3;u>-300&&(this.tickLines.splice(this.tickLines.indexOf(a),1),this.resultLines.push({startTime:performance.now(),offset:u}),this.previousOffsets.push(u),this.previousOffsets.length==16&&(cv(this.previousOffsets)<70&&(W.play.offset-=Uf(this.previousOffsets)/1e3),this.previousOffsets=[]),console.log(u))}},window.addEventListener("keydown",this.keyHandler)}initView(){this.viewElement.replaceChildren();const e=document.createElement("canvas");this.viewElement.appendChild(e);const r=this.drawEQ(e);requestAnimationFrame(r)}drawEQ(e){const r=e.getContext("2d");r.canvas.width=250,r.canvas.height=100;const n=()=>{r.fillStyle="rgba(0, 0, 0, 1)",r.fillRect(0,0,e.width,e.height),r.fillStyle="rgb(255, 255, 255)",r.fillRect(e.width/2-1,8,2,e.height-16);const s=performance.now();for(const a of this.resultLines){r.fillStyle="rgba(255, 255, 255, 1)";const o=Math.min(1,4-(s-a.startTime)/2e3);if(a.offset<0&&(r.fillStyle=`rgba(160, ${co(160,0,-a.offset/250)}, ${co(160,0,-a.offset/250)}, ${o})`),a.offset>0&&(r.fillStyle=`rgba(${co(160,0,a.offset/250)}, ${co(160,0,a.offset/250)}, 160, ${o})`),r.fillRect(e.width/2-.5+a.offset/4,12,1,e.height-24),s-a.startTime<250){const u=(s-a.startTime)/250;r.globalAlpha=1-u,r.fillRect(e.width/2-.5-u*3+a.offset/4,12-u*10,1+u*6,e.height-24+u*20)}r.globalAlpha=1}for(const a of this.tickLines){const o=a.time-s-W.play.offset*1e3;r.fillStyle="rgba(255, 255, 255, 0.8)",a.beat%4!=0?r.fillRect(e.width/2-1-o/4,12,2,e.height-24):r.fillRect(e.width/2-2-o/4,12,4,e.height-24)}e.closest("#windows")&&requestAnimationFrame(n)};return n}onClose(){clearInterval(this.metronomeInterval),window.removeEventListener("keydown",this.keyHandler)}}function io(i,t){return{title:t??Hf(i),element:e=>{const r=e.chartManager.loadedSM,n=document.createElement("input");return n.type="text",n.autocomplete="off",n.spellcheck=!1,n.onkeydown=s=>{s.key=="Enter"&&n.blur()},n.onblur=()=>{const s=r.properties[i];tr.instance.run({action:()=>r.properties[i]=n.value,undo:()=>r.properties[i]=s})},n.value=r.properties[i]??"",n}}}function ta(i,t,e,r){return{title:e??Hf(i),element:n=>{const s=n.chartManager.loadedSM,a=document.createElement("div");a.classList.add("flex-row","flex-column-gap","flex-static");const o=()=>{s.properties[i]=u.value,r?.(n,u.value)},u=document.createElement("input");u.type="text",u.autocomplete="off",u.spellcheck=!1,u.onkeydown=l=>{l.key=="Enter"&&u.blur()},u.onblur=o,u.value=s.properties[i]??"";const d=document.createElement("button");d.style.height="100%",d.onclick=()=>{const l=n.chartManager.smPath.split("/").slice(0,-1).join("/");if(window.nw){const f=document.createElement("input");f.type="file",f.accept=t=="audio"?"audio/*":"image/*",f.onchange=()=>{u.value=ze.getRelativePath(l,f.value),o()},f.click()}else n.windowManager.openWindow(new Oh(n,{title:t=="audio"?"Select an audio file...":"Select an image file...",accepted_file_types:t=="audio"?Uc:Hy,disableClose:!0,callback:f=>{u.value=ze.getRelativePath(l,f),o()}},s.properties[i]?l+"/"+s.properties[i]:n.chartManager.smPath))};const m=document.createElement("img");return m.classList.add("icon"),m.style.height="12px",m.src=oi.SELECT_FILE,d.appendChild(m),a.appendChild(u),a.appendChild(d),a}}}const uR={title:io("TITLE","Song Title"),subtitle:io("SUBTITLE","Song Subtitle"),artist:io("ARTIST","Song Artist"),credit:io("CREDIT"),genre:io("GENRE"),origin:io("ORIGIN"),music:ta("MUSIC","audio","Music File",i=>i.chartManager.loadAudio()),bg:ta("BACKGROUND","image","BG Image"),banner:ta("BANNER","image","Banner Image"),cdtitle:ta("CDTITLE","image","CD Title"),cdimage:ta("CDIMAGE","image","CD Image"),jacket:ta("JACKET","image","Jacket"),discImage:ta("DISCIMAGE","image","Disc Image")};class xv extends ss{constructor(e,r,n){super({title:"Song Properties",width:400,height:365,disableClose:!!r,win_id:"sm_properties",blocking:!!r});P(this,"app");P(this,"callback");P(this,"changeHandler",()=>this.initView());this.app=e,this.callback=n,this.initView(),ve.on("smLoaded",this.changeHandler),ve.on("undo",this.changeHandler),ve.on("redo",this.changeHandler)}onClose(){ve.off("smLoaded",this.changeHandler),ve.off("undo",this.changeHandler),ve.off("redo",this.changeHandler)}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("sm-properties");const e=document.createElement("div");e.classList.add("padding");const r=document.createElement("div");r.classList.add("property-grid");const n=document.createElement("div");n.classList.add("label"),n.innerText="Apply to",Object.values(uR).forEach(m=>{const l=document.createElement("div");l.classList.add("label"),l.innerText=m.title;const f=m.element(this.app);r.appendChild(l),r.appendChild(f)}),e.appendChild(r);const s=document.createElement("div");s.classList.add("menu-options");const a=document.createElement("div");a.classList.add("menu-left");const o=document.createElement("div");o.classList.add("menu-right"),s.appendChild(a),s.appendChild(o);const u=document.createElement("button");u.innerText="Cancel",u.onclick=()=>{this.callback?.(!1),this.closeWindow()};const d=document.createElement("button");d.innerText="Create",d.classList.add("confirm"),d.onclick=()=>{this.callback?.(!0),this.closeWindow()},a.appendChild(u),o.appendChild(d),this.options.blocking&&e.appendChild(s),this.viewElement.appendChild(e)}}class Yi{constructor(t,e,r,n,s,a){P(this,"view");P(this,"input");P(this,"onChange");P(this,"min",-Number.MAX_VALUE);P(this,"max",Number.MAX_VALUE);P(this,"precision");P(this,"step",1);P(this,"lastVal","");this.view=t,this.view.classList.add("spinner");const o=document.createElement("input");o.classList.add("spinner-input"),o.type="text",o.autocomplete="off",o.spellcheck=!1,o.onblur=()=>{if(o.value==this.lastVal)return;if(o.value==""){this.onChange?.(void 0);return}let l=he(Tc(o.value),3);l=or(l,this.min,this.max),o.value=this.formatValue(l),this.onChange?.(l)},o.onkeydown=l=>{uo(l)||l.preventDefault(),l.key=="Enter"&&o.blur(),l.key=="Escape"&&(o.value=this.lastVal,o.blur())},o.onfocus=()=>{this.lastVal=o.value},this.input=o,this.min=s??this.min,this.max=a??this.max,this.step=r,this.precision=n,this.setValue(e),t.appendChild(o);const u=document.createElement("div");u.classList.add("spinner-btns"),t.appendChild(u);const d=document.createElement("button");d.classList.add("spinner-up"),d.onclick=()=>{o.value=this.formatValue(parseFloat(o.value)+r),this.onChange?.(parseFloat(o.value))},u.appendChild(d);const m=document.createElement("button");m.classList.add("spinner-down"),m.onclick=()=>{o.value=this.formatValue(parseFloat(o.value)-r),this.onChange?.(parseFloat(o.value))},u.appendChild(m)}get value(){return parseFloat(this.input.value)}static create(t,e,r,n,s){return new Yi(document.createElement("div"),t,e,r,n,s)}setValue(t){parseFloat(this.input.value)!=he(t,this.precision??3)&&(this.input.value=this.formatValue(t))}formatValue(t){return this.precision?he(t,this.precision).toFixed(this.precision):he(t,3).toString()}}const Ur=i=>i,p0={offset:{title:"Offset",element:Ur({create:(i,t)=>{const e=Yi.create(0,.001,3);return e.onChange=r=>{r!=null&&(i.chartManager.loadedChart?.timingData.insert(t(),"OFFSET",r),i.chartManager.setBeat(i.chartManager.getBeat()))},e.view},update:(i,t)=>{const e=i.querySelector(".spinner-input");if(document.activeElement==e)return;const r=t.getTimingData("OFFSET");e.value!=he(r,3).toFixed(3)&&(e.value=he(r,3).toFixed(3))}})},bpm:{title:"BPM",element:Ur({create:(i,t)=>{const e=Yi.create(120,.001,3);return e.onChange=r=>{if(r==null){const n=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"BPMS",n);return}i.chartManager.loadedChart?.timingData.insert(t(),"BPMS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=i.querySelector(".spinner-input");if(document.activeElement==r)return;const n=t.getTimingEventAtBeat("BPMS",e)?.value??120;r.value!=he(n,3).toFixed(3)&&(r.value=he(n,3).toFixed(3))}})},stop:{title:"Stop",element:Ur({create:(i,t)=>{const e=Yi.create(0,.001,3);return e.onChange=r=>{if(r==null||r==0){const n=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"STOPS",n);return}i.chartManager.loadedChart?.timingData.insert(t(),"STOPS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=i.querySelector(".spinner-input");if(document.activeElement==r)return;const n=t.getTimingEventAtBeat("STOPS",e);let s=n?.value??0;e!=n?.beat&&(s=0),r.value!=he(s,3).toFixed(3)&&(r.value=he(s,3).toFixed(3))}})},delay:{title:"Delay",element:Ur({create:(i,t)=>{const e=Yi.create(0,.001,3);return e.onChange=r=>{if(r==null||r==0){const n=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"DELAYS",n);return}i.chartManager.loadedChart?.timingData.insert(t(),"DELAYS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=i.querySelector(".spinner-input");if(document.activeElement==r)return;const n=t.getTimingEventAtBeat("DELAYS",e);let s=n?.value??0;e!=n?.beat&&(s=0),r.value!=he(s,3).toFixed(3)&&(r.value=he(s,3).toFixed(3))}})},warp:{title:"Warp",element:Ur({create:(i,t)=>{const e=Yi.create(0,.001,3,0);return e.onChange=r=>{if(r==null||r==0){const n=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"WARPS",n);return}r<0||i.chartManager.loadedChart?.timingData.insert(t(),"WARPS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=i.querySelector(".spinner-input");if(document.activeElement==r)return;const n=t.getTimingEventAtBeat("WARPS",e);let s=n?.value??0;e!=n?.beat&&(s=0),r.value!=he(s,3).toFixed(3)&&(r.value=he(s,3).toFixed(3))}})},timeSig:{title:"Time Sig.",element:Ur({create:(i,t)=>{const e=document.createElement("div");e.classList.add("flex-column-gap");const r=Yi.create(4,1,0,1);r.onChange=s=>{if(s==null){const a=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"TIMESIGNATURES",a);return}s<1||i.chartManager.loadedChart?.timingData.insert(t(),"TIMESIGNATURES",{upper:s,lower:n.value},i.chartManager.getBeat())};const n=Yi.create(4,1,0,1);return n.onChange=s=>{if(s==null){const a=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"TIMESIGNATURES",a);return}s<1||i.chartManager.loadedChart?.timingData.insert(t(),"TIMESIGNATURES",{upper:r.value,lower:s},i.chartManager.getBeat())},e.appendChild(r.view),e.appendChild(n.view),e},update:(i,t,e)=>{const r=i.firstElementChild.querySelector(".spinner-input"),n=i.lastElementChild.querySelector(".spinner-input"),s=t.getTimingEventAtBeat("TIMESIGNATURES",e),a=s?.upper??4,o=s?.lower??4;document.activeElement!=r&&r.value!=Math.round(a).toString()&&(r.value=Math.round(a).toString()),document.activeElement!=n&&n.value!=Math.round(o).toString()&&(n.value=Math.round(o).toString())}})},tick:{title:"Tickcount",element:Ur({create:(i,t)=>{const e=Yi.create(4,1,0,0);return e.onChange=r=>{if(r==null){const n=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"TICKCOUNTS",n);return}r<0||i.chartManager.loadedChart?.timingData.insert(t(),"TICKCOUNTS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=i.querySelector(".spinner-input");if(document.activeElement==r)return;const n=t.getTimingEventAtBeat("TICKCOUNTS",e)?.value??4;r.value!=Math.round(n).toString()&&(r.value=Math.round(n).toString())}})},combo:{title:"Combo",element:Ur({create:(i,t)=>{const e=document.createElement("div");e.classList.add("flex-column-gap");const r=Yi.create(1,1,0,0);r.onChange=s=>{if(s==null){const a=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"COMBOS",a);return}s<0||i.chartManager.loadedChart?.timingData.insert(t(),"COMBOS",{hitMult:s,missMult:n.value},i.chartManager.getBeat())};const n=Yi.create(1,1,0,0);return n.onChange=s=>{if(s==null){const a=i.chartManager.getBeat();n.setValue(i.chartManager.loadedChart?.timingData.getTimingEventAtBeat("COMBOS",a)?.missMult??1);return}s<0||i.chartManager.loadedChart?.timingData.insert(t(),"COMBOS",{hitMult:s,missMult:n.value},i.chartManager.getBeat())},e.appendChild(r.view),e.appendChild(n.view),e},update:(i,t,e)=>{const r=i.firstElementChild.querySelector(".spinner-input"),n=i.lastElementChild.querySelector(".spinner-input"),s=t.getTimingEventAtBeat("COMBOS",e),a=s?.hitMult??1,o=s?.missMult??1;document.activeElement!=r&&r.value!=Math.round(a).toString()&&(r.value=Math.round(a).toString()),document.activeElement!=n&&n.value!=Math.round(o).toString()&&(n.value=Math.round(o).toString())}})},speed:{title:"Speed",element:Ur({create:(i,t)=>{const e=document.createElement("div");e.classList.add("flex-column-gap");const r=()=>{i.chartManager.loadedChart?.timingData.insert(t(),"SPEEDS",{value:n.value,delay:s.value,unit:a.value=="Beats"?"B":"T"},i.chartManager.getBeat())},n=Yi.create(1,.1,0);n.onChange=o=>{if(o==null){const u=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"SPEEDS",u);return}r()};const s=Yi.create(1,.1,0);s.onChange=o=>{o==null||o<0||r()};const a=is.create(["Beat","Time"],"Beats");return a.onChange=r,e.appendChild(n.view),e.appendChild(s.view),e.appendChild(a.view),e},update:(i,t,e)=>{const r=i.firstElementChild.querySelector(".spinner-input"),n=i.children[1].querySelector(".spinner-input"),s=t.getTimingEventAtBeat("SPEEDS",e),a=s?.value??1,o=s?.delay??0,u=s?.unit=="B"?"Beat":"Time";document.activeElement!=r&&r.value!=he(a,3).toFixed(3)&&(r.value=he(a,3).toFixed(3)),document.activeElement!=n&&n.value!=he(o,3).toFixed(3)&&(n.value=he(o,3).toFixed(3)),n.disabled=s?.beat!=e;const d=i.lastElementChild.querySelector(".dropdown-selected");d.innerText!=u&&(d.innerText=u),s?.beat!=e?d.classList.add("disabled"):d.classList.remove("disabled")}})},scroll:{title:"Scroll",element:Ur({create:(i,t)=>{const e=Yi.create(1,.001,3);return e.onChange=r=>{if(r==null){const n=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"SCROLLS",n);return}i.chartManager.loadedChart?.timingData.insert(t(),"SCROLLS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=i.querySelector(".spinner-input");if(document.activeElement==r)return;const n=t.getTimingEventAtBeat("SCROLLS",e)?.value??1;r.value!=he(n,3).toFixed(3)&&(r.value=he(n,3).toFixed(3))}})},fake:{title:"Fake",element:Ur({create:(i,t)=>{const e=Yi.create(1,.001,3,0);return e.onChange=r=>{if(r==null){const n=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"FAKES",n);return}r<0||i.chartManager.loadedChart?.timingData.insert(t(),"FAKES",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=i.querySelector(".spinner-input");if(document.activeElement==r)return;const n=t.getTimingEventAtBeat("FAKES",e);let s=n?.value??1;e!=n?.beat&&(s=0),r.value!=he(s,3).toFixed(3)&&(r.value=he(s,3).toFixed(3))}})},label:{title:"Label",element:Ur({create:(i,t)=>{const e=document.createElement("input");return e.type="text",e.autocomplete="off",e.spellcheck=!1,e.onkeydown=r=>{r.key=="Enter"&&e.blur()},e.onblur=()=>{if(e.value==""){const r=i.chartManager.getBeat();i.chartManager.loadedChart?.timingData.delete(t(),"LABELS",r);return}i.chartManager.loadedChart?.timingData.insert(t(),"LABELS",{value:e.value},i.chartManager.getBeat())},e},update:(i,t,e)=>{const r=i;if(document.activeElement==r)return;const s=t.getTimingEventAtBeat("LABELS",e)?.value??"";r.value!=s&&(r.value=s)}})}};class dR extends ss{constructor(e){super({title:"Edit Timing Data",width:300,height:340,disableClose:!1,win_id:"timing_data",blocking:!1});P(this,"app");P(this,"lastBeat");P(this,"songTiming",!1);P(this,"interval");P(this,"changeHandler",()=>this.setData());this.app=e,this.lastBeat=Math.round(this.app.chartManager.getBeat()*1e3)/1e3,this.songTiming=!this.app.chartManager.loadedChart.timingData.isEmpty(),this.initView(),this.interval=setInterval(()=>{Math.round(this.app.chartManager.getBeat()*1e3)/1e3!=this.lastBeat&&(this.lastBeat=Math.round(this.app.chartManager.getBeat()*1e3)/1e3,this.setData())},17),ve.on("timingModified",this.changeHandler),ve.on("chartLoaded",this.changeHandler)}onClose(){ve.off("timingModified",this.changeHandler),clearInterval(this.interval)}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("timing-data");const e=document.createElement("div");e.classList.add("padding");const r=document.createElement("div");r.classList.add("label"),r.innerText="Apply to";const n=is.create(["All charts","This chart"],this.songTiming?"This chart":"All charts");n.onChange(s=>{this.songTiming=s=="This chart"}),e.appendChild(r),e.appendChild(n.view),Object.values(p0).forEach(s=>{const a=document.createElement("div");a.classList.add("label"),a.innerText=s.title;const o=s.element.create(this.app,()=>this.songTiming);e.appendChild(a),e.appendChild(o)}),this.viewElement.appendChild(e),this.setData()}setData(){!this.app.chartManager.loadedChart||Object.values(p0).forEach((e,r)=>{const n=this.viewElement.children[0].children[r*2+3];e.element.update(n,this.app.chartManager.loadedChart.timingData,this.lastBeat)})}}const ec={"chart.CMod":{label:"Toggle CMod",input:{type:"checkbox"},margin:!0},"chart.reverse":{label:"Reverse playfield",input:{type:"checkbox"}},"chart.hideWarpedArrows":{label:"Hide warped arrows",input:{type:"checkbox"}},"chart.doSpeedChanges":{label:"Do speed changes",input:{type:"checkbox"},margin:!0},"chart.speed":{label:"Scroll speed",input:{type:"slider",min:0,max:750,hardMax:2**31-1}},"chart.receptorYPos":{label:"Receptor Y position",input:{type:"slider",min:-400,max:0,hardMin:-(2**31-1),hardMax:2**31-1}},"chart.snap":{label:"Cursor snap",input:{type:"number",step:1,min:1,transformers:{serialize:i=>4/i,deserialize:i=>4/i}},margin:!0},"chart.maxDrawBeats":{label:"Draw length (beats)",input:{type:"slider",min:0,max:30,hardMax:2**31-1}},"chart.maxDrawBeatsBack":{label:"Draw length past receptors (beats)",input:{type:"slider",min:0,max:30,hardMax:2**31-1}},"chart.zoom":{label:"Playfield zoom",input:{type:"slider",min:0,step:1,max:200,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},"chart.drawNoteFlash":{label:"Toggle noteflashes",input:{type:"checkbox"},margin:!0},"audio.assistTick":{label:"Assist tick",input:{type:"checkbox"}},"audio.metronome":{label:"Metronome",input:{type:"checkbox"},margin:!0},"audio.rate":{label:"Playback rate",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},"audio.songVolume":{label:"Song Volume",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},"audio.soundEffectVolume":{label:"Sound effect volume",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}},margin:!0},"audio.effectOffset":{label:"Sound effect offset",input:{type:"slider",min:-1,step:.001,max:1,hardMin:-(2**31-1),hardMax:2**31-1}},"play.offset":{label:"Global offset",input:{type:"slider",min:-1,step:.001,max:1,hardMin:-(2**31-1),hardMax:2**31-1},margin:!0},"play.hideBarlines":{label:"Hide barlines during play",input:{type:"checkbox"}},"play.judgmentTilt":{label:"Judgment tilt",input:{type:"checkbox"},margin:!0},"play.timingCollection":{label:"Timing windows",input:{type:"dropdown",advanced:!1,get items(){return Object.keys(di.getCollections())}}},"play.timingWindowScale":{label:"Timing window scale",input:{type:"slider",min:0,step:.001,max:2,hardMax:2**31-1}},"play.timingWindowAdd":{label:"Timing window add",input:{type:"slider",min:0,step:.001,max:1,hardMax:2**31-1}},"performance.antialiasing":{label:"Antialiasing",input:{type:"checkbox"}},"performance.resolution":{label:"Resolution",input:{type:"slider",min:1,step:1,max:4,hardMin:0,hardMax:2**31-1}},"general.smoothAnimations":{label:"Smooth Animations",input:{type:"checkbox",onChange:i=>{i?document.body.classList.add("animated"):document.body.classList.remove("animated")}}},"debug.renderingStats":{label:"Show rendering stats",input:{type:"checkbox"}},"debug.showTimers":{label:"Show rendering timers",input:{type:"checkbox"}},"experimental.speedChangeWaveform":{label:"Allow waveform speed changes",input:{type:"checkbox"}},"chart.renderTimingEvent":{label:"Show timing event boxes"},"chart.waveform":{label:"Waveform"},"chart.waveform.enabled":{label:"Enable waveform",input:{type:"checkbox"}},"chart.waveform.opacity":{label:"Opacity",input:{type:"slider",min:0,max:1,step:.01}},"chart.waveform.lineHeight":{label:"Line height",input:{type:"slider",min:1,max:3,step:.1,hardMax:100}},"general.scrollSensitivity":{label:"Scroll sensitivity",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}},margin:!0},"general.mousePlacement":{label:"Mouse note placement",input:{type:"checkbox"},margin:!0},general:{label:"General"},chart:{label:"Chart"},audio:{label:"Audio"},play:{label:"Play Mode"},performance:{label:"Performance"},debug:{label:"Debug"},experimental:{label:"Experimental"}};class fR extends ss{constructor(e){super({title:"Options",width:500,height:400,disableClose:!1,win_id:"user_options",blocking:!1});P(this,"app");this.app=e,this.initView()}initView(){this.viewElement.replaceChildren();const e=document.createElement("div");e.classList.add("padding");const r=document.createElement("div");r.classList.add("pref-selector");const n=this.createDiv();r.replaceChildren(...n),e.appendChild(r),this.viewElement.appendChild(e)}createDiv(e){e=e??"";const r=this.getObjects(e);return e=e==""?"":e+".",r?Object.entries(r).filter(n=>!Rk.includes(e+n[0])).map(n=>this.makeObj(e,n)):[]}makeObj(e,r){const n=document.createElement("div");n.classList.add("pref-item"),n.dataset.id=e+r[0];const s=document.createElement("div");if(s.classList.add("pref-label","collapsed"),n.appendChild(s),typeof r[1]=="object"){const o=document.createElement("img");o.classList.add("icon"),o.classList.add("folder-icon"),o.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAbklEQVRIie2PMQqAMAxFXwfP6qJVPIjYzcOKdUkhQ0BaCoLkLS3k818CjuN8ztApYzIDl7xvmalFsAIZuIFozKPMMrC0CAJwKIkuGVX5KdkmLEm3ci1JSlLKU49yLSmXVG1es0EANvnvInKcP/AA784fpjlWwNQAAAAASUVORK5CYII=",s.appendChild(o)}const a=document.createElement("div");if(a.innerText=r[0],a.classList.add("title"),s.appendChild(a),typeof r[1]!="object"){let o;if(ec[e+r[0]]){const u=ec[e+r[0]];if(!u.input)return n;switch(a.innerText=u.label,u.input.type){case"checkbox":{const d=document.createElement("input"),m=u.input.onChange;d.type="checkbox",d.checked=r[1],d.onblur=null,d.onchange=()=>{W.applyOption([e+r[0],d.checked]),m?.(d.checked)},d.classList.add("pref-input","right"),d.onkeydown=l=>{l.key=="Enter"&&d.blur()},o=d;break}case"dropdown":{if(u.input.advanced){const d=u.input.transformers.deserialize,m=u.input.transformers.serialize,l=u.input.onChange,f=is.create(u.input.items,m(r[1]));f.onChange(p=>{W.applyOption([e+r[0],d(p)]),l?.(d(p))}),f.view.classList.add("pref-input","right"),o=f.view}else{const d=u.input.onChange,m=is.create(u.input.items,r[1]);m.onChange(l=>{W.applyOption([e+r[0],l]),d?.(l)}),m.view.classList.add("pref-input","right"),o=m.view}break}case"number":{const d=u.input.transformers?.deserialize??(p=>p),m=u.input.transformers?.serialize??(p=>p),l=u.input.onChange,f=Yi.create(m(r[1]),u.input.step,u.input.precision,u.input.min,u.input.max);f.onChange=p=>{if(!p){f.setValue(m(r[1]));return}W.applyOption([e+r[0],d(p)]),l?.(d(p))},o=f.view;break}case"slider":{const d=u.input.transformers?.deserialize??(w=>w),m=u.input.transformers?.serialize??(w=>w),l=u.input.onChange,f=document.createElement("div"),p=document.createElement("input");p.type="range",p.min=u.input.min?.toString()??"",p.max=u.input.max?.toString()??"",p.step=u.input.step?.toString()??"1",p.value=m(r[1]).toString();const y=document.createElement("input");y.type="text",y.value=(Math.round(m(r[1])*1e3)/1e3).toString();const v=u.input.min??u.input.hardMin??-Number.MAX_VALUE,_=u.input.max??u.input.hardMax??Number.MAX_VALUE;y.onblur=()=>{let w=Tc(y.value);w=or(w,v,_),y.value=he(w,3).toString(),y.blur(),y.value==""?y.value=m(r[1]).toString():W.applyOption([e+r[0],d(w)]),p.value=w.toString(),l?.(d(w))},y.oninput=()=>{y.value=y.value.replaceAll(/[^.0-9+-/*]/g,"")},p.oninput=()=>{const w=parseFloat(p.value);y.value=he(w,3).toString(),W.applyOption([e+r[0],d(w)])},y.classList.add("pref-input","right"),y.style.width="50px",y.onkeydown=w=>{w.key=="Enter"&&y.blur()},f.appendChild(p),f.appendChild(y),o=f;break}case"text":{const d=u.input.onChange,m=document.createElement("input");m.type="text",m.value=r[1].toString(),m.onblur=()=>{W.applyOption([e+r[0],m.value]),d?.(m.value)},m.classList.add("pref-input","right"),m.onkeydown=l=>{l.key=="Enter"&&m.blur()},o=m;break}}u.margin&&(s.style.marginBottom="8px")}else console.log("No prefrences entry for "+e+r[0]+"!"),o=this.makeDefaultObject(e,r);s.appendChild(o)}else{const o=document.createElement("div");o.classList.add("pref-dd"),ec[e+r[0]]?.label&&(a.innerText=ec[e+r[0]].label),n.appendChild(o),s.onclick=()=>{o.childElementCount==0?(s.classList.remove("collapsed"),o.replaceChildren(...this.createDiv(e+r[0]))):(s.classList.add("collapsed"),o.replaceChildren())}}return n}makeDefaultObject(e,r){const n=W.getDefaultOption(e+r[0]),s=document.createElement("input");return s.type="text",s.value=r[1].toString(),s.onblur=()=>{W.applyOption([e+r[0],s.value])},typeof n=="boolean"&&(s.type="checkbox",s.checked=r[1],s.onblur=null,s.onchange=()=>{W.applyOption([e+r[0],s.checked])}),typeof n=="number"&&(s.oninput=()=>{s.value=s.value.replaceAll(/[^.0-9+-]/g,"")},s.onblur=()=>{s.value=Tc(s.value).toString(),W.applyOption([e+r[0],Number(s.value)])}),s.classList.add("pref-input","right"),s.onkeydown=a=>{a.key=="Enter"&&s.blur()},s}getObjects(e){const r=e.split(".");let n=W;if(e=="")return n;for(const s of r)if(s in n)n=n[s];else return;return n}}var bh=(i=>(i.SHIFT="Shift",i.CTRL="Ctrl",i.ALT="Alt",i.META="Command",i))(bh||{});const _o=navigator.userAgent.indexOf("Mac OS X")>-1,ji=_o?"Command":"Ctrl",pR={Shift:_o?"\u21E7":"Shift",Ctrl:_o?"\u2303":"Ctrl",Alt:_o?"\u2325":"Alt",Command:"\u2318"},m0={ArrowLeft:"Left",ArrowUp:"Up",ArrowRight:"Right",ArrowDown:"Down",BracketLeft:"[",BracketRight:"]",Semicolon:";",Quote:"'",Backslash:"\\",Slash:"/",Period:".",Comma:",",Backquote:"`",Minus:"-",Equal:"+"},Is={playback:{label:"Play/Pause",keybinds:[{key:"Space",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>i.chartManager.playPause()},decreaseSnap:{label:"Decrease snap",keybinds:[{key:"Left",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>i.chartManager.previousSnap()},increaseSnap:{label:"Increase snap",keybinds:[{key:"Right",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>i.chartManager.nextSnap()},cursorUp:{label:"Move cursor up",keybinds:[{key:"Up",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>{const t=Math.max(.001,W.chart.snap),e=i.chartManager.getBeat()%t<5e-4?t:t/2;i.chartManager.setAndSnapBeat(i.chartManager.getBeat()-e)}},cursorDown:{label:"Move cursor down",keybinds:[{key:"Down",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>{const t=Math.max(.001,W.chart.snap),e=i.chartManager.getBeat()%t<5e-4?t:t/2;i.chartManager.setAndSnapBeat(i.chartManager.getBeat()+e)}},increaseScrollSpeed:{label:"Increase scroll speed",keybinds:[{key:"Up",mods:[ji]}],disabled:i=>!i.chartManager.chartView,callback:()=>W.chart.speed=Math.max(10,W.chart.speed*Math.pow(1.01,30))},decreaseScrollSpeed:{label:"Decrease scroll speed",keybinds:[{key:"Down",mods:[ji]}],disabled:i=>!i.chartManager.chartView,callback:()=>W.chart.speed=Math.max(10,W.chart.speed*Math.pow(1.01,-30))},zoomIn:{label:"Zoom in",keybinds:[{key:"+",mods:[ji]}],disabled:i=>!i.chartManager.chartView,callback:()=>{W.chart.zoom+=.1,Fe.create("Zoom: "+Math.round(W.chart.zoom*100)+"%")}},zoomOut:{label:"Zoom out",keybinds:[{key:"-",mods:[ji]}],disabled:i=>!i.chartManager.chartView,callback:()=>{W.chart.zoom=Math.max(.1,W.chart.zoom-.1),Fe.create("Zoom: "+Math.round(W.chart.zoom*100)+"%")}},zoomDefault:{label:"Reset zoom",keybinds:[{key:"0",mods:[ji]}],disabled:i=>!i.chartManager.chartView,callback:()=>{W.chart.zoom=1,Fe.create("Zoom: "+Math.round(W.chart.zoom*100)+"%")}},newSong:{label:"New Song...",keybinds:[{key:"N",mods:[ji]}],disabled:!0,callback:()=>0},openSong:{label:"Open Song...",keybinds:[{key:"O",mods:[ji]}],disabled:i=>!i.chartManager.loadedSM,callback:i=>{if(window.nw){const t=document.createElement("input");t.type="file",t.accept=".sm,.ssc",t.onchange=()=>{i.chartManager.loadSM(t.value)},t.click()}else i.windowManager.openWindow(new Oh(i,{title:"Select an sm/ssc file...",accepted_file_types:[".sm",".ssc"],disableClose:!0,callback:t=>{i.chartManager.loadSM(t)}}))}},songProperties:{label:"Song Properties...",keybinds:[{key:"U",mods:["Shift"]}],disabled:i=>!i.chartManager.loadedSM,callback:i=>i.windowManager.openWindow(new xv(i))},save:{label:"Save...",keybinds:[{key:"S",mods:[ji]}],disabled:i=>!i.chartManager.loadedSM,callback:i=>i.chartManager.save()},export:{label:"Save and export current song",keybinds:[{key:"E",mods:[ji]}],disabled:i=>!i.chartManager.loadedSM,callback:i=>{i.chartManager.save(),ze.saveDirectory(i.chartManager.smPath)}},openChart:{label:"Chart List",keybinds:[{key:"O",mods:[ji,"Shift"]}],disabled:i=>!i.chartManager.loadedSM,callback:i=>i.windowManager.openWindow(new bv(i))},timingData:{label:"Edit Timing Data...",keybinds:[{key:"T",mods:["Shift","Alt"]}],disabled:i=>!i.chartManager.chartView,callback:i=>i.windowManager.openWindow(new dR(i))},selectRegion:{label:"Select Region",keybinds:[{key:"Tab",mods:[]}],disabled:i=>!i.chartManager.loadedChart,callback:i=>i.chartManager.selectRegion()},volumeUp:{label:"Increase volume",keybinds:[{key:"Up",mods:["Shift"]}],disabled:!1,callback:()=>{W.audio.songVolume=Math.min(W.audio.songVolume+.05,1),Fe.create("Volume: "+Math.round(W.audio.songVolume*100)+"%")}},volumeDown:{label:"Decrease volume",keybinds:[{key:"Down",mods:["Shift"]}],disabled:!1,callback:()=>{W.audio.songVolume=Math.max(W.audio.songVolume-.05,0),Fe.create("Volume: "+Math.round(W.audio.songVolume*100)+"%")}},effectvolumeUp:{label:"Increase sound effect volume",keybinds:[{key:"Up",mods:["Shift","Alt"]}],disabled:!1,callback:()=>{W.audio.soundEffectVolume=Math.min(W.audio.soundEffectVolume+.05,1),Fe.create("Effect Volume: "+Math.round(W.audio.soundEffectVolume*100)+"%")}},effectvolumeDown:{label:"Decrease sound effect volume",keybinds:[{key:"Down",mods:["Shift","Alt"]}],disabled:!1,callback:()=>{W.audio.soundEffectVolume=Math.max(W.audio.soundEffectVolume-.05,0),Fe.create("Effect Volume: "+Math.round(W.audio.soundEffectVolume*100)+"%")}},rateUp:{label:"Increase playback rate",keybinds:[{key:"Right",mods:["Shift"]}],disabled:i=>i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:()=>{W.audio.rate+=.05,Fe.create("Playback Rate: "+Math.round(W.audio.rate*100)+"%")}},rateDown:{label:"Decrease playback rate",keybinds:[{key:"Left",mods:["Shift"]}],disabled:i=>i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:()=>{W.audio.rate=Math.max(W.audio.rate-.05,.1),Fe.create("Playback Rate: "+Math.round(W.audio.rate*100)+"%")}},rateDefault:{label:"Reset playback rate",keybinds:[],disabled:!1,callback:()=>{W.audio.rate=1,Fe.create("Playback Rate: "+Math.round(W.audio.rate)+"%")}},previousMeasure:{label:"Previous measure",keybinds:[{key:"PageUp",mods:[]},{key:";",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>{const t=i.chartManager.getBeat(),e=i.chartManager.loadedChart.timingData.getMeasureLength(t-.001);i.chartManager.setAndSnapBeat(Math.max(0,t-e))}},nextMeasure:{label:"Next measure",keybinds:[{key:"PageDown",mods:[]},{key:"'",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>{const t=i.chartManager.getBeat(),e=i.chartManager.loadedChart.timingData.getMeasureLength(t);i.chartManager.setAndSnapBeat(Math.max(0,t+e))}},previousNote:{label:"Previous note",keybinds:[{key:",",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>i.chartManager.previousNote()},nextNote:{label:"Next note",keybinds:[{key:".",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>i.chartManager.nextNote()},jumpChartStart:{label:"Jump to first note",keybinds:[{key:"Home",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>i.chartManager.firstNote()},jumpChartEnd:{label:"Jump to last note",keybinds:[{key:"End",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>i.chartManager.lastNote()},jumpSongStart:{label:"Jump to song start",keybinds:[{key:"Home",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>i.chartManager.setBeat(Math.max(0,i.chartManager.loadedChart.getBeatFromSeconds(0)))},jumpSongEnd:{label:"Jump to song end",keybinds:[{key:"End",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>i.chartManager.setBeat(i.chartManager.loadedChart.getBeatFromSeconds(i.chartManager.chartAudio.getSongLength()))},assistTick:{label:"Assist Tick",keybinds:[{key:"F7",mods:[]}],disabled:!1,callback:()=>{W.audio.assistTick=!W.audio.assistTick,Fe.create("Assist Tick: "+(W.audio.assistTick?"on":"off"))}},metronome:{label:"Metronome",keybinds:[{key:"F7",mods:["Alt"]}],disabled:!1,callback:()=>{W.audio.metronome=!W.audio.metronome,Fe.create("Metronome: "+(W.audio.metronome?"on":"off"))}},renderWaveform:{label:"Render waveform",keybinds:[{key:"W",mods:["Shift","Alt"]}],disabled:!1,callback:()=>{W.chart.waveform.enabled=!W.chart.waveform.enabled,Fe.create("Waveform: "+(W.chart.waveform.enabled?"on":"off"))}},waveformOptions:{label:"Waveform options...",keybinds:[],disabled:!0,callback:()=>0},XMod:{label:"XMod (Beat-based)",keybinds:[{key:"X",mods:["Shift"]}],disabled:!1,callback:()=>{W.chart.CMod=!1,Fe.create("Switched to XMod")}},CMod:{label:"CMod (Time-based)",keybinds:[{key:"C",mods:["Shift"]}],disabled:!1,callback:()=>{W.chart.CMod=!0,Fe.create("Switched to CMod")}},hideWarpedArrows:{label:"Hide warped arrows (CMod only)",keybinds:[{key:"W",mods:["Shift"]}],disabled:!1,callback:()=>{W.chart.hideWarpedArrows=!W.chart.hideWarpedArrows,Fe.create("Hide Warped Arrows: "+(W.chart.hideWarpedArrows?"on":"off"))}},doSpeedChanges:{label:"Do speed changes (XMod only)",keybinds:[{key:"S",mods:["Shift"]}],disabled:!1,callback:()=>{W.chart.doSpeedChanges=!W.chart.doSpeedChanges,Fe.create("Speed Changes: "+(W.chart.doSpeedChanges?"on":"off"))}},showEq:{label:"Equalizer",keybinds:[{key:"E",mods:["Shift","Alt"]}],disabled:i=>!i.chartManager.chartAudio,callback:i=>i.windowManager.openWindow(new lR(i))},previousNoteType:{label:"Previous note type",keybinds:[{key:"N",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>i.chartManager.previousNoteType()},nextNoteType:{label:"Next Note Type",keybinds:[{key:"M",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==Ot.Play||i.chartManager.getMode()==Ot.Record,callback:i=>i.chartManager.nextNoteType()},undo:{label:"Undo",keybinds:[{key:"Z",mods:[ji]}],disabled:i=>!i.actionHistory.canUndo()||i.chartManager.getMode()!=Ot.Edit,callback:i=>i.actionHistory.undo()},redo:{label:"Redo",keybinds:[{key:"Y",mods:[ji]}],disabled:i=>!i.actionHistory.canRedo()||i.chartManager.getMode()!=Ot.Edit,callback:i=>i.actionHistory.redo()},mousePlacement:{label:"Enable Mouse Note Placement",keybinds:[{key:"M",mods:["Shift"]}],disabled:!1,callback:()=>{W.general.mousePlacement=!W.general.mousePlacement,Fe.create("Mouse Note Placement: "+(W.general.mousePlacement?"on":"off"))}},playMode:{label:"Enter/Exit Play Mode",keybinds:[{key:"P",mods:[]}],disabled:i=>!i.chartManager.chartView&&i.chartManager.getMode()!=Ot.Record,callback:i=>i.chartManager.setMode(Ot.Play)},recordMode:{label:"Enter/Exit Record Mode",keybinds:[{key:"R",mods:[]}],disabled:i=>!i.chartManager.chartView&&i.chartManager.getMode()!=Ot.Play,callback:i=>i.chartManager.setMode(Ot.Record)},playModeStart:{label:"Play from start",keybinds:[{key:"P",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView&&i.chartManager.getMode()!=Ot.Record,callback:i=>{i.chartManager.setBeat(0),i.chartManager.setMode(Ot.Play)}},options:{label:"Options",keybinds:[{key:",",mods:[ji]}],disabled:!1,callback:i=>{i.windowManager.openWindow(new fR(i))}},convertHoldsRolls:{label:"Holds to rolls",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.type=="Hold"&&(t.type="Roll"),t))}},convertHoldsTaps:{label:"Holds/rolls to taps",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{i.chartManager.modifySelection(t=>((t.type=="Hold"||t.type=="Roll")&&(t.type="Tap"),t))}},convertNotesMines:{label:"Notes to mines",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.type="Mine",t))}},convertTapsFakes:{label:"Taps to fakes",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.type=="Tap"&&(t.type="Fake"),t))}},mirrorHorizontally:{label:"Horizontally",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.col=i.chartManager.loadedChart.gameType.flipColumns.horizontal[t.col],t))}},mirrorVertically:{label:"Vertically",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.col=i.chartManager.loadedChart.gameType.flipColumns.vertical[t.col],t))}},mirrorBoth:{label:"Both",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.col=i.chartManager.loadedChart.gameType.flipColumns.horizontal[t.col],t.col=i.chartManager.loadedChart.gameType.flipColumns.vertical[t.col],t))}},selectAll:{label:"Select All",keybinds:[{key:"A",mods:[ji]}],disabled:i=>!i.chartManager.loadedChart,callback:i=>{i.chartManager.selection.notes=[...i.chartManager.loadedChart.getNotedata()]}},expand2to1:{label:"Expand 2:1 (8th to 4th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)*2+t,e.beat=Math.round(e.beat*48)/48,De(e)&&(e.hold*=2,e.hold=Math.round(e.hold*48)/48),e))}},expand3to2:{label:"Expand 3:2 (12th to 8th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)*1.5+t,e.beat=Math.round(e.beat*48)/48,De(e)&&(e.hold*=1.5,e.hold=Math.round(e.hold*48)/48),e))}},expand4to3:{label:"Expand 4:3 (16th to 2th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)*4/3+t,e.beat=Math.round(e.beat*48)/48,De(e)&&(e.hold*=4/3,e.hold=Math.round(e.hold*48)/48),e))}},compress1to2:{label:"Compress 1:2 (4th to 8th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)/2+t,e.beat=Math.round(e.beat*48)/48,De(e)&&(e.hold/=2,e.hold=Math.round(e.hold*48)/48),e))}},compress2to3:{label:"Compress 2:3 (8th to 12th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)/1.5+t,e.beat=Math.round(e.beat*48)/48,De(e)&&(e.hold/=1.5,e.hold=Math.round(e.hold*48)/48),e))}},compress3to4:{label:"Compress 3:4 (12th to 16th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)*.75+t,e.beat=Math.round(e.beat*48)/48,De(e)&&(e.hold*=.75,e.hold=Math.round(e.hold*48)/48),e))}},delete:{label:"Delete",keybinds:[{key:"Backspace",mods:[]},{key:"Delete",mods:[]}],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=Ot.Edit,callback:i=>i.chartManager.deleteSelection()},paste:{label:"Paste",keybinds:[{key:"V",mods:[ji]}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=Ot.Edit,callback:async i=>{const t=await navigator.clipboard.readText();i.chartManager.pasteNotes(t)}},copy:{label:"Copy",keybinds:[{key:"C",mods:[ji]}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=Ot.Edit,callback:async i=>{const t=i.chartManager.copyNotes();t&&await navigator.clipboard.writeText(t)}},cut:{label:"Cut",keybinds:[{key:"X",mods:[ji]}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=Ot.Edit,callback:async i=>{const t=i.chartManager.copyNotes();t&&await navigator.clipboard.writeText(t),i.chartManager.deleteSelection()}},adjustOffset:{label:"Adjust Offset",keybinds:[],disabled:!1,callback:i=>i.windowManager.openWindow(new cR(i))}},Bc=class extends b2{static init(t){this.tex=Di.create({width:25,height:25,resolution:t.resolution}),this.noBorderTex=Di.create({width:25,height:25,resolution:t.resolution}),this.graphics.beginFill(16777215,1),this.graphics.lineStyle(1,0),this.graphics.drawRoundedRect(0,0,25,25,5),this.graphics.endFill(),t.render(this.graphics,{renderTexture:this.tex}),this.graphics.clear(),this.graphics.beginFill(16777215,1),this.graphics.lineStyle(1,16777215),this.graphics.drawRoundedRect(0,0,25,25,5),this.graphics.endFill(),t.render(this.graphics,{renderTexture:this.noBorderTex})}constructor(t){super(t?Bc.noBorderTex:Bc.tex,5,5,5,5)}};let Yn=Bc;P(Yn,"graphics",new Bo),P(Yn,"tex",Di.create({width:25,height:25})),P(Yn,"noBorderTex",Di.create({width:25,height:25}));class zf extends be{constructor(e){super();P(this,"manager");this.manager=e}startPlay(){}endPlay(){}}const mR=[15157287,4033015,11152884,8577607,11152884,15376696,11152884,7071886,7071886];class gR extends zf{constructor(e){super(e);P(this,"barContainer",new By(1500,{position:!0,scale:!0},16384,!0));P(this,"backing",new Yn);P(this,"bars");P(this,"barTexture");P(this,"overlay",new Ie(Ht.WHITE));P(this,"lastHeight",0);P(this,"lastCMod");P(this,"mouseDown",!1);P(this,"queued",!1);this.addChild(this.backing),this.visible=!1,this.backing.tint=0,this.backing.alpha=.3,this.barTexture=Di.create({resolution:this.manager.app.renderer.resolution}),this.bars=new Ie(this.barTexture),this.bars.anchor.set(.5),this.addChild(this.bars),this.overlay.anchor.x=.5,this.overlay.anchor.y=0,this.overlay.alpha=.3,this.lastCMod=W.chart.CMod,this.addChild(this.overlay),this.x=this.manager.app.renderer.screen.width/2-20,ve.on("chartLoaded",()=>{this.queued=!1,this.populate()}),ve.on("chartModifiedAfter",()=>{this.queued||this.populate(),this.queued=!0});const r=setInterval(()=>{this.queued&&(this.queued=!1,this.populate())},3e3);this.on("destroyed",()=>clearInterval(r)),this.populate(),this.interactive=!0,this.on("mousedown",n=>{this.mouseDown=!0,this.handleMouse(n)}),this.on("mousemove",n=>{this.mouseDown&&this.handleMouse(n)}),window.onmouseup=()=>{this.mouseDown=!1}}handleMouse(e){if(this.manager.chartManager.getMode()==Ot.Play||!this.getChart())return;let r=(this.bars.toLocal(e.global).y+this.bars.height/2)/this.bars.height;r=or(r,0,1);const n=this.getChart().getNotedata().at(-1);if(!n)return;const s=n.beat+(De(n)?n.hold:0),a=this.getChart().getSecondsFromBeat(s);W.chart.CMod?this.manager.chartManager.setTime(co(-this.getChart().timingData.getTimingData("OFFSET"),a,r)):this.manager.chartManager.setBeat(s*r)}update(){const e=this.manager.app.renderer.screen.height-40;this.backing.height=e+10,this.backing.position.y=-this.backing.height/2,this.backing.position.x=-this.backing.width/2,this.bars.height=e,this.x=this.manager.app.renderer.screen.width/2-20;const r=this.getChart(),n=this.manager.chartManager.chartView;if(!r||!n){this.visible=!1;return}this.visible=!0;const s=r.getNotedata().at(-1);if(!s){this.overlay.height=0;return}const a=s.beat+(De(s)?s.hold:0),o=r.getSecondsFromBeat(a),u=W.chart.CMod?n.getTimeFromYPos(-this.manager.app.renderer.screen.height/2):n.getBeatFromYPos(-this.manager.app.renderer.screen.height/2,!0),d=W.chart.CMod?n.getTimeFromYPos(this.manager.app.renderer.screen.height/2):n.getBeatFromYPos(this.manager.app.renderer.screen.height/2,!0);let m=Ja(0,a,u),l=Ja(0,a,d);W.chart.CMod&&(m=Ja(-r.timingData.getTimingData("OFFSET"),o,u),l=Ja(-r.timingData.getTimingData("OFFSET"),o,d)),m=or(m,0,1),l=or(l,0,1);const f=(m-.5)*(this.backing.height-10),p=(l-.5)*(this.backing.height-10);this.overlay.y=f,this.overlay.height=p-f,this.overlay.height=Math.max(2,this.overlay.height),(this.manager.app.renderer.screen.height!=this.lastHeight||this.lastCMod!=W.chart.CMod)&&(this.lastCMod=W.chart.CMod,this.lastHeight=this.manager.app.renderer.screen.height,this.populate()),this.scale.y=W.chart.reverse?-1:1}populate(){const e=this.getChart();if(!e){Ci(this.barContainer.children,()=>!0),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture});return}this.visible=!0;let r=0;const n=e.gameType.numCols,s=e.getNotedata().at(-1),a=this.manager.app.renderer.screen.height-40;if(this.backing.height=a,this.backing.width=n*6+8,this.overlay.width=n*6+8,this.pivot.x=this.backing.width/2,this.barTexture.resize(n*6,a),!s){Ci(this.barContainer.children,()=>!0),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture});return}const o=s.beat+(De(s)?s.hold:0),u=e.getSecondsFromBeat(o),d=e.timingData.getTimingData("OFFSET");e.getNotedata().forEach(m=>{let l=this.barContainer.children[r];l||(l=new Ie(Ht.WHITE),l.width=4,this.barContainer.addChild(l)),l.anchor.set(.5),l.height=1,l.x=(m.col+.5)*6;let f=Ja(0,o,m.beat);if(W.chart.CMod&&(f=Ja(d,u,m.second)),l.y=f*a,l.tint=mR[Nf(m.beat)],m.type=="Mine"&&(l.tint=8421504),r++,De(m)){let p=this.barContainer.children[r];p||(p=new Ie(Ht.WHITE),p.width=4,p.height=2,this.barContainer.addChild(p)),p.anchor.x=.5,p.anchor.y=0,p.x=(m.col+.5)*6;const y=(W.chart.CMod?e.getSecondsFromBeat(m.beat+m.hold)/u:(m.beat+m.hold)/o)*a+1;p.y=l.y,p.height=y-l.y,m.type=="Hold"&&(p.tint=10526880),m.type=="Roll"&&(p.tint=11379586),r++}}),Ci(this.barContainer.children,(m,l)=>l>=r),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture})}getChart(){return this.manager.chartManager.loadedChart}}const ci=300,ai=150,yR=[.045,.09,.18,.37,.18,.09,.045];class vR extends zf{constructor(e){super(e);P(this,"max",0);P(this,"barlines",new be);P(this,"backgroundRect",new Yn);P(this,"background",new be);P(this,"backgroundLines",new be);P(this,"statText",new be);P(this,"meanText");P(this,"medianText");P(this,"modeText");P(this,"stddevText");P(this,"errorMS",[]);P(this,"texts",new be);P(this,"showEase",0);P(this,"easeVelocity",0);P(this,"toggled",!1);P(this,"hovered",!1);P(this,"drag",!1);P(this,"dragStart",0);this.visible=!1,this.backgroundRect.tint=0,this.backgroundRect.alpha=.3,this.background.addChild(this.backgroundRect),this.addChild(this.background),this.addChild(this.backgroundLines),this.interactive=!0,this.on("mousedown",()=>{this.manager.chartManager.getMode()!=Ot.Play&&(this.drag=!0,this.dragStart=Date.now())}),window.addEventListener("mousemove",d=>{this.drag&&(this.showEase+=d.movementY/-350)}),this.on("mouseup",()=>{this.drag&&(Date.now()-this.dragStart>400?this.toggled=this.showEase>.5:(this.hovered=!1,this.toggled=!this.toggled))}),window.addEventListener("mouseup",()=>{this.drag=!1}),this.on("mouseenter",()=>{this.hovered=!0}),this.on("mouseleave",()=>{this.hovered=!1});const r=new Je("Early",{fontName:"Main",fontSize:15});r.x=-ci/2+5,r.y=-ai+10,r.alpha=.3,this.background.addChild(r);const n=new Je("Late",{fontName:"Main",fontSize:15});n.anchor.x=1,n.x=ci/2-5,n.y=-ai+10,n.alpha=.3,this.background.addChild(n),this.meanText=new Je("-",{fontName:"Main",fontSize:15}),this.meanText.anchor.x=.5,this.meanText.x=ci/4*-1.5,this.meanText.y=-ai-20,this.statText.addChild(this.meanText),this.medianText=new Je("-",{fontName:"Main",fontSize:15}),this.medianText.anchor.x=.5,this.medianText.x=ci/4*-.5,this.medianText.y=-ai-20,this.statText.addChild(this.medianText),this.modeText=new Je("-",{fontName:"Main",fontSize:15}),this.modeText.anchor.x=.5,this.modeText.x=ci/4*.5,this.modeText.y=-ai-20,this.statText.addChild(this.modeText),this.stddevText=new Je("-",{fontName:"Main",fontSize:15}),this.stddevText.anchor.x=.5,this.stddevText.x=ci/4*1.5,this.stddevText.y=-ai-20,this.statText.addChild(this.stddevText);const s=new Je("Mean",{fontName:"Main",fontSize:10});s.anchor.x=.5,s.x=ci/4*-1.5,s.y=-ai-30,this.statText.addChild(s);const a=new Je("Median",{fontName:"Main",fontSize:10});a.anchor.x=.5,a.x=ci/4*-.5,a.y=-ai-30,this.statText.addChild(a);const o=new Je("Mode",{fontName:"Main",fontSize:10});o.anchor.x=.5,o.x=ci/4*.5,o.y=-ai-30,this.statText.addChild(o);const u=new Je("Std Dev.",{fontName:"Main",fontSize:10});u.anchor.x=.5,u.x=ci/4*1.5,u.y=-ai-30,this.statText.addChild(u),this.addChild(this.statText),this.addChild(this.barlines),this.addChild(this.texts)}update(){this.visible=!!this.manager.chartManager.gameStats,this.x=-this.manager.chartManager.app.renderer.screen.width/2+20+ci/2,this.y=this.manager.chartManager.app.renderer.screen.height/2-20,this.backgroundRect.width=ci+10,this.backgroundRect.height=ai+210,this.backgroundRect.x=-ci/2-5,this.backgroundRect.y=-ai-210,this.visible=!!this.manager.chartManager.gameStats;for(const e of this.barlines.children)W.general.smoothAnimations?e.height=(e.targetHeight-e.height)*.2+e.height:e.height=e.targetHeight;if(W.general.smoothAnimations){const e=this.manager.chartManager.getMode()==Ot.Play||this.toggled?1:Number(this.hovered)*.05;this.drag||(this.easeVelocity+=(e-this.showEase)*.05,this.showEase+=this.easeVelocity),this.easeVelocity<0&&this.showEase<0&&(this.easeVelocity*=-1),this.easeVelocity*=.75,this.y+=(1-this.showEase)*350}else this.manager.chartManager.getMode()!=Ot.Play&&(this.y+=350)}newLine(){const e=new Ie(Ht.WHITE);return e.smoothCount=0,e.targetHeight=0,e.anchor.y=1,e.anchor.x=.5,e.height=0,e.visible=!1,this.barlines.addChild(e),e}startPlay(){const e=this.manager.chartManager.gameStats;this.max=0,this.errorMS=[],this.meanText.text="-",this.medianText.text="-",this.modeText.text="-",this.stddevText.text="-",Ci(this.barlines.children,()=>!0),Ci(this.backgroundLines.children,()=>!0),Ci(this.texts.children,()=>!0);const r=di.getCollection(W.play.timingCollection),n=r.getStandardWindows().length+1,s=Math.round(r.maxWindowMS());for(let y=0;y<s*2;y++){const v=this.newLine();v.width=ci/s/2,v.x=(y-s)*v.width,this.barlines.addChild(v)}let a=0;for(const y of r.getStandardWindows().reverse()){const v=Math.round(y.getTimingWindowMS());if(v!=0){for(let _=-1;_<=1;_+=2){const w=new Ie(Ht.WHITE);w.anchor.y=1,w.anchor.x=.5,w.height=ai,w.tint=y.color,w.alpha=.2,w.width=1,w.x=v*_*ci/s/2,this.backgroundLines.addChild(w)}for(let _=-v+s;_<v+s;_++)this.barlines.children[Math.round(_)].tint=y.color}}const o=new Ie(Ht.WHITE);o.anchor.y=1,o.anchor.x=.5,o.height=ai,o.alpha=.2,o.width=1,o.tint=8947848,this.backgroundLines.addChild(o);for(const y of[...r.getStandardWindows(),r.getMissJudgment()]){const v=new Je(y.name,{fontName:"Main",fontSize:15}),_=new Je("0",{fontName:"Main",fontSize:15});v.tint=y.color,_.tint=y.color,_.name=y.id,this.texts.addChild(v),this.texts.addChild(_),v.x=-ci/2+10,_.x=-ci/2+140,v.y=130/n*a-ai-170,_.y=130/n*a++-ai-170,v.anchor.y=.5,_.anchor.y=.5,_.anchor.x=1}const u=r.getHoldWindows().length+2;a=0;for(const y of[...r.getHoldWindows(),r.getMineJudgment()]){const v=ks(y)?y.noteType:"Mine",_=new Je(v,{fontName:"Main",fontSize:15}),w=new Je("0",{fontName:"Main",fontSize:15});v!="Mine"&&(w.text="0 / "+this.manager.chartManager.loadedChart.getNotedata().filter(T=>T.type==v).length),_.tint=14540253,w.tint=14540253,w.name=v,this.texts.addChild(_),this.texts.addChild(w),_.x=-ci/2+160,w.x=-ci/2+290,_.y=80/u*a-ai-170,w.y=80/u*a++-ai-170,_.anchor.y=.5,w.anchor.y=.5,w.anchor.x=1}const d=new Je("Max Combo",{fontName:"Main",fontSize:15}),m=new Je("0",{fontName:"Main",fontSize:15});d.tint=14540253,m.tint=14540253,m.name="Combo",this.texts.addChild(d),this.texts.addChild(m),d.x=-ci/2+160,m.x=-ci/2+290,d.y=80/u*a-ai-170,m.y=80/u*a++-ai-170,d.anchor.y=.5,m.anchor.y=.5,m.anchor.x=1;const l=new Je("0.00 / 0.00",{fontName:"Main",fontSize:20});l.tint=14540253,l.x=-ci/2+225,l.y=-ai-62,l.name="Score",this.texts.addChild(l),l.anchor.set(.5);const f=new Je("Score / Current Score",{fontName:"Main",fontSize:13});f.tint=8947848,f.x=-ci/2+225,f.y=-ai-85,this.texts.addChild(f),f.anchor.set(.5);const p=new Je("Play Statistics",{fontName:"Main",fontSize:13});p.y=-ai-195,p.anchor.set(.5),this.texts.addChild(p),e.onJudge((y,v)=>{let _="";(Jn(v)||va(v))&&(_=v.id),ks(v)&&(_=v.noteType),fa(v)&&(_="Mine");const w=this.texts.getChildByName(_);if(ks(v)){const E=w.text.split(" / ")[1];w.text=e.getCount(v)+" / "+E}else So(v)||(w.text=e.getCount(v)+"");if(this.texts.getChildByName("Combo").text=e.getMaxCombo()+"",this.texts.getChildByName("Score").text=he(e.getScore()*100,2).toFixed(2)+" / "+he(e.getCumulativeScore()*100,2).toFixed(2),Jn(v)||!va(v))return;const T=Math.round(y*1e3);for(let E=-3;E<=3;E++)!this.barlines.children[T+s+E]||(this.barlines.children[T+s+E].smoothCount+=yR[E+3],this.barlines.children[T+s+E].visible=!0,this.barlines.children[T+s+E].smoothCount>this.max&&(this.modeText.text=T+"ms",this.max=this.barlines.children[T+s+E].smoothCount));this.errorMS.push(y*1e3),this.meanText.text=Mk(this.errorMS).toFixed(2)+"ms",this.medianText.text=Uf(this.errorMS).toFixed(2)+"ms",this.stddevText.text=cv(this.errorMS).toFixed(2)+"ms",this.redraw()})}redraw(){for(const e of this.barlines.children)e.targetHeight=e.smoothCount*(ai-20)/this.max}}class _R extends zf{constructor(e){super(e);P(this,"view");P(this,"playbackBar");P(this,"skipStart");P(this,"skipEnd");P(this,"play");P(this,"playIcon");P(this,"record");P(this,"playtest");P(this,"timeCounter");P(this,"beatCounter");P(this,"min");P(this,"sec");P(this,"millis");P(this,"beat");P(this,"beatDropdown");P(this,"editBar");P(this,"editSteps");P(this,"editTiming");P(this,"stepsContainer");P(this,"timingContainer");P(this,"editChoiceContainer");P(this,"noteArrows",[]);P(this,"noteArrowMask");P(this,"lastTime",0);P(this,"lastBeat",0);P(this,"lastMode",Ot.Edit);P(this,"lastHover",0);P(this,"lastPlaying",!1);P(this,"hovering",!1);P(this,"trackingMovement",!0);P(this,"idleFrames",0);P(this,"lastBounds");const r=document.createElement("div");r.id="status-widget",document.getElementById("view-wrapper")?.appendChild(r),this.playbackBar=document.createElement("div"),this.playbackBar.classList.add("playback-bar"),this.editBar=document.createElement("div"),this.editBar.classList.add("edit-bar"),this.skipStart=document.createElement("button");const n=document.createElement("img");n.src=oi.SKIP_START,n.style.height="36px",this.skipStart.appendChild(n),this.skipStart.onclick=()=>{this.manager.chartManager.setBeat(0)},this.skipEnd=document.createElement("button");const s=document.createElement("img");s.style.height="36px",s.src=oi.SKIP_END,this.skipEnd.appendChild(s),this.skipStart.appendChild(n),this.skipEnd.onclick=()=>{this.manager.chartManager.lastNote()},this.play=document.createElement("button");const a=document.createElement("img");a.src=oi.PLAY,this.play.appendChild(a),this.playIcon=a,this.play.onclick=()=>{(this.manager.chartManager.getMode()==Ot.Record||this.manager.chartManager.getMode()==Ot.Play)&&this.manager.chartManager.setMode(Ot.Edit),this.manager.chartManager.playPause()},this.record=document.createElement("button");const o=document.createElement("img");o.style.height="36px",o.src=oi.RECORD,this.record.appendChild(o),this.record.onclick=()=>{this.manager.chartManager.setMode(Ot.Record)},this.playtest=document.createElement("button");const u=document.createElement("img");u.style.height="30px",u.src=oi.PLAYTEST,this.playtest.appendChild(u),this.playtest.onclick=()=>{this.manager.chartManager.setMode(Ot.Play)};const d=document.createElement("div");d.classList.add("playback-seperator"),this.timeCounter=document.createElement("div"),this.timeCounter.classList.add("playback-counter");const m=document.createElement("div");m.style.display="flex",m.classList.add("playback-counter-main");const l=document.createElement("div");l.classList.add("inlineEdit"),l.innerText="-",l.spellcheck=!1,l.contentEditable="true",l.onkeydown=Y=>{uo(Y)||Y.preventDefault(),Y.key=="Enter"&&l.blur(),Y.key=="Tab"&&f.focus(),Y.key=="Escape"&&(l.innerText=Math.floor(Math.abs(this.manager.chartManager.getTime())/60).toString().padStart(2,"0"),l.blur())},l.onfocus=()=>this.selectText(l),l.onblur=()=>this.updateTime(),l.ondragstart=Y=>Y.preventDefault();const f=document.createElement("div");f.classList.add("inlineEdit"),f.innerText="-",f.spellcheck=!1,f.contentEditable="true",f.onkeydown=Y=>{uo(Y)||Y.preventDefault(),Y.key=="Enter"&&f.blur(),Y.key=="Tab"&&p.focus(),Y.key=="Escape"&&(f.innerText=Math.floor(Math.abs(this.manager.chartManager.getTime())%60).toString().padStart(2,"0"),f.blur())},f.onfocus=()=>this.selectText(f),f.onblur=()=>this.updateTime(),f.ondragstart=Y=>Y.preventDefault();const p=document.createElement("div");p.classList.add("inlineEdit"),p.innerText="-",p.spellcheck=!1,p.contentEditable="true",p.onkeydown=Y=>{uo(Y)||Y.preventDefault(),Y.key=="Enter"&&p.blur(),Y.key=="Tab"&&l.focus(),Y.key=="Escape"&&(p.innerText=(he(Math.abs(this.manager.chartManager.getTime())%1,3)*1e3).toString().padStart(3,"0"),p.blur())},p.onfocus=()=>this.selectText(p),p.onblur=()=>this.updateTime(),p.ondragstart=Y=>Y.preventDefault(),this.min=l,this.sec=f,this.millis=p;const y=document.createElement("div");y.classList.add("playback-counter-label"),y.innerText="Time",m.appendChild(l),m.appendChild(document.createTextNode(":")),m.appendChild(f),m.appendChild(document.createTextNode(".")),m.appendChild(p),this.timeCounter.appendChild(m),this.timeCounter.appendChild(y);const v=document.createElement("div");v.classList.add("playback-seperator"),this.beatCounter=document.createElement("div"),this.beatCounter.classList.add("playback-counter");const _=document.createElement("div");_.classList.add("playback-counter-main","inlineEdit"),_.innerText="-",_.spellcheck=!1,_.contentEditable="true",_.onkeydown=Y=>{if(uo(Y)||Y.preventDefault(),Y.key=="Enter"&&_.blur(),Y.key=="Escape"){if(this.beatDropdown.value=="Measure"){const j=this.manager.chartManager.loadedChart?.timingData?.getMeasure(this.manager.chartManager.getBeat())??this.manager.chartManager.getBeat()/4;_.innerText=he(j,3).toFixed(3)}else _.innerText=he(this.manager.chartManager.getBeat(),3).toFixed(3);_.blur()}},_.onfocus=()=>{this.selectText(_)},_.onblur=()=>this.updateBeat(),_.ondragstart=Y=>Y.preventDefault(),this.beat=_,this.beatDropdown=is.create(["Beat","Measure"],"Beat"),this.beatDropdown.view.querySelector(".dropdown-selected").classList.add("playback-counter-label"),this.beatCounter.appendChild(_),this.beatCounter.appendChild(this.beatDropdown.view),this.beatDropdown.onChange(()=>{if(this.beatDropdown.value=="Measure"){const Y=this.manager.chartManager.loadedChart?.timingData?.getMeasure(this.manager.chartManager.getBeat())??this.manager.chartManager.getBeat()/4;_.innerText=he(Y,3).toFixed(3)}else _.innerText=he(this.manager.chartManager.getBeat(),3).toFixed(3)}),this.playbackBar.appendChild(this.skipStart),this.playbackBar.appendChild(this.skipEnd),this.playbackBar.appendChild(this.play),this.playbackBar.appendChild(this.record),this.playbackBar.appendChild(this.playtest),this.playbackBar.appendChild(d),this.playbackBar.appendChild(this.timeCounter),this.playbackBar.appendChild(v),this.playbackBar.appendChild(this.beatCounter),this.editSteps=document.createElement("button"),this.editSteps.classList.add("edit-fancy-button");const w=document.createElement("img");w.src=oi.ADD,this.editSteps.appendChild(w),this.editSteps.appendChild(document.createTextNode("Edit Steps")),this.editTiming=document.createElement("button"),this.editTiming.classList.add("edit-fancy-button");const T=document.createElement("img");T.src=oi.SPEED,this.editTiming.appendChild(T),this.editTiming.appendChild(document.createTextNode("Edit Timing")),this.editTiming.onclick=()=>{this.manager.chartManager.editingTiming=!this.manager.chartManager.editingTiming};const E=document.createElement("div");E.classList.add("playback-seperator");const R=document.createElement("div");R.classList.add("edit-bar-left"),R.appendChild(this.editSteps),R.appendChild(this.editTiming),R.appendChild(E),this.editBar.appendChild(R),this.editChoiceContainer=document.createElement("div"),this.editChoiceContainer.classList.add("edit-choice-container"),this.stepsContainer=document.createElement("div"),this.stepsContainer.classList.add("edit-steps-container"),this.timingContainer=document.createElement("div"),this.timingContainer.classList.add("edit-timing-container"),this.editChoiceContainer.appendChild(this.stepsContainer),this.editChoiceContainer.appendChild(this.timingContainer),this.editBar.appendChild(this.editChoiceContainer);const H=document.createElement("div");H.classList.add("note-placeholder-right"),this.stepsContainer.appendChild(H),ve.on("resize",()=>{this.trackingMovement=!0,this.idleFrames=5}),ve.on("chartLoaded",()=>{this.stepsContainer.replaceChildren(),this.noteArrows.forEach(j=>{this.removeChild(j.sprite),this.removeChild(j.bg)}),this.noteArrows=[];const Y=document.createElement("div");if(Y.classList.add("note-placeholder-right"),this.stepsContainer.appendChild(Y),!!this.manager.chartManager.loadedChart){for(const j of this.manager.chartManager.loadedChart.gameType.editNoteTypes){const et=this.manager.chartManager.chartView.notefield.getNoteSprite({type:j,beat:0,col:0});et.width=32,et.height=32;const J=new Ie(Ht.WHITE);J.tint=0,J.alpha=.5,J.width=48,J.height=48,J.anchor.set(.5);const rt=document.createElement("button");rt.style.height="48px",rt.style.width="48px",rt.classList.add("note-placeholder"),rt.onclick=()=>{this.manager.chartManager.setEditingNoteType(j)};const gt={element:rt,sprite:et,type:j,bg:J,hovered:!1};rt.onmouseover=()=>{gt.hovered=!0},rt.onmouseleave=()=>{gt.hovered=!1},this.addChild(J),this.addChild(et);const X=rt.getBoundingClientRect();et.position.y=X.top-this.manager.app.view.clientHeight/2-this.manager.app.view.getBoundingClientRect().top+24,et.position.x=X.left-this.manager.app.view.clientWidth/2+24,J.position=et.position,this.noteArrows.push(gt)}this.stepsContainer.replaceChildren(...this.noteArrows.map(j=>j.element),Y),this.trackingMovement=!0,this.idleFrames=5}}),this.noteArrowMask=new Ie(Ht.WHITE),this.noteArrowMask.height=48,this.noteArrowMask.width=2500,this.noteArrowMask.anchor.y=1,this.noteArrowMask.anchor.x=.5,this.addChild(this.noteArrowMask),this.mask=this.noteArrowMask,r.onmouseenter=()=>{this.lastHover=Date.now(),this.hovering=!0,this.view.style.opacity="",this.view.style.transition=""},r.onmouseleave=()=>this.hovering=!1,r.appendChild(this.playbackBar),r.appendChild(this.editBar),this.view=r,r.style.display="none"}update(){this.view.style.display=this.manager.chartManager.loadedSM?"":"none";const e=this.manager.chartManager.getTime();this.lastTime!=e&&(document.activeElement!=this.min&&(this.min.innerText=Math.floor(Math.abs(e)/60).toString().padStart(2,"0")),document.activeElement!=this.sec&&(this.sec.innerText=Math.floor(Math.abs(e)%60).toString().padStart(2,"0")),document.activeElement!=this.millis&&(this.millis.innerText=(he(Math.abs(e)%1,3)*1e3).toString().padStart(3,"0")),this.lastTime=e);const r=this.manager.chartManager.getBeat();if(this.lastBeat!=r){if(document.activeElement!=this.beat)if(this.beatDropdown.value=="Measure"){const o=this.manager.chartManager.loadedChart?.timingData?.getMeasure(r)??r/4;this.beat.innerText=he(o,3).toFixed(3)}else this.beat.innerText=he(r,3).toFixed(3);this.lastBeat=r}const n=this.manager.chartManager.getMode();if(this.lastMode!=n){switch(n){case Ot.Edit:case Ot.View:this.skipStart.disabled=!1,this.skipEnd.disabled=!1,this.record.disabled=!1,this.playtest.disabled=!1,this.min.contentEditable="true",this.sec.contentEditable="true",this.millis.contentEditable="true",this.beat.contentEditable="true",this.record.style.background="",this.playtest.style.background="",this.view.style.opacity="",this.view.style.transition="",this.view.classList.remove("collapsed"),this.beatDropdown.disabled=!1;break;case Ot.Record:this.lastHover=Date.now(),this.skipStart.disabled=!0,this.skipEnd.disabled=!0,this.record.disabled=!1,this.record.style.background="rgba(170, 0, 0, 0.35)",this.playtest.disabled=!0,this.min.contentEditable="false",this.sec.contentEditable="false",this.millis.contentEditable="false",this.beat.contentEditable="false",this.view.classList.add("collapsed"),this.beatDropdown.closeDropdown(),this.beatDropdown.disabled=!0;break;case Ot.Play:this.lastHover=Date.now(),this.skipStart.disabled=!0,this.skipEnd.disabled=!0,this.record.disabled=!0,this.playtest.disabled=!1,this.playtest.style.background="rgba(12, 97, 31, 0.35)",this.min.contentEditable="false",this.sec.contentEditable="false",this.millis.contentEditable="false",this.beat.contentEditable="false",this.view.classList.add("collapsed"),this.beatDropdown.closeDropdown(),this.beatDropdown.disabled=!0}this.trackingMovement=!0,this.idleFrames=5,this.lastMode=n}const s=this.manager.chartManager.chartAudio.isPlaying();if(this.lastPlaying!=s&&(this.playIcon.src=s?oi.STOP:oi.PLAY,this.lastPlaying=s),this.playIcon.style.height=this.manager.chartManager.chartAudio.isPlaying()?"28px":"",(n==Ot.Play||n==Ot.Record)&&this.view.style.opacity==""&&!this.hovering&&Date.now()-this.lastHover>3e3&&(this.view.style.opacity="0.2",this.view.style.transition="2s cubic-bezier(.11,.72,.51,1.14)"),this.trackingMovement){const o=this.noteArrows[0];if(o){const d=o.element.getBoundingClientRect();this.noteArrows.forEach((m,l)=>{m.sprite.position.y=d.top-this.manager.app.view.clientHeight/2-this.manager.app.view.getBoundingClientRect().top+24,m.sprite.position.x=d.left-this.manager.app.view.clientWidth/2+24+l*48,m.bg.position=m.sprite.position}),this.lastBounds&&Math.abs(this.lastBounds.top-d.top)+Math.abs(this.lastBounds.left-d.left)==0&&(this.idleFrames--,this.idleFrames<0&&(this.trackingMovement=!1,this.lastBounds=void 0)),this.lastBounds=d}const u=this.view.getBoundingClientRect();this.noteArrowMask.y=u.bottom-this.manager.app.view.clientHeight/2-this.manager.app.view.getBoundingClientRect().top}const a=this.manager.chartManager.getEditingNoteType();this.noteArrows.forEach(o=>{if(W.general.smoothAnimations){const u=a==o.type?1:o.hovered?.4:.2;o.sprite.alpha=(u-o.sprite.alpha)*.3+o.sprite.alpha}else o.sprite.alpha=a==o.type?1:o.hovered?.4:.2})}selectText(e){const r=window.getSelection(),n=document.createRange();!r||!n||(n.selectNodeContents(e),r.removeAllRanges(),r.addRange(n))}updateTime(){this.millis.innerText=this.millis.innerText.padEnd(3,"0").slice(0,3);let e=this.safeParse(this.min)*60+this.safeParse(this.sec)+this.safeParse(this.millis)/1e3;e>9999999&&(e=9999999),this.manager.chartManager.setTime(e)}updateBeat(){let e=this.safeParse(this.beat);this.beatDropdown.value=="Measure"&&(e=this.manager.chartManager.loadedChart?.timingData?.getBeatFromMeasure(e)??e*4),e>9999999&&(e=9999999),this.manager.chartManager.setBeat(e)}safeParse(e){try{const r=Os.evaluate(e.innerText);return!isFinite(r)||r<0?0:r}catch{return 0}}}class wR extends be{constructor(e){super();P(this,"app");P(this,"chartManager");P(this,"children",[]);this.app=e.app,this.chartManager=e,this.addChild(new gR(this)),this.addChild(new vR(this)),this.addChild(new _R(this)),this.zIndex=2}update(){this.x=this.app.renderer.screen.width/2,this.y=this.app.renderer.screen.height/2,this.children.forEach(e=>e.update())}startPlay(){this.children.forEach(e=>e.startPlay())}endPlay(){this.children.forEach(e=>e.endPlay())}}const g0={"dance-single":[{label:"Left",col:0,keybinds:[{key:"Left",mods:[]},{key:"A",mods:[]}]},{label:"Down",col:1,keybinds:[{key:"Down",mods:[]},{key:"S",mods:[]}]},{label:"Up",col:2,keybinds:[{key:"Up",mods:[]},{key:"W",mods:[]}]},{label:"Right",col:3,keybinds:[{key:"Right",mods:[]},{key:"D",mods:[]}]}],"dance-double":[{label:"Left",col:4,keybinds:[{key:"Left",mods:[]}]},{label:"Down",col:5,keybinds:[{key:"Down",mods:[]}]},{label:"Up",col:6,keybinds:[{key:"Up",mods:[]}]},{label:"Right",col:7,keybinds:[{key:"Right",mods:[]}]},{label:"Left",col:0,keybinds:[{key:"A",mods:[]}]},{label:"Down",col:1,keybinds:[{key:"S",mods:[]}]},{label:"Up",col:2,keybinds:[{key:"W",mods:[]}]},{label:"Right",col:3,keybinds:[{key:"D",mods:[]}]}],"dance-solo":[{label:"Left",col:0,keybinds:[{key:"Left",mods:[]},{key:"A",mods:[]}]},{label:"UpLeft",col:1,keybinds:[{key:"Q",mods:[]}]},{label:"Down",col:2,keybinds:[{key:"Down",mods:[]},{key:"S",mods:[]}]},{label:"Up",col:3,keybinds:[{key:"Up",mods:[]},{key:"W",mods:[]}]},{label:"UpRight",col:4,keybinds:[{key:"E",mods:[]}]},{label:"Right",col:5,keybinds:[{key:"Right",mods:[]},{key:"D",mods:[]}]}]},ic=["ctrlKey","altKey","shiftKey","metaKey"],rc=[bh.CTRL,bh.ALT,bh.SHIFT,bh.META];class Mo{constructor(t){P(this,"app");this.app=t,window.addEventListener("keydown",e=>{if(e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||["Meta","Control","Shift","Alt"].includes(e.key))return;const r=[];for(let a=0;a<ic.length;a++)e[ic[a]]&&r.push(rc[a]);const n=Mo.getKeyNameFromCode(e.code);if((t.chartManager.getMode()==Ot.Play||t.chartManager.getMode()==Ot.Record)&&t.chartManager.loadedChart?.gameType){const a=g0[t.chartManager.loadedChart?.gameType.id]??[],o=Object.values(a).filter(u=>{for(const d of u.keybinds)if(this.compareModifiers(d.mods,r)&&d.key==n)return!0;return!1});if(o.length>0){if(e.preventDefault(),t.windowManager.isBlocked())return;for(const u of o)if(!e.repeat){t.chartManager.judgeCol(u.col);return}}}const s=Object.values(Is).filter(a=>{for(const o of a.keybinds)if(this.compareModifiers(o.mods,r)&&o.key==n)return!0;return!1});if(s.length>0){if(s.every(a=>a.preventDefault!=!1)&&e.preventDefault(),t.windowManager.isBlocked())return;for(const a of s){let o=a.disabled;if(o instanceof Function&&(o=o(this.app)),!o&&!(a.disableRepeat&&e.repeat)){a.callback(this.app);return}}}}),window.addEventListener("keyup",e=>{if(e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||["Meta","Control","Shift","Alt"].includes(e.key))return;const r=[];for(let a=0;a<ic.length;a++)e[ic[a]]&&r.push(rc[a]);const n=Mo.getKeyNameFromCode(e.code);if((t.chartManager.getMode()==Ot.Play||t.chartManager.getMode()==Ot.Record)&&t.chartManager.loadedChart?.gameType){const a=g0[t.chartManager.loadedChart?.gameType.id]??[],o=Object.values(a).filter(u=>{for(const d of u.keybinds)if(this.compareModifiers(d.mods,r)&&d.key==n)return!0;return!1});if(o.length>0){if(e.preventDefault(),t.windowManager.isBlocked())return;for(const u of o)if(!e.repeat){t.chartManager.judgeColUp(u.col);return}}}const s=Object.values(Is).filter(a=>{for(const o of a.keybinds)if(this.compareModifiers(o.mods,r)&&o.key==n)return!0;return!1});if(s.length>0){s.every(a=>a.preventDefault!=!1)&&e.preventDefault();for(const a of s){let o=a.disabled;if(o instanceof Function&&(o=o(this.app)),!o&&!(a.disableRepeat&&e.repeat)){a.callbackKeyUp?.(this.app);return}}}})}static getKeyNameFromCode(t){let e=t;return e.startsWith("Digit")&&(e=e.slice(5)),e.startsWith("Key")&&(e=e.slice(3)),e in m0&&(e=m0[e]),e}static getKeybindString(t){return t in Is?Is[t].keybinds.map(r=>{const n=rc.filter(s=>r.mods.includes(s)).map(s=>pR[s]).join("");return n+(n!=""?" ":"")+r.key}).join(" / "):(console.log("Couldn't find keybind with id "+t),"")}compareModifiers(t,e){if(t.length!=e.length)return!1;for(const r of rc)if((t.includes(r)?1:0)+(e.includes(r)?1:0)==1)return!1;return!0}}class wo{static time(t){this.timers[t]||(this.timers[t]={name:t,time:0,startTime:0,lastTime:0}),this.timers[t].startTime=performance.now()}static endTime(t){!this.timers[t]||(this.timers[t].time+=performance.now()-this.timers[t].startTime)}static endFrame(){for(const t in this.timers)this.timers[t].lastTime=this.timers[t].time,this.timers[t].time=0}static getTimers(){return Object.values(this.timers)}}P(wo,"timers",{});class nc{constructor(t){P(this,"_audioContext",new AudioContext);P(this,"_audioAnalyzer");P(this,"_freqData");P(this,"_gainNode");P(this,"_source");P(this,"_playbackTime",0);P(this,"_startTimestamp",0);P(this,"_rate",1);P(this,"_isPlaying",!1);P(this,"_buffer");P(this,"_delay");P(this,"_listeners",[]);P(this,"_volume",1);P(this,"_destroyed",!1);P(this,"loaded");this._audioAnalyzer=this._audioContext.createAnalyser(),this._audioAnalyzer.fftSize=8192,this._audioAnalyzer.maxDecibels=0,this._freqData=new Uint8Array(this._audioAnalyzer.frequencyBinCount),this._gainNode=this._audioContext.createGain(),this._buffer=this._audioContext.createBuffer(2,1,44100),this.initSource(),this.loaded=new Promise(e=>{this.decodeData(t).then(r=>{if(!!r)return r}).then(r=>this.renderBuffer(r)).catch(r=>{r.name=="EncodingError"?Fe.createFormatted("Failed to load audio: file format not supported","error"):Fe.createFormatted("Failed to load audio: "+r.message,"error")}).finally(()=>{this.initSource(),this.callListeners(),e()})})}async renderBuffer(t){if(!t)return;const e=new OfflineAudioContext(t.numberOfChannels,t.length,t.sampleRate),r=e.createBufferSource();return r.buffer=t,r.connect(e.destination),r.start(),await e.startRendering().then(n=>{this._buffer=n}).catch(()=>{Fe.createFormatted("Failed to load audio: audio rendering failed","error")})}bindWaveform(t){this._listeners.push(t)}getSongLength(){return this._buffer.length/this._buffer.sampleRate}getFrequencyData(){return this._destroyed?new Uint8Array:(this._audioAnalyzer.getByteFrequencyData(this._freqData),this._freqData)}getSampleRate(){return this._buffer.sampleRate}getFFTSize(){return this._audioAnalyzer.fftSize}getRawData(){if(this._destroyed)return[];const t=[];for(let e=0;e<this._buffer.numberOfChannels;e++)t.push(this._buffer.getChannelData(e));return t}isPlaying(){return this._destroyed?!1:this._isPlaying}destroy(){this._destroyed||(this.stop(),this._buffer=this._audioContext.createBuffer(2,1,44100),this._listeners=[],clearTimeout(this._delay),this._destroyed=!0)}callListeners(){this._listeners.forEach(t=>t.refilter())}async decodeData(t){return new Promise((e,r)=>{if(!t){e();return}this._audioContext.decodeAudioData(t).then(n=>e(n)).catch(n=>r(n))})}initSource(){this._source=this._audioContext.createBufferSource(),this._source.buffer=this._buffer,this._source.connect(this._audioAnalyzer),this._audioAnalyzer.connect(this._gainNode),this._gainNode.connect(this._audioContext.destination),this._source.playbackRate.value=this._rate,this._isPlaying&&(this.pause(),this.play())}volume(t){this._destroyed||this._volume!=t&&(this._volume=t,this._gainNode.gain.setValueAtTime(t,this._audioContext.currentTime))}rate(t){this._destroyed||this._rate!=t&&(this._rate=t,this._source&&(this._isPlaying&&(this._playbackTime+=(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value),this._startTimestamp=this._audioContext.currentTime,this._source.playbackRate.value=t))}play(){this._destroyed||!this._source||this._isPlaying||(this.initSource(),this._playbackTime<=this._buffer.duration&&(this._playbackTime<0?(clearTimeout(this._delay),this._delay=setInterval(()=>{this.seek()>0&&(clearInterval(this._delay),this._source?.start(0,0))})):this._source.start(0,this._playbackTime)),this._startTimestamp=this._audioContext.currentTime,this._isPlaying=!0)}seek(t){if(!this._destroyed&&!!this._source){if(t===void 0)return this._isPlaying?(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value+this._playbackTime:this._playbackTime;this._isPlaying?(this.stop(),this._playbackTime=t,this.play()):this._playbackTime=t}}pause(){this._destroyed||this.stop(!0)}stop(t){if(!this._destroyed&&!!this._source&&!!this._isPlaying){if(clearTimeout(this._delay),this._isPlaying=!1,this._playbackTime<=this._buffer.duration)try{this._source.stop()}catch{}this._playbackTime=t?(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value+this._playbackTime:0}}}const bR=200,xR={fontName:"Main",fontSize:20,fill:["#ffffff"]};class AR extends be{constructor(e){super();P(this,"children",[]);P(this,"renderer");P(this,"barlineMap",new Map);P(this,"barlineLabelMap",new Map);this.renderer=e;const r=()=>{this.removeChildren(),this.barlineMap.clear(),this.barlineLabelMap.clear()};ve.on("timeSigChanged",r),this.on("destroyed",()=>[ve.off("timeSigChanged",r)])}update(e,r,n){this.visible=this.renderer.chartManager.getMode()!=Ot.Play||!W.play.hideBarlines,this.children.forEach(v=>v.marked=!1);const s=this.renderer.chart.timingData,a=s.getTimingData("TIMESIGNATURES");let o=s.getTimingEventAtBeat("TIMESIGNATURES",r),u=o?a.indexOf(o):-1,d=s.getDivisionLength(r);const m=s.getDivisionOfMeasure(r)%1*d;let l=Math.max(0,r-m),f=Math.round(s.getDivisionOfMeasure(l)),p=o?.upper??4;const y=()=>{f++,f%=p,l+=d,u!=-1&&l>=a[u+1]?.beat&&(u++,o=a[u],l=o.beat,d=s.getDivisionLength(l),f=0,p=o.upper)};for(;l<n&&!(this.barlineMap.size>bR);){if(W.chart.CMod&&this.renderer.chart.isBeatWarped(l)){y();continue}const[v,_,w]=this.checkBounds(l,e);if(_)break;if(v){y();continue}const T=this.getBarline(l,f%p==0);if(T.y=w,T.marked=!0,T.deactivated=!1,T.dirtyTime=Date.now(),f%p==0){const E=this.getBarlineLabel(l);E.y=w,E.marked=!0,E.deactivated=!1,E.dirtyTime=Date.now(),E.scale.y=W.chart.reverse?-1:1}y()}this.children.filter(v=>!v.deactivated&&!v.marked).forEach(v=>{v.deactivated=!0,v.visible=!1,v.type=="barline"&&this.barlineMap.delete(v.beat),v.type=="label"&&this.barlineLabelMap.delete(v.beat)}),Ci(this.children,v=>Date.now()-v.dirtyTime>5e3)}checkBounds(e,r){const n=this.renderer.getYPos(e);return n<this.renderer.getUpperBound()?[!0,!1,n]:n>this.renderer.getLowerBound()?e<r||this.renderer.isNegScroll(e)?[!0,!1,n]:[!0,!0,n]:[!1,!1,n]}getBarline(e,r){if(this.barlineMap.get(e))return this.barlineMap.get(e);let n;for(const s of this.children)s.type=="barline"&&s.deactivated&&(n=s);return n||(n=new Ie(Ht.WHITE),this.addChild(n)),n.type="barline",n.beat=e,n.anchor.x=.5,n.anchor.y=.5,n.width=this.renderer.chart.gameType.notefieldWidth+128,n.height=r?4:1,n.visible=!0,this.barlineMap.set(e,n),n}getBarlineLabel(e){if(this.barlineLabelMap.get(e))return this.barlineLabelMap.get(e);let r;for(const n of this.children)n.type=="label"&&n.deactivated&&(r=n);return r||(r=new Je("",xR),this.addChild(r)),r.type="label",r.beat=e,r.deactivated=!1,r.marked=!0,r.anchor.x=1,r.anchor.y=.5,r.x=(this.renderer.chart.gameType.notefieldWidth+128)/-2-16,r.visible=!0,r.text=`${Math.round(this.renderer.chart.timingData.getMeasure(e))}`,this.barlineLabelMap.set(e,r),r}}class ER extends Je{constructor(e){super("",{fontName:"Fancy"});P(this,"renderer");this.y=50,this.anchor.set(.5),this.renderer=e}update(){const e=this.renderer.chartManager.gameStats;if(this.visible=this.renderer.chartManager.getMode()==Ot.Play,this.scale.y=W.chart.reverse?-1:1,!e)return;const r=e.getCombo()==0?e.getMissCombo():e.getCombo();r<4?this.text="":this.text=r+"",e.getCombo()==0?this.tint=di.getCollection(W.play.timingCollection).getMissJudgment().color:e.getBestJudge()?this.tint=Ck(e.getBestJudge().color,Math.sin(Date.now()/225)*.2+1.2):this.tint=16777215}}class TR extends Ie{constructor(){super();P(this,"createTime",-1);P(this,"active",!1);P(this,"type",mv);this.y=-40,this.anchor.set(.5)}update(){if(this.visible=this.active,this.active){const e=(Date.now()-this.createTime)/1e3;let r=1.2;if(di.getCollection(W.play.timingCollection).shouldHideNote(this.type)||(r=.8),e<.1){const n=1-(1-e/.1)*(1-e/.1),s=(1-r)*n+r;this.scale.x=.4*s,this.scale.y=.4*s*(W.chart.reverse?-1:1)}else if(e>.6&&e<.8){const n=(e-.6)/.2*(e-.6)/.2;this.scale.x=.4*(1-n),this.scale.y=.4*(1-n)*(W.chart.reverse?-1:1)}else e>.8&&(this.active=!1)}}doJudge(e,r){if(!va(r)&&!Jn(r))return;const n=r.judgmentTexture.getTexture(e,r);!n||(this.texture=n,this.texture.updateUvs(),this.active=!0,this.type=r,this.createTime=Date.now(),W.play.judgmentTilt?this.rotation=or(e,-.05,.05)*300/180*Math.PI:this.rotation=0)}reset(){this.active=!1}}class SR extends be{constructor(e){super();P(this,"startMarker",new Ie(Ht.WHITE));P(this,"selectionArea",new Ie(Ht.WHITE));P(this,"renderer");this.renderer=e,this.startMarker.alpha=0,this.selectionArea.alpha=0,this.addChild(this.selectionArea,this.startMarker),this.selectionArea.tint=5140387,this.startMarker.anchor.set(.5),this.selectionArea.anchor.x=.5,this.startMarker.height=64,this.selectionArea.height=64,this.selectionArea.width=this.renderer.chart.gameType.notefieldWidth,this.startMarker.width=this.renderer.chart.gameType.notefieldWidth}update(){if(this.renderer.chartManager.getMode()==Ot.Play){this.visible=!1;return}this.visible=!0;const e=this.renderer.chartManager.startRegion,r=this.renderer.chartManager.endRegion;e&&!r?(this.startMarker.alpha=Math.sin(Date.now()/320)*.1+.3,this.startMarker.y=this.renderer.getYPos(e)):this.startMarker.alpha=0,e&&r?(this.selectionArea.alpha=Math.sin(Date.now()/320)*.1+.3,this.selectionArea.y=this.renderer.getYPos(Math.min(e,r)),this.selectionArea.height=this.renderer.getYPos(Math.max(e,r))-this.selectionArea.y):this.selectionArea.alpha=0}}const CR={fontName:"Main",fontSize:10,fill:["#ffffff"]},MR={4:15157287,8:4033015,12:11152884,16:8577607,24:11152884,32:15376696,48:11152884,64:7071886,96:7071886,192:7071886};class IR extends be{constructor(e){super();P(this,"renderer");P(this,"children",[]);this.renderer=e;for(let r=0;r<2;r++){const n=new be,s=new Bo,a=new Je("4",CR);n.x=(r-.5)*(this.renderer.chart.gameType.notefieldWidth+48),s.rotation=Math.PI/4,s.lineStyle(1,0,1),s.beginFill(16777215),s.drawRect(-12,-12,24,24),s.endFill(),a.anchor.set(.5),n.addChild(s),n.addChild(a),this.addChild(n)}}update(){this.y=W.chart.receptorYPos/W.chart.zoom,this.visible=this.renderer.chartManager.getMode()==Ot.Edit||this.renderer.chartManager.getMode()==Ot.Record;for(let e=0;e<2;e++){const r=this.children[e],n=r.children[0];n.tint=MR[4/W.chart.snap]??7368816;const s=r.children[1];s.text=""+(W.chart.snap==0||4/W.chart.snap%1!=0?"":4/W.chart.snap),s.scale.y=W.chart.reverse?-1:1}}}const Av={BPMS:6689568,STOPS:10395910,DELAYS:434902,WARPS:8391509,FAKES:8947848,COMBOS:1006629,SPEEDS:2968693,LABELS:7222045,SCROLLS:1449797,TIMESIGNATURES:7694657,TICKCOUNTS:3382327,BGCHANGES:11358492,FGCHANGES:13578285,ATTACKS:573320};class BR extends be{constructor(e){super();P(this,"children",[]);P(this,"renderer");P(this,"timingAreaMap",new Map);this.renderer=e}update(e,r,n,s){this.visible=this.renderer.chartManager.getMode()!=Ot.Play||!W.play.hideBarlines,this.children.forEach(a=>a.marked=!1);for(const a of this.renderer.chart.timingData.getTimingData("STOPS","WARPS","DELAYS","FAKES")){if(!W.chart.renderTimingEvent[a.type]||(a.type=="STOPS"||a.type=="DELAYS")&&a.second+Math.abs(a.value)<=s||(a.type=="WARPS"||a.type=="FAKES")&&a.beat+a.value<r)continue;if(a.beat>n)break;if((a.type=="STOPS"||a.type=="DELAYS")&&!(!W.chart.CMod&&a.value<0||W.chart.CMod&&a.value>0)||a.type=="WARPS"&&W.chart.CMod)continue;const[o,u,d,m]=this.checkBounds(a,e);if(u)break;if(o)continue;const l=this.getTimingArea(a);l.y=d,l.height=m,l.marked=!0,l.dirtyTime=Date.now()}this.children.filter(a=>!a.deactivated&&!a.marked).forEach(a=>{a.deactivated=!0,a.visible=!1,this.timingAreaMap.delete(a.event)}),Ci(this.children,a=>Date.now()-a.dirtyTime>5e3)}checkBounds(e,r){const n=W.chart.CMod?this.renderer.getYPosFromTime(e.second):this.renderer.getYPos(e.beat);let s=n;switch(e.type){case"STOPS":case"DELAYS":{W.chart.CMod&&e.value>0?s=this.renderer.getYPosFromTime(e.second+e.value):e.value<0&&(s=this.renderer.getYPos(this.renderer.chart.getBeatFromSeconds(e.second+1e-4)));break}case"FAKES":{s=this.renderer.getYPos(e.beat+e.value);break}case"WARPS":{W.chart.CMod||(s=this.renderer.getYPos(e.beat+e.value));break}}const a=s-n;return n+a<this.renderer.getUpperBound()?[!0,!1,n,a]:n>this.renderer.getLowerBound()?e.beat<r||this.renderer.isNegScroll(e.beat)?[!0,!1,n,a]:[!0,!0,n,a]:[!1,!1,n,a]}getTimingArea(e){if(this.timingAreaMap.get(e))return this.timingAreaMap.get(e);let r;for(const n of this.children)if(n.deactivated){n.deactivated=!1,r=n;break}return r||(r=new Ie(Ht.WHITE),this.addChild(r)),r.event=e,r.deactivated=!1,r.marked=!0,r.anchor.x=.5,r.anchor.y=0,r.width=this.renderer.chart.gameType.notefieldWidth+128,r.visible=!0,r.tint=Av[e.type],r.alpha=.2,this.timingAreaMap.set(e,r),r}}const kR=1,y0=15,RR={fontName:"Fancy",fontSize:12};class PR extends be{constructor(e){super();P(this,"barlines",new be);P(this,"barline");P(this,"currentMedian");P(this,"errorText",new Je("",RR));P(this,"errorTextTime",-1);P(this,"renderer");P(this,"target",0);this.y=10,this.renderer=e,this.barline=new Ie(Ht.WHITE),this.barline.anchor.set(.5),this.barline.height=1,this.barline.alpha=.5;const r=new Ie(Ht.WHITE);r.width=2,r.height=y0,r.anchor.set(.5),this.currentMedian=new Bo,this.currentMedian.beginFill(16777215),this.currentMedian.moveTo(0,-10),this.currentMedian.lineTo(5,-15),this.currentMedian.lineTo(-5,-15),this.currentMedian.lineTo(0,-10),this.errorText.y=-25,this.errorText.anchor.set(.5),this.addChild(this.barline),this.addChild(r),this.addChild(this.barlines),this.addChild(this.currentMedian),this.addChild(this.errorText)}update(){this.visible=this.renderer.chartManager.getMode()==Ot.Play;for(const e of this.barlines.children){const r=e,n=(Date.now()-r.createTime)/5e3;n<.05?e.alpha=1:n<.3?e.alpha=co(1,.2,(n-.05)/.25):n<.9?e.alpha=.2:e.alpha=(1-n)*3}this.errorText.alpha=or((2e3-(Date.now()-this.errorTextTime))/1e3,0,1),this.barline.width=di.getCollection(W.play.timingCollection).maxWindowMS()/1e3*2*400,Ci(this.barlines.children,e=>Date.now()-e.createTime>5e3),W.general.smoothAnimations?this.currentMedian.x=(this.currentMedian.x-this.target)*.8+this.target:this.currentMedian.x=this.target,this.errorText.scale.y=W.chart.reverse?-1:1,this.errorText.y=W.chart.reverse?25:-25,this.currentMedian.scale.y=W.chart.reverse?-1:1}addBar(e,r){if(!Jn(r)&&!va(r))return;const n=new Ie(Ht.WHITE);n.width=kR,n.height=y0,n.anchor.set(.5),n.x=e*400,n.tint=r.color,n.createTime=Date.now(),n.miss=Jn(r),n.ms=Math.round(e*1e3),this.errorText.tint=r.color,this.errorText.text=(e*1e3).toFixed(1)+"ms",this.errorTextTime=Date.now(),this.barlines.addChild(n),this.target=Uf(this.barlines.children.filter(s=>!s.miss).map(s=>s.ms))*.4}reset(){this.currentMedian.x=0,this.target=0,Ci(this.barlines.children,()=>!0)}}const DR={fontName:"Main",fontSize:15},gh={BPMS:55,STOPS:55,DELAYS:55,WARPS:55,FAKES:55,COMBOS:40,SPEEDS:80,LABELS:80,SCROLLS:55,TIMESIGNATURES:40,TICKCOUNTS:40,BGCHANGES:55,FGCHANGES:55,ATTACKS:55};class LR extends be{constructor(e){super();P(this,"tracks",new be);P(this,"boxes",new be);P(this,"renderer");P(this,"timingBoxMap",new Map);this.renderer=e,this.boxes.sortableChildren=!0,this.addChild(this.tracks),this.addChild(this.boxes)}update(e,r,n){this.boxes.visible=this.renderer.chartManager.getMode()!=Ot.Play||!W.play.hideBarlines;const s=W.chart.timingEventOrder.left,a=W.chart.timingEventOrder.right;for(const m of this.tracks.children)m.targetAlpha=0;let o=-this.renderer.chart.gameType.notefieldWidth*.5-128;for(let m=s.length-1;m>=0;m--){const l=s[m];let f=this.tracks.getChildByName(l);const p=!!f;if(!p){const y=new Ie(Ht.WHITE);y.width=gh[l],y.alpha=0,y.name=l,y.height=5e3,y.anchor.y=.5,f=y,this.tracks.addChild(f)}f.targetX=o,p||(f.x=o),f.targetAlpha=m%2==0?.1:0,f.anchor.x=1,f.tint=2503250,o-=gh[l]}o=this.renderer.chart.gameType.notefieldWidth*.5+128;for(let m=0;m<a.length;m++){const l=a[m];let f=this.tracks.getChildByName(l);const p=!!f;if(!p){const y=new Ie(Ht.WHITE);y.width=gh[l],y.alpha=0,y.name=l,y.height=5e3,y.anchor.y=.5,f=y,this.tracks.addChild(f)}f.targetX=o,p||(f.x=o),f.targetAlpha=m%2==0?.1:0,f.anchor.x=0,f.tint=2503250,o+=gh[l]}const u=this.renderer.chartManager.editingTiming&&this.renderer.chartManager.getMode()==Ot.Edit;for(const m of this.tracks.children)u||(m.targetAlpha=0),m.alpha=(m.alpha-m.targetAlpha)*.2+m.targetAlpha,m.position.x=(m.position.x-m.targetX)*.2+m.targetX;this.boxes.children.forEach(m=>m.marked=!1);const d={beat:-1e3,second:-1e3,leftOffset:0,rightOffset:0};for(const m of this.renderer.chart.timingData.getTimingData()){if(n<m.beat)break;if(!W.chart.timingEventOrder.left.includes(m.type)&&!W.chart.timingEventOrder.right.includes(m.type)||r>m.beat)continue;const[l,f,p]=this.checkBounds(m,e);if(f)break;if(l)continue;const y=this.getTimingBox(m),v=W.chart.timingEventOrder.right.includes(m.type)?"right":"left";if(u){let _=this.tracks.getChildByName(m.type)?.x??y.x;_+=gh[m.type]/2*(_>0?1:-1),y.targetX||(y.position.x=_),y.targetX=_,y.targetAnchor||(y.textObj.anchor.x=.5),y.targetAnchor=.5}else{let _=(v=="right"?1:-1)*(this.renderer.chart.gameType.notefieldWidth*.5+80);v=="left"&&(_-=30),(d.beat!=m.beat||m.second&&d.second!=m.second)&&(d.leftOffset=0,d.rightOffset=0),v=="left"&&(_-=d.leftOffset),v=="right"&&(_+=d.rightOffset),y.targetX||(y.position.x=_),y.targetX=_,v=="left"&&(d.leftOffset+=y.textObj.width+15),v=="right"&&(d.rightOffset+=y.textObj.width+15),d.beat=m.beat,d.second=m.second,y.targetAnchor||(y.textObj.anchor.x=v=="right"?0:1),y.targetAnchor=v=="right"?0:1}y.backgroundObj.tint=Av[m.type]??0,y.position.x=(y.targetX-y.position.x)*.2+y.position.x,y.textObj.anchor.x=(y.targetAnchor-y.textObj.anchor.x)*.2+y.textObj.anchor.x,y.backgroundObj.position.x=-5-y.textObj.width*y.textObj.anchor.x,y.y=p,y.marked=!0,y.dirtyTime=Date.now(),y.backgroundObj.position.y=W.chart.reverse?-14:-11,y.textObj.scale.y=W.chart.reverse?-1:1}this.boxes.children.filter(m=>!m.deactivated&&!m.marked).forEach(m=>{m.deactivated=!0,m.visible=!1,this.timingBoxMap.delete(m.event)}),Ci(this.boxes.children,m=>Date.now()-m.dirtyTime>5e3)}checkBounds(e,r){const n=W.chart.CMod&&e.second?this.renderer.getYPosFromTime(e.second):this.renderer.getYPos(e.beat);return n<this.renderer.getUpperBound()?[!0,!1,n]:n>this.renderer.getLowerBound()?e.beat<r||this.renderer.isNegScroll(e.beat)?[!0,!1,n]:[!0,!0,n]:[!1,!1,n]}getTimingBox(e){if(this.timingBoxMap.get(e))return this.timingBoxMap.get(e);let r;for(const s of this.boxes.children)if(s.deactivated){s.deactivated=!1,r=s;break}r||(r=new be,r.zIndex=e.beat,r.textObj=new Je("",DR),r.backgroundObj=new Yn,r.addChild(r.backgroundObj),r.addChild(r.textObj),this.boxes.addChild(r)),r.event=e,r.deactivated=!1,r.marked=!0,r.visible=!0,r.targetX=void 0,r.targetAnchor=void 0;let n="";switch(e.type){case"BPMS":case"STOPS":case"WARPS":case"DELAYS":case"TICKCOUNTS":case"FAKES":case"SCROLLS":n=he(e.value,3).toString();break;case"SPEEDS":n=`${he(e.value,3)}/${he(e.delay,3)}/${e.unit}`;break;case"LABELS":n=e.value;break;case"TIMESIGNATURES":n=`${he(e.upper,3)}/${he(e.lower,3)}`;break;case"COMBOS":n=`${he(e.hitMult,3)}/${he(e.missMult,3)}`;break;case"BGCHANGES":case"FGCHANGES":n=e.file;break;case"ATTACKS":n=`${e.mods} (${e.endType}=${e.value})`}return r.textObj.text=n,r.textObj.anchor.y=.5,r.visible=!0,r.backgroundObj.width=r.textObj.width+10,r.backgroundObj.height=25,r.zIndex=e.beat,this.timingBoxMap.set(e,r),r}}const OR=3500;class FR extends Ie{constructor(e){super();P(this,"lineContainer",new By(1500,{position:!0,scale:!0},16384,!0));P(this,"waveformTex");P(this,"lineTex",Di.create({width:16,height:16}));P(this,"chartAudio");P(this,"renderer");P(this,"white");P(this,"strippedWaveform");P(this,"lastReZoom");P(this,"lastZoom");P(this,"zoom");P(this,"poolSearch",0);P(this,"lastBeat",0);P(this,"lastTime",0);P(this,"lastHeight",0);P(this,"lastLineHeight",W.chart.waveform.lineHeight);this.renderer=e,this.waveformTex=Di.create({resolution:Math.min(1,W.performance.resolution)}),this.chartAudio=this.renderer.chartManager.chartAudio,this.texture=this.waveformTex,this.white=new Ie(Ht.WHITE),this.white.width=16,this.white.height=16,this.anchor.set(.5),this.lastZoom=this.getZoom(),this.zoom=this.getZoom(),this.lastReZoom=Date.now(),this.chartAudio.bindWaveform(this),this.refilter();const r=()=>this.lastBeat=-1;ve.on("timingModified",r),this.on("destroyed",()=>{ve.off("timingModified",r)})}async stripWaveform(e){return new Promise(r=>{if(e==null){r();return}this.strippedWaveform=Array.from({length:e.length},()=>[]);const n=this.chartAudio.getSampleRate()/(this.zoom*4);for(let s=0;s<e.length;s++){const a=Math.floor(e[s].length/n);for(let o=0;o<a;o++){const u=Math.floor(n*o);let d=0;for(let m=0;m<n;m++)d=d+Math.abs(e[s][u+m]);this.strippedWaveform[s].push(d/n)}}r()})}refilter(){this.stripWaveform(this.chartAudio.getRawData()),this.lastBeat=-1}update(e,r){this.visible=W.chart.waveform.enabled&&(this.renderer.chartManager.getMode()!=Ot.Play||!W.play.hideBarlines),W.chart.waveform.enabled&&(this.chartAudio!=this.renderer.chartManager.getAudio()&&(this.chartAudio=this.renderer.chartManager.getAudio(),this.refilter(),this.chartAudio.bindWaveform(this)),this.lastZoom!=this.getZoom()?(this.lastReZoom=Date.now(),this.lastZoom=this.getZoom(),this.lastBeat=-1):Date.now()-this.lastReZoom>120&&this.zoom!=this.getZoom()&&(this.zoom=this.getZoom(),this.refilter()),this.lastLineHeight!=W.chart.waveform.lineHeight&&(this.lastLineHeight=W.chart.waveform.lineHeight,W.chart.waveform.lineHeight<=0&&(W.chart.waveform.lineHeight=1),this.updateLineHeight()),this.waveformTex.resize(Math.min(this.renderer.chartManager.app.renderer.screen.width,(this.strippedWaveform?.length??0)*288*W.chart.zoom),this.renderer.chartManager.app.renderer.screen.height),this.white.alpha=W.chart.waveform.opacity,this.renderer.chartManager.app.renderer.render(this.white,{renderTexture:this.lineTex}),this.strippedWaveform&&(e!=this.lastBeat||r!=this.lastTime||this.renderer.chartManager.app.renderer.screen.height*W.chart.zoom!=this.lastHeight)&&(this.lastBeat=e,this.lastTime=r,this.lastHeight=this.renderer.chartManager.app.renderer.screen.height*W.chart.zoom,this.renderData(e,this.strippedWaveform),this.renderer.chartManager.app.renderer.render(this.lineContainer,{renderTexture:this.waveformTex}),this.tint=W.chart.waveform.color),this.scale.set(1/W.chart.zoom))}renderData(e,r){if(this.resetPool(),W.experimental.speedChangeWaveform&&!W.chart.CMod&&W.chart.doSpeedChanges){const n=W.chart.speed,s=this.renderer.chart.timingData.getSpeedMult(e,this.renderer.chartManager.getTime());let a=e-W.chart.maxDrawBeatsBack;const o=e+W.chart.maxDrawBeats,u=this.renderer.chart.timingData.getTimingData("SCROLLS"),d=this.renderer.chart.timingData.getTimingData("OFFSET"),m=this.renderer.chart.timingData.getBPM(0),l=this.renderer.chart.timingData.getBeatTiming(),f=100/n/s/64/W.chart.zoom,p=this.renderer.chartManager.app.renderer.screen.height;let y=this.renderer.chart.getSecondsFromBeat(a),v=Jr(u,a,w=>w.beat);u[v]?.beat!=0&&v--;let _=Math.round(this.renderer.getYPos(a)*W.chart.zoom+this.parent.y);for(;a<o;){const w=u[v]??{beat:0,value:1},T=u[v+1]?.beat??o,E=this.renderer.getYPos(T)*W.chart.zoom+this.parent.y;if(u[v+1]&&(w.value==0||w.value<0&&E>p||w.value>0&&E<0)){v++,a=u[v].beat,_=Math.round(E);continue}const R=f/Math.abs(w.value);for(;a<Math.min(T,o);){if(_<0){if(w.value<0){a=T;break}a+=R*-_,_=0}if(_>p){if(w.value>0){a=o;break}a+=R*(_-p),_=p;continue}a+=R*W.chart.waveform.lineHeight,_+=(w.value>0?1:-1)*W.chart.waveform.lineHeight;const H=Math.floor(a*1e3)/1e3;if(a<=0)y=-d+a*60/m;else if(H>=l[1]?.beat){for(;H>=l[1]?.beat;)l.shift();y=this.renderer.chart.getSecondsFromBeat(a)}else{let et=(a-l[0].beat)*60/l[0].bpm;l[0].warped&&(et=0),y=Math.max(l[0].secondClamp,l[0].secondAfter+et)}if(y<0)continue;const Y=Math.floor(y*this.zoom*4);for(let j=0;j<r.length;j++){const et=r[j][Y];if(!et)continue;const J=this.getLine();J.scale.x=et*16*W.chart.zoom,J.y=_,J.x=this.waveformTex.width/2+288*(j+.5-r.length/2)*W.chart.zoom}}v++,a=T,_=E}}else for(let n=0;n<this.renderer.chartManager.app.renderer.screen.height;n+=W.chart.waveform.lineHeight){const s=this.renderer.getTimeFromYPos((n-this.parent.y)/W.chart.zoom),a=Math.floor(s*this.zoom*4);for(let o=0;o<r.length;o++){const u=r[o][a];if(!u)continue;const d=this.getLine();d.scale.x=u*16*W.chart.zoom,d.y=n,d.x=this.waveformTex.width/2+288*(o+.5-r.length/2)*W.chart.zoom}}this.purgePool()}resetPool(){this.poolSearch=0}purgePool(){Ci(this.lineContainer.children,(e,r)=>r>=this.poolSearch)}updateLineHeight(){for(const e of this.lineContainer.children){const r=e;r.height=W.chart.waveform.lineHeight}}getLine(){for(;this.lineContainer.children[this.poolSearch];){const r=this.lineContainer.children[this.poolSearch];return r.visible=!0,this.poolSearch++,r}const e=new Ie(this.lineTex);return e.height=W.chart.waveform.lineHeight,e.anchor.set(.5),e.visible=!0,this.poolSearch++,this.lineContainer.addChild(e),e}getZoom(){return Math.min(W.chart.speed,OR)}}class NR extends be{constructor(e){super();P(this,"chartManager");P(this,"chart");P(this,"speedMult",1);P(this,"lastMousePos");P(this,"lastMouseBeat",-1);P(this,"lastMouseCol",-1);P(this,"lastNoteType","");P(this,"editingCol",-1);P(this,"waveform");P(this,"barlines");P(this,"timingAreas");P(this,"timingTracks");P(this,"timingBar");P(this,"notefield");P(this,"snapDisplay");P(this,"judgment");P(this,"combo");P(this,"selectionSprite");P(this,"selectionArea");P(this,"selectionBounds");this.chartManager=e,this.chart=e.loadedChart,this.waveform=new FR(this),this.barlines=new AR(this),this.timingAreas=new BR(this),this.timingTracks=new LR(this),this.timingBar=new PR(this),this.notefield=new this.chart.gameType.notefield(this),this.snapDisplay=new IR(this),this.selectionArea=new SR(this),this.judgment=new TR,this.combo=new ER(this),this.selectionSprite=new Ie(Ht.WHITE),this.selectionSprite.visible=!1,this.selectionSprite.alpha=.2,this.addChild(this.waveform),this.addChild(this.barlines),this.addChild(this.timingAreas),this.addChild(this.selectionArea),this.addChild(this.timingTracks),this.addChild(this.timingBar),this.addChild(this.combo),this.addChild(this.notefield),this.addChild(this.snapDisplay),this.addChild(this.judgment),this.addChild(this.selectionSprite),this.chartManager.app.stage.addChild(this),this.x=this.chartManager.app.renderer.screen.width/2,this.y=this.chartManager.app.renderer.screen.height/2,this.interactive=!0,this.hitArea=new Te(-1e5,-1e5,2e5,2e5);const r=a=>{if(this.editingCol!=-1){const o=W.chart.snap==0?.020833333333333332:W.chart.snap,u=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/o)*o;this.chartManager.editHoldBeat(this.editingCol,u,a.shiftKey)}};let n=0;const s=()=>{if(!this.chartManager.selection.shift&&!this.selectionBounds||n==0)return;const a=this.getYPos(Math.max(0,this.chartManager.getBeat()+n));this.chartManager.setBeat(Math.max(0,this.chartManager.getBeat()+n)),this.selectionBounds&&(this.selectionBounds.start.y+=W.chart.receptorYPos/W.chart.zoom-a)};this.chartManager.app.ticker.add(s),window.addEventListener("keydown",r),this.on("destroyed",()=>{window.removeEventListener("keydown",r),this.removeAllListeners(),this.chartManager.app.ticker.remove(s)}),this.on("mousedown",a=>{this.chartManager.getMode()!=Ot.Play&&(W.general.mousePlacement&&this.lastMouseBeat!=-1&&this.lastMouseCol!=-1&&!a.getModifierState("Shift")?(this.chartManager.clearSelection(),this.editingCol=this.lastMouseCol,this.chartManager.setNote(this.lastMouseCol,"mouse",this.lastMouseBeat)):(!a.getModifierState("Control")&&!a.getModifierState("Meta")&&!a.getModifierState("Shift")&&this.chartManager.clearSelection(),this.chartManager.startDragSelection(),this.selectionBounds={start:this.toLocal(a.global),end:this.toLocal(a.global)}))}),this.on("mousemove",a=>{if(this.lastMousePos=this.toLocal(a.global),this.editingCol!=-1){const o=W.chart.snap==0?.020833333333333332:W.chart.snap,u=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/o)*o;this.chartManager.editHoldBeat(this.editingCol,u,a.shiftKey)}this.selectionBounds&&(this.selectionBounds.end=this.toLocal(a.global)),n=Math.max(0,this.lastMousePos.y-this.getLowerBound()+100)/600,this.lastMousePos.y<0&&(n=Math.min(0,this.lastMousePos.y-this.getUpperBound()-100)/600)}),this.on("mouseup",()=>{this.editingCol!=-1&&(this.chartManager.endEditing(this.editingCol),this.editingCol=-1),this.chartManager.endDragSelection(),this.selectionBounds=void 0,n=0})}doJudgment(e,r,n){this.chartManager.getMode()==Ot.Play&&(this.judgment.doJudge(r,n),this.timingBar.addBar(r,n)),this.notefield.doJudge(e.col,n)}activateHold(e){this.notefield.activateHold(e)}keyDown(e){this.notefield.keyDown(e)}keyUp(e){this.notefield.keyUp(e)}endPlay(){this.notefield.endPlay(),this.timingBar.reset(),this.judgment.reset()}update(){const e=this.getVisualBeat(),r=this.getVisualTime();this.speedMult=W.chart.doSpeedChanges?this.chart.timingData.getSpeedMult(e,r):1;let n=e+W.chart.maxDrawBeats,s=e-W.chart.maxDrawBeatsBack,a=this.chart.getSecondsFromBeat(s);if(W.chart.CMod&&(n=this.getBeatFromYPos(this.getLowerBound())+1,s=this.getBeatFromYPos(this.getUpperBound()),a=this.getTimeFromYPos(this.getUpperBound())),this.selectionSprite.visible=!!this.selectionBounds,this.selectionBounds&&(this.selectionSprite.position.x=Math.min(this.selectionBounds.start.x,this.selectionBounds.end.x),this.selectionSprite.position.y=Math.min(this.selectionBounds.start.y,this.selectionBounds.end.y),this.selectionSprite.width=Math.abs(this.selectionBounds.end.x-this.selectionBounds.start.x),this.selectionSprite.height=Math.abs(this.selectionBounds.end.y-this.selectionBounds.start.y)),this.scale.x=W.chart.zoom,this.scale.y=(W.chart.reverse?-1:1)*W.chart.zoom,this.barlines.update(e,s,n),this.timingAreas.update(e,s,n,a),this.timingTracks.update(e,s,n),this.timingBar.update(),this.judgment.update(),this.combo.update(),this.snapDisplay.update(),this.selectionArea.update(),this.notefield.update(e,s,n),this.waveform.update(e,r),W.general.mousePlacement&&this.lastMousePos&&this.chartManager.getMode()!=Ot.Play){const o=W.chart.snap==0?.020833333333333332:W.chart.snap,u=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/o)*o,d=Math.round((this.lastMousePos.x+96)/64);(u!=this.lastMouseBeat||d!=this.lastMouseCol||this.chartManager.getEditingNoteType()!=this.lastNoteType)&&(this.lastMouseBeat=u,this.lastMouseCol=d,this.lastNoteType=this.chartManager.getEditingNoteType(),this.editingCol!=-1&&this.chartManager.editHoldBeat(this.editingCol,u,!1),d>3||d<0?(this.lastMouseBeat=-1,this.lastMouseCol=-1,this.notefield.setGhostNote()):this.notefield.setGhostNote({beat:u,col:this.lastMouseCol,type:this.chartManager.getEditingNoteType()}))}}getTimeWithOffset(){let e=this.chartManager.getTime();return(this.chartManager.getMode()==Ot.Play||this.chartManager.getMode()==Ot.Record)&&(e+=W.play.offset),e}getBeatWithOffset(){let e=this.chartManager.getBeat();return(this.chartManager.getMode()==Ot.Play||this.chartManager.getMode()==Ot.Record)&&(e=this.chart.getBeatFromSeconds(this.getTimeWithOffset())),e}getVisualTime(){let e=this.chartManager.getTime();return(this.chartManager.getMode()==Ot.Play||this.chartManager.getMode()==Ot.Record)&&(e+=W.play.offset+W.play.visualOffset),e}getVisualBeat(){let e=this.chartManager.getBeat();return(this.chartManager.getMode()==Ot.Play||this.chartManager.getMode()==Ot.Record)&&(e=this.chart.getBeatFromSeconds(this.getVisualTime())),e}getYPos(e){const r=this.getVisualTime(),n=this.getVisualBeat();return W.chart.CMod?(this.chart.getSecondsFromBeat(e)-r)*W.chart.speed/100*64*4+W.chart.receptorYPos/W.chart.zoom:n==e?W.chart.receptorYPos/W.chart.zoom:W.chart.doSpeedChanges?(this.chart.timingData.getEffectiveBeat(e)-this.chart.timingData.getEffectiveBeat(n))*W.chart.speed/100*64*this.speedMult+W.chart.receptorYPos/W.chart.zoom:(e-n)*W.chart.speed/100*64+W.chart.receptorYPos/W.chart.zoom}getYPosFromTime(e){const r=this.getVisualTime();return W.chart.CMod?(e-r)*W.chart.speed/100*64*4+W.chart.receptorYPos/W.chart.zoom:this.getYPos(this.chart.timingData.getBeatFromSeconds(e))}getTimeFromYPos(e){const r=this.getVisualTime();return W.chart.CMod?(e-W.chart.receptorYPos/W.chart.zoom)/W.chart.speed*100/64/4+r:this.chart.getSecondsFromBeat(this.getBeatFromYPos(e))}getBeatFromYPos(e,r){const n=this.getVisualBeat();return W.chart.CMod?this.chart.getBeatFromSeconds(this.getTimeFromYPos(e)):W.chart.doSpeedChanges&&!r?this.chart.getBeatFromEffectiveBeat((e-W.chart.receptorYPos/W.chart.zoom)/64*100/W.chart.speed/this.speedMult+this.chart.timingData.getEffectiveBeat(n)):(e-W.chart.receptorYPos/W.chart.zoom)/64*100/W.chart.speed+n}isNegScroll(e){return W.chart.doSpeedChanges&&(this.speedMult<0||(this.chart.timingData.getTimingEventAtBeat("SCROLLS",e)?.value??1)<0||this.chart.timingData.getBPM(e)<0)}getLowerBound(){return(this.chartManager.app.renderer.screen.height-this.y)/W.chart.zoom+32}getUpperBound(){return-32-this.y/W.chart.zoom}selectionTest(e){if(!this.selectionBounds)return!1;const r=this.selectionSprite.getBounds(),n=e.getBounds();return r.x+r.width>n.x+n.width/4&&r.x<n.x+n.width-n.width/4&&r.y+r.height>n.y+n.height/4&&r.y<n.y+n.height-n.height/4}registerDragNote(e){e.interactive=!0;let r=0,n=0,s=0,a;const o=u=>{var v;const d=a,m=this.toLocal(u.global);if(Math.abs(m.y-s)**2+Math.abs(m.x-n)**2<32*32){this.chartManager.selection.shift&&(this.chartManager.selection.shift={columnShift:0,beatShift:0});return}const l=this.getBeatFromYPos(m.y),f=W.chart.snap==0?1/48:W.chart.snap;let p=Math.round(l/f)*f;Math.abs(p-l)>Math.abs(l-d.beat)&&(p=d.beat);const y=Math.round((m.x+96)/64);(v=this.chartManager.selection).shift||(v.shift={columnShift:0,beatShift:0}),r!=y-d.col&&(r=y-d.col,this.chartManager.selection.notes.every(_=>{const w=_.col+r;return w>=0&&w<this.chartManager.loadedChart.gameType.numCols})&&(this.chartManager.selection.shift.columnShift=y-d.col)),this.chartManager.selection.shift.beatShift=p-d.beat};e.on("mousedown",u=>{if(W.general.mousePlacement&&!u.getModifierState("Meta")&&!u.getModifierState("Control")&&!u.getModifierState("Shift")&&!this.chartManager.selection.notes.includes(e.note))return;u.stopImmediatePropagation(),this.chartManager.selection.notes.includes(e.note)?(u.getModifierState("Control")||u.getModifierState("Meta"))&&this.chartManager.removeNoteFromSelection(e.note):(!u.getModifierState("Control")&&!u.getModifierState("Meta")&&!u.getModifierState("Shift")&&this.chartManager.clearSelection(),this.chartManager.addNoteToSelection(e.note)),n=e.x,s=e.y,a=e.note,this.on("mousemove",o);const d=()=>{this.off("mousemove",o),this.off("mouseup",d),((this.chartManager.selection.shift?.beatShift??0)!=0||(this.chartManager.selection.shift?.columnShift??0)!=0)&&this.chartManager.modifySelection(m=>(m.beat+=this.chartManager.selection.shift.beatShift,m.col+=this.chartManager.selection.shift.columnShift,m)),this.chartManager.selection.shift=void 0};this.on("mouseup",d)}),e.on("destroyed",()=>{e?.removeAllListeners()})}}class UR{constructor(t){P(this,"judgmentCounts",new Map);P(this,"holdJudgmentCounts",new Map);P(this,"dancePoints",0);P(this,"maxCumulativeDancePoints",0);P(this,"maxDancePoints",0);P(this,"chartManager");P(this,"notedata");P(this,"dataPoints",[]);P(this,"handlers",[]);P(this,"combo",0);P(this,"missCombo",0);P(this,"maxCombo",0);P(this,"bestJudge");this.notedata=t.loadedChart.getNotedata(),this.chartManager=t,this.bestJudge=di.getCollection(W.play.timingCollection).getStandardWindows()[0],this.calculateMaxDP()}onJudge(t){this.handlers.push(t)}addDataPoint(t,e,r){this.judgmentCounts.has(e)||this.judgmentCounts.set(e,0),this.judgmentCounts.set(e,this.judgmentCounts.get(e)+1),this.dancePoints+=e.dancePoints;const n=this.chartManager.loadedChart.timingData.getTimingEventAtBeat("COMBOS",t[0].beat),s=n?.hitMult??1,a=n?.missMult??1;fa(e)||(this.maxCumulativeDancePoints+=di.getCollection(W.play.timingCollection).getMaxDancePoints()),Jn(e)?(this.maxCumulativeDancePoints+=t.filter(De).reduce((o,u)=>o+di.getCollection(W.play.timingCollection).getMaxHoldDancePoints(u.type),0),this.combo=0,this.missCombo+=a,this.bestJudge=void 0):va(e)&&(di.getCollection(W.play.timingCollection).shouldHideNote(e)?(this.combo+=t.length*s,this.combo>this.maxCombo&&(this.maxCombo=this.combo),this.missCombo=0,this.bestJudge&&e.getTimingWindowMS()>this.bestJudge.getTimingWindowMS()&&(this.bestJudge=e)):(this.bestJudge=void 0,this.combo=0)),this.handlers.forEach(o=>o(r,e)),this.dataPoints.push({second:t[0].second,error:r,judgment:e,notes:t})}addHoldDataPoint(t,e){this.judgmentCounts.has(e)||this.judgmentCounts.set(e,0),this.judgmentCounts.set(e,this.judgmentCounts.get(e)+1);const r=di.getCollection(W.play.timingCollection).getHeldJudgement(t);this.holdJudgmentCounts.has(r)||this.holdJudgmentCounts.set(r,[0,0]);const n=this.holdJudgmentCounts.get(r);ks(e)?n[0]++:n[1]++,this.holdJudgmentCounts.set(r,n),this.dancePoints+=e.dancePoints,this.maxCumulativeDancePoints+=di.getCollection(W.play.timingCollection).getMaxHoldDancePoints(t.type),this.handlers.forEach(s=>s(0,e)),So(e)&&(this.bestJudge=void 0)}getScore(){return this.maxDancePoints==0?0:this.dancePoints/this.maxDancePoints}getCumulativeScore(){return this.maxCumulativeDancePoints==0?0:this.dancePoints/this.maxCumulativeDancePoints}getDataPoints(){return this.dataPoints}getMaxCombo(){return this.maxCombo}recalculate(){this.calculateMaxDP(),this.dancePoints=0,this.maxCumulativeDancePoints=0;for(const t of this.holdJudgmentCounts.entries()){const e=t[0];this.dancePoints+=t[0].dancePoints*t[1][0],this.maxCumulativeDancePoints+=(t[1][0]+t[1][1])*di.getCollection(W.play.timingCollection).getMaxHoldDancePoints(e.noteType)}this.judgmentCounts.clear();for(const t of this.dataPoints){let e=di.getCollection(W.play.timingCollection).judgeInput(t.error);(Jn(t.judgment)||fa(t.judgment))&&(e=t.judgment),this.judgmentCounts.has(e)||this.judgmentCounts.set(e,0),this.judgmentCounts.set(e,this.judgmentCounts.get(e)+1),this.dancePoints+=e.dancePoints,t.judgment=e,fa(e)||(this.maxCumulativeDancePoints+=di.getCollection(W.play.timingCollection).getMaxDancePoints()),Jn(e)&&(this.maxCumulativeDancePoints+=t.notes.filter(De).reduce((r,n)=>r+di.getCollection(W.play.timingCollection).getMaxHoldDancePoints(n.type),0))}}calculateMaxDP(){const t=new Map,e=new Map;for(const r of this.notedata)r.type=="Mine"||r.fake||(De(r)&&(e.has(r.type)||e.set(r.type,0),e.set(r.type,e.get(r.type)+1)),t.has(r.beat)||t.set(r.beat,[]),t.get(r.beat).push(r));this.maxDancePoints=t.size*di.getCollection(W.play.timingCollection).getMaxDancePoints(),this.maxDancePoints+=Array.from(e.entries()).reduce((r,n)=>r+n[1]*di.getCollection(W.play.timingCollection).getMaxHoldDancePoints(n[0]),0)}getCount(t){return this.judgmentCounts.get(t)??0}getCombo(){return this.combo}getMissCombo(){return this.missCombo}getBestJudge(){return this.bestJudge}}const HR=["TITLE","SUBTITLE","ARTIST","TITLETRANSLIT","SUBTITLETRANSLIT","ARTISTTRANSLIT","GENRE","CREDIT","ORIGIN","BACKGROUND","BANNER","MUSIC","CDTITLE","JACKET","DISCIMAGE","CDIMAGE","PREVIEW","LYRICSPATH","SAMPLESTART","SAMPLELENGTH","SELECTABLE"];class GR{constructor(t){P(this,"charts",{});P(this,"_type");P(this,"other_properties",{});P(this,"properties",{});P(this,"timingData",new gv);P(this,"unloadedCharts",[]);P(this,"loaded");this.loaded=new Promise(e=>{const r=t.name.split(".").pop();r=="sm"||r=="ssc"?this._type=r:e(),t.text().then(n=>{n=n.replaceAll(/\/\/.+/g,"");const s=[...n.matchAll(/#([A-Z]+):([^;]*);/g)];let a=!1,o={};const u=[];for(const d of s)d[1]=="NOTEDATA"&&r=="ssc"||a?(a=!0,o[d[1]]=d[2],d[1]=="NOTES"&&(u.push(o),o={},a=!1)):d[1]=="NOTES"?u.push(d[2]):HR.includes(d[1])?this.properties[d[1]]=d[2]:d[1]=="OFFSET"||Sc.includes(d[1])?this.timingData.parse(d[1],d[2]):this.other_properties[d[1]]=d[2];this.timingData.reloadCache(),this.charts={};for(const d of u){let m;try{m=new yv(this,d)}catch(l){this.unloadedCharts.push(d),Fe.createFormatted(Ik(l),"warn");continue}this.addChart(m)}e()})})}addChart(t){var e,r;(e=this.charts)[r=t.gameType.id]||(e[r]=[]),this.charts[t.gameType.id].push(t),this.charts[t.gameType.id].sort((n,s)=>tn.indexOf(n.difficulty)==tn.indexOf(s.difficulty)?n.meter-s.meter:tn.indexOf(n.difficulty)-tn.indexOf(s.difficulty))}removeChart(t){if(!this.charts[t.gameType.id])return!1;const e=this.charts[t.gameType.id].indexOf(t);return e==-1?!1:(this.charts[t.gameType.id].splice(e,1),!0)}serialize(t){let e="";t=="sm"?(this.other_properties.NITGVERSION&&(e+=this.formatProperty("NITGVERSION",this.other_properties.NITGVERSION)),e+=this.formatProperty("TITLE",this.properties.TITLE),e+=this.formatProperty("SUBTITLE",this.properties.SUBTITLE),e+=this.formatProperty("ARTIST",this.properties.ARTIST),e+=this.formatProperty("MUSIC",this.properties.MUSIC??""),e+=this.formatProperty("BANNER",this.properties.GENRE),e+=this.formatProperty("BACKGROUND",this.properties.BACKGROUND),e+=this.formatProperty("LYRICSPATH",this.properties.LYRICSPATH),e+=this.formatProperty("CDTITLE",this.properties.CDTITLE),e+=this.formatProperty("SAMPLESTART",this.properties.SAMPLESTART),e+=this.formatProperty("SAMPLELENGTH",this.properties.SAMPLELENGTH)):(e+=this.formatProperty("VERSION",this.other_properties.VERSION??.83),e+=this.formatProperty("TITLE",this.properties.TITLE),e+=this.formatProperty("SUBTITLE",this.properties.SUBTITLE),e+=this.formatProperty("ARTIST",this.properties.ARTIST),e+=this.formatProperty("TITLETRANSLIT",this.properties.TITLETRANSLIT),e+=this.formatProperty("SUBTITLETRANSLIT",this.properties.SUBTITLETRANSLIT),e+=this.formatProperty("ARTISTTRANSLIT",this.properties.ARTISTTRANSLIT),e+=this.formatProperty("GENRE",this.properties.GENRE),e+=this.formatProperty("CREDIT",this.properties.CREDIT),e+=this.formatProperty("MUSIC",this.properties.MUSIC??""),e+=this.formatProperty("BANNER",this.properties.BANNER),e+=this.formatProperty("BACKGROUND",this.properties.BACKGROUND),e+=this.formatProperty("JACKET",this.properties.JACKET),e+=this.formatProperty("DISCIMAGE",this.properties.DISCIMAGE),e+=this.formatProperty("CDIMAGE",this.properties.CDIMAGE),e+=this.formatProperty("SELECTABLE",this.properties.SELECTABLE??"YES"),e+=this.formatProperty("LYRICSPATH",this.properties.LYRICSPATH),e+=this.formatProperty("CDTITLE",this.properties.CDTITLE),e+=this.formatProperty("SAMPLESTART",this.properties.SAMPLESTART),e+=this.formatProperty("SAMPLELENGTH",this.properties.SAMPLELENGTH)),e+=this.timingData.serialize(t);for(const r in this.other_properties)r=="VERSION"||r=="NITGVERSION"||(e+=this.formatProperty(r,this.other_properties[r]));e+=`
`;for(const r in this.charts)for(const n of this.charts[r])e+=n.serialize(t)+`
`;for(const r of this.unloadedCharts)if(typeof r=="string")e+="#NOTES:"+r+`
`;else{e+="//---------------"+r.STEPSTYPE+" - "+r.DESCRIPTION+`---------------
`,e+=`#NOTEDATA:;
`,e+=`#CHARTNAME:${r.CHARTNAME};
`,e+=`#CHARTSTYLE:${r.CHARTSTYLE};
`,e+=`#CREDIT:${r.CREDIT};
`,r.MUSIC&&(e+=`#MUSIC:${r.MUSIC};
`),e+=`#STEPSTYPE:${r.STEPSTYPE};
`,e+=`#DESCRIPTION:${r.DESCRIPTION};
`,e+=`#DIFFICULTY:${r.DIFFICULTY};
`,e+=`#METER:${r.METER};
`,e+=`#METERF:${r.METERF??r.METER};
`,e+=`#RADARVALUES:${r.RADARVALUES};
`,e+="#NOTES:";for(const n in r)["NOTEDATA","CHARTNAME","CHARTSTYLE","CREDIT","MUSIC","STEPSTYPE","DESCRIPTION","DIFFICULTY","METER","METERF","RADARVALUES"].includes(n)||(e+=`#${n}:${r[n]};

`)}return e}usesSplitTiming(){for(const t in this.charts)for(const e of this.charts[t])if(!e.timingData.isEmpty())return!0;return!1}formatProperty(t,e){return e||(e=""),"#"+t.toUpperCase()+":"+e+`;
`}}const Es=[1,2,3,4,6,8,12,16,24,48,-1];var Ot=(i=>(i.View="View Mode",i.Edit="Edit Mode",i.Play="Play Mode",i.Record="Record Mode",i))(Ot||{});class WR{constructor(t){P(this,"app");P(this,"chartAudio",new nc);P(this,"chartView");P(this,"widgetManager");P(this,"assistTick",new ua.Howl({src:"assets/sound/assist_tick.ogg",volume:.5}));P(this,"me_high",new ua.Howl({src:"assets/sound/metronome_high.ogg",volume:.5}));P(this,"me_low",new ua.Howl({src:"assets/sound/metronome_low.ogg",volume:.5}));P(this,"mine",new ua.Howl({src:"assets/sound/mine.ogg",volume:.5}));P(this,"loadedSM");P(this,"smPath","");P(this,"loadedChart");P(this,"selection",{notes:[],inProgressNotes:[],timingEvents:[]});P(this,"editingTiming",!1);P(this,"beat",0);P(this,"time",0);P(this,"holdEditing",[]);P(this,"editNoteTypeIndex",0);P(this,"snapIndex",0);P(this,"partialScroll",0);P(this,"noteIndex",0);P(this,"lastMetronomeDivision",-1);P(this,"lastMetronomeMeasure",-1);P(this,"lastSong","");P(this,"mode","Edit Mode");P(this,"lastMode","Edit Mode");P(this,"noChartTextA");P(this,"noChartTextB");P(this,"virtualClipboard","");P(this,"startRegion");P(this,"endRegion");P(this,"gameStats");this.app=t,document.addEventListener("cut",e=>{if(e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const r=this.copyNotes();r&&e.clipboardData?.setData("text/plain",r),this.deleteSelection(),e.preventDefault()},!0),document.addEventListener("copy",e=>{if(e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const r=this.copyNotes();r&&e.clipboardData?.setData("text/plain",r),e.preventDefault(),e.stopImmediatePropagation()},!0),document.addEventListener("paste",e=>{if(e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const r=e.clipboardData?.getData("text/plain");r&&this.pasteNotes(r),e.preventDefault(),e.stopImmediatePropagation()},!0),t.view.addEventListener?.("wheel",e=>{if(!(this.loadedSM==null||this.loadedChart==null||this.chartView==null))if(_o&&e.metaKey||!_o&&e.ctrlKey)W.chart.speed=or(W.chart.speed*Math.pow(1.01,e.deltaY/5*W.general.scrollSensitivity),10,35e3);else{if(this.mode=="Play Mode"||this.mode=="Record Mode")return;let r=this.beat;const n=W.chart.snap,s=W.chart.speed*(W.chart.reverse?-1:1);if(n==0?(this.partialScroll=0,r=this.beat+e.deltaY/s*W.general.scrollSensitivity):(this.partialScroll+=e.deltaY/s*W.general.scrollSensitivity,Math.abs(this.partialScroll)>n&&(this.partialScroll<0?r=Math.round((this.beat+Math.ceil(this.partialScroll/n)*n)/n)*n:r=Math.round((this.beat+Math.floor(this.partialScroll/n)*n)/n)*n,this.partialScroll%=n)),r=Math.max(0,r),r!=this.beat&&this.setBeat(r),!this.holdEditing.every(a=>a==null))for(let a=0;a<this.holdEditing.length;a++)!this.holdEditing[a]||this.holdEditing[a].type=="mouse"||this.editHoldBeat(a,this.beat,e.shiftKey)}},{passive:!0}),this.widgetManager=new wR(this),this.app.stage.addChild(this.widgetManager),this.noChartTextA=new Je("No Chart",{fontName:"Main",fontSize:30}),this.noChartTextA.anchor.set(.5),this.noChartTextA.tint=5592405,this.app.stage.addChild(this.noChartTextA),this.noChartTextB=new Je("Create a new chart",{fontName:"Main",fontSize:15}),this.noChartTextB.anchor.set(.5),this.noChartTextB.tint=5596791,this.noChartTextB.interactive=!0,this.noChartTextB.on("mouseover",()=>{this.noChartTextB.tint=8952234}),this.noChartTextB.on("mouseleave",()=>{this.noChartTextB.tint=5596791}),this.noChartTextB.on("mousedown",()=>{this.app.windowManager.openWindow(new bv(t,Si.getGameType("dance-single")))}),this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,this.noChartTextA.x=this.app.renderer.screen.width/2,this.noChartTextA.y=this.app.renderer.screen.height/2-20,this.noChartTextB.x=this.app.renderer.screen.width/2,this.noChartTextB.y=this.app.renderer.screen.height/2+10,this.app.stage.addChild(this.noChartTextB),this.app.ticker.add(()=>{this.widgetManager.update(),!(!this.loadedSM||!this.loadedChart||!this.chartView)&&this.chartView.update()}),setInterval(()=>{if(!this.loadedSM||!this.loadedChart||!this.chartView)return;const e=this.chartAudio.seek();if(wo.time("Update Time"),this.chartAudio.isPlaying()&&(this.setTime(e,!0),!this.holdEditing.every(u=>!u)))for(let u=0;u<this.holdEditing.length;u++){if(!this.holdEditing[u]||this.holdEditing[u].type=="mouse")continue;let d=this.beat;this.mode=="Record Mode"&&(d=this.loadedChart.getBeatFromSeconds(this.time+W.play.offset));const m=W.chart.snap==0?1/48:W.chart.snap,l=Math.round(d/m)*m,f=this.holdEditing[u];(Math.max(0,Math.round(Math.max(this.beat,f.endBeat)*48)/48)-Math.max(0,Math.round(Math.min(this.beat,f.startBeat)*48)/48))*60/this.loadedChart.timingData.getBPM(this.beat)>.3&&this.editHoldBeat(u,l,!1)}const r=this.loadedChart.getNotedata();let n=!1;for(;this.noteIndex<r.length&&e>r[this.noteIndex].second+W.audio.effectOffset;)this.mode!="Record Mode"&&this.chartAudio.isPlaying()&&this.loadedChart.gameType.gameLogic.shouldAssistTick(r[this.noteIndex])&&(this.mode!="Play Mode"&&this.chartView.doJudgment(r[this.noteIndex],0,mv),!n&&W.audio.assistTick&&(this.assistTick.play(),n=!0)),this.noteIndex++;const s=this.loadedChart.getBeatFromSeconds(this.time+W.audio.effectOffset),a=Math.floor(this.loadedChart.timingData.getDivisionOfMeasure(s)),o=Math.floor(this.loadedChart.timingData.getMeasure(s));(o!=this.lastMetronomeMeasure||a!=this.lastMetronomeDivision)&&(this.lastMetronomeDivision=a,this.lastMetronomeMeasure=o,this.chartAudio.isPlaying()&&W.audio.metronome&&(a==0?this.me_high.play():this.me_low.play())),this.mode=="Play Mode"&&this.loadedChart.gameType.gameLogic.update(this),this.updateSoundProperties(),wo.endTime("Update Time")},5),ve.on("resize",()=>{this.chartView&&(this.chartView.x=this.app.renderer.screen.width/2,this.chartView.y=this.app.renderer.screen.height/2),this.noChartTextA.x=this.app.renderer.screen.width/2,this.noChartTextA.y=this.app.renderer.screen.height/2-20,this.noChartTextB.x=this.app.renderer.screen.width/2,this.noChartTextB.y=this.app.renderer.screen.height/2+10}),ve.on("chartModified",()=>{this.loadedChart&&(this.loadedChart.recalculateStats(),ve.emit("chartModifiedAfter"))}),window.addEventListener("keyup",e=>{if(this.mode=="Edit Mode"&&e.code.startsWith("Digit")){const r=parseInt(e.code.slice(5))-1;this.endEditing(r)}},!0),window.addEventListener("keydown",e=>{if(this.mode=="Edit Mode"&&!e.target.classList.contains("inlineEdit")&&!(e.target instanceof HTMLTextAreaElement)&&!(e.target instanceof HTMLInputElement)){if(e.code.startsWith("Digit")&&!e.repeat&&!e.ctrlKey&&!e.metaKey&&!e.altKey&&!e.ctrlKey){const r=parseInt(e.code.slice(5))-1;r<(this.loadedChart?.gameType.numCols??4)&&r>-1&&(this.setNote(r,"key"),e.preventDefault(),e.stopImmediatePropagation())}if(!this.holdEditing.every(r=>r==null)){const r=Mo.getKeyNameFromCode(e.code),n=["cursorUp","cursorDown","previousNote","nextNote","previousMeasure","nextMeasure","jumpChartStart","jumpChartEnd","jumpSongStart","jumpSongEnd"];for(const s of n)if(Is[s].keybinds.map(a=>a.key).includes(r)){e.preventDefault(),e.stopImmediatePropagation(),Is[s].callback(this.app);for(let a=0;a<this.holdEditing.length;a++)!this.holdEditing[a]||this.holdEditing[a].type=="mouse"||this.editHoldBeat(a,this.beat,e.shiftKey);return}for(const s of["undo","redo"])if(Is[s].keybinds.map(a=>a.key).includes(r)){this.holdEditing=[];return}}}},!0),window.addEventListener("keydown",e=>{this.mode!="Play Mode"&&this.mode!="Record Mode"||e.key=="Escape"&&(this.setMode(this.lastMode),this.chartAudio.pause())},!0)}getBeat(){return this.beat}getTime(){return this.time}setBeat(t){!this.loadedChart||(this.beat=t,this.time=this.loadedChart.getSecondsFromBeat(this.beat),this.chartAudio.seek(this.time),this.getAssistTickIndex())}setTime(t,e){!this.loadedChart||(this.time=t,this.beat=this.loadedChart.getBeatFromSeconds(this.time),e||(this.chartAudio.seek(this.time),this.getAssistTickIndex()))}async loadSM(t){if(tr.instance.isDirty()){const n=new wv(this.app,"Save","Do you wish to save the current file?",[{label:"Cancel",type:"default"},{label:"No",type:"default"},{label:"Yes",type:"confirm"}]);this.app.windowManager.openWindow(n);const s=await n.resolved;if(s=="Cancel")return;s=="Yes"&&this.save()}if(!t){this.smPath="",this.loadedSM=void 0,this.chartAudio.stop(),this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,this.chartView?.destroy({children:!0});return}this.chartAudio.stop(),this.lastSong="",this.smPath=t,this.time=0,this.beat=0;const r=await(await ze.getFileHandle(this.smPath)).getFile();this.loadedSM=new GR(r),await this.loadedSM.loaded,this.noChartTextA.visible=!0,this.noChartTextB.visible=!0,ve.emit("smLoaded"),await this.loadChart(),ve.emit("smLoadedAfter"),this.time==0&&this.setBeat(0)}async loadChart(t){if(this.loadedSM!=null){if(t==null){if(this.loadedChart){const e=this.loadedSM.charts[this.loadedChart.gameType.id];e&&e.length>0&&(t=e.at(-1))}if(!t)for(const e of Si.getPriority()){const r=this.loadedSM.charts[e.id];if(r&&r.length>0){t=r.at(-1);break}}if(!t){this.chartView?.destroy({children:!0}),this.chartView?.removeChildren(),this.beat=0,this.time=0,this.loadedChart=void 0,this.chartView=void 0,this.noChartTextA.visible=!0,this.noChartTextB.visible=!0,ve.emit("chartLoaded"),ve.emit("chartModified");return}}if(t!=this.loadedChart){if(this.chartView?.destroy({children:!0}),this.chartView?.removeChildren(),this.clearSelection(),this.loadedChart=t,this.beat=this.loadedChart.getBeatFromSeconds(this.time),tr.instance.reset(),W.play.timingCollection=W.play.defaultTimingCollection[t.gameType.id]??"ITG",this.getAssistTickIndex(),this.chartView=new NR(this),this.chartView.x=this.app.renderer.screen.width/2,this.chartView.y=this.app.renderer.screen.height/2,(this.mode=="Play Mode"||this.mode=="Record Mode")&&this.setMode(this.lastMode),this.loadedChart.getMusicPath()!=this.lastSong){this.lastSong=this.loadedChart.getMusicPath();const e=this.chartAudio.isPlaying();await this.loadAudio(),e&&this.chartAudio.play()}this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,Fe.create("Loaded chart "+t.difficulty+" "+t.meter+" "+t.gameType.id),ve.emit("chartLoaded"),ve.emit("chartModified")}}}async loadAudio(){if(!this.loadedSM||!this.loadedChart)return;this.chartAudio.stop(),this.chartAudio?.destroy();const t=this.loadedChart.getMusicPath();if(t==""){Fe.createFormatted("Failed to load audio: no audio file","error"),this.chartAudio=new nc(void 0);return}const e=await this.getAudioHandle(t);if(e==null){Fe.createFormatted("Failed to load audio: couldn't find audio file "+t,"error"),this.chartAudio=new nc(void 0);return}const r=await e.getFile();this.chartAudio=new nc(await r.arrayBuffer()),this.chartAudio.seek(this.time),this.getAssistTickIndex()}async getAudioHandle(t){let e=await ze.getFileHandleRelativeTo(this.smPath,t);if(e)return e;const r=await ze.getDirectoryFiles(Gr(this.smPath));return e=r.filter(n=>n.name.toLowerCase()==Ss(t).toLowerCase())[0],e?(Fe.createFormatted("Failed to locate audio file "+t+", using file "+e.name+" instead","warn"),e):(e=r.filter(n=>Uc.includes(wn(n.name)))[0],e&&Fe.createFormatted("Failed to locate audio file "+t+", using file "+e.name+" instead","warn"),e)}getAudio(){return this.chartAudio}updateSoundProperties(){this.setEffectVolume(W.audio.soundEffectVolume),this.setVolume(W.audio.songVolume),this.setRate(W.audio.rate)}setRate(t){this.chartAudio.rate(t)}setVolume(t){this.chartAudio.volume(t)}setEffectVolume(t){this.assistTick.volume()!=t&&this.assistTick.volume(t),this.me_high.volume()!=t&&this.me_high.volume(t),this.me_low.volume()!=t&&this.me_low.volume(t),this.mine.volume()!=t&&this.mine.volume(t)}getAssistTickIndex(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null||this.loadedChart.getNotedata().length==0){this.noteIndex=0;return}this.noteIndex=Jr(this.loadedChart.getNotedata(),this.time,t=>t.second)+1,this.noteIndex>=1&&this.time<=this.loadedChart.getNotedata()[this.noteIndex-1].second&&this.noteIndex--}playPause(){this.chartAudio.isPlaying()?this.chartAudio.pause():this.chartAudio.play()}setAndSnapBeat(t){if(!this.loadedChart)return;const e=Math.max(.001,W.chart.snap),r=this.loadedChart.timingData.getBeatOfMeasure(t),n=t-r,s=Math.round(r/e)*e;let a=n+s;a=Math.max(0,a),this.setBeat(a)}previousSnap(){this.snapIndex=(this.snapIndex-1+Es.length)%Es.length,W.chart.snap=Es[this.snapIndex]==-1?0:1/Es[this.snapIndex]}nextSnap(){this.snapIndex=(this.snapIndex+1+Es.length)%Es.length,W.chart.snap=Es[this.snapIndex]==-1?0:1/Es[this.snapIndex]}removeDuplicateBeats(t){if(t.length===0)return t;const e=[t[0]];for(let r=1;r<t.length;r++)t[r-1]!==t[r]&&e.push(t[r]);return e}previousNote(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null||this.loadedChart.getNotedata().length==0)return;const t=this.loadedChart.getNotedata().filter(De).map(n=>n.beat+n.hold);let e=this.loadedChart.getNotedata().map(n=>n.beat).concat(t).sort((n,s)=>n-s);e=this.removeDuplicateBeats(e);let r=Jr(e,this.beat);this.beat==e[r]&&r--,this.setBeat(e[Math.max(0,r)])}nextNote(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null||this.loadedChart.getNotedata().length==0)return;const t=this.loadedChart.getNotedata().filter(De).map(n=>n.beat+n.hold);let e=this.loadedChart.getNotedata().map(n=>n.beat).concat(t).sort((n,s)=>n-s);e=this.removeDuplicateBeats(e);let r=Jr(e,this.beat);this.beat>=e[r]&&r++,this.setBeat(e[Math.min(e.length-1,r)])}firstNote(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;const t=this.loadedChart.getNotedata();t.length!=0&&this.setBeat(t[0].beat)}lastNote(){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;const t=this.loadedChart.getNotedata();if(t.length==0)return;const e=t[t.length-1];this.setBeat(e.beat+(De(e)?e.hold:0))}setNote(t,e,r){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;r=r??this.beat,r=Math.max(0,Math.round(r*48)/48);const n=this.loadedChart.getNotedata().filter(a=>a.col!=t?!1:Math.abs(a.beat-r)<.003?!0:De(a)&&a.beat<=r&&a.beat+a.hold>=r),s={startBeat:r,endBeat:r,roll:!1,originalNote:void 0,type:e,removedNotes:n};this.holdEditing[t]=s,n.length==0&&(s.originalNote={beat:r,col:t,type:this.getEditingNoteType()}),this.getAssistTickIndex(),this.app.actionHistory.run({action:()=>{s.removedNotes.forEach(a=>this.loadedChart.removeNote(a)),s.originalNote&&this.loadedChart.addNote(s.originalNote)},undo:()=>{s.originalNote&&this.loadedChart.removeNote(s.originalNote),s.removedNotes.forEach(a=>this.loadedChart.addNote(a))}})}editHoldBeat(t,e,r){if(this.loadedSM==null||this.loadedChart==null||this.chartView==null)return;const n=this.holdEditing[t];if(n==null||e==n.startBeat&&e==n.endBeat)return;if(n.startBeat=Math.max(0,Math.round(Math.min(e,n.startBeat)*48)/48),n.endBeat=Math.max(0,Math.round(Math.max(e,n.endBeat)*48)/48),n.roll||(n.roll=r),!n.originalNote)this.loadedChart.addNote({beat:n.startBeat,col:t,type:n.roll?"Roll":"Hold",hold:n.endBeat-n.startBeat});else{const a={beat:n.startBeat,type:n.roll?"Roll":"Hold",hold:n.endBeat-n.startBeat};(a.beat!=n.originalNote.beat||a.type!=n.originalNote.type||!De(n.originalNote)||a.hold!=n.originalNote.hold)&&this.loadedChart.modifyNote(n.originalNote,a)}n.originalNote={beat:n.startBeat,col:t,type:n.roll?"Roll":"Hold",hold:n.endBeat-n.startBeat};const s=this.loadedChart.getNotedata().filter(a=>a.beat==n.originalNote.beat&&a.col==n.originalNote.col||a.col!=t?!1:a.beat>=n.startBeat&&a.beat<=n.endBeat?!0:De(a)&&a.beat+a.hold>=n.startBeat&&a.beat+a.hold<=n.endBeat);n.removedNotes=n.removedNotes.concat(s),s.forEach(a=>this.loadedChart.removeNote(a)),this.getAssistTickIndex()}endEditing(t){this.holdEditing[t]=void 0}previousNoteType(){const t=this.loadedChart?.gameType.editNoteTypes.length??0;this.editNoteTypeIndex=(this.editNoteTypeIndex-1+t)%t}nextNoteType(){const t=this.loadedChart?.gameType.editNoteTypes.length??0;this.editNoteTypeIndex=(this.editNoteTypeIndex+1+t)%t}getEditingNoteType(){return this.loadedChart?.gameType.editNoteTypes[this.editNoteTypeIndex]??""}setEditingNoteType(t){if(!this.loadedChart)return;const r=(this.loadedChart?.gameType.editNoteTypes).indexOf(t);r!=-1&&(this.editNoteTypeIndex=r)}getMode(){return this.mode}setMode(t){if(!this.loadedChart||!this.chartView)return;if(this.mode==t){(t=="Play Mode"||t=="Record Mode")&&(this.setMode(this.lastMode),this.getAssistTickIndex(),this.chartAudio.pause());return}(this.mode=="View Mode"||this.mode=="Edit Mode")&&(this.lastMode=this.mode),this.mode=t;const e=this.loadedChart.getNotedata();if(this.mode=="Play Mode"){e.forEach(r=>{r.gameplay={hideNote:!1,hasHit:!1}});for(const r of e)if(r.second<this.time)r.gameplay.hasHit=!0;else break;this.loadedChart.gameType.gameLogic.endPlay(this),this.gameStats=new UR(this),this.widgetManager.startPlay(),this.chartAudio.seek(Math.max(0,this.time)-1),this.chartAudio.play()}else this.mode=="Record Mode"?(this.chartAudio.seek(Math.max(0,this.time)-1),this.chartAudio.play()):(this.chartView.endPlay(),e.forEach(r=>r.gameplay=void 0))}judgeCol(t){if(!(!this.loadedChart||!this.chartView)){if(this.mode=="Play Mode")this.loadedChart.gameType.gameLogic.keyDown(this,t);else if(this.mode=="Record Mode"){const e=this.loadedChart.getBeatFromSeconds(this.time+W.play.offset),r=W.chart.snap==0?1/48:W.chart.snap,n=Math.round(e/r)*r;this.setNote(t,"key",n)}}}judgeColUp(t){!this.loadedChart||!this.chartView||(this.mode=="Play Mode"?this.loadedChart.gameType.gameLogic.keyUp(this,t):this.mode=="Record Mode"&&this.endEditing(t))}async save(){if(!this.loadedSM)return;if(!tr.instance.isDirty()){Fe.create("Saved");return}const t=this.smPath.split("/"),e=t.pop().split(".").slice(0,-1).join("."),r=t.join("/");!this.loadedSM.usesSplitTiming()&&await ze.getFileHandle(r+"/"+e+".sm")&&ze.writeFile(r+"/"+e+".sm",this.loadedSM.serialize("sm")),await ze.getFileHandle(r+"/"+e+".ssc")&&ze.writeFile(r+"/"+e+".ssc",this.loadedSM.serialize("ssc")),this.loadedSM.usesSplitTiming()?Fe.create("Saved. No SM file since split timing was used."):Fe.create("Saved"),tr.instance.setLimit()}clearSelection(){this.selection={notes:[],inProgressNotes:[],timingEvents:[]}}startDragSelection(){this.selection.inProgressNotes=[]}endDragSelection(){this.selection.notes=this.selection.notes.concat(this.selection.inProgressNotes)}addNoteToDragSelection(t){this.selection.inProgressNotes.push(t)}removeNoteFromDragSelection(t){const e=this.selection.inProgressNotes.indexOf(t);e!=-1&&this.selection.inProgressNotes.splice(e,1)}addNoteToSelection(t){this.selection.notes.push(t)}removeNoteFromSelection(t){const e=this.selection.notes.indexOf(t);e!=-1&&this.selection.notes.splice(e,1)}addEventToSelection(t){this.selection.timingEvents.push(t)}selectRegion(){if(!!this.loadedChart){if(this.endRegion&&(this.startRegion=void 0,this.endRegion=void 0),!this.startRegion){this.clearSelection(),this.startRegion=this.beat;return}if(!this.endRegion){this.endRegion=this.beat,this.endRegion<this.startRegion&&(this.endRegion=this.startRegion,this.startRegion=this.beat),this.loadedChart.getNotedata().filter(t=>t.beat>=this.startRegion&&t.beat<this.endRegion).filter(t=>!this.selection.notes.includes(t)).forEach(t=>this.addNoteToSelection(t));return}}}modifySelection(t){if(!this.loadedChart)return;const e=this.selection.notes,r=structuredClone(this.selection.notes).map(t).sort((o,u)=>o.beat==u.beat?o.col-u.col:o.beat-u.beat);if(r.length==0)return;const n=this.loadedChart.getNotedata();let s=Jr(n,r[0].beat,o=>o.beat);const a=[];for(const o of r){let u=s;const d=De(o);for(;n[s]&&n[s].beat<=o.beat+(d?o.hold:0);){const m=n[s];s++,m.beat<o.beat&&(u=s),!e.includes(m)&&m.col==o.col&&(m.beat==o.beat&&a.push(m),d&&m.beat>o.beat&&m.beat<=o.beat+o.hold&&a.push(m))}s=u}this.app.actionHistory.run({action:()=>{this.loadedChart.removeNotes(e.concat(a)),this.selection.notes=this.loadedChart.addNotes(r)},undo:()=>{this.loadedChart.removeNotes(r),this.loadedChart.addNotes(a),this.selection.notes=this.loadedChart.addNotes(e)}})}deleteSelection(){if(this.selection.notes.length==0)return;const t=this.selection.notes;this.app.actionHistory.run({action:()=>{this.loadedChart.removeNotes(t)},undo:()=>{this.selection.notes=this.loadedChart.addNotes(t)}})}pasteNotes(t){if(!this.loadedChart)return;const e=n0(t)??n0(this.virtualClipboard);if(!e||e.length==0)return;e.map(a=>(a.beat+=this.beat,a.beat=Math.round(a.beat*48)/48,a)).sort((a,o)=>a.beat==o.beat?a.col-o.col:a.beat-o.beat);const r=this.loadedChart.getNotedata();let n=Jr(r,e[0].beat,a=>a.beat);const s=[];for(const a of e){let o=n;const u=De(a);for(;r[n]&&r[n].beat<=a.beat+(u?a.hold:0);){const d=r[n];n++,d.beat<a.beat&&(o=n),d.col==a.col&&(d.beat==a.beat&&s.push(d),u&&d.beat>a.beat&&d.beat<=a.beat+a.hold&&s.push(d))}n=o}this.app.actionHistory.run({action:()=>{this.loadedChart.removeNotes(s),this.selection.notes=this.loadedChart.addNotes(e)},undo:()=>{this.loadedChart.removeNotes(e),this.loadedChart.addNotes(s)}})}copyNotes(){if(this.selection.notes.length==0)return;const t=Math.min(...this.selection.notes.map(n=>n.beat)),e=structuredClone(this.selection.notes).map(n=>(n.beat-=t,n)).sort((n,s)=>n.beat==s.beat?n.col-s.col:n.beat-s.beat),r=kk(e);return this.virtualClipboard=r,r}}const zR={file:{type:"menu",title:"File",options:[{type:"selection",id:"newSong"},{type:"selection",id:"openSong"},{type:"seperator"},{type:"selection",id:"save"},{type:"selection",id:"export"}]},edit:{type:"menu",title:"Edit",options:[{type:"selection",id:"cut"},{type:"selection",id:"copy"},{type:"selection",id:"paste"},{type:"seperator"},{type:"selection",id:"undo"},{type:"selection",id:"redo"},{type:"seperator"},{type:"checkbox",id:"mousePlacement",checked:()=>W.general.mousePlacement}]},view:{type:"menu",title:"View",options:[{type:"dropdown",title:"Cursor",options:[{type:"selection",id:"cursorUp"},{type:"selection",id:"cursorDown"},{type:"seperator"},{type:"selection",id:"previousNote"},{type:"selection",id:"nextNote"},{type:"seperator"},{type:"selection",id:"previousMeasure"},{type:"selection",id:"nextMeasure"},{type:"seperator"},{type:"selection",id:"jumpChartStart"},{type:"selection",id:"jumpChartEnd"},{type:"seperator"},{type:"selection",id:"jumpSongStart"},{type:"selection",id:"jumpSongEnd"}]},{type:"dropdown",title:"Snap",options:[{type:"selection",id:"decreaseSnap"},{type:"selection",id:"increaseSnap"}]},{type:"dropdown",title:"Scroll",options:[{type:"checkbox",id:"XMod",checked:()=>!W.chart.CMod},{type:"checkbox",id:"CMod",checked:()=>W.chart.CMod},{type:"seperator"},{type:"selection",id:"increaseScrollSpeed"},{type:"selection",id:"decreaseScrollSpeed"}]},{type:"dropdown",title:"Zoom",options:[{type:"selection",id:"zoomIn"},{type:"selection",id:"zoomOut"},{type:"seperator"},{type:"selection",id:"zoomDefault"}]},{type:"dropdown",title:"Waveform",options:[{type:"checkbox",id:"renderWaveform",checked:()=>W.chart.waveform.enabled},{type:"selection",id:"waveformOptions"}]},{type:"seperator"},{type:"selection",id:"playMode"},{type:"selection",id:"playModeStart"},{type:"seperator"},{type:"selection",id:"recordMode"},{type:"seperator"},{type:"checkbox",id:"hideWarpedArrows",checked:()=>W.chart.hideWarpedArrows},{type:"checkbox",id:"doSpeedChanges",checked:()=>W.chart.doSpeedChanges}]},chart:{type:"menu",title:"Chart",options:[{type:"selection",id:"openChart"},{type:"seperator"},{type:"selection",id:"songProperties"},{type:"seperator"},{type:"selection",id:"timingData"}]},selection:{type:"menu",title:"Selection",options:[{type:"dropdown",title:"Convert",options:[{type:"selection",id:"convertHoldsRolls"},{type:"selection",id:"convertHoldsTaps"},{type:"selection",id:"convertNotesMines"},{type:"selection",id:"convertTapsFakes"}]},{type:"dropdown",title:"Mirror",options:[{type:"selection",id:"mirrorHorizontally"},{type:"selection",id:"mirrorVertically"},{type:"selection",id:"mirrorBoth"}]},{type:"dropdown",title:"Stretch",options:[{type:"selection",id:"expand2to1"},{type:"selection",id:"expand3to2"},{type:"selection",id:"expand4to3"},{type:"seperator"},{type:"selection",id:"compress1to2"},{type:"selection",id:"compress2to3"},{type:"selection",id:"compress3to4"}]},{type:"seperator"},{type:"selection",id:"selectAll"}]},audio:{type:"menu",title:"Audio",options:[{type:"selection",id:"adjustOffset"},{type:"checkbox",id:"assistTick",checked:()=>W.audio.assistTick},{type:"checkbox",id:"metronome",checked:()=>W.audio.metronome},{type:"seperator"},{type:"dropdown",title:()=>"Volume ("+Math.round(W.audio.songVolume*100)+"%)",options:[{type:"selection",id:"volumeUp"},{type:"selection",id:"volumeDown"}]},{type:"dropdown",title:()=>"Effect Volume ("+Math.round(W.audio.soundEffectVolume*100)+"%)",options:[{type:"selection",id:"effectvolumeUp"},{type:"selection",id:"effectvolumeDown"}]},{type:"dropdown",title:()=>"Rate ("+Math.round(W.audio.rate*100)+"%)",options:[{type:"selection",id:"rateUp"},{type:"selection",id:"rateDown"},{type:"seperator"},{type:"selection",id:"rateDefault"}]},{type:"seperator"},{type:"selection",id:"showEq"}]},help:{type:"menu",title:"Help",options:[{type:"selection",id:"options"}]}};class VR{constructor(t,e){P(this,"app");P(this,"view");this.app=t,this.view=e;const r=Object.values(zR).map(n=>this.createElement(n));e.replaceChildren(...r)}createElement(t){if(t.type=="seperator"){const e=document.createElement("div");return e.classList.add("seperator"),e}if(t.type=="selection"||t.type=="checkbox"||t.type=="dropdown"){const e=document.createElement("div"),r=document.createElement("div"),n=document.createElement("div");let s;if(t.type=="selection"||t.type=="checkbox"){const a=Is[t.id];s=document.createElement("div"),s.innerText=Mo.getKeybindString(t.id),s.classList.add("keybind","unselectable"),n.innerText=a.label;let o=a.disabled;typeof o=="function"&&(o=o(this.app)),o&&e.classList.add("disabled"),e.addEventListener("click",()=>{if(o)return;a.callback(this.app),e.closest(".menu-main").querySelector(".menubar-dropdown").replaceChildren()})}else s=document.createElement("img"),s.classList.add("icon"),s.src=oi.CHEVRON,s.style.transform="rotate(-90deg)",n.innerText=typeof t.title=="function"?t.title(this.app):t.title;if(r.appendChild(n),r.appendChild(s),e.appendChild(r),e.classList.add("menu-item"),r.classList.add("menu-item-title","menu-hover"),n.classList.add("title","unselectable"),t.type=="dropdown"){const a=document.createElement("div");e.appendChild(a),a.classList.add("menubar-dropdown"),t.options.map(o=>this.createElement(o)).forEach(o=>a.appendChild(o))}if(t.type=="checkbox"){let a=t.checked;typeof a=="function"&&(a=a(this.app)),a&&(n.innerText="\u2713 "+n.innerText)}return e}if(t.type=="menu"){const e=document.createElement("div"),r=document.createElement("div"),n=document.createElement("div");return e.appendChild(r),r.innerText=t.title,e.appendChild(n),r.classList.add("title","unselectable"),e.classList.add("menu-item","menu-main"),r.classList.add("menu-hover"),n.classList.add("menubar-dropdown","unselectable"),e.onmouseenter=()=>{n.replaceChildren(...t.options.map(s=>this.createElement(s)))},e.onmouseleave=()=>{n.replaceChildren()},e}return document.createElement("div")}}const XR=`#TITLE:New Song;
#SUBTITLE:;
#ARTIST:;
#TITLETRANSLIT:;
#SUBTITLETRANSLIT:;
#ARTISTTRANSLIT:;
#GENRE:;
#CREDIT:;
#BANNER:;
#BACKGROUND:;
#LYRICSPATH:;
#CDTITLE:;
#MUSIC:;
#OFFSET:0;
#SAMPLESTART:0.000000;
#SAMPLELENGTH:0.000000;
#SELECTABLE:YES;
#BPMS:0.000000=120.000000;
#STOPS:;
#BGCHANGES:;
#FGCHANGES:;
#KEYSOUNDS:;
#ATTACKS:;
`,v0={window_options:{title:"Open a Song",width:300,height:160,disableClose:!0,win_id:"select_sm_initial"},view:[{title:"Open",options:[{label:window.nw?"Open an existing song":"Import a song folder",element:i=>{const t=document.createElement("button");return t.innerHTML=window.nw?"Open...":"Upload...",t.onclick=()=>{if(window.nw){const e=document.createElement("input");e.type="file",e.accept=".sm,.ssc",e.onchange=()=>{i.chartManager.loadSM(e.value),i.windowManager.getWindowById("select_sm_initial").closeWindow()},e.click()}else i.windowManager.openWindow(new Oh(i,{title:"Select an sm/ssc file...",accepted_file_types:[".sm",".ssc"],disableClose:!0,callback:e=>{i.chartManager.loadSM(e),i.windowManager.getWindowById("select_sm_initial").closeWindow()}}))},t}}]},{title:"New",options:[{label:"Create a new song",element:i=>{const t=document.createElement("button");return t.innerHTML="New Song",t.onclick=async()=>{let e="New Song";if(await ze.getDirectoryHandle(e)){let r=2;for(;await ze.getDirectoryHandle(e);)e=`New Song ${r++}`}await ze.writeFile(e+"/song.sm",XR),await i.chartManager.loadSM(e+"/song.sm"),i.windowManager.openWindow(new xv(i,!0,async r=>{r?i.windowManager.getWindowById("select_sm_initial").closeWindow():(await ze.removeDirectory(e),i.chartManager.loadSM())}))},t}}]}]};class jR extends ss{constructor(e){super(v0.window_options);P(this,"app");this.app=e,this.initView()}initView(){this.viewElement.replaceChildren(),this.viewElement.classList.add("options");const e=document.createElement("div");e.classList.add("padding"),v0.view.forEach(r=>{const n=document.createElement("div");n.innerText=typeof r.title=="function"?r.title(this.app):r.title,n.classList.add("title"),e.appendChild(n);const s=document.createElement("div");s.classList.add("section"),r.options.forEach(a=>{const o=document.createElement("div");o.classList.add("container");const u=document.createElement("div");u.classList.add("label");const d=a.element(this.app);u.innerText=typeof a.label=="function"?a.label(this.app):a.label,o.appendChild(u),o.appendChild(d),s.appendChild(o)}),e.appendChild(s)}),this.viewElement.appendChild(e)}}class YR{constructor(t,e){P(this,"view");P(this,"windows",[]);P(this,"app");this.app=t,this.view=e}unfocusAll(){for(const t of this.view.querySelectorAll(".focused"))t.classList.remove("focused")}isBlocked(){return!this.windows.every(t=>!t.options.blocking)}openWindow(t){if(t.options.win_id){const e=this.getWindowById(t.options.win_id);if(e){e.focus();return}}t.addToManager(this),this.windows.push(t)}removeWindow(t){this.windows.splice(this.windows.indexOf(t),1)}getWindowById(t){for(const e of this.windows)if(e.options.win_id==t)return e}}class _0{constructor(){P(this,"renderer");P(this,"ticker");P(this,"stage");P(this,"view");P(this,"options");P(this,"keybinds");P(this,"chartManager");P(this,"windowManager");P(this,"menubarManager");P(this,"actionHistory");P(this,"lastWidth",window.innerWidth);P(this,"lastHeight",window.innerHeight);if(window.nw){const t=nw.Window.get();t.enterFullscreen(),window.addEventListener("keydown",e=>{(e.key=="r"&&(e.metaKey||e.ctrlKey)||e.key=="F5")&&(e.preventDefault(),t.reload())})}W.loadOptions(),setInterval(()=>W.saveOptions(),1e4),W.general.smoothAnimations&&document.body.classList.add("animated"),this.registerFonts(),this.view=document.getElementById("pixi"),this.stage=new be,this.stage.sortableChildren=!0,this.renderer=new ba({backgroundColor:1579292,antialias:W.performance.antialiasing,width:this.view.clientWidth,height:this.view.clientHeight,resolution:W.performance.resolution,autoDensity:!0,view:this.view,powerPreference:"low-power"}),this.ticker=new xi,this.ticker.maxFPS=120,this.ticker.add(()=>{wo.time("Render Time"),this.renderer.render(this.stage),wo.endTime("Render Time"),wo.endFrame()},pa.LOW),this.ticker.start(),Yn.init(this.renderer),this.options=W,this.chartManager=new WR(this),this.menubarManager=new VR(this,document.getElementById("menubar")),this.windowManager=new YR(this,document.getElementById("windows")),this.actionHistory=new tr(this),this.registerListeners(),this.keybinds=new Mo(this),this.onResize(),console.log("smeditor is currently a work in progress. check the github repo for more info!"),this.windowManager.openWindow(new jR(this)),window.onbeforeunload=t=>{if(tr.instance.isDirty()&&W.general.warnBeforeExit)return t.preventDefault(),t.returnValue="Are you sure you want to exit?"},window.onunload=()=>{W.saveOptions()}}registerFonts(){Ji.from("Main",{fontFamily:"Assistant",fontSize:20,fill:"white"},{chars:[["a","z"],["A","Z"],"!@#$%^&*()~{}[]:.-?=,","0123456789/"," "],resolution:window.devicePixelRatio}),Ji.from("Fancy",{fontFamily:"Assistant",fontSize:40,fontWeight:"700",fill:["#dddddd","#ffffff"],fillGradientType:Ph.LINEAR_VERTICAL,stroke:11184810,strokeThickness:3},{chars:[["a","z"],["A","Z"],"!@#$%^&*()~{}[]:.-?=,","0123456789/"," "],resolution:window.devicePixelRatio})}registerListeners(){window.addEventListener("keydown",function(t){t.code=="Tab"&&t.preventDefault(),t.code=="Enter"&&t.target instanceof HTMLButtonElement&&t.preventDefault()}),window.addEventListener("dragstart",function(t){t.target instanceof HTMLImageElement&&t.preventDefault()}),setInterval(()=>{(this.lastHeight!=window.innerHeight||this.lastWidth!=window.innerWidth)&&(this.lastHeight=window.innerHeight,this.lastWidth=window.innerWidth,this.onResize(),ve.emit("resize"))},100),window.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy"}),window.addEventListener("drop",t=>{if(window.nw){t.stopPropagation(),t.preventDefault();let e="";for(const r of t.dataTransfer.files)if(r.path)if(wn(r.path)==".ssc"){e=r.path;break}else e==""&&wn(r.path)==".sm"&&(e=r.path);e!=""&&(this.chartManager.loadSM(e),this.windowManager.getWindowById("select_sm_initial")?.closeWindow())}else ze.handleDropEvent(t).then(e=>{const r=new Oh(this,{title:"Select an sm/ssc file...",accepted_file_types:[".sm",".ssc"],disableClose:!0,callback:n=>{this.chartManager.loadSM(n),this.windowManager.getWindowById("select_sm_initial")?.closeWindow()},onload:()=>{r.getAcceptableFile(e??"").then(n=>r.selectPath(n))}});this.windowManager.openWindow(r)})})}onResize(){const t=window.innerWidth,e=window.innerHeight-document.getElementById("menubar").clientHeight;this.renderer.screen.width=t,this.renderer.screen.height=e,this.view.width=t*this.renderer.resolution,this.view.height=e*this.renderer.resolution,this.view.style.width=`${t}px`,this.view.style.height=`${e}px`}}document.querySelector("body").innerHTML=`<div id="view-wrapper"> 
            <div id="menubar"></div>
            <div id="waterfall"></div>
            <canvas id="pixi"></canvas>
          </div> 
          <div id="blocker" style="display: none"></div>
          <div id="windows"></div>
        `;Q2.load({google:{families:["Assistant:200,300,400,500,600,700,800"]},active:w0,inactive:w0,classes:!1});window.fs=ze;function w0(){const i=document.createElement("canvas");i.getContext("webgl")||i.getContext("experimental-webgl")?lv().includes("Safari")?(document.querySelector("body").innerHTML=`<div class='browser-unsupported'>
      <div class='browser-unsupported-item'>
      <h1>Safari is currently not supported</h1>
      <div>Please use Chrome/Firefox instead.</div>
      <div class='browser-unsupported-detail'>Check the console for more info.</div>
      </div>
    </div>`,console.log(`SMEditor is not supported for Safari due to various issues involving rendering and sound.
      PIXI.js, the library used in SMEditor, takes an extremely long time to load and does not perform well on Safari.
      Additionally, many audio files cannot be played in Safari.
      If you still want to try loading SMEditor, run the command runSafari()`),window.runSafari=()=>{document.querySelector("body").innerHTML=`<div id="view-wrapper"> 
            <div id="menubar"></div>
            <div id="waterfall"></div>
            <canvas id="pixi"></canvas>
          </div> 
          <div id="blocker" style="display: none"></div>
          <div id="windows"></div>
        `,window.app=new _0,window.runSafari=void 0}):window.app=new _0:document.querySelector("body").innerHTML=`<div class='browser-unsupported'>
      <div class='browser-unsupported-item'>
      <h1>WebGL is not enabled</h1>
      <div>Please visit your browser settings and enable WebGL.</div>
      </div>
    </div>`}export{rR as F,_a as _,ZR as a,Mf as b,hi as c,qR as g};
