var rE=Object.defineProperty;var nE=(i,t,e)=>t in i?rE(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var L=(i,t,e)=>(nE(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();var wa=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(wa||{}),Fd=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(Fd||{}),ce=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(ce||{}),wn=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(wn||{}),Yt=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(Yt||{}),fo=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(fo||{}),ue=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(ue||{}),Od=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(Od||{}),qn=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(qn||{}),Ms=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(Ms||{}),En=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(En||{}),hn=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(hn||{}),ta=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(ta||{}),df=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(df||{}),jr=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(jr||{}),ki=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(ki||{}),Ti=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(Ti||{}),An=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(An||{});const sE={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t)};var ed=/iPhone/i,zm=/iPod/i,Vm=/iPad/i,jm=/\biOS-universal(?:.+)Mac\b/i,id=/\bAndroid(?:.+)Mobile\b/i,Xm=/Android/i,Za=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Tl=/Silk/i,Vn=/Windows Phone/i,Ym=/\bWindows(?:.+)ARM\b/i,$m=/BlackBerry/i,qm=/BB10/i,Km=/Opera Mini/i,Zm=/\b(CriOS|Chrome)(?:.+)Mobile/i,Qm=/Mobile(?:.+)Firefox\b/i,Jm=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function aE(i){return function(t){return t.test(i)}}function oE(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var n=aE(e),s={apple:{phone:n(ed)&&!n(Vn),ipod:n(zm),tablet:!n(ed)&&(n(Vm)||Jm(t))&&!n(Vn),universal:n(jm),device:(n(ed)||n(zm)||n(Vm)||n(jm)||Jm(t))&&!n(Vn)},amazon:{phone:n(Za),tablet:!n(Za)&&n(Tl),device:n(Za)||n(Tl)},android:{phone:!n(Vn)&&n(Za)||!n(Vn)&&n(id),tablet:!n(Vn)&&!n(Za)&&!n(id)&&(n(Tl)||n(Xm)),device:!n(Vn)&&(n(Za)||n(Tl)||n(id)||n(Xm))||n(/\bokhttp\b/i)},windows:{phone:n(Vn),tablet:n(Ym),device:n(Vn)||n(Ym)},other:{blackberry:n($m),blackberry10:n(qm),opera:n(Km),firefox:n(Qm),chrome:n(Zm),device:n($m)||n(qm)||n(Km)||n(Qm)||n(Zm)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const Kn=oE(globalThis.navigator);function hE(){return!Kn.apple.device}function lE(i){let t=!0;if(Kn.tablet||Kn.phone){if(Kn.apple.device){const e=navigator.userAgent.match(/OS (\d+)_(\d+)?/);e&&parseInt(e[1],10)<11&&(t=!1)}if(Kn.android.device){const e=navigator.userAgent.match(/Android\s([0-9.]*)/);e&&parseInt(e[1],10)<7&&(t=!1)}}return t?i:4}const jt={ADAPTER:sE,MIPMAP_TEXTURES:En.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:Ti.NONE,SPRITE_MAX_TEXTURES:lE(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},GC_MODE:df.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:Ms.CLAMP,SCALE_MODE:qn.LINEAR,PRECISION_VERTEX:jr.HIGH,PRECISION_FRAGMENT:Kn.apple.device?jr.HIGH:jr.MEDIUM,CAN_UPLOAD_SAME_BUFFER:hE(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};jt.PREFER_ENV=wa.WEBGL2;jt.STRICT_TEXTURE_CACHE=!1;var Jt=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(Jt||{});const tg=i=>{if((typeof i=="function"||typeof i=="object"&&i.extension)&&(i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}),typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},he={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(tg).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...i){return i.map(tg).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,n=this._queue;r[e]?r[e](t):(n[e]=n[e]||[],n[e].push(t))})}),this},handle(i,t,e){const r=this._addHandlers,n=this._removeHandlers;r[i]=t,n[i]=e;const s=this._queue;return s[i]&&(s[i].forEach(a=>t(a)),delete s[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t){return this.handle(i,e=>{t.includes(e.ref)||(t.push(e.ref),t.sort((r,n)=>(n.priority??-1)-(r.priority??-1)))},e=>{const r=t.indexOf(e.ref);r!==-1&&t.splice(r,1)})}},dc=Math.PI*2,cE=180/Math.PI,uE=Math.PI/180;var Yi=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(Yi||{});class Ue{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Ue(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}const Sl=[new Ue,new Ue,new Ue,new Ue];class Te{constructor(t=0,e=0,r=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(n),this.type=Yi.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Te(0,0,0,0)}clone(){return new Te(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const it=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=it)return!1;const st=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>st}const r=this.left,n=this.right,s=this.top,a=this.bottom;if(n<=r||a<=s)return!1;const h=Sl[0].set(t.left,t.top),u=Sl[1].set(t.left,t.bottom),d=Sl[2].set(t.right,t.top),m=Sl[3].set(t.right,t.bottom);if(d.x<=h.x||u.y<=h.y)return!1;const l=Math.sign(e.a*e.d-e.b*e.c);if(l===0||(e.apply(h,h),e.apply(u,u),e.apply(d,d),e.apply(m,m),Math.max(h.x,u.x,d.x,m.x)<=r||Math.min(h.x,u.x,d.x,m.x)>=n||Math.max(h.y,u.y,d.y,m.y)<=s||Math.min(h.y,u.y,d.y,m.y)>=a))return!1;const f=l*(u.y-h.y),p=l*(h.x-u.x),y=f*r+p*s,_=f*n+p*s,v=f*r+p*a,w=f*n+p*a;if(Math.max(y,_,v,w)<=f*h.x+p*h.y||Math.min(y,_,v,w)>=f*m.x+p*m.y)return!1;const C=l*(h.y-d.y),E=l*(d.x-h.x),k=C*r+E*s,G=C*n+E*s,Q=C*r+E*a,Y=C*n+E*a;return!(Math.max(k,G,Q,Y)<=C*h.x+E*h.y||Math.min(k,G,Q,Y)>=C*m.x+E*m.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=s-n,this}}class ff{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=Yi.CIRC}clone(){return new ff(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=r}getBounds(){return new Te(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}class pf{constructor(t=0,e=0,r=0,n=0){this.x=t,this.y=e,this.width=r,this.height=n,this.type=Yi.ELIP}clone(){return new pf(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,n=(e-this.y)/this.height;return r*=r,n*=n,r+n<=1}getBounds(){return new Te(this.x-this.width,this.y-this.height,this.width,this.height)}}class po{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const r=[];for(let n=0,s=e.length;n<s;n++)r.push(e[n].x,e[n].y);e=r}this.points=e,this.type=Yi.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new po(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const n=this.points.length/2;for(let s=0,a=n-1;s<n;a=s++){const h=this.points[s*2],u=this.points[s*2+1],d=this.points[a*2],m=this.points[a*2+1];u>e!=m>e&&t<(d-h)*((e-u)/(m-u))+h&&(r=!r)}return r}}class mf{constructor(t=0,e=0,r=0,n=0,s=20){this.x=t,this.y=e,this.width=r,this.height=n,this.radius=s,this.type=Yi.RREC}clone(){return new mf(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let n=t-(this.x+r),s=e-(this.y+r);const a=r*r;if(n*n+s*s<=a||(n=t-(this.x+this.width-r),n*n+s*s<=a)||(s=e-(this.y+this.height-r),n*n+s*s<=a)||(n=t-(this.x+r),n*n+s*s<=a))return!0}return!1}}class Ss{constructor(t,e,r=0,n=0){this._x=r,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Ss(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}class yi{constructor(t=1,e=0,r=0,n=1,s=0,a=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,n,s,a){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new Ue;const r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e}applyInverse(t,e){e=e||new Ue;const r=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*r*n+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*s+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),n=this.a,s=this.c,a=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=s*e-this.d*r,this.d=s*r+this.d*e,this.tx=a*e-this.ty*r,this.ty=a*r+this.ty*e,this}append(t){const e=this.a,r=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*s+this.ty,this}setTransform(t,e,r,n,s,a,h,u,d){return this.a=Math.cos(h+d)*s,this.b=Math.sin(h+d)*s,this.c=-Math.sin(h-u)*a,this.d=Math.cos(h-u)*a,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,n=this.c,s=this.d,a=t.pivot,h=-Math.atan2(-n,s),u=Math.atan2(r,e),d=Math.abs(h+u);return d<1e-5||Math.abs(dc-d)<1e-5?(t.rotation=u,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=h,t.skew.y=u),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(a.x*e+a.y*n),t.position.y=this.ty+(a.x*r+a.y*s),t}invert(){const t=this.a,e=this.b,r=this.c,n=this.d,s=this.tx,a=t*n-e*r;return this.a=n/a,this.b=-e/a,this.c=-r/a,this.d=t/a,this.tx=(r*this.ty-n*s)/a,this.ty=-(t*this.ty-e*s)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new yi;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new yi}static get TEMP_MATRIX(){return new yi}}const ea=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ia=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ra=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],na=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Nd=[],b0=[],Cl=Math.sign;function dE(){for(let i=0;i<16;i++){const t=[];Nd.push(t);for(let e=0;e<16;e++){const r=Cl(ea[i]*ea[e]+ra[i]*ia[e]),n=Cl(ia[i]*ea[e]+na[i]*ia[e]),s=Cl(ea[i]*ra[e]+ra[i]*na[e]),a=Cl(ia[i]*ra[e]+na[i]*na[e]);for(let h=0;h<16;h++)if(ea[h]===r&&ia[h]===n&&ra[h]===s&&na[h]===a){t.push(h);break}}}for(let i=0;i<16;i++){const t=new yi;t.set(ea[i],ia[i],ra[i],na[i],0,0),b0.push(t)}}dE();const hi={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>ea[i],uY:i=>ia[i],vX:i=>ra[i],vY:i=>na[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>Nd[i][t],sub:(i,t)=>Nd[i][hi.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?hi.S:hi.N:Math.abs(t)*2<=Math.abs(i)?i>0?hi.E:hi.W:t>0?i>0?hi.SE:hi.SW:i>0?hi.NE:hi.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const n=b0[hi.inv(t)];n.tx=e,n.ty=r,i.append(n)}},x0=class{constructor(){this.worldTransform=new yi,this.localTransform=new yi,this.position=new Ss(this.onChange,this,0,0),this.scale=new Ss(this.onChange,this,1,1),this.pivot=new Ss(this.onChange,this,0,0),this.skew=new Ss(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};let Rc=x0;Rc.IDENTITY=new x0;class nn{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,n,s,a,h,u){if(arguments.length>8)throw new Error("max arguments reached");const{name:d,items:m}=this;this._aliasCount++;for(let l=0,f=m.length;l<f;l++)m[l][d](t,e,r,n,s,a,h,u);return m===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(nn.prototype,{dispatch:{value:nn.prototype.emit},run:{value:nn.prototype.emit}});jt.TARGET_FPMS=.06;var pa=(i=>(i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(pa||{});class rd{constructor(t,e=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}class xi{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new rd(null,null,1/0),this.deltaMS=1/jt.TARGET_FPMS,this.elapsedMS=1/jt.TARGET_FPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=pa.NORMAL){return this._addListener(new rd(t,e,r))}addOnce(t,e,r=pa.NORMAL){return this._addListener(new rd(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*jt.TARGET_FPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,jt.TARGET_FPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!xi._shared){const t=xi._shared=new xi;t.autoStart=!0,t._protected=!0}return xi._shared}static get system(){if(!xi._system){const t=xi._system=new xi;t.autoStart=!0,t._protected=!0}return xi._system}}class A0{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,pa.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?xi.shared:new xi,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}A0.extension=Jt.Application;he.add(A0);var si=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function iP(i){var t=i.default;if(typeof t=="function"){var e=function(){return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),e}var E0={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function n(u,d,m){this.fn=u,this.context=d,this.once=m||!1}function s(u,d,m,l,f){if(typeof m!="function")throw new TypeError("The listener must be a function");var p=new n(m,l||u,f),y=e?e+d:d;return u._events[y]?u._events[y].fn?u._events[y]=[u._events[y],p]:u._events[y].push(p):(u._events[y]=p,u._eventsCount++),u}function a(u,d){--u._eventsCount===0?u._events=new r:delete u._events[d]}function h(){this._events=new r,this._eventsCount=0}h.prototype.eventNames=function(){var d=[],m,l;if(this._eventsCount===0)return d;for(l in m=this._events)t.call(m,l)&&d.push(e?l.slice(1):l);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(m)):d},h.prototype.listeners=function(d){var m=e?e+d:d,l=this._events[m];if(!l)return[];if(l.fn)return[l.fn];for(var f=0,p=l.length,y=new Array(p);f<p;f++)y[f]=l[f].fn;return y},h.prototype.listenerCount=function(d){var m=e?e+d:d,l=this._events[m];return l?l.fn?1:l.length:0},h.prototype.emit=function(d,m,l,f,p,y){var _=e?e+d:d;if(!this._events[_])return!1;var v=this._events[_],w=arguments.length,C,E;if(v.fn){switch(v.once&&this.removeListener(d,v.fn,void 0,!0),w){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,m),!0;case 3:return v.fn.call(v.context,m,l),!0;case 4:return v.fn.call(v.context,m,l,f),!0;case 5:return v.fn.call(v.context,m,l,f,p),!0;case 6:return v.fn.call(v.context,m,l,f,p,y),!0}for(E=1,C=new Array(w-1);E<w;E++)C[E-1]=arguments[E];v.fn.apply(v.context,C)}else{var k=v.length,G;for(E=0;E<k;E++)switch(v[E].once&&this.removeListener(d,v[E].fn,void 0,!0),w){case 1:v[E].fn.call(v[E].context);break;case 2:v[E].fn.call(v[E].context,m);break;case 3:v[E].fn.call(v[E].context,m,l);break;case 4:v[E].fn.call(v[E].context,m,l,f);break;default:if(!C)for(G=1,C=new Array(w-1);G<w;G++)C[G-1]=arguments[G];v[E].fn.apply(v[E].context,C)}}return!0},h.prototype.on=function(d,m,l){return s(this,d,m,l,!1)},h.prototype.once=function(d,m,l){return s(this,d,m,l,!0)},h.prototype.removeListener=function(d,m,l,f){var p=e?e+d:d;if(!this._events[p])return this;if(!m)return a(this,p),this;var y=this._events[p];if(y.fn)y.fn===m&&(!f||y.once)&&(!l||y.context===l)&&a(this,p);else{for(var _=0,v=[],w=y.length;_<w;_++)(y[_].fn!==m||f&&!y[_].once||l&&y[_].context!==l)&&v.push(y[_]);v.length?this._events[p]=v.length===1?v[0]:v:a(this,p)}return this},h.prototype.removeAllListeners=function(d){var m;return d?(m=e?e+d:d,this._events[m]&&a(this,m)):(this._events=new r,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=e,h.EventEmitter=h,i.exports=h})(E0);const Co=E0.exports;var gf={exports:{}};gf.exports=kc;gf.exports.default=kc;function kc(i,t,e){e=e||2;var r=t&&t.length,n=r?t[0]*e:i.length,s=T0(i,0,n,e,!0),a=[];if(!s||s.next===s.prev)return a;var h,u,d,m,l,f,p;if(r&&(s=yE(i,t,s,e)),i.length>80*e){h=d=i[0],u=m=i[1];for(var y=e;y<n;y+=e)l=i[y],f=i[y+1],l<h&&(h=l),f<u&&(u=f),l>d&&(d=l),f>m&&(m=f);p=Math.max(d-h,m-u),p=p!==0?32767/p:0}return xh(s,a,e,h,u,p,0),a}function T0(i,t,e,r,n){var s,a;if(n===Gd(i,t,e,r)>0)for(s=t;s<e;s+=r)a=eg(s,i[s],i[s+1],a);else for(s=e-r;s>=t;s-=r)a=eg(s,i[s],i[s+1],a);return a&&Pc(a,a.next)&&(Eh(a),a=a.next),a}function ma(i,t){if(!i)return i;t||(t=i);var e=i,r;do if(r=!1,!e.steiner&&(Pc(e,e.next)||ci(e.prev,e,e.next)===0)){if(Eh(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function xh(i,t,e,r,n,s,a){if(!!i){!a&&s&&xE(i,r,n,s);for(var h=i,u,d;i.prev!==i.next;){if(u=i.prev,d=i.next,s?pE(i,r,n,s):fE(i)){t.push(u.i/e|0),t.push(i.i/e|0),t.push(d.i/e|0),Eh(i),i=d.next,h=d.next;continue}if(i=d,i===h){a?a===1?(i=mE(ma(i),t,e),xh(i,t,e,r,n,s,2)):a===2&&gE(i,t,e,r,n,s):xh(ma(i),t,e,r,n,s,1);break}}}}function fE(i){var t=i.prev,e=i,r=i.next;if(ci(t,e,r)>=0)return!1;for(var n=t.x,s=e.x,a=r.x,h=t.y,u=e.y,d=r.y,m=n<s?n<a?n:a:s<a?s:a,l=h<u?h<d?h:d:u<d?u:d,f=n>s?n>a?n:a:s>a?s:a,p=h>u?h>d?h:d:u>d?u:d,y=r.next;y!==t;){if(y.x>=m&&y.x<=f&&y.y>=l&&y.y<=p&&so(n,h,s,u,a,d,y.x,y.y)&&ci(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function pE(i,t,e,r){var n=i.prev,s=i,a=i.next;if(ci(n,s,a)>=0)return!1;for(var h=n.x,u=s.x,d=a.x,m=n.y,l=s.y,f=a.y,p=h<u?h<d?h:d:u<d?u:d,y=m<l?m<f?m:f:l<f?l:f,_=h>u?h>d?h:d:u>d?u:d,v=m>l?m>f?m:f:l>f?l:f,w=Ud(p,y,t,e,r),C=Ud(_,v,t,e,r),E=i.prevZ,k=i.nextZ;E&&E.z>=w&&k&&k.z<=C;){if(E.x>=p&&E.x<=_&&E.y>=y&&E.y<=v&&E!==n&&E!==a&&so(h,m,u,l,d,f,E.x,E.y)&&ci(E.prev,E,E.next)>=0||(E=E.prevZ,k.x>=p&&k.x<=_&&k.y>=y&&k.y<=v&&k!==n&&k!==a&&so(h,m,u,l,d,f,k.x,k.y)&&ci(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;E&&E.z>=w;){if(E.x>=p&&E.x<=_&&E.y>=y&&E.y<=v&&E!==n&&E!==a&&so(h,m,u,l,d,f,E.x,E.y)&&ci(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;k&&k.z<=C;){if(k.x>=p&&k.x<=_&&k.y>=y&&k.y<=v&&k!==n&&k!==a&&so(h,m,u,l,d,f,k.x,k.y)&&ci(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function mE(i,t,e){var r=i;do{var n=r.prev,s=r.next.next;!Pc(n,s)&&S0(n,r,r.next,s)&&Ah(n,s)&&Ah(s,n)&&(t.push(n.i/e|0),t.push(r.i/e|0),t.push(s.i/e|0),Eh(r),Eh(r.next),r=i=s),r=r.next}while(r!==i);return ma(r)}function gE(i,t,e,r,n,s){var a=i;do{for(var h=a.next.next;h!==a.prev;){if(a.i!==h.i&&TE(a,h)){var u=C0(a,h);a=ma(a,a.next),u=ma(u,u.next),xh(a,t,e,r,n,s,0),xh(u,t,e,r,n,s,0);return}h=h.next}a=a.next}while(a!==i)}function yE(i,t,e,r){var n=[],s,a,h,u,d;for(s=0,a=t.length;s<a;s++)h=t[s]*r,u=s<a-1?t[s+1]*r:i.length,d=T0(i,h,u,r,!1),d===d.next&&(d.steiner=!0),n.push(EE(d));for(n.sort(_E),s=0;s<n.length;s++)e=vE(n[s],e);return e}function _E(i,t){return i.x-t.x}function vE(i,t){var e=wE(i,t);if(!e)return t;var r=C0(e,i);return ma(r,r.next),ma(e,e.next)}function wE(i,t){var e=t,r=i.x,n=i.y,s=-1/0,a;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var h=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(h<=r&&h>s&&(s=h,a=e.x<e.next.x?e:e.next,h===r))return a}e=e.next}while(e!==t);if(!a)return null;var u=a,d=a.x,m=a.y,l=1/0,f;e=a;do r>=e.x&&e.x>=d&&r!==e.x&&so(n<m?r:s,n,d,m,n<m?s:r,n,e.x,e.y)&&(f=Math.abs(n-e.y)/(r-e.x),Ah(e,i)&&(f<l||f===l&&(e.x>a.x||e.x===a.x&&bE(a,e)))&&(a=e,l=f)),e=e.next;while(e!==u);return a}function bE(i,t){return ci(i.prev,i,t.prev)<0&&ci(t.next,i,i.next)<0}function xE(i,t,e,r){var n=i;do n.z===0&&(n.z=Ud(n.x,n.y,t,e,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==i);n.prevZ.nextZ=null,n.prevZ=null,AE(n)}function AE(i){var t,e,r,n,s,a,h,u,d=1;do{for(e=i,i=null,s=null,a=0;e;){for(a++,r=e,h=0,t=0;t<d&&(h++,r=r.nextZ,!!r);t++);for(u=d;h>0||u>0&&r;)h!==0&&(u===0||!r||e.z<=r.z)?(n=e,e=e.nextZ,h--):(n=r,r=r.nextZ,u--),s?s.nextZ=n:i=n,n.prevZ=s,s=n;e=r}s.nextZ=null,d*=2}while(a>1);return i}function Ud(i,t,e,r,n){return i=(i-e)*n|0,t=(t-r)*n|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function EE(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function so(i,t,e,r,n,s,a,h){return(n-a)*(t-h)>=(i-a)*(s-h)&&(i-a)*(r-h)>=(e-a)*(t-h)&&(e-a)*(s-h)>=(n-a)*(r-h)}function TE(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!SE(i,t)&&(Ah(i,t)&&Ah(t,i)&&CE(i,t)&&(ci(i.prev,i,t.prev)||ci(i,t.prev,t))||Pc(i,t)&&ci(i.prev,i,i.next)>0&&ci(t.prev,t,t.next)>0)}function ci(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function Pc(i,t){return i.x===t.x&&i.y===t.y}function S0(i,t,e,r){var n=Il(ci(i,t,e)),s=Il(ci(i,t,r)),a=Il(ci(e,r,i)),h=Il(ci(e,r,t));return!!(n!==s&&a!==h||n===0&&Ml(i,e,t)||s===0&&Ml(i,r,t)||a===0&&Ml(e,i,r)||h===0&&Ml(e,t,r))}function Ml(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function Il(i){return i>0?1:i<0?-1:0}function SE(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&S0(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function Ah(i,t){return ci(i.prev,i,i.next)<0?ci(i,t,i.next)>=0&&ci(i,i.prev,t)>=0:ci(i,t,i.prev)<0||ci(i,i.next,t)<0}function CE(i,t){var e=i,r=!1,n=(i.x+t.x)/2,s=(i.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==i);return r}function C0(i,t){var e=new Hd(i.i,i.x,i.y),r=new Hd(t.i,t.x,t.y),n=i.next,s=t.prev;return i.next=t,t.prev=i,e.next=n,n.prev=e,r.next=e,e.prev=r,s.next=r,r.prev=s,r}function eg(i,t,e,r){var n=new Hd(i,t,e);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Eh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Hd(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}kc.deviation=function(i,t,e,r){var n=t&&t.length,s=n?t[0]*e:i.length,a=Math.abs(Gd(i,0,s,e));if(n)for(var h=0,u=t.length;h<u;h++){var d=t[h]*e,m=h<u-1?t[h+1]*e:i.length;a-=Math.abs(Gd(i,d,m,e))}var l=0;for(h=0;h<r.length;h+=3){var f=r[h]*e,p=r[h+1]*e,y=r[h+2]*e;l+=Math.abs((i[f]-i[y])*(i[p+1]-i[f+1])-(i[f]-i[p])*(i[y+1]-i[f+1]))}return a===0&&l===0?0:Math.abs((l-a)/a)};function Gd(i,t,e,r){for(var n=0,s=t,a=e-r;s<e;s+=r)n+=(i[a]-i[s])*(i[s+1]+i[a+1]),a=s;return n}kc.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},r=0,n=0;n<i.length;n++){for(var s=0;s<i[n].length;s++)for(var a=0;a<t;a++)e.vertices.push(i[n][s][a]);n>0&&(r+=i[n-1].length,e.holes.push(r))}return e};var Wd={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(i,t){(function(e){var r=t&&!t.nodeType&&t,n=i&&!i.nodeType&&i,s=typeof si=="object"&&si;(s.global===s||s.window===s||s.self===s)&&(e=s);var a,h=2147483647,u=36,d=1,m=26,l=38,f=700,p=72,y=128,_="-",v=/^xn--/,w=/[^\x20-\x7E]/,C=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},k=u-d,G=Math.floor,Q=String.fromCharCode,Y;function it(xt){throw RangeError(E[xt])}function J(xt,tt){for(var et=xt.length,Ht=[];et--;)Ht[et]=tt(xt[et]);return Ht}function st(xt,tt){var et=xt.split("@"),Ht="";et.length>1&&(Ht=et[0]+"@",xt=et[1]),xt=xt.replace(C,".");var Dt=xt.split("."),Mt=J(Dt,tt).join(".");return Ht+Mt}function gt(xt){for(var tt=[],et=0,Ht=xt.length,Dt,Mt;et<Ht;)Dt=xt.charCodeAt(et++),Dt>=55296&&Dt<=56319&&et<Ht?(Mt=xt.charCodeAt(et++),(Mt&64512)==56320?tt.push(((Dt&1023)<<10)+(Mt&1023)+65536):(tt.push(Dt),et--)):tt.push(Dt);return tt}function j(xt){return J(xt,function(tt){var et="";return tt>65535&&(tt-=65536,et+=Q(tt>>>10&1023|55296),tt=56320|tt&1023),et+=Q(tt),et}).join("")}function Z(xt){return xt-48<10?xt-22:xt-65<26?xt-65:xt-97<26?xt-97:u}function T(xt,tt){return xt+22+75*(xt<26)-((tt!=0)<<5)}function ut(xt,tt,et){var Ht=0;for(xt=et?G(xt/f):xt>>1,xt+=G(xt/tt);xt>k*m>>1;Ht+=u)xt=G(xt/k);return G(Ht+(k+1)*xt/(xt+l))}function Pt(xt){var tt=[],et=xt.length,Ht,Dt=0,Mt=y,te=p,re,Xt,qt,le,ne,ye,fe,S,At;for(re=xt.lastIndexOf(_),re<0&&(re=0),Xt=0;Xt<re;++Xt)xt.charCodeAt(Xt)>=128&&it("not-basic"),tt.push(xt.charCodeAt(Xt));for(qt=re>0?re+1:0;qt<et;){for(le=Dt,ne=1,ye=u;qt>=et&&it("invalid-input"),fe=Z(xt.charCodeAt(qt++)),(fe>=u||fe>G((h-Dt)/ne))&&it("overflow"),Dt+=fe*ne,S=ye<=te?d:ye>=te+m?m:ye-te,!(fe<S);ye+=u)At=u-S,ne>G(h/At)&&it("overflow"),ne*=At;Ht=tt.length+1,te=ut(Dt-le,Ht,le==0),G(Dt/Ht)>h-Mt&&it("overflow"),Mt+=G(Dt/Ht),Dt%=Ht,tt.splice(Dt++,0,Mt)}return j(tt)}function pt(xt){var tt,et,Ht,Dt,Mt,te,re,Xt,qt,le,ne,ye=[],fe,S,At,_t;for(xt=gt(xt),fe=xt.length,tt=y,et=0,Mt=p,te=0;te<fe;++te)ne=xt[te],ne<128&&ye.push(Q(ne));for(Ht=Dt=ye.length,Dt&&ye.push(_);Ht<fe;){for(re=h,te=0;te<fe;++te)ne=xt[te],ne>=tt&&ne<re&&(re=ne);for(S=Ht+1,re-tt>G((h-et)/S)&&it("overflow"),et+=(re-tt)*S,tt=re,te=0;te<fe;++te)if(ne=xt[te],ne<tt&&++et>h&&it("overflow"),ne==tt){for(Xt=et,qt=u;le=qt<=Mt?d:qt>=Mt+m?m:qt-Mt,!(Xt<le);qt+=u)_t=Xt-le,At=u-le,ye.push(Q(T(le+_t%At,0))),Xt=G(_t/At);ye.push(Q(T(Xt,0))),Mt=ut(et,S,Ht==Dt),et=0,++Ht}++et,++tt}return ye.join("")}function Gt(xt){return st(xt,function(tt){return v.test(tt)?Pt(tt.slice(4).toLowerCase()):tt})}function bt(xt){return st(xt,function(tt){return w.test(tt)?"xn--"+pt(tt):tt})}if(a={version:"1.3.2",ucs2:{decode:gt,encode:j},decode:Pt,encode:pt,toASCII:bt,toUnicode:Gt},r&&n)if(i.exports==r)n.exports=a;else for(Y in a)a.hasOwnProperty(Y)&&(r[Y]=a[Y]);else e.punycode=a})(si)})(Wd,Wd.exports);var ME={isString:function(i){return typeof i=="string"},isObject:function(i){return typeof i=="object"&&i!==null},isNull:function(i){return i===null},isNullOrUndefined:function(i){return i==null}},Th={};function IE(i,t){return Object.prototype.hasOwnProperty.call(i,t)}var BE=function(i,t,e,r){t=t||"&",e=e||"=";var n={};if(typeof i!="string"||i.length===0)return n;var s=/\+/g;i=i.split(t);var a=1e3;r&&typeof r.maxKeys=="number"&&(a=r.maxKeys);var h=i.length;a>0&&h>a&&(h=a);for(var u=0;u<h;++u){var d=i[u].replace(s,"%20"),m=d.indexOf(e),l,f,p,y;m>=0?(l=d.substr(0,m),f=d.substr(m+1)):(l=d,f=""),p=decodeURIComponent(l),y=decodeURIComponent(f),IE(n,p)?Array.isArray(n[p])?n[p].push(y):n[p]=[n[p],y]:n[p]=y}return n},oh=function(i){switch(typeof i){case"string":return i;case"boolean":return i?"true":"false";case"number":return isFinite(i)?i:"";default:return""}},RE=function(i,t,e,r){return t=t||"&",e=e||"=",i===null&&(i=void 0),typeof i=="object"?Object.keys(i).map(function(n){var s=encodeURIComponent(oh(n))+e;return Array.isArray(i[n])?i[n].map(function(a){return s+encodeURIComponent(oh(a))}).join(t):s+encodeURIComponent(oh(i[n]))}).join(t):r?encodeURIComponent(oh(r))+e+encodeURIComponent(oh(i)):""};Th.decode=Th.parse=BE;Th.encode=Th.stringify=RE;var kE=Wd.exports,_n=ME,PE=Dc,DE=jE,LE=VE;function sn(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var FE=/^([a-z0-9.+-]+:)/i,OE=/:[0-9]*$/,NE=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,UE=["<",">",'"',"`"," ","\r",`
`,"	"],HE=["{","}","|","\\","^","`"].concat(UE),zd=["'"].concat(HE),ig=["%","/","?",";","#"].concat(zd),rg=["/","?","#"],GE=255,ng=/^[+a-z0-9A-Z_-]{0,63}$/,WE=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,zE={javascript:!0,"javascript:":!0},Vd={javascript:!0,"javascript:":!0},mo={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},jd=Th;function Dc(i,t,e){if(i&&_n.isObject(i)&&i instanceof sn)return i;var r=new sn;return r.parse(i,t,e),r}sn.prototype.parse=function(i,t,e){if(!_n.isString(i))throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),n=r!==-1&&r<i.indexOf("#")?"?":"#",s=i.split(n),a=/\\/g;s[0]=s[0].replace(a,"/"),i=s.join(n);var h=i;if(h=h.trim(),!e&&i.split("#").length===1){var u=NE.exec(h);if(u)return this.path=h,this.href=h,this.pathname=u[1],u[2]?(this.search=u[2],t?this.query=jd.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var d=FE.exec(h);if(d){d=d[0];var m=d.toLowerCase();this.protocol=m,h=h.substr(d.length)}if(e||d||h.match(/^\/\/[^@\/]+@[^@\/]+/)){var l=h.substr(0,2)==="//";l&&!(d&&Vd[d])&&(h=h.substr(2),this.slashes=!0)}if(!Vd[d]&&(l||d&&!mo[d])){for(var f=-1,p=0;p<rg.length;p++){var y=h.indexOf(rg[p]);y!==-1&&(f===-1||y<f)&&(f=y)}var _,v;f===-1?v=h.lastIndexOf("@"):v=h.lastIndexOf("@",f),v!==-1&&(_=h.slice(0,v),h=h.slice(v+1),this.auth=decodeURIComponent(_)),f=-1;for(var p=0;p<ig.length;p++){var y=h.indexOf(ig[p]);y!==-1&&(f===-1||y<f)&&(f=y)}f===-1&&(f=h.length),this.host=h.slice(0,f),h=h.slice(f),this.parseHost(),this.hostname=this.hostname||"";var w=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!w)for(var C=this.hostname.split(/\./),p=0,E=C.length;p<E;p++){var k=C[p];if(!!k&&!k.match(ng)){for(var G="",Q=0,Y=k.length;Q<Y;Q++)k.charCodeAt(Q)>127?G+="x":G+=k[Q];if(!G.match(ng)){var it=C.slice(0,p),J=C.slice(p+1),st=k.match(WE);st&&(it.push(st[1]),J.unshift(st[2])),J.length&&(h="/"+J.join(".")+h),this.hostname=it.join(".");break}}}this.hostname.length>GE?this.hostname="":this.hostname=this.hostname.toLowerCase(),w||(this.hostname=kE.toASCII(this.hostname));var gt=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+gt,this.href+=this.host,w&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),h[0]!=="/"&&(h="/"+h))}if(!zE[m])for(var p=0,E=zd.length;p<E;p++){var Z=zd[p];if(h.indexOf(Z)!==-1){var T=encodeURIComponent(Z);T===Z&&(T=escape(Z)),h=h.split(Z).join(T)}}var ut=h.indexOf("#");ut!==-1&&(this.hash=h.substr(ut),h=h.slice(0,ut));var Pt=h.indexOf("?");if(Pt!==-1?(this.search=h.substr(Pt),this.query=h.substr(Pt+1),t&&(this.query=jd.parse(this.query)),h=h.slice(0,Pt)):t&&(this.search="",this.query={}),h&&(this.pathname=h),mo[m]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var gt=this.pathname||"",pt=this.search||"";this.path=gt+pt}return this.href=this.format(),this};function VE(i){return _n.isString(i)&&(i=Dc(i)),i instanceof sn?i.format():sn.prototype.format.call(i)}sn.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",r=this.hash||"",n=!1,s="";this.host?n=i+this.host:this.hostname&&(n=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&_n.isObject(this.query)&&Object.keys(this.query).length&&(s=jd.stringify(this.query));var a=this.search||s&&"?"+s||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||mo[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),r&&r.charAt(0)!=="#"&&(r="#"+r),a&&a.charAt(0)!=="?"&&(a="?"+a),e=e.replace(/[?#]/g,function(h){return encodeURIComponent(h)}),a=a.replace("#","%23"),t+n+e+a+r};function jE(i,t){return Dc(i,!1,!0).resolve(t)}sn.prototype.resolve=function(i){return this.resolveObject(Dc(i,!1,!0)).format()};sn.prototype.resolveObject=function(i){if(_n.isString(i)){var t=new sn;t.parse(i,!1,!0),i=t}for(var e=new sn,r=Object.keys(this),n=0;n<r.length;n++){var s=r[n];e[s]=this[s]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var a=Object.keys(i),h=0;h<a.length;h++){var u=a[h];u!=="protocol"&&(e[u]=i[u])}return mo[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!mo[i.protocol]){for(var d=Object.keys(i),m=0;m<d.length;m++){var l=d[m];e[l]=i[l]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!Vd[i.protocol]){for(var E=(i.pathname||"").split("/");E.length&&!(i.host=E.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),E[0]!==""&&E.unshift(""),E.length<2&&E.unshift(""),e.pathname=E.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var f=e.pathname||"",p=e.search||"";e.path=f+p}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var y=e.pathname&&e.pathname.charAt(0)==="/",_=i.host||i.pathname&&i.pathname.charAt(0)==="/",v=_||y||e.host&&i.pathname,w=v,C=e.pathname&&e.pathname.split("/")||[],E=i.pathname&&i.pathname.split("/")||[],k=e.protocol&&!mo[e.protocol];if(k&&(e.hostname="",e.port=null,e.host&&(C[0]===""?C[0]=e.host:C.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(E[0]===""?E[0]=i.host:E.unshift(i.host)),i.host=null),v=v&&(E[0]===""||C[0]==="")),_)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,C=E;else if(E.length)C||(C=[]),C.pop(),C=C.concat(E),e.search=i.search,e.query=i.query;else if(!_n.isNullOrUndefined(i.search)){if(k){e.hostname=e.host=C.shift();var G=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;G&&(e.auth=G.shift(),e.host=e.hostname=G.shift())}return e.search=i.search,e.query=i.query,(!_n.isNull(e.pathname)||!_n.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!C.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var Q=C.slice(-1)[0],Y=(e.host||i.host||C.length>1)&&(Q==="."||Q==="..")||Q==="",it=0,J=C.length;J>=0;J--)Q=C[J],Q==="."?C.splice(J,1):Q===".."?(C.splice(J,1),it++):it&&(C.splice(J,1),it--);if(!v&&!w)for(;it--;it)C.unshift("..");v&&C[0]!==""&&(!C[0]||C[0].charAt(0)!=="/")&&C.unshift(""),Y&&C.join("/").substr(-1)!=="/"&&C.push("");var st=C[0]===""||C[0]&&C[0].charAt(0)==="/";if(k){e.hostname=e.host=st?"":C.length?C.shift():"";var G=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;G&&(e.auth=G.shift(),e.host=e.hostname=G.shift())}return v=v||e.host&&C.length,v&&!st&&C.unshift(""),C.length?e.pathname=C.join("/"):(e.pathname=null,e.path=null),(!_n.isNull(e.pathname)||!_n.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};sn.prototype.parseHost=function(){var i=this.host,t=OE.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};const XE={parse:PE,format:LE,resolve:DE};function Zr(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function sg(i){return i.split("?")[0].split("#")[0]}function YE(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function $E(i,t,e){return i.replace(new RegExp(YE(t),"g"),e)}function qE(i,t){let e="",r=0,n=-1,s=0,a;for(let h=0;h<=i.length;++h){if(h<i.length)a=i.charCodeAt(h);else{if(a===47)break;a=47}if(a===47){if(!(n===h-1||s===1))if(n!==h-1&&s===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const u=e.lastIndexOf("/");if(u!==e.length-1){u===-1?(e="",r=0):(e=e.slice(0,u),r=e.length-1-e.lastIndexOf("/")),n=h,s=0;continue}}else if(e.length===2||e.length===1){e="",r=0,n=h,s=0;continue}}t&&(e.length>0?e+="/..":e="..",r=2)}else e.length>0?e+=`/${i.slice(n+1,h)}`:e=i.slice(n+1,h),r=h-n-1;n=h,s=0}else a===46&&s!==-1?++s:s=-1}return e}const $i={toPosix(i){return $E(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},hasProtocol(i){return/^[^/:]+:\//.test(this.toPosix(i))},getProtocol(i){Zr(i),i=this.toPosix(i);let t="";const e=/^file:\/\/\//.exec(i),r=/^[^/:]+:\/\//.exec(i),n=/^[^/:]+:\//.exec(i);if(e||r||n){const s=e?.[0]||r?.[0]||n?.[0];t=s,i=i.slice(s.length)}return t},toAbsolute(i,t,e){if(this.isDataUrl(i))return i;const r=sg(this.toPosix(t??jt.ADAPTER.getBaseUrl())),n=sg(this.toPosix(e??this.rootname(r)));return Zr(i),i=this.toPosix(i),i.startsWith("/")?$i.join(n,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(i=this.toPosix(i),Zr(i),i.length===0)return".";let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const r=i.endsWith("/");return i=qE(i,!1),i.length>0&&r&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return Zr(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){const r=i[e];if(Zr(r),r.length>0)if(t===void 0)t=r;else{const n=i[e-1]??"";this.extname(n)?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(Zr(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let r=-1,n=!0;const s=this.getProtocol(i),a=i;i=i.slice(s.length);for(let h=i.length-1;h>=1;--h)if(t=i.charCodeAt(h),t===47){if(!n){r=h;break}}else n=!1;return r===-1?e?"/":this.isUrl(a)?s+i:s:e&&r===1?"//":s+i.slice(0,r)},rootname(i){Zr(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){Zr(i),t&&Zr(t),i=this.toPosix(i);let e=0,r=-1,n=!0,s;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let a=t.length-1,h=-1;for(s=i.length-1;s>=0;--s){const u=i.charCodeAt(s);if(u===47){if(!n){e=s+1;break}}else h===-1&&(n=!1,h=s+1),a>=0&&(u===t.charCodeAt(a)?--a===-1&&(r=s):(a=-1,r=h))}return e===r?r=h:r===-1&&(r=i.length),i.slice(e,r)}for(s=i.length-1;s>=0;--s)if(i.charCodeAt(s)===47){if(!n){e=s+1;break}}else r===-1&&(n=!1,r=s+1);return r===-1?"":i.slice(e,r)},extname(i){Zr(i),i=this.toPosix(i);let t=-1,e=0,r=-1,n=!0,s=0;for(let a=i.length-1;a>=0;--a){const h=i.charCodeAt(a);if(h===47){if(!n){e=a+1;break}continue}r===-1&&(n=!1,r=a+1),h===46?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||r===-1||s===0||s===1&&t===r-1&&t===e+1?"":i.slice(t,r)},parse(i){Zr(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=this.toPosix(i);let e=i.charCodeAt(0);const r=this.isAbsolute(i);let n;t.root=this.rootname(i),r||this.hasProtocol(i)?n=1:n=0;let s=-1,a=0,h=-1,u=!0,d=i.length-1,m=0;for(;d>=n;--d){if(e=i.charCodeAt(d),e===47){if(!u){a=d+1;break}continue}h===-1&&(u=!1,h=d+1),e===46?s===-1?s=d:m!==1&&(m=1):s!==-1&&(m=-1)}return s===-1||h===-1||m===0||m===1&&s===h-1&&s===a+1?h!==-1&&(a===0&&r?t.base=t.name=i.slice(1,h):t.base=t.name=i.slice(a,h)):(a===0&&r?(t.name=i.slice(1,s),t.base=i.slice(1,h)):(t.name=i.slice(a,s),t.base=i.slice(a,h)),t.ext=i.slice(s,h)),t.dir=this.dirname(i),t},sep:"/",delimiter:":"};jt.RETINA_PREFIX=/@([0-9\.]+)x/;jt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;let nd;function KE(){return typeof nd>"u"&&(nd=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:jt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!jt.ADAPTER.getWebGLRenderingContext())return!1;const e=jt.ADAPTER.createCanvas();let r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const n=!!(r&&r.getContextAttributes().stencil);if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,n}catch{return!1}}()),nd}var ZE="#f0f8ff",QE="#faebd7",JE="#00ffff",tT="#7fffd4",eT="#f0ffff",iT="#f5f5dc",rT="#ffe4c4",nT="#000000",sT="#ffebcd",aT="#0000ff",oT="#8a2be2",hT="#a52a2a",lT="#deb887",cT="#5f9ea0",uT="#7fff00",dT="#d2691e",fT="#ff7f50",pT="#6495ed",mT="#fff8dc",gT="#dc143c",yT="#00ffff",_T="#00008b",vT="#008b8b",wT="#b8860b",bT="#a9a9a9",xT="#006400",AT="#a9a9a9",ET="#bdb76b",TT="#8b008b",ST="#556b2f",CT="#ff8c00",MT="#9932cc",IT="#8b0000",BT="#e9967a",RT="#8fbc8f",kT="#483d8b",PT="#2f4f4f",DT="#2f4f4f",LT="#00ced1",FT="#9400d3",OT="#ff1493",NT="#00bfff",UT="#696969",HT="#696969",GT="#1e90ff",WT="#b22222",zT="#fffaf0",VT="#228b22",jT="#ff00ff",XT="#dcdcdc",YT="#f8f8ff",$T="#daa520",qT="#ffd700",KT="#808080",ZT="#008000",QT="#adff2f",JT="#808080",tS="#f0fff0",eS="#ff69b4",iS="#cd5c5c",rS="#4b0082",nS="#fffff0",sS="#f0e68c",aS="#fff0f5",oS="#e6e6fa",hS="#7cfc00",lS="#fffacd",cS="#add8e6",uS="#f08080",dS="#e0ffff",fS="#fafad2",pS="#d3d3d3",mS="#90ee90",gS="#d3d3d3",yS="#ffb6c1",_S="#ffa07a",vS="#20b2aa",wS="#87cefa",bS="#778899",xS="#778899",AS="#b0c4de",ES="#ffffe0",TS="#00ff00",SS="#32cd32",CS="#faf0e6",MS="#ff00ff",IS="#800000",BS="#66cdaa",RS="#0000cd",kS="#ba55d3",PS="#9370db",DS="#3cb371",LS="#7b68ee",FS="#00fa9a",OS="#48d1cc",NS="#c71585",US="#191970",HS="#f5fffa",GS="#ffe4e1",WS="#ffe4b5",zS="#ffdead",VS="#000080",jS="#fdf5e6",XS="#808000",YS="#6b8e23",$S="#ffa500",qS="#ff4500",KS="#da70d6",ZS="#eee8aa",QS="#98fb98",JS="#afeeee",tC="#db7093",eC="#ffefd5",iC="#ffdab9",rC="#cd853f",nC="#ffc0cb",sC="#dda0dd",aC="#b0e0e6",oC="#800080",hC="#663399",lC="#ff0000",cC="#bc8f8f",uC="#4169e1",dC="#8b4513",fC="#fa8072",pC="#f4a460",mC="#2e8b57",gC="#fff5ee",yC="#a0522d",_C="#c0c0c0",vC="#87ceeb",wC="#6a5acd",bC="#708090",xC="#708090",AC="#fffafa",EC="#00ff7f",TC="#4682b4",SC="#d2b48c",CC="#008080",MC="#d8bfd8",IC="#ff6347",BC="#40e0d0",RC="#ee82ee",kC="#f5deb3",PC="#ffffff",DC="#f5f5f5",LC="#ffff00",FC="#9acd32",OC={aliceblue:ZE,antiquewhite:QE,aqua:JE,aquamarine:tT,azure:eT,beige:iT,bisque:rT,black:nT,blanchedalmond:sT,blue:aT,blueviolet:oT,brown:hT,burlywood:lT,cadetblue:cT,chartreuse:uT,chocolate:dT,coral:fT,cornflowerblue:pT,cornsilk:mT,crimson:gT,cyan:yT,darkblue:_T,darkcyan:vT,darkgoldenrod:wT,darkgray:bT,darkgreen:xT,darkgrey:AT,darkkhaki:ET,darkmagenta:TT,darkolivegreen:ST,darkorange:CT,darkorchid:MT,darkred:IT,darksalmon:BT,darkseagreen:RT,darkslateblue:kT,darkslategray:PT,darkslategrey:DT,darkturquoise:LT,darkviolet:FT,deeppink:OT,deepskyblue:NT,dimgray:UT,dimgrey:HT,dodgerblue:GT,firebrick:WT,floralwhite:zT,forestgreen:VT,fuchsia:jT,gainsboro:XT,ghostwhite:YT,goldenrod:$T,gold:qT,gray:KT,green:ZT,greenyellow:QT,grey:JT,honeydew:tS,hotpink:eS,indianred:iS,indigo:rS,ivory:nS,khaki:sS,lavenderblush:aS,lavender:oS,lawngreen:hS,lemonchiffon:lS,lightblue:cS,lightcoral:uS,lightcyan:dS,lightgoldenrodyellow:fS,lightgray:pS,lightgreen:mS,lightgrey:gS,lightpink:yS,lightsalmon:_S,lightseagreen:vS,lightskyblue:wS,lightslategray:bS,lightslategrey:xS,lightsteelblue:AS,lightyellow:ES,lime:TS,limegreen:SS,linen:CS,magenta:MS,maroon:IS,mediumaquamarine:BS,mediumblue:RS,mediumorchid:kS,mediumpurple:PS,mediumseagreen:DS,mediumslateblue:LS,mediumspringgreen:FS,mediumturquoise:OS,mediumvioletred:NS,midnightblue:US,mintcream:HS,mistyrose:GS,moccasin:WS,navajowhite:zS,navy:VS,oldlace:jS,olive:XS,olivedrab:YS,orange:$S,orangered:qS,orchid:KS,palegoldenrod:ZS,palegreen:QS,paleturquoise:JS,palevioletred:tC,papayawhip:eC,peachpuff:iC,peru:rC,pink:nC,plum:sC,powderblue:aC,purple:oC,rebeccapurple:hC,red:lC,rosybrown:cC,royalblue:uC,saddlebrown:dC,salmon:fC,sandybrown:pC,seagreen:mC,seashell:gC,sienna:yC,silver:_C,skyblue:vC,slateblue:wC,slategray:bC,slategrey:xC,snow:AC,springgreen:EC,steelblue:TC,tan:SC,teal:CC,thistle:MC,tomato:IC,turquoise:BC,violet:RC,wheat:kC,white:PC,whitesmoke:DC,yellow:LC,yellowgreen:FC};function vo(i,t=[]){return t[0]=(i>>16&255)/255,t[1]=(i>>8&255)/255,t[2]=(i&255)/255,t}function M0(i){let t=i.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function yf(i){if(typeof i=="string"&&(i=OC[i.toLowerCase()]||i,i[0]==="#"&&(i=i.slice(1)),i.length===3)){const[t,e,r]=i;i=t+t+e+e+r+r}return parseInt(i,16)}function NC(){const i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[ce.NORMAL_NPM]=ce.NORMAL,i[ce.ADD_NPM]=ce.ADD,i[ce.SCREEN_NPM]=ce.SCREEN,t[ce.NORMAL]=ce.NORMAL_NPM,t[ce.ADD]=ce.ADD_NPM,t[ce.SCREEN]=ce.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const I0=NC();function B0(i,t){return I0[t?1:0][i]}function UC(i,t,e,r){return e=e||new Float32Array(4),r||r===void 0?(e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t):(e[0]=i[0],e[1]=i[1],e[2]=i[2]),e[3]=t,e}function _f(i,t){if(t===1)return(t*255<<24)+i;if(t===0)return 0;let e=i>>16&255,r=i>>8&255,n=i&255;return e=e*t+.5|0,r=r*t+.5|0,n=n*t+.5|0,(t*255<<24)+(e<<16)+(r<<8)+n}function R0(i,t,e,r){return e=e||new Float32Array(4),e[0]=(i>>16&255)/255,e[1]=(i>>8&255)/255,e[2]=(i&255)/255,(r||r===void 0)&&(e[0]*=t,e[1]*=t,e[2]*=t),e[3]=t,e}function HC(i,t=null){const e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let r=0,n=0;r<e;r+=6,n+=4)t[r+0]=n+0,t[r+1]=n+1,t[r+2]=n+2,t[r+3]=n+0,t[r+4]=n+2,t[r+5]=n+3;return t}function k0(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function fc(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function ag(i){return!(i&i-1)&&!!i}function og(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function go(i,t,e){const r=i.length;let n;if(t>=r||e===0)return;e=t+e>r?r-t:e;const s=r-e;for(n=t;n<s;++n)i[n]=i[n+e];i.length=s}function ao(i){return i===0?0:i<0?-1:1}let GC=0;function ga(){return++GC}const hg={},Xn=Object.create(null),Ks=Object.create(null);class lg{constructor(t,e,r){this.canvas=jt.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=r||jt.RESOLUTION,this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)}destroy(){this.context=null,this.canvas=null}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}function WC(i){let t=i.width,e=i.height;const r=i.getContext("2d",{willReadFrequently:!0}),s=r.getImageData(0,0,t,e).data,a=s.length,h={top:null,left:null,right:null,bottom:null};let u=null,d,m,l;for(d=0;d<a;d+=4)s[d+3]!==0&&(m=d/4%t,l=~~(d/4/t),h.top===null&&(h.top=l),(h.left===null||m<h.left)&&(h.left=m),(h.right===null||h.right<m)&&(h.right=m+1),(h.bottom===null||h.bottom<l)&&(h.bottom=l));return h.top!==null&&(t=h.right-h.left,e=h.bottom-h.top+1,u=r.getImageData(h.left,h.top,t,e)),{height:e,width:t,data:u}}let Bl;function zC(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location,Bl||(Bl=document.createElement("a")),Bl.href=i;const e=XE.parse(Bl.href),r=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!r||e.protocol!==t.protocol?"anonymous":""}function Bs(i,t=1){const e=jt.RETINA_PREFIX.exec(i);return e?parseFloat(e[1]):t}const Xd=[];function P0(i,t){if(!i)return null;let e="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=Xd.length-1;r>=0;--r){const n=Xd[r];if(n.test&&n.test(i,e))return new n(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Sh{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new nn("setRealSize"),this.onUpdate=new nn("update"),this.onError=new nn("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class Rh extends Sh{constructor(t,e){const{width:r,height:n}=e||{};if(!r||!n)throw new Error("BufferResource width or height invalid");super(r,n),this.data=t}upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===hn.UNPACK);const s=e.realWidth,a=e.realHeight;return r.width===s&&r.height===a?n.texSubImage2D(e.target,0,0,0,s,a,e.format,r.type,this.data):(r.width=s,r.height=a,n.texImage2D(e.target,0,r.internalFormat,s,a,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const VC={scaleMode:qn.NEAREST,format:Yt.RGBA,alphaMode:hn.NPM},ph=class extends Co{constructor(i=null,t=null){super(),t=t||{};const{alphaMode:e,mipmap:r,anisotropicLevel:n,scaleMode:s,width:a,height:h,wrapMode:u,format:d,type:m,target:l,resolution:f,resourceOptions:p}=t;i&&!(i instanceof Sh)&&(i=P0(i,p),i.internal=!0),this.resolution=f||jt.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=r??jt.MIPMAP_TEXTURES,this.anisotropicLevel=n??jt.ANISOTROPIC_LEVEL,this._wrapMode=u||jt.WRAP_MODE,this._scaleMode=s??jt.SCALE_MODE,this.format=d||Yt.RGBA,this.type=m||ue.UNSIGNED_BYTE,this.target=l||fo.TEXTURE_2D,this.alphaMode=e??hn.UNPACK,this.uid=ga(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(i)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(i){this._mipmap!==i&&(this._mipmap=i,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(i){this._scaleMode!==i&&(this._scaleMode=i,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(i){this._wrapMode!==i&&(this._wrapMode=i,this.dirtyStyleId++)}setStyle(i,t){let e;return i!==void 0&&i!==this.scaleMode&&(this.scaleMode=i,e=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,e=!0),e&&this.dirtyStyleId++,this}setSize(i,t,e){return e=e||this.resolution,this.setRealSize(i*e,t*e,e)}setRealSize(i,t,e){return this.resolution=e||this.resolution,this.width=Math.round(i)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=ag(this.realWidth)&&ag(this.realHeight)}setResolution(i){const t=this.resolution;return t===i?this:(this.resolution=i,this.valid&&(this.width=Math.round(this.width*t)/i,this.height=Math.round(this.height*t)/i,this.emit("update",this)),this._refreshPOT(),this)}setResource(i){if(this.resource===i)return this;if(this.resource)throw new Error("Resource can be set only once");return i.bind(this),this.resource=i,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(i){this.emit("error",this,i)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Ks[this.cacheId],delete Xn[this.cacheId],this.cacheId=null),this.dispose(),ph.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(i,t,e=jt.STRICT_TEXTURE_CACHE){const r=typeof i=="string";let n=null;if(r)n=i;else{if(!i._pixiId){const a=t?.pixiIdPrefix||"pixiid";i._pixiId=`${a}_${ga()}`}n=i._pixiId}let s=Ks[n];if(r&&e&&!s)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return s||(s=new ph(i,t),s.cacheId=n,ph.addToCache(s,n)),s}static fromBuffer(i,t,e,r){i=i||new Float32Array(t*e*4);const n=new Rh(i,{width:t,height:e}),s=i instanceof Float32Array?ue.FLOAT:ue.UNSIGNED_BYTE;return new ph(n,Object.assign({},VC,r||{width:t,height:e,type:s}))}static addToCache(i,t){t&&(i.textureCacheIds.includes(t)||i.textureCacheIds.push(t),Ks[t]&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Ks[t]=i)}static removeFromCache(i){if(typeof i=="string"){const t=Ks[i];if(t){const e=t.textureCacheIds.indexOf(i);return e>-1&&t.textureCacheIds.splice(e,1),delete Ks[i],t}}else if(i?.textureCacheIds){for(let t=0;t<i.textureCacheIds.length;++t)delete Ks[i.textureCacheIds[t]];return i.textureCacheIds.length=0,i}return null}};let Le=ph;Le._globalBatch=0;class D0 extends Sh{constructor(t,e){const{width:r,height:n}=e||{};super(r,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<t;s++){const a=new Le;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)!t[r]||(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Sh?this.addResourceAt(t[r],r):this.addResourceAt(P0(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const e=this.items.map(r=>r.resource).filter(r=>r).map(r=>r.load());return this._load=Promise.all(e).then(()=>{const{realWidth:r,realHeight:n}=this.items[0];return this.resize(r,n),Promise.resolve(this)}),this._load}}class jC extends D0{constructor(t,e){const{width:r,height:n}=e||{};let s,a;Array.isArray(t)?(s=t,a=t.length):a=t,super(a,{width:r,height:n}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=fo.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:n,itemDirtyIds:s,items:a}=this,{gl:h}=t;r.dirtyId<0&&h.texImage3D(h.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,n,0,e.format,r.type,null);for(let u=0;u<n;u++){const d=a[u];s[u]<d.dirtyId&&(s[u]=d.dirtyId,d.valid&&h.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,u,d.resource.width,d.resource.height,1,e.format,r.type,d.resource.source))}return!0}}class Rs extends Sh{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;super(r,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=zC(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,n){const s=t.gl,a=e.realWidth,h=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1&&n.buffered.length===0)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===hn.UNPACK),!this.noSubImage&&e.target===s.TEXTURE_2D&&r.width===a&&r.height===h?s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,r.type,n):(r.width=a,r.height=h,s.texImage2D(e.target,0,r.internalFormat,e.format,r.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class XC extends Rs{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const mh=class extends D0{constructor(i,t){const{width:e,height:r,autoLoad:n,linkBaseTexture:s}=t||{};if(i&&i.length!==mh.SIDES)throw new Error(`Invalid length. Got ${i.length}, expected 6`);super(6,{width:e,height:r});for(let a=0;a<mh.SIDES;a++)this.items[a].target=fo.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=s!==!1,i&&this.initFromArray(i,t),n!==!1&&this.load()}bind(i){super.bind(i),i.target=fo.TEXTURE_CUBE_MAP}addBaseTextureAt(i,t,e){if(e===void 0&&(e=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||i.parentTextureArray||Object.keys(i._glTextures).length>0)if(i.resource)this.addResourceAt(i.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else i.target=fo.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.parentTextureArray=this.baseTexture,this.items[t]=i;return i.valid&&!this.valid&&this.resize(i.realWidth,i.realHeight),this.items[t]=i,this}upload(i,t,e){const r=this.itemDirtyIds;for(let n=0;n<mh.SIDES;n++){const s=this.items[n];(r[n]<s.dirtyId||e.dirtyId<t.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(i,s,e),r[n]=s.dirtyId):r[n]<-1&&(i.gl.texImage2D(s.target,0,e.internalFormat,t.realWidth,t.realHeight,0,t.format,e.type,null),r[n]=-1))}return!0}static test(i){return Array.isArray(i)&&i.length===mh.SIDES}};let L0=mh;L0.SIDES=6;class F0 extends Rs{constructor(t,e){if(e=e||{},typeof t=="string"){const r=new Image;Rs.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&!!this._width&&!!this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??jt.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=a=>{r(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===hn.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let n=!0;const s=e._glTextures;for(const a in s){const h=s[a];if(h!==r&&h.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}const sc=class extends Rs{constructor(i,t){t=t||{},super(jt.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=i,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(i=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),i(this)},sc.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const i=new Image;Rs.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=t=>{!this._resolve||(i.onerror=null,this.onError.emit(t))},i.onload=()=>{if(!this._resolve)return;const t=i.width,e=i.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=t*this.scale,n=e*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/e*t,n=this._overrideHeight||this._overrideWidth/t*e),r=Math.round(r),n=Math.round(n);const s=this.source;s.width=r,s.height=n,s._pixiId=`canvas_${ga()}`,s.getContext("2d").drawImage(i,0,0,t,e,0,0,r,n),this._resolve(),this._resolve=null}}static getSize(i){const t=sc.SVG_SIZE.exec(i),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(i,t){return t==="svg"||typeof i=="string"&&i.startsWith("data:image/svg+xml")||typeof i=="string"&&sc.SVG_XML.test(i)}};let Ch=sc;Ch.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Ch.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Yd=class extends Rs{constructor(i,t){if(t=t||{},!(i instanceof HTMLVideoElement)){const e=document.createElement("video");e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),typeof i=="string"&&(i=[i]);const r=i[0].src||i[0];Rs.crossOrigin(e,r,t.crossorigin);for(let n=0;n<i.length;++n){const s=document.createElement("source");let{src:a,mime:h}=i[n];a=a||i[n];const u=a.split("?").shift().toLowerCase(),d=u.slice(u.lastIndexOf(".")+1);h=h||Yd.MIME_TYPES[d]||`video/${d}`,s.src=a,s.type=h,e.appendChild(s)}i=e}super(i),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(i=0){if(!this.destroyed){const t=xi.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,i.load())}),this._load}_onError(i){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(i)}_isSourcePlaying(){const i=this.source;return!i.paused&&!i.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(xi.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(xi.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const i=this.source;i.removeEventListener("canplay",this._onCanPlay),i.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(i.videoWidth,i.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&i.play()}dispose(){this._isConnectedToTicker&&(xi.shared.remove(this.update,this),this._isConnectedToTicker=!1);const i=this.source;i&&(i.removeEventListener("error",this._onError,!0),i.pause(),i.src="",i.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(xi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(xi.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(i){i!==this._updateFPS&&(this._updateFPS=i)}static test(i,t){return globalThis.HTMLVideoElement&&i instanceof HTMLVideoElement||Yd.TYPES.includes(t)}};let vf=Yd;vf.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];vf.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};class oo extends Rs{constructor(t,e){var r=(...n)=>{super(...n)};e=e||{},typeof t=="string"?(r(oo.EMPTY),this.url=t):(r(t),this.url=null),this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await jt.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await r.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===hn.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=s,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return oo._EMPTY=oo._EMPTY??jt.ADAPTER.createCanvas(0,0),oo._EMPTY}}Xd.push(oo,F0,XC,vf,Ch,Rh,L0,jC);class YC extends Rh{upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===hn.UNPACK);const s=e.realWidth,a=e.realHeight;return r.width===s&&r.height===a?n.texSubImage2D(e.target,0,0,0,s,a,e.format,r.type,this.data):(r.width=s,r.height=a,n.texImage2D(e.target,0,r.internalFormat,s,a,0,e.format,r.type,this.data)),!0}}class $d{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new nn("disposeFramebuffer"),this.multisample=Ti.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Le(null,{scaleMode:qn.NEAREST,resolution:1,mipmap:En.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Le(new YC(null,{width:this.width,height:this.height}),{scaleMode:qn.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:En.OFF,format:Yt.DEPTH_COMPONENT,type:ue.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const n=this.colorTextures[r],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class O0 extends Le{constructor(t={}){if(typeof t=="number"){const e=arguments[0],r=arguments[1],n=arguments[2],s=arguments[3];t={width:e,height:r,scaleMode:n,resolution:s}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=Ti.NONE),super(null,t),this.mipmap=En.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new $d(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class N0{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const n=e.width,s=e.height;if(r){const a=t.width/2/n,h=t.height/2/s,u=t.x/n+a,d=t.y/s+h;r=hi.add(r,hi.NW),this.x0=u+a*hi.uX(r),this.y0=d+h*hi.uY(r),r=hi.add(r,2),this.x1=u+a*hi.uX(r),this.y1=d+h*hi.uY(r),r=hi.add(r,2),this.x2=u+a*hi.uX(r),this.y2=d+h*hi.uY(r),r=hi.add(r,2),this.x3=u+a*hi.uX(r),this.y3=d+h*hi.uY(r)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}const cg=new N0;function Rl(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class Ut extends Co{constructor(t,e,r,n,s,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Te(0,0,1,1)),t instanceof Ut&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this._uvs=cg,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new Ue(a.x,a.y):new Ue(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e?.url&&Xn[e.url]&&Ut.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Ut.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new Ut(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===cg&&(this._uvs=new N0),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=jt.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else if(t instanceof Le){if(!t.cacheId){const h=e?.pixiIdPrefix||"pixiid";t.cacheId=`${h}-${ga()}`,Le.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const h=e?.pixiIdPrefix||"pixiid";t._pixiId=`${h}_${ga()}`}s=t._pixiId}let a=Xn[s];if(n&&r&&!a)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!a&&!(t instanceof Le)?(e.resolution||(e.resolution=Bs(t)),a=new Ut(new Le(t,e)),a.baseTexture.cacheId=s,Le.addToCache(a.baseTexture,s),Ut.addToCache(a,s)):!a&&t instanceof Le&&(a=new Ut(t),Ut.addToCache(a,s)),a}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e?.resourceOptions),n=Ut.from(t,Object.assign({resourceOptions:r},e),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,r,n){return new Ut(Le.fromBuffer(t,e,r,n))}static fromLoader(t,e,r,n){const s=new Le(t,Object.assign({scaleMode:jt.SCALE_MODE,resolution:Bs(e)},n)),{resource:a}=s;a instanceof F0&&(a.url=e);const h=new Ut(s);return r||(r=e),Le.addToCache(h.baseTexture,r),Ut.addToCache(h,r),r!==e&&(Le.addToCache(h.baseTexture,e),Ut.addToCache(h,e)),h.baseTexture.valid?Promise.resolve(h):new Promise(u=>{h.baseTexture.once("loaded",()=>u(h))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Xn[e]&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),Xn[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Xn[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Xn[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)Xn[t.textureCacheIds[e]]===t&&delete Xn[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:n,height:s}=t,a=e+n>this.baseTexture.width,h=r+s>this.baseTexture.height;if(a||h){const u=a&&h?"and":"or",d=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,m=`Y: ${r} + ${s} = ${r+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${d} ${u} ${m}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Ut._EMPTY||(Ut._EMPTY=new Ut(new Le),Rl(Ut._EMPTY),Rl(Ut._EMPTY.baseTexture)),Ut._EMPTY}static get WHITE(){if(!Ut._WHITE){const t=jt.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Ut._WHITE=new Ut(Le.from(t)),Rl(Ut._WHITE),Rl(Ut._WHITE.baseTexture)}return Ut._WHITE}}class Ui extends Ut{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,a=Math.round(e*n)/n;this.valid=s>0&&a>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=a,r&&this.baseTexture.resize(s,a),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Ui(new O0(t))}}class U0{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=Ti.NONE){const n=new O0(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new Ui(n)}getOptimalTexture(t,e,r=1,n=Ti.NONE){let s;t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=fc(t),e=fc(e),s=((t&65535)<<16|e&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let a=this.texturePool[s].pop();return a||(a=this.createTexture(t,e,n)),a.filterPoolKey=s,a.setResolution(r),a}getFilterTexture(t,e,r){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||Ti.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}U0.SCREEN_KEY=-1;class pc{constructor(t,e=0,r=!1,n=ue.FLOAT,s,a,h){this.buffer=t,this.size=e,this.normalized=r,this.type=n,this.stride=s,this.start=a,this.instance=h}destroy(){this.buffer=null}static from(t,e,r,n,s){return new pc(t,e,r,n,s)}}let $C=0;class Ai{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=$C++,this.disposeRunner=new nn("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?An.ELEMENT_ARRAY_BUFFER:An.ARRAY_BUFFER}get index(){return this.type===An.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Ai(t)}}const qC={Float32Array,Uint32Array,Int32Array,Uint8Array};function KC(i,t){let e=0,r=0;const n={};for(let u=0;u<i.length;u++)r+=t[u],e+=i[u].length;const s=new ArrayBuffer(e*4);let a=null,h=0;for(let u=0;u<i.length;u++){const d=t[u],m=i[u],l=k0(m);n[l]||(n[l]=new qC[l](s)),a=n[l];for(let f=0;f<m.length;f++){const p=(f/d|0)*r+h,y=f%d;a[p+y]=m[f]}h+=d}return new Float32Array(s)}const ug={5126:4,5123:2,5121:1};let ZC=0;const QC={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Tn{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=ZC++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new nn("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,n=!1,s,a,h,u=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Ai||(e instanceof Array&&(e=new Float32Array(e)),e=new Ai(e));const d=t.split("|");if(d.length>1){for(let l=0;l<d.length;l++)this.addAttribute(d[l],e,r,n,s);return this}let m=this.buffers.indexOf(e);return m===-1&&(this.buffers.push(e),m=this.buffers.length-1),this.attributes[t]=new pc(m,r,n,s,a,h,u),this.instanced=this.instanced||u,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Ai||(t instanceof Array&&(t=new Uint16Array(t)),t=new Ai(t)),t.type=An.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new Ai;let n;for(n in this.attributes){const s=this.attributes[n],a=this.buffers[s.buffer];t.push(a.data),e.push(s.size*ug[s.type]/4),s.buffer=0}for(r.data=KC(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Tn;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Ai(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new pc(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=An.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Tn,r=[],n=[],s=[];let a;for(let h=0;h<t.length;h++){a=t[h];for(let u=0;u<a.buffers.length;u++)n[u]=n[u]||0,n[u]+=a.buffers[u].data.length,s[u]=0}for(let h=0;h<a.buffers.length;h++)r[h]=new QC[k0(a.buffers[h].data)](n[h]),e.buffers[h]=new Ai(r[h]);for(let h=0;h<t.length;h++){a=t[h];for(let u=0;u<a.buffers.length;u++)r[u].set(a.buffers[u].data,s[u]),s[u]+=a.buffers[u].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=An.ELEMENT_ARRAY_BUFFER;let h=0,u=0,d=0,m=0;for(let l=0;l<a.buffers.length;l++)if(a.buffers[l]!==a.indexBuffer){m=l;break}for(const l in a.attributes){const f=a.attributes[l];(f.buffer|0)===m&&(u+=f.size*ug[f.type]/4)}for(let l=0;l<t.length;l++){const f=t[l].indexBuffer.data;for(let p=0;p<f.length;p++)e.indexBuffer.data[p+d]+=h;h+=t[l].buffers[m].data.length/u,d+=f.length}}return e}}class JC extends Tn{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class H0 extends Tn{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ai(this.vertices),this.uvBuffer=new Ai(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,r=e.x,n=e.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}let tM=0;class an{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=tM++,this.static=!!e,this.ubo=!!r,t instanceof Ai?(this.buffer=t,this.buffer.type=An.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Ai(new Float32Array(1)),this.buffer.type=An.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new an(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new an(t,e,r)}static uboFrom(t,e){return new an(t,e??!0,!0)}}class eM{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Ti.NONE,this.sourceFrame=new Te,this.destinationFrame=new Te,this.bindingSourceFrame=new Te,this.bindingDestinationFrame=new Te,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const kl=[new Ue,new Ue,new Ue,new Ue],sd=new yi;class G0{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new U0,this.statePool=[],this.quad=new JC,this.quadUv=new H0,this.tempRect=new Te,this.activeState={},this.globalUniforms=new an({outputFrame:new Te,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new eM,a=this.renderer.renderTexture;let h=e[0].resolution,u=e[0].multisample,d=e[0].padding,m=e[0].autoFit,l=e[0].legacy??!0;for(let y=1;y<e.length;y++){const _=e[y];h=Math.min(h,_.resolution),u=Math.min(u,_.multisample),d=this.useMaxPadding?Math.max(d,_.padding):d+_.padding,m=m&&_.autoFit,l=l||(_.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),n.push(s),s.resolution=h,s.multisample=u,s.legacy=l,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(d);const f=this.tempRect.copyFrom(a.sourceFrame);r.projection.transform&&this.transformAABB(sd.copyFrom(r.projection.transform).invert(),f),m?(s.sourceFrame.fit(f),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(f)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,a.current?a.current.resolution:r.resolution,a.sourceFrame,a.destinationFrame,r.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,h,u),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const p=this.tempRect;p.x=0,p.y=0,p.width=s.sourceFrame.width,p.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(a.sourceFrame),s.bindingDestinationFrame.copyFrom(a.destinationFrame),s.transform=r.projection.transform,r.projection.transform=null,a.bind(s.renderTexture,s.sourceFrame,p),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const s=n.inputSize,a=n.inputPixel,h=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],a[0]=Math.round(s[0]*e.resolution),a[1]=Math.round(s[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],h[0]=.5*a[2],h[1]=.5*a[3],h[2]=e.sourceFrame.width*s[2]-.5*a[2],h[3]=e.sourceFrame.height*s[3]-.5*a[3],e.legacy){const d=n.filterArea;d[0]=e.destinationFrame.width,d[1]=e.destinationFrame.height,d[2]=e.sourceFrame.x,d[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const u=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,u.renderTexture,ta.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let d=e.renderTexture,m=this.getOptimalFilterTexture(d.width,d.height,e.resolution);m.filterFrame=d.filterFrame;let l=0;for(l=0;l<r.length-1;++l){l===1&&e.multisample>1&&(m=this.getOptimalFilterTexture(d.width,d.height,e.resolution),m.filterFrame=d.filterFrame),r[l].apply(this,d,m,ta.CLEAR,e);const f=d;d=m,m=f}r[l].apply(this,d,u.renderTexture,ta.BLEND,e),l>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(d),this.returnFilterTexture(m)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=ta.CLEAR){const{renderTexture:r,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,r.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(e===ta.CLEAR||e===ta.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(r,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(wn.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(wn.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:n}=this.activeState,{orig:s}=e._texture,a=t.set(n.width,0,0,n.height,r.x,r.y),h=e.worldTransform.copyTo(yi.TEMP_MATRIX);return h.invert(),a.prepend(h),a.scale(1/s.width,1/s.height),a.translate(e.anchor.x,e.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,n=Ti.NONE){return this.texturePool.getOptimalTexture(t,e,r,n)}getFilterTexture(t,e,r){if(typeof t=="number"){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||Ti.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=kl[0],n=kl[1],s=kl[2],a=kl[3];r.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(r,r),t.apply(n,n),t.apply(s,s),t.apply(a,a);const h=Math.min(r.x,n.x,s.x,a.x),u=Math.min(r.y,n.y,s.y,a.y),d=Math.max(r.x,n.x,s.x,a.x),m=Math.max(r.y,n.y,s.y,a.y);e.x=h,e.y=u,e.width=d-h,e.height=m-u}roundFrame(t,e,r,n,s){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(s){const{a,b:h,c:u,d}=s;if((Math.abs(h)>1e-4||Math.abs(u)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(d)>1e-4))return}s=s?sd.copyFrom(s):sd.identity(),s.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}G0.extension={type:Jt.RendererSystem,name:"filter"};he.add(G0);class Lc{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}class W0{constructor(t){this.renderer=t,this.emptyRenderer=new Lc(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=r[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,r,n){const{elements:s,ids:a,count:h}=t;let u=0;for(let d=0;d<h;d++){const m=s[d],l=m._batchLocation;if(l>=0&&l<n&&e[l]===m){a[d]=l;continue}for(;u<n;){const f=e[u];if(f&&f._batchEnabled===r&&f._batchLocation===u){u++;continue}a[d]=u,m._batchLocation=u,e[u]=m;break}}}destroy(){this.renderer=null}}W0.extension={type:Jt.RendererSystem,name:"batch"};he.add(W0);let dg=0;class z0{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=dg++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha??!0;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=dg++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(jt.PREFER_ENV>=wa.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault()}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}z0.extension={type:Jt.RendererSystem,name:"context"};he.add(z0);class iM{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Ti.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const rM=new Te;class V0{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new $d(10,10),this.msaaSamples=null}contextChange(){const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Te,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;jt.PREFER_ENV===wa.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=r),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const h=t.colorTextures[a];this.renderer.texture.unbind(h.parentTextureArray||h)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const a=e.width>>r,h=e.height>>r,u=a/e.width;this.setViewport(e.x*u,e.y*u,a,h)}else{const a=t.width>>r,h=t.height>>r;this.setViewport(0,0,a,h)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,n){const s=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),(s.width!==r||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=r,s.height=n,this.gl.viewport(t,e,r,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,n,s=Fd.COLOR|Fd.DEPTH){const{gl:a}=this;a.clearColor(t,e,r,n),a.clear(s)}initFramebuffer(t){const{gl:e}=this,r=new iM(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];r.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let s=n.length;e.drawBuffers||(s=Math.min(s,1));for(let a=0;a<s;a++){const h=n[a],u=h.parentTextureArray||h;this.renderer.texture.bind(u,0),a===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let a=s.length;r.drawBuffers||(a=Math.min(a,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer():n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const h=[];for(let u=0;u<a;u++){const d=s[u],m=d.parentTextureArray||d;this.renderer.texture.bind(m,0),u===0&&n.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,m._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+u,d.target,m._glTextures[this.CONTEXT_UID].texture,e),h.push(r.COLOR_ATTACHMENT0+u))}if(h.length>1&&r.drawBuffers(h),t.depthTexture&&this.writeDepthTexture){const d=t.depthTexture;this.renderer.texture.bind(d,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,d._glTextures[this.CONTEXT_UID].texture,e)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n.stencil)):n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=Ti.NONE;if(t<=1||e===null)return r;for(let n=0;n<e.length;n++)if(e[n]<=t){r=e[n];break}return r===1&&(r=Ti.NONE),r}blit(t,e,r){const{current:n,renderer:s,gl:a,CONTEXT_UID:h}=this;if(s.context.webGLVersion!==2||!n)return;const u=n.glFramebuffers[h];if(!u)return;if(!t){if(!u.msaaBuffer)return;const m=n.colorTextures[0];if(!m)return;u.blitFramebuffer||(u.blitFramebuffer=new $d(n.width,n.height),u.blitFramebuffer.addColorTexture(0,m)),t=u.blitFramebuffer,t.colorTextures[0]!==m&&(t.colorTextures[0]=m,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=rM,e.width=n.width,e.height=n.height),r||(r=e);const d=e.width===r.width&&e.height===r.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,u.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,a.COLOR_BUFFER_BIT,d?a.NEAREST:a.LINEAR)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&r.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const r=t.width,n=t.height,s=this.gl,a=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,a),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,s.DEPTH24_STENCIL8,r,n):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,r,n),e.stencil=a,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Te}destroy(){this.renderer=null}}V0.extension={type:Jt.RendererSystem,name:"framebuffer"};he.add(V0);const ad={5126:4,5123:2,5121:1};class j0{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;jt.PREFER_ENV===wa.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=n=>r.bindVertexArrayOES(n),t.deleteVertexArray=n=>r.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(n,s)=>r.vertexAttribDivisorANGLE(n,s),t.drawElementsInstanced=(n,s,a,h,u)=>r.drawElementsInstancedANGLE(n,s,a,h,u),t.drawArraysInstanced=(n,s,a,h)=>r.drawArraysInstancedANGLE(n,s,a,h)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const a=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];e.update(n)}}checkCompatibility(t,e){const r=t.attributes,n=e.attributeData;for(const s in n)if(!r[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(t,e){const r=t.attributes,n=e.attributeData,s=["g",t.id];for(const a in r)n[a]&&s.push(a,n[a].location);return s.join("-")}initGeometryVao(t,e,r=!0){const n=this.gl,s=this.CONTEXT_UID,a=this.renderer.buffer,h=e.program;h.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,h);const u=this.getSignature(t,h),d=t.glVertexArrayObjects[this.CONTEXT_UID];let m=d[u];if(m)return d[h.id]=m,m;const l=t.buffers,f=t.attributes,p={},y={};for(const _ in l)p[_]=0,y[_]=0;for(const _ in f)!f[_].size&&h.attributeData[_]?f[_].size=h.attributeData[_].size:f[_].size||console.warn(`PIXI Geometry attribute '${_}' size cannot be determined (likely the bound shader does not have the attribute)`),p[f[_].buffer]+=f[_].size*ad[f[_].type];for(const _ in f){const v=f[_],w=v.size;v.stride===void 0&&(p[v.buffer]===w*ad[v.type]?v.stride=0:v.stride=p[v.buffer]),v.start===void 0&&(v.start=y[v.buffer],y[v.buffer]+=w*ad[v.type])}m=n.createVertexArray(),n.bindVertexArray(m);for(let _=0;_<l.length;_++){const v=l[_];a.bind(v),r&&v._glBuffers[s].refCount++}return this.activateVao(t,h),d[h.id]=m,d[u]=m,n.bindVertexArray(null),a.unbind(An.ARRAY_BUFFER),m}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,a=this.renderer?.buffer;if(t.disposeRunner.remove(this),!!r){if(a)for(let h=0;h<s.length;h++){const u=s[h]._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!e&&a.dispose(s[h],e))}if(!e){for(const h in r)if(h[0]==="g"){const u=r[h];this._activeVao===u&&this.unbind(),n.deleteVertexArray(u)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,a=t.buffers,h=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let u=null;for(const d in h){const m=h[d],l=a[m.buffer],f=l._glBuffers[n];if(e.attributeData[d]){u!==f&&(s.bind(l),u=f);const p=e.attributeData[d].location;if(r.enableVertexAttribArray(p),r.vertexAttribPointer(p,m.size,m.type||r.FLOAT,m.normalized,m.stride,m.start),m.instance)if(this.hasInstance)r.vertexAttribDivisor(p,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,n){const{gl:s}=this,a=this._activeGeometry;if(a.indexBuffer){const h=a.indexBuffer.data.BYTES_PER_ELEMENT,u=h===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;h===2||h===4&&this.canUseUInt32ElementIndex?a.instanced?s.drawElementsInstanced(t,e||a.indexBuffer.data.length,u,(r||0)*h,n||1):s.drawElements(t,e||a.indexBuffer.data.length,u,(r||0)*h):console.warn("unsupported index buffer type: uint32")}else a.instanced?s.drawArraysInstanced(t,r,e||a.getSize(),n||1):s.drawArrays(t,r,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}j0.extension={type:Jt.RendererSystem,name:"geometry"};he.add(j0);class nM{constructor(t=null){this.type=ki.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=jt.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=ki.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}function fg(i,t,e){const r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function pg(i,t){const e=i.getShaderSource(t).split(`
`).map((d,m)=>`${m}: ${d}`),r=i.getShaderInfoLog(t),n=r.split(`
`),s={},a=n.map(d=>parseFloat(d.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(d=>d&&!s[d]?(s[d]=!0,!0):!1),h=[""];a.forEach(d=>{e[d-1]=`%c${e[d-1]}%c`,h.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const u=e.join(`
`);h[0]=u,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...h),console.groupEnd()}function sM(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||pg(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||pg(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}function od(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function X0(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return od(2*t);case"bvec3":return od(3*t);case"bvec4":return od(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Y0={};let Pl=Y0;function aM(){if(Pl===Y0||Pl?.isContextLost()){const i=jt.ADAPTER.createCanvas();let t;jt.PREFER_ENV>=wa.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Pl=t}return Pl}let Dl;function oM(){if(!Dl){Dl=jr.MEDIUM;const i=aM();i&&i.getShaderPrecisionFormat&&(Dl=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision?jr.HIGH:jr.MEDIUM)}return Dl}function mg(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===jr.HIGH&&e!==jr.HIGH&&(r=jr.MEDIUM),`precision ${r} float;
${i}`}else if(e!==jr.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}const hM={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function $0(i){return hM[i]}let Ll=null;const gg={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function q0(i,t){if(!Ll){const e=Object.keys(gg);Ll={};for(let r=0;r<e.length;++r){const n=e[r];Ll[i[n]]=gg[n]}}return Ll[t]}const yo=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],lM={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},cM={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function uM(i,t){const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in i.uniforms){const n=t[r];if(!n){i.uniforms[r]?.group&&(i.uniforms[r].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const s=i.uniforms[r];let a=!1;for(let h=0;h<yo.length;h++)if(yo[h].test(n,s)){e.push(yo[h].code(r,s)),a=!0;break}if(!a){const u=(n.size===1&&!n.isArray?lM:cM)[n.type].replace("location",`ud["${r}"].location`);e.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${u};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const dM=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function fM(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function pM(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=dM.replace(/%forloop%/gi,fM(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}let hh;function mM(){if(typeof hh=="boolean")return hh;try{hh=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{hh=!1}return hh}var gM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,yM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;let _M=0;const Fl={};class Zn{constructor(t,e,r="pixi-shader",n={}){this.extra={},this.id=_M++,this.vertexSrc=t||Zn.defaultVertexSrc,this.fragmentSrc=e||Zn.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Fl[r]?(Fl[r]++,r+=`-${Fl[r]}`):Fl[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=mg(this.vertexSrc,jt.PRECISION_VERTEX,jr.HIGH),this.fragmentSrc=mg(this.fragmentSrc,jt.PRECISION_FRAGMENT,oM())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return yM}static get defaultFragmentSrc(){return gM}static from(t,e,r){const n=t+e;let s=hg[n];return s||(hg[n]=s=new Zn(t,e,r)),s}}class Mr{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof an?this.uniformGroup=e:this.uniformGroup=new an(e):this.uniformGroup=new an({}),this.disposeRunner=new nn("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const n=e.uniforms[r];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const n=Zn.from(t,e);return new Mr(n,r)}}const hd=0,ld=1,cd=2,ud=3,dd=4,fd=5;class rs{constructor(){this.data=0,this.blendMode=ce.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<hd)}set blend(t){!!(this.data&1<<hd)!==t&&(this.data^=1<<hd)}get offsets(){return!!(this.data&1<<ld)}set offsets(t){!!(this.data&1<<ld)!==t&&(this.data^=1<<ld)}get culling(){return!!(this.data&1<<cd)}set culling(t){!!(this.data&1<<cd)!==t&&(this.data^=1<<cd)}get depthTest(){return!!(this.data&1<<ud)}set depthTest(t){!!(this.data&1<<ud)!==t&&(this.data^=1<<ud)}get depthMask(){return!!(this.data&1<<fd)}set depthMask(t){!!(this.data&1<<fd)!==t&&(this.data^=1<<fd)}get clockwiseFrontFace(){return!!(this.data&1<<dd)}set clockwiseFrontFace(t){!!(this.data&1<<dd)!==t&&(this.data^=1<<dd)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==ce.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new rs;return t.depthTest=!1,t.blend=!0,t}}var vM=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,wM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;class Mh extends Mr{constructor(t,e,r){const n=Zn.from(t||Mh.defaultVertexSrc,e||Mh.defaultFragmentSrc);super(n,r),this.padding=0,this.resolution=jt.FILTER_RESOLUTION,this.multisample=jt.FILTER_MULTISAMPLE,this.enabled=!0,this.autoFit=!0,this.state=new rs}apply(t,e,r,n,s){t.applyFilter(this,e,r,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return wM}static get defaultFragmentSrc(){return vM}}var bM=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,xM=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;const yg=new yi;class wf{constructor(t,e){this._texture=t,this.mapCoord=new yi,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],a=t[n+1];e[n]=s*r.a+a*r.c+r.tx,e[n+1]=s*r.b+a*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const n=e.orig,s=e.trim;s&&(yg.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(yg));const a=e.baseTexture,h=this.uClampFrame,u=this.clampMargin/a.resolution,d=this.clampOffset;return h[0]=(e._frame.x+u+d)/a.width,h[1]=(e._frame.y+u+d)/a.height,h[2]=(e._frame.x+e._frame.width-u+d)/a.width,h[3]=(e._frame.y+e._frame.height-u+d)/a.height,this.uClampOffset[0]=d/a.realWidth,this.uClampOffset[1]=d/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&e.rotate===0,!0}}class AM extends Mh{constructor(t,e,r){let n=null;typeof t!="string"&&e===void 0&&r===void 0&&(n=t,t=void 0,e=void 0,r=void 0),super(t||bM,e||xM,r),this.maskSprite=n,this.maskMatrix=new yi}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,n){const s=this._maskSprite,a=s._texture;!a.valid||(a.uvMatrix||(a.uvMatrix=new wf(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,r,n))}}class K0{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const s=this.maskDataPool.pop()||new nM;s.pooled=!0,s.maskObject=e,r=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(n),r._colorMask=n?n._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==ki.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case ki.SCISSOR:this.renderer.scissor.push(r);break;case ki.STENCIL:this.renderer.stencil.push(r);break;case ki.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case ki.COLOR:this.pushColorMask(r);break}r.type===ki.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case ki.SCISSOR:this.renderer.scissor.pop(e);break;case ki.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case ki.SPRITE:this.popSpriteMask(e);break;case ki.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===ki.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=ki.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=ki.SCISSOR:t.type=ki.STENCIL:t.type=ki.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new AM]));const s=this.renderer,a=s.renderTexture;let h,u;if(a.current){const m=a.current;h=t.resolution||m.resolution,u=t.multisample??m.multisample}else h=t.resolution||s.resolution,u=t.multisample??s.multisample;n[0].resolution=h,n[0].multisample=u,n[0].maskSprite=e;const d=r.filterArea;r.filterArea=e.getBounds(!0),s.filter.push(r,n),r.filterArea=d,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}K0.extension={type:Jt.RendererSystem,name:"mask"};he.add(K0);class Z0{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==r&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const _g=new yi,vg=[],ac=class extends Z0{constructor(i){super(i),this.glConst=jt.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const i=this.maskStack[this.maskStack.length-1];return i?i._scissorCounter:0}calcScissorRect(i){if(i._scissorRectLocal)return;const t=i._scissorRect,{maskObject:e}=i,{renderer:r}=this,n=r.renderTexture,s=e.getBounds(!0,vg.pop()??new Te);this.roundFrameToPixels(s,n.current?n.current.resolution:r.resolution,n.sourceFrame,n.destinationFrame,r.projection.transform),t&&s.fit(t),i._scissorRectLocal=s}static isMatrixRotated(i){if(!i)return!1;const{a:t,b:e,c:r,d:n}=i;return(Math.abs(e)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(i){const{maskObject:t}=i;if(!t.isFastRect||!t.isFastRect()||ac.isMatrixRotated(t.worldTransform)||ac.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(i);const e=i._scissorRectLocal;return e.width>0&&e.height>0}roundFrameToPixels(i,t,e,r,n){ac.isMatrixRotated(n)||(n=n?_g.copyFrom(n):_g.identity(),n.translate(-e.x,-e.y).scale(r.width/e.width,r.height/e.height).translate(r.x,r.y),this.renderer.filter.transformAABB(n,i),i.fit(r),i.x=Math.round(i.x*t),i.y=Math.round(i.y*t),i.width=Math.round(i.width*t),i.height=Math.round(i.height*t))}push(i){i._scissorRectLocal||this.calcScissorRect(i);const{gl:t}=this.renderer;i._scissorRect||t.enable(t.SCISSOR_TEST),i._scissorCounter++,i._scissorRect=i._scissorRectLocal,this._useCurrent()}pop(i){const{gl:t}=this.renderer;i&&vg.push(i._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const i=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=i.y:t=this.renderer.height-i.height-i.y,this.renderer.gl.scissor(i.x,t,i.width,i.height)}};let Q0=ac;Q0.extension={type:Jt.RendererSystem,name:"scissor"};he.add(Q0);class J0 extends Z0{constructor(t){super(t),this.glConst=jt.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;s!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,n,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(t._colorMask=s,r.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=r?r._colorMask:15;n!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(r._colorMask=n,e.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}J0.extension={type:Jt.RendererSystem,name:"stencil"};he.add(J0);class ty{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new yi,this.transform=null}update(t,e,r,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,r,n){const s=this.projectionMatrix,a=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=a*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-a-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}ty.extension={type:Jt.RendererSystem,name:"projection"};he.add(ty);const Zs=new Te,lh=new Te;class ey{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Te,this.destinationFrame=new Te,this.viewportFrame=new Te}bind(t=null,e,r){const n=this.renderer;this.current=t;let s,a,h;t?(s=t.baseTexture,h=s.resolution,e||(Zs.width=t.frame.width,Zs.height=t.frame.height,e=Zs),r||(lh.x=t.frame.x,lh.y=t.frame.y,lh.width=e.width,lh.height=e.height,r=lh),a=s.framebuffer):(h=n.resolution,e||(Zs.width=n._view.screen.width,Zs.height=n._view.screen.height,e=Zs),r||(r=Zs,r.width=e.width,r.height=e.height));const u=this.viewportFrame;u.x=r.x*h,u.y=r.y*h,u.width=r.width*h,u.height=r.height*h,t||(u.y=n.view.height-(u.y+u.height)),u.ceil(),this.renderer.framebuffer.bind(a,u),this.renderer.projection.update(r,e,h,!a),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.renderer.background.colorRgba;const r=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,s=r.width!==n.width||r.height!==n.height;if(s){let{x:a,y:h,width:u,height:d}=this.viewportFrame;a=Math.round(a),h=Math.round(h),u=Math.round(u),d=Math.round(d),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,h,u,d)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),s&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}ey.extension={type:Jt.RendererSystem,name:"renderTexture"};he.add(ey);function EM(i,t,e,r,n){e.buffer.update(n)}const TM={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},iy={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function SM(i){const t=i.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let e=0,r=0,n=0;for(let s=0;s<t.length;s++){const a=t[s];if(e=iy[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,r%e!==0&&r<16){const h=r%e%16;r+=h,n+=h}r+e>16?(n=Math.ceil(n/16)*16,a.offset=n,n+=e,r=e):(a.offset=n,r+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function CM(i,t){const e=[];for(const r in i)t[r]&&e.push(t[r]);return e.sort((r,n)=>r.index-n.index),e}function MM(i,t){if(!i.autoManage)return{size:0,syncFunc:EM};const e=CM(i.uniforms,t),{uboElements:r,size:n}=SM(e),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<r.length;a++){const h=r[a],u=i.uniforms[h.data.name],d=h.data.name;let m=!1;for(let l=0;l<yo.length;l++){const f=yo[l];if(f.codeUbo&&f.test(h.data,u)){s.push(`offset = ${h.offset/4};`,yo[l].codeUbo(h.data.name,u)),m=!0;break}}if(!m)if(h.data.size>1){const l=$0(h.data.type),f=Math.max(iy[h.data.type]/16,1),p=l/f,y=(4-p%4)%4;s.push(`
                cv = ud.${d}.value;
                v = uv.${d};
                offset = ${h.offset/4};

                t = 0;

                for(var i=0; i < ${h.data.size*f}; i++)
                {
                    for(var j = 0; j < ${p}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${y};
                }

                `)}else{const l=TM[h.data.type];s.push(`
                cv = ud.${d}.value;
                v = uv.${d};
                offset = ${h.offset/4};
                ${l};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}class IM{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function BM(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=t.getActiveAttrib(i,n);if(s.name.startsWith("gl_"))continue;const a=q0(t,s.type),h={type:a,name:s.name,size:$0(a),location:t.getAttribLocation(i,s.name)};e[s.name]=h}return e}function RM(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<r;n++){const s=t.getActiveUniform(i,n),a=s.name.replace(/\[.*?\]$/,""),h=!!s.name.match(/\[.*?\]$/),u=q0(t,s.type);e[a]={name:a,index:n,type:u,size:s.size,isArray:h,value:X0(u,s.size)}}return e}function kM(i,t){const e=fg(i,i.VERTEX_SHADER,t.vertexSrc),r=fg(i,i.FRAGMENT_SHADER,t.fragmentSrc),n=i.createProgram();i.attachShader(n,e),i.attachShader(n,r);const s=t.extra?.transformFeedbackVaryings;if(s&&(typeof i.transformFeedbackVaryings!="function"||i.transformFeedbackVaryings(n,s.names,s.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(n),i.getProgramParameter(n,i.LINK_STATUS)||sM(i,n,e,r),t.attributeData=BM(n,i),t.uniformData=RM(n,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const u=Object.keys(t.attributeData);u.sort((d,m)=>d>m?1:-1);for(let d=0;d<u.length;d++)t.attributeData[u[d]].location=d,i.bindAttribLocation(n,d,u[d]);i.linkProgram(n)}i.deleteShader(e),i.deleteShader(r);const a={};for(const u in t.uniformData){const d=t.uniformData[u];a[u]={location:i.getUniformLocation(n,u),value:X0(d.type,d.size)}}return new IM(n,a)}let PM=0;const Ol={textureCount:0,uboCount:0};class ry{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=PM++}systemCheck(){if(!mM())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),e||(Ol.textureCount=0,Ol.uboCount=0,this.syncUniformGroup(t.uniformGroup,Ol)),n}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=uM(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const n=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),n(r.uniformData,t.uniforms,this.renderer,Ol,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let h=this._uboCache[a];if(h||(h=this._uboCache[a]=MM(t,this.shader.program.uniformData)),t.autoManage){const u=new Float32Array(h.size/4);t.buffer.update(u)}return e.uniformGroups[t.id]=h.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const n=t.uniforms,s=[`${r}-`];for(const a in n)s.push(a),e[a]&&s.push(e[a].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,n=kM(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ry.extension={type:Jt.RendererSystem,name:"shader"};he.add(ry);function DM(i,t=[]){return t[ce.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.ADD]=[i.ONE,i.ONE],t[ce.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.NONE]=[0,0],t[ce.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[ce.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[ce.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[ce.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[ce.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[ce.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[ce.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[ce.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[ce.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[ce.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[ce.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const LM=0,FM=1,OM=2,NM=3,UM=4,HM=5,qd=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ce.NONE,this._blendEq=!1,this.map=[],this.map[LM]=this.setBlend,this.map[FM]=this.setOffset,this.map[OM]=this.setCullFace,this.map[NM]=this.setDepthTest,this.map[UM]=this.setFrontFace,this.map[HM]=this.setDepthMask,this.checks=[],this.defaultState=new rs,this.defaultState.blend=!0}contextChange(i){this.gl=i,this.blendModes=DM(i),this.set(this.defaultState),this.reset()}set(i){if(i=i||this.defaultState,this.stateId!==i.data){let t=this.stateId^i.data,e=0;for(;t;)t&1&&this.map[e].call(this,!!(i.data&1<<e)),t=t>>1,e++;this.stateId=i.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,i)}forceState(i){i=i||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(i.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,i);this.stateId=i.data}setBlend(i){this.updateCheck(qd.checkBlendMode,i),this.gl[i?"enable":"disable"](this.gl.BLEND)}setOffset(i){this.updateCheck(qd.checkPolygonOffset,i),this.gl[i?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(i){this.gl[i?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(i){this.gl.depthMask(i)}setCullFace(i){this.gl[i?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(i){this.gl.frontFace(this.gl[i?"CW":"CCW"])}setBlendMode(i){if(i===this.blendMode)return;this.blendMode=i;const t=this.blendModes[i],e=this.gl;t.length===2?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(i,t){this.gl.polygonOffset(i,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(i,t){const e=this.checks.indexOf(i);t&&e===-1?this.checks.push(i):!t&&e!==-1&&this.checks.splice(e,1)}static checkBlendMode(i,t){i.setBlendMode(t.blendMode)}static checkPolygonOffset(i,t){i.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let ny=qd;ny.extension={type:Jt.RendererSystem,name:"state"};he.add(ny);class sy{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=jt.GC_MAX_IDLE,this.checkCountMax=jt.GC_MAX_CHECK_COUNT,this.mode=jt.GC_MODE}postrender(){!this.renderer.objectRenderer.renderingToScreen||(this.count++,this.mode!==df.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let n=0;n<e.length;n++){const s=e[n];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,r=!0)}if(r){let n=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[n++]=e[s]);e.length=n}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}}sy.extension={type:Jt.RendererSystem,name:"textureGC"};he.add(sy);function GM(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[ue.UNSIGNED_BYTE]:{[Yt.RGBA]:i.RGBA8,[Yt.RGB]:i.RGB8,[Yt.RG]:i.RG8,[Yt.RED]:i.R8,[Yt.RGBA_INTEGER]:i.RGBA8UI,[Yt.RGB_INTEGER]:i.RGB8UI,[Yt.RG_INTEGER]:i.RG8UI,[Yt.RED_INTEGER]:i.R8UI,[Yt.ALPHA]:i.ALPHA,[Yt.LUMINANCE]:i.LUMINANCE,[Yt.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[ue.BYTE]:{[Yt.RGBA]:i.RGBA8_SNORM,[Yt.RGB]:i.RGB8_SNORM,[Yt.RG]:i.RG8_SNORM,[Yt.RED]:i.R8_SNORM,[Yt.RGBA_INTEGER]:i.RGBA8I,[Yt.RGB_INTEGER]:i.RGB8I,[Yt.RG_INTEGER]:i.RG8I,[Yt.RED_INTEGER]:i.R8I},[ue.UNSIGNED_SHORT]:{[Yt.RGBA_INTEGER]:i.RGBA16UI,[Yt.RGB_INTEGER]:i.RGB16UI,[Yt.RG_INTEGER]:i.RG16UI,[Yt.RED_INTEGER]:i.R16UI,[Yt.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[ue.SHORT]:{[Yt.RGBA_INTEGER]:i.RGBA16I,[Yt.RGB_INTEGER]:i.RGB16I,[Yt.RG_INTEGER]:i.RG16I,[Yt.RED_INTEGER]:i.R16I},[ue.UNSIGNED_INT]:{[Yt.RGBA_INTEGER]:i.RGBA32UI,[Yt.RGB_INTEGER]:i.RGB32UI,[Yt.RG_INTEGER]:i.RG32UI,[Yt.RED_INTEGER]:i.R32UI,[Yt.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[ue.INT]:{[Yt.RGBA_INTEGER]:i.RGBA32I,[Yt.RGB_INTEGER]:i.RGB32I,[Yt.RG_INTEGER]:i.RG32I,[Yt.RED_INTEGER]:i.R32I},[ue.FLOAT]:{[Yt.RGBA]:i.RGBA32F,[Yt.RGB]:i.RGB32F,[Yt.RG]:i.RG32F,[Yt.RED]:i.R32F,[Yt.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[ue.HALF_FLOAT]:{[Yt.RGBA]:i.RGBA16F,[Yt.RGB]:i.RGB16F,[Yt.RG]:i.RG16F,[Yt.RED]:i.R16F},[ue.UNSIGNED_SHORT_5_6_5]:{[Yt.RGB]:i.RGB565},[ue.UNSIGNED_SHORT_4_4_4_4]:{[Yt.RGBA]:i.RGBA4},[ue.UNSIGNED_SHORT_5_5_5_1]:{[Yt.RGBA]:i.RGB5_A1},[ue.UNSIGNED_INT_2_10_10_10_REV]:{[Yt.RGBA]:i.RGB10_A2,[Yt.RGBA_INTEGER]:i.RGB10_A2UI},[ue.UNSIGNED_INT_10F_11F_11F_REV]:{[Yt.RGB]:i.R11F_G11F_B10F},[ue.UNSIGNED_INT_5_9_9_9_REV]:{[Yt.RGB]:i.RGB9_E5},[ue.UNSIGNED_INT_24_8]:{[Yt.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[ue.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[Yt.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[ue.UNSIGNED_BYTE]:{[Yt.RGBA]:i.RGBA,[Yt.RGB]:i.RGB,[Yt.ALPHA]:i.ALPHA,[Yt.LUMINANCE]:i.LUMINANCE,[Yt.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[ue.UNSIGNED_SHORT_5_6_5]:{[Yt.RGB]:i.RGB},[ue.UNSIGNED_SHORT_4_4_4_4]:{[Yt.RGBA]:i.RGBA},[ue.UNSIGNED_SHORT_5_5_5_1]:{[Yt.RGBA]:i.RGBA}},t}class pd{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ue.UNSIGNED_BYTE,this.internalFormat=Yt.RGBA,this.samplerType=0}}class ay{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Le,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=GM(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const r=new pd(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new pd(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:r}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<r.length;n++)r[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:n}=this;if(!!r)for(let s=t-1;s>=0;--s){const a=e[s];a&&a._glTextures[n].samplerType!==Od.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const e=new pd(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,this.webGLVersion===2&&t.type===ue.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(r,t,e))e.samplerType!==Od.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,s=t.realHeight,a=r.gl;(e.width!==n||e.height!==s||e.dirtyId<0)&&(e.width=n,e.height=s,a.texImage2D(t.target,0,e.internalFormat,n,s,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);n!==-1&&go(this.managedTextures,n,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];!e||((t.mipmap===En.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Ms.CLAMP:e.wrapMode=t.wrapMode,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==En.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===qn.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===qn.LINEAR){const s=Math.min(t.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===qn.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===qn.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}ay.extension={type:Jt.RendererSystem,name:"texture"};he.add(ay);const WM=new Rc;class oy{constructor(t){this.renderer=t,this._tempMatrix=new yi}generateTexture(t,e){const{region:r,...n}=e||{},s=r||t.getLocalBounds(null,!0);s.width===0&&(s.width=1),s.height===0&&(s.height=1);const a=Ui.create({width:s.width,height:s.height,...n});this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const h=t.transform;return t.transform=WM,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,a}destroy(){}}oy.extension={type:[Jt.RendererSystem,Jt.CanvasRendererSystem],name:"textureGenerator"};he.add(oy);class hy{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color=typeof t.color=="string"?yf(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=M0(t),vo(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}hy.extension={type:[Jt.RendererSystem,Jt.CanvasRendererSystem],name:"background"};he.add(hy);class ly{constructor(t){this.renderer=t}init(t){this.screen=new Te(0,0,t.width,t.height),this.element=t.view||jt.ADAPTER.createCanvas(),this.resolution=t.resolution||jt.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=r,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",r,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}ly.extension={type:[Jt.RendererSystem,Jt.CanvasRendererSystem],name:"_view"};he.add(ly);class cy{constructor(t){this.renderer=t,this.plugins={}}init(t){for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}cy.extension={type:[Jt.RendererSystem,Jt.CanvasRendererSystem],name:"_plugin"};he.add(cy);class zM extends Co{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(n=>t.systems[n]),r=[...e,...Object.keys(t.systems).filter(n=>!e.includes(n))];for(const n of r)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(e=>{this.runners[e]=new nn(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const n in this.runners)this.runners[n].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(n=>{const s=r.find(a=>this._systemsHash[a]===n);n[t.name](e[s])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}class uy{constructor(t){this.renderer=t}run(t){const e=this.renderer;e.emitWithCustomOptions(e.runners.init,t),t.hello&&console.log(`PixiJS 7.0.4 - ${e.rendererLogId} - https://pixijs.com`),e.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}uy.extension={type:[Jt.RendererSystem,Jt.CanvasRendererSystem],name:"startup"};he.add(uy);class dy{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:n}=this;e&&n.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:n}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[n]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let a=0;a<t.buffers.length;a++){const h=t.buffers[a];!h||(r.buffer.update(h),h._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,h._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let a=0;a<t.buffers.length;a++){const h=t.buffers[a];if(!h)continue;const u=h._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!e&&s.dispose(h,e))}!r||(e||n.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}dy.extension={type:Jt.RendererSystem,name:"transformFeedback"};he.add(dy);const fy=[];he.handleByList(Jt.Renderer,fy);function VM(i){for(const t of fy)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var jM=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const XM=jM,Kd=class extends zM{constructor(i){super(),i=Object.assign({},jt.RENDER_OPTIONS,i),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new an({projectionMatrix:new yi},!0);const t={runners:["init","destroy","contextChange","reset","update","postrender","prerender","resize"],systems:Kd.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t);const e={hello:i.hello,_plugin:Kd.__plugins,background:{alpha:i.backgroundAlpha,color:i.background??i.backgroundColor,clearBeforeRender:i.clearBeforeRender},_view:{height:i.height,width:i.width,autoDensity:i.autoDensity,resolution:i.resolution,view:i.view},context:{antialias:i.antialias,context:i.context,powerPreference:i.powerPreference,premultipliedAlpha:i.premultipliedAlpha??(i.useContextAlpha&&i.useContextAlpha!=="notMultiplied"),preserveDrawingBuffer:i.preserveDrawingBuffer}};this.startup.run(e)}static test(i){return i?.forceCanvas?!1:KE()}render(i,t){this.objectRenderer.render(i,t)}resize(i,t){this._view.resizeView(i,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(i=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:i}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return this.background.clearBeforeRender}get useContextAlpha(){return this.context.useContextAlpha}get preserveDrawingBuffer(){return this.context.preserveDrawingBuffer}get backgroundColor(){return this.background.color}set backgroundColor(i){this.background.color=i}get backgroundAlpha(){return this.background.color}set backgroundAlpha(i){this.background.alpha=i}get powerPreference(){return this.context.powerPreference}generateTexture(i,t){return this.textureGenerator.generateTexture(i,t)}};let ba=Kd;ba.extension={type:Jt.Renderer,priority:1};ba.__plugins={};ba.__systems={};he.handleByMap(Jt.RendererPlugin,ba.__plugins);he.handleByMap(Jt.RendererSystem,ba.__systems);he.add(ba);class Zd{constructor(){this.texArray=null,this.blend=0,this.type=wn.TRIANGLES,this.start=0,this.size=0,this.data=null}}class Qd{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class Jd{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}class YM{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let s=0;s<t;s++)r[s]=s;this.defaultGroupCache[t]=an.from({uSamplers:r},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Zn(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new yi,default:this.defaultGroupCache[t]};return new Mr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class py extends Tn{constructor(t=!1){super(),this._buffer=new Ai(null,t,!1),this._indexBuffer=new Ai(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ue.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ue.FLOAT).addAttribute("aColor",this._buffer,4,!0,ue.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ue.FLOAT).addIndex(this._indexBuffer)}}var $M=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,qM=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;const sa=class extends Lc{constructor(i){super(i),this.setShaderGenerator(),this.geometryClass=py,this.vertexSize=6,this.state=rs.for2d(),this.size=jt.SPRITE_BATCH_SIZE*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),i.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultVertexSrc(){return $M}static get defaultFragmentTemplate(){return qM}setShaderGenerator({vertex:i=sa.defaultVertexSrc,fragment:t=sa.defaultFragmentTemplate}={}){this.shaderGenerator=new YM(i,t)}contextChange(){const i=this.renderer.gl;jt.PREFER_ENV===wa.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),jt.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=pM(this.MAX_TEXTURES,i)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:i,_textureArrayPool:t}=sa,e=this.size/4,r=Math.floor(e/this.MAX_TEXTURES)+1;for(;i.length<e;)i.push(new Zd);for(;t.length<r;)t.push(new Qd);for(let n=0;n<this.MAX_TEXTURES;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(i){!i._texture.valid||(this._vertexCount+i.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=i.vertexData.length/2,this._indexCount+=i.indices.length,this._bufferedTextures[this._bufferSize]=i._texture.baseTexture,this._bufferedElements[this._bufferSize++]=i)}buildTexturesAndDrawCalls(){const{_bufferedTextures:i,MAX_TEXTURES:t}=this,e=sa._textureArrayPool,r=this.renderer.batch,n=this._tempBoundTextures,s=this.renderer.textureGC.count;let a=++Le._globalBatch,h=0,u=e[0],d=0;r.copyBoundTextures(n,t);for(let m=0;m<this._bufferSize;++m){const l=i[m];i[m]=null,l._batchEnabled!==a&&(u.count>=t&&(r.boundArray(u,n,a,t),this.buildDrawCalls(u,d,m),d=m,u=e[++h],++a),l._batchEnabled=a,l.touched=s,u.elements[u.count++]=l)}u.count>0&&(r.boundArray(u,n,a,t),this.buildDrawCalls(u,d,this._bufferSize),++h,++a);for(let m=0;m<n.length;m++)n[m]=null;Le._globalBatch=a}buildDrawCalls(i,t,e){const{_bufferedElements:r,_attributeBuffer:n,_indexBuffer:s,vertexSize:a}=this,h=sa._drawCallPool;let u=this._dcIndex,d=this._aIndex,m=this._iIndex,l=h[u];l.start=this._iIndex,l.texArray=i;for(let f=t;f<e;++f){const p=r[f],y=p._texture.baseTexture,_=I0[y.alphaMode?1:0][p.blendMode];r[f]=null,t<f&&l.blend!==_&&(l.size=m-l.start,t=f,l=h[++u],l.texArray=i,l.start=m),this.packInterleavedGeometry(p,n,s,d,m),d+=p.vertexData.length/2*a,m+=p.indices.length,l.blend=_}t<e&&(l.size=m-l.start,++u),this._dcIndex=u,this._aIndex=d,this._iIndex=m}bindAndClearTexArray(i){const t=this.renderer.texture;for(let e=0;e<i.count;e++)t.bind(i.elements[e],i.ids[e]),i.elements[e]=null;i.count=0}updateGeometry(){const{_packedGeometries:i,_attributeBuffer:t,_indexBuffer:e}=this;jt.CAN_UPLOAD_SAME_BUFFER?(i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const i=this._dcIndex,{gl:t,state:e}=this.renderer,r=sa._drawCallPool;let n=null;for(let s=0;s<i;s++){const{texArray:a,type:h,size:u,start:d,blend:m}=r[s];n!==a&&(n=a,this.bindAndClearTexArray(a)),this.state.blendMode=m,e.set(this.state),t.drawElements(h,u,t.UNSIGNED_SHORT,d*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),jt.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(i){const t=fc(Math.ceil(i/8)),e=og(t),r=t*8;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._aBuffers[r];return n||(this._aBuffers[r]=n=new Jd(r*this.vertexSize*4)),n}getIndexBuffer(i){const t=fc(Math.ceil(i/12)),e=og(t),r=t*12;this._iBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._iBuffers[e];return n||(this._iBuffers[e]=n=new Uint16Array(r)),n}packInterleavedGeometry(i,t,e,r,n){const{uint32View:s,float32View:a}=t,h=r/this.vertexSize,u=i.uvs,d=i.indices,m=i.vertexData,l=i._texture.baseTexture._batchLocation,f=Math.min(i.worldAlpha,1),p=f<1&&i._texture.baseTexture.alphaMode?_f(i._tintRGB,f):i._tintRGB+(f*255<<24);for(let y=0;y<m.length;y+=2)a[r++]=m[y],a[r++]=m[y+1],a[r++]=u[y],a[r++]=u[y+1],s[r++]=p,a[r++]=l;for(let y=0;y<d.length;y++)e[n++]=h+d[y]}};let Fc=sa;Fc.extension={name:"batch",type:Jt.RendererPlugin};Fc._drawCallPool=[];Fc._textureArrayPool=[];he.add(Fc);class KM{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class my{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,r){const{gl:n,CONTEXT_UID:s}=this;r=r||0;const a=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,a.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),r&&(e||n.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new KM(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}my.extension={type:Jt.RendererSystem,name:"buffer"};he.add(my);class gy{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=Ti.HIGH?this.multisample=Ti.HIGH:e>=Ti.MEDIUM?this.multisample=Ti.MEDIUM:e>=Ti.LOW?this.multisample=Ti.LOW:this.multisample=Ti.NONE}destroy(){}}gy.extension={type:Jt.RendererSystem,name:"_multisample"};he.add(gy);class yy{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let n,s,a,h;if(e&&(n=e.renderTexture,s=e.clear,a=e.transform,h=e.skipUpdateTransform),this.renderingToScreen=!n,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=a,!r.context.isLost){if(n||(this.lastObjectRendered=t),!h){const u=t.enableTempParent();t.updateTransform(),t.disableTempParent(u)}r.renderTexture.bind(n),r.batch.currentRenderer.start(),(s??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),n&&(e.blit&&r.framebuffer.blit(),n.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}yy.extension={type:Jt.RendererSystem,name:"objectRenderer"};he.add(yy);var ZM=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class wg extends Mh{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(XM,ZM,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const r=t>>16&255,n=t>>8&255,s=t&255,a=[r/255,0,0,0,0,0,n/255,0,0,0,0,0,s/255,0,0,0,0,0,1,0];this._loadMatrix(a,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),n=Math.sin(t),s=Math.sqrt,a=1/3,h=s(a),u=r+(1-r)*a,d=a*(1-r)-h*n,m=a*(1-r)+h*n,l=a*(1-r)+h*n,f=r+a*(1-r),p=a*(1-r)-h*n,y=a*(1-r)-h*n,_=a*(1-r)+h*n,v=r+a*(1-r),w=[u,d,m,0,0,l,f,p,0,0,y,_,v,0,0,0,0,0,1,0];this._loadMatrix(w,e)}contrast(t,e){const r=(t||0)+1,n=-.5*(r-1),s=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const r=t*2/3+1,n=(r-1)*-.5,s=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,n,s){t=t||.2,e=e||.15,r=r||16770432,n=n||3375104;const a=(r>>16&255)/255,h=(r>>8&255)/255,u=(r&255)/255,d=(n>>16&255)/255,m=(n>>8&255)/255,l=(n&255)/255,f=[.3,.59,.11,0,0,a,h,u,t,0,d,m,l,e,0,a-d,h-m,u-l,0,0];this._loadMatrix(f,s)}night(t,e){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}wg.prototype.grayscale=wg.prototype.greyscale;jt.SORTABLE_CHILDREN=!1;class mc{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Te.EMPTY:(t=t||new Te(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:n,c:s,d:a,tx:h,ty:u}=t,d=r*e.x+s*e.y+h,m=n*e.x+a*e.y+u;this.minX=Math.min(this.minX,d),this.maxX=Math.max(this.maxX,d),this.minY=Math.min(this.minY,m),this.maxY=Math.max(this.maxY,m)}addQuad(t){let e=this.minX,r=this.minY,n=this.maxX,s=this.maxY,a=t[0],h=t[1];e=a<e?a:e,r=h<r?h:r,n=a>n?a:n,s=h>s?h:s,a=t[2],h=t[3],e=a<e?a:e,r=h<r?h:r,n=a>n?a:n,s=h>s?h:s,a=t[4],h=t[5],e=a<e?a:e,r=h<r?h:r,n=a>n?a:n,s=h>s?h:s,a=t[6],h=t[7],e=a<e?a:e,r=h<r?h:r,n=a>n?a:n,s=h>s?h:s,this.minX=e,this.minY=r,this.maxX=n,this.maxY=s}addFrame(t,e,r,n,s){this.addFrameMatrix(t.worldTransform,e,r,n,s)}addFrameMatrix(t,e,r,n,s){const a=t.a,h=t.b,u=t.c,d=t.d,m=t.tx,l=t.ty;let f=this.minX,p=this.minY,y=this.maxX,_=this.maxY,v=a*e+u*r+m,w=h*e+d*r+l;f=v<f?v:f,p=w<p?w:p,y=v>y?v:y,_=w>_?w:_,v=a*n+u*r+m,w=h*n+d*r+l,f=v<f?v:f,p=w<p?w:p,y=v>y?v:y,_=w>_?w:_,v=a*e+u*s+m,w=h*e+d*s+l,f=v<f?v:f,p=w<p?w:p,y=v>y?v:y,_=w>_?w:_,v=a*n+u*s+m,w=h*n+d*s+l,f=v<f?v:f,p=w<p?w:p,y=v>y?v:y,_=w>_?w:_,this.minX=f,this.minY=p,this.maxX=y,this.maxY=_}addVertexData(t,e,r){let n=this.minX,s=this.minY,a=this.maxX,h=this.maxY;for(let u=e;u<r;u+=2){const d=t[u],m=t[u+1];n=d<n?d:n,s=m<s?m:s,a=d>a?d:a,h=m>h?m:h}this.minX=n,this.minY=s,this.maxX=a,this.maxY=h}addVertices(t,e,r,n){this.addVerticesMatrix(t.worldTransform,e,r,n)}addVerticesMatrix(t,e,r,n,s=0,a=s){const h=t.a,u=t.b,d=t.c,m=t.d,l=t.tx,f=t.ty;let p=this.minX,y=this.minY,_=this.maxX,v=this.maxY;for(let w=r;w<n;w+=2){const C=e[w],E=e[w+1],k=h*C+d*E+l,G=m*E+u*C+f;p=Math.min(p,k-s),_=Math.max(_,k+s),y=Math.min(y,G-a),v=Math.max(v,G+a)}this.minX=p,this.minY=y,this.maxX=_,this.maxY=v}addBounds(t){const e=this.minX,r=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=s&&n<=a){const h=this.minX,u=this.minY,d=this.maxX,m=this.maxY;this.minX=r<h?r:h,this.minY=n<u?n:u,this.maxX=s>d?s:d,this.maxY=a>m?a:m}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=s&&n<=a){const h=this.minX,u=this.minY,d=this.maxX,m=this.maxY;this.minX=r<h?r:h,this.minY=n<u?n:u,this.maxX=s>d?s:d,this.maxY=a>m?a:m}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,n,s,a){t-=s,e-=a,r+=s,n+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class di extends Co{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Rc,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new mc,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const n=e[r];Object.defineProperty(di.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Te),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Te),t=this._localBoundsRect),this._localBounds||(this._localBounds=new mc);const e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-s,a}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,r=1,n=1,s=0,a=0,h=0,u=0,d=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=n||1,this.rotation=s,this.skew.x=a,this.skew.y=h,this.pivot.x=u,this.pivot.y=d,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new QM),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*cE}set angle(t){this.transform.rotation=t*uE}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class QM extends di{constructor(){super(...arguments),this.sortDirty=null}}di.prototype.displayObjectUpdateTransform=di.prototype.updateTransform;function JM(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}class we extends di{constructor(){super(),this.children=[],this.sortableChildren=jt.SORTABLE_CHILDREN,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t,this.onChildrenChange(r<n?r:n)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);go(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,go(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,go(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,n=e,s=n-r;let a;if(s>0&&s<=n){a=this.children.splice(r,s);for(let h=0;h<a.length;++h)a[h].parent=null,a[h].transform&&(a[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let h=0;h<a.length;++h)a[h].emit("removed",this),this.emit("childRemoved",a[h],this,h);return a}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const n=this.children[e];n._lastSortedIndex=e,!t&&n.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(JM),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let n=0,s=this.children.length;n<s;++n){const a=this.children[n];a.visible&&a.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,n;if(this.cullArea?(r=this.cullArea,n=this.worldTransform):this._render!==we.prototype._render&&(r=this.getBounds(!0)),r&&e.intersects(r,n))this._render(t);else if(this.cullArea)return;for(let s=0,a=this.children.length;s<a;++s){const h=this.children[s],u=h.cullable;h.cullable=u||!this.cullArea,h.render(t),h.cullable=u}}render(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let s=0;s<e.length;s++)e[s].enabled&&this._enabledFilters.push(e[s])}const n=e&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==ki.NONE));if(n&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let s=0,a=this.children.length;s<a;++s)this.children[s].render(t)}n&&t.batch.flush(),r&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t?.children,r=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<r.length;++n)r[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}}we.prototype.containerUpdateTransform=we.prototype.updateTransform;const ch=new Ue,t2=new Uint16Array([0,1,2,0,2,3]);class Pe extends we{constructor(t){super(),this._anchor=new Ss(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=ce.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Ut.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=t2,this.pluginName="batch",this.isSprite=!0,this._roundPixels=jt.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=ao(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=ao(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,n=e.b,s=e.c,a=e.d,h=e.tx,u=e.ty,d=this.vertexData,m=t.trim,l=t.orig,f=this._anchor;let p=0,y=0,_=0,v=0;if(m?(y=m.x-f._x*l.width,p=y+m.width,v=m.y-f._y*l.height,_=v+m.height):(y=-f._x*l.width,p=y+l.width,v=-f._y*l.height,_=v+l.height),d[0]=r*y+s*v+h,d[1]=a*v+n*y+u,d[2]=r*p+s*v+h,d[3]=a*v+n*p+u,d[4]=r*p+s*_+h,d[5]=a*_+n*p+u,d[6]=r*y+s*_+h,d[7]=a*_+n*y+u,this._roundPixels){const w=jt.RESOLUTION;for(let C=0;C<d.length;++C)d[C]=Math.round(d[C]*w)/w}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,n=this._anchor,s=this.transform.worldTransform,a=s.a,h=s.b,u=s.c,d=s.d,m=s.tx,l=s.ty,f=-n._x*r.width,p=f+r.width,y=-n._y*r.height,_=y+r.height;e[0]=a*f+u*y+m,e[1]=d*y+h*f+l,e[2]=a*p+u*y+m,e[3]=d*y+h*p+l,e[4]=a*p+u*_+m,e[5]=d*_+h*p+l,e[6]=a*f+u*_+m,e[7]=d*_+h*f+l}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new mc),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Te),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,ch);const e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x;let s=0;return ch.x>=n&&ch.x<n+e&&(s=-r*this.anchor.y,ch.y>=s&&ch.y<s+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.baseTexture;this._texture.destroy(!!r)}this._texture=null}static from(t,e){const r=t instanceof Ut?t:Ut.from(t,e);return new Pe(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=ao(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=ao(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Ut.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const _y=new yi;di.prototype._cacheAsBitmap=!1;di.prototype._cacheData=null;di.prototype._cacheAsBitmapResolution=null;di.prototype._cacheAsBitmapMultisample=null;class e2{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(di.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let t;i?(this._cacheData||(this._cacheData=new e2),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});di.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};di.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const r=this.getLocalBounds(null,!0).clone();if(this.filters?.length){const f=this.filters[0].padding;r.pad(f)}r.ceil(jt.RESOLUTION);const n=t.renderTexture.current,s=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),h=t.projection.transform,u=Ui.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),d=`cacheAsBitmap_${ga()}`;this._cacheData.textureCacheId=d,Le.addToCache(u.baseTexture,d),Ut.addToCache(u,d);const m=this.transform.localTransform.copyTo(_y).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:u,clear:!0,transform:m,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=h,t.renderTexture.bind(n,s,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const l=new Pe(u);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(r.x/r.width),l.anchor.y=-(r.y/r.height),l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=l.containsPoint.bind(l)};di.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};di.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,s=t._projTransform;e.ceil(jt.RESOLUTION);const a=Ui.create({width:e.width,height:e.height}),h=`cacheAsBitmap_${ga()}`;this._cacheData.textureCacheId=h,Le.addToCache(a.baseTexture,h),Ut.addToCache(a,h);const u=_y;this.transform.localTransform.copyTo(u),u.invert(),u.tx-=e.x,u.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:a,clear:!0,transform:u,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const d=new Pe(a);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-(e.x/e.width),d.anchor.y=-(e.y/e.height),d.alpha=r,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=d.containsPoint.bind(d)};di.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};di.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};di.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Le.removeFromCache(this._cacheData.textureCacheId),Ut.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};di.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};di.prototype.name=null;we.prototype.getChildByName=function(t,e){for(let r=0,n=this.children.length;r<n;r++)if(this.children[r].name===t)return this.children[r];if(e)for(let r=0,n=this.children.length;r<n;r++){const s=this.children[r];if(!s.getChildByName)continue;const a=s.getChildByName(t,!0);if(a)return a}return null};di.prototype.getGlobalPosition=function(t=new Ue,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const i2={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};class kh{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=kh.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ue,this.page=new Ue,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class gc extends kh{constructor(){super(...arguments),this.client=new Ue,this.movement=new Ue,this.offset=new Ue,this.global=new Ue,this.screen=new Ue}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,n,s,a,h,u,d,m,l,f,p,y,_){throw new Error("Method not implemented.")}}class Jr extends gc{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class tf extends gc{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const r2=2048,n2=new Ue,md=new Ue;class s2{constructor(t){this.dispatch=new Co,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((r,n)=>r.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,n=e.length;r<n;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){const r=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,n2.set(t,e),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=r.length-1;n<s;n++)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=r.length-2;n>=0;n--)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const n=r.children;if(n)for(let s=0;s<n.length;s++)this.all(t,e,n[s]);t.currentTarget=r,this.notifyTarget(t,e)}propagationPath(t){const e=[t];for(let r=0;r<r2&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestRecursive(t,e,r,n,s){if(!t||!t.visible||s(t,r))return null;if(t.interactiveChildren&&t.children){const a=t.children;for(let h=a.length-1;h>=0;h--){const u=a[h],d=this.hitTestRecursive(u,e||u.interactive,r,n,s);if(d){if(d.length>0&&!d[d.length-1].parent)continue;return(d.length>0||t.interactive)&&d.push(t),d}}}return e&&n(t,r)?t.interactive?[t]:[]:null}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,md),!t.hitArea.contains(md.x,md.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!r.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){e=e??t.type;const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,r),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Jr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const n=e.button===2;this.dispatchEvent(e,n?"rightdown":"mousedown")}const r=this.trackingData(t.pointerId);r.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Jr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t),r=e.pointerType==="mouse"||e.pointerType==="pen",n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(n.overTargets&&s!==e.target){const h=t.type==="mousemove"?"mouseout":"pointerout",u=this.createPointerEvent(t,h,s);if(this.dispatchEvent(u,"pointerout"),r&&this.dispatchEvent(u,"mouseout"),!e.composedPath().includes(s)){const d=this.createPointerEvent(t,"pointerleave",s);for(d.eventPhase=d.AT_TARGET;d.target&&!e.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),r&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(u)}if(s!==e.target){const h=t.type==="mousemove"?"mouseover":"pointerover",u=this.clonePointerEvent(e,h);this.dispatchEvent(u,"pointerover"),r&&this.dispatchEvent(u,"mouseover");let d=s?.parent;for(;d&&d!==this.rootTarget.parent&&d!==e.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const l=this.clonePointerEvent(e,"pointerenter");for(l.eventPhase=l.AT_TARGET;l.target&&l.target!==s&&l.target!==this.rootTarget.parent;)l.currentTarget=l.target,this.notifyTarget(l),r&&this.notifyTarget(l,"mouseenter"),l.target=l.target.parent;this.freeEvent(l)}this.freeEvent(u)}const a=this.moveOnAll?"all":"dispatchEvent";this[a](e,"pointermove"),e.pointerType==="touch"&&this[a](e,"touchmove"),r&&(this[a](e,"mousemove"),this.cursor=e.target?.cursor),n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Jr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),n=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=r.target?.cursor);const s=this.clonePointerEvent(r,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof Jr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const r=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),r&&this.dispatchEvent(s,"mouseout");const a=this.createPointerEvent(t,"pointerleave",n);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),r&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(a)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Jr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const h=r.button===2;this.dispatchEvent(r,h?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let a=s;if(s&&!r.composedPath().includes(s)){let h=s;for(;h&&!r.composedPath().includes(h);){if(r.currentTarget=h,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const u=r.button===2;this.notifyTarget(r,u?"rightupoutside":"mouseupoutside")}h=h.parent}delete n.pressTargetsByButton[t.button],a=h}if(a){const h=this.clonePointerEvent(r,"click");h.target=a,h.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:h.target,timeStamp:e});const u=n.clicksByButton[t.button];u.target===h.target&&e-u.timeStamp<200?++u.clickCount:u.clickCount=1,u.target=h.target,u.timeStamp=e,h.detail=u.clickCount,h.pointerType==="mouse"?this.dispatchEvent(h,"click"):h.pointerType==="touch"&&this.dispatchEvent(h,"tap"),this.dispatchEvent(h,"pointertap"),this.freeEvent(h)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof Jr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(r){let s=r;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof tf)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){const n=this.allocateEvent(Jr);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=r??this.hitTest(n.global.x,n.global.y),typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(tf);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(Jr);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Jr&&e instanceof Jr&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof gc&&e instanceof gc&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(!!r)if("fn"in r)r.fn.call(r.context,t);else for(let n=0,s=r.length;n<s&&!t.propagationImmediatelyStopped;n++)r[n].fn.call(r[n].context,t)}}const a2=1,o2={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class vy{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new s2(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Jr(null),this.rootWheelEvent=new tf(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let r=0,n=e.length;r<n;r++){const s=e[r],a=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const s=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let s=0,a=n.length;s<a;s++){const h=this.bootstrapEvent(this.rootPointerEvent,n[s]);h.type+=r,this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const s=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){let n;this.domElement.parentElement?n=this.domElement.getBoundingClientRect():n={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const s=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*s,t.y=(r-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,n=t.changedTouches.length;r<n;r++){const s=t.changedTouches[r];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=a2),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=o2[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}}vy.extension={name:"events",type:[Jt.RendererSystem,Jt.CanvasRendererSystem]};he.add(vy);const h2={interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.on(i,t,n)},removeEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.off(i,t,n)},dispatchEvent(i){if(!(i instanceof kh))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};di.mixin(h2);di.mixin(i2);const l2=9,Nl=100,c2=0,u2=0,bg=2,xg=1,d2=-1e3,f2=-1e3,p2=2;class wy{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Kn.tablet||Kn.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${Nl}px`,e.style.height=`${Nl}px`,e.style.position="absolute",e.style.top=`${c2}px`,e.style.left=`${u2}px`,e.style.zIndex=bg.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${xg}px`,t.style.height=`${xg}px`,t.style.position="absolute",t.style.top=`${d2}px`,t.style.left=`${f2}px`,t.style.zIndex=p2.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){!this._hookDiv||(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}update(){const t=performance.now();if(Kn.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:a,height:h,resolution:u}=this.renderer,d=n/a*u,m=s/h*u;let l=this.div;l.style.left=`${e}px`,l.style.top=`${r}px`,l.style.width=`${a}px`,l.style.height=`${h}px`;for(let f=0;f<this.children.length;f++){const p=this.children[f];if(p.renderId!==this.renderId)p._accessibleActive=!1,go(this.children,f,1),this.div.removeChild(p._accessibleDiv),this.pool.push(p._accessibleDiv),p._accessibleDiv=null,f--;else{l=p._accessibleDiv;let y=p.hitArea;const _=p.worldTransform;p.hitArea?(l.style.left=`${(_.tx+y.x*_.a)*d}px`,l.style.top=`${(_.ty+y.y*_.d)*m}px`,l.style.width=`${y.width*_.a*d}px`,l.style.height=`${y.height*_.d*m}px`):(y=p.getBounds(),this.capHitArea(y),l.style.left=`${y.x*d}px`,l.style.top=`${y.y*m}px`,l.style.width=`${y.width*d}px`,l.style.height=`${y.height*m}px`,l.title!==p.accessibleTitle&&p.accessibleTitle!==null&&(l.title=p.accessibleTitle),l.getAttribute("aria-label")!==p.accessibleHint&&p.accessibleHint!==null&&l.setAttribute("aria-label",p.accessibleHint)),(p.accessibleTitle!==l.title||p.tabIndex!==l.tabIndex)&&(l.title=p.accessibleTitle,l.tabIndex=p.tabIndex,this.debug&&this.updateDebugHTML(l))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${Nl}px`,e.style.height=`${Nl}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=bg.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new kh(n),{target:r});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(a=>n.dispatchEvent(s,a))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===l2&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}wy.extension={name:"accessibility",type:[Jt.RendererPlugin,Jt.CanvasRendererPlugin]};he.add(wy);const ef=class{constructor(i){this.stage=new we,i=Object.assign({forceCanvas:!1},i),this.renderer=VM(i),ef._plugins.forEach(t=>{t.init.call(this,i)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(i,t){const e=ef._plugins.slice(0);e.reverse(),e.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(i),this.renderer=null}};let by=ef;by._plugins=[];he.handleByList(Jt.Application,by._plugins);class xy{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{!this._resizeTo||(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;e=n,r=s}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}xy.extension=Jt.Application;he.add(xy);class m2{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const Qn=(i,t)=>(Array.isArray(i)||(i=[i]),t?i.map(e=>typeof e=="string"?t(e):e):i);function Ay(i,t,e,r,n){const s=t[e];for(let a=0;a<s.length;a++){const h=s[a];e<t.length-1?Ay(i.replace(r[e],h),t,e+1,r,n):n.push(i.replace(r[e],h))}}function g2(i){const t=/\{(.*?)\}/g,e=i.match(t),r=[];if(e){const n=[];e.forEach(s=>{const a=s.substring(1,s.length-1).split(",");n.push(a)}),Ay(i,n,0,e,r)}else r.push(i);return r}const yc=i=>!Array.isArray(i);class y2{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){return this._cache.get(t)}set(t,e){const r=Qn(t);let n;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];if(u.test(e)){n=u.getCacheableAssets(r,e);break}}n||(n={},r.forEach(h=>{n[h]=e}));const s=Object.keys(n),a={cacheKeys:s,keys:r};if(r.forEach(h=>{this._cacheMap.set(h,a)}),s.forEach(h=>{this._cache.has(h)&&this._cache.get(h),this._cache.set(h,n[h])}),e instanceof Ut){const h=e;r.forEach(u=>{h.baseTexture!==Ut.EMPTY.baseTexture&&Le.addToCache(h.baseTexture,u),Ut.addToCache(h,u)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return;const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const uh=new y2;class _2{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{let n=null;for(let s=0;s<this.parsers.length;s++){const a=this.parsers[s];if(a.load&&a.test?.(t,e,this)){n=await a.load(t,e,this),r.parser=a;break}}if(!r.parser)return null;for(let s=0;s<this.parsers.length;s++){const a=this.parsers[s];a.parse&&a.parse&&await a.testParse?.(n,e,this)&&(n=await a.parse(n,e,this)||n,r.parser=a)}return n})(),r}async load(t,e){let r=0;const n={},s=yc(t),a=Qn(t,d=>({src:d})),h=a.length,u=a.map(async d=>{const m=$i.toAbsolute(d.src);if(!n[d.src])try{this.promiseCache[m]||(this.promiseCache[m]=this._getLoadPromiseAndParser(m,d)),n[d.src]=await this.promiseCache[m].promise,e&&e(++r/h)}catch(l){throw delete this.promiseCache[m],delete n[d.src],new Error(`[Loader.load] Failed to load ${m}.
${l}`)}});return await Promise.all(u),s?n[a[0].src]:n}async unload(t){const r=Qn(t,n=>({src:n})).map(async n=>{const s=$i.toAbsolute(n.src),a=this.promiseCache[s];if(a){const h=await a.promise;a.parser?.unload?.(h,n,this),delete this.promiseCache[s]}});await Promise.all(r)}get parsers(){return this._parsers}}class v2{constructor(){this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}addManifest(t){this._manifest,this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach(n=>{typeof n.name=="string"?r.push(n.name):r.push(...n.name),this.add(n.name,n.srcs)}):Object.keys(e).forEach(n=>{r.push(n),this.add(n,e[n])}),this._bundles[t]=r}add(t,e,r){const n=Qn(t);n.forEach(a=>{this._assetMap[a]}),Array.isArray(e)||(typeof e=="string"?e=g2(e):e=[e]);const s=e.map(a=>{let h=a;if(typeof a=="string"){let u=!1;for(let d=0;d<this._parsers.length;d++){const m=this._parsers[d];if(m.test(a)){h=m.parse(a),u=!0;break}}u||(h={src:a})}return h.format||(h.format=h.src.split(".").pop()),h.alias||(h.alias=n),(this._basePath||this._rootPath)&&(h.src=$i.toAbsolute(h.src,this._basePath,this._rootPath)),h.data=h.data??r,h});n.forEach(a=>{this._assetMap[a]=s})}resolveBundle(t){const e=yc(t);t=Qn(t);const r={};return t.forEach(n=>{const s=this._bundles[n];s&&(r[n]=this.resolve(s))}),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const r={};for(const n in e)r[n]=e[n].src;return r}return e.src}resolve(t){const e=yc(t);t=Qn(t);const r={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const a=this._getPreferredOrder(s),h=s[0];a?.priority.forEach(u=>{a.params[u].forEach(d=>{const m=s.filter(l=>l[u]?l[u]===d:!1);m.length&&(s=m)})}),this._resolverHash[n]=s[0]??h}else{let s=n;(this._basePath||this._rootPath)&&(s=$i.toAbsolute(s,this._basePath,this._rootPath)),this._resolverHash[n]={src:s}}r[n]=this._resolverHash[n]}),e?r[t[0]]:r}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const r=t[0],n=this._preferredOrder.find(s=>s.params.format.includes(r.format));if(n)return n}return this._preferredOrder[0]}}class w2{constructor(){this._detections=[],this._initialized=!1,this.resolver=new v2,this.loader=new _2,this.cache=uh,this._backgroundLoader=new m2(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return;if(this._initialized=!0,t.basePath&&(this.resolver.basePath=t.basePath),t.manifest){let s=t.manifest;typeof s=="string"&&(s=await this.load(s)),this.resolver.addManifest(s)}const e=t.texturePreference?.resolution??1,r=typeof e=="number"?[e]:e;let n=[];if(t.texturePreference?.format){const s=t.texturePreference?.format;n=typeof s=="string"?[s]:s;for(const a of this._detections)await a.test()||(n=await a.remove(n))}else for(const s of this._detections)await s.test()&&(n=await s.add(n));this.resolver.prefer({params:{format:n,resolution:r}})}add(t,e,r){this.resolver.add(t,e,r)}async load(t,e){this._initialized||await this.init();const r=yc(t),n=Qn(t).map(h=>typeof h!="string"?(this.resolver.add(h.src,h),h.src):h),s=this.resolver.resolve(n),a=await this._mapLoadToResolve(s,e);return r?a[n[0]]:a}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},a=Object.keys(n);let h=0,u=0;const d=()=>{e?.(++h/u)},m=a.map(l=>{const f=n[l];return u+=Object.keys(f).length,this._mapLoadToResolve(f,d).then(p=>{s[l]=p})});return await Promise.all(m),r?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return uh.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=uh.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(r,e);this._backgroundLoader.active=!0;const a={};return r.forEach((h,u)=>{const d=s[h.src],m=[h.src];h.alias&&m.push(...h.alias),a[n[u]]=d,uh.set(m,d)}),a}async unload(t){this._initialized||await this.init();const e=Qn(t).map(n=>typeof n!="string"?n.src:n),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=Qn(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(r=>{uh.remove(r.src)}),await this.loader.unload(e)}get detections(){return this._detections}}const ho=new w2;he.handleByList(Jt.LoadParser,ho.loader.parsers).handleByList(Jt.ResolveParser,ho.resolver.parsers).handleByList(Jt.CacheParser,ho.cache.parsers).handleByList(Jt.DetectionParser,ho.detections);const Ag={loader:Jt.LoadParser,resolver:Jt.ResolveParser,cache:Jt.CacheParser,detection:Jt.DetectionParser};he.handle(Jt.Asset,i=>{const t=i.ref;Object.entries(Ag).filter(([e])=>!!t[e]).forEach(([e,r])=>he.add(Object.assign(t[e],{extension:t[e].extension??r})))},i=>{const t=i.ref;Object.keys(Ag).filter(e=>!!t[e]).forEach(e=>he.remove(t[e]))});const b2={extension:Jt.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof Ut),getCacheableAssets:(i,t)=>{const e={};return i.forEach(r=>{t.forEach((n,s)=>{e[r+(s===0?"":s+1)]=n})}),e}};he.add(b2);var Sn=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(Sn||{});const x2={extension:{type:Jt.LoadParser,priority:Sn.Low},test(i){return $i.extname(i).includes(".json")},async load(i){return await(await jt.ADAPTER.fetch(i)).json()}};he.add(x2);const A2={extension:{type:Jt.LoadParser,priority:Sn.Low},test(i){return $i.extname(i).includes(".txt")},async load(i){return await(await jt.ADAPTER.fetch(i)).text()}};he.add(A2);const E2=["normal","bold","100","200","300","400","500","600","700","800","900"],T2=["woff","woff2","ttf","otf"];function S2(i){const t=$i.extname(i);return $i.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ")}const C2={extension:{type:Jt.LoadParser,priority:Sn.Low},test(i){const e=i.split("?")[0].split(".").pop();return T2.includes(e)},async load(i,t){if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const e=jt.ADAPTER.getFontFaceSet();if(e){const r=[],n=t.data?.family??S2(i),s=t.data?.weights?.filter(h=>E2.includes(h))??["normal"],a=t.data??{};for(let h=0;h<s.length;h++){const u=s[h],d=new FontFace(n,`url(${i})`,{...a,weight:u});await d.load(),e.add(d),r.push(d)}return r.length===1?r[0]:r}return null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>jt.ADAPTER.getFontFaceSet().delete(t))}};he.add(C2);let Eg=0,gd;const M2="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",I2={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${M2}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},B2={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let yd;class R2{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([I2.code],{type:"application/javascript"})),r=new Worker(e);r.addEventListener("message",n=>{r.terminate(),URL.revokeObjectURL(e),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){gd===void 0&&(gd=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<gd&&(yd||(yd=URL.createObjectURL(new Blob([B2.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(yd),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise((n,s)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:s})});return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[Eg]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Eg++,id:r})}}const Tg=new R2;function bf(i,t){const e=i.split("?")[0],r=$i.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r.toLowerCase()):r.toLowerCase()===t}function Oc(i,t,e){const r=new Ut(i);return r.baseTexture.on("dispose",()=>{delete t.promiseCache[e]}),r}const _d=[".jpg",".png",".jpeg",".avif",".webp"];async function k2(i){const t=await jt.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const xf={extension:{type:Jt.LoadParser,priority:Sn.High},config:{preferWorkers:!0},test(i){let t=!1;for(let e=0;e<_d.length;e++)if(i.startsWith(`data:image/${_d[e].slice(1)}`)){t=!0;break}return t||bf(i,_d)},async load(i,t,e){let r=null;globalThis.createImageBitmap?this.config.preferWorkers&&await Tg.isImageBitmapSupported()?r=await Tg.loadImageBitmap(i):r=await k2(i):r=await new Promise(s=>{r=new Image,r.crossOrigin="anonymous",r.src=i,r.complete?s(r):r.onload=()=>{s(r)}});const n=new Le(r,{resolution:Bs(i),...t.data});return n.resource.src=i,Oc(n,e,i)},unload(i){i.destroy(!0)}};he.add(xf);Jt.LoadParser,Sn.High,xf.unload;const P2={extension:Jt.ResolveParser,test:xf.test,parse:i=>({resolution:parseFloat(jt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:i.split(".").pop(),src:i})};he.add(P2);const D2={extension:{type:Jt.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await jt.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};he.add(D2);const L2={extension:{type:Jt.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await jt.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};he.add(L2);const Sg=["png","jpg","jpeg"],F2={extension:{type:Jt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...Sg],remove:async i=>i.filter(t=>!Sg.includes(t))};he.add(F2);var Cr=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i))(Cr||{});const _c={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};class O2 extends Rh{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,n;typeof t=="string"?(r=t,n=new Uint8Array):(r=null,n=t),super(n,e),this.origin=r,this.buffer=n?new Jd(n):null,this.origin&&e.autoLoad!==!1&&this.load(),n?.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const r=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(r),this.buffer=new Jd(r),this.loaded=!0,this.onBlobLoaded(r),this.update(),this}}class ca extends O2{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=ca._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||ca._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let a=0,h=this.levels;a<h;a++){const{levelID:u,levelWidth:d,levelHeight:m,levelBuffer:l}=this._levelBuffers[a];n.compressedTexImage2D(n.TEXTURE_2D,u,this.format,d,m,0,l)}return!0}onBlobLoaded(){this._levelBuffers=ca._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,r,n,s,a,h){const u=new Array(r);let d=t.byteOffset,m=a,l=h,f=m+n-1&~(n-1),p=l+s-1&~(s-1),y=f*p*_c[e];for(let _=0;_<r;_++)u[_]={levelID:_,levelWidth:r>1?m:f,levelHeight:r>1?l:p,levelBuffer:new Uint8Array(t.buffer,d,y)},d+=y,m=m>>1||1,l=l>>1||1,f=m+n-1&~(n-1),p=l+s-1&~(s-1),y=f*p*_c[e];return u}}let Yn,no;function Cg(){no={s3tc:Yn.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Yn.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Yn.getExtension("WEBGL_compressed_texture_etc"),etc1:Yn.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Yn.getExtension("WEBGL_compressed_texture_pvrtc")||Yn.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Yn.getExtension("WEBGL_compressed_texture_atc"),astc:Yn.getExtension("WEBGL_compressed_texture_astc")}}const N2={extension:{type:Jt.DetectionParser,priority:2},test:async()=>{const t=jt.ADAPTER.createCanvas().getContext("webgl");return t?(Yn=t,!0):!1},add:async i=>{no||Cg();const t=[];for(const e in no)!no[e]||t.push(e);return[...t,...i]},remove:async i=>(no||Cg(),i.filter(t=>!(t in no)))};he.add(N2);const vd=4,Ul=124,U2=32,Mg=20,H2=542327876,Hl={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},G2={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Gl={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},W2=1,z2=2,V2=4,j2=64,X2=512,Y2=131072,$2=827611204,q2=861165636,K2=894720068,Z2=808540228,Q2=4,J2={[$2]:Cr.COMPRESSED_RGBA_S3TC_DXT1_EXT,[q2]:Cr.COMPRESSED_RGBA_S3TC_DXT3_EXT,[K2]:Cr.COMPRESSED_RGBA_S3TC_DXT5_EXT},tI={[70]:Cr.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:Cr.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:Cr.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:Cr.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:Cr.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:Cr.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:Cr.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:Cr.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:Cr.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function eI(i){const t=new Uint32Array(i);if(t[0]!==H2)throw new Error("Invalid DDS file magic word");const r=new Uint32Array(i,0,Ul/Uint32Array.BYTES_PER_ELEMENT),n=r[Hl.HEIGHT],s=r[Hl.WIDTH],a=r[Hl.MIPMAP_COUNT],h=new Uint32Array(i,Hl.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,U2/Uint32Array.BYTES_PER_ELEMENT),u=h[W2];if(u&V2){const d=h[G2.FOURCC];if(d!==Z2){const E=J2[d],k=vd+Ul,G=new Uint8Array(i,k);return[new ca(G,{format:E,width:s,height:n,levels:a})]}const m=vd+Ul,l=new Uint32Array(t.buffer,m,Mg/Uint32Array.BYTES_PER_ELEMENT),f=l[Gl.DXGI_FORMAT],p=l[Gl.RESOURCE_DIMENSION],y=l[Gl.MISC_FLAG],_=l[Gl.ARRAY_SIZE],v=tI[f];if(v===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${f}`);if(y===Q2)throw new Error("DDSParser does not support cubemap textures");if(p===6)throw new Error("DDSParser does not supported 3D texture data");const w=new Array,C=vd+Ul+Mg;if(_===1)w.push(new Uint8Array(i,C));else{const E=_c[v];let k=0,G=s,Q=n;for(let it=0;it<a;it++){const J=Math.max(1,G+3&-4),st=Math.max(1,Q+3&-4),gt=J*st*E;k+=gt,G=G>>>1,Q=Q>>>1}let Y=C;for(let it=0;it<_;it++)w.push(new Uint8Array(i,Y,k)),Y+=k}return w.map(E=>new ca(E,{format:v,width:s,height:n,levels:a}))}throw u&j2?new Error("DDSParser does not support uncompressed texture data."):u&X2?new Error("DDSParser does not supported YUV uncompressed texture data."):u&Y2?new Error("DDSParser does not support single-channel (lumninance) texture data!"):u&z2?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Ig=[171,75,84,88,32,49,49,187,13,10,26,10],iI=67305985,Qr={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},rf=64,Bg={[ue.UNSIGNED_BYTE]:1,[ue.UNSIGNED_SHORT]:2,[ue.INT]:4,[ue.UNSIGNED_INT]:4,[ue.FLOAT]:4,[ue.HALF_FLOAT]:8},rI={[Yt.RGBA]:4,[Yt.RGB]:3,[Yt.RG]:2,[Yt.RED]:1,[Yt.LUMINANCE]:1,[Yt.LUMINANCE_ALPHA]:2,[Yt.ALPHA]:1},nI={[ue.UNSIGNED_SHORT_4_4_4_4]:2,[ue.UNSIGNED_SHORT_5_5_5_1]:2,[ue.UNSIGNED_SHORT_5_6_5]:2};function sI(i,t,e=!1){const r=new DataView(t);if(!aI(i,r))return null;const n=r.getUint32(Qr.ENDIANNESS,!0)===iI,s=r.getUint32(Qr.GL_TYPE,n),a=r.getUint32(Qr.GL_FORMAT,n),h=r.getUint32(Qr.GL_INTERNAL_FORMAT,n),u=r.getUint32(Qr.PIXEL_WIDTH,n),d=r.getUint32(Qr.PIXEL_HEIGHT,n)||1,m=r.getUint32(Qr.PIXEL_DEPTH,n)||1,l=r.getUint32(Qr.NUMBER_OF_ARRAY_ELEMENTS,n)||1,f=r.getUint32(Qr.NUMBER_OF_FACES,n),p=r.getUint32(Qr.NUMBER_OF_MIPMAP_LEVELS,n),y=r.getUint32(Qr.BYTES_OF_KEY_VALUE_DATA,n);if(d===0||m!==1)throw new Error("Only 2D textures are supported");if(f!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(l!==1)throw new Error("WebGL does not support array textures");const _=4,v=4,w=u+3&-4,C=d+3&-4,E=new Array(l);let k=u*d;s===0&&(k=w*C);let G;if(s!==0?Bg[s]?G=Bg[s]*rI[a]:G=nI[s]:G=_c[h],G===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const Q=e?hI(r,y,n):null;let it=k*G,J=u,st=d,gt=w,j=C,Z=rf+y;for(let T=0;T<p;T++){const ut=r.getUint32(Z,n);let Pt=Z+4;for(let pt=0;pt<l;pt++){let Gt=E[pt];Gt||(Gt=E[pt]=new Array(p)),Gt[T]={levelID:T,levelWidth:p>1||s!==0?J:gt,levelHeight:p>1||s!==0?st:j,levelBuffer:new Uint8Array(t,Pt,it)},Pt+=it}Z+=ut+4,Z=Z%4!==0?Z+4-Z%4:Z,J=J>>1||1,st=st>>1||1,gt=J+_-1&~(_-1),j=st+v-1&~(v-1),it=gt*j*G}return s!==0?{uncompressed:E.map(T=>{let ut=T[0].levelBuffer,Pt=!1;return s===ue.FLOAT?ut=new Float32Array(T[0].levelBuffer.buffer,T[0].levelBuffer.byteOffset,T[0].levelBuffer.byteLength/4):s===ue.UNSIGNED_INT?(Pt=!0,ut=new Uint32Array(T[0].levelBuffer.buffer,T[0].levelBuffer.byteOffset,T[0].levelBuffer.byteLength/4)):s===ue.INT&&(Pt=!0,ut=new Int32Array(T[0].levelBuffer.buffer,T[0].levelBuffer.byteOffset,T[0].levelBuffer.byteLength/4)),{resource:new Rh(ut,{width:T[0].levelWidth,height:T[0].levelHeight}),type:s,format:Pt?oI(a):a}}),kvData:Q}:{compressed:E.map(T=>new ca(null,{format:h,width:u,height:d,levels:p,levelBuffers:T})),kvData:Q}}function aI(i,t){for(let e=0;e<Ig.length;e++)if(t.getUint8(e)!==Ig[e])return!1;return!0}function oI(i){switch(i){case Yt.RGBA:return Yt.RGBA_INTEGER;case Yt.RGB:return Yt.RGB_INTEGER;case Yt.RG:return Yt.RG_INTEGER;case Yt.RED:return Yt.RED_INTEGER;default:return i}}function hI(i,t,e){const r=new Map;let n=0;for(;n<t;){const s=i.getUint32(rf+n,e),a=rf+n+4,h=3-(s+3)%4;if(s===0||s>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let u=0;for(;u<s&&i.getUint8(a+u)!==0;u++);if(u===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const d=new TextDecoder().decode(new Uint8Array(i.buffer,a,u)),m=new DataView(i.buffer,a+u+1,s-u-1);r.set(d,m),n+=4+s+h}return r}const lI={extension:{type:Jt.LoadParser,priority:Sn.High},test(i){return bf(i,".dds")},async load(i,t,e){const n=await(await jt.ADAPTER.fetch(i)).arrayBuffer(),a=eI(n).map(h=>{const u=new Le(h,{mipmap:En.OFF,alphaMode:hn.NO_PREMULTIPLIED_ALPHA,resolution:Bs(i),...t.data});return Oc(u,e,i)});return a.length===1?a[0]:a},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};he.add(lI);const cI={extension:{type:Jt.LoadParser,priority:Sn.High},test(i){return bf(i,".ktx")},async load(i,t,e){const n=await(await jt.ADAPTER.fetch(i)).arrayBuffer(),{compressed:s,uncompressed:a,kvData:h}=sI(i,n),u=s??a,d={mipmap:En.OFF,alphaMode:hn.NO_PREMULTIPLIED_ALPHA,resolution:Bs(i),...t.data},m=u.map(l=>{u===a&&Object.assign(d,{type:l.type,format:l.format});const f=new Le(l,d);return f.ktxKeyValueData=h,Oc(f,e,i)});return m.length===1?m[0]:m},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};he.add(cI);const uI={extension:Jt.ResolveParser,test:i=>{const e=i.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:i=>{if(i.split("?")[0].split(".").pop()==="ktx"){const r=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(r.some(n=>i.endsWith(n)))return{resolution:parseFloat(jt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:r.find(n=>i.endsWith(n)),src:i}}return{resolution:parseFloat(jt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:i.split(".").pop(),src:i}}};he.add(uI);const Rg=new Te,kg=4,nf=class{constructor(i){this.renderer=i}async image(i,t,e){const r=new Image;return r.src=await this.base64(i,t,e),r}async base64(i,t,e){const r=this.canvas(i);if(r.toDataURL!==void 0)return r.toDataURL(t,e);if(r.convertToBlob!==void 0){const n=await r.convertToBlob({type:t,quality:e});return await new Promise(s=>{const a=new FileReader;a.onload=()=>s(a.result),a.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(i,t){const e=this.renderer;let r,n=!1,s,a=!1;i&&(i instanceof Ui?s=i:(s=this.renderer.generateTexture(i),a=!0)),s?(r=s.baseTexture.resolution,t=t??s.frame,n=!1,e.renderTexture.bind(s)):(r=e.resolution,t||(t=Rg,t.width=e.width,t.height=e.height),n=!0,e.renderTexture.bind(null));const h=Math.round(t.width*r),u=Math.round(t.height*r);let d=new lg(h,u,1);const m=new Uint8Array(kg*h*u),l=e.gl;l.readPixels(Math.round(t.x*r),Math.round(t.y*r),h,u,l.RGBA,l.UNSIGNED_BYTE,m);const f=d.context.getImageData(0,0,h,u);if(nf.arrayPostDivide(m,f.data),d.context.putImageData(f,0,0),n){const p=new lg(d.width,d.height,1);p.context.scale(1,-1),p.context.drawImage(d.canvas,0,-u),d.destroy(),d=p}return a&&s.destroy(!0),d.canvas}pixels(i,t){const e=this.renderer;let r,n,s=!1;i&&(i instanceof Ui?n=i:(n=this.renderer.generateTexture(i),s=!0)),n?(r=n.baseTexture.resolution,t=t??n.frame,e.renderTexture.bind(n)):(r=e.resolution,t||(t=Rg,t.width=e.width,t.height=e.height),e.renderTexture.bind(null));const a=Math.round(t.width*r),h=Math.round(t.height*r),u=new Uint8Array(kg*a*h),d=e.gl;return d.readPixels(Math.round(t.x*r),Math.round(t.y*r),a,h,d.RGBA,d.UNSIGNED_BYTE,u),s&&n.destroy(!0),nf.arrayPostDivide(u,u),u}destroy(){this.renderer=null}static arrayPostDivide(i,t){for(let e=0;e<i.length;e+=4){const r=t[e+3]=i[e+3];r!==0?(t[e]=Math.round(Math.min(i[e]*255/r,255)),t[e+1]=Math.round(Math.min(i[e+1]*255/r,255)),t[e+2]=Math.round(Math.min(i[e+2]*255/r,255))):(t[e]=i[e],t[e+1]=i[e+1],t[e+2]=i[e+2])}}};let Ey=nf;Ey.extension={name:"extract",type:Jt.RendererSystem};he.add(Ey);var Es=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(Es||{}),la=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(la||{});const Ih={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class Nc{constructor(){this.color=16777215,this.alpha=1,this.texture=Ut.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Nc;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Ut.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}function Pg(i,t=!1){const e=i.length;if(e<6)return;let r=0;for(let n=0,s=i[e-2],a=i[e-1];n<e;n+=2){const h=i[n],u=i[n+1];r+=(h-s)*(u+a),s=h,a=u}if(!t&&r>0||t&&r<=0){const n=e/2;for(let s=n+n%2;s<e;s+=2){const a=e-s-2,h=e-s-1,u=s,d=s+1;[i[a],i[u]]=[i[u],i[a]],[i[h],i[d]]=[i[d],i[h]]}}}const Ty={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points;const r=i.holes,n=t.points,s=t.indices;if(e.length>=6){Pg(e,!1);const a=[];for(let d=0;d<r.length;d++){const m=r[d];Pg(m.points,!0),a.push(e.length/2),e=e.concat(m.points)}const h=gf.exports(e,a,2);if(!h)return;const u=n.length/2;for(let d=0;d<h.length;d+=3)s.push(h[d]+u),s.push(h[d+1]+u),s.push(h[d+2]+u);for(let d=0;d<e.length;d++)n.push(e[d])}}},vc={build(i){const t=i.points;let e,r,n,s,a,h;if(i.type===Yi.CIRC){const y=i.shape;e=y.x,r=y.y,a=h=y.radius,n=s=0}else if(i.type===Yi.ELIP){const y=i.shape;e=y.x,r=y.y,a=y.width,h=y.height,n=s=0}else{const y=i.shape,_=y.width/2,v=y.height/2;e=y.x+_,r=y.y+v,a=h=Math.max(0,Math.min(y.radius,Math.min(_,v))),n=_-a,s=v-h}if(!(a>=0&&h>=0&&n>=0&&s>=0)){t.length=0;return}const u=Math.ceil(2.3*Math.sqrt(a+h)),d=u*8+(n?4:0)+(s?4:0);if(t.length=d,d===0)return;if(u===0){t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=r+s,t[2]=t[4]=e-n,t[5]=t[7]=r-s;return}let m=0,l=u*4+(n?2:0)+2,f=l,p=d;{const y=n+a,_=s,v=e+y,w=e-y,C=r+_;if(t[m++]=v,t[m++]=C,t[--l]=C,t[--l]=w,s){const E=r-_;t[f++]=w,t[f++]=E,t[--p]=E,t[--p]=v}}for(let y=1;y<u;y++){const _=Math.PI/2*(y/u),v=n+Math.cos(_)*a,w=s+Math.sin(_)*h,C=e+v,E=e-v,k=r+w,G=r-w;t[m++]=C,t[m++]=k,t[--l]=k,t[--l]=E,t[f++]=E,t[f++]=G,t[--p]=G,t[--p]=C}{const y=n,_=s+h,v=e+y,w=e-y,C=r+_,E=r-_;t[m++]=v,t[m++]=C,t[--p]=E,t[--p]=v,n&&(t[m++]=w,t[m++]=C,t[--p]=E,t[--p]=w)}},triangulate(i,t){const e=i.points,r=t.points,n=t.indices;if(e.length===0)return;let s=r.length/2;const a=s;let h,u;if(i.type!==Yi.RREC){const m=i.shape;h=m.x,u=m.y}else{const m=i.shape;h=m.x+m.width/2,u=m.y+m.height/2}const d=i.matrix;r.push(i.matrix?d.a*h+d.c*u+d.tx:h,i.matrix?d.b*h+d.d*u+d.ty:u),s++,r.push(e[0],e[1]);for(let m=2;m<e.length;m+=2)r.push(e[m],e[m+1]),n.push(s++,a,s);n.push(a+1,a,s)}},dI={build(i){const t=i.shape,e=t.x,r=t.y,n=t.width,s=t.height,a=i.points;a.length=0,n>=0&&s>=0&&a.push(e,r,e+n,r,e+n,r+s,e,r+s)},triangulate(i,t){const e=i.points,r=t.points;if(e.length===0)return;const n=r.length/2;r.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},fI={build(i){vc.build(i)},triangulate(i,t){vc.triangulate(i,t)}};function Dg(i,t,e,r,n,s,a,h){const u=i-e*n,d=t-r*n,m=i+e*s,l=t+r*s;let f,p;a?(f=r,p=-e):(f=-r,p=e);const y=u+f,_=d+p,v=m+f,w=l+p;return h.push(y,_),h.push(v,w),2}function Qs(i,t,e,r,n,s,a,h){const u=e-i,d=r-t;let m=Math.atan2(u,d),l=Math.atan2(n-i,s-t);h&&m<l?m+=Math.PI*2:!h&&m>l&&(l+=Math.PI*2);let f=m;const p=l-m,y=Math.abs(p),_=Math.sqrt(u*u+d*d),v=(15*y*Math.sqrt(_)/Math.PI>>0)+1,w=p/v;if(f+=w,h){a.push(i,t),a.push(e,r);for(let C=1,E=f;C<v;C++,E+=w)a.push(i,t),a.push(i+Math.sin(E)*_,t+Math.cos(E)*_);a.push(i,t),a.push(n,s)}else{a.push(e,r),a.push(i,t);for(let C=1,E=f;C<v;C++,E+=w)a.push(i+Math.sin(E)*_,t+Math.cos(E)*_),a.push(i,t);a.push(n,s),a.push(i,t)}return v*2}function pI(i,t){const e=i.shape;let r=i.points||e.points.slice();const n=t.closePointEps;if(r.length===0)return;const s=i.lineStyle,a=new Ue(r[0],r[1]),h=new Ue(r[r.length-2],r[r.length-1]),u=e.type!==Yi.POLY||e.closeStroke,d=Math.abs(a.x-h.x)<n&&Math.abs(a.y-h.y)<n;if(u){r=r.slice(),d&&(r.pop(),r.pop(),h.set(r[r.length-2],r[r.length-1]));const pt=(a.x+h.x)*.5,Gt=(h.y+a.y)*.5;r.unshift(pt,Gt),r.push(pt,Gt)}const m=t.points,l=r.length/2;let f=r.length;const p=m.length/2,y=s.width/2,_=y*y,v=s.miterLimit*s.miterLimit;let w=r[0],C=r[1],E=r[2],k=r[3],G=0,Q=0,Y=-(C-k),it=w-E,J=0,st=0,gt=Math.sqrt(Y*Y+it*it);Y/=gt,it/=gt,Y*=y,it*=y;const j=s.alignment,Z=(1-j)*2,T=j*2;u||(s.cap===la.ROUND?f+=Qs(w-Y*(Z-T)*.5,C-it*(Z-T)*.5,w-Y*Z,C-it*Z,w+Y*T,C+it*T,m,!0)+2:s.cap===la.SQUARE&&(f+=Dg(w,C,Y,it,Z,T,!0,m))),m.push(w-Y*Z,C-it*Z),m.push(w+Y*T,C+it*T);for(let pt=1;pt<l-1;++pt){w=r[(pt-1)*2],C=r[(pt-1)*2+1],E=r[pt*2],k=r[pt*2+1],G=r[(pt+1)*2],Q=r[(pt+1)*2+1],Y=-(C-k),it=w-E,gt=Math.sqrt(Y*Y+it*it),Y/=gt,it/=gt,Y*=y,it*=y,J=-(k-Q),st=E-G,gt=Math.sqrt(J*J+st*st),J/=gt,st/=gt,J*=y,st*=y;const Gt=E-w,bt=C-k,xt=E-G,tt=Q-k,et=Gt*xt+bt*tt,Ht=bt*xt-tt*Gt,Dt=Ht<0;if(Math.abs(Ht)<.001*Math.abs(et)){m.push(E-Y*Z,k-it*Z),m.push(E+Y*T,k+it*T),et>=0&&(s.join===Es.ROUND?f+=Qs(E,k,E-Y*Z,k-it*Z,E-J*Z,k-st*Z,m,!1)+4:f+=2,m.push(E-J*T,k-st*T),m.push(E+J*Z,k+st*Z));continue}const Mt=(-Y+w)*(-it+k)-(-Y+E)*(-it+C),te=(-J+G)*(-st+k)-(-J+E)*(-st+Q),re=(Gt*te-xt*Mt)/Ht,Xt=(tt*Mt-bt*te)/Ht,qt=(re-E)*(re-E)+(Xt-k)*(Xt-k),le=E+(re-E)*Z,ne=k+(Xt-k)*Z,ye=E-(re-E)*T,fe=k-(Xt-k)*T,S=Math.min(Gt*Gt+bt*bt,xt*xt+tt*tt),At=Dt?Z:T,_t=S+At*At*_;qt<=_t?s.join===Es.BEVEL||qt/_>v?(Dt?(m.push(le,ne),m.push(E+Y*T,k+it*T),m.push(le,ne),m.push(E+J*T,k+st*T)):(m.push(E-Y*Z,k-it*Z),m.push(ye,fe),m.push(E-J*Z,k-st*Z),m.push(ye,fe)),f+=2):s.join===Es.ROUND?Dt?(m.push(le,ne),m.push(E+Y*T,k+it*T),f+=Qs(E,k,E+Y*T,k+it*T,E+J*T,k+st*T,m,!0)+4,m.push(le,ne),m.push(E+J*T,k+st*T)):(m.push(E-Y*Z,k-it*Z),m.push(ye,fe),f+=Qs(E,k,E-Y*Z,k-it*Z,E-J*Z,k-st*Z,m,!1)+4,m.push(E-J*Z,k-st*Z),m.push(ye,fe)):(m.push(le,ne),m.push(ye,fe)):(m.push(E-Y*Z,k-it*Z),m.push(E+Y*T,k+it*T),s.join===Es.ROUND?Dt?f+=Qs(E,k,E+Y*T,k+it*T,E+J*T,k+st*T,m,!0)+2:f+=Qs(E,k,E-Y*Z,k-it*Z,E-J*Z,k-st*Z,m,!1)+2:s.join===Es.MITER&&qt/_<=v&&(Dt?(m.push(ye,fe),m.push(ye,fe)):(m.push(le,ne),m.push(le,ne)),f+=2),m.push(E-J*Z,k-st*Z),m.push(E+J*T,k+st*T),f+=2)}w=r[(l-2)*2],C=r[(l-2)*2+1],E=r[(l-1)*2],k=r[(l-1)*2+1],Y=-(C-k),it=w-E,gt=Math.sqrt(Y*Y+it*it),Y/=gt,it/=gt,Y*=y,it*=y,m.push(E-Y*Z,k-it*Z),m.push(E+Y*T,k+it*T),u||(s.cap===la.ROUND?f+=Qs(E-Y*(Z-T)*.5,k-it*(Z-T)*.5,E-Y*Z,k-it*Z,E+Y*T,k+it*T,m,!1)+2:s.cap===la.SQUARE&&(f+=Dg(E,k,Y,it,Z,T,!1,m)));const ut=t.indices,Pt=Ih.epsilon*Ih.epsilon;for(let pt=p;pt<f+p-2;++pt)w=m[pt*2],C=m[pt*2+1],E=m[(pt+1)*2],k=m[(pt+1)*2+1],G=m[(pt+2)*2],Q=m[(pt+2)*2+1],!(Math.abs(w*(k-Q)+E*(Q-C)+G*(C-k))<Pt)&&ut.push(pt,pt+1,pt+2)}function mI(i,t){let e=0;const r=i.shape,n=i.points||r.points,s=r.type!==Yi.POLY||r.closeStroke;if(n.length===0)return;const a=t.points,h=t.indices,u=n.length/2,d=a.length/2;let m=d;for(a.push(n[0],n[1]),e=1;e<u;e++)a.push(n[e*2],n[e*2+1]),h.push(m,m+1),m++;s&&h.push(m,d)}function Lg(i,t){i.lineStyle.native?mI(i,t):pI(i,t)}class Fg{static curveTo(t,e,r,n,s,a){const h=a[a.length-2],d=a[a.length-1]-e,m=h-t,l=n-e,f=r-t,p=Math.abs(d*f-m*l);if(p<1e-8||s===0)return(a[a.length-2]!==t||a[a.length-1]!==e)&&a.push(t,e),null;const y=d*d+m*m,_=l*l+f*f,v=d*l+m*f,w=s*Math.sqrt(y)/p,C=s*Math.sqrt(_)/p,E=w*v/y,k=C*v/_,G=w*f+C*m,Q=w*l+C*d,Y=m*(C+E),it=d*(C+E),J=f*(w+k),st=l*(w+k),gt=Math.atan2(it-Q,Y-G),j=Math.atan2(st-Q,J-G);return{cx:G+t,cy:Q+e,radius:s,startAngle:gt,endAngle:j,anticlockwise:m*l>f*d}}static arc(t,e,r,n,s,a,h,u,d){const m=h-a,l=Ih._segmentsCount(Math.abs(m)*s,Math.ceil(Math.abs(m)/dc)*40),f=m/(l*2),p=f*2,y=Math.cos(f),_=Math.sin(f),v=l-1,w=v%1/v;for(let C=0;C<=v;++C){const E=C+w*C,k=f+a+p*E,G=Math.cos(k),Q=-Math.sin(k);d.push((y*G+_*Q)*s+r,(y*-Q+_*G)*s+n)}}}class Af{static curveLength(t,e,r,n,s,a,h,u){let m=0,l=0,f=0,p=0,y=0,_=0,v=0,w=0,C=0,E=0,k=0,G=t,Q=e;for(let Y=1;Y<=10;++Y)l=Y/10,f=l*l,p=f*l,y=1-l,_=y*y,v=_*y,w=v*t+3*_*l*r+3*y*f*s+p*h,C=v*e+3*_*l*n+3*y*f*a+p*u,E=G-w,k=Q-C,G=w,Q=C,m+=Math.sqrt(E*E+k*k);return m}static curveTo(t,e,r,n,s,a,h){const u=h[h.length-2],d=h[h.length-1];h.length-=2;const m=Ih._segmentsCount(Af.curveLength(u,d,t,e,r,n,s,a));let l=0,f=0,p=0,y=0,_=0;h.push(u,d);for(let v=1,w=0;v<=m;++v)w=v/m,l=1-w,f=l*l,p=f*l,y=w*w,_=y*w,h.push(p*u+3*f*w*t+3*l*y*r+_*s,p*d+3*f*w*e+3*l*y*n+_*a)}}class Ef{static curveLength(t,e,r,n,s,a){const h=t-2*r+s,u=e-2*n+a,d=2*r-2*t,m=2*n-2*e,l=4*(h*h+u*u),f=4*(h*d+u*m),p=d*d+m*m,y=2*Math.sqrt(l+f+p),_=Math.sqrt(l),v=2*l*_,w=2*Math.sqrt(p),C=f/_;return(v*y+_*f*(y-w)+(4*p*l-f*f)*Math.log((2*_+C+y)/(C+w)))/(4*v)}static curveTo(t,e,r,n,s){const a=s[s.length-2],h=s[s.length-1],u=Ih._segmentsCount(Ef.curveLength(a,h,t,e,r,n));let d=0,m=0;for(let l=1;l<=u;++l){const f=l/u;d=a+(t-a)*f,m=h+(e-h)*f,s.push(d+(t+(r-t)*f-d)*f,m+(e+(n-e)*f-m)*f)}}}class gI{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const wd={[Yi.POLY]:Ty,[Yi.CIRC]:vc,[Yi.ELIP]:vc,[Yi.RECT]:dI,[Yi.RREC]:fI},Og=[],Wl=[];class wc{constructor(t,e=null,r=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new wc(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Qa=new Ue,Sy=class extends py{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new mc,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),Wl.push(this.drawCalls[i]);this.drawCalls.length=0;for(let i=0;i<this.batches.length;i++){const t=this.batches[i];t.reset(),Og.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(i,t=null,e=null,r=null){const n=new wc(i,t,e,r);return this.graphicsData.push(n),this.dirty++,this}drawHole(i,t=null){if(!this.graphicsData.length)return null;const e=new wc(i,null,null,t),r=this.graphicsData[this.graphicsData.length-1];return e.lineStyle=r.lineStyle,r.holes.push(e),this.dirty++,this}destroy(){super.destroy();for(let i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(i){const t=this.graphicsData;for(let e=0;e<t.length;++e){const r=t[e];if(!!r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(i,Qa):Qa.copyFrom(i),r.shape.contains(Qa.x,Qa.y))){let n=!1;if(r.holes){for(let s=0;s<r.holes.length;s++)if(r.holes[s].shape.contains(Qa.x,Qa.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const i=this.uvs,t=this.graphicsData;let e=null,r=null;this.batches.length>0&&(e=this.batches[this.batches.length-1],r=e.style);for(let h=this.shapeIndex;h<t.length;h++){this.shapeIndex++;const u=t[h],d=u.fillStyle,m=u.lineStyle;wd[u.type].build(u),u.matrix&&this.transformPoints(u.points,u.matrix),(d.visible||m.visible)&&this.processHoles(u.holes);for(let f=0;f<2;f++){const p=f===0?d:m;if(!p.visible)continue;const y=p.texture.baseTexture,_=this.indices.length,v=this.points.length/2;y.wrapMode=Ms.REPEAT,f===0?this.processFill(u):this.processLine(u);const w=this.points.length/2-v;w!==0&&(e&&!this._compareStyles(r,p)&&(e.end(_,v),e=null),e||(e=Og.pop()||new gI,e.begin(p,_,v),this.batches.push(e),r=p),this.addUvs(this.points,i,p.texture,v,w,p.matrix))}}const n=this.indices.length,s=this.points.length/2;if(e&&e.end(n,s),this.batches.length===0){this.batchable=!0;return}const a=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(i,t){return!(!i||!t||i.texture.baseTexture!==t.texture.baseTexture||i.color+i.alpha!==t.color+t.alpha||!!i.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let i=0,t=this.graphicsData.length;i<t;i++){const e=this.graphicsData[i],r=e.fillStyle,n=e.lineStyle;if(r&&!r.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const i=this.batches;for(let t=0,e=i.length;t<e;t++){const r=i[t];for(let n=0;n<r.size;n++){const s=r.start+n;this.indicesUint16[s]=this.indicesUint16[s]-r.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const i=this.batches;for(let t=0;t<i.length;t++)if(i[t].style.native)return!1;return this.points.length<Sy.BATCHABLE_SIZE*2}buildDrawCalls(){let i=++Le._globalBatch;for(let m=0;m<this.drawCalls.length;m++)this.drawCalls[m].texArray.clear(),Wl.push(this.drawCalls[m]);this.drawCalls.length=0;const t=this.colors,e=this.textureIds;let r=Wl.pop();r||(r=new Zd,r.texArray=new Qd),r.texArray.count=0,r.start=0,r.size=0,r.type=wn.TRIANGLES;let n=0,s=null,a=0,h=!1,u=wn.TRIANGLES,d=0;this.drawCalls.push(r);for(let m=0;m<this.batches.length;m++){const l=this.batches[m],f=8,p=l.style,y=p.texture.baseTexture;h!==!!p.native&&(h=!!p.native,u=h?wn.LINES:wn.TRIANGLES,s=null,n=f,i++),s!==y&&(s=y,y._batchEnabled!==i&&(n===f&&(i++,n=0,r.size>0&&(r=Wl.pop(),r||(r=new Zd,r.texArray=new Qd),this.drawCalls.push(r)),r.start=d,r.size=0,r.texArray.count=0,r.type=u),y.touched=1,y._batchEnabled=i,y._batchLocation=n,y.wrapMode=Ms.REPEAT,r.texArray.elements[r.texArray.count++]=y,n++)),r.size+=l.size,d+=l.size,a=y._batchLocation,this.addColors(t,p.color,p.alpha,l.attribSize,l.attribStart),this.addTextureIds(e,a,l.attribSize,l.attribStart)}Le._globalBatch=i,this.packAttributes()}packAttributes(){const i=this.points,t=this.uvs,e=this.colors,r=this.textureIds,n=new ArrayBuffer(i.length*3*4),s=new Float32Array(n),a=new Uint32Array(n);let h=0;for(let u=0;u<i.length/2;u++)s[h++]=i[u*2],s[h++]=i[u*2+1],s[h++]=t[u*2],s[h++]=t[u*2+1],a[h++]=e[u],s[h++]=r[u];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(i){i.holes.length?Ty.triangulate(i,this):wd[i.type].triangulate(i,this)}processLine(i){Lg(i,this);for(let t=0;t<i.holes.length;t++)Lg(i.holes[t],this)}processHoles(i){for(let t=0;t<i.length;t++){const e=i[t];wd[e.type].build(e),e.matrix&&this.transformPoints(e.points,e.matrix)}}calculateBounds(){const i=this._bounds;i.clear(),i.addVertexData(this.points,0,this.points.length),i.pad(this.boundsPadding,this.boundsPadding)}transformPoints(i,t){for(let e=0;e<i.length/2;e++){const r=i[e*2],n=i[e*2+1];i[e*2]=t.a*r+t.c*n+t.tx,i[e*2+1]=t.b*r+t.d*n+t.ty}}addColors(i,t,e,r,n=0){const s=(t>>16)+(t&65280)+((t&255)<<16),a=_f(s,e);i.length=Math.max(i.length,n+r);for(let h=0;h<r;h++)i[n+h]=a}addTextureIds(i,t,e,r=0){i.length=Math.max(i.length,r+e);for(let n=0;n<e;n++)i[r+n]=t}addUvs(i,t,e,r,n,s=null){let a=0;const h=t.length,u=e.frame;for(;a<n;){let m=i[(r+a)*2],l=i[(r+a)*2+1];if(s){const f=s.a*m+s.c*l+s.tx;l=s.b*m+s.d*l+s.ty,m=f}a++,t.push(m/u.width,l/u.height)}const d=e.baseTexture;(u.width<d.width||u.height<d.height)&&this.adjustUvs(t,e,h,n)}adjustUvs(i,t,e,r){const n=t.baseTexture,s=1e-6,a=e+r*2,h=t.frame,u=h.width/n.width,d=h.height/n.height;let m=h.x/h.width,l=h.y/h.height,f=Math.floor(i[e]+s),p=Math.floor(i[e+1]+s);for(let y=e+2;y<a;y+=2)f=Math.min(f,Math.floor(i[y]+s)),p=Math.min(p,Math.floor(i[y+1]+s));m-=f,l-=p;for(let y=e;y<a;y+=2)i[y]=(i[y]+m)*u,i[y+1]=(i[y+1]+l)*d}};let Cy=Sy;Cy.BATCHABLE_SIZE=100;class Tf extends Nc{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=la.BUTT,this.join=Es.MITER,this.miterLimit=10}clone(){const t=new Tf;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const yI=new Float32Array(3),bd={},oc=class extends we{constructor(i=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Nc,this._lineStyle=new Tf,this._matrix=null,this._holeMode=!1,this.state=rs.for2d(),this._geometry=i||new Cy,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=ce.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new oc(this._geometry)}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(i){this._tint=i}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(i=null,t=0,e=1,r=.5,n=!1){return typeof i=="number"&&(i={width:i,color:t,alpha:e,alignment:r,native:n}),this.lineTextureStyle(i)}lineTextureStyle(i){i=Object.assign({width:0,texture:Ut.WHITE,color:i?.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:la.BUTT,join:Es.MITER,miterLimit:10},i),this.currentPath&&this.startPoly();const t=i.width>0&&i.alpha>0;return t?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._lineStyle,{visible:t},i)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const i=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new po,this.currentPath.closeStroke=!1,this.currentPath.points.push(i[t-2],i[t-1]))}else this.currentPath=new po,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(i,t){return this.startPoly(),this.currentPath.points[0]=i,this.currentPath.points[1]=t,this}lineTo(i,t){this.currentPath||this.moveTo(0,0);const e=this.currentPath.points,r=e[e.length-2],n=e[e.length-1];return(r!==i||n!==t)&&e.push(i,t),this}_initCurve(i=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[i,t]):this.moveTo(i,t)}quadraticCurveTo(i,t,e,r){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),Ef.curveTo(i,t,e,r,n),this}bezierCurveTo(i,t,e,r,n,s){return this._initCurve(),Af.curveTo(i,t,e,r,n,s,this.currentPath.points),this}arcTo(i,t,e,r,n){this._initCurve(i,t);const s=this.currentPath.points,a=Fg.curveTo(i,t,e,r,n,s);if(a){const{cx:h,cy:u,radius:d,startAngle:m,endAngle:l,anticlockwise:f}=a;this.arc(h,u,d,m,l,f)}return this}arc(i,t,e,r,n,s=!1){if(r===n)return this;if(!s&&n<=r?n+=dc:s&&r<=n&&(r+=dc),n-r===0)return this;const h=i+Math.cos(r)*e,u=t+Math.sin(r)*e,d=this._geometry.closePointEps;let m=this.currentPath?this.currentPath.points:null;if(m){const l=Math.abs(m[m.length-2]-h),f=Math.abs(m[m.length-1]-u);l<d&&f<d||m.push(h,u)}else this.moveTo(h,u),m=this.currentPath.points;return Fg.arc(h,u,i,t,e,r,n,s,m),this}beginFill(i=0,t=1){return this.beginTextureFill({texture:Ut.WHITE,color:i,alpha:t})}beginTextureFill(i){i=Object.assign({texture:Ut.WHITE,color:16777215,alpha:1,matrix:null},i),this.currentPath&&this.startPoly();const t=i.alpha>0;return t?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._fillStyle,{visible:t},i)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(i,t,e,r){return this.drawShape(new Te(i,t,e,r))}drawRoundedRect(i,t,e,r,n){return this.drawShape(new mf(i,t,e,r,n))}drawCircle(i,t,e){return this.drawShape(new ff(i,t,e))}drawEllipse(i,t,e,r){return this.drawShape(new pf(i,t,e,r))}drawPolygon(...i){let t,e=!0;const r=i[0];r.points?(e=r.closeStroke,t=r.points):Array.isArray(i[0])?t=i[0]:t=i;const n=new po(t);return n.closeStroke=e,this.drawShape(n),this}drawShape(i){return this._holeMode?this._geometry.drawHole(i,this._matrix):this._geometry.drawShape(i,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const i=this._geometry.graphicsData;return i.length===1&&i[0].shape.type===Yi.RECT&&!i[0].matrix&&!i[0].holes.length&&!(i[0].lineStyle.visible&&i[0].lineStyle.width)}_render(i){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(i)):(i.batch.flush(),this._renderDirect(i))}_populateBatches(){const i=this._geometry,t=this.blendMode,e=i.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=i.batchDirty,this.batches.length=e,this.vertexData=new Float32Array(i.points);for(let r=0;r<e;r++){const n=i.batches[r],s=n.style.color,a=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),h=new Float32Array(i.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),u=new Uint16Array(i.indicesUint16.buffer,n.start*2,n.size),d={vertexData:a,blendMode:t,indices:u,uvs:h,_batchRGB:vo(s),_tintRGB:s,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=d}}_renderBatched(i){if(!!this.batches.length){i.batch.setObjectRenderer(i.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,e=this.batches.length;t<e;t++){const r=this.batches[t];r.worldAlpha=this.worldAlpha*r.alpha,i.plugins[this.pluginName].render(r)}}}_renderDirect(i){const t=this._resolveDirectShader(i),e=this._geometry,r=this.tint,n=this.worldAlpha,s=t.uniforms,a=e.drawCalls;s.translationMatrix=this.transform.worldTransform,s.tint[0]=(r>>16&255)/255*n,s.tint[1]=(r>>8&255)/255*n,s.tint[2]=(r&255)/255*n,s.tint[3]=n,i.shader.bind(t),i.geometry.bind(e,t),i.state.set(this.state);for(let h=0,u=a.length;h<u;h++)this._renderDrawCallDirect(i,e.drawCalls[h])}_renderDrawCallDirect(i,t){const{texArray:e,type:r,size:n,start:s}=t,a=e.count;for(let h=0;h<a;h++)i.texture.bind(e.elements[h],h);i.geometry.draw(r,n,s)}_resolveDirectShader(i){let t=this.shader;const e=this.pluginName;if(!t){if(!bd[e]){const{MAX_TEXTURES:r}=i.plugins[e],n=new Int32Array(r);for(let h=0;h<r;h++)n[h]=h;const s={tint:new Float32Array([1,1,1,1]),translationMatrix:new yi,default:an.from({uSamplers:n},!0)},a=i.plugins[e]._shader.program;bd[e]=new Mr(a,s)}t=bd[e]}return t}_calculateBounds(){this.finishPoly();const i=this._geometry;if(!i.graphicsData.length)return;const{minX:t,minY:e,maxX:r,maxY:n}=i.bounds;this._bounds.addFrame(this.transform,t,e,r,n)}containsPoint(i){return this.worldTransform.applyInverse(i,oc._TEMP_POINT),this._geometry.containsPoint(oc._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const i=vo(this.tint,yI);for(let t=0;t<this.batches.length;t++){const e=this.batches[t],r=e._batchRGB,n=i[0]*r[0]*255,s=i[1]*r[1]*255,a=i[2]*r[2]*255,h=(n<<16)+(s<<8)+(a|0);e._tintRGB=(h>>16)+(h&65280)+((h&255)<<16)}}}calculateVertices(){const i=this.transform._worldID;if(this._transformID===i)return;this._transformID=i;const t=this.transform.worldTransform,e=t.a,r=t.b,n=t.c,s=t.d,a=t.tx,h=t.ty,u=this._geometry.points,d=this.vertexData;let m=0;for(let l=0;l<u.length;l+=2){const f=u[l],p=u[l+1];d[m++]=e*f+n*p+a,d[m++]=s*p+r*f+h}}closePath(){const i=this.currentPath;return i&&(i.closeStroke=!0,this.finishPoly()),this}setMatrix(i){return this._matrix=i,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(i){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(i)}};let Mo=oc;Mo._TEMP_POINT=new Ue;class _I{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const xd=new Ue,Ng=new po,My=class extends we{constructor(i,t,e,r=wn.TRIANGLES){super(),this.geometry=i,this.shader=t,this.state=e||rs.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=jt.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(i){this._geometry!==i&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=i,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(i){this.shader=i}get material(){return this.shader}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}set roundPixels(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(i){this.shader.tint=i}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(i){this.shader.texture=i}_render(i){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===wn.TRIANGLES&&t.length<My.BATCHABLE_SIZE*2?this._renderToBatch(i):this._renderDefault(i)}_renderDefault(i){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),i.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),i.shader.bind(t),i.state.set(this.state),i.geometry.bind(this.geometry,t),i.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(i){const t=this.geometry,e=this.shader;e.uvMatrix&&(e.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=e._tintRGB,this._texture=e.texture;const r=this.material.pluginName;i.batch.setObjectRenderer(i.plugins[r]),i.plugins[r].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,s=n.a,a=n.b,h=n.c,u=n.d,d=n.tx,m=n.ty,l=this.vertexData;for(let f=0;f<l.length/2;f++){const p=e[f*2],y=e[f*2+1];l[f*2]=s*p+h*y+d,l[f*2+1]=a*p+u*y+m}if(this._roundPixels){const f=jt.RESOLUTION;for(let p=0;p<l.length;++p)l[p]=Math.round(l[p]*f)/f}this.vertexDirty=r}calculateUvs(){const i=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=i.data:(this.batchUvs||(this.batchUvs=new _I(i,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(i){if(!this.getBounds().contains(i.x,i.y))return!1;this.worldTransform.applyInverse(i,xd);const t=this.geometry.getBuffer("aVertexPosition").data,e=Ng.points,r=this.geometry.getIndex().data,n=r.length,s=this.drawMode===4?3:1;for(let a=0;a+2<n;a+=s){const h=r[a]*2,u=r[a+1]*2,d=r[a+2]*2;if(e[0]=t[h],e[1]=t[h+1],e[2]=t[u],e[3]=t[u+1],e[4]=t[d],e[5]=t[d+1],Ng.contains(xd.x,xd.y))return!0}return!1}destroy(i){super.destroy(i),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let ua=My;ua.BATCHABLE_SIZE=100;var vI=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,wI=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class sf extends Mr{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:yi.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(r,e.uniforms),super(e.program||Zn.from(wI,vI),r),this._colorDirty=!1,this.uvMatrix=new wf(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this.tint=e.tint,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;R0(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Iy extends Tn{constructor(t,e,r){super();const n=new Ai(t),s=new Ai(e,!0),a=new Ai(r,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,ue.FLOAT).addAttribute("aTextureCoord",s,2,!1,ue.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class bI extends Iy{constructor(t=100,e=100,r=10,n=10){super(),this.segWidth=r,this.segHeight=n,this.width=t,this.height=e,this.build()}build(){const t=this.segWidth*this.segHeight,e=[],r=[],n=[],s=this.segWidth-1,a=this.segHeight-1,h=this.width/s,u=this.height/a;for(let m=0;m<t;m++){const l=m%this.segWidth,f=m/this.segWidth|0;e.push(l*h,f*u),r.push(l/s,f/a)}const d=s*a;for(let m=0;m<d;m++){const l=m%s,f=m/s|0,p=f*this.segWidth+l,y=f*this.segWidth+l+1,_=(f+1)*this.segWidth+l,v=(f+1)*this.segWidth+l+1;n.push(p,y,_,y,v,_)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint16Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class xI extends ua{constructor(t,e,r){const n=new bI(t.width,t.height,e,r),s=new sf(Ut.WHITE);super(n,s),this.texture=t,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const t=this.geometry,{width:e,height:r}=this.shader.texture;this.autoResize&&(t.width!==e||t.height!==r)&&(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())}set texture(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(t)}destroy(t){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(t)}}const zl=10;class AI extends xI{constructor(t,e=zl,r=zl,n=zl,s=zl){super(Ut.WHITE,4,4),this._origWidth=t.orig.width,this._origHeight=t.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=e,this._rightWidth=n,this._topHeight=r,this._bottomHeight=s,this.texture=t}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}updateHorizontalVertices(){const t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){const t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width}_getMinScale(){const t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,r=this._topHeight+this._bottomHeight,n=this._height>r?1:this._height/r;return Math.min(e,n)}get width(){return this._width}set width(t){this._width=t,this._refresh()}get height(){return this._height}set height(t){this._height=t,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this._refresh()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this._refresh()}_refresh(){const t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;const r=1/this._origWidth,n=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=r*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-r*this._rightWidth,e[9]=e[11]=e[13]=e[15]=n*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-n*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class By extends we{constructor(t=1500,e,r=16384,n=!1){super();const s=16384;r>s&&(r=s),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=r,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=ce.NORMAL,this.autoResize=n,this.roundPixels=!0,this.baseTexture=null,this.setProperties(e),this._tint=0,this.tintRgb=new Float32Array(4),this.tint=16777215}setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tint}set tint(t){this._tint=t,vo(t,this.tintRgb)}render(t){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){const e=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}class Ug{constructor(t,e,r){this.geometry=new Tn,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||ue.FLOAT,offset:s.offset},e[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Ai(HC(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const h=this.dynamicProperties[a];h.offset=e,e+=h.size,this.dynamicStride+=h.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Ai(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const h=this.staticProperties[a];h.offset=n,n+=h.size,this.staticStride+=h.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Ai(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const h=this.dynamicProperties[a];t.addAttribute(h.attributeName,this.dynamicBuffer,0,h.type===ue.UNSIGNED_BYTE,h.type,this.dynamicStride*4,h.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const h=this.staticProperties[a];t.addAttribute(h.attributeName,this.staticBuffer,0,h.type===ue.UNSIGNED_BYTE,h.type,this.staticStride*4,h.offset*4)}}uploadDynamic(t,e,r){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,e,r,s.type===ue.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,e,r,s.type===ue.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var EI=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,TI=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Ry extends Lc{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new yi,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:ue.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Mr.from(TI,EI,{}),this.state=rs.for2d()}render(t){const e=t.children,r=t._maxSize,n=t._batchSize,s=this.renderer;let a=e.length;if(a===0)return;a>r&&!t.autoResize&&(a=r);let h=t._buffers;h||(h=t._buffers=this.generateBuffers(t));const u=e[0]._texture.baseTexture,d=u.alphaMode>0;this.state.blendMode=B0(t.blendMode,d),s.state.set(this.state);const m=s.gl,l=t.worldTransform.copyTo(this.tempMatrix);l.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=l.toArray(!0),this.shader.uniforms.uColor=UC(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,d),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);let f=!1;for(let p=0,y=0;p<a;p+=n,y+=1){let _=a-p;_>n&&(_=n),y>=h.length&&h.push(this._generateOneMoreBuffer(t));const v=h[y];v.uploadDynamic(e,p,_);const w=t._bufferUpdateIDs[y]||0;f=f||v._updateID<w,f&&(v._updateID=t._updateID,v.uploadStatic(e,p,_)),s.geometry.bind(v.geometry),m.drawElements(m.TRIANGLES,_*6,m.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,n=t._batchSize,s=t._properties;for(let a=0;a<r;a+=n)e.push(new Ug(this.properties,s,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new Ug(this.properties,r,e)}uploadVertices(t,e,r,n,s,a){let h=0,u=0,d=0,m=0;for(let l=0;l<r;++l){const f=t[e+l],p=f._texture,y=f.scale.x,_=f.scale.y,v=p.trim,w=p.orig;v?(u=v.x-f.anchor.x*w.width,h=u+v.width,m=v.y-f.anchor.y*w.height,d=m+v.height):(h=w.width*(1-f.anchor.x),u=w.width*-f.anchor.x,d=w.height*(1-f.anchor.y),m=w.height*-f.anchor.y),n[a]=u*y,n[a+1]=m*_,n[a+s]=h*y,n[a+s+1]=m*_,n[a+s*2]=h*y,n[a+s*2+1]=d*_,n[a+s*3]=u*y,n[a+s*3+1]=d*_,a+=s*4}}uploadPosition(t,e,r,n,s,a){for(let h=0;h<r;h++){const u=t[e+h].position;n[a]=u.x,n[a+1]=u.y,n[a+s]=u.x,n[a+s+1]=u.y,n[a+s*2]=u.x,n[a+s*2+1]=u.y,n[a+s*3]=u.x,n[a+s*3+1]=u.y,a+=s*4}}uploadRotation(t,e,r,n,s,a){for(let h=0;h<r;h++){const u=t[e+h].rotation;n[a]=u,n[a+s]=u,n[a+s*2]=u,n[a+s*3]=u,a+=s*4}}uploadUvs(t,e,r,n,s,a){for(let h=0;h<r;++h){const u=t[e+h]._texture._uvs;u?(n[a]=u.x0,n[a+1]=u.y0,n[a+s]=u.x1,n[a+s+1]=u.y1,n[a+s*2]=u.x2,n[a+s*2+1]=u.y2,n[a+s*3]=u.x3,n[a+s*3+1]=u.y3,a+=s*4):(n[a]=0,n[a+1]=0,n[a+s]=0,n[a+s+1]=0,n[a+s*2]=0,n[a+s*2+1]=0,n[a+s*3]=0,n[a+s*3+1]=0,a+=s*4)}}uploadTint(t,e,r,n,s,a){for(let h=0;h<r;++h){const u=t[e+h],d=u._texture.baseTexture.alphaMode>0,m=u.alpha,l=m<1&&d?_f(u._tintRGB,m):u._tintRGB+(m*255<<24);n[a]=l,n[a+s]=l,n[a+s*2]=l,n[a+s*3]=l,a+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Ry.extension={name:"particle",type:Jt.RendererPlugin};he.add(Ry);jt.UPLOADS_PER_FRAME=4;var Ph=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(Ph||{});const Ad={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ph.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},SI=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];class ks{constructor(t){this.styleID=0,this.reset(),Td(this,t,t)}clone(){const t={};return Td(t,this,Ad),new ks(t)}reset(){Td(this,Ad,Ad)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Ed(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Ed(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){CI(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Ed(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let n=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!SI.includes(n)&&(n=`"${n}"`),e[r]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}}function Hg(i){return typeof i=="number"?M0(i):(typeof i=="string"&&i.startsWith("0x")&&(i=i.replace("0x","#")),i)}function Ed(i){if(Array.isArray(i)){for(let t=0;t<i.length;++t)i[t]=Hg(i[t]);return i}else return Hg(i)}function CI(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function Td(i,t,e){for(const r in e)Array.isArray(t[r])?i[r]=t[r].slice():i[r]=t[r]}const Vl={willReadFrequently:!0};class ae{constructor(t,e,r,n,s,a,h,u,d){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=s,this.lineWidths=a,this.lineHeight=h,this.maxLineWidth=u,this.fontProperties=d}static measureText(t,e,r,n=ae._canvas){r=r??e.wordWrap;const s=e.toFontString(),a=ae.measureFont(s);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const h=n.getContext("2d",Vl);h.font=s;const d=(r?ae.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),m=new Array(d.length);let l=0;for(let _=0;_<d.length;_++){const v=h.measureText(d[_]).width+(d[_].length-1)*e.letterSpacing;m[_]=v,l=Math.max(l,v)}let f=l+e.strokeThickness;e.dropShadow&&(f+=e.dropShadowDistance);const p=e.lineHeight||a.fontSize+e.strokeThickness;let y=Math.max(p,a.fontSize+e.strokeThickness)+(d.length-1)*(p+e.leading);return e.dropShadow&&(y+=e.dropShadowDistance),new ae(t,e,f,y,d,m,p+e.leading,l,a)}static wordWrap(t,e,r=ae._canvas){const n=r.getContext("2d",Vl);let s=0,a="",h="";const u=Object.create(null),{letterSpacing:d,whiteSpace:m}=e,l=ae.collapseSpaces(m),f=ae.collapseNewlines(m);let p=!l;const y=e.wordWrapWidth+d,_=ae.tokenize(t);for(let v=0;v<_.length;v++){let w=_[v];if(ae.isNewline(w)){if(!f){h+=ae.addLine(a),p=!l,a="",s=0;continue}w=" "}if(l){const E=ae.isBreakingSpace(w),k=ae.isBreakingSpace(a[a.length-1]);if(E&&k)continue}const C=ae.getFromCache(w,d,u,n);if(C>y)if(a!==""&&(h+=ae.addLine(a),a="",s=0),ae.canBreakWords(w,e.breakWords)){const E=ae.wordWrapSplit(w);for(let k=0;k<E.length;k++){let G=E[k],Q=1;for(;E[k+Q];){const it=E[k+Q],J=G[G.length-1];if(ae.canBreakChars(J,it,w,k,e.breakWords))break}k+=G.length-1;const Y=ae.getFromCache(G,d,u,n);Y+s>y&&(h+=ae.addLine(a),p=!1,a="",s=0),a+=G,s+=Y}}else{a.length>0&&(h+=ae.addLine(a),a="",s=0);const E=v===_.length-1;h+=ae.addLine(w,!E),p=!1,a="",s=0}else C+s>y&&(p=!1,h+=ae.addLine(a),a="",s=0),(a.length>0||!ae.isBreakingSpace(w)||p)&&(a+=w,s+=C)}return h+=ae.addLine(a,!1),h}static addLine(t,e=!0){return t=ae.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,r,n){let s=r[t];if(typeof s!="number"){const a=t.length*e;s=n.measureText(t).width+a,r[t]=s}return s}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!ae.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:ae._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:ae._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let r="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const s=t[n],a=t[n+1];if(ae.isBreakingSpace(s,a)||ae.isNewline(s)){r!==""&&(e.push(r),r=""),e.push(s);continue}r+=s}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,n,s){return!0}static wordWrapSplit(t){return t.split("")}static measureFont(t){if(ae._fonts[t])return ae._fonts[t];const e={ascent:0,descent:0,fontSize:0},r=ae._canvas,n=ae._context;n.font=t;const s=ae.METRICS_STRING+ae.BASELINE_SYMBOL,a=Math.ceil(n.measureText(s).width);let h=Math.ceil(n.measureText(ae.BASELINE_SYMBOL).width);const u=Math.ceil(ae.HEIGHT_MULTIPLIER*h);h=h*ae.BASELINE_MULTIPLIER|0,r.width=a,r.height=u,n.fillStyle="#f00",n.fillRect(0,0,a,u),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,h);const d=n.getImageData(0,0,a,u).data,m=d.length,l=a*4;let f=0,p=0,y=!1;for(f=0;f<h;++f){for(let _=0;_<l;_+=4)if(d[p+_]!==255){y=!0;break}if(!y)p+=l;else break}for(e.ascent=h-f,p=m-l,y=!1,f=u;f>h;--f){for(let _=0;_<l;_+=4)if(d[p+_]!==255){y=!0;break}if(!y)p-=l;else break}return e.descent=f-h,e.fontSize=e.ascent+e.descent,ae._fonts[t]=e,e}static clearMetrics(t=""){t?delete ae._fonts[t]:ae._fonts={}}static get _canvas(){if(!ae.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",Vl)?.measureText)return ae.__canvas=e,e;t=jt.ADAPTER.createCanvas()}catch{t=jt.ADAPTER.createCanvas()}t.width=t.height=10,ae.__canvas=t}return ae.__canvas}static get _context(){return ae.__context||(ae.__context=ae._canvas.getContext("2d",Vl)),ae.__context}}ae._fonts={};ae.METRICS_STRING="|\xC9q\xC5";ae.BASELINE_SYMBOL="M";ae.BASELINE_MULTIPLIER=1.4;ae.HEIGHT_MULTIPLIER=2;ae._newlines=[10,13];ae._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const MI={texture:!0,children:!1,baseTexture:!0},ky=class extends Pe{constructor(i,t,e){let r=!1;e||(e=jt.ADAPTER.createCanvas(),r=!0),e.width=3,e.height=3;const n=Ut.from(e);n.orig=new Te,n.trim=new Te,super(n),this._ownCanvas=r,this.canvas=e,this.context=e.getContext("2d",{willReadFrequently:!0}),this._resolution=jt.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=i,this.style=t,this.localStyleID=-1}updateText(i){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&i)return;this._font=this._style.toFontString();const e=this.context,r=ae.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=r.width,s=r.height,a=r.lines,h=r.lineHeight,u=r.lineWidths,d=r.maxLineWidth,m=r.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+t.padding*2)*this._resolution),e.scale(this._resolution,this._resolution),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.font=this._font,e.lineWidth=t.strokeThickness,e.textBaseline=t.textBaseline,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit;let l,f;const p=t.dropShadow?2:1;for(let y=0;y<p;++y){const _=t.dropShadow&&y===0,v=_?Math.ceil(Math.max(1,s)+t.padding*2):0,w=v*this._resolution;if(_){e.fillStyle="black",e.strokeStyle="black";const E=t.dropShadowColor,k=vo(typeof E=="number"?E:yf(E)),G=t.dropShadowBlur*this._resolution,Q=t.dropShadowDistance*this._resolution;e.shadowColor=`rgba(${k[0]*255},${k[1]*255},${k[2]*255},${t.dropShadowAlpha})`,e.shadowBlur=G,e.shadowOffsetX=Math.cos(t.dropShadowAngle)*Q,e.shadowOffsetY=Math.sin(t.dropShadowAngle)*Q+w}else e.fillStyle=this._generateFillStyle(t,a,r),e.strokeStyle=t.stroke,e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;let C=(h-m.fontSize)/2;h-m.fontSize<0&&(C=0);for(let E=0;E<a.length;E++)l=t.strokeThickness/2,f=t.strokeThickness/2+E*h+m.ascent+C,t.align==="right"?l+=d-u[E]:t.align==="center"&&(l+=(d-u[E])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(a[E],l+t.padding,f+t.padding-v,!0),t.fill&&this.drawLetterSpacing(a[E],l+t.padding,f+t.padding-v)}this.updateTexture()}drawLetterSpacing(i,t,e,r=!1){const s=this._style.letterSpacing,a=ky.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(s===0||a){a&&(this.context.letterSpacing=s,this.context.textLetterSpacing=s),r?this.context.strokeText(i,t,e):this.context.fillText(i,t,e);return}let h=t;const u=Array.from?Array.from(i):i.split("");let d=this.context.measureText(i).width,m=0;for(let l=0;l<u.length;++l){const f=u[l];r?this.context.strokeText(f,h,e):this.context.fillText(f,h,e);let p="";for(let y=l+1;y<u.length;++y)p+=u[y];m=this.context.measureText(p).width,h+=d-m+s,d=m}}updateTexture(){const i=this.canvas;if(this._style.trim){const s=WC(i);s.data&&(i.width=s.width,i.height=s.height,this.context.putImageData(s.data,0,0))}const t=this._texture,e=this._style,r=e.trim?0:e.padding,n=t.baseTexture;t.trim.width=t._frame.width=i.width/this._resolution,t.trim.height=t._frame.height=i.height/this._resolution,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-r*2,t.orig.height=t._frame.height-r*2,this._onTextureUpdate(),n.setRealSize(i.width,i.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),super._render(i)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(i,t){return this.updateText(!0),this._textureID===-1&&(i=!1),super.getBounds(i,t)}getLocalBounds(i){return this.updateText(!0),super.getLocalBounds.call(this,i)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(i,t,e){const r=i.fill;if(Array.isArray(r)){if(r.length===1)return r[0]}else return r;let n;const s=i.dropShadow?i.dropShadowDistance:0,a=i.padding||0,h=this.canvas.width/this._resolution-s-a*2,u=this.canvas.height/this._resolution-s-a*2,d=r.slice(),m=i.fillGradientStops.slice();if(!m.length){const l=d.length+1;for(let f=1;f<l;++f)m.push(f/l)}if(d.unshift(r[0]),m.unshift(0),d.push(r[r.length-1]),m.push(1),i.fillGradientType===Ph.LINEAR_VERTICAL){n=this.context.createLinearGradient(h/2,a,h/2,u+a);const l=e.fontProperties.fontSize+i.strokeThickness;for(let f=0;f<t.length;f++){const p=e.lineHeight*(f-1)+l,y=e.lineHeight*f;let _=y;f>0&&p>y&&(_=(y+p)/2);const v=y+l,w=e.lineHeight*(f+1);let C=v;f+1<t.length&&w<v&&(C=(v+w)/2);const E=(C-_)/u;for(let k=0;k<d.length;k++){let G=0;typeof m[k]=="number"?G=m[k]:G=k/d.length;let Q=Math.min(1,Math.max(0,_/u+G*E));Q=Number(Q.toFixed(5)),n.addColorStop(Q,d[k])}}}else{n=this.context.createLinearGradient(a,u/2,h+a,u/2);const l=d.length+1;let f=1;for(let p=0;p<d.length;p++){let y;typeof m[p]=="number"?y=m[p]:y=f/l,n.addColorStop(y,d[p]),f++}}return n}destroy(i){typeof i=="boolean"&&(i={children:i}),i=Object.assign({},MI,i),super.destroy(i),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(i){this.updateText(!0);const t=ao(this.scale.x)||1;this.scale.x=t*i/this._texture.orig.width,this._width=i}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(i){this.updateText(!0);const t=ao(this.scale.y)||1;this.scale.y=t*i/this._texture.orig.height,this._height=i}get style(){return this._style}set style(i){i=i||{},i instanceof ks?this._style=i:this._style=new ks(i),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(i){i=String(i??""),this._text!==i&&(this._text=i,this.dirty=!0)}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}};let Sf=ky;Sf.experimentalLetterSpacing=!1;class II{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function BI(i,t){let e=!1;if(i?._textures?.length){for(let r=0;r<i._textures.length;r++)if(i._textures[r]instanceof Ut){const n=i._textures[r].baseTexture;t.includes(n)||(t.push(n),e=!0)}}return e}function RI(i,t){if(i.baseTexture instanceof Le){const e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function kI(i,t){if(i._texture&&i._texture instanceof Ut){const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function PI(i,t){return t instanceof Sf?(t.updateText(!0),!0):!1}function DI(i,t){if(t instanceof ks){const e=t.toFontString();return ae.measureFont(e),!0}return!1}function LI(i,t){if(i instanceof Sf){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function FI(i,t){return i instanceof ks?(t.includes(i)||t.push(i),!0):!1}class OI{constructor(t){this.limiter=new II(jt.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{!this.queue||this.prepareItems()},this.registerFindHook(LI),this.registerFindHook(FI),this.registerFindHook(BI),this.registerFindHook(RI),this.registerFindHook(kI),this.registerUploadHook(PI),this.registerUploadHook(DI)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,xi.system.addOnce(this.tick,this,pa.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)xi.system.addOnce(this.tick,this,pa.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof we)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&xi.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}}function Py(i,t){return t instanceof Le?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function NI(i,t){if(!(t instanceof Mo))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:r}=e;for(let n=0;n<r.length;n++){const{texture:s}=r[n].style;s&&Py(i,s.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function UI(i,t){return i instanceof Mo?(t.push(i),!0):!1}class Dy extends OI{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(UI),this.registerUploadHook(Py),this.registerUploadHook(NI)}}Dy.extension={name:"prepare",type:Jt.RendererSystem};he.add(Dy);const gh=class{constructor(i,t,e=null){this.linkedSheets=[],this._texture=i instanceof Ut?i:null,this.baseTexture=i instanceof Le?i:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const r=this.baseTexture.resource;this.resolution=this._updateResolution(e||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(i=null){const{scale:t}=this.data.meta;let e=Bs(i,null);return e===null&&(e=parseFloat(t??"1")),e!==1&&this.baseTexture.setResolution(e),e}parse(){return new Promise(i=>{this._callback=i,this._batchIndex=0,this._frameKeys.length<=gh.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(i){let t=i;const e=gh.BATCH_SIZE;for(;t-i<e&&t<this._frameKeys.length;){const r=this._frameKeys[t],n=this._frames[r],s=n.frame;if(s){let a=null,h=null;const u=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,d=new Te(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);n.rotated?a=new Te(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):a=new Te(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(h=new Te(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[r]=new Ut(this.baseTexture,a,d,h,n.rotated?2:0,n.anchor),Ut.addToCache(this.textures[r],r)}t++}}_processAnimations(){const i=this.data.animations||{};for(const t in i){this.animations[t]=[];for(let e=0;e<i[t].length;e++){const r=i[t][e];this.animations[t].push(this.textures[r])}}}_parseComplete(){const i=this._callback;this._callback=null,this._batchIndex=0,i.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*gh.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*gh.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(i=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,i&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let af=gh;af.BATCH_SIZE=1e3;const HI=["jpg","png","jpeg","avif","webp"];function Ly(i,t,e){const r={};if(i.forEach(n=>{r[n]=t}),Object.keys(t.textures).forEach(n=>{r[n]=t.textures[n]}),!e){const n=$i.dirname(i[0]);t.linkedSheets.forEach((s,a)=>{const h=Ly([`${n}/${t.data.meta.related_multi_packs[a]}`],s,!0);Object.assign(r,h)})}return r}const GI={extension:Jt.Asset,cache:{test:i=>i instanceof af,getCacheableAssets:(i,t)=>Ly(i,t,!1)},resolver:{test:i=>{const e=i.split("?")[0].split("."),r=e.pop(),n=e.pop();return r==="json"&&HI.includes(n)},parse:i=>{const t=i.split(".");return{resolution:parseFloat(jt.RETINA_PREFIX.exec(i)?.[1]??"1"),format:t[t.length-2],src:i}}},loader:{extension:{type:Jt.LoadParser,priority:Sn.Normal},async testParse(i,t){return $i.extname(t.src).includes(".json")&&!!i.frames},async parse(i,t,e){let r=$i.dirname(t.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");const n=r+i.meta.image,a=(await e.load([n]))[n],h=new af(a.baseTexture,i,t.src);await h.parse();const u=i?.meta?.related_multi_packs;if(Array.isArray(u)){const d=[];for(const l of u){if(typeof l!="string")continue;const f=r+l;t.data?.ignoreMultiPack||d.push(e.load({src:f,data:{ignoreMultiPack:!0}}))}const m=await Promise.all(d);h.linkedSheets=m,m.forEach(l=>{l.linkedSheets=[h].concat(h.linkedSheets.filter(f=>f!==l))})}return h},unload(i){i.destroy(!0)}}};he.add(GI);const dh=new Ue;class Cf extends Pe{constructor(t,e=100,r=100){super(t),this.tileTransform=new Rc,this._width=e,this._height=r,this.uvMatrix=this.texture.uvMatrix||new wf(t),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(t){this.tileTransform.scale.copyFrom(t)}get tilePosition(){return this.tileTransform.position}set tilePosition(t){this.tileTransform.position.copyFrom(t)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(t){const e=this._texture;!e||!e.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}_calculateBounds(){const t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),n=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,r,n)}getLocalBounds(t){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Te),t=this._localBoundsRect),this._bounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,dh);const e=this._width,r=this._height,n=-e*this.anchor._x;if(dh.x>=n&&dh.x<n+e){const s=-r*this.anchor._y;if(dh.y>=s&&dh.y<s+r)return!0}return!1}destroy(t){super.destroy(t),this.tileTransform=null,this.uvMatrix=null}static from(t,e){const r=t instanceof Ut?t:Ut.from(t,e);return new Cf(r,e.width,e.height)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}}var WI=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,Gg=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,zI=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,VI=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,jI=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;const jl=new yi;class Fy extends Lc{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new H0,this.state=rs.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Mr.from(Gg,WI,e),this.shader=t.context.webGLVersion>1?Mr.from(VI,jI,e):Mr.from(Gg,zI,e)}render(t){const e=this.renderer,r=this.quad;let n=r.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,a=t.uvRespectAnchor?t.anchor.y:0;n=r.uvs,n[0]=n[6]=-s,n[1]=n[3]=-a,n[2]=n[4]=1-s,n[5]=n[7]=1-a,r.invalidate();const h=t._texture,u=h.baseTexture,d=u.alphaMode>0,m=t.tileTransform.localTransform,l=t.uvMatrix;let f=u.isPowerOfTwo&&h.frame.width===u.width&&h.frame.height===u.height;f&&(u._glTextures[e.CONTEXT_UID]?f=u.wrapMode!==Ms.CLAMP:u.wrapMode===Ms.CLAMP&&(u.wrapMode=Ms.REPEAT));const p=f?this.simpleShader:this.shader,y=h.width,_=h.height,v=t._width,w=t._height;jl.set(m.a*y/v,m.b*y/w,m.c*_/v,m.d*_/w,m.tx/v,m.ty/w),jl.invert(),f?jl.prepend(l.mapCoord):(p.uniforms.uMapCoord=l.mapCoord.toArray(!0),p.uniforms.uClampFrame=l.uClampFrame,p.uniforms.uClampOffset=l.uClampOffset),p.uniforms.uTransform=jl.toArray(!0),p.uniforms.uColor=R0(t.tint,t.worldAlpha,p.uniforms.uColor,d),p.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),p.uniforms.uSampler=h,e.shader.bind(p),e.geometry.bind(r),this.state.blendMode=B0(t.blendMode,d),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Fy.extension={name:"tilingSprite",type:Jt.RendererPlugin};he.add(Fy);class bc{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class hc{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in e){const a=e[s].match(/^[a-z]+/gm)[0],h=e[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),u={};for(const d in h){const m=h[d].split("="),l=m[0],f=m[1].replace(/"/gm,""),p=parseFloat(f),y=isNaN(p)?f:p;u[l]=y}r[a].push(u)}const n=new bc;return r.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),r.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),r.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),r.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),r.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),r.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class of{static test(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new bc,r=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),h=t.getElementsByTagName("kerning"),u=t.getElementsByTagName("distanceField");for(let d=0;d<r.length;d++)e.info.push({face:r[d].getAttribute("face"),size:parseInt(r[d].getAttribute("size"),10)});for(let d=0;d<n.length;d++)e.common.push({lineHeight:parseInt(n[d].getAttribute("lineHeight"),10)});for(let d=0;d<s.length;d++)e.page.push({id:parseInt(s[d].getAttribute("id"),10)||0,file:s[d].getAttribute("file")});for(let d=0;d<a.length;d++){const m=a[d];e.char.push({id:parseInt(m.getAttribute("id"),10),page:parseInt(m.getAttribute("page"),10)||0,x:parseInt(m.getAttribute("x"),10),y:parseInt(m.getAttribute("y"),10),width:parseInt(m.getAttribute("width"),10),height:parseInt(m.getAttribute("height"),10),xoffset:parseInt(m.getAttribute("xoffset"),10),yoffset:parseInt(m.getAttribute("yoffset"),10),xadvance:parseInt(m.getAttribute("xadvance"),10)})}for(let d=0;d<h.length;d++)e.kerning.push({first:parseInt(h[d].getAttribute("first"),10),second:parseInt(h[d].getAttribute("second"),10),amount:parseInt(h[d].getAttribute("amount"),10)});for(let d=0;d<u.length;d++)e.distanceField.push({fieldType:u[d].getAttribute("fieldType"),distanceRange:parseInt(u[d].getAttribute("distanceRange"),10)});return e}}class hf{static test(t){if(typeof t=="string"&&t.includes("<font>")){const e=new globalThis.DOMParser().parseFromString(t,"text/xml");return of.test(e)}return!1}static parse(t){const e=new globalThis.DOMParser().parseFromString(t,"text/xml");return of.parse(e)}}const Sd=[hc,of,hf];function XI(i){for(let t=0;t<Sd.length;t++)if(Sd[t].test(i))return Sd[t];return null}function YI(i,t,e,r,n,s){const a=e.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let h;const u=e.dropShadow?e.dropShadowDistance:0,d=e.padding||0,m=i.width/r-u-d*2,l=i.height/r-u-d*2,f=a.slice(),p=e.fillGradientStops.slice();if(!p.length){const y=f.length+1;for(let _=1;_<y;++_)p.push(_/y)}if(f.unshift(a[0]),p.unshift(0),f.push(a[a.length-1]),p.push(1),e.fillGradientType===Ph.LINEAR_VERTICAL){h=t.createLinearGradient(m/2,d,m/2,l+d);let y=0;const v=(s.fontProperties.fontSize+e.strokeThickness)/l;for(let w=0;w<n.length;w++){const C=s.lineHeight*w;for(let E=0;E<f.length;E++){let k=0;typeof p[E]=="number"?k=p[E]:k=E/f.length;const G=C/l+k*v;let Q=Math.max(y,G);Q=Math.min(Q,1),h.addColorStop(Q,f[E]),y=Q}}}else{h=t.createLinearGradient(d,l/2,m+d,l/2);const y=f.length+1;let _=1;for(let v=0;v<f.length;v++){let w;typeof p[v]=="number"?w=p[v]:w=_/y,h.addColorStop(w,f[v]),_++}}return h}function $I(i,t,e,r,n,s,a){const h=e.text,u=e.fontProperties;t.translate(r,n),t.scale(s,s);const d=a.strokeThickness/2,m=-(a.strokeThickness/2);if(t.font=a.toFontString(),t.lineWidth=a.strokeThickness,t.textBaseline=a.textBaseline,t.lineJoin=a.lineJoin,t.miterLimit=a.miterLimit,t.fillStyle=YI(i,t,a,s,[h],e),t.strokeStyle=a.stroke,a.dropShadow){const l=a.dropShadowColor,f=vo(typeof l=="number"?l:yf(l)),p=a.dropShadowBlur*s,y=a.dropShadowDistance*s;t.shadowColor=`rgba(${f[0]*255},${f[1]*255},${f[2]*255},${a.dropShadowAlpha})`,t.shadowBlur=p,t.shadowOffsetX=Math.cos(a.dropShadowAngle)*y,t.shadowOffsetY=Math.sin(a.dropShadowAngle)*y}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;a.stroke&&a.strokeThickness&&t.strokeText(h,d,m+e.lineHeight-u.descent),a.fill&&t.fillText(h,d,m+e.lineHeight-u.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Oy(i){return Array.from?Array.from(i):i.split("")}function qI(i){typeof i=="string"&&(i=[i]);const t=[];for(let e=0,r=i.length;e<r;e++){const n=i[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),a=n[1].charCodeAt(0);if(a<s)throw new Error("[BitmapFont]: Invalid character range.");for(let h=s,u=a;h<=u;h++)t.push(String.fromCharCode(h))}else t.push(...Oy(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}function lc(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}const tn=class{constructor(i,t,e){const[r]=i.info,[n]=i.common,[s]=i.page,[a]=i.distanceField,h=Bs(s.file),u={};this._ownsTextures=e,this.font=r.face,this.size=r.size,this.lineHeight=n.lineHeight/h,this.chars={},this.pageTextures=u;for(let d=0;d<i.page.length;d++){const{id:m,file:l}=i.page[d];u[m]=t instanceof Array?t[d]:t[l],a?.fieldType&&a.fieldType!=="none"&&(u[m].baseTexture.alphaMode=hn.NO_PREMULTIPLIED_ALPHA,u[m].baseTexture.mipmap=En.OFF)}for(let d=0;d<i.char.length;d++){const{id:m,page:l}=i.char[d];let{x:f,y:p,width:y,height:_,xoffset:v,yoffset:w,xadvance:C}=i.char[d];f/=h,p/=h,y/=h,_/=h,v/=h,w/=h,C/=h;const E=new Te(f+u[l].frame.x/h,p+u[l].frame.y/h,y,_);this.chars[m]={xOffset:v,yOffset:w,xAdvance:C,kerning:{},texture:new Ut(u[l].baseTexture,E),page:l}}for(let d=0;d<i.kerning.length;d++){let{first:m,second:l,amount:f}=i.kerning[d];m/=h,l/=h,f/=h,this.chars[l]&&(this.chars[l].kerning[m]=f)}this.distanceFieldRange=a?.distanceRange,this.distanceFieldType=a?.fieldType?.toLowerCase()??"none"}destroy(){for(const i in this.chars)this.chars[i].texture.destroy(),this.chars[i].texture=null;for(const i in this.pageTextures)this._ownsTextures&&this.pageTextures[i].destroy(!0),this.pageTextures[i]=null;this.chars=null,this.pageTextures=null}static install(i,t,e){let r;if(i instanceof bc)r=i;else{const s=XI(i);if(!s)throw new Error("Unrecognized data format for font.");r=s.parse(i)}t instanceof Ut&&(t=[t]);const n=new tn(r,t,e);return tn.available[n.font]=n,n}static uninstall(i){const t=tn.available[i];if(!t)throw new Error(`No font found named '${i}'`);t.destroy(),delete tn.available[i]}static from(i,t,e){if(!i)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:n,resolution:s,textureWidth:a,textureHeight:h,...u}=Object.assign({},tn.defaultOptions,e),d=qI(r),m=t instanceof ks?t:new ks(t),l=a,f=new bc;f.info[0]={face:m.fontFamily,size:m.fontSize},f.common[0]={lineHeight:m.fontSize};let p=0,y=0,_,v,w,C=0;const E=[];for(let G=0;G<d.length;G++){_||(_=jt.ADAPTER.createCanvas(),_.width=a,_.height=h,v=_.getContext("2d"),w=new Le(_,{resolution:s,...u}),E.push(new Ut(w)),f.page.push({id:E.length-1,file:""}));const Q=d[G],Y=ae.measureText(Q,m,!1,_),it=Y.width,J=Math.ceil(Y.height),st=Math.ceil((m.fontStyle==="italic"?2:1)*it);if(y>=h-J*s){if(y===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${m.fontFamily}', fontSize: ${m.fontSize}px, char: '${Q}')`);--G,_=null,v=null,w=null,y=0,p=0,C=0;continue}if(C=Math.max(J+Y.fontProperties.descent,C),st*s+p>=l){if(p===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${m.fontFamily}', fontSize: ${m.fontSize}px, char: '${Q}')`);--G,y+=C*s,y=Math.ceil(y),p=0,C=0;continue}$I(_,v,Y,p,y,s,m);const gt=lc(Y.text);f.char.push({id:gt,page:E.length-1,x:p/s,y:y/s,width:st,height:J,xoffset:0,yoffset:0,xadvance:Math.ceil(it-(m.dropShadow?m.dropShadowDistance:0)-(m.stroke?m.strokeThickness:0))}),p+=(st+2*n)*s,p=Math.ceil(p)}for(let G=0,Q=d.length;G<Q;G++){const Y=d[G];for(let it=0;it<Q;it++){const J=d[it],st=v.measureText(Y).width,gt=v.measureText(J).width,Z=v.measureText(Y+J).width-(st+gt);Z&&f.kerning.push({first:lc(Y),second:lc(J),amount:Z})}}const k=new tn(f,E,!0);return tn.available[i]!==void 0&&tn.uninstall(i),tn.available[i]=k,k}};let Qi=tn;Qi.ALPHA=[["a","z"],["A","Z"]," "];Qi.NUMERIC=[["0","9"]];Qi.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Qi.ASCII=[[" ","~"]];Qi.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:tn.ALPHANUMERIC};Qi.available={};var KI=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,ZI=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Wg=[],zg=[],Vg=[],Ny=class extends we{constructor(i,t={}){super(),this._tint=16777215;const{align:e,tint:r,maxWidth:n,letterSpacing:s,fontName:a,fontSize:h}=Object.assign({},Ny.styleDefaults,t);if(!Qi.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=e,this._tint=r,this._font=void 0,this._fontName=a,this._fontSize=h,this.text=i,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new Ss(()=>{this.dirty=!0},this,0,0),this._roundPixels=jt.ROUND_PIXELS,this.dirty=!0,this._resolution=jt.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const i=Qi.available[this._fontName],t=this.fontSize,e=t/i.size,r=new Ue,n=[],s=[],a=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",u=Oy(h),d=this._maxWidth*i.size/t,m=i.distanceFieldType==="none"?Wg:zg;let l=null,f=0,p=0,y=0,_=-1,v=0,w=0,C=0,E=0;for(let st=0;st<u.length;st++){const gt=u[st],j=lc(gt);if(/(?:\s)/.test(gt)&&(_=st,v=f,E++),gt==="\r"||gt===`
`){s.push(f),a.push(-1),p=Math.max(p,f),++y,++w,r.x=0,r.y+=i.lineHeight,l=null,E=0;continue}const Z=i.chars[j];if(!Z)continue;l&&Z.kerning[l]&&(r.x+=Z.kerning[l]);const T=Vg.pop()||{texture:Ut.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ue};T.texture=Z.texture,T.line=y,T.charCode=j,T.position.x=r.x+Z.xOffset+this._letterSpacing/2,T.position.y=r.y+Z.yOffset,T.prevSpaces=E,n.push(T),f=T.position.x+Math.max(Z.xAdvance-Z.xOffset,Z.texture.orig.width),r.x+=Z.xAdvance+this._letterSpacing,C=Math.max(C,Z.yOffset+Z.texture.height),l=j,_!==-1&&d>0&&r.x>d&&(++w,go(n,1+_-w,1+st-_),st=_,_=-1,s.push(v),a.push(n.length>0?n[n.length-1].prevSpaces:0),p=Math.max(p,v),y++,r.x=0,r.y+=i.lineHeight,l=null,E=0)}const k=u[u.length-1];k!=="\r"&&k!==`
`&&(/(?:\s)/.test(k)&&(f=v),s.push(f),p=Math.max(p,f),a.push(-1));const G=[];for(let st=0;st<=y;st++){let gt=0;this._align==="right"?gt=p-s[st]:this._align==="center"?gt=(p-s[st])/2:this._align==="justify"&&(gt=a[st]<0?0:(p-s[st])/a[st]),G.push(gt)}const Q=n.length,Y={},it=[],J=this._activePagesMeshData;m.push(...J);for(let st=0;st<Q;st++){const gt=n[st].texture,j=gt.baseTexture.uid;if(!Y[j]){let Z=m.pop();if(!Z){const ut=new Iy;let Pt,pt;i.distanceFieldType==="none"?(Pt=new sf(Ut.EMPTY),pt=ce.NORMAL):(Pt=new sf(Ut.EMPTY,{program:Zn.from(ZI,KI),uniforms:{uFWidth:0}}),pt=ce.NORMAL_NPM);const Gt=new ua(ut,Pt);Gt.blendMode=pt,Z={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Gt,vertices:null,uvs:null,indices:null}}Z.index=0,Z.indexCount=0,Z.vertexCount=0,Z.uvsCount=0,Z.total=0;const{_textureCache:T}=this;T[j]=T[j]||new Ut(gt.baseTexture),Z.mesh.texture=T[j],Z.mesh.tint=this._tint,it.push(Z),Y[j]=Z}Y[j].total++}for(let st=0;st<J.length;st++)it.includes(J[st])||this.removeChild(J[st].mesh);for(let st=0;st<it.length;st++)it[st].mesh.parent!==this&&this.addChild(it[st].mesh);this._activePagesMeshData=it;for(const st in Y){const gt=Y[st],j=gt.total;if(!(gt.indices?.length>6*j)||gt.vertices.length<ua.BATCHABLE_SIZE*2)gt.vertices=new Float32Array(4*2*j),gt.uvs=new Float32Array(4*2*j),gt.indices=new Uint16Array(6*j);else{const Z=gt.total,T=gt.vertices;for(let ut=Z*4*2;ut<T.length;ut++)T[ut]=0}gt.mesh.size=6*j}for(let st=0;st<Q;st++){const gt=n[st];let j=gt.position.x+G[gt.line]*(this._align==="justify"?gt.prevSpaces:1);this._roundPixels&&(j=Math.round(j));const Z=j*e,T=gt.position.y*e,ut=gt.texture,Pt=Y[ut.baseTexture.uid],pt=ut.frame,Gt=ut._uvs,bt=Pt.index++;Pt.indices[bt*6+0]=0+bt*4,Pt.indices[bt*6+1]=1+bt*4,Pt.indices[bt*6+2]=2+bt*4,Pt.indices[bt*6+3]=0+bt*4,Pt.indices[bt*6+4]=2+bt*4,Pt.indices[bt*6+5]=3+bt*4,Pt.vertices[bt*8+0]=Z,Pt.vertices[bt*8+1]=T,Pt.vertices[bt*8+2]=Z+pt.width*e,Pt.vertices[bt*8+3]=T,Pt.vertices[bt*8+4]=Z+pt.width*e,Pt.vertices[bt*8+5]=T+pt.height*e,Pt.vertices[bt*8+6]=Z,Pt.vertices[bt*8+7]=T+pt.height*e,Pt.uvs[bt*8+0]=Gt.x0,Pt.uvs[bt*8+1]=Gt.y0,Pt.uvs[bt*8+2]=Gt.x1,Pt.uvs[bt*8+3]=Gt.y1,Pt.uvs[bt*8+4]=Gt.x2,Pt.uvs[bt*8+5]=Gt.y2,Pt.uvs[bt*8+6]=Gt.x3,Pt.uvs[bt*8+7]=Gt.y3}this._textWidth=p*e,this._textHeight=(r.y+i.lineHeight)*e;for(const st in Y){const gt=Y[st];if(this.anchor.x!==0||this.anchor.y!==0){let ut=0;const Pt=this._textWidth*this.anchor.x,pt=this._textHeight*this.anchor.y;for(let Gt=0;Gt<gt.total;Gt++)gt.vertices[ut++]-=Pt,gt.vertices[ut++]-=pt,gt.vertices[ut++]-=Pt,gt.vertices[ut++]-=pt,gt.vertices[ut++]-=Pt,gt.vertices[ut++]-=pt,gt.vertices[ut++]-=Pt,gt.vertices[ut++]-=pt}this._maxLineHeight=C*e;const j=gt.mesh.geometry.getBuffer("aVertexPosition"),Z=gt.mesh.geometry.getBuffer("aTextureCoord"),T=gt.mesh.geometry.getIndex();j.data=gt.vertices,Z.data=gt.uvs,T.data=gt.indices,j.update(),Z.update(),T.update()}for(let st=0;st<n.length;st++)Vg.push(n[st]);this._font=i,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:e,size:r}=Qi.available[this._fontName];if(e!=="none"){const{a:n,b:s,c:a,d:h}=this.worldTransform,u=Math.sqrt(n*n+s*s),d=Math.sqrt(a*a+h*h),m=(Math.abs(u)+Math.abs(d))/2,l=this.fontSize/r,f=i._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=m*t*l*f}super._render(i)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const i=Qi.available[this._fontName];if(!i)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==i&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(i){if(this._tint!==i){this._tint=i;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=i}}get align(){return this._align}set align(i){this._align!==i&&(this._align=i,this.dirty=!0)}get fontName(){return this._fontName}set fontName(i){if(!Qi.available[i])throw new Error(`Missing BitmapFont "${i}"`);this._fontName!==i&&(this._fontName=i,this.dirty=!0)}get fontSize(){return this._fontSize??Qi.available[this._fontName].size}set fontSize(i){this._fontSize!==i&&(this._fontSize=i,this.dirty=!0)}get anchor(){return this._anchor}set anchor(i){typeof i=="number"?this._anchor.set(i):this._anchor.copyFrom(i)}get text(){return this._text}set text(i){i=String(i??""),this._text!==i&&(this._text=i,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(i){this._maxWidth!==i&&(this._maxWidth=i,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(i){this._letterSpacing!==i&&(this._letterSpacing=i,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(i){i!==this._roundPixels&&(this._roundPixels=i,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}destroy(i){const{_textureCache:t}=this,r=Qi.available[this._fontName].distanceFieldType==="none"?Wg:zg;r.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],r.filter(n=>t[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=Ut.EMPTY});for(const n in t)t[n].destroy(),delete t[n];this._font=null,this._textureCache=null,super.destroy(i)}};let He=Ny;He.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const QI=[".xml",".fnt"],JI={extension:{type:Jt.LoadParser,priority:Sn.Normal},test(i){return QI.includes($i.extname(i))},async testParse(i){return hc.test(i)||hf.test(i)},async parse(i,t,e){const r=hc.test(i)?hc.parse(i):hf.parse(i),{src:n}=t,{page:s}=r,a=[];for(let d=0;d<s.length;++d){const m=s[d].file,l=$i.join($i.dirname(n),m);a.push(l)}const h=await e.load(a),u=a.map(d=>h[d]);return Qi.install(r,u,!0)},async load(i,t){return(await jt.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};he.add(JI);var Uy={exports:{}};(function(i){(function(){function t(I,N,mt){return I.call.apply(I.bind,arguments)}function e(I,N,mt){if(!I)throw Error();if(2<arguments.length){var yt=Array.prototype.slice.call(arguments,2);return function(){var Ct=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ct,yt),I.apply(N,Ct)}}return function(){return I.apply(N,arguments)}}function r(I,N,mt){return r=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?t:e,r.apply(null,arguments)}var n=Date.now||function(){return+new Date};function s(I,N){this.a=I,this.o=N||I,this.c=this.o.document}var a=!!window.FontFace;function h(I,N,mt,yt){if(N=I.c.createElement(N),mt)for(var Ct in mt)mt.hasOwnProperty(Ct)&&(Ct=="style"?N.style.cssText=mt[Ct]:N.setAttribute(Ct,mt[Ct]));return yt&&N.appendChild(I.c.createTextNode(yt)),N}function u(I,N,mt){I=I.c.getElementsByTagName(N)[0],I||(I=document.documentElement),I.insertBefore(mt,I.lastChild)}function d(I){I.parentNode&&I.parentNode.removeChild(I)}function m(I,N,mt){N=N||[],mt=mt||[];for(var yt=I.className.split(/\s+/),Ct=0;Ct<N.length;Ct+=1){for(var Wt=!1,Vt=0;Vt<yt.length;Vt+=1)if(N[Ct]===yt[Vt]){Wt=!0;break}Wt||yt.push(N[Ct])}for(N=[],Ct=0;Ct<yt.length;Ct+=1){for(Wt=!1,Vt=0;Vt<mt.length;Vt+=1)if(yt[Ct]===mt[Vt]){Wt=!0;break}Wt||N.push(yt[Ct])}I.className=N.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function l(I,N){for(var mt=I.className.split(/\s+/),yt=0,Ct=mt.length;yt<Ct;yt++)if(mt[yt]==N)return!0;return!1}function f(I){return I.o.location.hostname||I.a.location.hostname}function p(I,N,mt){function yt(){be&&Ct&&Wt&&(be(Vt),be=null)}N=h(I,"link",{rel:"stylesheet",href:N,media:"all"});var Ct=!1,Wt=!0,Vt=null,be=mt||null;a?(N.onload=function(){Ct=!0,yt()},N.onerror=function(){Ct=!0,Vt=Error("Stylesheet failed to load"),yt()}):setTimeout(function(){Ct=!0,yt()},0),u(I,"head",N)}function y(I,N,mt,yt){var Ct=I.c.getElementsByTagName("head")[0];if(Ct){var Wt=h(I,"script",{src:N}),Vt=!1;return Wt.onload=Wt.onreadystatechange=function(){Vt||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(Vt=!0,mt&&mt(null),Wt.onload=Wt.onreadystatechange=null,Wt.parentNode.tagName=="HEAD"&&Ct.removeChild(Wt))},Ct.appendChild(Wt),setTimeout(function(){Vt||(Vt=!0,mt&&mt(Error("Script load timeout")))},yt||5e3),Wt}return null}function _(){this.a=0,this.c=null}function v(I){return I.a++,function(){I.a--,C(I)}}function w(I,N){I.c=N,C(I)}function C(I){I.a==0&&I.c&&(I.c(),I.c=null)}function E(I){this.a=I||"-"}E.prototype.c=function(I){for(var N=[],mt=0;mt<arguments.length;mt++)N.push(arguments[mt].replace(/[\W_]+/g,"").toLowerCase());return N.join(this.a)};function k(I,N){this.c=I,this.f=4,this.a="n";var mt=(N||"n4").match(/^([nio])([1-9])$/i);mt&&(this.a=mt[1],this.f=parseInt(mt[2],10))}function G(I){return it(I)+" "+(I.f+"00")+" 300px "+Q(I.c)}function Q(I){var N=[];I=I.split(/,\s*/);for(var mt=0;mt<I.length;mt++){var yt=I[mt].replace(/['"]/g,"");yt.indexOf(" ")!=-1||/^\d/.test(yt)?N.push("'"+yt+"'"):N.push(yt)}return N.join(",")}function Y(I){return I.a+I.f}function it(I){var N="normal";return I.a==="o"?N="oblique":I.a==="i"&&(N="italic"),N}function J(I){var N=4,mt="n",yt=null;return I&&((yt=I.match(/(normal|oblique|italic)/i))&&yt[1]&&(mt=yt[1].substr(0,1).toLowerCase()),(yt=I.match(/([1-9]00|normal|bold)/i))&&yt[1]&&(/bold/i.test(yt[1])?N=7:/[1-9]00/.test(yt[1])&&(N=parseInt(yt[1].substr(0,1),10)))),mt+N}function st(I,N){this.c=I,this.f=I.o.document.documentElement,this.h=N,this.a=new E("-"),this.j=N.events!==!1,this.g=N.classes!==!1}function gt(I){I.g&&m(I.f,[I.a.c("wf","loading")]),Z(I,"loading")}function j(I){if(I.g){var N=l(I.f,I.a.c("wf","active")),mt=[],yt=[I.a.c("wf","loading")];N||mt.push(I.a.c("wf","inactive")),m(I.f,mt,yt)}Z(I,"inactive")}function Z(I,N,mt){I.j&&I.h[N]&&(mt?I.h[N](mt.c,Y(mt)):I.h[N]())}function T(){this.c={}}function ut(I,N,mt){var yt=[],Ct;for(Ct in N)if(N.hasOwnProperty(Ct)){var Wt=I.c[Ct];Wt&&yt.push(Wt(N[Ct],mt))}return yt}function Pt(I,N){this.c=I,this.f=N,this.a=h(this.c,"span",{"aria-hidden":"true"},this.f)}function pt(I){u(I.c,"body",I.a)}function Gt(I){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+Q(I.c)+";"+("font-style:"+it(I)+";font-weight:"+(I.f+"00")+";")}function bt(I,N,mt,yt,Ct,Wt){this.g=I,this.j=N,this.a=yt,this.c=mt,this.f=Ct||3e3,this.h=Wt||void 0}bt.prototype.start=function(){var I=this.c.o.document,N=this,mt=n(),yt=new Promise(function(Vt,be){function Ie(){n()-mt>=N.f?be():I.fonts.load(G(N.a),N.h).then(function(Ne){1<=Ne.length?Vt():setTimeout(Ie,25)},function(){be()})}Ie()}),Ct=null,Wt=new Promise(function(Vt,be){Ct=setTimeout(be,N.f)});Promise.race([Wt,yt]).then(function(){Ct&&(clearTimeout(Ct),Ct=null),N.g(N.a)},function(){N.j(N.a)})};function xt(I,N,mt,yt,Ct,Wt,Vt){this.v=I,this.B=N,this.c=mt,this.a=yt,this.s=Vt||"BESbswy",this.f={},this.w=Ct||3e3,this.u=Wt||null,this.m=this.j=this.h=this.g=null,this.g=new Pt(this.c,this.s),this.h=new Pt(this.c,this.s),this.j=new Pt(this.c,this.s),this.m=new Pt(this.c,this.s),I=new k(this.a.c+",serif",Y(this.a)),I=Gt(I),this.g.a.style.cssText=I,I=new k(this.a.c+",sans-serif",Y(this.a)),I=Gt(I),this.h.a.style.cssText=I,I=new k("serif",Y(this.a)),I=Gt(I),this.j.a.style.cssText=I,I=new k("sans-serif",Y(this.a)),I=Gt(I),this.m.a.style.cssText=I,pt(this.g),pt(this.h),pt(this.j),pt(this.m)}var tt={D:"serif",C:"sans-serif"},et=null;function Ht(){if(et===null){var I=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);et=!!I&&(536>parseInt(I[1],10)||parseInt(I[1],10)===536&&11>=parseInt(I[2],10))}return et}xt.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=n(),Mt(this)};function Dt(I,N,mt){for(var yt in tt)if(tt.hasOwnProperty(yt)&&N===I.f[tt[yt]]&&mt===I.f[tt[yt]])return!0;return!1}function Mt(I){var N=I.g.a.offsetWidth,mt=I.h.a.offsetWidth,yt;(yt=N===I.f.serif&&mt===I.f["sans-serif"])||(yt=Ht()&&Dt(I,N,mt)),yt?n()-I.A>=I.w?Ht()&&Dt(I,N,mt)&&(I.u===null||I.u.hasOwnProperty(I.a.c))?re(I,I.v):re(I,I.B):te(I):re(I,I.v)}function te(I){setTimeout(r(function(){Mt(this)},I),50)}function re(I,N){setTimeout(r(function(){d(this.g.a),d(this.h.a),d(this.j.a),d(this.m.a),N(this.a)},I),0)}function Xt(I,N,mt){this.c=I,this.a=N,this.f=0,this.m=this.j=!1,this.s=mt}var qt=null;Xt.prototype.g=function(I){var N=this.a;N.g&&m(N.f,[N.a.c("wf",I.c,Y(I).toString(),"active")],[N.a.c("wf",I.c,Y(I).toString(),"loading"),N.a.c("wf",I.c,Y(I).toString(),"inactive")]),Z(N,"fontactive",I),this.m=!0,le(this)},Xt.prototype.h=function(I){var N=this.a;if(N.g){var mt=l(N.f,N.a.c("wf",I.c,Y(I).toString(),"active")),yt=[],Ct=[N.a.c("wf",I.c,Y(I).toString(),"loading")];mt||yt.push(N.a.c("wf",I.c,Y(I).toString(),"inactive")),m(N.f,yt,Ct)}Z(N,"fontinactive",I),le(this)};function le(I){--I.f==0&&I.j&&(I.m?(I=I.a,I.g&&m(I.f,[I.a.c("wf","active")],[I.a.c("wf","loading"),I.a.c("wf","inactive")]),Z(I,"active")):j(I.a))}function ne(I){this.j=I,this.a=new T,this.h=0,this.f=this.g=!0}ne.prototype.load=function(I){this.c=new s(this.j,I.context||this.j),this.g=I.events!==!1,this.f=I.classes!==!1,fe(this,new st(this.c,I),I)};function ye(I,N,mt,yt,Ct){var Wt=--I.h==0;(I.f||I.g)&&setTimeout(function(){var Vt=Ct||null,be=yt||null||{};if(mt.length===0&&Wt)j(N.a);else{N.f+=mt.length,Wt&&(N.j=Wt);var Ie,Ne=[];for(Ie=0;Ie<mt.length;Ie++){var Be=mt[Ie],Ze=be[Be.c],Ei=N.a,vr=Be;if(Ei.g&&m(Ei.f,[Ei.a.c("wf",vr.c,Y(vr).toString(),"loading")]),Z(Ei,"fontloading",vr),Ei=null,qt===null)if(window.FontFace){var vr=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),ss=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);qt=vr?42<parseInt(vr[1],10):!ss}else qt=!1;qt?Ei=new bt(r(N.g,N),r(N.h,N),N.c,Be,N.s,Ze):Ei=new xt(r(N.g,N),r(N.h,N),N.c,Be,N.s,Vt,Ze),Ne.push(Ei)}for(Ie=0;Ie<Ne.length;Ie++)Ne[Ie].start()}},0)}function fe(I,N,mt){var Ct=[],yt=mt.timeout;gt(N);var Ct=ut(I.a,mt,I.c),Wt=new Xt(I.c,N,yt);for(I.h=Ct.length,N=0,mt=Ct.length;N<mt;N++)Ct[N].load(function(Vt,be,Ie){ye(I,Wt,Vt,be,Ie)})}function S(I,N){this.c=I,this.a=N}S.prototype.load=function(I){function N(){if(Wt["__mti_fntLst"+yt]){var Vt=Wt["__mti_fntLst"+yt](),be=[],Ie;if(Vt)for(var Ne=0;Ne<Vt.length;Ne++){var Be=Vt[Ne].fontfamily;Vt[Ne].fontStyle!=null&&Vt[Ne].fontWeight!=null?(Ie=Vt[Ne].fontStyle+Vt[Ne].fontWeight,be.push(new k(Be,Ie))):be.push(new k(Be))}I(be)}else setTimeout(function(){N()},50)}var mt=this,yt=mt.a.projectId,Ct=mt.a.version;if(yt){var Wt=mt.c.o;y(this.c,(mt.a.api||"https://fast.fonts.net/jsapi")+"/"+yt+".js"+(Ct?"?v="+Ct:""),function(Vt){Vt?I([]):(Wt["__MonotypeConfiguration__"+yt]=function(){return mt.a},N())}).id="__MonotypeAPIScript__"+yt}else I([])};function At(I,N){this.c=I,this.a=N}At.prototype.load=function(I){var N,mt,yt=this.a.urls||[],Ct=this.a.families||[],Wt=this.a.testStrings||{},Vt=new _;for(N=0,mt=yt.length;N<mt;N++)p(this.c,yt[N],v(Vt));var be=[];for(N=0,mt=Ct.length;N<mt;N++)if(yt=Ct[N].split(":"),yt[1])for(var Ie=yt[1].split(","),Ne=0;Ne<Ie.length;Ne+=1)be.push(new k(yt[0],Ie[Ne]));else be.push(new k(yt[0]));w(Vt,function(){I(be,Wt)})};function _t(I,N){I?this.c=I:this.c=X,this.a=[],this.f=[],this.g=N||""}var X="https://fonts.googleapis.com/css";function V(I,N){for(var mt=N.length,yt=0;yt<mt;yt++){var Ct=N[yt].split(":");Ct.length==3&&I.f.push(Ct.pop());var Wt="";Ct.length==2&&Ct[1]!=""&&(Wt=":"),I.a.push(Ct.join(Wt))}}function lt(I){if(I.a.length==0)throw Error("No fonts to load!");if(I.c.indexOf("kit=")!=-1)return I.c;for(var N=I.a.length,mt=[],yt=0;yt<N;yt++)mt.push(I.a[yt].replace(/ /g,"+"));return N=I.c+"?family="+mt.join("%7C"),0<I.f.length&&(N+="&subset="+I.f.join(",")),0<I.g.length&&(N+="&text="+encodeURIComponent(I.g)),N}function Et(I){this.f=I,this.a=[],this.c={}}var Tt={latin:"BESbswy","latin-ext":"\xE7\xF6\xFC\u011F\u015F",cyrillic:"\u0439\u044F\u0416",greek:"\u03B1\u03B2\u03A3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},at={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Nt={i:"i",italic:"i",n:"n",normal:"n"},Kt=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Lt(I){for(var N=I.f.length,mt=0;mt<N;mt++){var yt=I.f[mt].split(":"),Ct=yt[0].replace(/\+/g," "),Wt=["n4"];if(2<=yt.length){var Vt,be=yt[1];if(Vt=[],be)for(var be=be.split(","),Ie=be.length,Ne=0;Ne<Ie;Ne++){var Be;if(Be=be[Ne],Be.match(/^[\w-]+$/)){var Ze=Kt.exec(Be.toLowerCase());if(Ze==null)Be="";else{if(Be=Ze[2],Be=Be==null||Be==""?"n":Nt[Be],Ze=Ze[1],Ze==null||Ze=="")Ze="4";else var Ei=at[Ze],Ze=Ei||(isNaN(Ze)?"4":Ze.substr(0,1));Be=[Be,Ze].join("")}}else Be="";Be&&Vt.push(Be)}0<Vt.length&&(Wt=Vt),yt.length==3&&(yt=yt[2],Vt=[],yt=yt?yt.split(","):Vt,0<yt.length&&(yt=Tt[yt[0]])&&(I.c[Ct]=yt))}for(I.c[Ct]||(yt=Tt[Ct])&&(I.c[Ct]=yt),yt=0;yt<Wt.length;yt+=1)I.a.push(new k(Ct,Wt[yt]))}}function ee(I,N){this.c=I,this.a=N}var D={Arimo:!0,Cousine:!0,Tinos:!0};ee.prototype.load=function(I){var N=new _,mt=this.c,yt=new _t(this.a.api,this.a.text),Ct=this.a.families;V(yt,Ct);var Wt=new Et(Ct);Lt(Wt),p(mt,lt(yt),v(N)),w(N,function(){I(Wt.a,Wt.c,D)})};function b(I,N){this.c=I,this.a=N}b.prototype.load=function(I){var N=this.a.id,mt=this.c.o;N?y(this.c,(this.a.api||"https://use.typekit.net")+"/"+N+".js",function(yt){if(yt)I([]);else if(mt.Typekit&&mt.Typekit.config&&mt.Typekit.config.fn){yt=mt.Typekit.config.fn;for(var Ct=[],Wt=0;Wt<yt.length;Wt+=2)for(var Vt=yt[Wt],be=yt[Wt+1],Ie=0;Ie<be.length;Ie++)Ct.push(new k(Vt,be[Ie]));try{mt.Typekit.load({events:!1,classes:!1,async:!0})}catch{}I(Ct)}},2e3):I([])};function A(I,N){this.c=I,this.f=N,this.a=[]}A.prototype.load=function(I){var N=this.f.id,mt=this.c.o,yt=this;N?(mt.__webfontfontdeckmodule__||(mt.__webfontfontdeckmodule__={}),mt.__webfontfontdeckmodule__[N]=function(Ct,Wt){for(var Vt=0,be=Wt.fonts.length;Vt<be;++Vt){var Ie=Wt.fonts[Vt];yt.a.push(new k(Ie.name,J("font-weight:"+Ie.weight+";font-style:"+Ie.style)))}I(yt.a)},y(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+f(this.c)+"/"+N+".js",function(Ct){Ct&&I([])})):I([])};var W=new ne(window);W.a.c.custom=function(I,N){return new At(N,I)},W.a.c.fontdeck=function(I,N){return new A(N,I)},W.a.c.monotype=function(I,N){return new S(N,I)},W.a.c.typekit=function(I,N){return new b(N,I)},W.a.c.google=function(I,N){return new ee(N,I)};var rt={load:r(W.load,W)};i.exports?i.exports=rt:(window.WebFont=rt,window.WebFontConfig&&W.load(window.WebFontConfig))})()})(Uy);const tB=Uy.exports;var yh={};/*! howler.js v2.2.3 | (c) 2013-2020, James Simpson of GoldFire Studios | MIT License | howlerjs.com */(function(i){(function(){var t=function(){this.init()};t.prototype={init:function(){var l=this||e;return l._counter=1e3,l._html5AudioPool=[],l.html5PoolSize=10,l._codecs={},l._howls=[],l._muted=!1,l._volume=1,l._canPlayEvent="canplaythrough",l._navigator=typeof window<"u"&&window.navigator?window.navigator:null,l.masterGain=null,l.noAudio=!1,l.usingWebAudio=!0,l.autoSuspend=!0,l.ctx=null,l.autoUnlock=!0,l._setup(),l},volume:function(l){var f=this||e;if(l=parseFloat(l),f.ctx||m(),l!==void 0&&l>=0&&l<=1){if(f._volume=l,f._muted)return f;f.usingWebAudio&&f.masterGain.gain.setValueAtTime(l,e.ctx.currentTime);for(var p=0;p<f._howls.length;p++)if(!f._howls[p]._webAudio)for(var y=f._howls[p]._getSoundIds(),_=0;_<y.length;_++){var v=f._howls[p]._soundById(y[_]);v&&v._node&&(v._node.volume=v._volume*l)}return f}return f._volume},mute:function(l){var f=this||e;f.ctx||m(),f._muted=l,f.usingWebAudio&&f.masterGain.gain.setValueAtTime(l?0:f._volume,e.ctx.currentTime);for(var p=0;p<f._howls.length;p++)if(!f._howls[p]._webAudio)for(var y=f._howls[p]._getSoundIds(),_=0;_<y.length;_++){var v=f._howls[p]._soundById(y[_]);v&&v._node&&(v._node.muted=!!l||v._muted)}return f},stop:function(){for(var l=this||e,f=0;f<l._howls.length;f++)l._howls[f].stop();return l},unload:function(){for(var l=this||e,f=l._howls.length-1;f>=0;f--)l._howls[f].unload();return l.usingWebAudio&&l.ctx&&l.ctx.close!==void 0&&(l.ctx.close(),l.ctx=null,m()),l},codecs:function(l){return(this||e)._codecs[l.replace(/^x-/,"")]},_setup:function(){var l=this||e;if(l.state=l.ctx&&l.ctx.state||"suspended",l._autoSuspend(),!l.usingWebAudio)if(typeof Audio<"u")try{var f=new Audio;f.oncanplaythrough===void 0&&(l._canPlayEvent="canplay")}catch{l.noAudio=!0}else l.noAudio=!0;try{var f=new Audio;f.muted&&(l.noAudio=!0)}catch{}return l.noAudio||l._setupCodecs(),l},_setupCodecs:function(){var l=this||e,f=null;try{f=typeof Audio<"u"?new Audio:null}catch{return l}if(!f||typeof f.canPlayType!="function")return l;var p=f.canPlayType("audio/mpeg;").replace(/^no$/,""),y=l._navigator?l._navigator.userAgent:"",_=y.match(/OPR\/([0-6].)/g),v=_&&parseInt(_[0].split("/")[1],10)<33,w=y.indexOf("Safari")!==-1&&y.indexOf("Chrome")===-1,C=y.match(/Version\/(.*?) /),E=w&&C&&parseInt(C[1],10)<15;return l._codecs={mp3:!(v||!p&&!f.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!p,opus:!!f.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(f.canPlayType('audio/wav; codecs="1"')||f.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!f.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!f.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(f.canPlayType("audio/x-m4a;")||f.canPlayType("audio/m4a;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(f.canPlayType("audio/x-m4b;")||f.canPlayType("audio/m4b;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(f.canPlayType("audio/x-mp4;")||f.canPlayType("audio/mp4;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(E||!f.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(E||!f.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!f.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(f.canPlayType("audio/x-flac;")||f.canPlayType("audio/flac;")).replace(/^no$/,"")},l},_unlockAudio:function(){var l=this||e;if(!l._audioUnlocked&&l.ctx){l._audioUnlocked=!1,l.autoUnlock=!1,l._mobileUnloaded||l.ctx.sampleRate===44100||(l._mobileUnloaded=!0,l.unload()),l._scratchBuffer=l.ctx.createBuffer(1,1,22050);var f=function(p){for(;l._html5AudioPool.length<l.html5PoolSize;)try{var y=new Audio;y._unlocked=!0,l._releaseHtml5Audio(y)}catch{l.noAudio=!0;break}for(var _=0;_<l._howls.length;_++)if(!l._howls[_]._webAudio)for(var v=l._howls[_]._getSoundIds(),w=0;w<v.length;w++){var C=l._howls[_]._soundById(v[w]);C&&C._node&&!C._node._unlocked&&(C._node._unlocked=!0,C._node.load())}l._autoResume();var E=l.ctx.createBufferSource();E.buffer=l._scratchBuffer,E.connect(l.ctx.destination),E.start===void 0?E.noteOn(0):E.start(0),typeof l.ctx.resume=="function"&&l.ctx.resume(),E.onended=function(){E.disconnect(0),l._audioUnlocked=!0,document.removeEventListener("touchstart",f,!0),document.removeEventListener("touchend",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("keydown",f,!0);for(var k=0;k<l._howls.length;k++)l._howls[k]._emit("unlock")}};return document.addEventListener("touchstart",f,!0),document.addEventListener("touchend",f,!0),document.addEventListener("click",f,!0),document.addEventListener("keydown",f,!0),l}},_obtainHtml5Audio:function(){var l=this||e;if(l._html5AudioPool.length)return l._html5AudioPool.pop();var f=new Audio().play();return f&&typeof Promise<"u"&&(f instanceof Promise||typeof f.then=="function")&&f.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(l){var f=this||e;return l._unlocked&&f._html5AudioPool.push(l),f},_autoSuspend:function(){var l=this;if(l.autoSuspend&&l.ctx&&l.ctx.suspend!==void 0&&e.usingWebAudio){for(var f=0;f<l._howls.length;f++)if(l._howls[f]._webAudio){for(var p=0;p<l._howls[f]._sounds.length;p++)if(!l._howls[f]._sounds[p]._paused)return l}return l._suspendTimer&&clearTimeout(l._suspendTimer),l._suspendTimer=setTimeout(function(){if(l.autoSuspend){l._suspendTimer=null,l.state="suspending";var y=function(){l.state="suspended",l._resumeAfterSuspend&&(delete l._resumeAfterSuspend,l._autoResume())};l.ctx.suspend().then(y,y)}},3e4),l}},_autoResume:function(){var l=this;if(l.ctx&&l.ctx.resume!==void 0&&e.usingWebAudio)return l.state==="running"&&l.ctx.state!=="interrupted"&&l._suspendTimer?(clearTimeout(l._suspendTimer),l._suspendTimer=null):l.state==="suspended"||l.state==="running"&&l.ctx.state==="interrupted"?(l.ctx.resume().then(function(){l.state="running";for(var f=0;f<l._howls.length;f++)l._howls[f]._emit("resume")}),l._suspendTimer&&(clearTimeout(l._suspendTimer),l._suspendTimer=null)):l.state==="suspending"&&(l._resumeAfterSuspend=!0),l}};var e=new t,r=function(l){var f=this;if(!l.src||l.src.length===0)return void console.error("An array of source files must be passed with any new Howl.");f.init(l)};r.prototype={init:function(l){var f=this;return e.ctx||m(),f._autoplay=l.autoplay||!1,f._format=typeof l.format!="string"?l.format:[l.format],f._html5=l.html5||!1,f._muted=l.mute||!1,f._loop=l.loop||!1,f._pool=l.pool||5,f._preload=typeof l.preload!="boolean"&&l.preload!=="metadata"||l.preload,f._rate=l.rate||1,f._sprite=l.sprite||{},f._src=typeof l.src!="string"?l.src:[l.src],f._volume=l.volume!==void 0?l.volume:1,f._xhr={method:l.xhr&&l.xhr.method?l.xhr.method:"GET",headers:l.xhr&&l.xhr.headers?l.xhr.headers:null,withCredentials:!(!l.xhr||!l.xhr.withCredentials)&&l.xhr.withCredentials},f._duration=0,f._state="unloaded",f._sounds=[],f._endTimers={},f._queue=[],f._playLock=!1,f._onend=l.onend?[{fn:l.onend}]:[],f._onfade=l.onfade?[{fn:l.onfade}]:[],f._onload=l.onload?[{fn:l.onload}]:[],f._onloaderror=l.onloaderror?[{fn:l.onloaderror}]:[],f._onplayerror=l.onplayerror?[{fn:l.onplayerror}]:[],f._onpause=l.onpause?[{fn:l.onpause}]:[],f._onplay=l.onplay?[{fn:l.onplay}]:[],f._onstop=l.onstop?[{fn:l.onstop}]:[],f._onmute=l.onmute?[{fn:l.onmute}]:[],f._onvolume=l.onvolume?[{fn:l.onvolume}]:[],f._onrate=l.onrate?[{fn:l.onrate}]:[],f._onseek=l.onseek?[{fn:l.onseek}]:[],f._onunlock=l.onunlock?[{fn:l.onunlock}]:[],f._onresume=[],f._webAudio=e.usingWebAudio&&!f._html5,e.ctx!==void 0&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(f),f._autoplay&&f._queue.push({event:"play",action:function(){f.play()}}),f._preload&&f._preload!=="none"&&f.load(),f},load:function(){var l=this,f=null;if(e.noAudio)return void l._emit("loaderror",null,"No audio support.");typeof l._src=="string"&&(l._src=[l._src]);for(var p=0;p<l._src.length;p++){var y,_;if(l._format&&l._format[p])y=l._format[p];else{if(typeof(_=l._src[p])!="string"){l._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}y=/^data:audio\/([^;,]+);/i.exec(_),y||(y=/\.([^.]+)$/.exec(_.split("?",1)[0])),y&&(y=y[1].toLowerCase())}if(y||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),y&&e.codecs(y)){f=l._src[p];break}}return f?(l._src=f,l._state="loading",window.location.protocol==="https:"&&f.slice(0,5)==="http:"&&(l._html5=!0,l._webAudio=!1),new n(l),l._webAudio&&a(l),l):void l._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(l,f){var p=this,y=null;if(typeof l=="number")y=l,l=null;else{if(typeof l=="string"&&p._state==="loaded"&&!p._sprite[l])return null;if(l===void 0&&(l="__default",!p._playLock)){for(var _=0,v=0;v<p._sounds.length;v++)p._sounds[v]._paused&&!p._sounds[v]._ended&&(_++,y=p._sounds[v]._id);_===1?l=null:y=null}}var w=y?p._soundById(y):p._inactiveSound();if(!w)return null;if(y&&!l&&(l=w._sprite||"__default"),p._state!=="loaded"){w._sprite=l,w._ended=!1;var C=w._id;return p._queue.push({event:"play",action:function(){p.play(C)}}),C}if(y&&!w._paused)return f||p._loadQueue("play"),w._id;p._webAudio&&e._autoResume();var E=Math.max(0,w._seek>0?w._seek:p._sprite[l][0]/1e3),k=Math.max(0,(p._sprite[l][0]+p._sprite[l][1])/1e3-E),G=1e3*k/Math.abs(w._rate),Q=p._sprite[l][0]/1e3,Y=(p._sprite[l][0]+p._sprite[l][1])/1e3;w._sprite=l,w._ended=!1;var it=function(){w._paused=!1,w._seek=E,w._start=Q,w._stop=Y,w._loop=!(!w._loop&&!p._sprite[l][2])};if(E>=Y)return void p._ended(w);var J=w._node;if(p._webAudio){var st=function(){p._playLock=!1,it(),p._refreshBuffer(w);var T=w._muted||p._muted?0:w._volume;J.gain.setValueAtTime(T,e.ctx.currentTime),w._playStart=e.ctx.currentTime,J.bufferSource.start===void 0?w._loop?J.bufferSource.noteGrainOn(0,E,86400):J.bufferSource.noteGrainOn(0,E,k):w._loop?J.bufferSource.start(0,E,86400):J.bufferSource.start(0,E,k),G!==1/0&&(p._endTimers[w._id]=setTimeout(p._ended.bind(p,w),G)),f||setTimeout(function(){p._emit("play",w._id),p._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?st():(p._playLock=!0,p.once("resume",st),p._clearTimer(w._id))}else{var gt=function(){J.currentTime=E,J.muted=w._muted||p._muted||e._muted||J.muted,J.volume=w._volume*e.volume(),J.playbackRate=w._rate;try{var T=J.play();if(T&&typeof Promise<"u"&&(T instanceof Promise||typeof T.then=="function")?(p._playLock=!0,it(),T.then(function(){p._playLock=!1,J._unlocked=!0,f?p._loadQueue():p._emit("play",w._id)}).catch(function(){p._playLock=!1,p._emit("playerror",w._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),w._ended=!0,w._paused=!0})):f||(p._playLock=!1,it(),p._emit("play",w._id)),J.playbackRate=w._rate,J.paused)return void p._emit("playerror",w._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");l!=="__default"||w._loop?p._endTimers[w._id]=setTimeout(p._ended.bind(p,w),G):(p._endTimers[w._id]=function(){p._ended(w),J.removeEventListener("ended",p._endTimers[w._id],!1)},J.addEventListener("ended",p._endTimers[w._id],!1))}catch(ut){p._emit("playerror",w._id,ut)}};J.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(J.src=p._src,J.load());var j=window&&window.ejecta||!J.readyState&&e._navigator.isCocoonJS;if(J.readyState>=3||j)gt();else{p._playLock=!0,p._state="loading";var Z=function(){p._state="loaded",gt(),J.removeEventListener(e._canPlayEvent,Z,!1)};J.addEventListener(e._canPlayEvent,Z,!1),p._clearTimer(w._id)}}return w._id},pause:function(l){var f=this;if(f._state!=="loaded"||f._playLock)return f._queue.push({event:"pause",action:function(){f.pause(l)}}),f;for(var p=f._getSoundIds(l),y=0;y<p.length;y++){f._clearTimer(p[y]);var _=f._soundById(p[y]);if(_&&!_._paused&&(_._seek=f.seek(p[y]),_._rateSeek=0,_._paused=!0,f._stopFade(p[y]),_._node))if(f._webAudio){if(!_._node.bufferSource)continue;_._node.bufferSource.stop===void 0?_._node.bufferSource.noteOff(0):_._node.bufferSource.stop(0),f._cleanBuffer(_._node)}else isNaN(_._node.duration)&&_._node.duration!==1/0||_._node.pause();arguments[1]||f._emit("pause",_?_._id:null)}return f},stop:function(l,f){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(l)}}),p;for(var y=p._getSoundIds(l),_=0;_<y.length;_++){p._clearTimer(y[_]);var v=p._soundById(y[_]);v&&(v._seek=v._start||0,v._rateSeek=0,v._paused=!0,v._ended=!0,p._stopFade(y[_]),v._node&&(p._webAudio?v._node.bufferSource&&(v._node.bufferSource.stop===void 0?v._node.bufferSource.noteOff(0):v._node.bufferSource.stop(0),p._cleanBuffer(v._node)):isNaN(v._node.duration)&&v._node.duration!==1/0||(v._node.currentTime=v._start||0,v._node.pause(),v._node.duration===1/0&&p._clearSound(v._node))),f||p._emit("stop",v._id))}return p},mute:function(l,f){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(l,f)}}),p;if(f===void 0){if(typeof l!="boolean")return p._muted;p._muted=l}for(var y=p._getSoundIds(f),_=0;_<y.length;_++){var v=p._soundById(y[_]);v&&(v._muted=l,v._interval&&p._stopFade(v._id),p._webAudio&&v._node?v._node.gain.setValueAtTime(l?0:v._volume,e.ctx.currentTime):v._node&&(v._node.muted=!!e._muted||l),p._emit("mute",v._id))}return p},volume:function(){var l,f,p=this,y=arguments;if(y.length===0)return p._volume;y.length===1||y.length===2&&y[1]===void 0?p._getSoundIds().indexOf(y[0])>=0?f=parseInt(y[0],10):l=parseFloat(y[0]):y.length>=2&&(l=parseFloat(y[0]),f=parseInt(y[1],10));var _;if(!(l!==void 0&&l>=0&&l<=1))return _=f?p._soundById(f):p._sounds[0],_?_._volume:0;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"volume",action:function(){p.volume.apply(p,y)}}),p;f===void 0&&(p._volume=l),f=p._getSoundIds(f);for(var v=0;v<f.length;v++)(_=p._soundById(f[v]))&&(_._volume=l,y[2]||p._stopFade(f[v]),p._webAudio&&_._node&&!_._muted?_._node.gain.setValueAtTime(l,e.ctx.currentTime):_._node&&!_._muted&&(_._node.volume=l*e.volume()),p._emit("volume",_._id));return p},fade:function(l,f,p,y){var _=this;if(_._state!=="loaded"||_._playLock)return _._queue.push({event:"fade",action:function(){_.fade(l,f,p,y)}}),_;l=Math.min(Math.max(0,parseFloat(l)),1),f=Math.min(Math.max(0,parseFloat(f)),1),p=parseFloat(p),_.volume(l,y);for(var v=_._getSoundIds(y),w=0;w<v.length;w++){var C=_._soundById(v[w]);if(C){if(y||_._stopFade(v[w]),_._webAudio&&!C._muted){var E=e.ctx.currentTime,k=E+p/1e3;C._volume=l,C._node.gain.setValueAtTime(l,E),C._node.gain.linearRampToValueAtTime(f,k)}_._startFadeInterval(C,l,f,p,v[w],y===void 0)}}return _},_startFadeInterval:function(l,f,p,y,_,v){var w=this,C=f,E=p-f,k=Math.abs(E/.01),G=Math.max(4,k>0?y/k:y),Q=Date.now();l._fadeTo=p,l._interval=setInterval(function(){var Y=(Date.now()-Q)/y;Q=Date.now(),C+=E*Y,C=Math.round(100*C)/100,C=E<0?Math.max(p,C):Math.min(p,C),w._webAudio?l._volume=C:w.volume(C,l._id,!0),v&&(w._volume=C),(p<f&&C<=p||p>f&&C>=p)&&(clearInterval(l._interval),l._interval=null,l._fadeTo=null,w.volume(p,l._id),w._emit("fade",l._id))},G)},_stopFade:function(l){var f=this,p=f._soundById(l);return p&&p._interval&&(f._webAudio&&p._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(p._interval),p._interval=null,f.volume(p._fadeTo,l),p._fadeTo=null,f._emit("fade",l)),f},loop:function(){var l,f,p,y=this,_=arguments;if(_.length===0)return y._loop;if(_.length===1){if(typeof _[0]!="boolean")return!!(p=y._soundById(parseInt(_[0],10)))&&p._loop;l=_[0],y._loop=l}else _.length===2&&(l=_[0],f=parseInt(_[1],10));for(var v=y._getSoundIds(f),w=0;w<v.length;w++)(p=y._soundById(v[w]))&&(p._loop=l,y._webAudio&&p._node&&p._node.bufferSource&&(p._node.bufferSource.loop=l,l&&(p._node.bufferSource.loopStart=p._start||0,p._node.bufferSource.loopEnd=p._stop,y.playing(v[w])&&(y.pause(v[w],!0),y.play(v[w],!0)))));return y},rate:function(){var l,f,p=this,y=arguments;if(y.length===0)f=p._sounds[0]._id;else if(y.length===1){var _=p._getSoundIds(),v=_.indexOf(y[0]);v>=0?f=parseInt(y[0],10):l=parseFloat(y[0])}else y.length===2&&(l=parseFloat(y[0]),f=parseInt(y[1],10));var w;if(typeof l!="number")return w=p._soundById(f),w?w._rate:p._rate;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"rate",action:function(){p.rate.apply(p,y)}}),p;f===void 0&&(p._rate=l),f=p._getSoundIds(f);for(var C=0;C<f.length;C++)if(w=p._soundById(f[C])){p.playing(f[C])&&(w._rateSeek=p.seek(f[C]),w._playStart=p._webAudio?e.ctx.currentTime:w._playStart),w._rate=l,p._webAudio&&w._node&&w._node.bufferSource?w._node.bufferSource.playbackRate.setValueAtTime(l,e.ctx.currentTime):w._node&&(w._node.playbackRate=l);var E=p.seek(f[C]),k=(p._sprite[w._sprite][0]+p._sprite[w._sprite][1])/1e3-E,G=1e3*k/Math.abs(w._rate);!p._endTimers[f[C]]&&w._paused||(p._clearTimer(f[C]),p._endTimers[f[C]]=setTimeout(p._ended.bind(p,w),G)),p._emit("rate",w._id)}return p},seek:function(){var l,f,p=this,y=arguments;if(y.length===0)p._sounds.length&&(f=p._sounds[0]._id);else if(y.length===1){var _=p._getSoundIds(),v=_.indexOf(y[0]);v>=0?f=parseInt(y[0],10):p._sounds.length&&(f=p._sounds[0]._id,l=parseFloat(y[0]))}else y.length===2&&(l=parseFloat(y[0]),f=parseInt(y[1],10));if(f===void 0)return 0;if(typeof l=="number"&&(p._state!=="loaded"||p._playLock))return p._queue.push({event:"seek",action:function(){p.seek.apply(p,y)}}),p;var w=p._soundById(f);if(w){if(!(typeof l=="number"&&l>=0)){if(p._webAudio){var C=p.playing(f)?e.ctx.currentTime-w._playStart:0,E=w._rateSeek?w._rateSeek-w._seek:0;return w._seek+(E+C*Math.abs(w._rate))}return w._node.currentTime}var k=p.playing(f);k&&p.pause(f,!0),w._seek=l,w._ended=!1,p._clearTimer(f),p._webAudio||!w._node||isNaN(w._node.duration)||(w._node.currentTime=l);var G=function(){k&&p.play(f,!0),p._emit("seek",f)};if(k&&!p._webAudio){var Q=function(){p._playLock?setTimeout(Q,0):G()};setTimeout(Q,0)}else G()}return p},playing:function(l){var f=this;if(typeof l=="number"){var p=f._soundById(l);return!!p&&!p._paused}for(var y=0;y<f._sounds.length;y++)if(!f._sounds[y]._paused)return!0;return!1},duration:function(l){var f=this,p=f._duration,y=f._soundById(l);return y&&(p=f._sprite[y._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var l=this,f=l._sounds,p=0;p<f.length;p++)f[p]._paused||l.stop(f[p]._id),l._webAudio||(l._clearSound(f[p]._node),f[p]._node.removeEventListener("error",f[p]._errorFn,!1),f[p]._node.removeEventListener(e._canPlayEvent,f[p]._loadFn,!1),f[p]._node.removeEventListener("ended",f[p]._endFn,!1),e._releaseHtml5Audio(f[p]._node)),delete f[p]._node,l._clearTimer(f[p]._id);var y=e._howls.indexOf(l);y>=0&&e._howls.splice(y,1);var _=!0;for(p=0;p<e._howls.length;p++)if(e._howls[p]._src===l._src||l._src.indexOf(e._howls[p]._src)>=0){_=!1;break}return s&&_&&delete s[l._src],e.noAudio=!1,l._state="unloaded",l._sounds=[],l=null,null},on:function(l,f,p,y){var _=this,v=_["_on"+l];return typeof f=="function"&&v.push(y?{id:p,fn:f,once:y}:{id:p,fn:f}),_},off:function(l,f,p){var y=this,_=y["_on"+l],v=0;if(typeof f=="number"&&(p=f,f=null),f||p)for(v=0;v<_.length;v++){var w=p===_[v].id;if(f===_[v].fn&&w||!f&&w){_.splice(v,1);break}}else if(l)y["_on"+l]=[];else{var C=Object.keys(y);for(v=0;v<C.length;v++)C[v].indexOf("_on")===0&&Array.isArray(y[C[v]])&&(y[C[v]]=[])}return y},once:function(l,f,p){var y=this;return y.on(l,f,p,1),y},_emit:function(l,f,p){for(var y=this,_=y["_on"+l],v=_.length-1;v>=0;v--)_[v].id&&_[v].id!==f&&l!=="load"||(setTimeout(function(w){w.call(this,f,p)}.bind(y,_[v].fn),0),_[v].once&&y.off(l,_[v].fn,_[v].id));return y._loadQueue(l),y},_loadQueue:function(l){var f=this;if(f._queue.length>0){var p=f._queue[0];p.event===l&&(f._queue.shift(),f._loadQueue()),l||p.action()}return f},_ended:function(l){var f=this,p=l._sprite;if(!f._webAudio&&l._node&&!l._node.paused&&!l._node.ended&&l._node.currentTime<l._stop)return setTimeout(f._ended.bind(f,l),100),f;var y=!(!l._loop&&!f._sprite[p][2]);if(f._emit("end",l._id),!f._webAudio&&y&&f.stop(l._id,!0).play(l._id),f._webAudio&&y){f._emit("play",l._id),l._seek=l._start||0,l._rateSeek=0,l._playStart=e.ctx.currentTime;var _=1e3*(l._stop-l._start)/Math.abs(l._rate);f._endTimers[l._id]=setTimeout(f._ended.bind(f,l),_)}return f._webAudio&&!y&&(l._paused=!0,l._ended=!0,l._seek=l._start||0,l._rateSeek=0,f._clearTimer(l._id),f._cleanBuffer(l._node),e._autoSuspend()),f._webAudio||y||f.stop(l._id,!0),f},_clearTimer:function(l){var f=this;if(f._endTimers[l]){if(typeof f._endTimers[l]!="function")clearTimeout(f._endTimers[l]);else{var p=f._soundById(l);p&&p._node&&p._node.removeEventListener("ended",f._endTimers[l],!1)}delete f._endTimers[l]}return f},_soundById:function(l){for(var f=this,p=0;p<f._sounds.length;p++)if(l===f._sounds[p]._id)return f._sounds[p];return null},_inactiveSound:function(){var l=this;l._drain();for(var f=0;f<l._sounds.length;f++)if(l._sounds[f]._ended)return l._sounds[f].reset();return new n(l)},_drain:function(){var l=this,f=l._pool,p=0,y=0;if(!(l._sounds.length<f)){for(y=0;y<l._sounds.length;y++)l._sounds[y]._ended&&p++;for(y=l._sounds.length-1;y>=0;y--){if(p<=f)return;l._sounds[y]._ended&&(l._webAudio&&l._sounds[y]._node&&l._sounds[y]._node.disconnect(0),l._sounds.splice(y,1),p--)}}},_getSoundIds:function(l){var f=this;if(l===void 0){for(var p=[],y=0;y<f._sounds.length;y++)p.push(f._sounds[y]._id);return p}return[l]},_refreshBuffer:function(l){var f=this;return l._node.bufferSource=e.ctx.createBufferSource(),l._node.bufferSource.buffer=s[f._src],l._panner?l._node.bufferSource.connect(l._panner):l._node.bufferSource.connect(l._node),l._node.bufferSource.loop=l._loop,l._loop&&(l._node.bufferSource.loopStart=l._start||0,l._node.bufferSource.loopEnd=l._stop||0),l._node.bufferSource.playbackRate.setValueAtTime(l._rate,e.ctx.currentTime),f},_cleanBuffer:function(l){var f=this,p=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&l.bufferSource&&(l.bufferSource.onended=null,l.bufferSource.disconnect(0),p))try{l.bufferSource.buffer=e._scratchBuffer}catch{}return l.bufferSource=null,f},_clearSound:function(l){/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent)||(l.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var n=function(l){this._parent=l,this.init()};n.prototype={init:function(){var l=this,f=l._parent;return l._muted=f._muted,l._loop=f._loop,l._volume=f._volume,l._rate=f._rate,l._seek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++e._counter,f._sounds.push(l),l.create(),l},create:function(){var l=this,f=l._parent,p=e._muted||l._muted||l._parent._muted?0:l._volume;return f._webAudio?(l._node=e.ctx.createGain===void 0?e.ctx.createGainNode():e.ctx.createGain(),l._node.gain.setValueAtTime(p,e.ctx.currentTime),l._node.paused=!0,l._node.connect(e.masterGain)):e.noAudio||(l._node=e._obtainHtml5Audio(),l._errorFn=l._errorListener.bind(l),l._node.addEventListener("error",l._errorFn,!1),l._loadFn=l._loadListener.bind(l),l._node.addEventListener(e._canPlayEvent,l._loadFn,!1),l._endFn=l._endListener.bind(l),l._node.addEventListener("ended",l._endFn,!1),l._node.src=f._src,l._node.preload=f._preload===!0?"auto":f._preload,l._node.volume=p*e.volume(),l._node.load()),l},reset:function(){var l=this,f=l._parent;return l._muted=f._muted,l._loop=f._loop,l._volume=f._volume,l._rate=f._rate,l._seek=0,l._rateSeek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++e._counter,l},_errorListener:function(){var l=this;l._parent._emit("loaderror",l._id,l._node.error?l._node.error.code:0),l._node.removeEventListener("error",l._errorFn,!1)},_loadListener:function(){var l=this,f=l._parent;f._duration=Math.ceil(10*l._node.duration)/10,Object.keys(f._sprite).length===0&&(f._sprite={__default:[0,1e3*f._duration]}),f._state!=="loaded"&&(f._state="loaded",f._emit("load"),f._loadQueue()),l._node.removeEventListener(e._canPlayEvent,l._loadFn,!1)},_endListener:function(){var l=this,f=l._parent;f._duration===1/0&&(f._duration=Math.ceil(10*l._node.duration)/10,f._sprite.__default[1]===1/0&&(f._sprite.__default[1]=1e3*f._duration),f._ended(l)),l._node.removeEventListener("ended",l._endFn,!1)}};var s={},a=function(l){var f=l._src;if(s[f])return l._duration=s[f].duration,void d(l);if(/^data:[^;]+;base64,/.test(f)){for(var p=atob(f.split(",")[1]),y=new Uint8Array(p.length),_=0;_<p.length;++_)y[_]=p.charCodeAt(_);u(y.buffer,l)}else{var v=new XMLHttpRequest;v.open(l._xhr.method,f,!0),v.withCredentials=l._xhr.withCredentials,v.responseType="arraybuffer",l._xhr.headers&&Object.keys(l._xhr.headers).forEach(function(w){v.setRequestHeader(w,l._xhr.headers[w])}),v.onload=function(){var w=(v.status+"")[0];if(w!=="0"&&w!=="2"&&w!=="3")return void l._emit("loaderror",null,"Failed loading audio file with status: "+v.status+".");u(v.response,l)},v.onerror=function(){l._webAudio&&(l._html5=!0,l._webAudio=!1,l._sounds=[],delete s[f],l.load())},h(v)}},h=function(l){try{l.send()}catch{l.onerror()}},u=function(l,f){var p=function(){f._emit("loaderror",null,"Decoding audio data failed.")},y=function(_){_&&f._sounds.length>0?(s[f._src]=_,d(f,_)):p()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(l).then(y).catch(p):e.ctx.decodeAudioData(l,y,p)},d=function(l,f){f&&!l._duration&&(l._duration=f.duration),Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,1e3*l._duration]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue())},m=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var l=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),f=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=f?parseInt(f[1],10):null;if(l&&p&&p<9){var y=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!y&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=e.ctx.createGain===void 0?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};i.Howler=e,i.Howl=r,typeof si<"u"?(si.HowlerGlobal=t,si.Howler=e,si.Howl=r,si.Sound=n):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=r,window.Sound=n)})()})(yh);const Uc=[".aac",".mid",".midi",".mp3",".oga",".ogg",".opus",".wav",".webm",".weba",".flac",".aiff"],Hy=[".bmp",".gif",".jpeg",".jpg",".png",".tif",".tiff",".webp"];function eB(i){return i.hold==null}function ke(i){return i.hold!=null}var Mf={},Hc={};Hc.byteLength=nB;Hc.toByteArray=aB;Hc.fromByteArray=lB;var vn=[],Wr=[],iB=typeof Uint8Array<"u"?Uint8Array:Array,Cd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ja=0,rB=Cd.length;Ja<rB;++Ja)vn[Ja]=Cd[Ja],Wr[Cd.charCodeAt(Ja)]=Ja;Wr["-".charCodeAt(0)]=62;Wr["_".charCodeAt(0)]=63;function Gy(i){var t=i.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=i.indexOf("=");e===-1&&(e=t);var r=e===t?0:4-e%4;return[e,r]}function nB(i){var t=Gy(i),e=t[0],r=t[1];return(e+r)*3/4-r}function sB(i,t,e){return(t+e)*3/4-e}function aB(i){var t,e=Gy(i),r=e[0],n=e[1],s=new iB(sB(i,r,n)),a=0,h=n>0?r-4:r,u;for(u=0;u<h;u+=4)t=Wr[i.charCodeAt(u)]<<18|Wr[i.charCodeAt(u+1)]<<12|Wr[i.charCodeAt(u+2)]<<6|Wr[i.charCodeAt(u+3)],s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=t&255;return n===2&&(t=Wr[i.charCodeAt(u)]<<2|Wr[i.charCodeAt(u+1)]>>4,s[a++]=t&255),n===1&&(t=Wr[i.charCodeAt(u)]<<10|Wr[i.charCodeAt(u+1)]<<4|Wr[i.charCodeAt(u+2)]>>2,s[a++]=t>>8&255,s[a++]=t&255),s}function oB(i){return vn[i>>18&63]+vn[i>>12&63]+vn[i>>6&63]+vn[i&63]}function hB(i,t,e){for(var r,n=[],s=t;s<e;s+=3)r=(i[s]<<16&16711680)+(i[s+1]<<8&65280)+(i[s+2]&255),n.push(oB(r));return n.join("")}function lB(i){for(var t,e=i.length,r=e%3,n=[],s=16383,a=0,h=e-r;a<h;a+=s)n.push(hB(i,a,a+s>h?h:a+s));return r===1?(t=i[e-1],n.push(vn[t>>2]+vn[t<<4&63]+"==")):r===2&&(t=(i[e-2]<<8)+i[e-1],n.push(vn[t>>10]+vn[t>>4&63]+vn[t<<2&63]+"=")),n.join("")}var If={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */If.read=function(i,t,e,r,n){var s,a,h=n*8-r-1,u=(1<<h)-1,d=u>>1,m=-7,l=e?n-1:0,f=e?-1:1,p=i[t+l];for(l+=f,s=p&(1<<-m)-1,p>>=-m,m+=h;m>0;s=s*256+i[t+l],l+=f,m-=8);for(a=s&(1<<-m)-1,s>>=-m,m+=r;m>0;a=a*256+i[t+l],l+=f,m-=8);if(s===0)s=1-d;else{if(s===u)return a?NaN:(p?-1:1)*(1/0);a=a+Math.pow(2,r),s=s-d}return(p?-1:1)*a*Math.pow(2,s-r)};If.write=function(i,t,e,r,n,s){var a,h,u,d=s*8-n-1,m=(1<<d)-1,l=m>>1,f=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,y=r?1:-1,_=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(h=isNaN(t)?1:0,a=m):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),a+l>=1?t+=f/u:t+=f*Math.pow(2,1-l),t*u>=2&&(a++,u/=2),a+l>=m?(h=0,a=m):a+l>=1?(h=(t*u-1)*Math.pow(2,n),a=a+l):(h=t*Math.pow(2,l-1)*Math.pow(2,n),a=0));n>=8;i[e+p]=h&255,p+=y,h/=256,n-=8);for(a=a<<n|h,d+=n;d>0;i[e+p]=a&255,p+=y,a/=256,d-=8);i[e+p-y]|=_*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(i){const t=Hc,e=If,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;i.Buffer=h,i.SlowBuffer=C,i.INSPECT_MAX_BYTES=50;const n=2147483647;i.kMaxLength=n,h.TYPED_ARRAY_SUPPORT=s(),!h.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const D=new Uint8Array(1),b={foo:function(){return 42}};return Object.setPrototypeOf(b,Uint8Array.prototype),Object.setPrototypeOf(D,b),D.foo()===42}catch{return!1}}Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(!!h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(!!h.isBuffer(this))return this.byteOffset}});function a(D){if(D>n)throw new RangeError('The value "'+D+'" is invalid for option "size"');const b=new Uint8Array(D);return Object.setPrototypeOf(b,h.prototype),b}function h(D,b,A){if(typeof D=="number"){if(typeof b=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return l(D)}return u(D,b,A)}h.poolSize=8192;function u(D,b,A){if(typeof D=="string")return f(D,b);if(ArrayBuffer.isView(D))return y(D);if(D==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D);if(at(D,ArrayBuffer)||D&&at(D.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(at(D,SharedArrayBuffer)||D&&at(D.buffer,SharedArrayBuffer)))return _(D,b,A);if(typeof D=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const W=D.valueOf&&D.valueOf();if(W!=null&&W!==D)return h.from(W,b,A);const rt=v(D);if(rt)return rt;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof D[Symbol.toPrimitive]=="function")return h.from(D[Symbol.toPrimitive]("string"),b,A);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof D)}h.from=function(D,b,A){return u(D,b,A)},Object.setPrototypeOf(h.prototype,Uint8Array.prototype),Object.setPrototypeOf(h,Uint8Array);function d(D){if(typeof D!="number")throw new TypeError('"size" argument must be of type number');if(D<0)throw new RangeError('The value "'+D+'" is invalid for option "size"')}function m(D,b,A){return d(D),D<=0?a(D):b!==void 0?typeof A=="string"?a(D).fill(b,A):a(D).fill(b):a(D)}h.alloc=function(D,b,A){return m(D,b,A)};function l(D){return d(D),a(D<0?0:w(D)|0)}h.allocUnsafe=function(D){return l(D)},h.allocUnsafeSlow=function(D){return l(D)};function f(D,b){if((typeof b!="string"||b==="")&&(b="utf8"),!h.isEncoding(b))throw new TypeError("Unknown encoding: "+b);const A=E(D,b)|0;let W=a(A);const rt=W.write(D,b);return rt!==A&&(W=W.slice(0,rt)),W}function p(D){const b=D.length<0?0:w(D.length)|0,A=a(b);for(let W=0;W<b;W+=1)A[W]=D[W]&255;return A}function y(D){if(at(D,Uint8Array)){const b=new Uint8Array(D);return _(b.buffer,b.byteOffset,b.byteLength)}return p(D)}function _(D,b,A){if(b<0||D.byteLength<b)throw new RangeError('"offset" is outside of buffer bounds');if(D.byteLength<b+(A||0))throw new RangeError('"length" is outside of buffer bounds');let W;return b===void 0&&A===void 0?W=new Uint8Array(D):A===void 0?W=new Uint8Array(D,b):W=new Uint8Array(D,b,A),Object.setPrototypeOf(W,h.prototype),W}function v(D){if(h.isBuffer(D)){const b=w(D.length)|0,A=a(b);return A.length===0||D.copy(A,0,0,b),A}if(D.length!==void 0)return typeof D.length!="number"||Nt(D.length)?a(0):p(D);if(D.type==="Buffer"&&Array.isArray(D.data))return p(D.data)}function w(D){if(D>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return D|0}function C(D){return+D!=D&&(D=0),h.alloc(+D)}h.isBuffer=function(b){return b!=null&&b._isBuffer===!0&&b!==h.prototype},h.compare=function(b,A){if(at(b,Uint8Array)&&(b=h.from(b,b.offset,b.byteLength)),at(A,Uint8Array)&&(A=h.from(A,A.offset,A.byteLength)),!h.isBuffer(b)||!h.isBuffer(A))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(b===A)return 0;let W=b.length,rt=A.length;for(let I=0,N=Math.min(W,rt);I<N;++I)if(b[I]!==A[I]){W=b[I],rt=A[I];break}return W<rt?-1:rt<W?1:0},h.isEncoding=function(b){switch(String(b).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(b,A){if(!Array.isArray(b))throw new TypeError('"list" argument must be an Array of Buffers');if(b.length===0)return h.alloc(0);let W;if(A===void 0)for(A=0,W=0;W<b.length;++W)A+=b[W].length;const rt=h.allocUnsafe(A);let I=0;for(W=0;W<b.length;++W){let N=b[W];if(at(N,Uint8Array))I+N.length>rt.length?(h.isBuffer(N)||(N=h.from(N)),N.copy(rt,I)):Uint8Array.prototype.set.call(rt,N,I);else if(h.isBuffer(N))N.copy(rt,I);else throw new TypeError('"list" argument must be an Array of Buffers');I+=N.length}return rt};function E(D,b){if(h.isBuffer(D))return D.length;if(ArrayBuffer.isView(D)||at(D,ArrayBuffer))return D.byteLength;if(typeof D!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof D);const A=D.length,W=arguments.length>2&&arguments[2]===!0;if(!W&&A===0)return 0;let rt=!1;for(;;)switch(b){case"ascii":case"latin1":case"binary":return A;case"utf8":case"utf-8":return X(D).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A*2;case"hex":return A>>>1;case"base64":return Et(D).length;default:if(rt)return W?-1:X(D).length;b=(""+b).toLowerCase(),rt=!0}}h.byteLength=E;function k(D,b,A){let W=!1;if((b===void 0||b<0)&&(b=0),b>this.length||((A===void 0||A>this.length)&&(A=this.length),A<=0)||(A>>>=0,b>>>=0,A<=b))return"";for(D||(D="utf8");;)switch(D){case"hex":return bt(this,b,A);case"utf8":case"utf-8":return T(this,b,A);case"ascii":return pt(this,b,A);case"latin1":case"binary":return Gt(this,b,A);case"base64":return Z(this,b,A);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return xt(this,b,A);default:if(W)throw new TypeError("Unknown encoding: "+D);D=(D+"").toLowerCase(),W=!0}}h.prototype._isBuffer=!0;function G(D,b,A){const W=D[b];D[b]=D[A],D[A]=W}h.prototype.swap16=function(){const b=this.length;if(b%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let A=0;A<b;A+=2)G(this,A,A+1);return this},h.prototype.swap32=function(){const b=this.length;if(b%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let A=0;A<b;A+=4)G(this,A,A+3),G(this,A+1,A+2);return this},h.prototype.swap64=function(){const b=this.length;if(b%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let A=0;A<b;A+=8)G(this,A,A+7),G(this,A+1,A+6),G(this,A+2,A+5),G(this,A+3,A+4);return this},h.prototype.toString=function(){const b=this.length;return b===0?"":arguments.length===0?T(this,0,b):k.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(b){if(!h.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:h.compare(this,b)===0},h.prototype.inspect=function(){let b="";const A=i.INSPECT_MAX_BYTES;return b=this.toString("hex",0,A).replace(/(.{2})/g,"$1 ").trim(),this.length>A&&(b+=" ... "),"<Buffer "+b+">"},r&&(h.prototype[r]=h.prototype.inspect),h.prototype.compare=function(b,A,W,rt,I){if(at(b,Uint8Array)&&(b=h.from(b,b.offset,b.byteLength)),!h.isBuffer(b))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof b);if(A===void 0&&(A=0),W===void 0&&(W=b?b.length:0),rt===void 0&&(rt=0),I===void 0&&(I=this.length),A<0||W>b.length||rt<0||I>this.length)throw new RangeError("out of range index");if(rt>=I&&A>=W)return 0;if(rt>=I)return-1;if(A>=W)return 1;if(A>>>=0,W>>>=0,rt>>>=0,I>>>=0,this===b)return 0;let N=I-rt,mt=W-A;const yt=Math.min(N,mt),Ct=this.slice(rt,I),Wt=b.slice(A,W);for(let Vt=0;Vt<yt;++Vt)if(Ct[Vt]!==Wt[Vt]){N=Ct[Vt],mt=Wt[Vt];break}return N<mt?-1:mt<N?1:0};function Q(D,b,A,W,rt){if(D.length===0)return-1;if(typeof A=="string"?(W=A,A=0):A>2147483647?A=2147483647:A<-2147483648&&(A=-2147483648),A=+A,Nt(A)&&(A=rt?0:D.length-1),A<0&&(A=D.length+A),A>=D.length){if(rt)return-1;A=D.length-1}else if(A<0)if(rt)A=0;else return-1;if(typeof b=="string"&&(b=h.from(b,W)),h.isBuffer(b))return b.length===0?-1:Y(D,b,A,W,rt);if(typeof b=="number")return b=b&255,typeof Uint8Array.prototype.indexOf=="function"?rt?Uint8Array.prototype.indexOf.call(D,b,A):Uint8Array.prototype.lastIndexOf.call(D,b,A):Y(D,[b],A,W,rt);throw new TypeError("val must be string, number or Buffer")}function Y(D,b,A,W,rt){let I=1,N=D.length,mt=b.length;if(W!==void 0&&(W=String(W).toLowerCase(),W==="ucs2"||W==="ucs-2"||W==="utf16le"||W==="utf-16le")){if(D.length<2||b.length<2)return-1;I=2,N/=2,mt/=2,A/=2}function yt(Wt,Vt){return I===1?Wt[Vt]:Wt.readUInt16BE(Vt*I)}let Ct;if(rt){let Wt=-1;for(Ct=A;Ct<N;Ct++)if(yt(D,Ct)===yt(b,Wt===-1?0:Ct-Wt)){if(Wt===-1&&(Wt=Ct),Ct-Wt+1===mt)return Wt*I}else Wt!==-1&&(Ct-=Ct-Wt),Wt=-1}else for(A+mt>N&&(A=N-mt),Ct=A;Ct>=0;Ct--){let Wt=!0;for(let Vt=0;Vt<mt;Vt++)if(yt(D,Ct+Vt)!==yt(b,Vt)){Wt=!1;break}if(Wt)return Ct}return-1}h.prototype.includes=function(b,A,W){return this.indexOf(b,A,W)!==-1},h.prototype.indexOf=function(b,A,W){return Q(this,b,A,W,!0)},h.prototype.lastIndexOf=function(b,A,W){return Q(this,b,A,W,!1)};function it(D,b,A,W){A=Number(A)||0;const rt=D.length-A;W?(W=Number(W),W>rt&&(W=rt)):W=rt;const I=b.length;W>I/2&&(W=I/2);let N;for(N=0;N<W;++N){const mt=parseInt(b.substr(N*2,2),16);if(Nt(mt))return N;D[A+N]=mt}return N}function J(D,b,A,W){return Tt(X(b,D.length-A),D,A,W)}function st(D,b,A,W){return Tt(V(b),D,A,W)}function gt(D,b,A,W){return Tt(Et(b),D,A,W)}function j(D,b,A,W){return Tt(lt(b,D.length-A),D,A,W)}h.prototype.write=function(b,A,W,rt){if(A===void 0)rt="utf8",W=this.length,A=0;else if(W===void 0&&typeof A=="string")rt=A,W=this.length,A=0;else if(isFinite(A))A=A>>>0,isFinite(W)?(W=W>>>0,rt===void 0&&(rt="utf8")):(rt=W,W=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const I=this.length-A;if((W===void 0||W>I)&&(W=I),b.length>0&&(W<0||A<0)||A>this.length)throw new RangeError("Attempt to write outside buffer bounds");rt||(rt="utf8");let N=!1;for(;;)switch(rt){case"hex":return it(this,b,A,W);case"utf8":case"utf-8":return J(this,b,A,W);case"ascii":case"latin1":case"binary":return st(this,b,A,W);case"base64":return gt(this,b,A,W);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,b,A,W);default:if(N)throw new TypeError("Unknown encoding: "+rt);rt=(""+rt).toLowerCase(),N=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(D,b,A){return b===0&&A===D.length?t.fromByteArray(D):t.fromByteArray(D.slice(b,A))}function T(D,b,A){A=Math.min(D.length,A);const W=[];let rt=b;for(;rt<A;){const I=D[rt];let N=null,mt=I>239?4:I>223?3:I>191?2:1;if(rt+mt<=A){let yt,Ct,Wt,Vt;switch(mt){case 1:I<128&&(N=I);break;case 2:yt=D[rt+1],(yt&192)===128&&(Vt=(I&31)<<6|yt&63,Vt>127&&(N=Vt));break;case 3:yt=D[rt+1],Ct=D[rt+2],(yt&192)===128&&(Ct&192)===128&&(Vt=(I&15)<<12|(yt&63)<<6|Ct&63,Vt>2047&&(Vt<55296||Vt>57343)&&(N=Vt));break;case 4:yt=D[rt+1],Ct=D[rt+2],Wt=D[rt+3],(yt&192)===128&&(Ct&192)===128&&(Wt&192)===128&&(Vt=(I&15)<<18|(yt&63)<<12|(Ct&63)<<6|Wt&63,Vt>65535&&Vt<1114112&&(N=Vt))}}N===null?(N=65533,mt=1):N>65535&&(N-=65536,W.push(N>>>10&1023|55296),N=56320|N&1023),W.push(N),rt+=mt}return Pt(W)}const ut=4096;function Pt(D){const b=D.length;if(b<=ut)return String.fromCharCode.apply(String,D);let A="",W=0;for(;W<b;)A+=String.fromCharCode.apply(String,D.slice(W,W+=ut));return A}function pt(D,b,A){let W="";A=Math.min(D.length,A);for(let rt=b;rt<A;++rt)W+=String.fromCharCode(D[rt]&127);return W}function Gt(D,b,A){let W="";A=Math.min(D.length,A);for(let rt=b;rt<A;++rt)W+=String.fromCharCode(D[rt]);return W}function bt(D,b,A){const W=D.length;(!b||b<0)&&(b=0),(!A||A<0||A>W)&&(A=W);let rt="";for(let I=b;I<A;++I)rt+=Kt[D[I]];return rt}function xt(D,b,A){const W=D.slice(b,A);let rt="";for(let I=0;I<W.length-1;I+=2)rt+=String.fromCharCode(W[I]+W[I+1]*256);return rt}h.prototype.slice=function(b,A){const W=this.length;b=~~b,A=A===void 0?W:~~A,b<0?(b+=W,b<0&&(b=0)):b>W&&(b=W),A<0?(A+=W,A<0&&(A=0)):A>W&&(A=W),A<b&&(A=b);const rt=this.subarray(b,A);return Object.setPrototypeOf(rt,h.prototype),rt};function tt(D,b,A){if(D%1!==0||D<0)throw new RangeError("offset is not uint");if(D+b>A)throw new RangeError("Trying to access beyond buffer length")}h.prototype.readUintLE=h.prototype.readUIntLE=function(b,A,W){b=b>>>0,A=A>>>0,W||tt(b,A,this.length);let rt=this[b],I=1,N=0;for(;++N<A&&(I*=256);)rt+=this[b+N]*I;return rt},h.prototype.readUintBE=h.prototype.readUIntBE=function(b,A,W){b=b>>>0,A=A>>>0,W||tt(b,A,this.length);let rt=this[b+--A],I=1;for(;A>0&&(I*=256);)rt+=this[b+--A]*I;return rt},h.prototype.readUint8=h.prototype.readUInt8=function(b,A){return b=b>>>0,A||tt(b,1,this.length),this[b]},h.prototype.readUint16LE=h.prototype.readUInt16LE=function(b,A){return b=b>>>0,A||tt(b,2,this.length),this[b]|this[b+1]<<8},h.prototype.readUint16BE=h.prototype.readUInt16BE=function(b,A){return b=b>>>0,A||tt(b,2,this.length),this[b]<<8|this[b+1]},h.prototype.readUint32LE=h.prototype.readUInt32LE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),(this[b]|this[b+1]<<8|this[b+2]<<16)+this[b+3]*16777216},h.prototype.readUint32BE=h.prototype.readUInt32BE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),this[b]*16777216+(this[b+1]<<16|this[b+2]<<8|this[b+3])},h.prototype.readBigUInt64LE=Lt(function(b){b=b>>>0,fe(b,"offset");const A=this[b],W=this[b+7];(A===void 0||W===void 0)&&S(b,this.length-8);const rt=A+this[++b]*2**8+this[++b]*2**16+this[++b]*2**24,I=this[++b]+this[++b]*2**8+this[++b]*2**16+W*2**24;return BigInt(rt)+(BigInt(I)<<BigInt(32))}),h.prototype.readBigUInt64BE=Lt(function(b){b=b>>>0,fe(b,"offset");const A=this[b],W=this[b+7];(A===void 0||W===void 0)&&S(b,this.length-8);const rt=A*2**24+this[++b]*2**16+this[++b]*2**8+this[++b],I=this[++b]*2**24+this[++b]*2**16+this[++b]*2**8+W;return(BigInt(rt)<<BigInt(32))+BigInt(I)}),h.prototype.readIntLE=function(b,A,W){b=b>>>0,A=A>>>0,W||tt(b,A,this.length);let rt=this[b],I=1,N=0;for(;++N<A&&(I*=256);)rt+=this[b+N]*I;return I*=128,rt>=I&&(rt-=Math.pow(2,8*A)),rt},h.prototype.readIntBE=function(b,A,W){b=b>>>0,A=A>>>0,W||tt(b,A,this.length);let rt=A,I=1,N=this[b+--rt];for(;rt>0&&(I*=256);)N+=this[b+--rt]*I;return I*=128,N>=I&&(N-=Math.pow(2,8*A)),N},h.prototype.readInt8=function(b,A){return b=b>>>0,A||tt(b,1,this.length),this[b]&128?(255-this[b]+1)*-1:this[b]},h.prototype.readInt16LE=function(b,A){b=b>>>0,A||tt(b,2,this.length);const W=this[b]|this[b+1]<<8;return W&32768?W|4294901760:W},h.prototype.readInt16BE=function(b,A){b=b>>>0,A||tt(b,2,this.length);const W=this[b+1]|this[b]<<8;return W&32768?W|4294901760:W},h.prototype.readInt32LE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),this[b]|this[b+1]<<8|this[b+2]<<16|this[b+3]<<24},h.prototype.readInt32BE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),this[b]<<24|this[b+1]<<16|this[b+2]<<8|this[b+3]},h.prototype.readBigInt64LE=Lt(function(b){b=b>>>0,fe(b,"offset");const A=this[b],W=this[b+7];(A===void 0||W===void 0)&&S(b,this.length-8);const rt=this[b+4]+this[b+5]*2**8+this[b+6]*2**16+(W<<24);return(BigInt(rt)<<BigInt(32))+BigInt(A+this[++b]*2**8+this[++b]*2**16+this[++b]*2**24)}),h.prototype.readBigInt64BE=Lt(function(b){b=b>>>0,fe(b,"offset");const A=this[b],W=this[b+7];(A===void 0||W===void 0)&&S(b,this.length-8);const rt=(A<<24)+this[++b]*2**16+this[++b]*2**8+this[++b];return(BigInt(rt)<<BigInt(32))+BigInt(this[++b]*2**24+this[++b]*2**16+this[++b]*2**8+W)}),h.prototype.readFloatLE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),e.read(this,b,!0,23,4)},h.prototype.readFloatBE=function(b,A){return b=b>>>0,A||tt(b,4,this.length),e.read(this,b,!1,23,4)},h.prototype.readDoubleLE=function(b,A){return b=b>>>0,A||tt(b,8,this.length),e.read(this,b,!0,52,8)},h.prototype.readDoubleBE=function(b,A){return b=b>>>0,A||tt(b,8,this.length),e.read(this,b,!1,52,8)};function et(D,b,A,W,rt,I){if(!h.isBuffer(D))throw new TypeError('"buffer" argument must be a Buffer instance');if(b>rt||b<I)throw new RangeError('"value" argument is out of bounds');if(A+W>D.length)throw new RangeError("Index out of range")}h.prototype.writeUintLE=h.prototype.writeUIntLE=function(b,A,W,rt){if(b=+b,A=A>>>0,W=W>>>0,!rt){const mt=Math.pow(2,8*W)-1;et(this,b,A,W,mt,0)}let I=1,N=0;for(this[A]=b&255;++N<W&&(I*=256);)this[A+N]=b/I&255;return A+W},h.prototype.writeUintBE=h.prototype.writeUIntBE=function(b,A,W,rt){if(b=+b,A=A>>>0,W=W>>>0,!rt){const mt=Math.pow(2,8*W)-1;et(this,b,A,W,mt,0)}let I=W-1,N=1;for(this[A+I]=b&255;--I>=0&&(N*=256);)this[A+I]=b/N&255;return A+W},h.prototype.writeUint8=h.prototype.writeUInt8=function(b,A,W){return b=+b,A=A>>>0,W||et(this,b,A,1,255,0),this[A]=b&255,A+1},h.prototype.writeUint16LE=h.prototype.writeUInt16LE=function(b,A,W){return b=+b,A=A>>>0,W||et(this,b,A,2,65535,0),this[A]=b&255,this[A+1]=b>>>8,A+2},h.prototype.writeUint16BE=h.prototype.writeUInt16BE=function(b,A,W){return b=+b,A=A>>>0,W||et(this,b,A,2,65535,0),this[A]=b>>>8,this[A+1]=b&255,A+2},h.prototype.writeUint32LE=h.prototype.writeUInt32LE=function(b,A,W){return b=+b,A=A>>>0,W||et(this,b,A,4,4294967295,0),this[A+3]=b>>>24,this[A+2]=b>>>16,this[A+1]=b>>>8,this[A]=b&255,A+4},h.prototype.writeUint32BE=h.prototype.writeUInt32BE=function(b,A,W){return b=+b,A=A>>>0,W||et(this,b,A,4,4294967295,0),this[A]=b>>>24,this[A+1]=b>>>16,this[A+2]=b>>>8,this[A+3]=b&255,A+4};function Ht(D,b,A,W,rt){ye(b,W,rt,D,A,7);let I=Number(b&BigInt(4294967295));D[A++]=I,I=I>>8,D[A++]=I,I=I>>8,D[A++]=I,I=I>>8,D[A++]=I;let N=Number(b>>BigInt(32)&BigInt(4294967295));return D[A++]=N,N=N>>8,D[A++]=N,N=N>>8,D[A++]=N,N=N>>8,D[A++]=N,A}function Dt(D,b,A,W,rt){ye(b,W,rt,D,A,7);let I=Number(b&BigInt(4294967295));D[A+7]=I,I=I>>8,D[A+6]=I,I=I>>8,D[A+5]=I,I=I>>8,D[A+4]=I;let N=Number(b>>BigInt(32)&BigInt(4294967295));return D[A+3]=N,N=N>>8,D[A+2]=N,N=N>>8,D[A+1]=N,N=N>>8,D[A]=N,A+8}h.prototype.writeBigUInt64LE=Lt(function(b,A=0){return Ht(this,b,A,BigInt(0),BigInt("0xffffffffffffffff"))}),h.prototype.writeBigUInt64BE=Lt(function(b,A=0){return Dt(this,b,A,BigInt(0),BigInt("0xffffffffffffffff"))}),h.prototype.writeIntLE=function(b,A,W,rt){if(b=+b,A=A>>>0,!rt){const yt=Math.pow(2,8*W-1);et(this,b,A,W,yt-1,-yt)}let I=0,N=1,mt=0;for(this[A]=b&255;++I<W&&(N*=256);)b<0&&mt===0&&this[A+I-1]!==0&&(mt=1),this[A+I]=(b/N>>0)-mt&255;return A+W},h.prototype.writeIntBE=function(b,A,W,rt){if(b=+b,A=A>>>0,!rt){const yt=Math.pow(2,8*W-1);et(this,b,A,W,yt-1,-yt)}let I=W-1,N=1,mt=0;for(this[A+I]=b&255;--I>=0&&(N*=256);)b<0&&mt===0&&this[A+I+1]!==0&&(mt=1),this[A+I]=(b/N>>0)-mt&255;return A+W},h.prototype.writeInt8=function(b,A,W){return b=+b,A=A>>>0,W||et(this,b,A,1,127,-128),b<0&&(b=255+b+1),this[A]=b&255,A+1},h.prototype.writeInt16LE=function(b,A,W){return b=+b,A=A>>>0,W||et(this,b,A,2,32767,-32768),this[A]=b&255,this[A+1]=b>>>8,A+2},h.prototype.writeInt16BE=function(b,A,W){return b=+b,A=A>>>0,W||et(this,b,A,2,32767,-32768),this[A]=b>>>8,this[A+1]=b&255,A+2},h.prototype.writeInt32LE=function(b,A,W){return b=+b,A=A>>>0,W||et(this,b,A,4,2147483647,-2147483648),this[A]=b&255,this[A+1]=b>>>8,this[A+2]=b>>>16,this[A+3]=b>>>24,A+4},h.prototype.writeInt32BE=function(b,A,W){return b=+b,A=A>>>0,W||et(this,b,A,4,2147483647,-2147483648),b<0&&(b=4294967295+b+1),this[A]=b>>>24,this[A+1]=b>>>16,this[A+2]=b>>>8,this[A+3]=b&255,A+4},h.prototype.writeBigInt64LE=Lt(function(b,A=0){return Ht(this,b,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),h.prototype.writeBigInt64BE=Lt(function(b,A=0){return Dt(this,b,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Mt(D,b,A,W,rt,I){if(A+W>D.length)throw new RangeError("Index out of range");if(A<0)throw new RangeError("Index out of range")}function te(D,b,A,W,rt){return b=+b,A=A>>>0,rt||Mt(D,b,A,4),e.write(D,b,A,W,23,4),A+4}h.prototype.writeFloatLE=function(b,A,W){return te(this,b,A,!0,W)},h.prototype.writeFloatBE=function(b,A,W){return te(this,b,A,!1,W)};function re(D,b,A,W,rt){return b=+b,A=A>>>0,rt||Mt(D,b,A,8),e.write(D,b,A,W,52,8),A+8}h.prototype.writeDoubleLE=function(b,A,W){return re(this,b,A,!0,W)},h.prototype.writeDoubleBE=function(b,A,W){return re(this,b,A,!1,W)},h.prototype.copy=function(b,A,W,rt){if(!h.isBuffer(b))throw new TypeError("argument should be a Buffer");if(W||(W=0),!rt&&rt!==0&&(rt=this.length),A>=b.length&&(A=b.length),A||(A=0),rt>0&&rt<W&&(rt=W),rt===W||b.length===0||this.length===0)return 0;if(A<0)throw new RangeError("targetStart out of bounds");if(W<0||W>=this.length)throw new RangeError("Index out of range");if(rt<0)throw new RangeError("sourceEnd out of bounds");rt>this.length&&(rt=this.length),b.length-A<rt-W&&(rt=b.length-A+W);const I=rt-W;return this===b&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(A,W,rt):Uint8Array.prototype.set.call(b,this.subarray(W,rt),A),I},h.prototype.fill=function(b,A,W,rt){if(typeof b=="string"){if(typeof A=="string"?(rt=A,A=0,W=this.length):typeof W=="string"&&(rt=W,W=this.length),rt!==void 0&&typeof rt!="string")throw new TypeError("encoding must be a string");if(typeof rt=="string"&&!h.isEncoding(rt))throw new TypeError("Unknown encoding: "+rt);if(b.length===1){const N=b.charCodeAt(0);(rt==="utf8"&&N<128||rt==="latin1")&&(b=N)}}else typeof b=="number"?b=b&255:typeof b=="boolean"&&(b=Number(b));if(A<0||this.length<A||this.length<W)throw new RangeError("Out of range index");if(W<=A)return this;A=A>>>0,W=W===void 0?this.length:W>>>0,b||(b=0);let I;if(typeof b=="number")for(I=A;I<W;++I)this[I]=b;else{const N=h.isBuffer(b)?b:h.from(b,rt),mt=N.length;if(mt===0)throw new TypeError('The value "'+b+'" is invalid for argument "value"');for(I=0;I<W-A;++I)this[I+A]=N[I%mt]}return this};const Xt={};function qt(D,b,A){Xt[D]=class extends A{constructor(){super(),Object.defineProperty(this,"message",{value:b.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${D}]`,this.stack,delete this.name}get code(){return D}set code(rt){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:rt,writable:!0})}toString(){return`${this.name} [${D}]: ${this.message}`}}}qt("ERR_BUFFER_OUT_OF_BOUNDS",function(D){return D?`${D} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),qt("ERR_INVALID_ARG_TYPE",function(D,b){return`The "${D}" argument must be of type number. Received type ${typeof b}`},TypeError),qt("ERR_OUT_OF_RANGE",function(D,b,A){let W=`The value of "${D}" is out of range.`,rt=A;return Number.isInteger(A)&&Math.abs(A)>2**32?rt=le(String(A)):typeof A=="bigint"&&(rt=String(A),(A>BigInt(2)**BigInt(32)||A<-(BigInt(2)**BigInt(32)))&&(rt=le(rt)),rt+="n"),W+=` It must be ${b}. Received ${rt}`,W},RangeError);function le(D){let b="",A=D.length;const W=D[0]==="-"?1:0;for(;A>=W+4;A-=3)b=`_${D.slice(A-3,A)}${b}`;return`${D.slice(0,A)}${b}`}function ne(D,b,A){fe(b,"offset"),(D[b]===void 0||D[b+A]===void 0)&&S(b,D.length-(A+1))}function ye(D,b,A,W,rt,I){if(D>A||D<b){const N=typeof b=="bigint"?"n":"";let mt;throw I>3?b===0||b===BigInt(0)?mt=`>= 0${N} and < 2${N} ** ${(I+1)*8}${N}`:mt=`>= -(2${N} ** ${(I+1)*8-1}${N}) and < 2 ** ${(I+1)*8-1}${N}`:mt=`>= ${b}${N} and <= ${A}${N}`,new Xt.ERR_OUT_OF_RANGE("value",mt,D)}ne(W,rt,I)}function fe(D,b){if(typeof D!="number")throw new Xt.ERR_INVALID_ARG_TYPE(b,"number",D)}function S(D,b,A){throw Math.floor(D)!==D?(fe(D,A),new Xt.ERR_OUT_OF_RANGE(A||"offset","an integer",D)):b<0?new Xt.ERR_BUFFER_OUT_OF_BOUNDS:new Xt.ERR_OUT_OF_RANGE(A||"offset",`>= ${A?1:0} and <= ${b}`,D)}const At=/[^+/0-9A-Za-z-_]/g;function _t(D){if(D=D.split("=")[0],D=D.trim().replace(At,""),D.length<2)return"";for(;D.length%4!==0;)D=D+"=";return D}function X(D,b){b=b||1/0;let A;const W=D.length;let rt=null;const I=[];for(let N=0;N<W;++N){if(A=D.charCodeAt(N),A>55295&&A<57344){if(!rt){if(A>56319){(b-=3)>-1&&I.push(239,191,189);continue}else if(N+1===W){(b-=3)>-1&&I.push(239,191,189);continue}rt=A;continue}if(A<56320){(b-=3)>-1&&I.push(239,191,189),rt=A;continue}A=(rt-55296<<10|A-56320)+65536}else rt&&(b-=3)>-1&&I.push(239,191,189);if(rt=null,A<128){if((b-=1)<0)break;I.push(A)}else if(A<2048){if((b-=2)<0)break;I.push(A>>6|192,A&63|128)}else if(A<65536){if((b-=3)<0)break;I.push(A>>12|224,A>>6&63|128,A&63|128)}else if(A<1114112){if((b-=4)<0)break;I.push(A>>18|240,A>>12&63|128,A>>6&63|128,A&63|128)}else throw new Error("Invalid code point")}return I}function V(D){const b=[];for(let A=0;A<D.length;++A)b.push(D.charCodeAt(A)&255);return b}function lt(D,b){let A,W,rt;const I=[];for(let N=0;N<D.length&&!((b-=2)<0);++N)A=D.charCodeAt(N),W=A>>8,rt=A%256,I.push(rt),I.push(W);return I}function Et(D){return t.toByteArray(_t(D))}function Tt(D,b,A,W){let rt;for(rt=0;rt<W&&!(rt+A>=b.length||rt>=D.length);++rt)b[rt+A]=D[rt];return rt}function at(D,b){return D instanceof b||D!=null&&D.constructor!=null&&D.constructor.name!=null&&D.constructor.name===b.name}function Nt(D){return D!==D}const Kt=function(){const D="0123456789abcdef",b=new Array(256);for(let A=0;A<16;++A){const W=A*16;for(let rt=0;rt<16;++rt)b[W+rt]=D[A]+D[rt]}return b}();function Lt(D){return typeof BigInt>"u"?ee:D}function ee(){throw new Error("BigInt not supported")}})(Mf);var Wy={exports:{}};(function(i,t){(function(e,r){i.exports=r()})(si,function(){var e="1.13.6",r=typeof self=="object"&&self.self===self&&self||typeof si=="object"&&si.global===si&&si||Function("return this")()||{},n=Array.prototype,s=Object.prototype,a=typeof Symbol<"u"?Symbol.prototype:null,h=n.push,u=n.slice,d=s.toString,m=s.hasOwnProperty,l=typeof ArrayBuffer<"u",f=typeof DataView<"u",p=Array.isArray,y=Object.keys,_=Object.create,v=l&&ArrayBuffer.isView,w=isNaN,C=isFinite,E=!{toString:null}.propertyIsEnumerable("toString"),k=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],G=Math.pow(2,53)-1;function Q(M,F){return F=F==null?M.length-1:+F,function(){for(var $=Math.max(arguments.length-F,0),q=Array($),ft=0;ft<$;ft++)q[ft]=arguments[ft+F];switch(F){case 0:return M.call(this,q);case 1:return M.call(this,arguments[0],q);case 2:return M.call(this,arguments[0],arguments[1],q)}var ht=Array(F+1);for(ft=0;ft<F;ft++)ht[ft]=arguments[ft];return ht[F]=q,M.apply(this,ht)}}function Y(M){var F=typeof M;return F==="function"||F==="object"&&!!M}function it(M){return M===void 0}function J(M){return M===!0||M===!1||d.call(M)==="[object Boolean]"}function st(M){var F="[object "+M+"]";return function($){return d.call($)===F}}var gt=st("String"),j=st("Number"),Z=st("Date"),T=st("RegExp"),ut=st("Error"),Pt=st("Symbol"),pt=st("ArrayBuffer"),Gt=st("Function"),bt=r.document&&r.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof bt!="function"&&(Gt=function(M){return typeof M=="function"||!1});var xt=Gt,tt=st("Object"),et=f&&tt(new DataView(new ArrayBuffer(8))),Ht=typeof Map<"u"&&tt(new Map),Dt=st("DataView"),Mt=et?function(M){return M!=null&&xt(M.getInt8)&&pt(M.buffer)}:Dt,te=p||st("Array");function re(M,F){return M!=null&&m.call(M,F)}var Xt=st("Arguments");(function(){Xt(arguments)||(Xt=function(M){return re(M,"callee")})})();var qt=Xt;function le(M){return j(M)&&w(M)}function ne(M){return function(){return M}}function ye(M){return function(F){var $=M(F);return typeof $=="number"&&$>=0&&$<=G}}function fe(M){return function(F){return F?.[M]}}var S=fe("byteLength"),At=ye(S),_t=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,X=l?function(M){return v?v(M)&&!Mt(M):At(M)&&_t.test(d.call(M))}:ne(!1),V=fe("length");function lt(M,F){F=function(vt){for(var Bt={},se=vt.length,_e=0;_e<se;++_e)Bt[vt[_e]]=!0;return{contains:function(Ye){return Bt[Ye]===!0},push:function(Ye){return Bt[Ye]=!0,vt.push(Ye)}}}(F);var $=k.length,q=M.constructor,ft=xt(q)&&q.prototype||s,ht="constructor";for(re(M,ht)&&!F.contains(ht)&&F.push(ht);$--;)(ht=k[$])in M&&M[ht]!==ft[ht]&&!F.contains(ht)&&F.push(ht)}function Et(M){if(!Y(M))return[];if(y)return y(M);var F=[];for(var $ in M)re(M,$)&&F.push($);return E&&lt(M,F),F}function Tt(M,F){var $=Et(F),q=$.length;if(M==null)return!q;for(var ft=Object(M),ht=0;ht<q;ht++){var vt=$[ht];if(F[vt]!==ft[vt]||!(vt in ft))return!1}return!0}function at(M){return M instanceof at?M:this instanceof at?void(this._wrapped=M):new at(M)}function Nt(M){return new Uint8Array(M.buffer||M,M.byteOffset||0,S(M))}at.VERSION=e,at.prototype.value=function(){return this._wrapped},at.prototype.valueOf=at.prototype.toJSON=at.prototype.value,at.prototype.toString=function(){return String(this._wrapped)};var Kt="[object DataView]";function Lt(M,F,$,q){if(M===F)return M!==0||1/M==1/F;if(M==null||F==null)return!1;if(M!=M)return F!=F;var ft=typeof M;return(ft==="function"||ft==="object"||typeof F=="object")&&function ht(vt,Bt,se,_e){vt instanceof at&&(vt=vt._wrapped),Bt instanceof at&&(Bt=Bt._wrapped);var Ye=d.call(vt);if(Ye!==d.call(Bt))return!1;if(et&&Ye=="[object Object]"&&Mt(vt)){if(!Mt(Bt))return!1;Ye=Kt}switch(Ye){case"[object RegExp]":case"[object String]":return""+vt==""+Bt;case"[object Number]":return+vt!=+vt?+Bt!=+Bt:+vt==0?1/+vt==1/Bt:+vt==+Bt;case"[object Date]":case"[object Boolean]":return+vt==+Bt;case"[object Symbol]":return a.valueOf.call(vt)===a.valueOf.call(Bt);case"[object ArrayBuffer]":case Kt:return ht(Nt(vt),Nt(Bt),se,_e)}var Li=Ye==="[object Array]";if(!Li&&X(vt)){if(S(vt)!==S(Bt))return!1;if(vt.buffer===Bt.buffer&&vt.byteOffset===Bt.byteOffset)return!0;Li=!0}if(!Li){if(typeof vt!="object"||typeof Bt!="object")return!1;var dn=vt.constructor,fn=Bt.constructor;if(dn!==fn&&!(xt(dn)&&dn instanceof dn&&xt(fn)&&fn instanceof fn)&&"constructor"in vt&&"constructor"in Bt)return!1}_e=_e||[];for(var ur=(se=se||[]).length;ur--;)if(se[ur]===vt)return _e[ur]===Bt;if(se.push(vt),_e.push(Bt),Li){if((ur=vt.length)!==Bt.length)return!1;for(;ur--;)if(!Lt(vt[ur],Bt[ur],se,_e))return!1}else{var Fi,Uh=Et(vt);if(ur=Uh.length,Et(Bt).length!==ur)return!1;for(;ur--;)if(Fi=Uh[ur],!re(Bt,Fi)||!Lt(vt[Fi],Bt[Fi],se,_e))return!1}return se.pop(),_e.pop(),!0}(M,F,$,q)}function ee(M){if(!Y(M))return[];var F=[];for(var $ in M)F.push($);return E&&lt(M,F),F}function D(M){var F=V(M);return function($){if($==null)return!1;var q=ee($);if(V(q))return!1;for(var ft=0;ft<F;ft++)if(!xt($[M[ft]]))return!1;return M!==N||!xt($[b])}}var b="forEach",A="has",W=["clear","delete"],rt=["get",A,"set"],I=W.concat(b,rt),N=W.concat(rt),mt=["add"].concat(W,b,A),yt=Ht?D(I):st("Map"),Ct=Ht?D(N):st("WeakMap"),Wt=Ht?D(mt):st("Set"),Vt=st("WeakSet");function be(M){for(var F=Et(M),$=F.length,q=Array($),ft=0;ft<$;ft++)q[ft]=M[F[ft]];return q}function Ie(M){for(var F={},$=Et(M),q=0,ft=$.length;q<ft;q++)F[M[$[q]]]=$[q];return F}function Ne(M){var F=[];for(var $ in M)xt(M[$])&&F.push($);return F.sort()}function Be(M,F){return function($){var q=arguments.length;if(F&&($=Object($)),q<2||$==null)return $;for(var ft=1;ft<q;ft++)for(var ht=arguments[ft],vt=M(ht),Bt=vt.length,se=0;se<Bt;se++){var _e=vt[se];F&&$[_e]!==void 0||($[_e]=ht[_e])}return $}}var Ze=Be(ee),Ei=Be(Et),vr=Be(ee,!0);function ss(M){if(!Y(M))return{};if(_)return _(M);var F=function(){};F.prototype=M;var $=new F;return F.prototype=null,$}function Fs(M){return te(M)?M:[M]}function Mn(M){return at.toPath(M)}function Os(M,F){for(var $=F.length,q=0;q<$;q++){if(M==null)return;M=M[F[q]]}return $?M:void 0}function Ta(M,F,$){var q=Os(M,Mn(F));return it(q)?$:q}function In(M){return M}function Bn(M){return M=Ei({},M),function(F){return Tt(F,M)}}function Rn(M){return M=Mn(M),function(F){return Os(F,M)}}function kn(M,F,$){if(F===void 0)return M;switch($??3){case 1:return function(q){return M.call(F,q)};case 3:return function(q,ft,ht){return M.call(F,q,ft,ht)};case 4:return function(q,ft,ht,vt){return M.call(F,q,ft,ht,vt)}}return function(){return M.apply(F,arguments)}}function Sa(M,F,$){return M==null?In:xt(M)?kn(M,F,$):Y(M)&&!te(M)?Bn(M):Rn(M)}function Ns(M,F){return Sa(M,F,1/0)}function Pi(M,F,$){return at.iteratee!==Ns?at.iteratee(M,F):Sa(M,F,$)}function Ca(){}function Us(M,F){return F==null&&(F=M,M=0),M+Math.floor(Math.random()*(F-M+1))}at.toPath=Fs,at.iteratee=Ns;var Pn=Date.now||function(){return new Date().getTime()};function Ma(M){var F=function(ht){return M[ht]},$="(?:"+Et(M).join("|")+")",q=RegExp($),ft=RegExp($,"g");return function(ht){return ht=ht==null?"":""+ht,q.test(ht)?ht.replace(ft,F):ht}}var Xr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Ia=Ma(Xr),No=Ma(Ie(Xr)),Uo=at.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},Hs=/(.)^/,Ho={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Go=/\\|'|\r|\n|\u2028|\u2029/g;function or(M){return"\\"+Ho[M]}var Wo=/^\s*(\w|\$)+\s*$/,as=0;function Ba(M,F,$,q,ft){if(!(q instanceof F))return M.apply($,ft);var ht=ss(M.prototype),vt=M.apply(ht,ft);return Y(vt)?vt:ht}var ln=Q(function(M,F){var $=ln.placeholder,q=function(){for(var ft=0,ht=F.length,vt=Array(ht),Bt=0;Bt<ht;Bt++)vt[Bt]=F[Bt]===$?arguments[ft++]:F[Bt];for(;ft<arguments.length;)vt.push(arguments[ft++]);return Ba(M,q,this,this,vt)};return q});ln.placeholder=at;var Ra=Q(function(M,F,$){if(!xt(M))throw new TypeError("Bind must be called on a function");var q=Q(function(ft){return Ba(M,q,F,this,$.concat(ft))});return q}),Di=ye(V);function Br(M,F,$,q){if(q=q||[],F||F===0){if(F<=0)return q.concat(M)}else F=1/0;for(var ft=q.length,ht=0,vt=V(M);ht<vt;ht++){var Bt=M[ht];if(Di(Bt)&&(te(Bt)||qt(Bt)))if(F>1)Br(Bt,F-1,$,q),ft=q.length;else for(var se=0,_e=Bt.length;se<_e;)q[ft++]=Bt[se++];else $||(q[ft++]=Bt)}return q}var ka=Q(function(M,F){var $=(F=Br(F,!1,!1)).length;if($<1)throw new Error("bindAll must be passed function names");for(;$--;){var q=F[$];M[q]=Ra(M[q],M)}return M}),Pa=Q(function(M,F,$){return setTimeout(function(){return M.apply(null,$)},F)}),Ci=ln(Pa,at,1);function Gs(M){return function(){return!M.apply(this,arguments)}}function Da(M,F){var $;return function(){return--M>0&&($=F.apply(this,arguments)),M<=1&&(F=null),$}}var La=ln(Da,2);function cn(M,F,$){F=Pi(F,$);for(var q,ft=Et(M),ht=0,vt=ft.length;ht<vt;ht++)if(F(M[q=ft[ht]],q,M))return q}function Mi(M){return function(F,$,q){$=Pi($,q);for(var ft=V(F),ht=M>0?0:ft-1;ht>=0&&ht<ft;ht+=M)if($(F[ht],ht,F))return ht;return-1}}var Je=Mi(1),Fa=Mi(-1);function os(M,F,$,q){for(var ft=($=Pi($,q,1))(F),ht=0,vt=V(M);ht<vt;){var Bt=Math.floor((ht+vt)/2);$(M[Bt])<ft?ht=Bt+1:vt=Bt}return ht}function Ii(M,F,$){return function(q,ft,ht){var vt=0,Bt=V(q);if(typeof ht=="number")M>0?vt=ht>=0?ht:Math.max(ht+Bt,vt):Bt=ht>=0?Math.min(ht+1,Bt):ht+Bt+1;else if($&&ht&&Bt)return q[ht=$(q,ft)]===ft?ht:-1;if(ft!=ft)return(ht=F(u.call(q,vt,Bt),le))>=0?ht+vt:-1;for(ht=M>0?vt:Bt-1;ht>=0&&ht<Bt;ht+=M)if(q[ht]===ft)return ht;return-1}}var hs=Ii(1,Je,os),Oa=Ii(-1,Fa);function ls(M,F,$){var q=(Di(M)?Je:cn)(M,F,$);if(q!==void 0&&q!==-1)return M[q]}function hr(M,F,$){var q,ft;if(F=kn(F,$),Di(M))for(q=0,ft=M.length;q<ft;q++)F(M[q],q,M);else{var ht=Et(M);for(q=0,ft=ht.length;q<ft;q++)F(M[ht[q]],ht[q],M)}return M}function lr(M,F,$){F=Pi(F,$);for(var q=!Di(M)&&Et(M),ft=(q||M).length,ht=Array(ft),vt=0;vt<ft;vt++){var Bt=q?q[vt]:vt;ht[vt]=F(M[Bt],Bt,M)}return ht}function cs(M){var F=function($,q,ft,ht){var vt=!Di($)&&Et($),Bt=(vt||$).length,se=M>0?0:Bt-1;for(ht||(ft=$[vt?vt[se]:se],se+=M);se>=0&&se<Bt;se+=M){var _e=vt?vt[se]:se;ft=q(ft,$[_e],_e,$)}return ft};return function($,q,ft,ht){var vt=arguments.length>=3;return F($,kn(q,ht,4),ft,vt)}}var us=cs(1),ds=cs(-1);function Rr(M,F,$){var q=[];return F=Pi(F,$),hr(M,function(ft,ht,vt){F(ft,ht,vt)&&q.push(ft)}),q}function wr(M,F,$){F=Pi(F,$);for(var q=!Di(M)&&Et(M),ft=(q||M).length,ht=0;ht<ft;ht++){var vt=q?q[ht]:ht;if(!F(M[vt],vt,M))return!1}return!0}function B(M,F,$){F=Pi(F,$);for(var q=!Di(M)&&Et(M),ft=(q||M).length,ht=0;ht<ft;ht++){var vt=q?q[ht]:ht;if(F(M[vt],vt,M))return!0}return!1}function P(M,F,$,q){return Di(M)||(M=be(M)),(typeof $!="number"||q)&&($=0),hs(M,F,$)>=0}var H=Q(function(M,F,$){var q,ft;return xt(F)?ft=F:(F=Mn(F),q=F.slice(0,-1),F=F[F.length-1]),lr(M,function(ht){var vt=ft;if(!vt){if(q&&q.length&&(ht=Os(ht,q)),ht==null)return;vt=ht[F]}return vt==null?vt:vt.apply(ht,$)})});function ot(M,F){return lr(M,Rn(F))}function It(M,F,$){var q,ft,ht=-1/0,vt=-1/0;if(F==null||typeof F=="number"&&typeof M[0]!="object"&&M!=null)for(var Bt=0,se=(M=Di(M)?M:be(M)).length;Bt<se;Bt++)(q=M[Bt])!=null&&q>ht&&(ht=q);else F=Pi(F,$),hr(M,function(_e,Ye,Li){((ft=F(_e,Ye,Li))>vt||ft===-1/0&&ht===-1/0)&&(ht=_e,vt=ft)});return ht}var Ft=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function $t(M){return M?te(M)?u.call(M):gt(M)?M.match(Ft):Di(M)?lr(M,In):be(M):[]}function Qt(M,F,$){if(F==null||$)return Di(M)||(M=be(M)),M[Us(M.length-1)];var q=$t(M),ft=V(q);F=Math.max(Math.min(F,ft),0);for(var ht=ft-1,vt=0;vt<F;vt++){var Bt=Us(vt,ht),se=q[vt];q[vt]=q[Bt],q[Bt]=se}return q.slice(0,F)}function We(M,F){return function($,q,ft){var ht=F?[[],[]]:{};return q=Pi(q,ft),hr($,function(vt,Bt){var se=q(vt,Bt,$);M(ht,vt,se)}),ht}}var fi=We(function(M,F,$){re(M,$)?M[$].push(F):M[$]=[F]}),Hi=We(function(M,F,$){M[$]=F}),Gi=We(function(M,F,$){re(M,$)?M[$]++:M[$]=1}),br=We(function(M,F,$){M[$?0:1].push(F)},!0);function fs(M,F,$){return F in $}var qi=Q(function(M,F){var $={},q=F[0];if(M==null)return $;xt(q)?(F.length>1&&(q=kn(q,F[1])),F=ee(M)):(q=fs,F=Br(F,!1,!1),M=Object(M));for(var ft=0,ht=F.length;ft<ht;ft++){var vt=F[ft],Bt=M[vt];q(Bt,vt,M)&&($[vt]=Bt)}return $}),Wi=Q(function(M,F){var $,q=F[0];return xt(q)?(q=Gs(q),F.length>1&&($=F[1])):(F=lr(Br(F,!1,!1),String),q=function(ft,ht){return!P(F,ht)}),qi(M,q,$)});function Dn(M,F,$){return u.call(M,0,Math.max(0,M.length-(F==null||$?1:F)))}function cr(M,F,$){return M==null||M.length<1?F==null||$?void 0:[]:F==null||$?M[0]:Dn(M,M.length-F)}function un(M,F,$){return u.call(M,F==null||$?1:F)}var Oh=Q(function(M,F){return F=Br(F,!0,!0),Rr(M,function($){return!P(F,$)})}),Kc=Q(function(M,F){return Oh(M,F)});function Xe(M,F,$,q){J(F)||(q=$,$=F,F=!1),$!=null&&($=Pi($,q));for(var ft=[],ht=[],vt=0,Bt=V(M);vt<Bt;vt++){var se=M[vt],_e=$?$(se,vt,M):se;F&&!$?(vt&&ht===_e||ft.push(se),ht=_e):$?P(ht,_e)||(ht.push(_e),ft.push(se)):P(ft,se)||ft.push(se)}return ft}var Ke=Q(function(M){return Xe(Br(M,!0,!0))});function zo(M){for(var F=M&&It(M,V).length||0,$=Array(F),q=0;q<F;q++)$[q]=ot(M,q);return $}var Zc=Q(zo);function Vo(M,F){return M._chain?at(F).chain():F}function Nh(M){return hr(Ne(M),function(F){var $=at[F]=M[F];at.prototype[F]=function(){var q=[this._wrapped];return h.apply(q,arguments),Vo(this,$.apply(at,q))}}),at}hr(["pop","push","reverse","shift","sort","splice","unshift"],function(M){var F=n[M];at.prototype[M]=function(){var $=this._wrapped;return $!=null&&(F.apply($,arguments),M!=="shift"&&M!=="splice"||$.length!==0||delete $[0]),Vo(this,$)}}),hr(["concat","join","slice"],function(M){var F=n[M];at.prototype[M]=function(){var $=this._wrapped;return $!=null&&($=F.apply($,arguments)),Vo(this,$)}});var jo=Nh({__proto__:null,VERSION:e,restArguments:Q,isObject:Y,isNull:function(M){return M===null},isUndefined:it,isBoolean:J,isElement:function(M){return!(!M||M.nodeType!==1)},isString:gt,isNumber:j,isDate:Z,isRegExp:T,isError:ut,isSymbol:Pt,isArrayBuffer:pt,isDataView:Mt,isArray:te,isFunction:xt,isArguments:qt,isFinite:function(M){return!Pt(M)&&C(M)&&!isNaN(parseFloat(M))},isNaN:le,isTypedArray:X,isEmpty:function(M){if(M==null)return!0;var F=V(M);return typeof F=="number"&&(te(M)||gt(M)||qt(M))?F===0:V(Et(M))===0},isMatch:Tt,isEqual:function(M,F){return Lt(M,F)},isMap:yt,isWeakMap:Ct,isSet:Wt,isWeakSet:Vt,keys:Et,allKeys:ee,values:be,pairs:function(M){for(var F=Et(M),$=F.length,q=Array($),ft=0;ft<$;ft++)q[ft]=[F[ft],M[F[ft]]];return q},invert:Ie,functions:Ne,methods:Ne,extend:Ze,extendOwn:Ei,assign:Ei,defaults:vr,create:function(M,F){var $=ss(M);return F&&Ei($,F),$},clone:function(M){return Y(M)?te(M)?M.slice():Ze({},M):M},tap:function(M,F){return F(M),M},get:Ta,has:function(M,F){for(var $=(F=Mn(F)).length,q=0;q<$;q++){var ft=F[q];if(!re(M,ft))return!1;M=M[ft]}return!!$},mapObject:function(M,F,$){F=Pi(F,$);for(var q=Et(M),ft=q.length,ht={},vt=0;vt<ft;vt++){var Bt=q[vt];ht[Bt]=F(M[Bt],Bt,M)}return ht},identity:In,constant:ne,noop:Ca,toPath:Fs,property:Rn,propertyOf:function(M){return M==null?Ca:function(F){return Ta(M,F)}},matcher:Bn,matches:Bn,times:function(M,F,$){var q=Array(Math.max(0,M));F=kn(F,$,1);for(var ft=0;ft<M;ft++)q[ft]=F(ft);return q},random:Us,now:Pn,escape:Ia,unescape:No,templateSettings:Uo,template:function(M,F,$){!F&&$&&(F=$),F=vr({},F,at.templateSettings);var q=RegExp([(F.escape||Hs).source,(F.interpolate||Hs).source,(F.evaluate||Hs).source].join("|")+"|$","g"),ft=0,ht="__p+='";M.replace(q,function(_e,Ye,Li,dn,fn){return ht+=M.slice(ft,fn).replace(Go,or),ft=fn+_e.length,Ye?ht+=`'+
((__t=(`+Ye+`))==null?'':_.escape(__t))+
'`:Li?ht+=`'+
((__t=(`+Li+`))==null?'':__t)+
'`:dn&&(ht+=`';
`+dn+`
__p+='`),_e}),ht+=`';
`;var vt,Bt=F.variable;if(Bt){if(!Wo.test(Bt))throw new Error("variable is not a bare identifier: "+Bt)}else ht=`with(obj||{}){
`+ht+`}
`,Bt="obj";ht=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+ht+`return __p;
`;try{vt=new Function(Bt,"_",ht)}catch(_e){throw _e.source=ht,_e}var se=function(_e){return vt.call(this,_e,at)};return se.source="function("+Bt+`){
`+ht+"}",se},result:function(M,F,$){var q=(F=Mn(F)).length;if(!q)return xt($)?$.call(M):$;for(var ft=0;ft<q;ft++){var ht=M?.[F[ft]];ht===void 0&&(ht=$,ft=q),M=xt(ht)?ht.call(M):ht}return M},uniqueId:function(M){var F=++as+"";return M?M+F:F},chain:function(M){var F=at(M);return F._chain=!0,F},iteratee:Ns,partial:ln,bind:Ra,bindAll:ka,memoize:function(M,F){var $=function(q){var ft=$.cache,ht=""+(F?F.apply(this,arguments):q);return re(ft,ht)||(ft[ht]=M.apply(this,arguments)),ft[ht]};return $.cache={},$},delay:Pa,defer:Ci,throttle:function(M,F,$){var q,ft,ht,vt,Bt=0;$||($={});var se=function(){Bt=$.leading===!1?0:Pn(),q=null,vt=M.apply(ft,ht),q||(ft=ht=null)},_e=function(){var Ye=Pn();Bt||$.leading!==!1||(Bt=Ye);var Li=F-(Ye-Bt);return ft=this,ht=arguments,Li<=0||Li>F?(q&&(clearTimeout(q),q=null),Bt=Ye,vt=M.apply(ft,ht),q||(ft=ht=null)):q||$.trailing===!1||(q=setTimeout(se,Li)),vt};return _e.cancel=function(){clearTimeout(q),Bt=0,q=ft=ht=null},_e},debounce:function(M,F,$){var q,ft,ht,vt,Bt,se=function(){var Ye=Pn()-ft;F>Ye?q=setTimeout(se,F-Ye):(q=null,$||(vt=M.apply(Bt,ht)),q||(ht=Bt=null))},_e=Q(function(Ye){return Bt=this,ht=Ye,ft=Pn(),q||(q=setTimeout(se,F),$&&(vt=M.apply(Bt,ht))),vt});return _e.cancel=function(){clearTimeout(q),q=ht=Bt=null},_e},wrap:function(M,F){return ln(F,M)},negate:Gs,compose:function(){var M=arguments,F=M.length-1;return function(){for(var $=F,q=M[F].apply(this,arguments);$--;)q=M[$].call(this,q);return q}},after:function(M,F){return function(){if(--M<1)return F.apply(this,arguments)}},before:Da,once:La,findKey:cn,findIndex:Je,findLastIndex:Fa,sortedIndex:os,indexOf:hs,lastIndexOf:Oa,find:ls,detect:ls,findWhere:function(M,F){return ls(M,Bn(F))},each:hr,forEach:hr,map:lr,collect:lr,reduce:us,foldl:us,inject:us,reduceRight:ds,foldr:ds,filter:Rr,select:Rr,reject:function(M,F,$){return Rr(M,Gs(Pi(F)),$)},every:wr,all:wr,some:B,any:B,contains:P,includes:P,include:P,invoke:H,pluck:ot,where:function(M,F){return Rr(M,Bn(F))},max:It,min:function(M,F,$){var q,ft,ht=1/0,vt=1/0;if(F==null||typeof F=="number"&&typeof M[0]!="object"&&M!=null)for(var Bt=0,se=(M=Di(M)?M:be(M)).length;Bt<se;Bt++)(q=M[Bt])!=null&&q<ht&&(ht=q);else F=Pi(F,$),hr(M,function(_e,Ye,Li){((ft=F(_e,Ye,Li))<vt||ft===1/0&&ht===1/0)&&(ht=_e,vt=ft)});return ht},shuffle:function(M){return Qt(M,1/0)},sample:Qt,sortBy:function(M,F,$){var q=0;return F=Pi(F,$),ot(lr(M,function(ft,ht,vt){return{value:ft,index:q++,criteria:F(ft,ht,vt)}}).sort(function(ft,ht){var vt=ft.criteria,Bt=ht.criteria;if(vt!==Bt){if(vt>Bt||vt===void 0)return 1;if(vt<Bt||Bt===void 0)return-1}return ft.index-ht.index}),"value")},groupBy:fi,indexBy:Hi,countBy:Gi,partition:br,toArray:$t,size:function(M){return M==null?0:Di(M)?M.length:Et(M).length},pick:qi,omit:Wi,first:cr,head:cr,take:cr,initial:Dn,last:function(M,F,$){return M==null||M.length<1?F==null||$?void 0:[]:F==null||$?M[M.length-1]:un(M,Math.max(0,M.length-F))},rest:un,tail:un,drop:un,compact:function(M){return Rr(M,Boolean)},flatten:function(M,F){return Br(M,F,!1)},without:Kc,uniq:Xe,unique:Xe,union:Ke,intersection:function(M){for(var F=[],$=arguments.length,q=0,ft=V(M);q<ft;q++){var ht=M[q];if(!P(F,ht)){var vt;for(vt=1;vt<$&&P(arguments[vt],ht);vt++);vt===$&&F.push(ht)}}return F},difference:Oh,unzip:zo,transpose:zo,zip:Zc,object:function(M,F){for(var $={},q=0,ft=V(M);q<ft;q++)F?$[M[q]]=F[q]:$[M[q][0]]=M[q][1];return $},range:function(M,F,$){F==null&&(F=M||0,M=0),$||($=F<M?-1:1);for(var q=Math.max(Math.ceil((F-M)/$),0),ft=Array(q),ht=0;ht<q;ht++,M+=$)ft[ht]=M;return ft},chunk:function(M,F){if(F==null||F<1)return[];for(var $=[],q=0,ft=M.length;q<ft;)$.push(u.call(M,q,q+=F));return $},mixin:Nh,default:at});return jo._=jo,jo})})(Wy);const sr=Wy.exports,tr={};tr.ascii85={};tr.ascii85.enc={0:"!",1:'"',2:"#",3:"$",4:"%",5:"&",6:"'",7:"(",8:")",9:"*",10:"+",11:",",12:"-",13:".",14:"/",15:"0",16:"1",17:"2",18:"3",19:"4",20:"5",21:"6",22:"7",23:"8",24:"9",25:":",26:";",27:"<",28:"=",29:">",30:"?",31:"@",32:"A",33:"B",34:"C",35:"D",36:"E",37:"F",38:"G",39:"H",40:"I",41:"J",42:"K",43:"L",44:"M",45:"N",46:"O",47:"P",48:"Q",49:"R",50:"S",51:"T",52:"U",53:"V",54:"W",55:"X",56:"Y",57:"Z",58:"[",59:"\\",60:"]",61:"^",62:"_",63:"`",64:"a",65:"b",66:"c",67:"d",68:"e",69:"f",70:"g",71:"h",72:"i",73:"j",74:"k",75:"l",76:"m",77:"n",78:"o",79:"p",80:"q",81:"r",82:"s",83:"t",84:"u"};tr.ascii85.dec=sr.object(sr.map(sr.values(tr.ascii85.enc),function(i){return i.charCodeAt(0)}),sr.map(sr.keys(tr.ascii85.enc),function(i){return parseInt(i)}));tr.z85={};tr.z85.enc={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"a",11:"b",12:"c",13:"d",14:"e",15:"f",16:"g",17:"h",18:"i",19:"j",20:"k",21:"l",22:"m",23:"n",24:"o",25:"p",26:"q",27:"r",28:"s",29:"t",30:"u",31:"v",32:"w",33:"x",34:"y",35:"z",36:"A",37:"B",38:"C",39:"D",40:"E",41:"F",42:"G",43:"H",44:"I",45:"J",46:"K",47:"L",48:"M",49:"N",50:"O",51:"P",52:"Q",53:"R",54:"S",55:"T",56:"U",57:"V",58:"W",59:"X",60:"Y",61:"Z",62:".",63:"-",64:":",65:"+",66:"=",67:"^",68:"!",69:"/",70:"*",71:"?",72:"&",73:"<",74:">",75:"(",76:")",77:"[",78:"]",79:"{",80:"}",81:"@",82:"%",83:"$",84:"#"};tr.z85.dec=sr.object(sr.map(sr.values(tr.z85.enc),function(i){return i.charCodeAt(0)}),sr.map(sr.keys(tr.z85.enc),function(i){return parseInt(i)}));tr.ipv6={};tr.ipv6.enc={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"A",11:"B",12:"C",13:"D",14:"E",15:"F",16:"G",17:"H",18:"I",19:"J",20:"K",21:"L",22:"M",23:"N",24:"O",25:"P",26:"Q",27:"R",28:"S",29:"T",30:"U",31:"V",32:"W",33:"X",34:"Y",35:"Z",36:"a",37:"b",38:"c",39:"d",40:"e",41:"f",42:"g",43:"h",44:"i",45:"j",46:"k",47:"l",48:"m",49:"n",50:"o",51:"p",52:"q",53:"r",54:"s",55:"t",56:"u",57:"v",58:"w",59:"x",60:"y",61:"z",62:"!",63:"#",64:"$",65:"%",66:"&",67:"(",68:")",69:"*",70:"+",71:"-",72:";",73:"<",74:"=",75:">",76:"?",77:"@",78:"^",79:"_",80:"`",81:"{",82:"|",83:"}",84:"~"};tr.ipv6.dec=sr.object(sr.map(sr.values(tr.ipv6.enc),function(i){return i.charCodeAt(0)}),sr.map(sr.keys(tr.ipv6.enc),function(i){return parseInt(i)}));var cB=tr,Gc={},Bf={exports:{}};(function(i,t){(function(){var e,r=0xdeadbeefcafe,n=(r&16777215)==15715070;function s(B,P,H){B!=null&&(typeof B=="number"?this.fromNumber(B,P,H):P==null&&typeof B!="string"?this.fromString(B,256):this.fromString(B,P))}function a(){return new s(null)}function h(B,P,H,ot,It,Ft){for(;--Ft>=0;){var $t=P*this[B++]+H[ot]+It;It=Math.floor($t/67108864),H[ot++]=$t&67108863}return It}function u(B,P,H,ot,It,Ft){for(var $t=P&32767,Qt=P>>15;--Ft>=0;){var We=this[B]&32767,fi=this[B++]>>15,Hi=Qt*We+fi*$t;We=$t*We+((Hi&32767)<<15)+H[ot]+(It&1073741823),It=(We>>>30)+(Hi>>>15)+Qt*fi+(It>>>30),H[ot++]=We&1073741823}return It}function d(B,P,H,ot,It,Ft){for(var $t=P&16383,Qt=P>>14;--Ft>=0;){var We=this[B]&16383,fi=this[B++]>>14,Hi=Qt*We+fi*$t;We=$t*We+((Hi&16383)<<14)+H[ot]+It,It=(We>>28)+(Hi>>14)+Qt*fi,H[ot++]=We&268435455}return It}var m=typeof navigator<"u";m&&n&&navigator.appName=="Microsoft Internet Explorer"?(s.prototype.am=u,e=30):m&&n&&navigator.appName!="Netscape"?(s.prototype.am=h,e=26):(s.prototype.am=d,e=28),s.prototype.DB=e,s.prototype.DM=(1<<e)-1,s.prototype.DV=1<<e;var l=52;s.prototype.FV=Math.pow(2,l),s.prototype.F1=l-e,s.prototype.F2=2*e-l;var f="0123456789abcdefghijklmnopqrstuvwxyz",p=new Array,y,_;for(y="0".charCodeAt(0),_=0;_<=9;++_)p[y++]=_;for(y="a".charCodeAt(0),_=10;_<36;++_)p[y++]=_;for(y="A".charCodeAt(0),_=10;_<36;++_)p[y++]=_;function v(B){return f.charAt(B)}function w(B,P){var H=p[B.charCodeAt(P)];return H??-1}function C(B){for(var P=this.t-1;P>=0;--P)B[P]=this[P];B.t=this.t,B.s=this.s}function E(B){this.t=1,this.s=B<0?-1:0,B>0?this[0]=B:B<-1?this[0]=B+this.DV:this.t=0}function k(B){var P=a();return P.fromInt(B),P}function G(B,P){var H;if(P==16)H=4;else if(P==8)H=3;else if(P==256)H=8;else if(P==2)H=1;else if(P==32)H=5;else if(P==4)H=2;else{this.fromRadix(B,P);return}this.t=0,this.s=0;for(var ot=B.length,It=!1,Ft=0;--ot>=0;){var $t=H==8?B[ot]&255:w(B,ot);if($t<0){B.charAt(ot)=="-"&&(It=!0);continue}It=!1,Ft==0?this[this.t++]=$t:Ft+H>this.DB?(this[this.t-1]|=($t&(1<<this.DB-Ft)-1)<<Ft,this[this.t++]=$t>>this.DB-Ft):this[this.t-1]|=$t<<Ft,Ft+=H,Ft>=this.DB&&(Ft-=this.DB)}H==8&&(B[0]&128)!=0&&(this.s=-1,Ft>0&&(this[this.t-1]|=(1<<this.DB-Ft)-1<<Ft)),this.clamp(),It&&s.ZERO.subTo(this,this)}function Q(){for(var B=this.s&this.DM;this.t>0&&this[this.t-1]==B;)--this.t}function Y(B){if(this.s<0)return"-"+this.negate().toString(B);var P;if(B==16)P=4;else if(B==8)P=3;else if(B==2)P=1;else if(B==32)P=5;else if(B==4)P=2;else return this.toRadix(B);var H=(1<<P)-1,ot,It=!1,Ft="",$t=this.t,Qt=this.DB-$t*this.DB%P;if($t-- >0)for(Qt<this.DB&&(ot=this[$t]>>Qt)>0&&(It=!0,Ft=v(ot));$t>=0;)Qt<P?(ot=(this[$t]&(1<<Qt)-1)<<P-Qt,ot|=this[--$t]>>(Qt+=this.DB-P)):(ot=this[$t]>>(Qt-=P)&H,Qt<=0&&(Qt+=this.DB,--$t)),ot>0&&(It=!0),It&&(Ft+=v(ot));return It?Ft:"0"}function it(){var B=a();return s.ZERO.subTo(this,B),B}function J(){return this.s<0?this.negate():this}function st(B){var P=this.s-B.s;if(P!=0)return P;var H=this.t;if(P=H-B.t,P!=0)return this.s<0?-P:P;for(;--H>=0;)if((P=this[H]-B[H])!=0)return P;return 0}function gt(B){var P=1,H;return(H=B>>>16)!=0&&(B=H,P+=16),(H=B>>8)!=0&&(B=H,P+=8),(H=B>>4)!=0&&(B=H,P+=4),(H=B>>2)!=0&&(B=H,P+=2),(H=B>>1)!=0&&(B=H,P+=1),P}function j(){return this.t<=0?0:this.DB*(this.t-1)+gt(this[this.t-1]^this.s&this.DM)}function Z(B,P){var H;for(H=this.t-1;H>=0;--H)P[H+B]=this[H];for(H=B-1;H>=0;--H)P[H]=0;P.t=this.t+B,P.s=this.s}function T(B,P){for(var H=B;H<this.t;++H)P[H-B]=this[H];P.t=Math.max(this.t-B,0),P.s=this.s}function ut(B,P){var H=B%this.DB,ot=this.DB-H,It=(1<<ot)-1,Ft=Math.floor(B/this.DB),$t=this.s<<H&this.DM,Qt;for(Qt=this.t-1;Qt>=0;--Qt)P[Qt+Ft+1]=this[Qt]>>ot|$t,$t=(this[Qt]&It)<<H;for(Qt=Ft-1;Qt>=0;--Qt)P[Qt]=0;P[Ft]=$t,P.t=this.t+Ft+1,P.s=this.s,P.clamp()}function Pt(B,P){P.s=this.s;var H=Math.floor(B/this.DB);if(H>=this.t){P.t=0;return}var ot=B%this.DB,It=this.DB-ot,Ft=(1<<ot)-1;P[0]=this[H]>>ot;for(var $t=H+1;$t<this.t;++$t)P[$t-H-1]|=(this[$t]&Ft)<<It,P[$t-H]=this[$t]>>ot;ot>0&&(P[this.t-H-1]|=(this.s&Ft)<<It),P.t=this.t-H,P.clamp()}function pt(B,P){for(var H=0,ot=0,It=Math.min(B.t,this.t);H<It;)ot+=this[H]-B[H],P[H++]=ot&this.DM,ot>>=this.DB;if(B.t<this.t){for(ot-=B.s;H<this.t;)ot+=this[H],P[H++]=ot&this.DM,ot>>=this.DB;ot+=this.s}else{for(ot+=this.s;H<B.t;)ot-=B[H],P[H++]=ot&this.DM,ot>>=this.DB;ot-=B.s}P.s=ot<0?-1:0,ot<-1?P[H++]=this.DV+ot:ot>0&&(P[H++]=ot),P.t=H,P.clamp()}function Gt(B,P){var H=this.abs(),ot=B.abs(),It=H.t;for(P.t=It+ot.t;--It>=0;)P[It]=0;for(It=0;It<ot.t;++It)P[It+H.t]=H.am(0,ot[It],P,It,0,H.t);P.s=0,P.clamp(),this.s!=B.s&&s.ZERO.subTo(P,P)}function bt(B){for(var P=this.abs(),H=B.t=2*P.t;--H>=0;)B[H]=0;for(H=0;H<P.t-1;++H){var ot=P.am(H,P[H],B,2*H,0,1);(B[H+P.t]+=P.am(H+1,2*P[H],B,2*H+1,ot,P.t-H-1))>=P.DV&&(B[H+P.t]-=P.DV,B[H+P.t+1]=1)}B.t>0&&(B[B.t-1]+=P.am(H,P[H],B,2*H,0,1)),B.s=0,B.clamp()}function xt(B,P,H){var ot=B.abs();if(!(ot.t<=0)){var It=this.abs();if(It.t<ot.t){P?.fromInt(0),H!=null&&this.copyTo(H);return}H==null&&(H=a());var Ft=a(),$t=this.s,Qt=B.s,We=this.DB-gt(ot[ot.t-1]);We>0?(ot.lShiftTo(We,Ft),It.lShiftTo(We,H)):(ot.copyTo(Ft),It.copyTo(H));var fi=Ft.t,Hi=Ft[fi-1];if(Hi!=0){var Gi=Hi*(1<<this.F1)+(fi>1?Ft[fi-2]>>this.F2:0),br=this.FV/Gi,fs=(1<<this.F1)/Gi,qi=1<<this.F2,Wi=H.t,Dn=Wi-fi,cr=P??a();for(Ft.dlShiftTo(Dn,cr),H.compareTo(cr)>=0&&(H[H.t++]=1,H.subTo(cr,H)),s.ONE.dlShiftTo(fi,cr),cr.subTo(Ft,Ft);Ft.t<fi;)Ft[Ft.t++]=0;for(;--Dn>=0;){var un=H[--Wi]==Hi?this.DM:Math.floor(H[Wi]*br+(H[Wi-1]+qi)*fs);if((H[Wi]+=Ft.am(0,un,H,Dn,0,fi))<un)for(Ft.dlShiftTo(Dn,cr),H.subTo(cr,H);H[Wi]<--un;)H.subTo(cr,H)}P!=null&&(H.drShiftTo(fi,P),$t!=Qt&&s.ZERO.subTo(P,P)),H.t=fi,H.clamp(),We>0&&H.rShiftTo(We,H),$t<0&&s.ZERO.subTo(H,H)}}}function tt(B){var P=a();return this.abs().divRemTo(B,null,P),this.s<0&&P.compareTo(s.ZERO)>0&&B.subTo(P,P),P}function et(B){this.m=B}function Ht(B){return B.s<0||B.compareTo(this.m)>=0?B.mod(this.m):B}function Dt(B){return B}function Mt(B){B.divRemTo(this.m,null,B)}function te(B,P,H){B.multiplyTo(P,H),this.reduce(H)}function re(B,P){B.squareTo(P),this.reduce(P)}et.prototype.convert=Ht,et.prototype.revert=Dt,et.prototype.reduce=Mt,et.prototype.mulTo=te,et.prototype.sqrTo=re;function Xt(){if(this.t<1)return 0;var B=this[0];if((B&1)==0)return 0;var P=B&3;return P=P*(2-(B&15)*P)&15,P=P*(2-(B&255)*P)&255,P=P*(2-((B&65535)*P&65535))&65535,P=P*(2-B*P%this.DV)%this.DV,P>0?this.DV-P:-P}function qt(B){this.m=B,this.mp=B.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<B.DB-15)-1,this.mt2=2*B.t}function le(B){var P=a();return B.abs().dlShiftTo(this.m.t,P),P.divRemTo(this.m,null,P),B.s<0&&P.compareTo(s.ZERO)>0&&this.m.subTo(P,P),P}function ne(B){var P=a();return B.copyTo(P),this.reduce(P),P}function ye(B){for(;B.t<=this.mt2;)B[B.t++]=0;for(var P=0;P<this.m.t;++P){var H=B[P]&32767,ot=H*this.mpl+((H*this.mph+(B[P]>>15)*this.mpl&this.um)<<15)&B.DM;for(H=P+this.m.t,B[H]+=this.m.am(0,ot,B,P,0,this.m.t);B[H]>=B.DV;)B[H]-=B.DV,B[++H]++}B.clamp(),B.drShiftTo(this.m.t,B),B.compareTo(this.m)>=0&&B.subTo(this.m,B)}function fe(B,P){B.squareTo(P),this.reduce(P)}function S(B,P,H){B.multiplyTo(P,H),this.reduce(H)}qt.prototype.convert=le,qt.prototype.revert=ne,qt.prototype.reduce=ye,qt.prototype.mulTo=S,qt.prototype.sqrTo=fe;function At(){return(this.t>0?this[0]&1:this.s)==0}function _t(B,P){if(B>4294967295||B<1)return s.ONE;var H=a(),ot=a(),It=P.convert(this),Ft=gt(B)-1;for(It.copyTo(H);--Ft>=0;)if(P.sqrTo(H,ot),(B&1<<Ft)>0)P.mulTo(ot,It,H);else{var $t=H;H=ot,ot=$t}return P.revert(H)}function X(B,P){var H;return B<256||P.isEven()?H=new et(P):H=new qt(P),this.exp(B,H)}s.prototype.copyTo=C,s.prototype.fromInt=E,s.prototype.fromString=G,s.prototype.clamp=Q,s.prototype.dlShiftTo=Z,s.prototype.drShiftTo=T,s.prototype.lShiftTo=ut,s.prototype.rShiftTo=Pt,s.prototype.subTo=pt,s.prototype.multiplyTo=Gt,s.prototype.squareTo=bt,s.prototype.divRemTo=xt,s.prototype.invDigit=Xt,s.prototype.isEven=At,s.prototype.exp=_t,s.prototype.toString=Y,s.prototype.negate=it,s.prototype.abs=J,s.prototype.compareTo=st,s.prototype.bitLength=j,s.prototype.mod=tt,s.prototype.modPowInt=X,s.ZERO=k(0),s.ONE=k(1);function V(){var B=a();return this.copyTo(B),B}function lt(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Et(){return this.t==0?this.s:this[0]<<24>>24}function Tt(){return this.t==0?this.s:this[0]<<16>>16}function at(B){return Math.floor(Math.LN2*this.DB/Math.log(B))}function Nt(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function Kt(B){if(B==null&&(B=10),this.signum()==0||B<2||B>36)return"0";var P=this.chunkSize(B),H=Math.pow(B,P),ot=k(H),It=a(),Ft=a(),$t="";for(this.divRemTo(ot,It,Ft);It.signum()>0;)$t=(H+Ft.intValue()).toString(B).substr(1)+$t,It.divRemTo(ot,It,Ft);return Ft.intValue().toString(B)+$t}function Lt(B,P){this.fromInt(0),P==null&&(P=10);for(var H=this.chunkSize(P),ot=Math.pow(P,H),It=!1,Ft=0,$t=0,Qt=0;Qt<B.length;++Qt){var We=w(B,Qt);if(We<0){B.charAt(Qt)=="-"&&this.signum()==0&&(It=!0);continue}$t=P*$t+We,++Ft>=H&&(this.dMultiply(ot),this.dAddOffset($t,0),Ft=0,$t=0)}Ft>0&&(this.dMultiply(Math.pow(P,Ft)),this.dAddOffset($t,0)),It&&s.ZERO.subTo(this,this)}function ee(B,P,H){if(typeof P=="number")if(B<2)this.fromInt(1);else for(this.fromNumber(B,H),this.testBit(B-1)||this.bitwiseTo(s.ONE.shiftLeft(B-1),mt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(P);)this.dAddOffset(2,0),this.bitLength()>B&&this.subTo(s.ONE.shiftLeft(B-1),this);else{var ot=new Array,It=B&7;ot.length=(B>>3)+1,P.nextBytes(ot),It>0?ot[0]&=(1<<It)-1:ot[0]=0,this.fromString(ot,256)}}function D(){var B=this.t,P=new Array;P[0]=this.s;var H=this.DB-B*this.DB%8,ot,It=0;if(B-- >0)for(H<this.DB&&(ot=this[B]>>H)!=(this.s&this.DM)>>H&&(P[It++]=ot|this.s<<this.DB-H);B>=0;)H<8?(ot=(this[B]&(1<<H)-1)<<8-H,ot|=this[--B]>>(H+=this.DB-8)):(ot=this[B]>>(H-=8)&255,H<=0&&(H+=this.DB,--B)),(ot&128)!=0&&(ot|=-256),It==0&&(this.s&128)!=(ot&128)&&++It,(It>0||ot!=this.s)&&(P[It++]=ot);return P}function b(B){return this.compareTo(B)==0}function A(B){return this.compareTo(B)<0?this:B}function W(B){return this.compareTo(B)>0?this:B}function rt(B,P,H){var ot,It,Ft=Math.min(B.t,this.t);for(ot=0;ot<Ft;++ot)H[ot]=P(this[ot],B[ot]);if(B.t<this.t){for(It=B.s&this.DM,ot=Ft;ot<this.t;++ot)H[ot]=P(this[ot],It);H.t=this.t}else{for(It=this.s&this.DM,ot=Ft;ot<B.t;++ot)H[ot]=P(It,B[ot]);H.t=B.t}H.s=P(this.s,B.s),H.clamp()}function I(B,P){return B&P}function N(B){var P=a();return this.bitwiseTo(B,I,P),P}function mt(B,P){return B|P}function yt(B){var P=a();return this.bitwiseTo(B,mt,P),P}function Ct(B,P){return B^P}function Wt(B){var P=a();return this.bitwiseTo(B,Ct,P),P}function Vt(B,P){return B&~P}function be(B){var P=a();return this.bitwiseTo(B,Vt,P),P}function Ie(){for(var B=a(),P=0;P<this.t;++P)B[P]=this.DM&~this[P];return B.t=this.t,B.s=~this.s,B}function Ne(B){var P=a();return B<0?this.rShiftTo(-B,P):this.lShiftTo(B,P),P}function Be(B){var P=a();return B<0?this.lShiftTo(-B,P):this.rShiftTo(B,P),P}function Ze(B){if(B==0)return-1;var P=0;return(B&65535)==0&&(B>>=16,P+=16),(B&255)==0&&(B>>=8,P+=8),(B&15)==0&&(B>>=4,P+=4),(B&3)==0&&(B>>=2,P+=2),(B&1)==0&&++P,P}function Ei(){for(var B=0;B<this.t;++B)if(this[B]!=0)return B*this.DB+Ze(this[B]);return this.s<0?this.t*this.DB:-1}function vr(B){for(var P=0;B!=0;)B&=B-1,++P;return P}function ss(){for(var B=0,P=this.s&this.DM,H=0;H<this.t;++H)B+=vr(this[H]^P);return B}function Fs(B){var P=Math.floor(B/this.DB);return P>=this.t?this.s!=0:(this[P]&1<<B%this.DB)!=0}function Mn(B,P){var H=s.ONE.shiftLeft(B);return this.bitwiseTo(H,P,H),H}function Os(B){return this.changeBit(B,mt)}function Ta(B){return this.changeBit(B,Vt)}function In(B){return this.changeBit(B,Ct)}function Bn(B,P){for(var H=0,ot=0,It=Math.min(B.t,this.t);H<It;)ot+=this[H]+B[H],P[H++]=ot&this.DM,ot>>=this.DB;if(B.t<this.t){for(ot+=B.s;H<this.t;)ot+=this[H],P[H++]=ot&this.DM,ot>>=this.DB;ot+=this.s}else{for(ot+=this.s;H<B.t;)ot+=B[H],P[H++]=ot&this.DM,ot>>=this.DB;ot+=B.s}P.s=ot<0?-1:0,ot>0?P[H++]=ot:ot<-1&&(P[H++]=this.DV+ot),P.t=H,P.clamp()}function Rn(B){var P=a();return this.addTo(B,P),P}function kn(B){var P=a();return this.subTo(B,P),P}function Sa(B){var P=a();return this.multiplyTo(B,P),P}function Ns(){var B=a();return this.squareTo(B),B}function Pi(B){var P=a();return this.divRemTo(B,P,null),P}function Ca(B){var P=a();return this.divRemTo(B,null,P),P}function Us(B){var P=a(),H=a();return this.divRemTo(B,P,H),new Array(P,H)}function Pn(B){this[this.t]=this.am(0,B-1,this,0,0,this.t),++this.t,this.clamp()}function Ma(B,P){if(B!=0){for(;this.t<=P;)this[this.t++]=0;for(this[P]+=B;this[P]>=this.DV;)this[P]-=this.DV,++P>=this.t&&(this[this.t++]=0),++this[P]}}function Xr(){}function Ia(B){return B}function No(B,P,H){B.multiplyTo(P,H)}function Uo(B,P){B.squareTo(P)}Xr.prototype.convert=Ia,Xr.prototype.revert=Ia,Xr.prototype.mulTo=No,Xr.prototype.sqrTo=Uo;function Hs(B){return this.exp(B,new Xr)}function Ho(B,P,H){var ot=Math.min(this.t+B.t,P);for(H.s=0,H.t=ot;ot>0;)H[--ot]=0;var It;for(It=H.t-this.t;ot<It;++ot)H[ot+this.t]=this.am(0,B[ot],H,ot,0,this.t);for(It=Math.min(B.t,P);ot<It;++ot)this.am(0,B[ot],H,ot,0,P-ot);H.clamp()}function Go(B,P,H){--P;var ot=H.t=this.t+B.t-P;for(H.s=0;--ot>=0;)H[ot]=0;for(ot=Math.max(P-this.t,0);ot<B.t;++ot)H[this.t+ot-P]=this.am(P-ot,B[ot],H,0,0,this.t+ot-P);H.clamp(),H.drShiftTo(1,H)}function or(B){this.r2=a(),this.q3=a(),s.ONE.dlShiftTo(2*B.t,this.r2),this.mu=this.r2.divide(B),this.m=B}function Wo(B){if(B.s<0||B.t>2*this.m.t)return B.mod(this.m);if(B.compareTo(this.m)<0)return B;var P=a();return B.copyTo(P),this.reduce(P),P}function as(B){return B}function Ba(B){for(B.drShiftTo(this.m.t-1,this.r2),B.t>this.m.t+1&&(B.t=this.m.t+1,B.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);B.compareTo(this.r2)<0;)B.dAddOffset(1,this.m.t+1);for(B.subTo(this.r2,B);B.compareTo(this.m)>=0;)B.subTo(this.m,B)}function ln(B,P){B.squareTo(P),this.reduce(P)}function Ra(B,P,H){B.multiplyTo(P,H),this.reduce(H)}or.prototype.convert=Wo,or.prototype.revert=as,or.prototype.reduce=Ba,or.prototype.mulTo=Ra,or.prototype.sqrTo=ln;function Di(B,P){var H=B.bitLength(),ot,It=k(1),Ft;if(H<=0)return It;H<18?ot=1:H<48?ot=3:H<144?ot=4:H<768?ot=5:ot=6,H<8?Ft=new et(P):P.isEven()?Ft=new or(P):Ft=new qt(P);var $t=new Array,Qt=3,We=ot-1,fi=(1<<ot)-1;if($t[1]=Ft.convert(this),ot>1){var Hi=a();for(Ft.sqrTo($t[1],Hi);Qt<=fi;)$t[Qt]=a(),Ft.mulTo(Hi,$t[Qt-2],$t[Qt]),Qt+=2}var Gi=B.t-1,br,fs=!0,qi=a(),Wi;for(H=gt(B[Gi])-1;Gi>=0;){for(H>=We?br=B[Gi]>>H-We&fi:(br=(B[Gi]&(1<<H+1)-1)<<We-H,Gi>0&&(br|=B[Gi-1]>>this.DB+H-We)),Qt=ot;(br&1)==0;)br>>=1,--Qt;if((H-=Qt)<0&&(H+=this.DB,--Gi),fs)$t[br].copyTo(It),fs=!1;else{for(;Qt>1;)Ft.sqrTo(It,qi),Ft.sqrTo(qi,It),Qt-=2;Qt>0?Ft.sqrTo(It,qi):(Wi=It,It=qi,qi=Wi),Ft.mulTo(qi,$t[br],It)}for(;Gi>=0&&(B[Gi]&1<<H)==0;)Ft.sqrTo(It,qi),Wi=It,It=qi,qi=Wi,--H<0&&(H=this.DB-1,--Gi)}return Ft.revert(It)}function Br(B){var P=this.s<0?this.negate():this.clone(),H=B.s<0?B.negate():B.clone();if(P.compareTo(H)<0){var ot=P;P=H,H=ot}var It=P.getLowestSetBit(),Ft=H.getLowestSetBit();if(Ft<0)return P;for(It<Ft&&(Ft=It),Ft>0&&(P.rShiftTo(Ft,P),H.rShiftTo(Ft,H));P.signum()>0;)(It=P.getLowestSetBit())>0&&P.rShiftTo(It,P),(It=H.getLowestSetBit())>0&&H.rShiftTo(It,H),P.compareTo(H)>=0?(P.subTo(H,P),P.rShiftTo(1,P)):(H.subTo(P,H),H.rShiftTo(1,H));return Ft>0&&H.lShiftTo(Ft,H),H}function ka(B){if(B<=0)return 0;var P=this.DV%B,H=this.s<0?B-1:0;if(this.t>0)if(P==0)H=this[0]%B;else for(var ot=this.t-1;ot>=0;--ot)H=(P*H+this[ot])%B;return H}function Pa(B){var P=B.isEven();if(this.isEven()&&P||B.signum()==0)return s.ZERO;for(var H=B.clone(),ot=this.clone(),It=k(1),Ft=k(0),$t=k(0),Qt=k(1);H.signum()!=0;){for(;H.isEven();)H.rShiftTo(1,H),P?((!It.isEven()||!Ft.isEven())&&(It.addTo(this,It),Ft.subTo(B,Ft)),It.rShiftTo(1,It)):Ft.isEven()||Ft.subTo(B,Ft),Ft.rShiftTo(1,Ft);for(;ot.isEven();)ot.rShiftTo(1,ot),P?((!$t.isEven()||!Qt.isEven())&&($t.addTo(this,$t),Qt.subTo(B,Qt)),$t.rShiftTo(1,$t)):Qt.isEven()||Qt.subTo(B,Qt),Qt.rShiftTo(1,Qt);H.compareTo(ot)>=0?(H.subTo(ot,H),P&&It.subTo($t,It),Ft.subTo(Qt,Ft)):(ot.subTo(H,ot),P&&$t.subTo(It,$t),Qt.subTo(Ft,Qt))}if(ot.compareTo(s.ONE)!=0)return s.ZERO;if(Qt.compareTo(B)>=0)return Qt.subtract(B);if(Qt.signum()<0)Qt.addTo(B,Qt);else return Qt;return Qt.signum()<0?Qt.add(B):Qt}var Ci=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Gs=(1<<26)/Ci[Ci.length-1];function Da(B){var P,H=this.abs();if(H.t==1&&H[0]<=Ci[Ci.length-1]){for(P=0;P<Ci.length;++P)if(H[0]==Ci[P])return!0;return!1}if(H.isEven())return!1;for(P=1;P<Ci.length;){for(var ot=Ci[P],It=P+1;It<Ci.length&&ot<Gs;)ot*=Ci[It++];for(ot=H.modInt(ot);P<It;)if(ot%Ci[P++]==0)return!1}return H.millerRabin(B)}function La(B){var P=this.subtract(s.ONE),H=P.getLowestSetBit();if(H<=0)return!1;var ot=P.shiftRight(H);B=B+1>>1,B>Ci.length&&(B=Ci.length);for(var It=a(),Ft=0;Ft<B;++Ft){It.fromInt(Ci[Math.floor(Math.random()*Ci.length)]);var $t=It.modPow(ot,this);if($t.compareTo(s.ONE)!=0&&$t.compareTo(P)!=0){for(var Qt=1;Qt++<H&&$t.compareTo(P)!=0;)if($t=$t.modPowInt(2,this),$t.compareTo(s.ONE)==0)return!1;if($t.compareTo(P)!=0)return!1}}return!0}s.prototype.chunkSize=at,s.prototype.toRadix=Kt,s.prototype.fromRadix=Lt,s.prototype.fromNumber=ee,s.prototype.bitwiseTo=rt,s.prototype.changeBit=Mn,s.prototype.addTo=Bn,s.prototype.dMultiply=Pn,s.prototype.dAddOffset=Ma,s.prototype.multiplyLowerTo=Ho,s.prototype.multiplyUpperTo=Go,s.prototype.modInt=ka,s.prototype.millerRabin=La,s.prototype.clone=V,s.prototype.intValue=lt,s.prototype.byteValue=Et,s.prototype.shortValue=Tt,s.prototype.signum=Nt,s.prototype.toByteArray=D,s.prototype.equals=b,s.prototype.min=A,s.prototype.max=W,s.prototype.and=N,s.prototype.or=yt,s.prototype.xor=Wt,s.prototype.andNot=be,s.prototype.not=Ie,s.prototype.shiftLeft=Ne,s.prototype.shiftRight=Be,s.prototype.getLowestSetBit=Ei,s.prototype.bitCount=ss,s.prototype.testBit=Fs,s.prototype.setBit=Os,s.prototype.clearBit=Ta,s.prototype.flipBit=In,s.prototype.add=Rn,s.prototype.subtract=kn,s.prototype.multiply=Sa,s.prototype.divide=Pi,s.prototype.remainder=Ca,s.prototype.divideAndRemainder=Us,s.prototype.modPow=Di,s.prototype.modInverse=Pa,s.prototype.pow=Hs,s.prototype.gcd=Br,s.prototype.isProbablePrime=Da,s.prototype.square=Ns,s.prototype.Barrett=or;var cn,Mi,Je;function Fa(B){Mi[Je++]^=B&255,Mi[Je++]^=B>>8&255,Mi[Je++]^=B>>16&255,Mi[Je++]^=B>>24&255,Je>=wr&&(Je-=wr)}function os(){Fa(new Date().getTime())}if(Mi==null){Mi=new Array,Je=0;var Ii;if(typeof window<"u"&&window.crypto){if(window.crypto.getRandomValues){var hs=new Uint8Array(32);for(window.crypto.getRandomValues(hs),Ii=0;Ii<32;++Ii)Mi[Je++]=hs[Ii]}else if(navigator.appName=="Netscape"&&navigator.appVersion<"5"){var Oa=window.crypto.random(32);for(Ii=0;Ii<Oa.length;++Ii)Mi[Je++]=Oa.charCodeAt(Ii)&255}}for(;Je<wr;)Ii=Math.floor(65536*Math.random()),Mi[Je++]=Ii>>>8,Mi[Je++]=Ii&255;Je=0,os()}function ls(){if(cn==null){for(os(),cn=Rr(),cn.init(Mi),Je=0;Je<Mi.length;++Je)Mi[Je]=0;Je=0}return cn.next()}function hr(B){var P;for(P=0;P<B.length;++P)B[P]=ls()}function lr(){}lr.prototype.nextBytes=hr;function cs(){this.i=0,this.j=0,this.S=new Array}function us(B){var P,H,ot;for(P=0;P<256;++P)this.S[P]=P;for(H=0,P=0;P<256;++P)H=H+this.S[P]+B[P%B.length]&255,ot=this.S[P],this.S[P]=this.S[H],this.S[H]=ot;this.i=0,this.j=0}function ds(){var B;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,B=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=B,this.S[B+this.S[this.i]&255]}cs.prototype.init=us,cs.prototype.next=ds;function Rr(){return new cs}var wr=256;i.exports={default:s,BigInteger:s,SecureRandom:lr}}).call(si)})(Bf);var Dh={},zy=Dh.falseIfInvalid=function(i){return function(){return this.valid?i.apply(this,arguments):!1}};Dh.isInSubnet=zy(function(i){return this.subnetMask<i.subnetMask?!1:this.mask(i.subnetMask)===i.mask()});Dh.isCorrect=function(i){return zy(function(){return this.addressMinusSuffix!==this.correctForm()?!1:this.subnetMask===i&&!this.parsedSubnet?!0:this.parsedSubnet===String(this.subnetMask)})};var Io={};(function(i){(function(){var t={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function e(h){return n(a(h),arguments)}function r(h,u){return e.apply(null,[h].concat(u||[]))}function n(h,u){var d=1,m=h.length,l,f="",p,y,_,v,w,C,E,k;for(p=0;p<m;p++)if(typeof h[p]=="string")f+=h[p];else if(typeof h[p]=="object"){if(_=h[p],_.keys)for(l=u[d],y=0;y<_.keys.length;y++){if(l==null)throw new Error(e('[sprintf] Cannot access property "%s" of undefined value "%s"',_.keys[y],_.keys[y-1]));l=l[_.keys[y]]}else _.param_no?l=u[_.param_no]:l=u[d++];if(t.not_type.test(_.type)&&t.not_primitive.test(_.type)&&l instanceof Function&&(l=l()),t.numeric_arg.test(_.type)&&typeof l!="number"&&isNaN(l))throw new TypeError(e("[sprintf] expecting number but found %T",l));switch(t.number.test(_.type)&&(E=l>=0),_.type){case"b":l=parseInt(l,10).toString(2);break;case"c":l=String.fromCharCode(parseInt(l,10));break;case"d":case"i":l=parseInt(l,10);break;case"j":l=JSON.stringify(l,null,_.width?parseInt(_.width):0);break;case"e":l=_.precision?parseFloat(l).toExponential(_.precision):parseFloat(l).toExponential();break;case"f":l=_.precision?parseFloat(l).toFixed(_.precision):parseFloat(l);break;case"g":l=_.precision?String(Number(l.toPrecision(_.precision))):parseFloat(l);break;case"o":l=(parseInt(l,10)>>>0).toString(8);break;case"s":l=String(l),l=_.precision?l.substring(0,_.precision):l;break;case"t":l=String(!!l),l=_.precision?l.substring(0,_.precision):l;break;case"T":l=Object.prototype.toString.call(l).slice(8,-1).toLowerCase(),l=_.precision?l.substring(0,_.precision):l;break;case"u":l=parseInt(l,10)>>>0;break;case"v":l=l.valueOf(),l=_.precision?l.substring(0,_.precision):l;break;case"x":l=(parseInt(l,10)>>>0).toString(16);break;case"X":l=(parseInt(l,10)>>>0).toString(16).toUpperCase();break}t.json.test(_.type)?f+=l:(t.number.test(_.type)&&(!E||_.sign)?(k=E?"+":"-",l=l.toString().replace(t.sign,"")):k="",w=_.pad_char?_.pad_char==="0"?"0":_.pad_char.charAt(1):" ",C=_.width-(k+l).length,v=_.width&&C>0?w.repeat(C):"",f+=_.align?k+l+v:w==="0"?k+v+l:v+k+l)}return f}var s=Object.create(null);function a(h){if(s[h])return s[h];for(var u=h,d,m=[],l=0;u;){if((d=t.text.exec(u))!==null)m.push(d[0]);else if((d=t.modulo.exec(u))!==null)m.push("%");else if((d=t.placeholder.exec(u))!==null){if(d[2]){l|=1;var f=[],p=d[2],y=[];if((y=t.key.exec(p))!==null)for(f.push(y[1]);(p=p.substring(y[0].length))!=="";)if((y=t.key_access.exec(p))!==null)f.push(y[1]);else if((y=t.index_access.exec(p))!==null)f.push(y[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");d[2]=f}else l|=2;if(l===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");m.push({placeholder:d[0],param_no:d[1],keys:d[2],sign:d[3],pad_char:d[4],align:d[5],width:d[6],precision:d[7],type:d[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");u=u.substring(d[0].length)}return s[h]=m}i.sprintf=e,i.vsprintf=r,typeof window<"u"&&(window.sprintf=e,window.vsprintf=r)})()})(Io);var xc={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(i,t){(function(){var e,r="4.17.21",n=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",h="Invalid `variable` option passed into `_.template`",u="__lodash_hash_undefined__",d=500,m="__lodash_placeholder__",l=1,f=2,p=4,y=1,_=2,v=1,w=2,C=4,E=8,k=16,G=32,Q=64,Y=128,it=256,J=512,st=30,gt="...",j=800,Z=16,T=1,ut=2,Pt=3,pt=1/0,Gt=9007199254740991,bt=17976931348623157e292,xt=0/0,tt=4294967295,et=tt-1,Ht=tt>>>1,Dt=[["ary",Y],["bind",v],["bindKey",w],["curry",E],["curryRight",k],["flip",J],["partial",G],["partialRight",Q],["rearg",it]],Mt="[object Arguments]",te="[object Array]",re="[object AsyncFunction]",Xt="[object Boolean]",qt="[object Date]",le="[object DOMException]",ne="[object Error]",ye="[object Function]",fe="[object GeneratorFunction]",S="[object Map]",At="[object Number]",_t="[object Null]",X="[object Object]",V="[object Promise]",lt="[object Proxy]",Et="[object RegExp]",Tt="[object Set]",at="[object String]",Nt="[object Symbol]",Kt="[object Undefined]",Lt="[object WeakMap]",ee="[object WeakSet]",D="[object ArrayBuffer]",b="[object DataView]",A="[object Float32Array]",W="[object Float64Array]",rt="[object Int8Array]",I="[object Int16Array]",N="[object Int32Array]",mt="[object Uint8Array]",yt="[object Uint8ClampedArray]",Ct="[object Uint16Array]",Wt="[object Uint32Array]",Vt=/\b__p \+= '';/g,be=/\b(__p \+=) '' \+/g,Ie=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ne=/&(?:amp|lt|gt|quot|#39);/g,Be=/[&<>"']/g,Ze=RegExp(Ne.source),Ei=RegExp(Be.source),vr=/<%-([\s\S]+?)%>/g,ss=/<%([\s\S]+?)%>/g,Fs=/<%=([\s\S]+?)%>/g,Mn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Os=/^\w*$/,Ta=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,In=/[\\^$.*+?()[\]{}|]/g,Bn=RegExp(In.source),Rn=/^\s+/,kn=/\s/,Sa=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ns=/\{\n\/\* \[wrapped with (.+)\] \*/,Pi=/,? & /,Ca=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Us=/[()=,{}\[\]\/\s]/,Pn=/\\(\\)?/g,Ma=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Xr=/\w*$/,Ia=/^[-+]0x[0-9a-f]+$/i,No=/^0b[01]+$/i,Uo=/^\[object .+?Constructor\]$/,Hs=/^0o[0-7]+$/i,Ho=/^(?:0|[1-9]\d*)$/,Go=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,or=/($^)/,Wo=/['\n\r\u2028\u2029\\]/g,as="\\ud800-\\udfff",Ba="\\u0300-\\u036f",ln="\\ufe20-\\ufe2f",Ra="\\u20d0-\\u20ff",Di=Ba+ln+Ra,Br="\\u2700-\\u27bf",ka="a-z\\xdf-\\xf6\\xf8-\\xff",Pa="\\xac\\xb1\\xd7\\xf7",Ci="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Gs="\\u2000-\\u206f",Da=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",La="A-Z\\xc0-\\xd6\\xd8-\\xde",cn="\\ufe0e\\ufe0f",Mi=Pa+Ci+Gs+Da,Je="['\u2019]",Fa="["+as+"]",os="["+Mi+"]",Ii="["+Di+"]",hs="\\d+",Oa="["+Br+"]",ls="["+ka+"]",hr="[^"+as+Mi+hs+Br+ka+La+"]",lr="\\ud83c[\\udffb-\\udfff]",cs="(?:"+Ii+"|"+lr+")",us="[^"+as+"]",ds="(?:\\ud83c[\\udde6-\\uddff]){2}",Rr="[\\ud800-\\udbff][\\udc00-\\udfff]",wr="["+La+"]",B="\\u200d",P="(?:"+ls+"|"+hr+")",H="(?:"+wr+"|"+hr+")",ot="(?:"+Je+"(?:d|ll|m|re|s|t|ve))?",It="(?:"+Je+"(?:D|LL|M|RE|S|T|VE))?",Ft=cs+"?",$t="["+cn+"]?",Qt="(?:"+B+"(?:"+[us,ds,Rr].join("|")+")"+$t+Ft+")*",We="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",fi="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Hi=$t+Ft+Qt,Gi="(?:"+[Oa,ds,Rr].join("|")+")"+Hi,br="(?:"+[us+Ii+"?",Ii,ds,Rr,Fa].join("|")+")",fs=RegExp(Je,"g"),qi=RegExp(Ii,"g"),Wi=RegExp(lr+"(?="+lr+")|"+br+Hi,"g"),Dn=RegExp([wr+"?"+ls+"+"+ot+"(?="+[os,wr,"$"].join("|")+")",H+"+"+It+"(?="+[os,wr+P,"$"].join("|")+")",wr+"?"+P+"+"+ot,wr+"+"+It,fi,We,hs,Gi].join("|"),"g"),cr=RegExp("["+B+as+Di+cn+"]"),un=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Oh=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Kc=-1,Xe={};Xe[A]=Xe[W]=Xe[rt]=Xe[I]=Xe[N]=Xe[mt]=Xe[yt]=Xe[Ct]=Xe[Wt]=!0,Xe[Mt]=Xe[te]=Xe[D]=Xe[Xt]=Xe[b]=Xe[qt]=Xe[ne]=Xe[ye]=Xe[S]=Xe[At]=Xe[X]=Xe[Et]=Xe[Tt]=Xe[at]=Xe[Lt]=!1;var Ke={};Ke[Mt]=Ke[te]=Ke[D]=Ke[b]=Ke[Xt]=Ke[qt]=Ke[A]=Ke[W]=Ke[rt]=Ke[I]=Ke[N]=Ke[S]=Ke[At]=Ke[X]=Ke[Et]=Ke[Tt]=Ke[at]=Ke[Nt]=Ke[mt]=Ke[yt]=Ke[Ct]=Ke[Wt]=!0,Ke[ne]=Ke[ye]=Ke[Lt]=!1;var zo={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},Zc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Vo={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Nh={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},jo=parseFloat,M=parseInt,F=typeof si=="object"&&si&&si.Object===Object&&si,$=typeof self=="object"&&self&&self.Object===Object&&self,q=F||$||Function("return this")(),ft=t&&!t.nodeType&&t,ht=ft&&!0&&i&&!i.nodeType&&i,vt=ht&&ht.exports===ft,Bt=vt&&F.process,se=function(){try{var ct=ht&&ht.require&&ht.require("util").types;return ct||Bt&&Bt.binding&&Bt.binding("util")}catch{}}(),_e=se&&se.isArrayBuffer,Ye=se&&se.isDate,Li=se&&se.isMap,dn=se&&se.isRegExp,fn=se&&se.isSet,ur=se&&se.isTypedArray;function Fi(ct,St,wt){switch(wt.length){case 0:return ct.call(St);case 1:return ct.call(St,wt[0]);case 2:return ct.call(St,wt[0],wt[1]);case 3:return ct.call(St,wt[0],wt[1],wt[2])}return ct.apply(St,wt)}function Uh(ct,St,wt,ie){for(var xe=-1,ze=ct==null?0:ct.length;++xe<ze;){var Bi=ct[xe];St(ie,Bi,wt(Bi),ct)}return ie}function kr(ct,St){for(var wt=-1,ie=ct==null?0:ct.length;++wt<ie&&St(ct[wt],wt,ct)!==!1;);return ct}function S_(ct,St){for(var wt=ct==null?0:ct.length;wt--&&St(ct[wt],wt,ct)!==!1;);return ct}function Vf(ct,St){for(var wt=-1,ie=ct==null?0:ct.length;++wt<ie;)if(!St(ct[wt],wt,ct))return!1;return!0}function ps(ct,St){for(var wt=-1,ie=ct==null?0:ct.length,xe=0,ze=[];++wt<ie;){var Bi=ct[wt];St(Bi,wt,ct)&&(ze[xe++]=Bi)}return ze}function Hh(ct,St){var wt=ct==null?0:ct.length;return!!wt&&Na(ct,St,0)>-1}function Qc(ct,St,wt){for(var ie=-1,xe=ct==null?0:ct.length;++ie<xe;)if(wt(St,ct[ie]))return!0;return!1}function ri(ct,St){for(var wt=-1,ie=ct==null?0:ct.length,xe=Array(ie);++wt<ie;)xe[wt]=St(ct[wt],wt,ct);return xe}function ms(ct,St){for(var wt=-1,ie=St.length,xe=ct.length;++wt<ie;)ct[xe+wt]=St[wt];return ct}function Jc(ct,St,wt,ie){var xe=-1,ze=ct==null?0:ct.length;for(ie&&ze&&(wt=ct[++xe]);++xe<ze;)wt=St(wt,ct[xe],xe,ct);return wt}function C_(ct,St,wt,ie){var xe=ct==null?0:ct.length;for(ie&&xe&&(wt=ct[--xe]);xe--;)wt=St(wt,ct[xe],xe,ct);return wt}function tu(ct,St){for(var wt=-1,ie=ct==null?0:ct.length;++wt<ie;)if(St(ct[wt],wt,ct))return!0;return!1}var M_=eu("length");function I_(ct){return ct.split("")}function B_(ct){return ct.match(Ca)||[]}function jf(ct,St,wt){var ie;return wt(ct,function(xe,ze,Bi){if(St(xe,ze,Bi))return ie=ze,!1}),ie}function Gh(ct,St,wt,ie){for(var xe=ct.length,ze=wt+(ie?1:-1);ie?ze--:++ze<xe;)if(St(ct[ze],ze,ct))return ze;return-1}function Na(ct,St,wt){return St===St?W_(ct,St,wt):Gh(ct,Xf,wt)}function R_(ct,St,wt,ie){for(var xe=wt-1,ze=ct.length;++xe<ze;)if(ie(ct[xe],St))return xe;return-1}function Xf(ct){return ct!==ct}function Yf(ct,St){var wt=ct==null?0:ct.length;return wt?ru(ct,St)/wt:xt}function eu(ct){return function(St){return St==null?e:St[ct]}}function iu(ct){return function(St){return ct==null?e:ct[St]}}function $f(ct,St,wt,ie,xe){return xe(ct,function(ze,Bi,Qe){wt=ie?(ie=!1,ze):St(wt,ze,Bi,Qe)}),wt}function k_(ct,St){var wt=ct.length;for(ct.sort(St);wt--;)ct[wt]=ct[wt].value;return ct}function ru(ct,St){for(var wt,ie=-1,xe=ct.length;++ie<xe;){var ze=St(ct[ie]);ze!==e&&(wt=wt===e?ze:wt+ze)}return wt}function nu(ct,St){for(var wt=-1,ie=Array(ct);++wt<ct;)ie[wt]=St(wt);return ie}function P_(ct,St){return ri(St,function(wt){return[wt,ct[wt]]})}function qf(ct){return ct&&ct.slice(0,Jf(ct)+1).replace(Rn,"")}function xr(ct){return function(St){return ct(St)}}function su(ct,St){return ri(St,function(wt){return ct[wt]})}function Xo(ct,St){return ct.has(St)}function Kf(ct,St){for(var wt=-1,ie=ct.length;++wt<ie&&Na(St,ct[wt],0)>-1;);return wt}function Zf(ct,St){for(var wt=ct.length;wt--&&Na(St,ct[wt],0)>-1;);return wt}function D_(ct,St){for(var wt=ct.length,ie=0;wt--;)ct[wt]===St&&++ie;return ie}var L_=iu(zo),F_=iu(Zc);function O_(ct){return"\\"+Nh[ct]}function N_(ct,St){return ct==null?e:ct[St]}function Ua(ct){return cr.test(ct)}function U_(ct){return un.test(ct)}function H_(ct){for(var St,wt=[];!(St=ct.next()).done;)wt.push(St.value);return wt}function au(ct){var St=-1,wt=Array(ct.size);return ct.forEach(function(ie,xe){wt[++St]=[xe,ie]}),wt}function Qf(ct,St){return function(wt){return ct(St(wt))}}function gs(ct,St){for(var wt=-1,ie=ct.length,xe=0,ze=[];++wt<ie;){var Bi=ct[wt];(Bi===St||Bi===m)&&(ct[wt]=m,ze[xe++]=wt)}return ze}function Wh(ct){var St=-1,wt=Array(ct.size);return ct.forEach(function(ie){wt[++St]=ie}),wt}function G_(ct){var St=-1,wt=Array(ct.size);return ct.forEach(function(ie){wt[++St]=[ie,ie]}),wt}function W_(ct,St,wt){for(var ie=wt-1,xe=ct.length;++ie<xe;)if(ct[ie]===St)return ie;return-1}function z_(ct,St,wt){for(var ie=wt+1;ie--;)if(ct[ie]===St)return ie;return ie}function Ha(ct){return Ua(ct)?j_(ct):M_(ct)}function Yr(ct){return Ua(ct)?X_(ct):I_(ct)}function Jf(ct){for(var St=ct.length;St--&&kn.test(ct.charAt(St)););return St}var V_=iu(Vo);function j_(ct){for(var St=Wi.lastIndex=0;Wi.test(ct);)++St;return St}function X_(ct){return ct.match(Wi)||[]}function Y_(ct){return ct.match(Dn)||[]}var $_=function ct(St){St=St==null?q:Ga.defaults(q.Object(),St,Ga.pick(q,Oh));var wt=St.Array,ie=St.Date,xe=St.Error,ze=St.Function,Bi=St.Math,Qe=St.Object,ou=St.RegExp,q_=St.String,Pr=St.TypeError,zh=wt.prototype,K_=ze.prototype,Wa=Qe.prototype,Vh=St["__core-js_shared__"],jh=K_.toString,$e=Wa.hasOwnProperty,Z_=0,tp=function(){var o=/[^.]+$/.exec(Vh&&Vh.keys&&Vh.keys.IE_PROTO||"");return o?"Symbol(src)_1."+o:""}(),Xh=Wa.toString,Q_=jh.call(Qe),J_=q._,tv=ou("^"+jh.call($e).replace(In,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Yh=vt?St.Buffer:e,ys=St.Symbol,$h=St.Uint8Array,ep=Yh?Yh.allocUnsafe:e,qh=Qf(Qe.getPrototypeOf,Qe),ip=Qe.create,rp=Wa.propertyIsEnumerable,Kh=zh.splice,np=ys?ys.isConcatSpreadable:e,Yo=ys?ys.iterator:e,Ws=ys?ys.toStringTag:e,Zh=function(){try{var o=Ys(Qe,"defineProperty");return o({},"",{}),o}catch{}}(),ev=St.clearTimeout!==q.clearTimeout&&St.clearTimeout,iv=ie&&ie.now!==q.Date.now&&ie.now,rv=St.setTimeout!==q.setTimeout&&St.setTimeout,Qh=Bi.ceil,Jh=Bi.floor,hu=Qe.getOwnPropertySymbols,nv=Yh?Yh.isBuffer:e,sp=St.isFinite,sv=zh.join,av=Qf(Qe.keys,Qe),Ri=Bi.max,Ki=Bi.min,ov=ie.now,hv=St.parseInt,ap=Bi.random,lv=zh.reverse,lu=Ys(St,"DataView"),$o=Ys(St,"Map"),cu=Ys(St,"Promise"),za=Ys(St,"Set"),qo=Ys(St,"WeakMap"),Ko=Ys(Qe,"create"),tl=qo&&new qo,Va={},cv=$s(lu),uv=$s($o),dv=$s(cu),fv=$s(za),pv=$s(qo),el=ys?ys.prototype:e,Zo=el?el.valueOf:e,op=el?el.toString:e;function O(o){if(pi(o)&&!Ae(o)&&!(o instanceof De)){if(o instanceof Dr)return o;if($e.call(o,"__wrapped__"))return hm(o)}return new Dr(o)}var ja=function(){function o(){}return function(c){if(!ai(c))return{};if(ip)return ip(c);o.prototype=c;var g=new o;return o.prototype=e,g}}();function il(){}function Dr(o,c){this.__wrapped__=o,this.__actions__=[],this.__chain__=!!c,this.__index__=0,this.__values__=e}O.templateSettings={escape:vr,evaluate:ss,interpolate:Fs,variable:"",imports:{_:O}},O.prototype=il.prototype,O.prototype.constructor=O,Dr.prototype=ja(il.prototype),Dr.prototype.constructor=Dr;function De(o){this.__wrapped__=o,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=tt,this.__views__=[]}function mv(){var o=new De(this.__wrapped__);return o.__actions__=dr(this.__actions__),o.__dir__=this.__dir__,o.__filtered__=this.__filtered__,o.__iteratees__=dr(this.__iteratees__),o.__takeCount__=this.__takeCount__,o.__views__=dr(this.__views__),o}function gv(){if(this.__filtered__){var o=new De(this);o.__dir__=-1,o.__filtered__=!0}else o=this.clone(),o.__dir__*=-1;return o}function yv(){var o=this.__wrapped__.value(),c=this.__dir__,g=Ae(o),x=c<0,R=g?o.length:0,U=Bw(0,R,this.__views__),K=U.start,nt=U.end,dt=nt-K,Rt=x?nt:K-1,kt=this.__iteratees__,Ot=kt.length,Zt=0,oe=Ki(dt,this.__takeCount__);if(!g||!x&&R==dt&&oe==dt)return Rp(o,this.__actions__);var me=[];t:for(;dt--&&Zt<oe;){Rt+=c;for(var Ce=-1,ge=o[Rt];++Ce<Ot;){var Re=kt[Ce],Fe=Re.iteratee,Tr=Re.type,rr=Fe(ge);if(Tr==ut)ge=rr;else if(!rr){if(Tr==T)continue t;break t}}me[Zt++]=ge}return me}De.prototype=ja(il.prototype),De.prototype.constructor=De;function zs(o){var c=-1,g=o==null?0:o.length;for(this.clear();++c<g;){var x=o[c];this.set(x[0],x[1])}}function _v(){this.__data__=Ko?Ko(null):{},this.size=0}function vv(o){var c=this.has(o)&&delete this.__data__[o];return this.size-=c?1:0,c}function wv(o){var c=this.__data__;if(Ko){var g=c[o];return g===u?e:g}return $e.call(c,o)?c[o]:e}function bv(o){var c=this.__data__;return Ko?c[o]!==e:$e.call(c,o)}function xv(o,c){var g=this.__data__;return this.size+=this.has(o)?0:1,g[o]=Ko&&c===e?u:c,this}zs.prototype.clear=_v,zs.prototype.delete=vv,zs.prototype.get=wv,zs.prototype.has=bv,zs.prototype.set=xv;function Ln(o){var c=-1,g=o==null?0:o.length;for(this.clear();++c<g;){var x=o[c];this.set(x[0],x[1])}}function Av(){this.__data__=[],this.size=0}function Ev(o){var c=this.__data__,g=rl(c,o);if(g<0)return!1;var x=c.length-1;return g==x?c.pop():Kh.call(c,g,1),--this.size,!0}function Tv(o){var c=this.__data__,g=rl(c,o);return g<0?e:c[g][1]}function Sv(o){return rl(this.__data__,o)>-1}function Cv(o,c){var g=this.__data__,x=rl(g,o);return x<0?(++this.size,g.push([o,c])):g[x][1]=c,this}Ln.prototype.clear=Av,Ln.prototype.delete=Ev,Ln.prototype.get=Tv,Ln.prototype.has=Sv,Ln.prototype.set=Cv;function Fn(o){var c=-1,g=o==null?0:o.length;for(this.clear();++c<g;){var x=o[c];this.set(x[0],x[1])}}function Mv(){this.size=0,this.__data__={hash:new zs,map:new($o||Ln),string:new zs}}function Iv(o){var c=ml(this,o).delete(o);return this.size-=c?1:0,c}function Bv(o){return ml(this,o).get(o)}function Rv(o){return ml(this,o).has(o)}function kv(o,c){var g=ml(this,o),x=g.size;return g.set(o,c),this.size+=g.size==x?0:1,this}Fn.prototype.clear=Mv,Fn.prototype.delete=Iv,Fn.prototype.get=Bv,Fn.prototype.has=Rv,Fn.prototype.set=kv;function Vs(o){var c=-1,g=o==null?0:o.length;for(this.__data__=new Fn;++c<g;)this.add(o[c])}function Pv(o){return this.__data__.set(o,u),this}function Dv(o){return this.__data__.has(o)}Vs.prototype.add=Vs.prototype.push=Pv,Vs.prototype.has=Dv;function $r(o){var c=this.__data__=new Ln(o);this.size=c.size}function Lv(){this.__data__=new Ln,this.size=0}function Fv(o){var c=this.__data__,g=c.delete(o);return this.size=c.size,g}function Ov(o){return this.__data__.get(o)}function Nv(o){return this.__data__.has(o)}function Uv(o,c){var g=this.__data__;if(g instanceof Ln){var x=g.__data__;if(!$o||x.length<n-1)return x.push([o,c]),this.size=++g.size,this;g=this.__data__=new Fn(x)}return g.set(o,c),this.size=g.size,this}$r.prototype.clear=Lv,$r.prototype.delete=Fv,$r.prototype.get=Ov,$r.prototype.has=Nv,$r.prototype.set=Uv;function hp(o,c){var g=Ae(o),x=!g&&qs(o),R=!g&&!x&&xs(o),U=!g&&!x&&!R&&qa(o),K=g||x||R||U,nt=K?nu(o.length,q_):[],dt=nt.length;for(var Rt in o)(c||$e.call(o,Rt))&&!(K&&(Rt=="length"||R&&(Rt=="offset"||Rt=="parent")||U&&(Rt=="buffer"||Rt=="byteLength"||Rt=="byteOffset")||Hn(Rt,dt)))&&nt.push(Rt);return nt}function lp(o){var c=o.length;return c?o[bu(0,c-1)]:e}function Hv(o,c){return gl(dr(o),js(c,0,o.length))}function Gv(o){return gl(dr(o))}function uu(o,c,g){(g!==e&&!qr(o[c],g)||g===e&&!(c in o))&&On(o,c,g)}function Qo(o,c,g){var x=o[c];(!($e.call(o,c)&&qr(x,g))||g===e&&!(c in o))&&On(o,c,g)}function rl(o,c){for(var g=o.length;g--;)if(qr(o[g][0],c))return g;return-1}function Wv(o,c,g,x){return _s(o,function(R,U,K){c(x,R,g(R),K)}),x}function cp(o,c){return o&&mn(c,Oi(c),o)}function zv(o,c){return o&&mn(c,pr(c),o)}function On(o,c,g){c=="__proto__"&&Zh?Zh(o,c,{configurable:!0,enumerable:!0,value:g,writable:!0}):o[c]=g}function du(o,c){for(var g=-1,x=c.length,R=wt(x),U=o==null;++g<x;)R[g]=U?e:Xu(o,c[g]);return R}function js(o,c,g){return o===o&&(g!==e&&(o=o<=g?o:g),c!==e&&(o=o>=c?o:c)),o}function Lr(o,c,g,x,R,U){var K,nt=c&l,dt=c&f,Rt=c&p;if(g&&(K=R?g(o,x,R,U):g(o)),K!==e)return K;if(!ai(o))return o;var kt=Ae(o);if(kt){if(K=kw(o),!nt)return dr(o,K)}else{var Ot=Zi(o),Zt=Ot==ye||Ot==fe;if(xs(o))return Dp(o,nt);if(Ot==X||Ot==Mt||Zt&&!R){if(K=dt||Zt?{}:Jp(o),!nt)return dt?bw(o,zv(K,o)):ww(o,cp(K,o))}else{if(!Ke[Ot])return R?o:{};K=Pw(o,Ot,nt)}}U||(U=new $r);var oe=U.get(o);if(oe)return oe;U.set(o,K),Mm(o)?o.forEach(function(ge){K.add(Lr(ge,c,g,ge,o,U))}):Sm(o)&&o.forEach(function(ge,Re){K.set(Re,Lr(ge,c,g,Re,o,U))});var me=Rt?dt?ku:Ru:dt?pr:Oi,Ce=kt?e:me(o);return kr(Ce||o,function(ge,Re){Ce&&(Re=ge,ge=o[Re]),Qo(K,Re,Lr(ge,c,g,Re,o,U))}),K}function Vv(o){var c=Oi(o);return function(g){return up(g,o,c)}}function up(o,c,g){var x=g.length;if(o==null)return!x;for(o=Qe(o);x--;){var R=g[x],U=c[R],K=o[R];if(K===e&&!(R in o)||!U(K))return!1}return!0}function dp(o,c,g){if(typeof o!="function")throw new Pr(a);return sh(function(){o.apply(e,g)},c)}function Jo(o,c,g,x){var R=-1,U=Hh,K=!0,nt=o.length,dt=[],Rt=c.length;if(!nt)return dt;g&&(c=ri(c,xr(g))),x?(U=Qc,K=!1):c.length>=n&&(U=Xo,K=!1,c=new Vs(c));t:for(;++R<nt;){var kt=o[R],Ot=g==null?kt:g(kt);if(kt=x||kt!==0?kt:0,K&&Ot===Ot){for(var Zt=Rt;Zt--;)if(c[Zt]===Ot)continue t;dt.push(kt)}else U(c,Ot,x)||dt.push(kt)}return dt}var _s=Up(pn),fp=Up(pu,!0);function jv(o,c){var g=!0;return _s(o,function(x,R,U){return g=!!c(x,R,U),g}),g}function nl(o,c,g){for(var x=-1,R=o.length;++x<R;){var U=o[x],K=c(U);if(K!=null&&(nt===e?K===K&&!Er(K):g(K,nt)))var nt=K,dt=U}return dt}function Xv(o,c,g,x){var R=o.length;for(g=Se(g),g<0&&(g=-g>R?0:R+g),x=x===e||x>R?R:Se(x),x<0&&(x+=R),x=g>x?0:Bm(x);g<x;)o[g++]=c;return o}function pp(o,c){var g=[];return _s(o,function(x,R,U){c(x,R,U)&&g.push(x)}),g}function zi(o,c,g,x,R){var U=-1,K=o.length;for(g||(g=Lw),R||(R=[]);++U<K;){var nt=o[U];c>0&&g(nt)?c>1?zi(nt,c-1,g,x,R):ms(R,nt):x||(R[R.length]=nt)}return R}var fu=Hp(),mp=Hp(!0);function pn(o,c){return o&&fu(o,c,Oi)}function pu(o,c){return o&&mp(o,c,Oi)}function sl(o,c){return ps(c,function(g){return Gn(o[g])})}function Xs(o,c){c=ws(c,o);for(var g=0,x=c.length;o!=null&&g<x;)o=o[gn(c[g++])];return g&&g==x?o:e}function gp(o,c,g){var x=c(o);return Ae(o)?x:ms(x,g(o))}function er(o){return o==null?o===e?Kt:_t:Ws&&Ws in Qe(o)?Iw(o):Ww(o)}function mu(o,c){return o>c}function Yv(o,c){return o!=null&&$e.call(o,c)}function $v(o,c){return o!=null&&c in Qe(o)}function qv(o,c,g){return o>=Ki(c,g)&&o<Ri(c,g)}function gu(o,c,g){for(var x=g?Qc:Hh,R=o[0].length,U=o.length,K=U,nt=wt(U),dt=1/0,Rt=[];K--;){var kt=o[K];K&&c&&(kt=ri(kt,xr(c))),dt=Ki(kt.length,dt),nt[K]=!g&&(c||R>=120&&kt.length>=120)?new Vs(K&&kt):e}kt=o[0];var Ot=-1,Zt=nt[0];t:for(;++Ot<R&&Rt.length<dt;){var oe=kt[Ot],me=c?c(oe):oe;if(oe=g||oe!==0?oe:0,!(Zt?Xo(Zt,me):x(Rt,me,g))){for(K=U;--K;){var Ce=nt[K];if(!(Ce?Xo(Ce,me):x(o[K],me,g)))continue t}Zt&&Zt.push(me),Rt.push(oe)}}return Rt}function Kv(o,c,g,x){return pn(o,function(R,U,K){c(x,g(R),U,K)}),x}function th(o,c,g){c=ws(c,o),o=rm(o,c);var x=o==null?o:o[gn(Or(c))];return x==null?e:Fi(x,o,g)}function yp(o){return pi(o)&&er(o)==Mt}function Zv(o){return pi(o)&&er(o)==D}function Qv(o){return pi(o)&&er(o)==qt}function eh(o,c,g,x,R){return o===c?!0:o==null||c==null||!pi(o)&&!pi(c)?o!==o&&c!==c:Jv(o,c,g,x,eh,R)}function Jv(o,c,g,x,R,U){var K=Ae(o),nt=Ae(c),dt=K?te:Zi(o),Rt=nt?te:Zi(c);dt=dt==Mt?X:dt,Rt=Rt==Mt?X:Rt;var kt=dt==X,Ot=Rt==X,Zt=dt==Rt;if(Zt&&xs(o)){if(!xs(c))return!1;K=!0,kt=!1}if(Zt&&!kt)return U||(U=new $r),K||qa(o)?Kp(o,c,g,x,R,U):Cw(o,c,dt,g,x,R,U);if(!(g&y)){var oe=kt&&$e.call(o,"__wrapped__"),me=Ot&&$e.call(c,"__wrapped__");if(oe||me){var Ce=oe?o.value():o,ge=me?c.value():c;return U||(U=new $r),R(Ce,ge,g,x,U)}}return Zt?(U||(U=new $r),Mw(o,c,g,x,R,U)):!1}function tw(o){return pi(o)&&Zi(o)==S}function yu(o,c,g,x){var R=g.length,U=R,K=!x;if(o==null)return!U;for(o=Qe(o);R--;){var nt=g[R];if(K&&nt[2]?nt[1]!==o[nt[0]]:!(nt[0]in o))return!1}for(;++R<U;){nt=g[R];var dt=nt[0],Rt=o[dt],kt=nt[1];if(K&&nt[2]){if(Rt===e&&!(dt in o))return!1}else{var Ot=new $r;if(x)var Zt=x(Rt,kt,dt,o,c,Ot);if(!(Zt===e?eh(kt,Rt,y|_,x,Ot):Zt))return!1}}return!0}function _p(o){if(!ai(o)||Ow(o))return!1;var c=Gn(o)?tv:Uo;return c.test($s(o))}function ew(o){return pi(o)&&er(o)==Et}function iw(o){return pi(o)&&Zi(o)==Tt}function rw(o){return pi(o)&&xl(o.length)&&!!Xe[er(o)]}function vp(o){return typeof o=="function"?o:o==null?mr:typeof o=="object"?Ae(o)?xp(o[0],o[1]):bp(o):Gm(o)}function _u(o){if(!nh(o))return av(o);var c=[];for(var g in Qe(o))$e.call(o,g)&&g!="constructor"&&c.push(g);return c}function sw(o){if(!ai(o))return Gw(o);var c=nh(o),g=[];for(var x in o)x=="constructor"&&(c||!$e.call(o,x))||g.push(x);return g}function vu(o,c){return o<c}function wp(o,c){var g=-1,x=fr(o)?wt(o.length):[];return _s(o,function(R,U,K){x[++g]=c(R,U,K)}),x}function bp(o){var c=Du(o);return c.length==1&&c[0][2]?em(c[0][0],c[0][1]):function(g){return g===o||yu(g,o,c)}}function xp(o,c){return Fu(o)&&tm(c)?em(gn(o),c):function(g){var x=Xu(g,o);return x===e&&x===c?Yu(g,o):eh(c,x,y|_)}}function al(o,c,g,x,R){o!==c&&fu(c,function(U,K){if(R||(R=new $r),ai(U))aw(o,c,K,g,al,x,R);else{var nt=x?x(Nu(o,K),U,K+"",o,c,R):e;nt===e&&(nt=U),uu(o,K,nt)}},pr)}function aw(o,c,g,x,R,U,K){var nt=Nu(o,g),dt=Nu(c,g),Rt=K.get(dt);if(Rt){uu(o,g,Rt);return}var kt=U?U(nt,dt,g+"",o,c,K):e,Ot=kt===e;if(Ot){var Zt=Ae(dt),oe=!Zt&&xs(dt),me=!Zt&&!oe&&qa(dt);kt=dt,Zt||oe||me?Ae(nt)?kt=nt:vi(nt)?kt=dr(nt):oe?(Ot=!1,kt=Dp(dt,!0)):me?(Ot=!1,kt=Lp(dt,!0)):kt=[]:ah(dt)||qs(dt)?(kt=nt,qs(nt)?kt=Rm(nt):(!ai(nt)||Gn(nt))&&(kt=Jp(dt))):Ot=!1}Ot&&(K.set(dt,kt),R(kt,dt,x,U,K),K.delete(dt)),uu(o,g,kt)}function Ap(o,c){var g=o.length;if(!!g)return c+=c<0?g:0,Hn(c,g)?o[c]:e}function Ep(o,c,g){c.length?c=ri(c,function(U){return Ae(U)?function(K){return Xs(K,U.length===1?U[0]:U)}:U}):c=[mr];var x=-1;c=ri(c,xr(pe()));var R=wp(o,function(U,K,nt){var dt=ri(c,function(Rt){return Rt(U)});return{criteria:dt,index:++x,value:U}});return k_(R,function(U,K){return vw(U,K,g)})}function ow(o,c){return Tp(o,c,function(g,x){return Yu(o,x)})}function Tp(o,c,g){for(var x=-1,R=c.length,U={};++x<R;){var K=c[x],nt=Xs(o,K);g(nt,K)&&ih(U,ws(K,o),nt)}return U}function hw(o){return function(c){return Xs(c,o)}}function wu(o,c,g,x){var R=x?R_:Na,U=-1,K=c.length,nt=o;for(o===c&&(c=dr(c)),g&&(nt=ri(o,xr(g)));++U<K;)for(var dt=0,Rt=c[U],kt=g?g(Rt):Rt;(dt=R(nt,kt,dt,x))>-1;)nt!==o&&Kh.call(nt,dt,1),Kh.call(o,dt,1);return o}function Sp(o,c){for(var g=o?c.length:0,x=g-1;g--;){var R=c[g];if(g==x||R!==U){var U=R;Hn(R)?Kh.call(o,R,1):Eu(o,R)}}return o}function bu(o,c){return o+Jh(ap()*(c-o+1))}function lw(o,c,g,x){for(var R=-1,U=Ri(Qh((c-o)/(g||1)),0),K=wt(U);U--;)K[x?U:++R]=o,o+=g;return K}function xu(o,c){var g="";if(!o||c<1||c>Gt)return g;do c%2&&(g+=o),c=Jh(c/2),c&&(o+=o);while(c);return g}function Me(o,c){return Uu(im(o,c,mr),o+"")}function cw(o){return lp(Ka(o))}function uw(o,c){var g=Ka(o);return gl(g,js(c,0,g.length))}function ih(o,c,g,x){if(!ai(o))return o;c=ws(c,o);for(var R=-1,U=c.length,K=U-1,nt=o;nt!=null&&++R<U;){var dt=gn(c[R]),Rt=g;if(dt==="__proto__"||dt==="constructor"||dt==="prototype")return o;if(R!=K){var kt=nt[dt];Rt=x?x(kt,dt,nt):e,Rt===e&&(Rt=ai(kt)?kt:Hn(c[R+1])?[]:{})}Qo(nt,dt,Rt),nt=nt[dt]}return o}var Cp=tl?function(o,c){return tl.set(o,c),o}:mr,dw=Zh?function(o,c){return Zh(o,"toString",{configurable:!0,enumerable:!1,value:qu(c),writable:!0})}:mr;function fw(o){return gl(Ka(o))}function Fr(o,c,g){var x=-1,R=o.length;c<0&&(c=-c>R?0:R+c),g=g>R?R:g,g<0&&(g+=R),R=c>g?0:g-c>>>0,c>>>=0;for(var U=wt(R);++x<R;)U[x]=o[x+c];return U}function pw(o,c){var g;return _s(o,function(x,R,U){return g=c(x,R,U),!g}),!!g}function ol(o,c,g){var x=0,R=o==null?x:o.length;if(typeof c=="number"&&c===c&&R<=Ht){for(;x<R;){var U=x+R>>>1,K=o[U];K!==null&&!Er(K)&&(g?K<=c:K<c)?x=U+1:R=U}return R}return Au(o,c,mr,g)}function Au(o,c,g,x){var R=0,U=o==null?0:o.length;if(U===0)return 0;c=g(c);for(var K=c!==c,nt=c===null,dt=Er(c),Rt=c===e;R<U;){var kt=Jh((R+U)/2),Ot=g(o[kt]),Zt=Ot!==e,oe=Ot===null,me=Ot===Ot,Ce=Er(Ot);if(K)var ge=x||me;else Rt?ge=me&&(x||Zt):nt?ge=me&&Zt&&(x||!oe):dt?ge=me&&Zt&&!oe&&(x||!Ce):oe||Ce?ge=!1:ge=x?Ot<=c:Ot<c;ge?R=kt+1:U=kt}return Ki(U,et)}function Mp(o,c){for(var g=-1,x=o.length,R=0,U=[];++g<x;){var K=o[g],nt=c?c(K):K;if(!g||!qr(nt,dt)){var dt=nt;U[R++]=K===0?0:K}}return U}function Ip(o){return typeof o=="number"?o:Er(o)?xt:+o}function Ar(o){if(typeof o=="string")return o;if(Ae(o))return ri(o,Ar)+"";if(Er(o))return op?op.call(o):"";var c=o+"";return c=="0"&&1/o==-pt?"-0":c}function vs(o,c,g){var x=-1,R=Hh,U=o.length,K=!0,nt=[],dt=nt;if(g)K=!1,R=Qc;else if(U>=n){var Rt=c?null:Tw(o);if(Rt)return Wh(Rt);K=!1,R=Xo,dt=new Vs}else dt=c?[]:nt;t:for(;++x<U;){var kt=o[x],Ot=c?c(kt):kt;if(kt=g||kt!==0?kt:0,K&&Ot===Ot){for(var Zt=dt.length;Zt--;)if(dt[Zt]===Ot)continue t;c&&dt.push(Ot),nt.push(kt)}else R(dt,Ot,g)||(dt!==nt&&dt.push(Ot),nt.push(kt))}return nt}function Eu(o,c){return c=ws(c,o),o=rm(o,c),o==null||delete o[gn(Or(c))]}function Bp(o,c,g,x){return ih(o,c,g(Xs(o,c)),x)}function hl(o,c,g,x){for(var R=o.length,U=x?R:-1;(x?U--:++U<R)&&c(o[U],U,o););return g?Fr(o,x?0:U,x?U+1:R):Fr(o,x?U+1:0,x?R:U)}function Rp(o,c){var g=o;return g instanceof De&&(g=g.value()),Jc(c,function(x,R){return R.func.apply(R.thisArg,ms([x],R.args))},g)}function Tu(o,c,g){var x=o.length;if(x<2)return x?vs(o[0]):[];for(var R=-1,U=wt(x);++R<x;)for(var K=o[R],nt=-1;++nt<x;)nt!=R&&(U[R]=Jo(U[R]||K,o[nt],c,g));return vs(zi(U,1),c,g)}function kp(o,c,g){for(var x=-1,R=o.length,U=c.length,K={};++x<R;){var nt=x<U?c[x]:e;g(K,o[x],nt)}return K}function Su(o){return vi(o)?o:[]}function Cu(o){return typeof o=="function"?o:mr}function ws(o,c){return Ae(o)?o:Fu(o,c)?[o]:om(je(o))}var mw=Me;function bs(o,c,g){var x=o.length;return g=g===e?x:g,!c&&g>=x?o:Fr(o,c,g)}var Pp=ev||function(o){return q.clearTimeout(o)};function Dp(o,c){if(c)return o.slice();var g=o.length,x=ep?ep(g):new o.constructor(g);return o.copy(x),x}function Mu(o){var c=new o.constructor(o.byteLength);return new $h(c).set(new $h(o)),c}function gw(o,c){var g=c?Mu(o.buffer):o.buffer;return new o.constructor(g,o.byteOffset,o.byteLength)}function yw(o){var c=new o.constructor(o.source,Xr.exec(o));return c.lastIndex=o.lastIndex,c}function _w(o){return Zo?Qe(Zo.call(o)):{}}function Lp(o,c){var g=c?Mu(o.buffer):o.buffer;return new o.constructor(g,o.byteOffset,o.length)}function Fp(o,c){if(o!==c){var g=o!==e,x=o===null,R=o===o,U=Er(o),K=c!==e,nt=c===null,dt=c===c,Rt=Er(c);if(!nt&&!Rt&&!U&&o>c||U&&K&&dt&&!nt&&!Rt||x&&K&&dt||!g&&dt||!R)return 1;if(!x&&!U&&!Rt&&o<c||Rt&&g&&R&&!x&&!U||nt&&g&&R||!K&&R||!dt)return-1}return 0}function vw(o,c,g){for(var x=-1,R=o.criteria,U=c.criteria,K=R.length,nt=g.length;++x<K;){var dt=Fp(R[x],U[x]);if(dt){if(x>=nt)return dt;var Rt=g[x];return dt*(Rt=="desc"?-1:1)}}return o.index-c.index}function Op(o,c,g,x){for(var R=-1,U=o.length,K=g.length,nt=-1,dt=c.length,Rt=Ri(U-K,0),kt=wt(dt+Rt),Ot=!x;++nt<dt;)kt[nt]=c[nt];for(;++R<K;)(Ot||R<U)&&(kt[g[R]]=o[R]);for(;Rt--;)kt[nt++]=o[R++];return kt}function Np(o,c,g,x){for(var R=-1,U=o.length,K=-1,nt=g.length,dt=-1,Rt=c.length,kt=Ri(U-nt,0),Ot=wt(kt+Rt),Zt=!x;++R<kt;)Ot[R]=o[R];for(var oe=R;++dt<Rt;)Ot[oe+dt]=c[dt];for(;++K<nt;)(Zt||R<U)&&(Ot[oe+g[K]]=o[R++]);return Ot}function dr(o,c){var g=-1,x=o.length;for(c||(c=wt(x));++g<x;)c[g]=o[g];return c}function mn(o,c,g,x){var R=!g;g||(g={});for(var U=-1,K=c.length;++U<K;){var nt=c[U],dt=x?x(g[nt],o[nt],nt,g,o):e;dt===e&&(dt=o[nt]),R?On(g,nt,dt):Qo(g,nt,dt)}return g}function ww(o,c){return mn(o,Lu(o),c)}function bw(o,c){return mn(o,Zp(o),c)}function ll(o,c){return function(g,x){var R=Ae(g)?Uh:Wv,U=c?c():{};return R(g,o,pe(x,2),U)}}function Xa(o){return Me(function(c,g){var x=-1,R=g.length,U=R>1?g[R-1]:e,K=R>2?g[2]:e;for(U=o.length>3&&typeof U=="function"?(R--,U):e,K&&ir(g[0],g[1],K)&&(U=R<3?e:U,R=1),c=Qe(c);++x<R;){var nt=g[x];nt&&o(c,nt,x,U)}return c})}function Up(o,c){return function(g,x){if(g==null)return g;if(!fr(g))return o(g,x);for(var R=g.length,U=c?R:-1,K=Qe(g);(c?U--:++U<R)&&x(K[U],U,K)!==!1;);return g}}function Hp(o){return function(c,g,x){for(var R=-1,U=Qe(c),K=x(c),nt=K.length;nt--;){var dt=K[o?nt:++R];if(g(U[dt],dt,U)===!1)break}return c}}function xw(o,c,g){var x=c&v,R=rh(o);function U(){var K=this&&this!==q&&this instanceof U?R:o;return K.apply(x?g:this,arguments)}return U}function Gp(o){return function(c){c=je(c);var g=Ua(c)?Yr(c):e,x=g?g[0]:c.charAt(0),R=g?bs(g,1).join(""):c.slice(1);return x[o]()+R}}function Ya(o){return function(c){return Jc(Um(Nm(c).replace(fs,"")),o,"")}}function rh(o){return function(){var c=arguments;switch(c.length){case 0:return new o;case 1:return new o(c[0]);case 2:return new o(c[0],c[1]);case 3:return new o(c[0],c[1],c[2]);case 4:return new o(c[0],c[1],c[2],c[3]);case 5:return new o(c[0],c[1],c[2],c[3],c[4]);case 6:return new o(c[0],c[1],c[2],c[3],c[4],c[5]);case 7:return new o(c[0],c[1],c[2],c[3],c[4],c[5],c[6])}var g=ja(o.prototype),x=o.apply(g,c);return ai(x)?x:g}}function Aw(o,c,g){var x=rh(o);function R(){for(var U=arguments.length,K=wt(U),nt=U,dt=$a(R);nt--;)K[nt]=arguments[nt];var Rt=U<3&&K[0]!==dt&&K[U-1]!==dt?[]:gs(K,dt);if(U-=Rt.length,U<g)return Xp(o,c,cl,R.placeholder,e,K,Rt,e,e,g-U);var kt=this&&this!==q&&this instanceof R?x:o;return Fi(kt,this,K)}return R}function Wp(o){return function(c,g,x){var R=Qe(c);if(!fr(c)){var U=pe(g,3);c=Oi(c),g=function(nt){return U(R[nt],nt,R)}}var K=o(c,g,x);return K>-1?R[U?c[K]:K]:e}}function zp(o){return Un(function(c){var g=c.length,x=g,R=Dr.prototype.thru;for(o&&c.reverse();x--;){var U=c[x];if(typeof U!="function")throw new Pr(a);if(R&&!K&&pl(U)=="wrapper")var K=new Dr([],!0)}for(x=K?x:g;++x<g;){U=c[x];var nt=pl(U),dt=nt=="wrapper"?Pu(U):e;dt&&Ou(dt[0])&&dt[1]==(Y|E|G|it)&&!dt[4].length&&dt[9]==1?K=K[pl(dt[0])].apply(K,dt[3]):K=U.length==1&&Ou(U)?K[nt]():K.thru(U)}return function(){var Rt=arguments,kt=Rt[0];if(K&&Rt.length==1&&Ae(kt))return K.plant(kt).value();for(var Ot=0,Zt=g?c[Ot].apply(this,Rt):kt;++Ot<g;)Zt=c[Ot].call(this,Zt);return Zt}})}function cl(o,c,g,x,R,U,K,nt,dt,Rt){var kt=c&Y,Ot=c&v,Zt=c&w,oe=c&(E|k),me=c&J,Ce=Zt?e:rh(o);function ge(){for(var Re=arguments.length,Fe=wt(Re),Tr=Re;Tr--;)Fe[Tr]=arguments[Tr];if(oe)var rr=$a(ge),Sr=D_(Fe,rr);if(x&&(Fe=Op(Fe,x,R,oe)),U&&(Fe=Np(Fe,U,K,oe)),Re-=Sr,oe&&Re<Rt){var wi=gs(Fe,rr);return Xp(o,c,cl,ge.placeholder,g,Fe,wi,nt,dt,Rt-Re)}var Kr=Ot?g:this,zn=Zt?Kr[o]:o;return Re=Fe.length,nt?Fe=zw(Fe,nt):me&&Re>1&&Fe.reverse(),kt&&dt<Re&&(Fe.length=dt),this&&this!==q&&this instanceof ge&&(zn=Ce||rh(zn)),zn.apply(Kr,Fe)}return ge}function Vp(o,c){return function(g,x){return Kv(g,o,c(x),{})}}function ul(o,c){return function(g,x){var R;if(g===e&&x===e)return c;if(g!==e&&(R=g),x!==e){if(R===e)return x;typeof g=="string"||typeof x=="string"?(g=Ar(g),x=Ar(x)):(g=Ip(g),x=Ip(x)),R=o(g,x)}return R}}function Iu(o){return Un(function(c){return c=ri(c,xr(pe())),Me(function(g){var x=this;return o(c,function(R){return Fi(R,x,g)})})})}function dl(o,c){c=c===e?" ":Ar(c);var g=c.length;if(g<2)return g?xu(c,o):c;var x=xu(c,Qh(o/Ha(c)));return Ua(c)?bs(Yr(x),0,o).join(""):x.slice(0,o)}function Ew(o,c,g,x){var R=c&v,U=rh(o);function K(){for(var nt=-1,dt=arguments.length,Rt=-1,kt=x.length,Ot=wt(kt+dt),Zt=this&&this!==q&&this instanceof K?U:o;++Rt<kt;)Ot[Rt]=x[Rt];for(;dt--;)Ot[Rt++]=arguments[++nt];return Fi(Zt,R?g:this,Ot)}return K}function jp(o){return function(c,g,x){return x&&typeof x!="number"&&ir(c,g,x)&&(g=x=e),c=Wn(c),g===e?(g=c,c=0):g=Wn(g),x=x===e?c<g?1:-1:Wn(x),lw(c,g,x,o)}}function fl(o){return function(c,g){return typeof c=="string"&&typeof g=="string"||(c=Nr(c),g=Nr(g)),o(c,g)}}function Xp(o,c,g,x,R,U,K,nt,dt,Rt){var kt=c&E,Ot=kt?K:e,Zt=kt?e:K,oe=kt?U:e,me=kt?e:U;c|=kt?G:Q,c&=~(kt?Q:G),c&C||(c&=~(v|w));var Ce=[o,c,R,oe,Ot,me,Zt,nt,dt,Rt],ge=g.apply(e,Ce);return Ou(o)&&nm(ge,Ce),ge.placeholder=x,sm(ge,o,c)}function Bu(o){var c=Bi[o];return function(g,x){if(g=Nr(g),x=x==null?0:Ki(Se(x),292),x&&sp(g)){var R=(je(g)+"e").split("e"),U=c(R[0]+"e"+(+R[1]+x));return R=(je(U)+"e").split("e"),+(R[0]+"e"+(+R[1]-x))}return c(g)}}var Tw=za&&1/Wh(new za([,-0]))[1]==pt?function(o){return new za(o)}:Qu;function Yp(o){return function(c){var g=Zi(c);return g==S?au(c):g==Tt?G_(c):P_(c,o(c))}}function Nn(o,c,g,x,R,U,K,nt){var dt=c&w;if(!dt&&typeof o!="function")throw new Pr(a);var Rt=x?x.length:0;if(Rt||(c&=~(G|Q),x=R=e),K=K===e?K:Ri(Se(K),0),nt=nt===e?nt:Se(nt),Rt-=R?R.length:0,c&Q){var kt=x,Ot=R;x=R=e}var Zt=dt?e:Pu(o),oe=[o,c,g,x,R,kt,Ot,U,K,nt];if(Zt&&Hw(oe,Zt),o=oe[0],c=oe[1],g=oe[2],x=oe[3],R=oe[4],nt=oe[9]=oe[9]===e?dt?0:o.length:Ri(oe[9]-Rt,0),!nt&&c&(E|k)&&(c&=~(E|k)),!c||c==v)var me=xw(o,c,g);else c==E||c==k?me=Aw(o,c,nt):(c==G||c==(v|G))&&!R.length?me=Ew(o,c,g,x):me=cl.apply(e,oe);var Ce=Zt?Cp:nm;return sm(Ce(me,oe),o,c)}function $p(o,c,g,x){return o===e||qr(o,Wa[g])&&!$e.call(x,g)?c:o}function qp(o,c,g,x,R,U){return ai(o)&&ai(c)&&(U.set(c,o),al(o,c,e,qp,U),U.delete(c)),o}function Sw(o){return ah(o)?e:o}function Kp(o,c,g,x,R,U){var K=g&y,nt=o.length,dt=c.length;if(nt!=dt&&!(K&&dt>nt))return!1;var Rt=U.get(o),kt=U.get(c);if(Rt&&kt)return Rt==c&&kt==o;var Ot=-1,Zt=!0,oe=g&_?new Vs:e;for(U.set(o,c),U.set(c,o);++Ot<nt;){var me=o[Ot],Ce=c[Ot];if(x)var ge=K?x(Ce,me,Ot,c,o,U):x(me,Ce,Ot,o,c,U);if(ge!==e){if(ge)continue;Zt=!1;break}if(oe){if(!tu(c,function(Re,Fe){if(!Xo(oe,Fe)&&(me===Re||R(me,Re,g,x,U)))return oe.push(Fe)})){Zt=!1;break}}else if(!(me===Ce||R(me,Ce,g,x,U))){Zt=!1;break}}return U.delete(o),U.delete(c),Zt}function Cw(o,c,g,x,R,U,K){switch(g){case b:if(o.byteLength!=c.byteLength||o.byteOffset!=c.byteOffset)return!1;o=o.buffer,c=c.buffer;case D:return!(o.byteLength!=c.byteLength||!U(new $h(o),new $h(c)));case Xt:case qt:case At:return qr(+o,+c);case ne:return o.name==c.name&&o.message==c.message;case Et:case at:return o==c+"";case S:var nt=au;case Tt:var dt=x&y;if(nt||(nt=Wh),o.size!=c.size&&!dt)return!1;var Rt=K.get(o);if(Rt)return Rt==c;x|=_,K.set(o,c);var kt=Kp(nt(o),nt(c),x,R,U,K);return K.delete(o),kt;case Nt:if(Zo)return Zo.call(o)==Zo.call(c)}return!1}function Mw(o,c,g,x,R,U){var K=g&y,nt=Ru(o),dt=nt.length,Rt=Ru(c),kt=Rt.length;if(dt!=kt&&!K)return!1;for(var Ot=dt;Ot--;){var Zt=nt[Ot];if(!(K?Zt in c:$e.call(c,Zt)))return!1}var oe=U.get(o),me=U.get(c);if(oe&&me)return oe==c&&me==o;var Ce=!0;U.set(o,c),U.set(c,o);for(var ge=K;++Ot<dt;){Zt=nt[Ot];var Re=o[Zt],Fe=c[Zt];if(x)var Tr=K?x(Fe,Re,Zt,c,o,U):x(Re,Fe,Zt,o,c,U);if(!(Tr===e?Re===Fe||R(Re,Fe,g,x,U):Tr)){Ce=!1;break}ge||(ge=Zt=="constructor")}if(Ce&&!ge){var rr=o.constructor,Sr=c.constructor;rr!=Sr&&"constructor"in o&&"constructor"in c&&!(typeof rr=="function"&&rr instanceof rr&&typeof Sr=="function"&&Sr instanceof Sr)&&(Ce=!1)}return U.delete(o),U.delete(c),Ce}function Un(o){return Uu(im(o,e,um),o+"")}function Ru(o){return gp(o,Oi,Lu)}function ku(o){return gp(o,pr,Zp)}var Pu=tl?function(o){return tl.get(o)}:Qu;function pl(o){for(var c=o.name+"",g=Va[c],x=$e.call(Va,c)?g.length:0;x--;){var R=g[x],U=R.func;if(U==null||U==o)return R.name}return c}function $a(o){var c=$e.call(O,"placeholder")?O:o;return c.placeholder}function pe(){var o=O.iteratee||Ku;return o=o===Ku?vp:o,arguments.length?o(arguments[0],arguments[1]):o}function ml(o,c){var g=o.__data__;return Fw(c)?g[typeof c=="string"?"string":"hash"]:g.map}function Du(o){for(var c=Oi(o),g=c.length;g--;){var x=c[g],R=o[x];c[g]=[x,R,tm(R)]}return c}function Ys(o,c){var g=N_(o,c);return _p(g)?g:e}function Iw(o){var c=$e.call(o,Ws),g=o[Ws];try{o[Ws]=e;var x=!0}catch{}var R=Xh.call(o);return x&&(c?o[Ws]=g:delete o[Ws]),R}var Lu=hu?function(o){return o==null?[]:(o=Qe(o),ps(hu(o),function(c){return rp.call(o,c)}))}:Ju,Zp=hu?function(o){for(var c=[];o;)ms(c,Lu(o)),o=qh(o);return c}:Ju,Zi=er;(lu&&Zi(new lu(new ArrayBuffer(1)))!=b||$o&&Zi(new $o)!=S||cu&&Zi(cu.resolve())!=V||za&&Zi(new za)!=Tt||qo&&Zi(new qo)!=Lt)&&(Zi=function(o){var c=er(o),g=c==X?o.constructor:e,x=g?$s(g):"";if(x)switch(x){case cv:return b;case uv:return S;case dv:return V;case fv:return Tt;case pv:return Lt}return c});function Bw(o,c,g){for(var x=-1,R=g.length;++x<R;){var U=g[x],K=U.size;switch(U.type){case"drop":o+=K;break;case"dropRight":c-=K;break;case"take":c=Ki(c,o+K);break;case"takeRight":o=Ri(o,c-K);break}}return{start:o,end:c}}function Rw(o){var c=o.match(Ns);return c?c[1].split(Pi):[]}function Qp(o,c,g){c=ws(c,o);for(var x=-1,R=c.length,U=!1;++x<R;){var K=gn(c[x]);if(!(U=o!=null&&g(o,K)))break;o=o[K]}return U||++x!=R?U:(R=o==null?0:o.length,!!R&&xl(R)&&Hn(K,R)&&(Ae(o)||qs(o)))}function kw(o){var c=o.length,g=new o.constructor(c);return c&&typeof o[0]=="string"&&$e.call(o,"index")&&(g.index=o.index,g.input=o.input),g}function Jp(o){return typeof o.constructor=="function"&&!nh(o)?ja(qh(o)):{}}function Pw(o,c,g){var x=o.constructor;switch(c){case D:return Mu(o);case Xt:case qt:return new x(+o);case b:return gw(o,g);case A:case W:case rt:case I:case N:case mt:case yt:case Ct:case Wt:return Lp(o,g);case S:return new x;case At:case at:return new x(o);case Et:return yw(o);case Tt:return new x;case Nt:return _w(o)}}function Dw(o,c){var g=c.length;if(!g)return o;var x=g-1;return c[x]=(g>1?"& ":"")+c[x],c=c.join(g>2?", ":" "),o.replace(Sa,`{
/* [wrapped with `+c+`] */
`)}function Lw(o){return Ae(o)||qs(o)||!!(np&&o&&o[np])}function Hn(o,c){var g=typeof o;return c=c??Gt,!!c&&(g=="number"||g!="symbol"&&Ho.test(o))&&o>-1&&o%1==0&&o<c}function ir(o,c,g){if(!ai(g))return!1;var x=typeof c;return(x=="number"?fr(g)&&Hn(c,g.length):x=="string"&&c in g)?qr(g[c],o):!1}function Fu(o,c){if(Ae(o))return!1;var g=typeof o;return g=="number"||g=="symbol"||g=="boolean"||o==null||Er(o)?!0:Os.test(o)||!Mn.test(o)||c!=null&&o in Qe(c)}function Fw(o){var c=typeof o;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?o!=="__proto__":o===null}function Ou(o){var c=pl(o),g=O[c];if(typeof g!="function"||!(c in De.prototype))return!1;if(o===g)return!0;var x=Pu(g);return!!x&&o===x[0]}function Ow(o){return!!tp&&tp in o}var Nw=Vh?Gn:td;function nh(o){var c=o&&o.constructor,g=typeof c=="function"&&c.prototype||Wa;return o===g}function tm(o){return o===o&&!ai(o)}function em(o,c){return function(g){return g==null?!1:g[o]===c&&(c!==e||o in Qe(g))}}function Uw(o){var c=wl(o,function(x){return g.size===d&&g.clear(),x}),g=c.cache;return c}function Hw(o,c){var g=o[1],x=c[1],R=g|x,U=R<(v|w|Y),K=x==Y&&g==E||x==Y&&g==it&&o[7].length<=c[8]||x==(Y|it)&&c[7].length<=c[8]&&g==E;if(!(U||K))return o;x&v&&(o[2]=c[2],R|=g&v?0:C);var nt=c[3];if(nt){var dt=o[3];o[3]=dt?Op(dt,nt,c[4]):nt,o[4]=dt?gs(o[3],m):c[4]}return nt=c[5],nt&&(dt=o[5],o[5]=dt?Np(dt,nt,c[6]):nt,o[6]=dt?gs(o[5],m):c[6]),nt=c[7],nt&&(o[7]=nt),x&Y&&(o[8]=o[8]==null?c[8]:Ki(o[8],c[8])),o[9]==null&&(o[9]=c[9]),o[0]=c[0],o[1]=R,o}function Gw(o){var c=[];if(o!=null)for(var g in Qe(o))c.push(g);return c}function Ww(o){return Xh.call(o)}function im(o,c,g){return c=Ri(c===e?o.length-1:c,0),function(){for(var x=arguments,R=-1,U=Ri(x.length-c,0),K=wt(U);++R<U;)K[R]=x[c+R];R=-1;for(var nt=wt(c+1);++R<c;)nt[R]=x[R];return nt[c]=g(K),Fi(o,this,nt)}}function rm(o,c){return c.length<2?o:Xs(o,Fr(c,0,-1))}function zw(o,c){for(var g=o.length,x=Ki(c.length,g),R=dr(o);x--;){var U=c[x];o[x]=Hn(U,g)?R[U]:e}return o}function Nu(o,c){if(!(c==="constructor"&&typeof o[c]=="function")&&c!="__proto__")return o[c]}var nm=am(Cp),sh=rv||function(o,c){return q.setTimeout(o,c)},Uu=am(dw);function sm(o,c,g){var x=c+"";return Uu(o,Dw(x,Vw(Rw(x),g)))}function am(o){var c=0,g=0;return function(){var x=ov(),R=Z-(x-g);if(g=x,R>0){if(++c>=j)return arguments[0]}else c=0;return o.apply(e,arguments)}}function gl(o,c){var g=-1,x=o.length,R=x-1;for(c=c===e?x:c;++g<c;){var U=bu(g,R),K=o[U];o[U]=o[g],o[g]=K}return o.length=c,o}var om=Uw(function(o){var c=[];return o.charCodeAt(0)===46&&c.push(""),o.replace(Ta,function(g,x,R,U){c.push(R?U.replace(Pn,"$1"):x||g)}),c});function gn(o){if(typeof o=="string"||Er(o))return o;var c=o+"";return c=="0"&&1/o==-pt?"-0":c}function $s(o){if(o!=null){try{return jh.call(o)}catch{}try{return o+""}catch{}}return""}function Vw(o,c){return kr(Dt,function(g){var x="_."+g[0];c&g[1]&&!Hh(o,x)&&o.push(x)}),o.sort()}function hm(o){if(o instanceof De)return o.clone();var c=new Dr(o.__wrapped__,o.__chain__);return c.__actions__=dr(o.__actions__),c.__index__=o.__index__,c.__values__=o.__values__,c}function jw(o,c,g){(g?ir(o,c,g):c===e)?c=1:c=Ri(Se(c),0);var x=o==null?0:o.length;if(!x||c<1)return[];for(var R=0,U=0,K=wt(Qh(x/c));R<x;)K[U++]=Fr(o,R,R+=c);return K}function Xw(o){for(var c=-1,g=o==null?0:o.length,x=0,R=[];++c<g;){var U=o[c];U&&(R[x++]=U)}return R}function Yw(){var o=arguments.length;if(!o)return[];for(var c=wt(o-1),g=arguments[0],x=o;x--;)c[x-1]=arguments[x];return ms(Ae(g)?dr(g):[g],zi(c,1))}var $w=Me(function(o,c){return vi(o)?Jo(o,zi(c,1,vi,!0)):[]}),qw=Me(function(o,c){var g=Or(c);return vi(g)&&(g=e),vi(o)?Jo(o,zi(c,1,vi,!0),pe(g,2)):[]}),Kw=Me(function(o,c){var g=Or(c);return vi(g)&&(g=e),vi(o)?Jo(o,zi(c,1,vi,!0),e,g):[]});function Zw(o,c,g){var x=o==null?0:o.length;return x?(c=g||c===e?1:Se(c),Fr(o,c<0?0:c,x)):[]}function Qw(o,c,g){var x=o==null?0:o.length;return x?(c=g||c===e?1:Se(c),c=x-c,Fr(o,0,c<0?0:c)):[]}function Jw(o,c){return o&&o.length?hl(o,pe(c,3),!0,!0):[]}function t1(o,c){return o&&o.length?hl(o,pe(c,3),!0):[]}function e1(o,c,g,x){var R=o==null?0:o.length;return R?(g&&typeof g!="number"&&ir(o,c,g)&&(g=0,x=R),Xv(o,c,g,x)):[]}function lm(o,c,g){var x=o==null?0:o.length;if(!x)return-1;var R=g==null?0:Se(g);return R<0&&(R=Ri(x+R,0)),Gh(o,pe(c,3),R)}function cm(o,c,g){var x=o==null?0:o.length;if(!x)return-1;var R=x-1;return g!==e&&(R=Se(g),R=g<0?Ri(x+R,0):Ki(R,x-1)),Gh(o,pe(c,3),R,!0)}function um(o){var c=o==null?0:o.length;return c?zi(o,1):[]}function i1(o){var c=o==null?0:o.length;return c?zi(o,pt):[]}function r1(o,c){var g=o==null?0:o.length;return g?(c=c===e?1:Se(c),zi(o,c)):[]}function n1(o){for(var c=-1,g=o==null?0:o.length,x={};++c<g;){var R=o[c];x[R[0]]=R[1]}return x}function dm(o){return o&&o.length?o[0]:e}function s1(o,c,g){var x=o==null?0:o.length;if(!x)return-1;var R=g==null?0:Se(g);return R<0&&(R=Ri(x+R,0)),Na(o,c,R)}function a1(o){var c=o==null?0:o.length;return c?Fr(o,0,-1):[]}var o1=Me(function(o){var c=ri(o,Su);return c.length&&c[0]===o[0]?gu(c):[]}),h1=Me(function(o){var c=Or(o),g=ri(o,Su);return c===Or(g)?c=e:g.pop(),g.length&&g[0]===o[0]?gu(g,pe(c,2)):[]}),l1=Me(function(o){var c=Or(o),g=ri(o,Su);return c=typeof c=="function"?c:e,c&&g.pop(),g.length&&g[0]===o[0]?gu(g,e,c):[]});function c1(o,c){return o==null?"":sv.call(o,c)}function Or(o){var c=o==null?0:o.length;return c?o[c-1]:e}function u1(o,c,g){var x=o==null?0:o.length;if(!x)return-1;var R=x;return g!==e&&(R=Se(g),R=R<0?Ri(x+R,0):Ki(R,x-1)),c===c?z_(o,c,R):Gh(o,Xf,R,!0)}function d1(o,c){return o&&o.length?Ap(o,Se(c)):e}var f1=Me(fm);function fm(o,c){return o&&o.length&&c&&c.length?wu(o,c):o}function p1(o,c,g){return o&&o.length&&c&&c.length?wu(o,c,pe(g,2)):o}function m1(o,c,g){return o&&o.length&&c&&c.length?wu(o,c,e,g):o}var g1=Un(function(o,c){var g=o==null?0:o.length,x=du(o,c);return Sp(o,ri(c,function(R){return Hn(R,g)?+R:R}).sort(Fp)),x});function y1(o,c){var g=[];if(!(o&&o.length))return g;var x=-1,R=[],U=o.length;for(c=pe(c,3);++x<U;){var K=o[x];c(K,x,o)&&(g.push(K),R.push(x))}return Sp(o,R),g}function Hu(o){return o==null?o:lv.call(o)}function _1(o,c,g){var x=o==null?0:o.length;return x?(g&&typeof g!="number"&&ir(o,c,g)?(c=0,g=x):(c=c==null?0:Se(c),g=g===e?x:Se(g)),Fr(o,c,g)):[]}function v1(o,c){return ol(o,c)}function w1(o,c,g){return Au(o,c,pe(g,2))}function b1(o,c){var g=o==null?0:o.length;if(g){var x=ol(o,c);if(x<g&&qr(o[x],c))return x}return-1}function x1(o,c){return ol(o,c,!0)}function A1(o,c,g){return Au(o,c,pe(g,2),!0)}function E1(o,c){var g=o==null?0:o.length;if(g){var x=ol(o,c,!0)-1;if(qr(o[x],c))return x}return-1}function T1(o){return o&&o.length?Mp(o):[]}function S1(o,c){return o&&o.length?Mp(o,pe(c,2)):[]}function C1(o){var c=o==null?0:o.length;return c?Fr(o,1,c):[]}function M1(o,c,g){return o&&o.length?(c=g||c===e?1:Se(c),Fr(o,0,c<0?0:c)):[]}function I1(o,c,g){var x=o==null?0:o.length;return x?(c=g||c===e?1:Se(c),c=x-c,Fr(o,c<0?0:c,x)):[]}function B1(o,c){return o&&o.length?hl(o,pe(c,3),!1,!0):[]}function R1(o,c){return o&&o.length?hl(o,pe(c,3)):[]}var k1=Me(function(o){return vs(zi(o,1,vi,!0))}),P1=Me(function(o){var c=Or(o);return vi(c)&&(c=e),vs(zi(o,1,vi,!0),pe(c,2))}),D1=Me(function(o){var c=Or(o);return c=typeof c=="function"?c:e,vs(zi(o,1,vi,!0),e,c)});function L1(o){return o&&o.length?vs(o):[]}function F1(o,c){return o&&o.length?vs(o,pe(c,2)):[]}function O1(o,c){return c=typeof c=="function"?c:e,o&&o.length?vs(o,e,c):[]}function Gu(o){if(!(o&&o.length))return[];var c=0;return o=ps(o,function(g){if(vi(g))return c=Ri(g.length,c),!0}),nu(c,function(g){return ri(o,eu(g))})}function pm(o,c){if(!(o&&o.length))return[];var g=Gu(o);return c==null?g:ri(g,function(x){return Fi(c,e,x)})}var N1=Me(function(o,c){return vi(o)?Jo(o,c):[]}),U1=Me(function(o){return Tu(ps(o,vi))}),H1=Me(function(o){var c=Or(o);return vi(c)&&(c=e),Tu(ps(o,vi),pe(c,2))}),G1=Me(function(o){var c=Or(o);return c=typeof c=="function"?c:e,Tu(ps(o,vi),e,c)}),W1=Me(Gu);function z1(o,c){return kp(o||[],c||[],Qo)}function V1(o,c){return kp(o||[],c||[],ih)}var j1=Me(function(o){var c=o.length,g=c>1?o[c-1]:e;return g=typeof g=="function"?(o.pop(),g):e,pm(o,g)});function mm(o){var c=O(o);return c.__chain__=!0,c}function X1(o,c){return c(o),o}function yl(o,c){return c(o)}var Y1=Un(function(o){var c=o.length,g=c?o[0]:0,x=this.__wrapped__,R=function(U){return du(U,o)};return c>1||this.__actions__.length||!(x instanceof De)||!Hn(g)?this.thru(R):(x=x.slice(g,+g+(c?1:0)),x.__actions__.push({func:yl,args:[R],thisArg:e}),new Dr(x,this.__chain__).thru(function(U){return c&&!U.length&&U.push(e),U}))});function $1(){return mm(this)}function q1(){return new Dr(this.value(),this.__chain__)}function K1(){this.__values__===e&&(this.__values__=Im(this.value()));var o=this.__index__>=this.__values__.length,c=o?e:this.__values__[this.__index__++];return{done:o,value:c}}function Z1(){return this}function Q1(o){for(var c,g=this;g instanceof il;){var x=hm(g);x.__index__=0,x.__values__=e,c?R.__wrapped__=x:c=x;var R=x;g=g.__wrapped__}return R.__wrapped__=o,c}function J1(){var o=this.__wrapped__;if(o instanceof De){var c=o;return this.__actions__.length&&(c=new De(this)),c=c.reverse(),c.__actions__.push({func:yl,args:[Hu],thisArg:e}),new Dr(c,this.__chain__)}return this.thru(Hu)}function tb(){return Rp(this.__wrapped__,this.__actions__)}var eb=ll(function(o,c,g){$e.call(o,g)?++o[g]:On(o,g,1)});function ib(o,c,g){var x=Ae(o)?Vf:jv;return g&&ir(o,c,g)&&(c=e),x(o,pe(c,3))}function rb(o,c){var g=Ae(o)?ps:pp;return g(o,pe(c,3))}var nb=Wp(lm),sb=Wp(cm);function ab(o,c){return zi(_l(o,c),1)}function ob(o,c){return zi(_l(o,c),pt)}function hb(o,c,g){return g=g===e?1:Se(g),zi(_l(o,c),g)}function gm(o,c){var g=Ae(o)?kr:_s;return g(o,pe(c,3))}function ym(o,c){var g=Ae(o)?S_:fp;return g(o,pe(c,3))}var lb=ll(function(o,c,g){$e.call(o,g)?o[g].push(c):On(o,g,[c])});function cb(o,c,g,x){o=fr(o)?o:Ka(o),g=g&&!x?Se(g):0;var R=o.length;return g<0&&(g=Ri(R+g,0)),Al(o)?g<=R&&o.indexOf(c,g)>-1:!!R&&Na(o,c,g)>-1}var ub=Me(function(o,c,g){var x=-1,R=typeof c=="function",U=fr(o)?wt(o.length):[];return _s(o,function(K){U[++x]=R?Fi(c,K,g):th(K,c,g)}),U}),db=ll(function(o,c,g){On(o,g,c)});function _l(o,c){var g=Ae(o)?ri:wp;return g(o,pe(c,3))}function fb(o,c,g,x){return o==null?[]:(Ae(c)||(c=c==null?[]:[c]),g=x?e:g,Ae(g)||(g=g==null?[]:[g]),Ep(o,c,g))}var pb=ll(function(o,c,g){o[g?0:1].push(c)},function(){return[[],[]]});function mb(o,c,g){var x=Ae(o)?Jc:$f,R=arguments.length<3;return x(o,pe(c,4),g,R,_s)}function gb(o,c,g){var x=Ae(o)?C_:$f,R=arguments.length<3;return x(o,pe(c,4),g,R,fp)}function yb(o,c){var g=Ae(o)?ps:pp;return g(o,bl(pe(c,3)))}function _b(o){var c=Ae(o)?lp:cw;return c(o)}function vb(o,c,g){(g?ir(o,c,g):c===e)?c=1:c=Se(c);var x=Ae(o)?Hv:uw;return x(o,c)}function wb(o){var c=Ae(o)?Gv:fw;return c(o)}function bb(o){if(o==null)return 0;if(fr(o))return Al(o)?Ha(o):o.length;var c=Zi(o);return c==S||c==Tt?o.size:_u(o).length}function xb(o,c,g){var x=Ae(o)?tu:pw;return g&&ir(o,c,g)&&(c=e),x(o,pe(c,3))}var Ab=Me(function(o,c){if(o==null)return[];var g=c.length;return g>1&&ir(o,c[0],c[1])?c=[]:g>2&&ir(c[0],c[1],c[2])&&(c=[c[0]]),Ep(o,zi(c,1),[])}),vl=iv||function(){return q.Date.now()};function Eb(o,c){if(typeof c!="function")throw new Pr(a);return o=Se(o),function(){if(--o<1)return c.apply(this,arguments)}}function _m(o,c,g){return c=g?e:c,c=o&&c==null?o.length:c,Nn(o,Y,e,e,e,e,c)}function vm(o,c){var g;if(typeof c!="function")throw new Pr(a);return o=Se(o),function(){return--o>0&&(g=c.apply(this,arguments)),o<=1&&(c=e),g}}var Wu=Me(function(o,c,g){var x=v;if(g.length){var R=gs(g,$a(Wu));x|=G}return Nn(o,x,c,g,R)}),wm=Me(function(o,c,g){var x=v|w;if(g.length){var R=gs(g,$a(wm));x|=G}return Nn(c,x,o,g,R)});function bm(o,c,g){c=g?e:c;var x=Nn(o,E,e,e,e,e,e,c);return x.placeholder=bm.placeholder,x}function xm(o,c,g){c=g?e:c;var x=Nn(o,k,e,e,e,e,e,c);return x.placeholder=xm.placeholder,x}function Am(o,c,g){var x,R,U,K,nt,dt,Rt=0,kt=!1,Ot=!1,Zt=!0;if(typeof o!="function")throw new Pr(a);c=Nr(c)||0,ai(g)&&(kt=!!g.leading,Ot="maxWait"in g,U=Ot?Ri(Nr(g.maxWait)||0,c):U,Zt="trailing"in g?!!g.trailing:Zt);function oe(wi){var Kr=x,zn=R;return x=R=e,Rt=wi,K=o.apply(zn,Kr),K}function me(wi){return Rt=wi,nt=sh(Re,c),kt?oe(wi):K}function Ce(wi){var Kr=wi-dt,zn=wi-Rt,Wm=c-Kr;return Ot?Ki(Wm,U-zn):Wm}function ge(wi){var Kr=wi-dt,zn=wi-Rt;return dt===e||Kr>=c||Kr<0||Ot&&zn>=U}function Re(){var wi=vl();if(ge(wi))return Fe(wi);nt=sh(Re,Ce(wi))}function Fe(wi){return nt=e,Zt&&x?oe(wi):(x=R=e,K)}function Tr(){nt!==e&&Pp(nt),Rt=0,x=dt=R=nt=e}function rr(){return nt===e?K:Fe(vl())}function Sr(){var wi=vl(),Kr=ge(wi);if(x=arguments,R=this,dt=wi,Kr){if(nt===e)return me(dt);if(Ot)return Pp(nt),nt=sh(Re,c),oe(dt)}return nt===e&&(nt=sh(Re,c)),K}return Sr.cancel=Tr,Sr.flush=rr,Sr}var Tb=Me(function(o,c){return dp(o,1,c)}),Sb=Me(function(o,c,g){return dp(o,Nr(c)||0,g)});function Cb(o){return Nn(o,J)}function wl(o,c){if(typeof o!="function"||c!=null&&typeof c!="function")throw new Pr(a);var g=function(){var x=arguments,R=c?c.apply(this,x):x[0],U=g.cache;if(U.has(R))return U.get(R);var K=o.apply(this,x);return g.cache=U.set(R,K)||U,K};return g.cache=new(wl.Cache||Fn),g}wl.Cache=Fn;function bl(o){if(typeof o!="function")throw new Pr(a);return function(){var c=arguments;switch(c.length){case 0:return!o.call(this);case 1:return!o.call(this,c[0]);case 2:return!o.call(this,c[0],c[1]);case 3:return!o.call(this,c[0],c[1],c[2])}return!o.apply(this,c)}}function Mb(o){return vm(2,o)}var Ib=mw(function(o,c){c=c.length==1&&Ae(c[0])?ri(c[0],xr(pe())):ri(zi(c,1),xr(pe()));var g=c.length;return Me(function(x){for(var R=-1,U=Ki(x.length,g);++R<U;)x[R]=c[R].call(this,x[R]);return Fi(o,this,x)})}),zu=Me(function(o,c){var g=gs(c,$a(zu));return Nn(o,G,e,c,g)}),Em=Me(function(o,c){var g=gs(c,$a(Em));return Nn(o,Q,e,c,g)}),Bb=Un(function(o,c){return Nn(o,it,e,e,e,c)});function Rb(o,c){if(typeof o!="function")throw new Pr(a);return c=c===e?c:Se(c),Me(o,c)}function kb(o,c){if(typeof o!="function")throw new Pr(a);return c=c==null?0:Ri(Se(c),0),Me(function(g){var x=g[c],R=bs(g,0,c);return x&&ms(R,x),Fi(o,this,R)})}function Pb(o,c,g){var x=!0,R=!0;if(typeof o!="function")throw new Pr(a);return ai(g)&&(x="leading"in g?!!g.leading:x,R="trailing"in g?!!g.trailing:R),Am(o,c,{leading:x,maxWait:c,trailing:R})}function Db(o){return _m(o,1)}function Lb(o,c){return zu(Cu(c),o)}function Fb(){if(!arguments.length)return[];var o=arguments[0];return Ae(o)?o:[o]}function Ob(o){return Lr(o,p)}function Nb(o,c){return c=typeof c=="function"?c:e,Lr(o,p,c)}function Ub(o){return Lr(o,l|p)}function Hb(o,c){return c=typeof c=="function"?c:e,Lr(o,l|p,c)}function Gb(o,c){return c==null||up(o,c,Oi(c))}function qr(o,c){return o===c||o!==o&&c!==c}var Wb=fl(mu),zb=fl(function(o,c){return o>=c}),qs=yp(function(){return arguments}())?yp:function(o){return pi(o)&&$e.call(o,"callee")&&!rp.call(o,"callee")},Ae=wt.isArray,Vb=_e?xr(_e):Zv;function fr(o){return o!=null&&xl(o.length)&&!Gn(o)}function vi(o){return pi(o)&&fr(o)}function jb(o){return o===!0||o===!1||pi(o)&&er(o)==Xt}var xs=nv||td,Xb=Ye?xr(Ye):Qv;function Yb(o){return pi(o)&&o.nodeType===1&&!ah(o)}function $b(o){if(o==null)return!0;if(fr(o)&&(Ae(o)||typeof o=="string"||typeof o.splice=="function"||xs(o)||qa(o)||qs(o)))return!o.length;var c=Zi(o);if(c==S||c==Tt)return!o.size;if(nh(o))return!_u(o).length;for(var g in o)if($e.call(o,g))return!1;return!0}function qb(o,c){return eh(o,c)}function Kb(o,c,g){g=typeof g=="function"?g:e;var x=g?g(o,c):e;return x===e?eh(o,c,e,g):!!x}function Vu(o){if(!pi(o))return!1;var c=er(o);return c==ne||c==le||typeof o.message=="string"&&typeof o.name=="string"&&!ah(o)}function Zb(o){return typeof o=="number"&&sp(o)}function Gn(o){if(!ai(o))return!1;var c=er(o);return c==ye||c==fe||c==re||c==lt}function Tm(o){return typeof o=="number"&&o==Se(o)}function xl(o){return typeof o=="number"&&o>-1&&o%1==0&&o<=Gt}function ai(o){var c=typeof o;return o!=null&&(c=="object"||c=="function")}function pi(o){return o!=null&&typeof o=="object"}var Sm=Li?xr(Li):tw;function Qb(o,c){return o===c||yu(o,c,Du(c))}function Jb(o,c,g){return g=typeof g=="function"?g:e,yu(o,c,Du(c),g)}function tx(o){return Cm(o)&&o!=+o}function ex(o){if(Nw(o))throw new xe(s);return _p(o)}function ix(o){return o===null}function rx(o){return o==null}function Cm(o){return typeof o=="number"||pi(o)&&er(o)==At}function ah(o){if(!pi(o)||er(o)!=X)return!1;var c=qh(o);if(c===null)return!0;var g=$e.call(c,"constructor")&&c.constructor;return typeof g=="function"&&g instanceof g&&jh.call(g)==Q_}var ju=dn?xr(dn):ew;function nx(o){return Tm(o)&&o>=-Gt&&o<=Gt}var Mm=fn?xr(fn):iw;function Al(o){return typeof o=="string"||!Ae(o)&&pi(o)&&er(o)==at}function Er(o){return typeof o=="symbol"||pi(o)&&er(o)==Nt}var qa=ur?xr(ur):rw;function sx(o){return o===e}function ax(o){return pi(o)&&Zi(o)==Lt}function ox(o){return pi(o)&&er(o)==ee}var hx=fl(vu),lx=fl(function(o,c){return o<=c});function Im(o){if(!o)return[];if(fr(o))return Al(o)?Yr(o):dr(o);if(Yo&&o[Yo])return H_(o[Yo]());var c=Zi(o),g=c==S?au:c==Tt?Wh:Ka;return g(o)}function Wn(o){if(!o)return o===0?o:0;if(o=Nr(o),o===pt||o===-pt){var c=o<0?-1:1;return c*bt}return o===o?o:0}function Se(o){var c=Wn(o),g=c%1;return c===c?g?c-g:c:0}function Bm(o){return o?js(Se(o),0,tt):0}function Nr(o){if(typeof o=="number")return o;if(Er(o))return xt;if(ai(o)){var c=typeof o.valueOf=="function"?o.valueOf():o;o=ai(c)?c+"":c}if(typeof o!="string")return o===0?o:+o;o=qf(o);var g=No.test(o);return g||Hs.test(o)?M(o.slice(2),g?2:8):Ia.test(o)?xt:+o}function Rm(o){return mn(o,pr(o))}function cx(o){return o?js(Se(o),-Gt,Gt):o===0?o:0}function je(o){return o==null?"":Ar(o)}var ux=Xa(function(o,c){if(nh(c)||fr(c)){mn(c,Oi(c),o);return}for(var g in c)$e.call(c,g)&&Qo(o,g,c[g])}),km=Xa(function(o,c){mn(c,pr(c),o)}),El=Xa(function(o,c,g,x){mn(c,pr(c),o,x)}),dx=Xa(function(o,c,g,x){mn(c,Oi(c),o,x)}),fx=Un(du);function px(o,c){var g=ja(o);return c==null?g:cp(g,c)}var mx=Me(function(o,c){o=Qe(o);var g=-1,x=c.length,R=x>2?c[2]:e;for(R&&ir(c[0],c[1],R)&&(x=1);++g<x;)for(var U=c[g],K=pr(U),nt=-1,dt=K.length;++nt<dt;){var Rt=K[nt],kt=o[Rt];(kt===e||qr(kt,Wa[Rt])&&!$e.call(o,Rt))&&(o[Rt]=U[Rt])}return o}),gx=Me(function(o){return o.push(e,qp),Fi(Pm,e,o)});function yx(o,c){return jf(o,pe(c,3),pn)}function _x(o,c){return jf(o,pe(c,3),pu)}function vx(o,c){return o==null?o:fu(o,pe(c,3),pr)}function wx(o,c){return o==null?o:mp(o,pe(c,3),pr)}function bx(o,c){return o&&pn(o,pe(c,3))}function xx(o,c){return o&&pu(o,pe(c,3))}function Ax(o){return o==null?[]:sl(o,Oi(o))}function Ex(o){return o==null?[]:sl(o,pr(o))}function Xu(o,c,g){var x=o==null?e:Xs(o,c);return x===e?g:x}function Tx(o,c){return o!=null&&Qp(o,c,Yv)}function Yu(o,c){return o!=null&&Qp(o,c,$v)}var Sx=Vp(function(o,c,g){c!=null&&typeof c.toString!="function"&&(c=Xh.call(c)),o[c]=g},qu(mr)),Cx=Vp(function(o,c,g){c!=null&&typeof c.toString!="function"&&(c=Xh.call(c)),$e.call(o,c)?o[c].push(g):o[c]=[g]},pe),Mx=Me(th);function Oi(o){return fr(o)?hp(o):_u(o)}function pr(o){return fr(o)?hp(o,!0):sw(o)}function Ix(o,c){var g={};return c=pe(c,3),pn(o,function(x,R,U){On(g,c(x,R,U),x)}),g}function Bx(o,c){var g={};return c=pe(c,3),pn(o,function(x,R,U){On(g,R,c(x,R,U))}),g}var Rx=Xa(function(o,c,g){al(o,c,g)}),Pm=Xa(function(o,c,g,x){al(o,c,g,x)}),kx=Un(function(o,c){var g={};if(o==null)return g;var x=!1;c=ri(c,function(U){return U=ws(U,o),x||(x=U.length>1),U}),mn(o,ku(o),g),x&&(g=Lr(g,l|f|p,Sw));for(var R=c.length;R--;)Eu(g,c[R]);return g});function Px(o,c){return Dm(o,bl(pe(c)))}var Dx=Un(function(o,c){return o==null?{}:ow(o,c)});function Dm(o,c){if(o==null)return{};var g=ri(ku(o),function(x){return[x]});return c=pe(c),Tp(o,g,function(x,R){return c(x,R[0])})}function Lx(o,c,g){c=ws(c,o);var x=-1,R=c.length;for(R||(R=1,o=e);++x<R;){var U=o==null?e:o[gn(c[x])];U===e&&(x=R,U=g),o=Gn(U)?U.call(o):U}return o}function Fx(o,c,g){return o==null?o:ih(o,c,g)}function Ox(o,c,g,x){return x=typeof x=="function"?x:e,o==null?o:ih(o,c,g,x)}var Lm=Yp(Oi),Fm=Yp(pr);function Nx(o,c,g){var x=Ae(o),R=x||xs(o)||qa(o);if(c=pe(c,4),g==null){var U=o&&o.constructor;R?g=x?new U:[]:ai(o)?g=Gn(U)?ja(qh(o)):{}:g={}}return(R?kr:pn)(o,function(K,nt,dt){return c(g,K,nt,dt)}),g}function Ux(o,c){return o==null?!0:Eu(o,c)}function Hx(o,c,g){return o==null?o:Bp(o,c,Cu(g))}function Gx(o,c,g,x){return x=typeof x=="function"?x:e,o==null?o:Bp(o,c,Cu(g),x)}function Ka(o){return o==null?[]:su(o,Oi(o))}function Wx(o){return o==null?[]:su(o,pr(o))}function zx(o,c,g){return g===e&&(g=c,c=e),g!==e&&(g=Nr(g),g=g===g?g:0),c!==e&&(c=Nr(c),c=c===c?c:0),js(Nr(o),c,g)}function Vx(o,c,g){return c=Wn(c),g===e?(g=c,c=0):g=Wn(g),o=Nr(o),qv(o,c,g)}function jx(o,c,g){if(g&&typeof g!="boolean"&&ir(o,c,g)&&(c=g=e),g===e&&(typeof c=="boolean"?(g=c,c=e):typeof o=="boolean"&&(g=o,o=e)),o===e&&c===e?(o=0,c=1):(o=Wn(o),c===e?(c=o,o=0):c=Wn(c)),o>c){var x=o;o=c,c=x}if(g||o%1||c%1){var R=ap();return Ki(o+R*(c-o+jo("1e-"+((R+"").length-1))),c)}return bu(o,c)}var Xx=Ya(function(o,c,g){return c=c.toLowerCase(),o+(g?Om(c):c)});function Om(o){return $u(je(o).toLowerCase())}function Nm(o){return o=je(o),o&&o.replace(Go,L_).replace(qi,"")}function Yx(o,c,g){o=je(o),c=Ar(c);var x=o.length;g=g===e?x:js(Se(g),0,x);var R=g;return g-=c.length,g>=0&&o.slice(g,R)==c}function $x(o){return o=je(o),o&&Ei.test(o)?o.replace(Be,F_):o}function qx(o){return o=je(o),o&&Bn.test(o)?o.replace(In,"\\$&"):o}var Kx=Ya(function(o,c,g){return o+(g?"-":"")+c.toLowerCase()}),Zx=Ya(function(o,c,g){return o+(g?" ":"")+c.toLowerCase()}),Qx=Gp("toLowerCase");function Jx(o,c,g){o=je(o),c=Se(c);var x=c?Ha(o):0;if(!c||x>=c)return o;var R=(c-x)/2;return dl(Jh(R),g)+o+dl(Qh(R),g)}function tA(o,c,g){o=je(o),c=Se(c);var x=c?Ha(o):0;return c&&x<c?o+dl(c-x,g):o}function eA(o,c,g){o=je(o),c=Se(c);var x=c?Ha(o):0;return c&&x<c?dl(c-x,g)+o:o}function iA(o,c,g){return g||c==null?c=0:c&&(c=+c),hv(je(o).replace(Rn,""),c||0)}function rA(o,c,g){return(g?ir(o,c,g):c===e)?c=1:c=Se(c),xu(je(o),c)}function nA(){var o=arguments,c=je(o[0]);return o.length<3?c:c.replace(o[1],o[2])}var sA=Ya(function(o,c,g){return o+(g?"_":"")+c.toLowerCase()});function aA(o,c,g){return g&&typeof g!="number"&&ir(o,c,g)&&(c=g=e),g=g===e?tt:g>>>0,g?(o=je(o),o&&(typeof c=="string"||c!=null&&!ju(c))&&(c=Ar(c),!c&&Ua(o))?bs(Yr(o),0,g):o.split(c,g)):[]}var oA=Ya(function(o,c,g){return o+(g?" ":"")+$u(c)});function hA(o,c,g){return o=je(o),g=g==null?0:js(Se(g),0,o.length),c=Ar(c),o.slice(g,g+c.length)==c}function lA(o,c,g){var x=O.templateSettings;g&&ir(o,c,g)&&(c=e),o=je(o),c=El({},c,x,$p);var R=El({},c.imports,x.imports,$p),U=Oi(R),K=su(R,U),nt,dt,Rt=0,kt=c.interpolate||or,Ot="__p += '",Zt=ou((c.escape||or).source+"|"+kt.source+"|"+(kt===Fs?Ma:or).source+"|"+(c.evaluate||or).source+"|$","g"),oe="//# sourceURL="+($e.call(c,"sourceURL")?(c.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Kc+"]")+`
`;o.replace(Zt,function(ge,Re,Fe,Tr,rr,Sr){return Fe||(Fe=Tr),Ot+=o.slice(Rt,Sr).replace(Wo,O_),Re&&(nt=!0,Ot+=`' +
__e(`+Re+`) +
'`),rr&&(dt=!0,Ot+=`';
`+rr+`;
__p += '`),Fe&&(Ot+=`' +
((__t = (`+Fe+`)) == null ? '' : __t) +
'`),Rt=Sr+ge.length,ge}),Ot+=`';
`;var me=$e.call(c,"variable")&&c.variable;if(!me)Ot=`with (obj) {
`+Ot+`
}
`;else if(Us.test(me))throw new xe(h);Ot=(dt?Ot.replace(Vt,""):Ot).replace(be,"$1").replace(Ie,"$1;"),Ot="function("+(me||"obj")+`) {
`+(me?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(nt?", __e = _.escape":"")+(dt?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Ot+`return __p
}`;var Ce=Hm(function(){return ze(U,oe+"return "+Ot).apply(e,K)});if(Ce.source=Ot,Vu(Ce))throw Ce;return Ce}function cA(o){return je(o).toLowerCase()}function uA(o){return je(o).toUpperCase()}function dA(o,c,g){if(o=je(o),o&&(g||c===e))return qf(o);if(!o||!(c=Ar(c)))return o;var x=Yr(o),R=Yr(c),U=Kf(x,R),K=Zf(x,R)+1;return bs(x,U,K).join("")}function fA(o,c,g){if(o=je(o),o&&(g||c===e))return o.slice(0,Jf(o)+1);if(!o||!(c=Ar(c)))return o;var x=Yr(o),R=Zf(x,Yr(c))+1;return bs(x,0,R).join("")}function pA(o,c,g){if(o=je(o),o&&(g||c===e))return o.replace(Rn,"");if(!o||!(c=Ar(c)))return o;var x=Yr(o),R=Kf(x,Yr(c));return bs(x,R).join("")}function mA(o,c){var g=st,x=gt;if(ai(c)){var R="separator"in c?c.separator:R;g="length"in c?Se(c.length):g,x="omission"in c?Ar(c.omission):x}o=je(o);var U=o.length;if(Ua(o)){var K=Yr(o);U=K.length}if(g>=U)return o;var nt=g-Ha(x);if(nt<1)return x;var dt=K?bs(K,0,nt).join(""):o.slice(0,nt);if(R===e)return dt+x;if(K&&(nt+=dt.length-nt),ju(R)){if(o.slice(nt).search(R)){var Rt,kt=dt;for(R.global||(R=ou(R.source,je(Xr.exec(R))+"g")),R.lastIndex=0;Rt=R.exec(kt);)var Ot=Rt.index;dt=dt.slice(0,Ot===e?nt:Ot)}}else if(o.indexOf(Ar(R),nt)!=nt){var Zt=dt.lastIndexOf(R);Zt>-1&&(dt=dt.slice(0,Zt))}return dt+x}function gA(o){return o=je(o),o&&Ze.test(o)?o.replace(Ne,V_):o}var yA=Ya(function(o,c,g){return o+(g?" ":"")+c.toUpperCase()}),$u=Gp("toUpperCase");function Um(o,c,g){return o=je(o),c=g?e:c,c===e?U_(o)?Y_(o):B_(o):o.match(c)||[]}var Hm=Me(function(o,c){try{return Fi(o,e,c)}catch(g){return Vu(g)?g:new xe(g)}}),_A=Un(function(o,c){return kr(c,function(g){g=gn(g),On(o,g,Wu(o[g],o))}),o});function vA(o){var c=o==null?0:o.length,g=pe();return o=c?ri(o,function(x){if(typeof x[1]!="function")throw new Pr(a);return[g(x[0]),x[1]]}):[],Me(function(x){for(var R=-1;++R<c;){var U=o[R];if(Fi(U[0],this,x))return Fi(U[1],this,x)}})}function wA(o){return Vv(Lr(o,l))}function qu(o){return function(){return o}}function bA(o,c){return o==null||o!==o?c:o}var xA=zp(),AA=zp(!0);function mr(o){return o}function Ku(o){return vp(typeof o=="function"?o:Lr(o,l))}function EA(o){return bp(Lr(o,l))}function TA(o,c){return xp(o,Lr(c,l))}var SA=Me(function(o,c){return function(g){return th(g,o,c)}}),CA=Me(function(o,c){return function(g){return th(o,g,c)}});function Zu(o,c,g){var x=Oi(c),R=sl(c,x);g==null&&!(ai(c)&&(R.length||!x.length))&&(g=c,c=o,o=this,R=sl(c,Oi(c)));var U=!(ai(g)&&"chain"in g)||!!g.chain,K=Gn(o);return kr(R,function(nt){var dt=c[nt];o[nt]=dt,K&&(o.prototype[nt]=function(){var Rt=this.__chain__;if(U||Rt){var kt=o(this.__wrapped__),Ot=kt.__actions__=dr(this.__actions__);return Ot.push({func:dt,args:arguments,thisArg:o}),kt.__chain__=Rt,kt}return dt.apply(o,ms([this.value()],arguments))})}),o}function MA(){return q._===this&&(q._=J_),this}function Qu(){}function IA(o){return o=Se(o),Me(function(c){return Ap(c,o)})}var BA=Iu(ri),RA=Iu(Vf),kA=Iu(tu);function Gm(o){return Fu(o)?eu(gn(o)):hw(o)}function PA(o){return function(c){return o==null?e:Xs(o,c)}}var DA=jp(),LA=jp(!0);function Ju(){return[]}function td(){return!1}function FA(){return{}}function OA(){return""}function NA(){return!0}function UA(o,c){if(o=Se(o),o<1||o>Gt)return[];var g=tt,x=Ki(o,tt);c=pe(c),o-=tt;for(var R=nu(x,c);++g<o;)c(g);return R}function HA(o){return Ae(o)?ri(o,gn):Er(o)?[o]:dr(om(je(o)))}function GA(o){var c=++Z_;return je(o)+c}var WA=ul(function(o,c){return o+c},0),zA=Bu("ceil"),VA=ul(function(o,c){return o/c},1),jA=Bu("floor");function XA(o){return o&&o.length?nl(o,mr,mu):e}function YA(o,c){return o&&o.length?nl(o,pe(c,2),mu):e}function $A(o){return Yf(o,mr)}function qA(o,c){return Yf(o,pe(c,2))}function KA(o){return o&&o.length?nl(o,mr,vu):e}function ZA(o,c){return o&&o.length?nl(o,pe(c,2),vu):e}var QA=ul(function(o,c){return o*c},1),JA=Bu("round"),tE=ul(function(o,c){return o-c},0);function eE(o){return o&&o.length?ru(o,mr):0}function iE(o,c){return o&&o.length?ru(o,pe(c,2)):0}return O.after=Eb,O.ary=_m,O.assign=ux,O.assignIn=km,O.assignInWith=El,O.assignWith=dx,O.at=fx,O.before=vm,O.bind=Wu,O.bindAll=_A,O.bindKey=wm,O.castArray=Fb,O.chain=mm,O.chunk=jw,O.compact=Xw,O.concat=Yw,O.cond=vA,O.conforms=wA,O.constant=qu,O.countBy=eb,O.create=px,O.curry=bm,O.curryRight=xm,O.debounce=Am,O.defaults=mx,O.defaultsDeep=gx,O.defer=Tb,O.delay=Sb,O.difference=$w,O.differenceBy=qw,O.differenceWith=Kw,O.drop=Zw,O.dropRight=Qw,O.dropRightWhile=Jw,O.dropWhile=t1,O.fill=e1,O.filter=rb,O.flatMap=ab,O.flatMapDeep=ob,O.flatMapDepth=hb,O.flatten=um,O.flattenDeep=i1,O.flattenDepth=r1,O.flip=Cb,O.flow=xA,O.flowRight=AA,O.fromPairs=n1,O.functions=Ax,O.functionsIn=Ex,O.groupBy=lb,O.initial=a1,O.intersection=o1,O.intersectionBy=h1,O.intersectionWith=l1,O.invert=Sx,O.invertBy=Cx,O.invokeMap=ub,O.iteratee=Ku,O.keyBy=db,O.keys=Oi,O.keysIn=pr,O.map=_l,O.mapKeys=Ix,O.mapValues=Bx,O.matches=EA,O.matchesProperty=TA,O.memoize=wl,O.merge=Rx,O.mergeWith=Pm,O.method=SA,O.methodOf=CA,O.mixin=Zu,O.negate=bl,O.nthArg=IA,O.omit=kx,O.omitBy=Px,O.once=Mb,O.orderBy=fb,O.over=BA,O.overArgs=Ib,O.overEvery=RA,O.overSome=kA,O.partial=zu,O.partialRight=Em,O.partition=pb,O.pick=Dx,O.pickBy=Dm,O.property=Gm,O.propertyOf=PA,O.pull=f1,O.pullAll=fm,O.pullAllBy=p1,O.pullAllWith=m1,O.pullAt=g1,O.range=DA,O.rangeRight=LA,O.rearg=Bb,O.reject=yb,O.remove=y1,O.rest=Rb,O.reverse=Hu,O.sampleSize=vb,O.set=Fx,O.setWith=Ox,O.shuffle=wb,O.slice=_1,O.sortBy=Ab,O.sortedUniq=T1,O.sortedUniqBy=S1,O.split=aA,O.spread=kb,O.tail=C1,O.take=M1,O.takeRight=I1,O.takeRightWhile=B1,O.takeWhile=R1,O.tap=X1,O.throttle=Pb,O.thru=yl,O.toArray=Im,O.toPairs=Lm,O.toPairsIn=Fm,O.toPath=HA,O.toPlainObject=Rm,O.transform=Nx,O.unary=Db,O.union=k1,O.unionBy=P1,O.unionWith=D1,O.uniq=L1,O.uniqBy=F1,O.uniqWith=O1,O.unset=Ux,O.unzip=Gu,O.unzipWith=pm,O.update=Hx,O.updateWith=Gx,O.values=Ka,O.valuesIn=Wx,O.without=N1,O.words=Um,O.wrap=Lb,O.xor=U1,O.xorBy=H1,O.xorWith=G1,O.zip=W1,O.zipObject=z1,O.zipObjectDeep=V1,O.zipWith=j1,O.entries=Lm,O.entriesIn=Fm,O.extend=km,O.extendWith=El,Zu(O,O),O.add=WA,O.attempt=Hm,O.camelCase=Xx,O.capitalize=Om,O.ceil=zA,O.clamp=zx,O.clone=Ob,O.cloneDeep=Ub,O.cloneDeepWith=Hb,O.cloneWith=Nb,O.conformsTo=Gb,O.deburr=Nm,O.defaultTo=bA,O.divide=VA,O.endsWith=Yx,O.eq=qr,O.escape=$x,O.escapeRegExp=qx,O.every=ib,O.find=nb,O.findIndex=lm,O.findKey=yx,O.findLast=sb,O.findLastIndex=cm,O.findLastKey=_x,O.floor=jA,O.forEach=gm,O.forEachRight=ym,O.forIn=vx,O.forInRight=wx,O.forOwn=bx,O.forOwnRight=xx,O.get=Xu,O.gt=Wb,O.gte=zb,O.has=Tx,O.hasIn=Yu,O.head=dm,O.identity=mr,O.includes=cb,O.indexOf=s1,O.inRange=Vx,O.invoke=Mx,O.isArguments=qs,O.isArray=Ae,O.isArrayBuffer=Vb,O.isArrayLike=fr,O.isArrayLikeObject=vi,O.isBoolean=jb,O.isBuffer=xs,O.isDate=Xb,O.isElement=Yb,O.isEmpty=$b,O.isEqual=qb,O.isEqualWith=Kb,O.isError=Vu,O.isFinite=Zb,O.isFunction=Gn,O.isInteger=Tm,O.isLength=xl,O.isMap=Sm,O.isMatch=Qb,O.isMatchWith=Jb,O.isNaN=tx,O.isNative=ex,O.isNil=rx,O.isNull=ix,O.isNumber=Cm,O.isObject=ai,O.isObjectLike=pi,O.isPlainObject=ah,O.isRegExp=ju,O.isSafeInteger=nx,O.isSet=Mm,O.isString=Al,O.isSymbol=Er,O.isTypedArray=qa,O.isUndefined=sx,O.isWeakMap=ax,O.isWeakSet=ox,O.join=c1,O.kebabCase=Kx,O.last=Or,O.lastIndexOf=u1,O.lowerCase=Zx,O.lowerFirst=Qx,O.lt=hx,O.lte=lx,O.max=XA,O.maxBy=YA,O.mean=$A,O.meanBy=qA,O.min=KA,O.minBy=ZA,O.stubArray=Ju,O.stubFalse=td,O.stubObject=FA,O.stubString=OA,O.stubTrue=NA,O.multiply=QA,O.nth=d1,O.noConflict=MA,O.noop=Qu,O.now=vl,O.pad=Jx,O.padEnd=tA,O.padStart=eA,O.parseInt=iA,O.random=jx,O.reduce=mb,O.reduceRight=gb,O.repeat=rA,O.replace=nA,O.result=Lx,O.round=JA,O.runInContext=ct,O.sample=_b,O.size=bb,O.snakeCase=sA,O.some=xb,O.sortedIndex=v1,O.sortedIndexBy=w1,O.sortedIndexOf=b1,O.sortedLastIndex=x1,O.sortedLastIndexBy=A1,O.sortedLastIndexOf=E1,O.startCase=oA,O.startsWith=hA,O.subtract=tE,O.sum=eE,O.sumBy=iE,O.template=lA,O.times=UA,O.toFinite=Wn,O.toInteger=Se,O.toLength=Bm,O.toLower=cA,O.toNumber=Nr,O.toSafeInteger=cx,O.toString=je,O.toUpper=uA,O.trim=dA,O.trimEnd=fA,O.trimStart=pA,O.truncate=mA,O.unescape=gA,O.uniqueId=GA,O.upperCase=yA,O.upperFirst=$u,O.each=gm,O.eachRight=ym,O.first=dm,Zu(O,function(){var o={};return pn(O,function(c,g){$e.call(O.prototype,g)||(o[g]=c)}),o}(),{chain:!1}),O.VERSION=r,kr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(o){O[o].placeholder=O}),kr(["drop","take"],function(o,c){De.prototype[o]=function(g){g=g===e?1:Ri(Se(g),0);var x=this.__filtered__&&!c?new De(this):this.clone();return x.__filtered__?x.__takeCount__=Ki(g,x.__takeCount__):x.__views__.push({size:Ki(g,tt),type:o+(x.__dir__<0?"Right":"")}),x},De.prototype[o+"Right"]=function(g){return this.reverse()[o](g).reverse()}}),kr(["filter","map","takeWhile"],function(o,c){var g=c+1,x=g==T||g==Pt;De.prototype[o]=function(R){var U=this.clone();return U.__iteratees__.push({iteratee:pe(R,3),type:g}),U.__filtered__=U.__filtered__||x,U}}),kr(["head","last"],function(o,c){var g="take"+(c?"Right":"");De.prototype[o]=function(){return this[g](1).value()[0]}}),kr(["initial","tail"],function(o,c){var g="drop"+(c?"":"Right");De.prototype[o]=function(){return this.__filtered__?new De(this):this[g](1)}}),De.prototype.compact=function(){return this.filter(mr)},De.prototype.find=function(o){return this.filter(o).head()},De.prototype.findLast=function(o){return this.reverse().find(o)},De.prototype.invokeMap=Me(function(o,c){return typeof o=="function"?new De(this):this.map(function(g){return th(g,o,c)})}),De.prototype.reject=function(o){return this.filter(bl(pe(o)))},De.prototype.slice=function(o,c){o=Se(o);var g=this;return g.__filtered__&&(o>0||c<0)?new De(g):(o<0?g=g.takeRight(-o):o&&(g=g.drop(o)),c!==e&&(c=Se(c),g=c<0?g.dropRight(-c):g.take(c-o)),g)},De.prototype.takeRightWhile=function(o){return this.reverse().takeWhile(o).reverse()},De.prototype.toArray=function(){return this.take(tt)},pn(De.prototype,function(o,c){var g=/^(?:filter|find|map|reject)|While$/.test(c),x=/^(?:head|last)$/.test(c),R=O[x?"take"+(c=="last"?"Right":""):c],U=x||/^find/.test(c);!R||(O.prototype[c]=function(){var K=this.__wrapped__,nt=x?[1]:arguments,dt=K instanceof De,Rt=nt[0],kt=dt||Ae(K),Ot=function(Re){var Fe=R.apply(O,ms([Re],nt));return x&&Zt?Fe[0]:Fe};kt&&g&&typeof Rt=="function"&&Rt.length!=1&&(dt=kt=!1);var Zt=this.__chain__,oe=!!this.__actions__.length,me=U&&!Zt,Ce=dt&&!oe;if(!U&&kt){K=Ce?K:new De(this);var ge=o.apply(K,nt);return ge.__actions__.push({func:yl,args:[Ot],thisArg:e}),new Dr(ge,Zt)}return me&&Ce?o.apply(this,nt):(ge=this.thru(Ot),me?x?ge.value()[0]:ge.value():ge)})}),kr(["pop","push","shift","sort","splice","unshift"],function(o){var c=zh[o],g=/^(?:push|sort|unshift)$/.test(o)?"tap":"thru",x=/^(?:pop|shift)$/.test(o);O.prototype[o]=function(){var R=arguments;if(x&&!this.__chain__){var U=this.value();return c.apply(Ae(U)?U:[],R)}return this[g](function(K){return c.apply(Ae(K)?K:[],R)})}}),pn(De.prototype,function(o,c){var g=O[c];if(g){var x=g.name+"";$e.call(Va,x)||(Va[x]=[]),Va[x].push({name:c,func:g})}}),Va[cl(e,w).name]=[{name:"wrapper",func:e}],De.prototype.clone=mv,De.prototype.reverse=gv,De.prototype.value=yv,O.prototype.at=Y1,O.prototype.chain=$1,O.prototype.commit=q1,O.prototype.next=K1,O.prototype.plant=Q1,O.prototype.reverse=J1,O.prototype.toJSON=O.prototype.valueOf=O.prototype.value=tb,O.prototype.first=O.prototype.head,Yo&&(O.prototype[Yo]=Z1),O},Ga=$_();ht?((ht.exports=Ga)._=Ga,ft._=Ga):q._=Ga}).call(si)})(xc,xc.exports);var xa={};xa.BITS=32;xa.GROUPS=4;xa.RE_ADDRESS=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g;xa.RE_SUBNET_STRING=/\/\d{1,2}$/;var Lh=Bf.exports.BigInteger,Vy=Dh,Ac=Io.sprintf,Wc=xc.exports,bn=xa;function qe(i){this.valid=!1,this.address=i,this.groups=bn.GROUPS,this.v4=!0,this.subnet="/32",this.subnetMask=32;var t=bn.RE_SUBNET_STRING.exec(i);if(t){if(this.parsedSubnet=t[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,this.subnetMask<0||this.subnetMask>bn.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}i=i.replace(bn.RE_SUBNET_STRING,"")}this.addressMinusSuffix=i,this.parsedAddress=this.parse(i)}qe.prototype.parse=function(i){var t=i.split(".");return i.match(bn.RE_ADDRESS)?this.valid=!0:this.error="Invalid IPv4 address.",t};qe.prototype.isValid=function(){return this.valid};qe.prototype.correctForm=function(){return this.parsedAddress.map(function(i){return parseInt(i,10)}).join(".")};qe.prototype.isCorrect=Vy.isCorrect(bn.BITS);qe.fromHex=function(i){var t=Wc.padStart(i.replace(/:/g,""),8,"0"),e=[],r;for(r=0;r<8;r+=2){var n=t.slice(r,r+2);e.push(parseInt(n,16))}return new qe(e.join("."))};qe.fromInteger=function(i){return qe.fromHex(i.toString(16))};qe.prototype.toHex=function(){return this.parsedAddress.map(function(i){return Ac("%02x",parseInt(i,10))}).join(":")};qe.prototype.toArray=function(){return this.parsedAddress.map(function(i){return parseInt(i,10)})};qe.prototype.toGroup6=function(){var i=[],t;for(t=0;t<bn.GROUPS;t+=2){var e=Ac("%02x%02x",parseInt(this.parsedAddress[t],10),parseInt(this.parsedAddress[t+1],10));i.push(Ac("%x",parseInt(e,16)))}return i.join(":")};qe.prototype.bigInteger=function(){return this.valid?new Lh(this.parsedAddress.map(function(i){return Ac("%02x",parseInt(i,10))}).join(""),16):null};qe.prototype._startAddress=function(){return new Lh(this.mask()+Wc.repeat("0",bn.BITS-this.subnetMask),2)};qe.prototype.startAddress=function(){return qe.fromBigInteger(this._startAddress())};qe.prototype.startAddressExclusive=function(){var i=new Lh("1");return qe.fromBigInteger(this._startAddress().add(i))};qe.prototype._endAddress=function(){return new Lh(this.mask()+Wc.repeat("1",bn.BITS-this.subnetMask),2)};qe.prototype.endAddress=function(){return qe.fromBigInteger(this._endAddress())};qe.prototype.endAddressExclusive=function(){var i=new Lh("1");return qe.fromBigInteger(this._endAddress().subtract(i))};qe.fromBigInteger=function(i){return qe.fromInteger(parseInt(i.toString(),10))};qe.prototype.mask=function(i){return i===void 0&&(i=this.subnetMask),this.getBitsBase2(0,i)};qe.prototype.getBitsBase2=function(i,t){return this.binaryZeroPad().slice(i,t)};qe.prototype.isInSubnet=Vy.isInSubnet;qe.prototype.binaryZeroPad=function(){return Wc.padStart(this.bigInteger().toString(2),bn.BITS,"0")};var jy=qe,Ir={};Ir.BITS=128;Ir.GROUPS=8;Ir.SCOPES={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"};Ir.TYPES={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"};Ir.RE_BAD_CHARACTERS=/([^0-9a-f:\/%])/ig;Ir.RE_BAD_ADDRESS=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/ig;Ir.RE_SUBNET_STRING=/\/\d{1,3}(?=%|$)/;Ir.RE_ZONE_STRING=/%.*$/;Ir.RE_URL=new RegExp(/^\[{0,1}([0-9a-f:]+)\]{0,1}/);Ir.RE_URL_WITH_PORT=new RegExp(/\[([0-9a-f:]+)\]:([0-9]{1,5})/);var Ur={},jg;function uB(){if(jg)return Ur;jg=1;var i=Dh,t=Ir;return Ur.isValid=function(){return this.valid},Ur.isInSubnet=i.isInSubnet,Ur.isCorrect=i.isCorrect(t.BITS),Ur.isCanonical=i.falseIfInvalid(function(){return this.addressMinusSuffix===this.canonicalForm()}),Ur.isLinkLocal=i.falseIfInvalid(function(){return this.getBitsBase2(0,64)==="1111111010000000000000000000000000000000000000000000000000000000"}),Ur.isMulticast=i.falseIfInvalid(function(){return this.getType()==="Multicast"}),Ur.is4=i.falseIfInvalid(function(){return this.v4}),Ur.isTeredo=i.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2001::/32"))}),Ur.is6to4=i.falseIfInvalid(function(){return this.isInSubnet(new this.constructor("2002::/16"))}),Ur.isLoopback=i.falseIfInvalid(function(){return this.getType()==="Loopback"}),Ur}var fh={},Bo={},Xy=Io.sprintf,dB=Bo.spanAllZeroes=function(i){return i.replace(/(0+)/g,'<span class="zero">$1</span>')};Bo.spanAll=function(i,t){t===void 0&&(t=0);var e=i.split("");return e.map(function(r,n){return Xy('<span class="digit value-%s position-%d">%s</span>',r,n+t,dB(r))}).join("")};function Yy(i){return i.replace(/^(0+)/,'<span class="zero">$1</span>')}Bo.spanLeadingZeroes=function(i){var t=i.split(":");return t.map(function(e){return Yy(e)}).join(":")};Bo.simpleGroup=function(i,t){var e=i.split(":");return t||(t=0),e.map(function(r,n){return/group-v4/.test(r)?r:Xy('<span class="hover-group group-%d">%s</span>',n+t,Yy(r))}).join(":")};var Xg;function fB(){if(Xg)return fh;Xg=1;var i=xa,t=Bo,e=Io.sprintf;return fh.href=function(r){return r===void 0?r="":r=e(":%s",r),e("http://[%s]%s/",this.correctForm(),r)},fh.link=function(r){r||(r={}),r.className===void 0&&(r.className=""),r.prefix===void 0&&(r.prefix="/#address="),r.v4===void 0&&(r.v4=!1);var n=this.correctForm;return r.v4&&(n=this.to4in6),r.className?e('<a href="%1$s%2$s" class="%3$s">%2$s</a>',r.prefix,n.call(this),r.className):e('<a href="%1$s%2$s">%2$s</a>',r.prefix,n.call(this))},fh.group=function(){var r=this.address.match(i.RE_ADDRESS),n;if(r){var s=r[0].split(".");this.address=this.address.replace(i.RE_ADDRESS,e('<span class="hover-group group-v4 group-6">%s</span>.<span class="hover-group group-v4 group-7">%s</span>',s.slice(0,2).join("."),s.slice(2,4).join(".")))}if(this.elidedGroups===0)return t.simpleGroup(this.address);var a=[],h=this.address.split("::");h[0].length?a.push(t.simpleGroup(h[0])):a.push("");var u=["hover-group"];for(n=this.elisionBegin;n<this.elisionBegin+this.elidedGroups;n++)u.push(e("group-%d",n));return a.push(e('<span class="%s"></span>',u.join(" "))),h[1].length?a.push(t.simpleGroup(h[1],this.elisionEnd)):a.push(""),a.join(":")},fh}var Xl={},Yg;function pB(){if(Yg)return Xl;Yg=1;var i=Io.sprintf,t=Ir;function e(a){return i("(%s)",a.join("|"))}function r(a){return a.length<4?i("0{0,%d}%s",4-a.length,a):a}function n(a){var h=[];a.forEach(function(d,m){var l=parseInt(d,16);l===0&&h.push(m)});var u=h.map(function(d){return a.map(function(m,l){if(l===d){var f=l===0||l===t.GROUPS-1?":":"";return e([r(m),f])}return r(m)}).join(":")});return u.push(a.map(r).join(":")),e(u)}function s(a,h,u){var d=h?"":":",m=u?"":":",l=[];!h&&!u&&l.push("::"),h&&u&&l.push(""),(u&&!h||!u&&h)&&l.push(":"),l.push(i("%s(:0{1,4}){1,%d}",d,a-1)),l.push(i("(0{1,4}:){1,%d}%s",a-1,m)),l.push(i("(0{1,4}:){%d}0{1,4}",a-1));for(var f=1;f<a-1;f++)for(var p=1;p<a-f;p++)l.push(i("(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}",p,a-p-f-1));return e(l)}return Xl.regularExpressionString=function(a){a===void 0&&(a=!1);var h=[],u=new this.constructor(this.correctForm());if(u.elidedGroups===0)h.push(n(u.parsedAddress));else if(u.elidedGroups===t.GROUPS)h.push(s(t.GROUPS));else{var d=u.address.split("::");d[0].length&&h.push(n(d[0].split(":"))),h.push(s(u.elidedGroups,d[0].length!==0,d[1].length!==0)),d[1].length&&h.push(n(d[1].split(":"))),h=[h.join(":")]}return a||(h=[].concat("(?=^|\\b|[^\\w\\:])(",h,")(?=[^\\w\\:]|\\b|$)")),h.join("")},Xl.regularExpression=function(a){return new RegExp(this.regularExpressionString(a),"i")},Xl}var ar=Bf.exports.BigInteger,Jn=Io.sprintf,Cn=xc.exports,lf=xa,gi=Ir,wo=jy;function mB(i){for(var t=/(\d+)(\d{3})/;t.test(i);)i=i.replace(t,"$1,$2");return i}function gB(i){return i=i.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2'),i=i.replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2'),i}function de(i,t){t===void 0?this.groups=gi.GROUPS:this.groups=t,this.v4=!1,this.subnet="/128",this.subnetMask=128,this.zone="",this.address=i;var e=gi.RE_SUBNET_STRING.exec(i);if(e){if(this.parsedSubnet=e[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>gi.BITS){this.valid=!1,this.error="Invalid subnet mask.";return}i=i.replace(gi.RE_SUBNET_STRING,"")}else if(/\//.test(i)){this.valid=!1,this.error="Invalid subnet mask.";return}var r=gi.RE_ZONE_STRING.exec(i);r&&(this.zone=r[0],i=i.replace(gi.RE_ZONE_STRING,"")),this.addressMinusSuffix=i,this.parsedAddress=this.parse(this.addressMinusSuffix)}Cn.merge(de.prototype,uB());Cn.merge(de.prototype,fB());Cn.merge(de.prototype,pB());de.fromBigInteger=function(i){var t=Cn.padStart(i.toString(16),32,"0"),e=[],r;for(r=0;r<gi.GROUPS;r++)e.push(t.slice(r*4,(r+1)*4));return new de(e.join(":"))};de.fromURL=function(i){var t,e,r;if(i.indexOf("[")!==-1&&i.indexOf("]:")!==-1){if(r=gi.RE_URL_WITH_PORT.exec(i),r===null)return{error:"failed to parse address with port",address:null,port:null};t=r[1],e=r[2]}else if(i.indexOf("/")!==-1){if(i=i.replace(/^[a-z0-9]+:\/\//,""),r=gi.RE_URL.exec(i),r===null)return{error:"failed to parse address from URL",address:null,port:null};t=r[1]}else t=i;return e?(e=parseInt(e,10),(e<0||e>65536)&&(e=null)):e=null,{address:new de(t),port:e}};de.fromAddress4=function(t){var t=new wo(t),e=gi.BITS-(lf.BITS-t.subnetMask);return new de("::ffff:"+t.correctForm()+"/"+e)};de.fromArpa=function(i){var t=i.replace(/(\.ip6\.arpa)?\.$/,""),e=7;if(t.length!==63)return t={error:"Not Valid 'ip6.arpa' form",address:null},t;t=t.split(".").reverse();for(var r=e;r>0;r--){var n=r*4;t.splice(n,0,":")}return t=t.join(""),new de(t)};function yB(i,t){var e=[],r=[],n;for(n=0;n<i.length;n++)n<t[0]?e.push(i[n]):n>t[1]&&r.push(i[n]);return e.concat(["compact"]).concat(r)}de.prototype.microsoftTranscription=function(){return Jn("%s.ipv6-literal.net",this.correctForm().replace(/:/g,"-"))};de.prototype.mask=function(i){return i===void 0&&(i=this.subnetMask),this.getBitsBase2(0,i)};de.prototype.possibleSubnets=function(i){i===void 0&&(i=128);var t=gi.BITS-this.subnetMask,e=Math.abs(i-gi.BITS),r=t-e;return r<0?"0":mB(new ar("2",10).pow(r).toString(10))};de.prototype._startAddress=function(){return new ar(this.mask()+Cn.repeat("0",gi.BITS-this.subnetMask),2)};de.prototype.startAddress=function(){return de.fromBigInteger(this._startAddress())};de.prototype.startAddressExclusive=function(){var i=new ar("1");return de.fromBigInteger(this._startAddress().add(i))};de.prototype._endAddress=function(){return new ar(this.mask()+Cn.repeat("1",gi.BITS-this.subnetMask),2)};de.prototype.endAddress=function(){return de.fromBigInteger(this._endAddress())};de.prototype.endAddressExclusive=function(){var i=new ar("1");return de.fromBigInteger(this._endAddress().subtract(i))};de.prototype.getScope=function(){var i=gi.SCOPES[this.getBits(12,16)];return this.getType()==="Global unicast"&&i!=="Link local"&&(i="Global"),i};de.prototype.getType=function(){var i=this;function t(e,r){return i.isInSubnet(new de(r))}return Cn.find(gi.TYPES,t)||"Global unicast"};de.prototype.getBits=function(i,t){return new ar(this.getBitsBase2(i,t),2)};de.prototype.getBitsBase2=function(i,t){return this.binaryZeroPad().slice(i,t)};de.prototype.getBitsBase16=function(i,t){var e=t-i;return e%4!==0?null:Cn.padStart(this.getBits(i,t).toString(16),e/4,"0")};de.prototype.getBitsPastSubnet=function(){return this.getBitsBase2(this.subnetMask,gi.BITS)};de.prototype.reverseForm=function(i){i||(i={});var t=Math.floor(this.subnetMask/4),e=this.canonicalForm().replace(/:/g,"").split("").slice(0,t).reverse().join(".");return t>0?i.omitSuffix?e:Jn("%s.ip6.arpa.",e):i.omitSuffix?"":"ip6.arpa."};de.prototype.correctForm=function(){if(!this.parsedAddress)return null;var i,t=[],e=0,r=[];for(i=0;i<this.parsedAddress.length;i++){var n=parseInt(this.parsedAddress[i],16);n===0&&e++,n!==0&&e>0&&(e>1&&r.push([i-e,i-1]),e=0)}e>1&&r.push([this.parsedAddress.length-e,this.parsedAddress.length-1]);var s=r.map(function(u){return u[1]-u[0]+1});if(r.length>0){var a=s.indexOf(Cn.max(s));t=yB(this.parsedAddress,r[a])}else t=this.parsedAddress;for(i=0;i<t.length;i++)t[i]!=="compact"&&(t[i]=parseInt(t[i],16).toString(16));var h=t.join(":");return h=h.replace(/^compact$/,"::"),h=h.replace(/^compact|compact$/,":"),h=h.replace(/compact/,""),h};de.prototype.binaryZeroPad=function(){return Cn.padStart(this.bigInteger().toString(2),gi.BITS,"0")};de.prototype.parse4in6=function(i){var t=i.split(":"),e=t.slice(-1)[0],r=e.match(lf.RE_ADDRESS);if(r){for(var n=new wo(r[0]),s=0;s<n.groups;s++)if(/^0[0-9]+/.test(n.parsedAddress[s]))return this.valid=!1,this.error="IPv4 addresses can not have leading zeroes.",this.parseError=i.replace(lf.RE_ADDRESS,n.parsedAddress.map(gB).join(".")),null;this.v4=!0,t[t.length-1]=n.toGroup6(),i=t.join(":")}return i};de.prototype.parse=function(i){if(i=this.parse4in6(i),this.error)return null;var t=i.match(gi.RE_BAD_CHARACTERS);if(t)return this.valid=!1,this.error=Jn("Bad character%s detected in address: %s",t.length>1?"s":"",t.join("")),this.parseError=i.replace(gi.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'),null;var e=i.match(gi.RE_BAD_ADDRESS);if(e)return this.valid=!1,this.error=Jn("Address failed regex: %s",e.join("")),this.parseError=i.replace(gi.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'),null;var r=[],n=i.split("::");if(n.length===2){var s=n[0].split(":"),a=n[1].split(":");s.length===1&&s[0]===""&&(s=[]),a.length===1&&a[0]===""&&(a=[]);var h=this.groups-(s.length+a.length);if(!h)return this.valid=!1,this.error="Error parsing groups",null;this.elidedGroups=h,this.elisionBegin=s.length,this.elisionEnd=s.length+this.elidedGroups,s.forEach(function(d){r.push(d)});for(var u=0;u<h;u++)r.push(0);a.forEach(function(d){r.push(d)})}else if(n.length===1)r=i.split(":"),this.elidedGroups=0;else return this.valid=!1,this.error="Too many :: groups found",null;return r=r.map(function(d){return Jn("%x",parseInt(d,16))}),r.length!==this.groups?(this.valid=!1,this.error="Incorrect number of groups found",null):(this.valid=!0,r)};function $y(i){return Jn("%04x",parseInt(i,16))}de.prototype.canonicalForm=function(){return this.valid?this.parsedAddress.map($y).join(":"):null};de.prototype.decimal=function(){return this.valid?this.parsedAddress.map(function(i){return Jn("%05d",parseInt(i,16))}).join(":"):null};de.prototype.bigInteger=function(){return this.valid?new ar(this.parsedAddress.map($y).join(""),16):null};de.prototype.to4=function(){var i=this.binaryZeroPad().split("");return wo.fromHex(new ar(i.slice(96,128).join(""),2).toString(16))};de.prototype.to4in6=function(){var i=this.to4(),t=new de(this.parsedAddress.slice(0,6).join(":"),6),e=t.correctForm(),r="";return/:$/.test(e)||(r=":"),t.correctForm()+r+i.address};de.prototype.inspectTeredo=function(){var i=this.getBitsBase16(0,32),t=this.getBits(80,96).xor(new ar("ffff",16)).toString(),e=wo.fromHex(this.getBitsBase16(32,64)),r=wo.fromHex(this.getBits(96,128).xor(new ar("ffffffff",16)).toString(16)),n=this.getBits(64,80),s=this.getBitsBase2(64,80),a=n.testBit(15),h=n.testBit(14),u=n.testBit(8),d=n.testBit(9),m=new ar(s.slice(2,6)+s.slice(8,16),2).toString(10);return{prefix:Jn("%s:%s",i.slice(0,4),i.slice(4,8)),server4:e.address,client4:r.address,flags:s,coneNat:a,microsoft:{reserved:h,universalLocal:d,groupIndividual:u,nonce:m},udpPort:t}};de.prototype.inspect6to4=function(){var i=this.getBitsBase16(0,16),t=wo.fromHex(this.getBitsBase16(16,48));return{prefix:Jn("%s",i.slice(0,4)),gateway:t.address}};de.prototype.to6to4=function(){if(!this.is4())return null;var i=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new de(i)};de.prototype.toByteArray=function(){var i=this.bigInteger().toByteArray();return i.length===17&&i[0]===0?i.slice(1):i};function qy(i){return i&255}de.prototype.toUnsignedByteArray=function(){return this.toByteArray().map(qy)};de.fromByteArray=function(i){return this.fromUnsignedByteArray(i.map(qy))};de.fromUnsignedByteArray=function(i){for(var t=new ar("256",10),e=new ar("0",10),r=new ar("1",10),n=i.length-1;n>=0;n--)e=e.add(r.multiply(new ar(i[n].toString(10),10))),r=r.multiply(t);return de.fromBigInteger(e)};var _B=de;Gc.Address4=jy;Gc.Address6=_B;Gc.v6={helpers:Bo};const{Buffer:Ro}=Mf,zc=cB,Ky=Gc.Address6,vB=Math.pow(2,32)-1,wB=85*85*85*85,bB=85*85*85,xB=85*85,AB=85,Zy="z85",lo=typeof window<"u"?window.BigInt:si.BigInt,EB=[9,10,11,12,13,32],cf="<~",Qy="~>";function TB(i){return lo("0x"+Ro.from(i).toString("hex"))}function SB(i,t){return new Array(1+i-t.length).join("0")+t}function Jy(i){const t=zc.ipv6.enc,e=[];for(let r=1;r<20;++r)e.push(t[Number(i%85n)]),i=i/85n;return e.push(t[Number(i)]),e.reverse().join("")}function CB(i){return i.length!==16?!1:Jy(TB(i))}function MB(i){const t=new Ky(i);if(!t.isValid())return!1;const e=t.parsedAddress.map(function(n){return SB(4,n)}).join(""),r=lo(`0x${e}`);return Jy(r)}function t_(i){if(i.length!==20)return!1;const t=zc.ipv6.dec;let e=0;try{const r=i.split("").reduceRight(function(n,s){const a=lo(t[s.charCodeAt(0)]),h=lo(85)**lo(e++),u=a*h;return n+u},lo(0));return Ky.fromBigInteger(r).correctForm()}catch{return!1}}function IB(i){return t_(i.toString())}function e_(i,t){if(t==="z85"&&i.length%4!==0)return!1;const e=zc[t].enc,r=i.length%4===0?0:4-i.length%4;let n="";for(let s=0;s<i.length;s+=4){let a=(i[s]<<24>>>0)+((s+1>i.length?0:i[s+1])<<16>>>0)+((s+2>i.length?0:i[s+2])<<8>>>0)+((s+3>i.length?0:i[s+3])<<0>>>0),h=[];for(let u=0;u<5;++u)h.unshift(e[a%85]),a=Math.floor(a/85);h=h.join(""),h==="!!!!!"&&t==="ascii85"&&(h="z"),n+=h}return(t==="ascii85"?cf:"")+n.substring(0,n.length-r)+(t==="ascii85"?Qy:"")}function BB(i,t){const e=Ro.from(i,"utf8");return e_(e,t)}function i_(i,t){const e=zc[t].dec;let r=i.length;if(t==="ascii85"&&(r-=cf.length+Qy.length),t==="z85"&&r%5!==0)return!1;let n=r%5===0?0:5-r%5;const s=t==="ascii85"?cf.length:0,a=s+r,h=Ro.alloc(4*Math.ceil((a-s)/5)),u=function(m){if(m<a)for(;EB.indexOf(i[m])!==-1;)n=(n+1)%5,m++;return m};let d=0;for(let m=s;m<a;){let l=0;const f=m;if(m=u(m),l=e[i[m]]*wB,m=u(m+1),l+=(m>=a?84:e[i[m]])*bB,m=u(m+1),l+=(m>=a?84:e[i[m]])*xB,m=u(m+1),l+=(m>=a?84:e[i[m]])*AB,m=u(m+1),l+=m>=a?84:e[i[m]],m=u(m+1),t==="z85"&&f+5!==m||l>vB||l<0)return!1;h.writeUInt32BE(l,d),d+=4}return h.slice(0,d-n)}function RB(i,t){t==="ascii85"&&(i=i.replace("z","!!!!!"));let e=Ro.from(i,"utf8");return i_(e,t)}function kB(i,t){return t=t||Zy,["ascii85","z85","ipv6"].indexOf(t)===-1?!1:Ro.isBuffer(i)?t==="ipv6"?CB(i):e_(i,t):typeof i=="string"?t==="ipv6"?MB(i):BB(i,t):!1}function PB(i,t){return t=t||Zy,["ascii85","z85","ipv6"].indexOf(t)===-1?!1:Ro.isBuffer(i)?t==="ipv6"?IB(i):i_(i,t):typeof i=="string"?t==="ipv6"?t_(i):RB(i,t):!1}var r_={encode:kB,decode:PB},Vr="INUMBER",ko="IOP1",Po="IOP2",Do="IOP3",es="IVAR",ya="IVARNAME",bo="IFUNCALL",Vc="IFUNDEF",_r="IEXPR",Rf="IEXPREVAL",Aa="IMEMBER",jc="IENDSTATEMENT",xo="IARRAY";function Ge(i,t){this.type=i,this.value=t??0}Ge.prototype.toString=function(){switch(this.type){case Vr:case ko:case Po:case Do:case es:case ya:case jc:return this.value;case bo:return"CALL "+this.value;case Vc:return"DEF "+this.value;case xo:return"ARRAY "+this.value;case Aa:return"."+this.value;default:return"Invalid Instruction"}};function Xc(i){return new Ge(ko,i)}function ns(i){return new Ge(Po,i)}function n_(i){return new Ge(Do,i)}function uf(i,t,e,r,n){for(var s=[],a=[],h,u,d,m,l=0;l<i.length;l++){var f=i[l],p=f.type;if(p===Vr||p===ya)Array.isArray(f.value)?s.push.apply(s,uf(f.value.map(function(y){return new Ge(Vr,y)}).concat(new Ge(xo,f.value.length)),t,e,r,n)):s.push(f);else if(p===es&&n.hasOwnProperty(f.value))f=new Ge(Vr,n[f.value]),s.push(f);else if(p===Po&&s.length>1)u=s.pop(),h=s.pop(),m=e[f.value],f=new Ge(Vr,m(h.value,u.value)),s.push(f);else if(p===Do&&s.length>2)d=s.pop(),u=s.pop(),h=s.pop(),f.value==="?"?s.push(h.value?u.value:d.value):(m=r[f.value],f=new Ge(Vr,m(h.value,u.value,d.value)),s.push(f));else if(p===ko&&s.length>0)h=s.pop(),m=t[f.value],f=new Ge(Vr,m(h.value)),s.push(f);else if(p===_r){for(;s.length>0;)a.push(s.shift());a.push(new Ge(_r,uf(f.value,t,e,r,n)))}else if(p===Aa&&s.length>0)h=s.pop(),s.push(new Ge(Vr,h.value[f.value]));else{for(;s.length>0;)a.push(s.shift());a.push(f)}}for(;s.length>0;)a.push(s.shift());return a}function s_(i,t,e){for(var r=[],n=0;n<i.length;n++){var s=i[n],a=s.type;if(a===es&&s.value===t)for(var h=0;h<e.tokens.length;h++){var u=e.tokens[h],d;u.type===ko?d=Xc(u.value):u.type===Po?d=ns(u.value):u.type===Do?d=n_(u.value):d=new Ge(u.type,u.value),r.push(d)}else a===_r?r.push(new Ge(_r,s_(s.value,t,e))):r.push(s)}return r}function oa(i,t,e){var r=[],n,s,a,h,u,d;if(kf(i))return jn(i,e);for(var m=i.length,l=0;l<m;l++){var f=i[l],p=f.type;if(p===Vr||p===ya)r.push(f.value);else if(p===Po)s=r.pop(),n=r.pop(),f.value==="and"?r.push(n?!!oa(s,t,e):!1):f.value==="or"?r.push(n?!0:!!oa(s,t,e)):f.value==="="?(h=t.binaryOps[f.value],r.push(h(n,oa(s,t,e),e))):(h=t.binaryOps[f.value],r.push(h(jn(n,e),jn(s,e))));else if(p===Do)a=r.pop(),s=r.pop(),n=r.pop(),f.value==="?"?r.push(oa(n?s:a,t,e)):(h=t.ternaryOps[f.value],r.push(h(jn(n,e),jn(s,e),jn(a,e))));else if(p===es)if(f.value in t.functions)r.push(t.functions[f.value]);else if(f.value in t.unaryOps&&t.parser.isOperatorEnabled(f.value))r.push(t.unaryOps[f.value]);else{var y=e[f.value];if(y!==void 0)r.push(y);else throw new Error("undefined variable: "+f.value)}else if(p===ko)n=r.pop(),h=t.unaryOps[f.value],r.push(h(jn(n,e)));else if(p===bo){for(d=f.value,u=[];d-- >0;)u.unshift(jn(r.pop(),e));if(h=r.pop(),h.apply&&h.call)r.push(h.apply(void 0,u));else throw new Error(h+" is not a function")}else if(p===Vc)r.push(function(){for(var _=r.pop(),v=[],w=f.value;w-- >0;)v.unshift(r.pop());var C=r.pop(),E=function(){for(var k=Object.assign({},e),G=0,Q=v.length;G<Q;G++)k[v[G]]=arguments[G];return oa(_,t,k)};return Object.defineProperty(E,"name",{value:C,writable:!1}),e[C]=E,E}());else if(p===_r)r.push(DB(f,t));else if(p===Rf)r.push(f);else if(p===Aa)n=r.pop(),r.push(n[f.value]);else if(p===jc)r.pop();else if(p===xo){for(d=f.value,u=[];d-- >0;)u.unshift(r.pop());r.push(u)}else throw new Error("invalid Expression")}if(r.length>1)throw new Error("invalid Expression (parity)");return r[0]===0?0:jn(r[0],e)}function DB(i,t,e){return kf(i)?i:{type:Rf,value:function(r){return oa(i.value,t,r)}}}function kf(i){return i&&i.type===Rf}function jn(i,t){return kf(i)?i.value(t):i}function Pf(i,t){for(var e=[],r,n,s,a,h,u,d=0;d<i.length;d++){var m=i[d],l=m.type;if(l===Vr)typeof m.value=="number"&&m.value<0?e.push("("+m.value+")"):Array.isArray(m.value)?e.push("["+m.value.map($g).join(", ")+"]"):e.push($g(m.value));else if(l===Po)n=e.pop(),r=e.pop(),a=m.value,t?a==="^"?e.push("Math.pow("+r+", "+n+")"):a==="and"?e.push("(!!"+r+" && !!"+n+")"):a==="or"?e.push("(!!"+r+" || !!"+n+")"):a==="||"?e.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+r+"),("+n+")))"):a==="=="?e.push("("+r+" === "+n+")"):a==="!="?e.push("("+r+" !== "+n+")"):a==="["?e.push(r+"[("+n+") | 0]"):e.push("("+r+" "+a+" "+n+")"):a==="["?e.push(r+"["+n+"]"):e.push("("+r+" "+a+" "+n+")");else if(l===Do)if(s=e.pop(),n=e.pop(),r=e.pop(),a=m.value,a==="?")e.push("("+r+" ? "+n+" : "+s+")");else throw new Error("invalid Expression");else if(l===es||l===ya)e.push(m.value);else if(l===ko)r=e.pop(),a=m.value,a==="-"||a==="+"?e.push("("+a+r+")"):t?a==="not"?e.push("(!"+r+")"):a==="!"?e.push("fac("+r+")"):e.push(a+"("+r+")"):a==="!"?e.push("("+r+"!)"):e.push("("+a+" "+r+")");else if(l===bo){for(u=m.value,h=[];u-- >0;)h.unshift(e.pop());a=e.pop(),e.push(a+"("+h.join(", ")+")")}else if(l===Vc){for(n=e.pop(),u=m.value,h=[];u-- >0;)h.unshift(e.pop());r=e.pop(),t?e.push("("+r+" = function("+h.join(", ")+") { return "+n+" })"):e.push("("+r+"("+h.join(", ")+") = "+n+")")}else if(l===Aa)r=e.pop(),e.push(r+"."+m.value);else if(l===xo){for(u=m.value,h=[];u-- >0;)h.unshift(e.pop());e.push("["+h.join(", ")+"]")}else if(l===_r)e.push("("+Pf(m.value,t)+")");else if(l!==jc)throw new Error("invalid Expression")}return e.length>1&&(t?e=[e.join(",")]:e=[e.join(";")]),String(e[0])}function $g(i){return typeof i=="string"?JSON.stringify(i).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):i}function co(i,t){for(var e=0;e<i.length;e++)if(i[e]===t)return!0;return!1}function Df(i,t,e){e=e||{};for(var r=!!e.withMembers,n=null,s=0;s<i.length;s++){var a=i[s];a.type===es||a.type===ya?!r&&!co(t,a.value)?t.push(a.value):(n!==null&&(co(t,n)||t.push(n)),n=a.value):a.type===Aa&&r&&n!==null?n+="."+a.value:a.type===_r?Df(a.value,t,e):n!==null&&(co(t,n)||t.push(n),n=null)}n!==null&&!co(t,n)&&t.push(n)}function on(i,t){this.tokens=i,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}on.prototype.simplify=function(i){return i=i||{},new on(uf(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,i),this.parser)};on.prototype.substitute=function(i,t){return t instanceof on||(t=this.parser.parse(String(t))),new on(s_(this.tokens,i,t),this.parser)};on.prototype.evaluate=function(i){return i=i||{},oa(this.tokens,this,i)};on.prototype.toString=function(){return Pf(this.tokens,!1)};on.prototype.symbols=function(i){i=i||{};var t=[];return Df(this.tokens,t,i),t};on.prototype.variables=function(i){i=i||{};var t=[];Df(this.tokens,t,i);var e=this.functions;return t.filter(function(r){return!(r in e)})};on.prototype.toJSFunction=function(i,t){var e=this,r=new Function(i,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+Pf(this.simplify(t).tokens,!0)+"; }");return function(){return r.apply(e,arguments)}};var Bh="TEOF",ti="TOP",Yc="TNUMBER",a_="TSTRING",is="TPAREN",Ao="TBRACKET",$c="TCOMMA",Lf="TNAME",Ff="TSEMICOLON";function o_(i,t,e){this.type=i,this.value=t,this.index=e}o_.prototype.toString=function(){return this.type+": "+this.value};function _i(i,t){this.pos=0,this.current=null,this.unaryOps=i.unaryOps,this.binaryOps=i.binaryOps,this.ternaryOps=i.ternaryOps,this.consts=i.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=i.options,this.parser=i}_i.prototype.newToken=function(i,t,e){return new o_(i,t,e??this.pos)};_i.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current};_i.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent};_i.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(Bh,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')};_i.prototype.isString=function(){var i=!1,t=this.pos,e=this.expression.charAt(t);if(e==="'"||e==='"')for(var r=this.expression.indexOf(e,t+1);r>=0&&this.pos<this.expression.length;){if(this.pos=r+1,this.expression.charAt(r-1)!=="\\"){var n=this.expression.substring(t+1,r);this.current=this.newToken(a_,this.unescape(n),t),i=!0;break}r=this.expression.indexOf(e,r+1)}return i};_i.prototype.isParen=function(){var i=this.expression.charAt(this.pos);return i==="("||i===")"?(this.current=this.newToken(is,i),this.pos++,!0):!1};_i.prototype.isBracket=function(){var i=this.expression.charAt(this.pos);return(i==="["||i==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(Ao,i),this.pos++,!0):!1};_i.prototype.isComma=function(){var i=this.expression.charAt(this.pos);return i===","?(this.current=this.newToken($c,","),this.pos++,!0):!1};_i.prototype.isSemicolon=function(){var i=this.expression.charAt(this.pos);return i===";"?(this.current=this.newToken(Ff,";"),this.pos++,!0):!1};_i.prototype.isConst=function(){for(var i=this.pos,t=i;t<this.expression.length;t++){var e=this.expression.charAt(t);if(e.toUpperCase()===e.toLowerCase()&&(t===this.pos||e!=="_"&&e!=="."&&(e<"0"||e>"9")))break}if(t>i){var r=this.expression.substring(i,t);if(r in this.consts)return this.current=this.newToken(Yc,this.consts[r]),this.pos+=r.length,!0}return!1};_i.prototype.isNamedOp=function(){for(var i=this.pos,t=i;t<this.expression.length;t++){var e=this.expression.charAt(t);if(e.toUpperCase()===e.toLowerCase()&&(t===this.pos||e!=="_"&&(e<"0"||e>"9")))break}if(t>i){var r=this.expression.substring(i,t);if(this.isOperatorEnabled(r)&&(r in this.binaryOps||r in this.unaryOps||r in this.ternaryOps))return this.current=this.newToken(ti,r),this.pos+=r.length,!0}return!1};_i.prototype.isName=function(){for(var i=this.pos,t=i,e=!1;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()){if(t===this.pos&&(r==="$"||r==="_")){r==="_"&&(e=!0);continue}else if(t===this.pos||!e||r!=="_"&&(r<"0"||r>"9"))break}else e=!0}if(e){var n=this.expression.substring(i,t);return this.current=this.newToken(Lf,n),this.pos+=n.length,!0}return!1};_i.prototype.isWhitespace=function(){for(var i=!1,t=this.expression.charAt(this.pos);(t===" "||t==="	"||t===`
`||t==="\r")&&(i=!0,this.pos++,!(this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return i};var LB=/^[0-9a-f]{4}$/i;_i.prototype.unescape=function(i){var t=i.indexOf("\\");if(t<0)return i;for(var e=i.substring(0,t);t>=0;){var r=i.charAt(++t);switch(r){case"'":e+="'";break;case'"':e+='"';break;case"\\":e+="\\";break;case"/":e+="/";break;case"b":e+="\b";break;case"f":e+="\f";break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"u":var n=i.substring(t+1,t+5);LB.test(n)||this.parseError("Illegal escape sequence: \\u"+n),e+=String.fromCharCode(parseInt(n,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+r+'"')}++t;var s=i.indexOf("\\",t);e+=i.substring(t,s<0?i.length:s),t=s}return e};_i.prototype.isComment=function(){var i=this.expression.charAt(this.pos);return i==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1};_i.prototype.isRadixInteger=function(){var i=this.pos;if(i>=this.expression.length-2||this.expression.charAt(i)!=="0")return!1;++i;var t,e;if(this.expression.charAt(i)==="x")t=16,e=/^[0-9a-f]$/i,++i;else if(this.expression.charAt(i)==="b")t=2,e=/^[01]$/i,++i;else return!1;for(var r=!1,n=i;i<this.expression.length;){var s=this.expression.charAt(i);if(e.test(s))i++,r=!0;else break}return r&&(this.current=this.newToken(Yc,parseInt(this.expression.substring(n,i),t)),this.pos=i),r};_i.prototype.isNumber=function(){for(var i=!1,t=this.pos,e=t,r=t,n=!1,s=!1,a;t<this.expression.length&&(a=this.expression.charAt(t),a>="0"&&a<="9"||!n&&a===".");)a==="."?n=!0:s=!0,t++,i=s;if(i&&(r=t),a==="e"||a==="E"){t++;for(var h=!0,u=!1;t<this.expression.length;){if(a=this.expression.charAt(t),h&&(a==="+"||a==="-"))h=!1;else if(a>="0"&&a<="9")u=!0,h=!1;else break;t++}u||(t=r)}return i?(this.current=this.newToken(Yc,parseFloat(this.expression.substring(e,t))),this.pos=t):this.pos=r,i};_i.prototype.isOperator=function(){var i=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(ti,t);else if(t==="\u2219"||t==="\u2022")this.current=this.newToken(ti,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(ti,">="),this.pos++):this.current=this.newToken(ti,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(ti,"<="),this.pos++):this.current=this.newToken(ti,"<");else if(t==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(ti,"||"),this.pos++;else return!1;else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(ti,"=="),this.pos++):this.current=this.newToken(ti,t);else if(t==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(ti,"!="),this.pos++):this.current=this.newToken(ti,t);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=i,!1)};_i.prototype.isOperatorEnabled=function(i){return this.parser.isOperatorEnabled(i)};_i.prototype.getCoordinates=function(){var i=0,t,e=-1;do i++,t=this.pos-e,e=this.expression.indexOf(`
`,e+1);while(e>=0&&e<this.pos);return{line:i,column:t}};_i.prototype.parseError=function(i){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+i)};function ii(i,t,e){this.parser=i,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=e.allowMemberAccess!==!1}ii.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()};ii.prototype.tokenMatches=function(i,t){return typeof t>"u"?!0:Array.isArray(t)?co(t,i.value):typeof t=="function"?t(i):i.value===t};ii.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()};ii.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken};ii.prototype.accept=function(i,t){return this.nextToken.type===i&&this.tokenMatches(this.nextToken,t)?(this.next(),!0):!1};ii.prototype.expect=function(i,t){if(!this.accept(i,t)){var e=this.tokens.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: Expected "+(t||i))}};ii.prototype.parseAtom=function(i){var t=this.tokens.unaryOps;function e(n){return n.value in t}if(this.accept(Lf)||this.accept(ti,e))i.push(new Ge(es,this.current.value));else if(this.accept(Yc))i.push(new Ge(Vr,this.current.value));else if(this.accept(a_))i.push(new Ge(Vr,this.current.value));else if(this.accept(is,"("))this.parseExpression(i),this.expect(is,")");else if(this.accept(Ao,"["))if(this.accept(Ao,"]"))i.push(new Ge(xo,0));else{var r=this.parseArrayList(i);i.push(new Ge(xo,r))}else throw new Error("unexpected "+this.nextToken)};ii.prototype.parseExpression=function(i){var t=[];this.parseUntilEndStatement(i,t)||(this.parseVariableAssignmentExpression(t),!this.parseUntilEndStatement(i,t)&&this.pushExpression(i,t))};ii.prototype.pushExpression=function(i,t){for(var e=0,r=t.length;e<r;e++)i.push(t[e])};ii.prototype.parseUntilEndStatement=function(i,t){return this.accept(Ff)?(this.nextToken&&this.nextToken.type!==Bh&&!(this.nextToken.type===is&&this.nextToken.value===")")&&t.push(new Ge(jc)),this.nextToken.type!==Bh&&this.parseExpression(t),i.push(new Ge(_r,t)),!0):!1};ii.prototype.parseArrayList=function(i){for(var t=0;!this.accept(Ao,"]");)for(this.parseExpression(i),++t;this.accept($c);)this.parseExpression(i),++t;return t};ii.prototype.parseVariableAssignmentExpression=function(i){for(this.parseConditionalExpression(i);this.accept(ti,"=");){var t=i.pop(),e=[],r=i.length-1;if(t.type===bo){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var n=0,s=t.value+1;n<s;n++){var a=r-n;i[a].type===es&&(i[a]=new Ge(ya,i[a].value))}this.parseVariableAssignmentExpression(e),i.push(new Ge(_r,e)),i.push(new Ge(Vc,t.value));continue}if(t.type!==es&&t.type!==Aa)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(e),i.push(new Ge(ya,t.value)),i.push(new Ge(_r,e)),i.push(ns("="))}};ii.prototype.parseConditionalExpression=function(i){for(this.parseOrExpression(i);this.accept(ti,"?");){var t=[],e=[];this.parseConditionalExpression(t),this.expect(ti,":"),this.parseConditionalExpression(e),i.push(new Ge(_r,t)),i.push(new Ge(_r,e)),i.push(n_("?"))}};ii.prototype.parseOrExpression=function(i){for(this.parseAndExpression(i);this.accept(ti,"or");){var t=[];this.parseAndExpression(t),i.push(new Ge(_r,t)),i.push(ns("or"))}};ii.prototype.parseAndExpression=function(i){for(this.parseComparison(i);this.accept(ti,"and");){var t=[];this.parseComparison(t),i.push(new Ge(_r,t)),i.push(ns("and"))}};var FB=["==","!=","<","<=",">=",">","in"];ii.prototype.parseComparison=function(i){for(this.parseAddSub(i);this.accept(ti,FB);){var t=this.current;this.parseAddSub(i),i.push(ns(t.value))}};var OB=["+","-","||"];ii.prototype.parseAddSub=function(i){for(this.parseTerm(i);this.accept(ti,OB);){var t=this.current;this.parseTerm(i),i.push(ns(t.value))}};var NB=["*","/","%"];ii.prototype.parseTerm=function(i){for(this.parseFactor(i);this.accept(ti,NB);){var t=this.current;this.parseFactor(i),i.push(ns(t.value))}};ii.prototype.parseFactor=function(i){var t=this.tokens.unaryOps;function e(n){return n.value in t}if(this.save(),this.accept(ti,e)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===is&&this.nextToken.value==="("){this.restore(),this.parseExponential(i);return}else if(this.nextToken.type===Ff||this.nextToken.type===$c||this.nextToken.type===Bh||this.nextToken.type===is&&this.nextToken.value===")"){this.restore(),this.parseAtom(i);return}}var r=this.current;this.parseFactor(i),i.push(Xc(r.value))}else this.parseExponential(i)};ii.prototype.parseExponential=function(i){for(this.parsePostfixExpression(i);this.accept(ti,"^");)this.parseFactor(i),i.push(ns("^"))};ii.prototype.parsePostfixExpression=function(i){for(this.parseFunctionCall(i);this.accept(ti,"!");)i.push(Xc("!"))};ii.prototype.parseFunctionCall=function(i){var t=this.tokens.unaryOps;function e(s){return s.value in t}if(this.accept(ti,e)){var r=this.current;this.parseAtom(i),i.push(Xc(r.value))}else for(this.parseMemberExpression(i);this.accept(is,"(");)if(this.accept(is,")"))i.push(new Ge(bo,0));else{var n=this.parseArgumentList(i);i.push(new Ge(bo,n))}};ii.prototype.parseArgumentList=function(i){for(var t=0;!this.accept(is,")");)for(this.parseExpression(i),++t;this.accept($c);)this.parseExpression(i),++t;return t};ii.prototype.parseMemberExpression=function(i){for(this.parseAtom(i);this.accept(ti,".")||this.accept(Ao,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(Lf),i.push(new Ge(Aa,this.current.value))}else if(t.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(i),this.expect(Ao,"]"),i.push(ns("["))}else throw new Error("unexpected symbol: "+t.value)}};function UB(i,t){return Number(i)+Number(t)}function HB(i,t){return i-t}function GB(i,t){return i*t}function WB(i,t){return i/t}function zB(i,t){return i%t}function VB(i,t){return Array.isArray(i)&&Array.isArray(t)?i.concat(t):""+i+t}function jB(i,t){return i===t}function XB(i,t){return i!==t}function YB(i,t){return i>t}function $B(i,t){return i<t}function qB(i,t){return i>=t}function KB(i,t){return i<=t}function ZB(i,t){return Boolean(i&&t)}function QB(i,t){return Boolean(i||t)}function JB(i,t){return co(t,i)}function tR(i){return(Math.exp(i)-Math.exp(-i))/2}function eR(i){return(Math.exp(i)+Math.exp(-i))/2}function iR(i){return i===1/0?1:i===-1/0?-1:(Math.exp(i)-Math.exp(-i))/(Math.exp(i)+Math.exp(-i))}function rR(i){return i===-1/0?i:Math.log(i+Math.sqrt(i*i+1))}function nR(i){return Math.log(i+Math.sqrt(i*i-1))}function sR(i){return Math.log((1+i)/(1-i))/2}function qg(i){return Math.log(i)*Math.LOG10E}function aR(i){return-i}function oR(i){return!i}function hR(i){return i<0?Math.ceil(i):Math.floor(i)}function lR(i){return Math.random()*(i||1)}function Kg(i){return Of(i+1)}function cR(i){return isFinite(i)&&i===Math.round(i)}var uR=4.7421875,Md=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function Of(i){var t,e;if(cR(i)){if(i<=0)return isFinite(i)?1/0:NaN;if(i>171)return 1/0;for(var r=i-2,n=i-1;r>1;)n*=r,r--;return n===0&&(n=1),n}if(i<.5)return Math.PI/(Math.sin(Math.PI*i)*Of(1-i));if(i>=171.35)return 1/0;if(i>85){var s=i*i,a=s*i,h=a*i,u=h*i;return Math.sqrt(2*Math.PI/i)*Math.pow(i/Math.E,i)*(1+1/(12*i)+1/(288*s)-139/(51840*a)-571/(2488320*h)+163879/(209018880*u)+5246819/(75246796800*u*i))}--i,e=Md[0];for(var d=1;d<Md.length;++d)e+=Md[d]/(i+d);return t=i+uR+.5,Math.sqrt(2*Math.PI)*Math.pow(t,i+.5)*Math.exp(-t)*e}function dR(i){return Array.isArray(i)?i.length:String(i).length}function Zg(){for(var i=0,t=0,e=0;e<arguments.length;e++){var r=Math.abs(arguments[e]),n;t<r?(n=t/r,i=i*n*n+1,t=r):r>0?(n=r/t,i+=n*n):i+=r}return t===1/0?1/0:t*Math.sqrt(i)}function Qg(i,t,e){return i?t:e}function fR(i,t){return typeof t>"u"||+t==0?Math.round(i):(i=+i,t=-+t,isNaN(i)||!(typeof t=="number"&&t%1===0)?NaN:(i=i.toString().split("e"),i=Math.round(+(i[0]+"e"+(i[1]?+i[1]-t:-t))),i=i.toString().split("e"),+(i[0]+"e"+(i[1]?+i[1]+t:t))))}function pR(i,t,e){return e&&(e[i]=t),t}function mR(i,t){return i[t|0]}function gR(i){return arguments.length===1&&Array.isArray(i)?Math.max.apply(Math,i):Math.max.apply(Math,arguments)}function yR(i){return arguments.length===1&&Array.isArray(i)?Math.min.apply(Math,i):Math.min.apply(Math,arguments)}function _R(i,t){if(typeof i!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(e,r){return i(e,r)})}function vR(i,t,e){if(typeof i!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(e))throw new Error("Second argument to fold is not an array");return e.reduce(function(r,n,s){return i(r,n,s)},t)}function wR(i,t){if(typeof i!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(e,r){return i(e,r)})}function bR(i,t){if(!(Array.isArray(t)||typeof t=="string"))throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(i)}function xR(i,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(i)}function AR(i){return(i>0)-(i<0)||+i}var Jg=1/3;function ER(i){return i<0?-Math.pow(-i,Jg):Math.pow(i,Jg)}function TR(i){return Math.exp(i)-1}function SR(i){return Math.log(1+i)}function CR(i){return Math.log(i)/Math.LN2}function Ea(i){this.options=i||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||tR,cosh:Math.cosh||eR,tanh:Math.tanh||iR,asinh:Math.asinh||rR,acosh:Math.acosh||nR,atanh:Math.atanh||sR,sqrt:Math.sqrt,cbrt:Math.cbrt||ER,log:Math.log,log2:Math.log2||CR,ln:Math.log,lg:Math.log10||qg,log10:Math.log10||qg,expm1:Math.expm1||TR,log1p:Math.log1p||SR,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||hR,"-":aR,"+":Number,exp:Math.exp,not:oR,length:dR,"!":Kg,sign:Math.sign||AR},this.binaryOps={"+":UB,"-":HB,"*":GB,"/":WB,"%":zB,"^":Math.pow,"||":VB,"==":jB,"!=":XB,">":YB,"<":$B,">=":qB,"<=":KB,and:ZB,or:QB,in:JB,"=":pR,"[":mR},this.ternaryOps={"?":Qg},this.functions={random:lR,fac:Kg,min:yR,max:gR,hypot:Math.hypot||Zg,pyt:Math.hypot||Zg,pow:Math.pow,atan2:Math.atan2,if:Qg,gamma:Of,roundTo:fR,map:_R,fold:vR,filter:wR,indexOf:bR,join:xR},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}Ea.prototype.parse=function(i){var t=[],e=new ii(this,new _i(this,i),{allowMemberAccess:this.options.allowMemberAccess});return e.parseExpression(t),e.expect(Bh,"EOF"),new on(t,this)};Ea.prototype.evaluate=function(i,t){return this.parse(i).evaluate(t)};var h_=new Ea;Ea.parse=function(i){return h_.parse(i)};Ea.evaluate=function(i,t){return h_.parse(i).evaluate(t)};var t0={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function MR(i){return t0.hasOwnProperty(i)?t0[i]:i}Ea.prototype.isOperatorEnabled=function(i){var t=MR(i),e=this.options.operators||{};return!(t in e)||!!e[t]};const cc=[1,1/2,1/3,1/4,1/6,1/8,1/12,1/16,1/24,1/48];function Nf(i){for(let t=0;t<cc.length;t++)if(Math.abs(i-Math.round(i/cc[t])*cc[t])<.01)return t;return 9}function e0(i){return 4/cc[Nf(i)]}function l_(i,t,e){return i*(1-e)+t*e}function to(i,t,e){return(e-i)/(t-i)}function Ec(i,t,e){return(i<<16)+(t<<8)+e}function IR(i,t){let e=i>>16,r=i>>8&255,n=i&255;return e=yr(e*t,0,255),r=yr(r*t,0,255),n=yr(n*t,0,255),Ec(e,r,n)}function ve(i,t){return Math.round(i*Math.pow(10,t))/Math.pow(10,t)}const _h=[];function BR(){return _h.length}function RR(){for(_h.push(Date.now());_h.length>0&&_h[0]<Date.now()-1e3;)_h.shift()}const vh=[];function kR(){return vh.length}function PR(){for(vh.push(Date.now());vh.length>0&&vh[0]<Date.now()-1e3;)vh.shift()}function DR(){return performance?.memory?Math.round(performance.memory.usedJSHeapSize/1048576)+" MB":"- MB"}function yr(i,t,e){return Math.max(t,Math.min(e,i))}function c_(){const{userAgent:i}=navigator;let t=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],e;if(/trident/i.test(t[1]))return e=/\brv[ :]+(\d+)/g.exec(i)||[],`IE ${e[1]||""}`;if(t[1]==="Chrome"){if(e=i.match(/\b(OPR|Edge)\/(\d+)/),e!==null)return e.slice(1).join(" ").replace("OPR","Opera");if(e=i.match(/\b(Edg)\/(\d+)/),e!==null)return e.slice(1).join(" ").replace("Edg","Edge (Chromium)")}return t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],e=i.match(/version\/(\d+)/i),e!==null&&t.splice(1,1,e[1]),t.join(" ")}function en(i,t,e){if(e=e??(s=>s),i.length==0)return-1;if(t>=e(i[i.length-1])){let s=i.length-1;for(;s>0&&e(i[s-1])==t;)s--;return s}let r=0,n=i.length;for(;r<=n&&r<i.length;){let s=r+n>>>1;if(e(i[s])==t){for(;s>0&&e(i[s-1])==t;)s--;return s}e(i[s])<t&&(r=s+1),e(i[s])>t&&(n=s-1)}return Math.max(0,n)}function Tc(i){try{return Ea.evaluate(i)}catch{return 0}}function ui(i,t){let e=i.length;if(i.length!=0)for(;e--;)t(i[e],e)&&i[e].destroy()}function LR(i){if(i.length==0)return 0;const t=i.length,e=i.reduce((r,n)=>r+n)/t;return Math.sqrt(i.map(r=>Math.pow(r-e,2)).reduce((r,n)=>r+n)/t)}function u_(i){if(i.length==0)return 0;i=[...i],i.sort((e,r)=>e-r);const t=Math.floor(i.length/2);return i.length%2?i[t]:(i[t-1]+i[t])/2}function FR(i){return i.length==0?0:i.reduce((t,e)=>t+e)/i.length}function Uf(i){return i==""?"":i.slice(0,1).toUpperCase()+i.slice(1).toLowerCase()}function d_(i,t){return t?d_(t,i%t):t===0?i:NaN}function f_(i,t){return i*t/d_(i,t)}function i0(i){let t=1;for(let e=0;e<i.length;++e)t=f_(i[e],t);return t}function OR(i){return i instanceof Error?i.message:String(i)}function p_(i){return!(!["Backspace","Tab","Escape","Enter","1","2","3","4","5","6","7","8","9","0","+","-","*","/",".","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Delete","x","c","a"].includes(i.key)||["X","C","A"].includes(i.key)&&!i.metaKey&&!i.ctrlKey)}function Ts(i,t){let e=Hf(i)[2];return t&&e.slice(-1*t.length)===t&&(e=e.slice(0,e.length-t.length)),e}function zr(i){const t=Hf(i),e=t[0];let r=t[1];return!e&&!r?"":(r&&(r=r.slice(0,r.length-1)),e+r)}function xn(i){return Hf(i)[3]}const NR=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^/]+?|)(\.[^./]*|))(?:[/]*)$/;function Hf(i){return NR.exec(i).slice(1)}function Yl(i){let t=0,e=0,r=129;for(;(r&128)!=0;){const n=i.shift();if(!n)break;t=t|(n&127)<<7*e++,r=n}return t}function $l(i){const t=[];let e=!1;for(;!e;){let r=i&127;i=i>>7,e=i==0,e||(r=r|128),t.push(r)}return t}function r0(i){if(i.startsWith("ArrowVortex:notes:")){const t=r_.decode("<~"+i.slice(18)+"~>","ascii85");if(t!==!1){const e=[...new Uint8Array(t.buffer)],r=(4-e.length%4)%4;if(e.push(...new Array(r).fill(0)),e.shift()!=0)return;const n=Yl(e),s=[];for(let a=0;a<n;a++){const h=e.shift();if(h==null)return;const u=h&127;if((h&128)!=0){const d=Yl(e),m=Yl(e),l=e.shift();if(l==null||l>4)continue;const f=["Hold","Mine","Roll","Lift","Fake"][l];if(d==m){if(f=="Hold"||f=="Roll")continue;s.push({type:f,beat:d/48,col:u})}else{if(f=="Mine"||f=="Fake"||f=="Lift")continue;s.push({type:f,beat:d/48,hold:(m-d)/48,col:u})}}else s.push({type:"Tap",beat:Yl(e)/48,col:u})}return s}}}function UR(i){const t=[0];t.push(...$l(i.length));for(const e of i)if(e.type=="Tap"){const r=Math.round(e.beat*48);t.push(e.col),t.push(...$l(r))}else{t.push(e.col+128);const r=Math.round(e.beat*48);let n=0;ke(e)&&(n=e.hold);const s=Math.round(n*48)+r;t.push(...$l(r)),t.push(...$l(s)),t.push(["Hold","Mine","Roll","Lift","Fake"].indexOf(e.type))}return"ArrowVortex:notes:"+r_.encode(Mf.Buffer.from(t),"ascii85").slice(2,-2)}const Cc=class{static get view(){return this._view||(this._view=document.getElementById("waterfall")),this._view}static create(t){let e=1;if(this.messages[t]&&this.messages[t].type==""){const n=this.messages[t];clearTimeout(n.timeoutID),e=++n.count,this.view.removeChild(n.container)}const r=document.createElement("div");r.innerHTML=t,e>1&&(r.innerHTML+=` (${e})`),r.classList.add("waterfall-item"),Cc.messages[t]={type:"",container:r,timeoutID:setTimeout(()=>{r.classList.add("waterfall-exiting"),setTimeout(()=>{delete this.messages[t],this.view.removeChild(r)},500)},5e3),count:e},this.view.appendChild(r)}static createFormatted(t,e){let r=1;if(this.messages[t]&&this.messages[t].type==e){const s=this.messages[t];clearTimeout(s.timeoutID),r=++s.count,this.view.removeChild(s.container)}const n=document.createElement("div");n.innerHTML=`<div class='waterfall-${e}'>${Uf(e)}: </div>`+t,r>1&&(n.innerHTML+=` (${r})`),n.classList.add("waterfall-item"),console[e](t),Cc.messages[t]={type:e,container:n,timeoutID:setTimeout(()=>{n.classList.add("waterfall-exiting"),setTimeout(()=>{delete this.messages[t],this.view.removeChild(n)},500)},5e3),count:r},this.view.appendChild(n)}};let Oe=Cc;L(Oe,"_view"),L(Oe,"messages",{});const HR="modulepreload",GR=function(i,t){return new URL(i,t).href},n0={},_a=function(t,e,r){if(!e||e.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(e.map(s=>{if(s=GR(s,r),s in n0)return;n0[s]=!0;const a=s.endsWith(".css"),h=a?'[rel="stylesheet"]':"";if(!!r)for(let m=n.length-1;m>=0;m--){const l=n[m];if(l.href===s&&(!a||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${h}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":HR,a||(d.as="script",d.crossOrigin=""),d.href=s,document.head.appendChild(d),a)return new Promise((m,l)=>{d.addEventListener("load",m),d.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())},s0=globalThis.showDirectoryPicker;async function WR(i={}){if(s0&&!i._preferPolyfill)return s0(i);const t=document.createElement("input");t.type="file",t.webkitdirectory=!0,t.multiple=!0,t.style.position="fixed",t.style.top="-100000px",t.style.left="-100000px",document.body.appendChild(t);const{makeDirHandleFromFileList:e}=await _a(()=>import("./util.30f000cb.js"),[],import.meta.url);return new Promise((r,n)=>{t.addEventListener("change",()=>{e(t.files).then(r).catch(n),document.body.removeChild(t)}),t.click()})}const a0=globalThis.showOpenFilePicker;async function zR(i={}){if(a0&&!i._preferPolyfill)return a0(i);const t=document.createElement("input");t.type="file",t.multiple=!!i.multiple,t.accept=(i.accepts||[]).map(r=>[...(r.extensions||[]).map(n=>"."+n),...r.mimeTypes||[]]).flat().join(","),t.style.position="fixed",t.style.top="-100000px",t.style.left="-100000px",document.body.appendChild(t);const{makeFileHandlesFromFileList:e}=await _a(()=>import("./util.30f000cb.js"),[],import.meta.url);return new Promise((r,n)=>{t.addEventListener("change",()=>{e(t.files).then(r).catch(n),document.body.removeChild(t)}),t.click()})}const o0=globalThis.showSaveFilePicker;async function VR(i={}){if(o0&&!i._preferPolyfill)return o0(i);const{FileSystemFileHandle:t}=await _a(()=>Promise.resolve().then(()=>jR),void 0,import.meta.url),{FileHandle:e}=await _a(()=>import("./downloader.9cb21d68.js"),["./downloader.9cb21d68.js","./util.30f000cb.js"],import.meta.url);return new t(new e(i.suggestedName))}const eo=Symbol("adapter");class Gf{constructor(t){this.kind=t.kind,this.name=t.name,this[eo]=t}get isFile(){return this.kind==="file"}get isDirectory(){return this.kind==="directory"}async queryPermission(t={mode:"read"}){const e=this[eo];if(e.queryPermission)return e.queryPermission(t);if(t.mode==="read")return"granted";if(t.mode==="readwrite")return e.writable?"granted":"denied";throw new TypeError(`Mode ${t.mode} must be 'read' or 'readwrite'`)}async requestPermission(t={mode:"read"}){const e=this[eo];if(e.requestPermission)return e.requestPermission(t);if(t.mode==="read")return"granted";if(t.mode==="readwrite")return e.writable?"granted":"denied";throw new TypeError(`Mode ${t.mode} must be 'read' or 'readwrite'`)}async isSameEntry(t){return this===t?!0:this.kind!==t.kind||!t[eo]?!1:await this[eo].isSameEntry(t[eo])}}Object.defineProperty(Gf.prototype,Symbol.toStringTag,{value:"FileSystemHandle",writable:!1,enumerable:!1,configurable:!0});const Id=Symbol("adapter");class Eo extends Gf{constructor(t){super(t),this.kind="file",this[Id]=t}async createWritable(t={}){const{FileSystemWritableFileStream:e}=await _a(()=>import("./FileSystemWritableFileStream.b600caaf.js"),["./FileSystemWritableFileStream.b600caaf.js","./web-streams-ponyfill.6e34fb66.js"],import.meta.url);return new e(await this[Id].createWritable(t))}async getFile(){return this[Id].getFile()}}Object.defineProperty(Eo.prototype,Symbol.toStringTag,{value:"FileSystemFileHandle",writable:!1,enumerable:!1,configurable:!0});Object.defineProperties(Eo.prototype,{createWritable:{enumerable:!0},getFile:{enumerable:!0}});const jR=Object.freeze(Object.defineProperty({__proto__:null,FileSystemFileHandle:Eo,default:Eo},Symbol.toStringTag,{value:"Module"})),io=Symbol("adapter");class Ps extends Gf{constructor(t){super(t),this.kind="directory",this[io]=t}async getDirectoryHandle(t,e={}){if(t==="")throw new TypeError("Name can't be an empty string.");if(t==="."||t===".."||t.includes("/"))throw new TypeError("Name contains invalid characters.");return new Ps(await this[io].getDirectoryHandle(t,e))}getDirectory(t,e={}){return this.getDirectoryHandle(t,e)}async*entries(){for await(const[t,e]of this[io].entries())yield[e.name,e.kind==="file"?new Eo(e):new Ps(e)]}async*getEntries(){return this.entries()}async*keys(){for await(const[t]of this[io].entries())yield t}async*values(){for await(const[t,e]of this.entries())yield e}async getFileHandle(t,e={}){if(t==="")throw new TypeError("Name can't be an empty string.");if(t==="."||t===".."||t.includes("/"))throw new TypeError("Name contains invalid characters.");return e.create=!!e.create,new Eo(await this[io].getFileHandle(t,e))}getFile(t,e={}){return this.getFileHandle(t,e)}async removeEntry(t,e={}){if(t==="")throw new TypeError("Name can't be an empty string.");if(t==="."||t===".."||t.includes("/"))throw new TypeError("Name contains invalid characters.");return e.recursive=!!e.recursive,this[io].removeEntry(t,e)}async resolve(t){if(await t.isSameEntry(this))return[];const e=[{handle:this,path:[]}];for(;e.length;){let{handle:r,path:n}=e.pop();for await(const s of r.values()){if(await s.isSameEntry(t))return[...n,s.name];s.kind==="directory"&&e.push({handle:s,path:[...n,s.name]})}}return null}[Symbol.asyncIterator](){return this.entries()}}Object.defineProperty(Ps.prototype,Symbol.toStringTag,{value:"FileSystemDirectoryHandle",writable:!1,enumerable:!1,configurable:!0});Object.defineProperties(Ps.prototype,{getDirectoryHandle:{enumerable:!0},entries:{enumerable:!0},getFileHandle:{enumerable:!0},removeEntry:{enumerable:!0}});const nP=Object.freeze(Object.defineProperty({__proto__:null,FileSystemDirectoryHandle:Ps,default:Ps},Symbol.toStringTag,{value:"Module"}));async function Bd(i,t={}){var e,r,n,s;if(!i){if(!(!((e=globalThis.navigator)===null||e===void 0)&&e.storage)&&((r=globalThis.location)===null||r===void 0?void 0:r.protocol)==="http:")throw new Error("Native getDirectory not supported in HTTP context. Please use HTTPS instead or provide an adapter.");if(!(!((s=(n=globalThis.navigator)===null||n===void 0?void 0:n.storage)===null||s===void 0)&&s.getDirectory))throw new Error("Native StorageManager.getDirectory() is not supported in current environment. Please provide an adapter instead.");return globalThis.navigator.storage.getDirectory()}const a=await i,h=typeof a=="function"?await a(t):await a.default(t);return new Ps(h)}var Rd,kd;const XR={adapter:{cache:!!(globalThis.CacheStorage&&globalThis.caches instanceof CacheStorage),native:typeof((kd=(Rd=globalThis.navigator)===null||Rd===void 0?void 0:Rd.storage)===null||kd===void 0?void 0:kd.getDirectory)=="function",sandbox:typeof window<"u"&&typeof window.webkitRequestFileSystem=="function"}};function ql(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var m_={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(i,t){(function(e){i.exports=e()})(function(){return function e(r,n,s){function a(d,m){if(!n[d]){if(!r[d]){var l=typeof ql=="function"&&ql;if(!m&&l)return l(d,!0);if(h)return h(d,!0);var f=new Error("Cannot find module '"+d+"'");throw f.code="MODULE_NOT_FOUND",f}var p=n[d]={exports:{}};r[d][0].call(p.exports,function(y){var _=r[d][1][y];return a(_||y)},p,p.exports,e,r,n,s)}return n[d].exports}for(var h=typeof ql=="function"&&ql,u=0;u<s.length;u++)a(s[u]);return a}({1:[function(e,r,n){var s=e("./utils"),a=e("./support"),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(u){for(var d,m,l,f,p,y,_,v=[],w=0,C=u.length,E=C,k=s.getTypeOf(u)!=="string";w<u.length;)E=C-w,l=k?(d=u[w++],m=w<C?u[w++]:0,w<C?u[w++]:0):(d=u.charCodeAt(w++),m=w<C?u.charCodeAt(w++):0,w<C?u.charCodeAt(w++):0),f=d>>2,p=(3&d)<<4|m>>4,y=1<E?(15&m)<<2|l>>6:64,_=2<E?63&l:64,v.push(h.charAt(f)+h.charAt(p)+h.charAt(y)+h.charAt(_));return v.join("")},n.decode=function(u){var d,m,l,f,p,y,_=0,v=0,w="data:";if(u.substr(0,w.length)===w)throw new Error("Invalid base64 input, it looks like a data url.");var C,E=3*(u=u.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(u.charAt(u.length-1)===h.charAt(64)&&E--,u.charAt(u.length-2)===h.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(C=a.uint8array?new Uint8Array(0|E):new Array(0|E);_<u.length;)d=h.indexOf(u.charAt(_++))<<2|(f=h.indexOf(u.charAt(_++)))>>4,m=(15&f)<<4|(p=h.indexOf(u.charAt(_++)))>>2,l=(3&p)<<6|(y=h.indexOf(u.charAt(_++))),C[v++]=d,p!==64&&(C[v++]=m),y!==64&&(C[v++]=l);return C}},{"./support":30,"./utils":32}],2:[function(e,r,n){var s=e("./external"),a=e("./stream/DataWorker"),h=e("./stream/Crc32Probe"),u=e("./stream/DataLengthProbe");function d(m,l,f,p,y){this.compressedSize=m,this.uncompressedSize=l,this.crc32=f,this.compression=p,this.compressedContent=y}d.prototype={getContentWorker:function(){var m=new a(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new u("data_length")),l=this;return m.on("end",function(){if(this.streamInfo.data_length!==l.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),m},getCompressedWorker:function(){return new a(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(m,l,f){return m.pipe(new h).pipe(new u("uncompressedSize")).pipe(l.compressWorker(f)).pipe(new u("compressedSize")).withStreamInfo("compression",l)},r.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,r,n){var s=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,r,n){var s=e("./utils"),a=function(){for(var h,u=[],d=0;d<256;d++){h=d;for(var m=0;m<8;m++)h=1&h?3988292384^h>>>1:h>>>1;u[d]=h}return u}();r.exports=function(h,u){return h!==void 0&&h.length?s.getTypeOf(h)!=="string"?function(d,m,l,f){var p=a,y=f+l;d^=-1;for(var _=f;_<y;_++)d=d>>>8^p[255&(d^m[_])];return-1^d}(0|u,h,h.length,0):function(d,m,l,f){var p=a,y=f+l;d^=-1;for(var _=f;_<y;_++)d=d>>>8^p[255&(d^m.charCodeAt(_))];return-1^d}(0|u,h,h.length,0):0}},{"./utils":32}],5:[function(e,r,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,r,n){var s=null;s=typeof Promise<"u"?Promise:e("lie"),r.exports={Promise:s}},{lie:37}],7:[function(e,r,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=e("pako"),h=e("./utils"),u=e("./stream/GenericWorker"),d=s?"uint8array":"array";function m(l,f){u.call(this,"FlateWorker/"+l),this._pako=null,this._pakoAction=l,this._pakoOptions=f,this.meta={}}n.magic="\b\0",h.inherits(m,u),m.prototype.processChunk=function(l){this.meta=l.meta,this._pako===null&&this._createPako(),this._pako.push(h.transformTo(d,l.data),!1)},m.prototype.flush=function(){u.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},m.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this._pako=null},m.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var l=this;this._pako.onData=function(f){l.push({data:f,meta:l.meta})}},n.compressWorker=function(l){return new m("Deflate",l)},n.uncompressWorker=function(){return new m("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,r,n){function s(p,y){var _,v="";for(_=0;_<y;_++)v+=String.fromCharCode(255&p),p>>>=8;return v}function a(p,y,_,v,w,C){var E,k,G=p.file,Q=p.compression,Y=C!==d.utf8encode,it=h.transformTo("string",C(G.name)),J=h.transformTo("string",d.utf8encode(G.name)),st=G.comment,gt=h.transformTo("string",C(st)),j=h.transformTo("string",d.utf8encode(st)),Z=J.length!==G.name.length,T=j.length!==st.length,ut="",Pt="",pt="",Gt=G.dir,bt=G.date,xt={crc32:0,compressedSize:0,uncompressedSize:0};y&&!_||(xt.crc32=p.crc32,xt.compressedSize=p.compressedSize,xt.uncompressedSize=p.uncompressedSize);var tt=0;y&&(tt|=8),Y||!Z&&!T||(tt|=2048);var et=0,Ht=0;Gt&&(et|=16),w==="UNIX"?(Ht=798,et|=function(Mt,te){var re=Mt;return Mt||(re=te?16893:33204),(65535&re)<<16}(G.unixPermissions,Gt)):(Ht=20,et|=function(Mt){return 63&(Mt||0)}(G.dosPermissions)),E=bt.getUTCHours(),E<<=6,E|=bt.getUTCMinutes(),E<<=5,E|=bt.getUTCSeconds()/2,k=bt.getUTCFullYear()-1980,k<<=4,k|=bt.getUTCMonth()+1,k<<=5,k|=bt.getUTCDate(),Z&&(Pt=s(1,1)+s(m(it),4)+J,ut+="up"+s(Pt.length,2)+Pt),T&&(pt=s(1,1)+s(m(gt),4)+j,ut+="uc"+s(pt.length,2)+pt);var Dt="";return Dt+=`
\0`,Dt+=s(tt,2),Dt+=Q.magic,Dt+=s(E,2),Dt+=s(k,2),Dt+=s(xt.crc32,4),Dt+=s(xt.compressedSize,4),Dt+=s(xt.uncompressedSize,4),Dt+=s(it.length,2),Dt+=s(ut.length,2),{fileRecord:l.LOCAL_FILE_HEADER+Dt+it+ut,dirRecord:l.CENTRAL_FILE_HEADER+s(Ht,2)+Dt+s(gt.length,2)+"\0\0\0\0"+s(et,4)+s(v,4)+it+ut+gt}}var h=e("../utils"),u=e("../stream/GenericWorker"),d=e("../utf8"),m=e("../crc32"),l=e("../signature");function f(p,y,_,v){u.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=_,this.encodeFileName=v,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}h.inherits(f,u),f.prototype.push=function(p){var y=p.meta.percent||0,_=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,u.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:_?(y+100*(_-v-1))/_:100}}))},f.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var y=this.streamFiles&&!p.file.dir;if(y){var _=a(p,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:_.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(p){this.accumulate=!1;var y=this.streamFiles&&!p.file.dir,_=a(p,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(_.dirRecord),y)this.push({data:function(v){return l.DATA_DESCRIPTOR+s(v.crc32,4)+s(v.compressedSize,4)+s(v.uncompressedSize,4)}(p),meta:{percent:100}});else for(this.push({data:_.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var p=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var _=this.bytesWritten-p,v=function(w,C,E,k,G){var Q=h.transformTo("string",G(k));return l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(w,2)+s(w,2)+s(C,4)+s(E,4)+s(Q.length,2)+Q}(this.dirRecords.length,_,p,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(p){this._sources.push(p);var y=this;return p.on("data",function(_){y.processChunk(_)}),p.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),p.on("error",function(_){y.error(_)}),this},f.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(p){var y=this._sources;if(!u.prototype.error.call(this,p))return!1;for(var _=0;_<y.length;_++)try{y[_].error(p)}catch{}return!0},f.prototype.lock=function(){u.prototype.lock.call(this);for(var p=this._sources,y=0;y<p.length;y++)p[y].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,r,n){var s=e("../compressions"),a=e("./ZipFileWorker");n.generateWorker=function(h,u,d){var m=new a(u.streamFiles,d,u.platform,u.encodeFileName),l=0;try{h.forEach(function(f,p){l++;var y=function(C,E){var k=C||E,G=s[k];if(!G)throw new Error(k+" is not a valid compression method !");return G}(p.options.compression,u.compression),_=p.options.compressionOptions||u.compressionOptions||{},v=p.dir,w=p.date;p._compressWorker(y,_).withStreamInfo("file",{name:f,dir:v,date:w,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(m)}),m.entriesCount=l}catch(f){m.error(f)}return m}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,r,n){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new s;for(var h in this)typeof this[h]!="function"&&(a[h]=this[h]);return a}}(s.prototype=e("./object")).loadAsync=e("./load"),s.support=e("./support"),s.defaults=e("./defaults"),s.version="3.10.1",s.loadAsync=function(a,h){return new s().loadAsync(a,h)},s.external=e("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,r,n){var s=e("./utils"),a=e("./external"),h=e("./utf8"),u=e("./zipEntries"),d=e("./stream/Crc32Probe"),m=e("./nodejsUtils");function l(f){return new a.Promise(function(p,y){var _=f.decompressed.getContentWorker().pipe(new d);_.on("error",function(v){y(v)}).on("end",function(){_.streamInfo.crc32!==f.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}r.exports=function(f,p){var y=this;return p=s.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:h.utf8decode}),m.isNode&&m.isStream(f)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,p.optimizedBinaryString,p.base64).then(function(_){var v=new u(p);return v.load(_),v}).then(function(_){var v=[a.Promise.resolve(_)],w=_.files;if(p.checkCRC32)for(var C=0;C<w.length;C++)v.push(l(w[C]));return a.Promise.all(v)}).then(function(_){for(var v=_.shift(),w=v.files,C=0;C<w.length;C++){var E=w[C],k=E.fileNameStr,G=s.resolve(E.fileNameStr);y.file(G,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:p.createFolders}),E.dir||(y.file(G).unsafeOriginalName=k)}return v.zipComment.length&&(y.comment=v.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,r,n){var s=e("../utils"),a=e("../stream/GenericWorker");function h(u,d){a.call(this,"Nodejs stream input adapter for "+u),this._upstreamEnded=!1,this._bindStream(d)}s.inherits(h,a),h.prototype._bindStream=function(u){var d=this;(this._stream=u).pause(),u.on("data",function(m){d.push({data:m,meta:{percent:0}})}).on("error",function(m){d.isPaused?this.generatedError=m:d.error(m)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},h.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},h.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=h},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,r,n){var s=e("readable-stream").Readable;function a(h,u,d){s.call(this,u),this._helper=h;var m=this;h.on("data",function(l,f){m.push(l)||m._helper.pause(),d&&d(f)}).on("error",function(l){m.emit("error",l)}).on("end",function(){m.push(null)})}e("../utils").inherits(a,s),a.prototype._read=function(){this._helper.resume()},r.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,r,n){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,a);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,a)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var a=new Buffer(s);return a.fill(0),a},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(e,r,n){function s(G,Q,Y){var it,J=h.getTypeOf(Q),st=h.extend(Y||{},m);st.date=st.date||new Date,st.compression!==null&&(st.compression=st.compression.toUpperCase()),typeof st.unixPermissions=="string"&&(st.unixPermissions=parseInt(st.unixPermissions,8)),st.unixPermissions&&16384&st.unixPermissions&&(st.dir=!0),st.dosPermissions&&16&st.dosPermissions&&(st.dir=!0),st.dir&&(G=w(G)),st.createFolders&&(it=v(G))&&C.call(this,it,!0);var gt=J==="string"&&st.binary===!1&&st.base64===!1;Y&&Y.binary!==void 0||(st.binary=!gt),(Q instanceof l&&Q.uncompressedSize===0||st.dir||!Q||Q.length===0)&&(st.base64=!1,st.binary=!0,Q="",st.compression="STORE",J="string");var j=null;j=Q instanceof l||Q instanceof u?Q:y.isNode&&y.isStream(Q)?new _(G,Q):h.prepareContent(G,Q,st.binary,st.optimizedBinaryString,st.base64);var Z=new f(G,j,st);this.files[G]=Z}var a=e("./utf8"),h=e("./utils"),u=e("./stream/GenericWorker"),d=e("./stream/StreamHelper"),m=e("./defaults"),l=e("./compressedObject"),f=e("./zipObject"),p=e("./generate"),y=e("./nodejsUtils"),_=e("./nodejs/NodejsStreamInputAdapter"),v=function(G){G.slice(-1)==="/"&&(G=G.substring(0,G.length-1));var Q=G.lastIndexOf("/");return 0<Q?G.substring(0,Q):""},w=function(G){return G.slice(-1)!=="/"&&(G+="/"),G},C=function(G,Q){return Q=Q!==void 0?Q:m.createFolders,G=w(G),this.files[G]||s.call(this,G,null,{dir:!0,createFolders:Q}),this.files[G]};function E(G){return Object.prototype.toString.call(G)==="[object RegExp]"}var k={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(G){var Q,Y,it;for(Q in this.files)it=this.files[Q],(Y=Q.slice(this.root.length,Q.length))&&Q.slice(0,this.root.length)===this.root&&G(Y,it)},filter:function(G){var Q=[];return this.forEach(function(Y,it){G(Y,it)&&Q.push(it)}),Q},file:function(G,Q,Y){if(arguments.length!==1)return G=this.root+G,s.call(this,G,Q,Y),this;if(E(G)){var it=G;return this.filter(function(st,gt){return!gt.dir&&it.test(st)})}var J=this.files[this.root+G];return J&&!J.dir?J:null},folder:function(G){if(!G)return this;if(E(G))return this.filter(function(J,st){return st.dir&&G.test(J)});var Q=this.root+G,Y=C.call(this,Q),it=this.clone();return it.root=Y.name,it},remove:function(G){G=this.root+G;var Q=this.files[G];if(Q||(G.slice(-1)!=="/"&&(G+="/"),Q=this.files[G]),Q&&!Q.dir)delete this.files[G];else for(var Y=this.filter(function(J,st){return st.name.slice(0,G.length)===G}),it=0;it<Y.length;it++)delete this.files[Y[it].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(G){var Q,Y={};try{if((Y=h.extend(G||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=Y.type.toLowerCase(),Y.compression=Y.compression.toUpperCase(),Y.type==="binarystring"&&(Y.type="string"),!Y.type)throw new Error("No output type specified.");h.checkSupport(Y.type),Y.platform!=="darwin"&&Y.platform!=="freebsd"&&Y.platform!=="linux"&&Y.platform!=="sunos"||(Y.platform="UNIX"),Y.platform==="win32"&&(Y.platform="DOS");var it=Y.comment||this.comment||"";Q=p.generateWorker(this,Y,it)}catch(J){(Q=new u("error")).error(J)}return new d(Q,Y.type||"string",Y.mimeType)},generateAsync:function(G,Q){return this.generateInternalStream(G).accumulate(Q)},generateNodeStream:function(G,Q){return(G=G||{}).type||(G.type="nodebuffer"),this.generateInternalStream(G).toNodejsStream(Q)}};r.exports=k},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,r,n){r.exports=e("stream")},{stream:void 0}],17:[function(e,r,n){var s=e("./DataReader");function a(h){s.call(this,h);for(var u=0;u<this.data.length;u++)h[u]=255&h[u]}e("../utils").inherits(a,s),a.prototype.byteAt=function(h){return this.data[this.zero+h]},a.prototype.lastIndexOfSignature=function(h){for(var u=h.charCodeAt(0),d=h.charCodeAt(1),m=h.charCodeAt(2),l=h.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===u&&this.data[f+1]===d&&this.data[f+2]===m&&this.data[f+3]===l)return f-this.zero;return-1},a.prototype.readAndCheckSignature=function(h){var u=h.charCodeAt(0),d=h.charCodeAt(1),m=h.charCodeAt(2),l=h.charCodeAt(3),f=this.readData(4);return u===f[0]&&d===f[1]&&m===f[2]&&l===f[3]},a.prototype.readData=function(h){if(this.checkOffset(h),h===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,u},r.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,r,n){var s=e("../utils");function a(h){this.data=h,this.length=h.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(h){this.checkIndex(this.index+h)},checkIndex:function(h){if(this.length<this.zero+h||h<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+h+"). Corrupted zip ?")},setIndex:function(h){this.checkIndex(h),this.index=h},skip:function(h){this.setIndex(this.index+h)},byteAt:function(){},readInt:function(h){var u,d=0;for(this.checkOffset(h),u=this.index+h-1;u>=this.index;u--)d=(d<<8)+this.byteAt(u);return this.index+=h,d},readString:function(h){return s.transformTo("string",this.readData(h))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var h=this.readInt(4);return new Date(Date.UTC(1980+(h>>25&127),(h>>21&15)-1,h>>16&31,h>>11&31,h>>5&63,(31&h)<<1))}},r.exports=a},{"../utils":32}],19:[function(e,r,n){var s=e("./Uint8ArrayReader");function a(h){s.call(this,h)}e("../utils").inherits(a,s),a.prototype.readData=function(h){this.checkOffset(h);var u=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,u},r.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,r,n){var s=e("./DataReader");function a(h){s.call(this,h)}e("../utils").inherits(a,s),a.prototype.byteAt=function(h){return this.data.charCodeAt(this.zero+h)},a.prototype.lastIndexOfSignature=function(h){return this.data.lastIndexOf(h)-this.zero},a.prototype.readAndCheckSignature=function(h){return h===this.readData(4)},a.prototype.readData=function(h){this.checkOffset(h);var u=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,u},r.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,r,n){var s=e("./ArrayReader");function a(h){s.call(this,h)}e("../utils").inherits(a,s),a.prototype.readData=function(h){if(this.checkOffset(h),h===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+h);return this.index+=h,u},r.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,r,n){var s=e("../utils"),a=e("../support"),h=e("./ArrayReader"),u=e("./StringReader"),d=e("./NodeBufferReader"),m=e("./Uint8ArrayReader");r.exports=function(l){var f=s.getTypeOf(l);return s.checkSupport(f),f!=="string"||a.uint8array?f==="nodebuffer"?new d(l):a.uint8array?new m(s.transformTo("uint8array",l)):new h(s.transformTo("array",l)):new u(l)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,r,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,r,n){var s=e("./GenericWorker"),a=e("../utils");function h(u){s.call(this,"ConvertWorker to "+u),this.destType=u}a.inherits(h,s),h.prototype.processChunk=function(u){this.push({data:a.transformTo(this.destType,u.data),meta:u.meta})},r.exports=h},{"../utils":32,"./GenericWorker":28}],25:[function(e,r,n){var s=e("./GenericWorker"),a=e("../crc32");function h(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(h,s),h.prototype.processChunk=function(u){this.streamInfo.crc32=a(u.data,this.streamInfo.crc32||0),this.push(u)},r.exports=h},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,r,n){var s=e("../utils"),a=e("./GenericWorker");function h(u){a.call(this,"DataLengthProbe for "+u),this.propName=u,this.withStreamInfo(u,0)}s.inherits(h,a),h.prototype.processChunk=function(u){if(u){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+u.data.length}a.prototype.processChunk.call(this,u)},r.exports=h},{"../utils":32,"./GenericWorker":28}],27:[function(e,r,n){var s=e("../utils"),a=e("./GenericWorker");function h(u){a.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(m){d.dataIsReady=!0,d.data=m,d.max=m&&m.length||0,d.type=s.getTypeOf(m),d.isPaused||d._tickAndRepeat()},function(m){d.error(m)})}s.inherits(h,a),h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},h.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},h.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},h.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,d);break;case"uint8array":u=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":u=this.data.slice(this.index,d)}return this.index=d,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=h},{"../utils":32,"./GenericWorker":28}],28:[function(e,r,n){function s(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,h){return this._listeners[a].push(h),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,h){if(this._listeners[a])for(var u=0;u<this._listeners[a].length;u++)this._listeners[a][u].call(this,h)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var h=this;return a.on("data",function(u){h.processChunk(u)}),a.on("end",function(){h.end()}),a.on("error",function(u){h.error(u)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,h){return this.extraStreamInfo[a]=h,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},r.exports=s},{}],29:[function(e,r,n){var s=e("../utils"),a=e("./ConvertWorker"),h=e("./GenericWorker"),u=e("../base64"),d=e("../support"),m=e("../external"),l=null;if(d.nodestream)try{l=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(y,_){return new m.Promise(function(v,w){var C=[],E=y._internalType,k=y._outputType,G=y._mimeType;y.on("data",function(Q,Y){C.push(Q),_&&_(Y)}).on("error",function(Q){C=[],w(Q)}).on("end",function(){try{var Q=function(Y,it,J){switch(Y){case"blob":return s.newBlob(s.transformTo("arraybuffer",it),J);case"base64":return u.encode(it);default:return s.transformTo(Y,it)}}(k,function(Y,it){var J,st=0,gt=null,j=0;for(J=0;J<it.length;J++)j+=it[J].length;switch(Y){case"string":return it.join("");case"array":return Array.prototype.concat.apply([],it);case"uint8array":for(gt=new Uint8Array(j),J=0;J<it.length;J++)gt.set(it[J],st),st+=it[J].length;return gt;case"nodebuffer":return Buffer.concat(it);default:throw new Error("concat : unsupported type '"+Y+"'")}}(E,C),G);v(Q)}catch(Y){w(Y)}C=[]}).resume()})}function p(y,_,v){var w=_;switch(_){case"blob":case"arraybuffer":w="uint8array";break;case"base64":w="string"}try{this._internalType=w,this._outputType=_,this._mimeType=v,s.checkSupport(w),this._worker=y.pipe(new a(w)),y.lock()}catch(C){this._worker=new h("error"),this._worker.error(C)}}p.prototype={accumulate:function(y){return f(this,y)},on:function(y,_){var v=this;return y==="data"?this._worker.on(y,function(w){_.call(v,w.data,w.meta)}):this._worker.on(y,function(){s.delay(_,arguments,v)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:this._outputType!=="nodebuffer"},y)}},r.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,r,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var s=new ArrayBuffer(0);try{n.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(s),n.blob=a.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(e,r,n){for(var s=e("./utils"),a=e("./support"),h=e("./nodejsUtils"),u=e("./stream/GenericWorker"),d=new Array(256),m=0;m<256;m++)d[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;d[254]=d[254]=1;function l(){u.call(this,"utf-8 decode"),this.leftOver=null}function f(){u.call(this,"utf-8 encode")}n.utf8encode=function(p){return a.nodebuffer?h.newBufferFrom(p,"utf-8"):function(y){var _,v,w,C,E,k=y.length,G=0;for(C=0;C<k;C++)(64512&(v=y.charCodeAt(C)))==55296&&C+1<k&&(64512&(w=y.charCodeAt(C+1)))==56320&&(v=65536+(v-55296<<10)+(w-56320),C++),G+=v<128?1:v<2048?2:v<65536?3:4;for(_=a.uint8array?new Uint8Array(G):new Array(G),C=E=0;E<G;C++)(64512&(v=y.charCodeAt(C)))==55296&&C+1<k&&(64512&(w=y.charCodeAt(C+1)))==56320&&(v=65536+(v-55296<<10)+(w-56320),C++),v<128?_[E++]=v:(v<2048?_[E++]=192|v>>>6:(v<65536?_[E++]=224|v>>>12:(_[E++]=240|v>>>18,_[E++]=128|v>>>12&63),_[E++]=128|v>>>6&63),_[E++]=128|63&v);return _}(p)},n.utf8decode=function(p){return a.nodebuffer?s.transformTo("nodebuffer",p).toString("utf-8"):function(y){var _,v,w,C,E=y.length,k=new Array(2*E);for(_=v=0;_<E;)if((w=y[_++])<128)k[v++]=w;else if(4<(C=d[w]))k[v++]=65533,_+=C-1;else{for(w&=C===2?31:C===3?15:7;1<C&&_<E;)w=w<<6|63&y[_++],C--;1<C?k[v++]=65533:w<65536?k[v++]=w:(w-=65536,k[v++]=55296|w>>10&1023,k[v++]=56320|1023&w)}return k.length!==v&&(k.subarray?k=k.subarray(0,v):k.length=v),s.applyFromCharCode(k)}(p=s.transformTo(a.uint8array?"uint8array":"array",p))},s.inherits(l,u),l.prototype.processChunk=function(p){var y=s.transformTo(a.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var _=y;(y=new Uint8Array(_.length+this.leftOver.length)).set(this.leftOver,0),y.set(_,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var v=function(C,E){var k;for((E=E||C.length)>C.length&&(E=C.length),k=E-1;0<=k&&(192&C[k])==128;)k--;return k<0||k===0?E:k+d[C[k]]>E?k:E}(y),w=y;v!==y.length&&(a.uint8array?(w=y.subarray(0,v),this.leftOver=y.subarray(v,y.length)):(w=y.slice(0,v),this.leftOver=y.slice(v,y.length))),this.push({data:n.utf8decode(w),meta:p.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=l,s.inherits(f,u),f.prototype.processChunk=function(p){this.push({data:n.utf8encode(p.data),meta:p.meta})},n.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,r,n){var s=e("./support"),a=e("./base64"),h=e("./nodejsUtils"),u=e("./external");function d(_){return _}function m(_,v){for(var w=0;w<_.length;++w)v[w]=255&_.charCodeAt(w);return v}e("setimmediate"),n.newBlob=function(_,v){n.checkSupport("blob");try{return new Blob([_],{type:v})}catch{try{var w=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return w.append(_),w.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(_,v,w){var C=[],E=0,k=_.length;if(k<=w)return String.fromCharCode.apply(null,_);for(;E<k;)v==="array"||v==="nodebuffer"?C.push(String.fromCharCode.apply(null,_.slice(E,Math.min(E+w,k)))):C.push(String.fromCharCode.apply(null,_.subarray(E,Math.min(E+w,k)))),E+=w;return C.join("")},stringifyByChar:function(_){for(var v="",w=0;w<_.length;w++)v+=String.fromCharCode(_[w]);return v},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,h.allocBuffer(1)).length===1}catch{return!1}}()}};function f(_){var v=65536,w=n.getTypeOf(_),C=!0;if(w==="uint8array"?C=l.applyCanBeUsed.uint8array:w==="nodebuffer"&&(C=l.applyCanBeUsed.nodebuffer),C)for(;1<v;)try{return l.stringifyByChunk(_,w,v)}catch{v=Math.floor(v/2)}return l.stringifyByChar(_)}function p(_,v){for(var w=0;w<_.length;w++)v[w]=_[w];return v}n.applyFromCharCode=f;var y={};y.string={string:d,array:function(_){return m(_,new Array(_.length))},arraybuffer:function(_){return y.string.uint8array(_).buffer},uint8array:function(_){return m(_,new Uint8Array(_.length))},nodebuffer:function(_){return m(_,h.allocBuffer(_.length))}},y.array={string:f,array:d,arraybuffer:function(_){return new Uint8Array(_).buffer},uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return h.newBufferFrom(_)}},y.arraybuffer={string:function(_){return f(new Uint8Array(_))},array:function(_){return p(new Uint8Array(_),new Array(_.byteLength))},arraybuffer:d,uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return h.newBufferFrom(new Uint8Array(_))}},y.uint8array={string:f,array:function(_){return p(_,new Array(_.length))},arraybuffer:function(_){return _.buffer},uint8array:d,nodebuffer:function(_){return h.newBufferFrom(_)}},y.nodebuffer={string:f,array:function(_){return p(_,new Array(_.length))},arraybuffer:function(_){return y.nodebuffer.uint8array(_).buffer},uint8array:function(_){return p(_,new Uint8Array(_.length))},nodebuffer:d},n.transformTo=function(_,v){if(v=v||"",!_)return v;n.checkSupport(_);var w=n.getTypeOf(v);return y[w][_](v)},n.resolve=function(_){for(var v=_.split("/"),w=[],C=0;C<v.length;C++){var E=v[C];E==="."||E===""&&C!==0&&C!==v.length-1||(E===".."?w.pop():w.push(E))}return w.join("/")},n.getTypeOf=function(_){return typeof _=="string"?"string":Object.prototype.toString.call(_)==="[object Array]"?"array":s.nodebuffer&&h.isBuffer(_)?"nodebuffer":s.uint8array&&_ instanceof Uint8Array?"uint8array":s.arraybuffer&&_ instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(_){if(!s[_.toLowerCase()])throw new Error(_+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(_){var v,w,C="";for(w=0;w<(_||"").length;w++)C+="\\x"+((v=_.charCodeAt(w))<16?"0":"")+v.toString(16).toUpperCase();return C},n.delay=function(_,v,w){setImmediate(function(){_.apply(w||null,v||[])})},n.inherits=function(_,v){function w(){}w.prototype=v.prototype,_.prototype=new w},n.extend=function(){var _,v,w={};for(_=0;_<arguments.length;_++)for(v in arguments[_])Object.prototype.hasOwnProperty.call(arguments[_],v)&&w[v]===void 0&&(w[v]=arguments[_][v]);return w},n.prepareContent=function(_,v,w,C,E){return u.Promise.resolve(v).then(function(k){return s.blob&&(k instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(k))!==-1)&&typeof FileReader<"u"?new u.Promise(function(G,Q){var Y=new FileReader;Y.onload=function(it){G(it.target.result)},Y.onerror=function(it){Q(it.target.error)},Y.readAsArrayBuffer(k)}):k}).then(function(k){var G=n.getTypeOf(k);return G?(G==="arraybuffer"?k=n.transformTo("uint8array",k):G==="string"&&(E?k=a.decode(k):w&&C!==!0&&(k=function(Q){return m(Q,s.uint8array?new Uint8Array(Q.length):new Array(Q.length))}(k))),k):u.Promise.reject(new Error("Can't read the data of '"+_+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,r,n){var s=e("./reader/readerFor"),a=e("./utils"),h=e("./signature"),u=e("./zipEntry"),d=e("./support");function m(l){this.files=[],this.loadOptions=l}m.prototype={checkSignature:function(l){if(!this.reader.readAndCheckSignature(l)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(f)+", expected "+a.pretty(l)+")")}},isSignature:function(l,f){var p=this.reader.index;this.reader.setIndex(l);var y=this.reader.readString(4)===f;return this.reader.setIndex(p),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var l=this.reader.readData(this.zipCommentLength),f=d.uint8array?"uint8array":"array",p=a.transformTo(f,l);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var l,f,p,y=this.zip64EndOfCentralSize-44;0<y;)l=this.reader.readInt(2),f=this.reader.readInt(4),p=this.reader.readData(f),this.zip64ExtensibleData[l]={id:l,length:f,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var l,f;for(l=0;l<this.files.length;l++)f=this.files[l],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(h.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var l;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(h.CENTRAL_FILE_HEADER);)(l=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(l);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var l=this.reader.lastIndexOfSignature(h.CENTRAL_DIRECTORY_END);if(l<0)throw this.isSignature(0,h.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(l);var f=l;if(this.checkSignature(h.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(l=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(l),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,h.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var y=f-p;if(0<y)this.isSignature(f,h.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(l){this.reader=s(l)},load:function(l){this.prepareReader(l),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=m},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,r,n){var s=e("./reader/readerFor"),a=e("./utils"),h=e("./compressedObject"),u=e("./crc32"),d=e("./utf8"),m=e("./compressions"),l=e("./support");function f(p,y){this.options=p,this.loadOptions=y}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var y,_;if(p.skip(22),this.fileNameLength=p.readInt(2),_=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=function(v){for(var w in m)if(Object.prototype.hasOwnProperty.call(m,w)&&m[w].magic===v)return m[w];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new h(this.compressedSize,this.uncompressedSize,this.crc32,y,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var y=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(y),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=s(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var y,_,v,w=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<w;)y=p.readInt(2),_=p.readInt(2),v=p.readData(_),this.extraFields[y]={id:y,length:_,value:v};p.setIndex(w)},handleUTF8:function(){var p=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var _=a.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var w=a.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(w)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var y=s(p.value);return y.readInt(1)!==1||u(this.fileName)!==y.readInt(4)?null:d.utf8decode(y.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var y=s(p.value);return y.readInt(1)!==1||u(this.fileComment)!==y.readInt(4)?null:d.utf8decode(y.readData(p.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,r,n){function s(y,_,v){this.name=y,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=_,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var a=e("./stream/StreamHelper"),h=e("./stream/DataWorker"),u=e("./utf8"),d=e("./compressedObject"),m=e("./stream/GenericWorker");s.prototype={internalStream:function(y){var _=null,v="string";try{if(!y)throw new Error("No output type specified.");var w=(v=y.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),_=this._decompressWorker();var C=!this._dataBinary;C&&!w&&(_=_.pipe(new u.Utf8EncodeWorker)),!C&&w&&(_=_.pipe(new u.Utf8DecodeWorker))}catch(E){(_=new m("error")).error(E)}return new a(_,v,"")},async:function(y,_){return this.internalStream(y).accumulate(_)},nodeStream:function(y,_){return this.internalStream(y||"nodebuffer").toNodejsStream(_)},_compressWorker:function(y,_){if(this._data instanceof d&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new u.Utf8EncodeWorker)),d.createWorkerFrom(v,y,_)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof m?this._data:new h(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<l.length;p++)s.prototype[l[p]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,r,n){(function(s){var a,h,u=s.MutationObserver||s.WebKitMutationObserver;if(u){var d=0,m=new u(y),l=s.document.createTextNode("");m.observe(l,{characterData:!0}),a=function(){l.data=d=++d%2}}else if(s.setImmediate||s.MessageChannel===void 0)a="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var _=s.document.createElement("script");_.onreadystatechange=function(){y(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},s.document.documentElement.appendChild(_)}:function(){setTimeout(y,0)};else{var f=new s.MessageChannel;f.port1.onmessage=y,a=function(){f.port2.postMessage(0)}}var p=[];function y(){var _,v;h=!0;for(var w=p.length;w;){for(v=p,p=[],_=-1;++_<w;)v[_]();w=p.length}h=!1}r.exports=function(_){p.push(_)!==1||h||a()}}).call(this,typeof si<"u"?si:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,r,n){var s=e("immediate");function a(){}var h={},u=["REJECTED"],d=["FULFILLED"],m=["PENDING"];function l(w){if(typeof w!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,w!==a&&_(this,w)}function f(w,C,E){this.promise=w,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function p(w,C,E){s(function(){var k;try{k=C(E)}catch(G){return h.reject(w,G)}k===w?h.reject(w,new TypeError("Cannot resolve promise with itself")):h.resolve(w,k)})}function y(w){var C=w&&w.then;if(w&&(typeof w=="object"||typeof w=="function")&&typeof C=="function")return function(){C.apply(w,arguments)}}function _(w,C){var E=!1;function k(Y){E||(E=!0,h.reject(w,Y))}function G(Y){E||(E=!0,h.resolve(w,Y))}var Q=v(function(){C(G,k)});Q.status==="error"&&k(Q.value)}function v(w,C){var E={};try{E.value=w(C),E.status="success"}catch(k){E.status="error",E.value=k}return E}(r.exports=l).prototype.finally=function(w){if(typeof w!="function")return this;var C=this.constructor;return this.then(function(E){return C.resolve(w()).then(function(){return E})},function(E){return C.resolve(w()).then(function(){throw E})})},l.prototype.catch=function(w){return this.then(null,w)},l.prototype.then=function(w,C){if(typeof w!="function"&&this.state===d||typeof C!="function"&&this.state===u)return this;var E=new this.constructor(a);return this.state!==m?p(E,this.state===d?w:C,this.outcome):this.queue.push(new f(E,w,C)),E},f.prototype.callFulfilled=function(w){h.resolve(this.promise,w)},f.prototype.otherCallFulfilled=function(w){p(this.promise,this.onFulfilled,w)},f.prototype.callRejected=function(w){h.reject(this.promise,w)},f.prototype.otherCallRejected=function(w){p(this.promise,this.onRejected,w)},h.resolve=function(w,C){var E=v(y,C);if(E.status==="error")return h.reject(w,E.value);var k=E.value;if(k)_(w,k);else{w.state=d,w.outcome=C;for(var G=-1,Q=w.queue.length;++G<Q;)w.queue[G].callFulfilled(C)}return w},h.reject=function(w,C){w.state=u,w.outcome=C;for(var E=-1,k=w.queue.length;++E<k;)w.queue[E].callRejected(C);return w},l.resolve=function(w){return w instanceof this?w:h.resolve(new this(a),w)},l.reject=function(w){var C=new this(a);return h.reject(C,w)},l.all=function(w){var C=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=w.length,k=!1;if(!E)return this.resolve([]);for(var G=new Array(E),Q=0,Y=-1,it=new this(a);++Y<E;)J(w[Y],Y);return it;function J(st,gt){C.resolve(st).then(function(j){G[gt]=j,++Q!==E||k||(k=!0,h.resolve(it,G))},function(j){k||(k=!0,h.reject(it,j))})}},l.race=function(w){var C=this;if(Object.prototype.toString.call(w)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=w.length,k=!1;if(!E)return this.resolve([]);for(var G=-1,Q=new this(a);++G<E;)Y=w[G],C.resolve(Y).then(function(it){k||(k=!0,h.resolve(Q,it))},function(it){k||(k=!0,h.reject(Q,it))});var Y;return Q}},{immediate:36}],38:[function(e,r,n){var s={};(0,e("./lib/utils/common").assign)(s,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,r,n){var s=e("./zlib/deflate"),a=e("./utils/common"),h=e("./utils/strings"),u=e("./zlib/messages"),d=e("./zlib/zstream"),m=Object.prototype.toString,l=0,f=-1,p=0,y=8;function _(w){if(!(this instanceof _))return new _(w);this.options=a.assign({level:f,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},w||{});var C=this.options;C.raw&&0<C.windowBits?C.windowBits=-C.windowBits:C.gzip&&0<C.windowBits&&C.windowBits<16&&(C.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var E=s.deflateInit2(this.strm,C.level,C.method,C.windowBits,C.memLevel,C.strategy);if(E!==l)throw new Error(u[E]);if(C.header&&s.deflateSetHeader(this.strm,C.header),C.dictionary){var k;if(k=typeof C.dictionary=="string"?h.string2buf(C.dictionary):m.call(C.dictionary)==="[object ArrayBuffer]"?new Uint8Array(C.dictionary):C.dictionary,(E=s.deflateSetDictionary(this.strm,k))!==l)throw new Error(u[E]);this._dict_set=!0}}function v(w,C){var E=new _(C);if(E.push(w,!0),E.err)throw E.msg||u[E.err];return E.result}_.prototype.push=function(w,C){var E,k,G=this.strm,Q=this.options.chunkSize;if(this.ended)return!1;k=C===~~C?C:C===!0?4:0,typeof w=="string"?G.input=h.string2buf(w):m.call(w)==="[object ArrayBuffer]"?G.input=new Uint8Array(w):G.input=w,G.next_in=0,G.avail_in=G.input.length;do{if(G.avail_out===0&&(G.output=new a.Buf8(Q),G.next_out=0,G.avail_out=Q),(E=s.deflate(G,k))!==1&&E!==l)return this.onEnd(E),!(this.ended=!0);G.avail_out!==0&&(G.avail_in!==0||k!==4&&k!==2)||(this.options.to==="string"?this.onData(h.buf2binstring(a.shrinkBuf(G.output,G.next_out))):this.onData(a.shrinkBuf(G.output,G.next_out)))}while((0<G.avail_in||G.avail_out===0)&&E!==1);return k===4?(E=s.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===l):k!==2||(this.onEnd(l),!(G.avail_out=0))},_.prototype.onData=function(w){this.chunks.push(w)},_.prototype.onEnd=function(w){w===l&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},n.Deflate=_,n.deflate=v,n.deflateRaw=function(w,C){return(C=C||{}).raw=!0,v(w,C)},n.gzip=function(w,C){return(C=C||{}).gzip=!0,v(w,C)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,r,n){var s=e("./zlib/inflate"),a=e("./utils/common"),h=e("./utils/strings"),u=e("./zlib/constants"),d=e("./zlib/messages"),m=e("./zlib/zstream"),l=e("./zlib/gzheader"),f=Object.prototype.toString;function p(_){if(!(this instanceof p))return new p(_);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},_||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||_&&_.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&(15&v.windowBits)==0&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var w=s.inflateInit2(this.strm,v.windowBits);if(w!==u.Z_OK)throw new Error(d[w]);this.header=new l,s.inflateGetHeader(this.strm,this.header)}function y(_,v){var w=new p(v);if(w.push(_,!0),w.err)throw w.msg||d[w.err];return w.result}p.prototype.push=function(_,v){var w,C,E,k,G,Q,Y=this.strm,it=this.options.chunkSize,J=this.options.dictionary,st=!1;if(this.ended)return!1;C=v===~~v?v:v===!0?u.Z_FINISH:u.Z_NO_FLUSH,typeof _=="string"?Y.input=h.binstring2buf(_):f.call(_)==="[object ArrayBuffer]"?Y.input=new Uint8Array(_):Y.input=_,Y.next_in=0,Y.avail_in=Y.input.length;do{if(Y.avail_out===0&&(Y.output=new a.Buf8(it),Y.next_out=0,Y.avail_out=it),(w=s.inflate(Y,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&J&&(Q=typeof J=="string"?h.string2buf(J):f.call(J)==="[object ArrayBuffer]"?new Uint8Array(J):J,w=s.inflateSetDictionary(this.strm,Q)),w===u.Z_BUF_ERROR&&st===!0&&(w=u.Z_OK,st=!1),w!==u.Z_STREAM_END&&w!==u.Z_OK)return this.onEnd(w),!(this.ended=!0);Y.next_out&&(Y.avail_out!==0&&w!==u.Z_STREAM_END&&(Y.avail_in!==0||C!==u.Z_FINISH&&C!==u.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=h.utf8border(Y.output,Y.next_out),k=Y.next_out-E,G=h.buf2string(Y.output,E),Y.next_out=k,Y.avail_out=it-k,k&&a.arraySet(Y.output,Y.output,E,k,0),this.onData(G)):this.onData(a.shrinkBuf(Y.output,Y.next_out)))),Y.avail_in===0&&Y.avail_out===0&&(st=!0)}while((0<Y.avail_in||Y.avail_out===0)&&w!==u.Z_STREAM_END);return w===u.Z_STREAM_END&&(C=u.Z_FINISH),C===u.Z_FINISH?(w=s.inflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===u.Z_OK):C!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),!(Y.avail_out=0))},p.prototype.onData=function(_){this.chunks.push(_)},p.prototype.onEnd=function(_){_===u.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},n.Inflate=p,n.inflate=y,n.inflateRaw=function(_,v){return(v=v||{}).raw=!0,y(_,v)},n.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,r,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(u){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var m=d.shift();if(m){if(typeof m!="object")throw new TypeError(m+"must be non-object");for(var l in m)m.hasOwnProperty(l)&&(u[l]=m[l])}}return u},n.shrinkBuf=function(u,d){return u.length===d?u:u.subarray?u.subarray(0,d):(u.length=d,u)};var a={arraySet:function(u,d,m,l,f){if(d.subarray&&u.subarray)u.set(d.subarray(m,m+l),f);else for(var p=0;p<l;p++)u[f+p]=d[m+p]},flattenChunks:function(u){var d,m,l,f,p,y;for(d=l=0,m=u.length;d<m;d++)l+=u[d].length;for(y=new Uint8Array(l),d=f=0,m=u.length;d<m;d++)p=u[d],y.set(p,f),f+=p.length;return y}},h={arraySet:function(u,d,m,l,f){for(var p=0;p<l;p++)u[f+p]=d[m+p]},flattenChunks:function(u){return[].concat.apply([],u)}};n.setTyped=function(u){u?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,a)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,h))},n.setTyped(s)},{}],42:[function(e,r,n){var s=e("./common"),a=!0,h=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{h=!1}for(var u=new s.Buf8(256),d=0;d<256;d++)u[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function m(l,f){if(f<65537&&(l.subarray&&h||!l.subarray&&a))return String.fromCharCode.apply(null,s.shrinkBuf(l,f));for(var p="",y=0;y<f;y++)p+=String.fromCharCode(l[y]);return p}u[254]=u[254]=1,n.string2buf=function(l){var f,p,y,_,v,w=l.length,C=0;for(_=0;_<w;_++)(64512&(p=l.charCodeAt(_)))==55296&&_+1<w&&(64512&(y=l.charCodeAt(_+1)))==56320&&(p=65536+(p-55296<<10)+(y-56320),_++),C+=p<128?1:p<2048?2:p<65536?3:4;for(f=new s.Buf8(C),_=v=0;v<C;_++)(64512&(p=l.charCodeAt(_)))==55296&&_+1<w&&(64512&(y=l.charCodeAt(_+1)))==56320&&(p=65536+(p-55296<<10)+(y-56320),_++),p<128?f[v++]=p:(p<2048?f[v++]=192|p>>>6:(p<65536?f[v++]=224|p>>>12:(f[v++]=240|p>>>18,f[v++]=128|p>>>12&63),f[v++]=128|p>>>6&63),f[v++]=128|63&p);return f},n.buf2binstring=function(l){return m(l,l.length)},n.binstring2buf=function(l){for(var f=new s.Buf8(l.length),p=0,y=f.length;p<y;p++)f[p]=l.charCodeAt(p);return f},n.buf2string=function(l,f){var p,y,_,v,w=f||l.length,C=new Array(2*w);for(p=y=0;p<w;)if((_=l[p++])<128)C[y++]=_;else if(4<(v=u[_]))C[y++]=65533,p+=v-1;else{for(_&=v===2?31:v===3?15:7;1<v&&p<w;)_=_<<6|63&l[p++],v--;1<v?C[y++]=65533:_<65536?C[y++]=_:(_-=65536,C[y++]=55296|_>>10&1023,C[y++]=56320|1023&_)}return m(C,y)},n.utf8border=function(l,f){var p;for((f=f||l.length)>l.length&&(f=l.length),p=f-1;0<=p&&(192&l[p])==128;)p--;return p<0||p===0?f:p+u[l[p]]>f?p:f}},{"./common":41}],43:[function(e,r,n){r.exports=function(s,a,h,u){for(var d=65535&s|0,m=s>>>16&65535|0,l=0;h!==0;){for(h-=l=2e3<h?2e3:h;m=m+(d=d+a[u++]|0)|0,--l;);d%=65521,m%=65521}return d|m<<16|0}},{}],44:[function(e,r,n){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,r,n){var s=function(){for(var a,h=[],u=0;u<256;u++){a=u;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;h[u]=a}return h}();r.exports=function(a,h,u,d){var m=s,l=d+u;a^=-1;for(var f=d;f<l;f++)a=a>>>8^m[255&(a^h[f])];return-1^a}},{}],46:[function(e,r,n){var s,a=e("../utils/common"),h=e("./trees"),u=e("./adler32"),d=e("./crc32"),m=e("./messages"),l=0,f=4,p=0,y=-2,_=-1,v=4,w=2,C=8,E=9,k=286,G=30,Q=19,Y=2*k+1,it=15,J=3,st=258,gt=st+J+1,j=42,Z=113,T=1,ut=2,Pt=3,pt=4;function Gt(S,At){return S.msg=m[At],At}function bt(S){return(S<<1)-(4<S?9:0)}function xt(S){for(var At=S.length;0<=--At;)S[At]=0}function tt(S){var At=S.state,_t=At.pending;_t>S.avail_out&&(_t=S.avail_out),_t!==0&&(a.arraySet(S.output,At.pending_buf,At.pending_out,_t,S.next_out),S.next_out+=_t,At.pending_out+=_t,S.total_out+=_t,S.avail_out-=_t,At.pending-=_t,At.pending===0&&(At.pending_out=0))}function et(S,At){h._tr_flush_block(S,0<=S.block_start?S.block_start:-1,S.strstart-S.block_start,At),S.block_start=S.strstart,tt(S.strm)}function Ht(S,At){S.pending_buf[S.pending++]=At}function Dt(S,At){S.pending_buf[S.pending++]=At>>>8&255,S.pending_buf[S.pending++]=255&At}function Mt(S,At){var _t,X,V=S.max_chain_length,lt=S.strstart,Et=S.prev_length,Tt=S.nice_match,at=S.strstart>S.w_size-gt?S.strstart-(S.w_size-gt):0,Nt=S.window,Kt=S.w_mask,Lt=S.prev,ee=S.strstart+st,D=Nt[lt+Et-1],b=Nt[lt+Et];S.prev_length>=S.good_match&&(V>>=2),Tt>S.lookahead&&(Tt=S.lookahead);do if(Nt[(_t=At)+Et]===b&&Nt[_t+Et-1]===D&&Nt[_t]===Nt[lt]&&Nt[++_t]===Nt[lt+1]){lt+=2,_t++;do;while(Nt[++lt]===Nt[++_t]&&Nt[++lt]===Nt[++_t]&&Nt[++lt]===Nt[++_t]&&Nt[++lt]===Nt[++_t]&&Nt[++lt]===Nt[++_t]&&Nt[++lt]===Nt[++_t]&&Nt[++lt]===Nt[++_t]&&Nt[++lt]===Nt[++_t]&&lt<ee);if(X=st-(ee-lt),lt=ee-st,Et<X){if(S.match_start=At,Tt<=(Et=X))break;D=Nt[lt+Et-1],b=Nt[lt+Et]}}while((At=Lt[At&Kt])>at&&--V!=0);return Et<=S.lookahead?Et:S.lookahead}function te(S){var At,_t,X,V,lt,Et,Tt,at,Nt,Kt,Lt=S.w_size;do{if(V=S.window_size-S.lookahead-S.strstart,S.strstart>=Lt+(Lt-gt)){for(a.arraySet(S.window,S.window,Lt,Lt,0),S.match_start-=Lt,S.strstart-=Lt,S.block_start-=Lt,At=_t=S.hash_size;X=S.head[--At],S.head[At]=Lt<=X?X-Lt:0,--_t;);for(At=_t=Lt;X=S.prev[--At],S.prev[At]=Lt<=X?X-Lt:0,--_t;);V+=Lt}if(S.strm.avail_in===0)break;if(Et=S.strm,Tt=S.window,at=S.strstart+S.lookahead,Nt=V,Kt=void 0,Kt=Et.avail_in,Nt<Kt&&(Kt=Nt),_t=Kt===0?0:(Et.avail_in-=Kt,a.arraySet(Tt,Et.input,Et.next_in,Kt,at),Et.state.wrap===1?Et.adler=u(Et.adler,Tt,Kt,at):Et.state.wrap===2&&(Et.adler=d(Et.adler,Tt,Kt,at)),Et.next_in+=Kt,Et.total_in+=Kt,Kt),S.lookahead+=_t,S.lookahead+S.insert>=J)for(lt=S.strstart-S.insert,S.ins_h=S.window[lt],S.ins_h=(S.ins_h<<S.hash_shift^S.window[lt+1])&S.hash_mask;S.insert&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[lt+J-1])&S.hash_mask,S.prev[lt&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=lt,lt++,S.insert--,!(S.lookahead+S.insert<J)););}while(S.lookahead<gt&&S.strm.avail_in!==0)}function re(S,At){for(var _t,X;;){if(S.lookahead<gt){if(te(S),S.lookahead<gt&&At===l)return T;if(S.lookahead===0)break}if(_t=0,S.lookahead>=J&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+J-1])&S.hash_mask,_t=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),_t!==0&&S.strstart-_t<=S.w_size-gt&&(S.match_length=Mt(S,_t)),S.match_length>=J)if(X=h._tr_tally(S,S.strstart-S.match_start,S.match_length-J),S.lookahead-=S.match_length,S.match_length<=S.max_lazy_match&&S.lookahead>=J){for(S.match_length--;S.strstart++,S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+J-1])&S.hash_mask,_t=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart,--S.match_length!=0;);S.strstart++}else S.strstart+=S.match_length,S.match_length=0,S.ins_h=S.window[S.strstart],S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+1])&S.hash_mask;else X=h._tr_tally(S,0,S.window[S.strstart]),S.lookahead--,S.strstart++;if(X&&(et(S,!1),S.strm.avail_out===0))return T}return S.insert=S.strstart<J-1?S.strstart:J-1,At===f?(et(S,!0),S.strm.avail_out===0?Pt:pt):S.last_lit&&(et(S,!1),S.strm.avail_out===0)?T:ut}function Xt(S,At){for(var _t,X,V;;){if(S.lookahead<gt){if(te(S),S.lookahead<gt&&At===l)return T;if(S.lookahead===0)break}if(_t=0,S.lookahead>=J&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+J-1])&S.hash_mask,_t=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),S.prev_length=S.match_length,S.prev_match=S.match_start,S.match_length=J-1,_t!==0&&S.prev_length<S.max_lazy_match&&S.strstart-_t<=S.w_size-gt&&(S.match_length=Mt(S,_t),S.match_length<=5&&(S.strategy===1||S.match_length===J&&4096<S.strstart-S.match_start)&&(S.match_length=J-1)),S.prev_length>=J&&S.match_length<=S.prev_length){for(V=S.strstart+S.lookahead-J,X=h._tr_tally(S,S.strstart-1-S.prev_match,S.prev_length-J),S.lookahead-=S.prev_length-1,S.prev_length-=2;++S.strstart<=V&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+J-1])&S.hash_mask,_t=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),--S.prev_length!=0;);if(S.match_available=0,S.match_length=J-1,S.strstart++,X&&(et(S,!1),S.strm.avail_out===0))return T}else if(S.match_available){if((X=h._tr_tally(S,0,S.window[S.strstart-1]))&&et(S,!1),S.strstart++,S.lookahead--,S.strm.avail_out===0)return T}else S.match_available=1,S.strstart++,S.lookahead--}return S.match_available&&(X=h._tr_tally(S,0,S.window[S.strstart-1]),S.match_available=0),S.insert=S.strstart<J-1?S.strstart:J-1,At===f?(et(S,!0),S.strm.avail_out===0?Pt:pt):S.last_lit&&(et(S,!1),S.strm.avail_out===0)?T:ut}function qt(S,At,_t,X,V){this.good_length=S,this.max_lazy=At,this.nice_length=_t,this.max_chain=X,this.func=V}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=C,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*Y),this.dyn_dtree=new a.Buf16(2*(2*G+1)),this.bl_tree=new a.Buf16(2*(2*Q+1)),xt(this.dyn_ltree),xt(this.dyn_dtree),xt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(it+1),this.heap=new a.Buf16(2*k+1),xt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*k+1),xt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ne(S){var At;return S&&S.state?(S.total_in=S.total_out=0,S.data_type=w,(At=S.state).pending=0,At.pending_out=0,At.wrap<0&&(At.wrap=-At.wrap),At.status=At.wrap?j:Z,S.adler=At.wrap===2?0:1,At.last_flush=l,h._tr_init(At),p):Gt(S,y)}function ye(S){var At=ne(S);return At===p&&function(_t){_t.window_size=2*_t.w_size,xt(_t.head),_t.max_lazy_match=s[_t.level].max_lazy,_t.good_match=s[_t.level].good_length,_t.nice_match=s[_t.level].nice_length,_t.max_chain_length=s[_t.level].max_chain,_t.strstart=0,_t.block_start=0,_t.lookahead=0,_t.insert=0,_t.match_length=_t.prev_length=J-1,_t.match_available=0,_t.ins_h=0}(S.state),At}function fe(S,At,_t,X,V,lt){if(!S)return y;var Et=1;if(At===_&&(At=6),X<0?(Et=0,X=-X):15<X&&(Et=2,X-=16),V<1||E<V||_t!==C||X<8||15<X||At<0||9<At||lt<0||v<lt)return Gt(S,y);X===8&&(X=9);var Tt=new le;return(S.state=Tt).strm=S,Tt.wrap=Et,Tt.gzhead=null,Tt.w_bits=X,Tt.w_size=1<<Tt.w_bits,Tt.w_mask=Tt.w_size-1,Tt.hash_bits=V+7,Tt.hash_size=1<<Tt.hash_bits,Tt.hash_mask=Tt.hash_size-1,Tt.hash_shift=~~((Tt.hash_bits+J-1)/J),Tt.window=new a.Buf8(2*Tt.w_size),Tt.head=new a.Buf16(Tt.hash_size),Tt.prev=new a.Buf16(Tt.w_size),Tt.lit_bufsize=1<<V+6,Tt.pending_buf_size=4*Tt.lit_bufsize,Tt.pending_buf=new a.Buf8(Tt.pending_buf_size),Tt.d_buf=1*Tt.lit_bufsize,Tt.l_buf=3*Tt.lit_bufsize,Tt.level=At,Tt.strategy=lt,Tt.method=_t,ye(S)}s=[new qt(0,0,0,0,function(S,At){var _t=65535;for(_t>S.pending_buf_size-5&&(_t=S.pending_buf_size-5);;){if(S.lookahead<=1){if(te(S),S.lookahead===0&&At===l)return T;if(S.lookahead===0)break}S.strstart+=S.lookahead,S.lookahead=0;var X=S.block_start+_t;if((S.strstart===0||S.strstart>=X)&&(S.lookahead=S.strstart-X,S.strstart=X,et(S,!1),S.strm.avail_out===0)||S.strstart-S.block_start>=S.w_size-gt&&(et(S,!1),S.strm.avail_out===0))return T}return S.insert=0,At===f?(et(S,!0),S.strm.avail_out===0?Pt:pt):(S.strstart>S.block_start&&(et(S,!1),S.strm.avail_out),T)}),new qt(4,4,8,4,re),new qt(4,5,16,8,re),new qt(4,6,32,32,re),new qt(4,4,16,16,Xt),new qt(8,16,32,32,Xt),new qt(8,16,128,128,Xt),new qt(8,32,128,256,Xt),new qt(32,128,258,1024,Xt),new qt(32,258,258,4096,Xt)],n.deflateInit=function(S,At){return fe(S,At,C,15,8,0)},n.deflateInit2=fe,n.deflateReset=ye,n.deflateResetKeep=ne,n.deflateSetHeader=function(S,At){return S&&S.state?S.state.wrap!==2?y:(S.state.gzhead=At,p):y},n.deflate=function(S,At){var _t,X,V,lt;if(!S||!S.state||5<At||At<0)return S?Gt(S,y):y;if(X=S.state,!S.output||!S.input&&S.avail_in!==0||X.status===666&&At!==f)return Gt(S,S.avail_out===0?-5:y);if(X.strm=S,_t=X.last_flush,X.last_flush=At,X.status===j)if(X.wrap===2)S.adler=0,Ht(X,31),Ht(X,139),Ht(X,8),X.gzhead?(Ht(X,(X.gzhead.text?1:0)+(X.gzhead.hcrc?2:0)+(X.gzhead.extra?4:0)+(X.gzhead.name?8:0)+(X.gzhead.comment?16:0)),Ht(X,255&X.gzhead.time),Ht(X,X.gzhead.time>>8&255),Ht(X,X.gzhead.time>>16&255),Ht(X,X.gzhead.time>>24&255),Ht(X,X.level===9?2:2<=X.strategy||X.level<2?4:0),Ht(X,255&X.gzhead.os),X.gzhead.extra&&X.gzhead.extra.length&&(Ht(X,255&X.gzhead.extra.length),Ht(X,X.gzhead.extra.length>>8&255)),X.gzhead.hcrc&&(S.adler=d(S.adler,X.pending_buf,X.pending,0)),X.gzindex=0,X.status=69):(Ht(X,0),Ht(X,0),Ht(X,0),Ht(X,0),Ht(X,0),Ht(X,X.level===9?2:2<=X.strategy||X.level<2?4:0),Ht(X,3),X.status=Z);else{var Et=C+(X.w_bits-8<<4)<<8;Et|=(2<=X.strategy||X.level<2?0:X.level<6?1:X.level===6?2:3)<<6,X.strstart!==0&&(Et|=32),Et+=31-Et%31,X.status=Z,Dt(X,Et),X.strstart!==0&&(Dt(X,S.adler>>>16),Dt(X,65535&S.adler)),S.adler=1}if(X.status===69)if(X.gzhead.extra){for(V=X.pending;X.gzindex<(65535&X.gzhead.extra.length)&&(X.pending!==X.pending_buf_size||(X.gzhead.hcrc&&X.pending>V&&(S.adler=d(S.adler,X.pending_buf,X.pending-V,V)),tt(S),V=X.pending,X.pending!==X.pending_buf_size));)Ht(X,255&X.gzhead.extra[X.gzindex]),X.gzindex++;X.gzhead.hcrc&&X.pending>V&&(S.adler=d(S.adler,X.pending_buf,X.pending-V,V)),X.gzindex===X.gzhead.extra.length&&(X.gzindex=0,X.status=73)}else X.status=73;if(X.status===73)if(X.gzhead.name){V=X.pending;do{if(X.pending===X.pending_buf_size&&(X.gzhead.hcrc&&X.pending>V&&(S.adler=d(S.adler,X.pending_buf,X.pending-V,V)),tt(S),V=X.pending,X.pending===X.pending_buf_size)){lt=1;break}lt=X.gzindex<X.gzhead.name.length?255&X.gzhead.name.charCodeAt(X.gzindex++):0,Ht(X,lt)}while(lt!==0);X.gzhead.hcrc&&X.pending>V&&(S.adler=d(S.adler,X.pending_buf,X.pending-V,V)),lt===0&&(X.gzindex=0,X.status=91)}else X.status=91;if(X.status===91)if(X.gzhead.comment){V=X.pending;do{if(X.pending===X.pending_buf_size&&(X.gzhead.hcrc&&X.pending>V&&(S.adler=d(S.adler,X.pending_buf,X.pending-V,V)),tt(S),V=X.pending,X.pending===X.pending_buf_size)){lt=1;break}lt=X.gzindex<X.gzhead.comment.length?255&X.gzhead.comment.charCodeAt(X.gzindex++):0,Ht(X,lt)}while(lt!==0);X.gzhead.hcrc&&X.pending>V&&(S.adler=d(S.adler,X.pending_buf,X.pending-V,V)),lt===0&&(X.status=103)}else X.status=103;if(X.status===103&&(X.gzhead.hcrc?(X.pending+2>X.pending_buf_size&&tt(S),X.pending+2<=X.pending_buf_size&&(Ht(X,255&S.adler),Ht(X,S.adler>>8&255),S.adler=0,X.status=Z)):X.status=Z),X.pending!==0){if(tt(S),S.avail_out===0)return X.last_flush=-1,p}else if(S.avail_in===0&&bt(At)<=bt(_t)&&At!==f)return Gt(S,-5);if(X.status===666&&S.avail_in!==0)return Gt(S,-5);if(S.avail_in!==0||X.lookahead!==0||At!==l&&X.status!==666){var Tt=X.strategy===2?function(at,Nt){for(var Kt;;){if(at.lookahead===0&&(te(at),at.lookahead===0)){if(Nt===l)return T;break}if(at.match_length=0,Kt=h._tr_tally(at,0,at.window[at.strstart]),at.lookahead--,at.strstart++,Kt&&(et(at,!1),at.strm.avail_out===0))return T}return at.insert=0,Nt===f?(et(at,!0),at.strm.avail_out===0?Pt:pt):at.last_lit&&(et(at,!1),at.strm.avail_out===0)?T:ut}(X,At):X.strategy===3?function(at,Nt){for(var Kt,Lt,ee,D,b=at.window;;){if(at.lookahead<=st){if(te(at),at.lookahead<=st&&Nt===l)return T;if(at.lookahead===0)break}if(at.match_length=0,at.lookahead>=J&&0<at.strstart&&(Lt=b[ee=at.strstart-1])===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]){D=at.strstart+st;do;while(Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&Lt===b[++ee]&&ee<D);at.match_length=st-(D-ee),at.match_length>at.lookahead&&(at.match_length=at.lookahead)}if(at.match_length>=J?(Kt=h._tr_tally(at,1,at.match_length-J),at.lookahead-=at.match_length,at.strstart+=at.match_length,at.match_length=0):(Kt=h._tr_tally(at,0,at.window[at.strstart]),at.lookahead--,at.strstart++),Kt&&(et(at,!1),at.strm.avail_out===0))return T}return at.insert=0,Nt===f?(et(at,!0),at.strm.avail_out===0?Pt:pt):at.last_lit&&(et(at,!1),at.strm.avail_out===0)?T:ut}(X,At):s[X.level].func(X,At);if(Tt!==Pt&&Tt!==pt||(X.status=666),Tt===T||Tt===Pt)return S.avail_out===0&&(X.last_flush=-1),p;if(Tt===ut&&(At===1?h._tr_align(X):At!==5&&(h._tr_stored_block(X,0,0,!1),At===3&&(xt(X.head),X.lookahead===0&&(X.strstart=0,X.block_start=0,X.insert=0))),tt(S),S.avail_out===0))return X.last_flush=-1,p}return At!==f?p:X.wrap<=0?1:(X.wrap===2?(Ht(X,255&S.adler),Ht(X,S.adler>>8&255),Ht(X,S.adler>>16&255),Ht(X,S.adler>>24&255),Ht(X,255&S.total_in),Ht(X,S.total_in>>8&255),Ht(X,S.total_in>>16&255),Ht(X,S.total_in>>24&255)):(Dt(X,S.adler>>>16),Dt(X,65535&S.adler)),tt(S),0<X.wrap&&(X.wrap=-X.wrap),X.pending!==0?p:1)},n.deflateEnd=function(S){var At;return S&&S.state?(At=S.state.status)!==j&&At!==69&&At!==73&&At!==91&&At!==103&&At!==Z&&At!==666?Gt(S,y):(S.state=null,At===Z?Gt(S,-3):p):y},n.deflateSetDictionary=function(S,At){var _t,X,V,lt,Et,Tt,at,Nt,Kt=At.length;if(!S||!S.state||(lt=(_t=S.state).wrap)===2||lt===1&&_t.status!==j||_t.lookahead)return y;for(lt===1&&(S.adler=u(S.adler,At,Kt,0)),_t.wrap=0,Kt>=_t.w_size&&(lt===0&&(xt(_t.head),_t.strstart=0,_t.block_start=0,_t.insert=0),Nt=new a.Buf8(_t.w_size),a.arraySet(Nt,At,Kt-_t.w_size,_t.w_size,0),At=Nt,Kt=_t.w_size),Et=S.avail_in,Tt=S.next_in,at=S.input,S.avail_in=Kt,S.next_in=0,S.input=At,te(_t);_t.lookahead>=J;){for(X=_t.strstart,V=_t.lookahead-(J-1);_t.ins_h=(_t.ins_h<<_t.hash_shift^_t.window[X+J-1])&_t.hash_mask,_t.prev[X&_t.w_mask]=_t.head[_t.ins_h],_t.head[_t.ins_h]=X,X++,--V;);_t.strstart=X,_t.lookahead=J-1,te(_t)}return _t.strstart+=_t.lookahead,_t.block_start=_t.strstart,_t.insert=_t.lookahead,_t.lookahead=0,_t.match_length=_t.prev_length=J-1,_t.match_available=0,S.next_in=Tt,S.input=at,S.avail_in=Et,_t.wrap=lt,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,r,n){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,r,n){r.exports=function(s,a){var h,u,d,m,l,f,p,y,_,v,w,C,E,k,G,Q,Y,it,J,st,gt,j,Z,T,ut;h=s.state,u=s.next_in,T=s.input,d=u+(s.avail_in-5),m=s.next_out,ut=s.output,l=m-(a-s.avail_out),f=m+(s.avail_out-257),p=h.dmax,y=h.wsize,_=h.whave,v=h.wnext,w=h.window,C=h.hold,E=h.bits,k=h.lencode,G=h.distcode,Q=(1<<h.lenbits)-1,Y=(1<<h.distbits)-1;t:do{E<15&&(C+=T[u++]<<E,E+=8,C+=T[u++]<<E,E+=8),it=k[C&Q];e:for(;;){if(C>>>=J=it>>>24,E-=J,(J=it>>>16&255)===0)ut[m++]=65535&it;else{if(!(16&J)){if((64&J)==0){it=k[(65535&it)+(C&(1<<J)-1)];continue e}if(32&J){h.mode=12;break t}s.msg="invalid literal/length code",h.mode=30;break t}st=65535&it,(J&=15)&&(E<J&&(C+=T[u++]<<E,E+=8),st+=C&(1<<J)-1,C>>>=J,E-=J),E<15&&(C+=T[u++]<<E,E+=8,C+=T[u++]<<E,E+=8),it=G[C&Y];i:for(;;){if(C>>>=J=it>>>24,E-=J,!(16&(J=it>>>16&255))){if((64&J)==0){it=G[(65535&it)+(C&(1<<J)-1)];continue i}s.msg="invalid distance code",h.mode=30;break t}if(gt=65535&it,E<(J&=15)&&(C+=T[u++]<<E,(E+=8)<J&&(C+=T[u++]<<E,E+=8)),p<(gt+=C&(1<<J)-1)){s.msg="invalid distance too far back",h.mode=30;break t}if(C>>>=J,E-=J,(J=m-l)<gt){if(_<(J=gt-J)&&h.sane){s.msg="invalid distance too far back",h.mode=30;break t}if(Z=w,(j=0)===v){if(j+=y-J,J<st){for(st-=J;ut[m++]=w[j++],--J;);j=m-gt,Z=ut}}else if(v<J){if(j+=y+v-J,(J-=v)<st){for(st-=J;ut[m++]=w[j++],--J;);if(j=0,v<st){for(st-=J=v;ut[m++]=w[j++],--J;);j=m-gt,Z=ut}}}else if(j+=v-J,J<st){for(st-=J;ut[m++]=w[j++],--J;);j=m-gt,Z=ut}for(;2<st;)ut[m++]=Z[j++],ut[m++]=Z[j++],ut[m++]=Z[j++],st-=3;st&&(ut[m++]=Z[j++],1<st&&(ut[m++]=Z[j++]))}else{for(j=m-gt;ut[m++]=ut[j++],ut[m++]=ut[j++],ut[m++]=ut[j++],2<(st-=3););st&&(ut[m++]=ut[j++],1<st&&(ut[m++]=ut[j++]))}break}}break}}while(u<d&&m<f);u-=st=E>>3,C&=(1<<(E-=st<<3))-1,s.next_in=u,s.next_out=m,s.avail_in=u<d?d-u+5:5-(u-d),s.avail_out=m<f?f-m+257:257-(m-f),h.hold=C,h.bits=E}},{}],49:[function(e,r,n){var s=e("../utils/common"),a=e("./adler32"),h=e("./crc32"),u=e("./inffast"),d=e("./inftrees"),m=1,l=2,f=0,p=-2,y=1,_=852,v=592;function w(j){return(j>>>24&255)+(j>>>8&65280)+((65280&j)<<8)+((255&j)<<24)}function C(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(j){var Z;return j&&j.state?(Z=j.state,j.total_in=j.total_out=Z.total=0,j.msg="",Z.wrap&&(j.adler=1&Z.wrap),Z.mode=y,Z.last=0,Z.havedict=0,Z.dmax=32768,Z.head=null,Z.hold=0,Z.bits=0,Z.lencode=Z.lendyn=new s.Buf32(_),Z.distcode=Z.distdyn=new s.Buf32(v),Z.sane=1,Z.back=-1,f):p}function k(j){var Z;return j&&j.state?((Z=j.state).wsize=0,Z.whave=0,Z.wnext=0,E(j)):p}function G(j,Z){var T,ut;return j&&j.state?(ut=j.state,Z<0?(T=0,Z=-Z):(T=1+(Z>>4),Z<48&&(Z&=15)),Z&&(Z<8||15<Z)?p:(ut.window!==null&&ut.wbits!==Z&&(ut.window=null),ut.wrap=T,ut.wbits=Z,k(j))):p}function Q(j,Z){var T,ut;return j?(ut=new C,(j.state=ut).window=null,(T=G(j,Z))!==f&&(j.state=null),T):p}var Y,it,J=!0;function st(j){if(J){var Z;for(Y=new s.Buf32(512),it=new s.Buf32(32),Z=0;Z<144;)j.lens[Z++]=8;for(;Z<256;)j.lens[Z++]=9;for(;Z<280;)j.lens[Z++]=7;for(;Z<288;)j.lens[Z++]=8;for(d(m,j.lens,0,288,Y,0,j.work,{bits:9}),Z=0;Z<32;)j.lens[Z++]=5;d(l,j.lens,0,32,it,0,j.work,{bits:5}),J=!1}j.lencode=Y,j.lenbits=9,j.distcode=it,j.distbits=5}function gt(j,Z,T,ut){var Pt,pt=j.state;return pt.window===null&&(pt.wsize=1<<pt.wbits,pt.wnext=0,pt.whave=0,pt.window=new s.Buf8(pt.wsize)),ut>=pt.wsize?(s.arraySet(pt.window,Z,T-pt.wsize,pt.wsize,0),pt.wnext=0,pt.whave=pt.wsize):(ut<(Pt=pt.wsize-pt.wnext)&&(Pt=ut),s.arraySet(pt.window,Z,T-ut,Pt,pt.wnext),(ut-=Pt)?(s.arraySet(pt.window,Z,T-ut,ut,0),pt.wnext=ut,pt.whave=pt.wsize):(pt.wnext+=Pt,pt.wnext===pt.wsize&&(pt.wnext=0),pt.whave<pt.wsize&&(pt.whave+=Pt))),0}n.inflateReset=k,n.inflateReset2=G,n.inflateResetKeep=E,n.inflateInit=function(j){return Q(j,15)},n.inflateInit2=Q,n.inflate=function(j,Z){var T,ut,Pt,pt,Gt,bt,xt,tt,et,Ht,Dt,Mt,te,re,Xt,qt,le,ne,ye,fe,S,At,_t,X,V=0,lt=new s.Buf8(4),Et=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!j||!j.state||!j.output||!j.input&&j.avail_in!==0)return p;(T=j.state).mode===12&&(T.mode=13),Gt=j.next_out,Pt=j.output,xt=j.avail_out,pt=j.next_in,ut=j.input,bt=j.avail_in,tt=T.hold,et=T.bits,Ht=bt,Dt=xt,At=f;t:for(;;)switch(T.mode){case y:if(T.wrap===0){T.mode=13;break}for(;et<16;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}if(2&T.wrap&&tt===35615){lt[T.check=0]=255&tt,lt[1]=tt>>>8&255,T.check=h(T.check,lt,2,0),et=tt=0,T.mode=2;break}if(T.flags=0,T.head&&(T.head.done=!1),!(1&T.wrap)||(((255&tt)<<8)+(tt>>8))%31){j.msg="incorrect header check",T.mode=30;break}if((15&tt)!=8){j.msg="unknown compression method",T.mode=30;break}if(et-=4,S=8+(15&(tt>>>=4)),T.wbits===0)T.wbits=S;else if(S>T.wbits){j.msg="invalid window size",T.mode=30;break}T.dmax=1<<S,j.adler=T.check=1,T.mode=512&tt?10:12,et=tt=0;break;case 2:for(;et<16;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}if(T.flags=tt,(255&T.flags)!=8){j.msg="unknown compression method",T.mode=30;break}if(57344&T.flags){j.msg="unknown header flags set",T.mode=30;break}T.head&&(T.head.text=tt>>8&1),512&T.flags&&(lt[0]=255&tt,lt[1]=tt>>>8&255,T.check=h(T.check,lt,2,0)),et=tt=0,T.mode=3;case 3:for(;et<32;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}T.head&&(T.head.time=tt),512&T.flags&&(lt[0]=255&tt,lt[1]=tt>>>8&255,lt[2]=tt>>>16&255,lt[3]=tt>>>24&255,T.check=h(T.check,lt,4,0)),et=tt=0,T.mode=4;case 4:for(;et<16;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}T.head&&(T.head.xflags=255&tt,T.head.os=tt>>8),512&T.flags&&(lt[0]=255&tt,lt[1]=tt>>>8&255,T.check=h(T.check,lt,2,0)),et=tt=0,T.mode=5;case 5:if(1024&T.flags){for(;et<16;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}T.length=tt,T.head&&(T.head.extra_len=tt),512&T.flags&&(lt[0]=255&tt,lt[1]=tt>>>8&255,T.check=h(T.check,lt,2,0)),et=tt=0}else T.head&&(T.head.extra=null);T.mode=6;case 6:if(1024&T.flags&&(bt<(Mt=T.length)&&(Mt=bt),Mt&&(T.head&&(S=T.head.extra_len-T.length,T.head.extra||(T.head.extra=new Array(T.head.extra_len)),s.arraySet(T.head.extra,ut,pt,Mt,S)),512&T.flags&&(T.check=h(T.check,ut,Mt,pt)),bt-=Mt,pt+=Mt,T.length-=Mt),T.length))break t;T.length=0,T.mode=7;case 7:if(2048&T.flags){if(bt===0)break t;for(Mt=0;S=ut[pt+Mt++],T.head&&S&&T.length<65536&&(T.head.name+=String.fromCharCode(S)),S&&Mt<bt;);if(512&T.flags&&(T.check=h(T.check,ut,Mt,pt)),bt-=Mt,pt+=Mt,S)break t}else T.head&&(T.head.name=null);T.length=0,T.mode=8;case 8:if(4096&T.flags){if(bt===0)break t;for(Mt=0;S=ut[pt+Mt++],T.head&&S&&T.length<65536&&(T.head.comment+=String.fromCharCode(S)),S&&Mt<bt;);if(512&T.flags&&(T.check=h(T.check,ut,Mt,pt)),bt-=Mt,pt+=Mt,S)break t}else T.head&&(T.head.comment=null);T.mode=9;case 9:if(512&T.flags){for(;et<16;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}if(tt!==(65535&T.check)){j.msg="header crc mismatch",T.mode=30;break}et=tt=0}T.head&&(T.head.hcrc=T.flags>>9&1,T.head.done=!0),j.adler=T.check=0,T.mode=12;break;case 10:for(;et<32;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}j.adler=T.check=w(tt),et=tt=0,T.mode=11;case 11:if(T.havedict===0)return j.next_out=Gt,j.avail_out=xt,j.next_in=pt,j.avail_in=bt,T.hold=tt,T.bits=et,2;j.adler=T.check=1,T.mode=12;case 12:if(Z===5||Z===6)break t;case 13:if(T.last){tt>>>=7&et,et-=7&et,T.mode=27;break}for(;et<3;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}switch(T.last=1&tt,et-=1,3&(tt>>>=1)){case 0:T.mode=14;break;case 1:if(st(T),T.mode=20,Z!==6)break;tt>>>=2,et-=2;break t;case 2:T.mode=17;break;case 3:j.msg="invalid block type",T.mode=30}tt>>>=2,et-=2;break;case 14:for(tt>>>=7&et,et-=7&et;et<32;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}if((65535&tt)!=(tt>>>16^65535)){j.msg="invalid stored block lengths",T.mode=30;break}if(T.length=65535&tt,et=tt=0,T.mode=15,Z===6)break t;case 15:T.mode=16;case 16:if(Mt=T.length){if(bt<Mt&&(Mt=bt),xt<Mt&&(Mt=xt),Mt===0)break t;s.arraySet(Pt,ut,pt,Mt,Gt),bt-=Mt,pt+=Mt,xt-=Mt,Gt+=Mt,T.length-=Mt;break}T.mode=12;break;case 17:for(;et<14;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}if(T.nlen=257+(31&tt),tt>>>=5,et-=5,T.ndist=1+(31&tt),tt>>>=5,et-=5,T.ncode=4+(15&tt),tt>>>=4,et-=4,286<T.nlen||30<T.ndist){j.msg="too many length or distance symbols",T.mode=30;break}T.have=0,T.mode=18;case 18:for(;T.have<T.ncode;){for(;et<3;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}T.lens[Et[T.have++]]=7&tt,tt>>>=3,et-=3}for(;T.have<19;)T.lens[Et[T.have++]]=0;if(T.lencode=T.lendyn,T.lenbits=7,_t={bits:T.lenbits},At=d(0,T.lens,0,19,T.lencode,0,T.work,_t),T.lenbits=_t.bits,At){j.msg="invalid code lengths set",T.mode=30;break}T.have=0,T.mode=19;case 19:for(;T.have<T.nlen+T.ndist;){for(;qt=(V=T.lencode[tt&(1<<T.lenbits)-1])>>>16&255,le=65535&V,!((Xt=V>>>24)<=et);){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}if(le<16)tt>>>=Xt,et-=Xt,T.lens[T.have++]=le;else{if(le===16){for(X=Xt+2;et<X;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}if(tt>>>=Xt,et-=Xt,T.have===0){j.msg="invalid bit length repeat",T.mode=30;break}S=T.lens[T.have-1],Mt=3+(3&tt),tt>>>=2,et-=2}else if(le===17){for(X=Xt+3;et<X;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}et-=Xt,S=0,Mt=3+(7&(tt>>>=Xt)),tt>>>=3,et-=3}else{for(X=Xt+7;et<X;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}et-=Xt,S=0,Mt=11+(127&(tt>>>=Xt)),tt>>>=7,et-=7}if(T.have+Mt>T.nlen+T.ndist){j.msg="invalid bit length repeat",T.mode=30;break}for(;Mt--;)T.lens[T.have++]=S}}if(T.mode===30)break;if(T.lens[256]===0){j.msg="invalid code -- missing end-of-block",T.mode=30;break}if(T.lenbits=9,_t={bits:T.lenbits},At=d(m,T.lens,0,T.nlen,T.lencode,0,T.work,_t),T.lenbits=_t.bits,At){j.msg="invalid literal/lengths set",T.mode=30;break}if(T.distbits=6,T.distcode=T.distdyn,_t={bits:T.distbits},At=d(l,T.lens,T.nlen,T.ndist,T.distcode,0,T.work,_t),T.distbits=_t.bits,At){j.msg="invalid distances set",T.mode=30;break}if(T.mode=20,Z===6)break t;case 20:T.mode=21;case 21:if(6<=bt&&258<=xt){j.next_out=Gt,j.avail_out=xt,j.next_in=pt,j.avail_in=bt,T.hold=tt,T.bits=et,u(j,Dt),Gt=j.next_out,Pt=j.output,xt=j.avail_out,pt=j.next_in,ut=j.input,bt=j.avail_in,tt=T.hold,et=T.bits,T.mode===12&&(T.back=-1);break}for(T.back=0;qt=(V=T.lencode[tt&(1<<T.lenbits)-1])>>>16&255,le=65535&V,!((Xt=V>>>24)<=et);){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}if(qt&&(240&qt)==0){for(ne=Xt,ye=qt,fe=le;qt=(V=T.lencode[fe+((tt&(1<<ne+ye)-1)>>ne)])>>>16&255,le=65535&V,!(ne+(Xt=V>>>24)<=et);){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}tt>>>=ne,et-=ne,T.back+=ne}if(tt>>>=Xt,et-=Xt,T.back+=Xt,T.length=le,qt===0){T.mode=26;break}if(32&qt){T.back=-1,T.mode=12;break}if(64&qt){j.msg="invalid literal/length code",T.mode=30;break}T.extra=15&qt,T.mode=22;case 22:if(T.extra){for(X=T.extra;et<X;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}T.length+=tt&(1<<T.extra)-1,tt>>>=T.extra,et-=T.extra,T.back+=T.extra}T.was=T.length,T.mode=23;case 23:for(;qt=(V=T.distcode[tt&(1<<T.distbits)-1])>>>16&255,le=65535&V,!((Xt=V>>>24)<=et);){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}if((240&qt)==0){for(ne=Xt,ye=qt,fe=le;qt=(V=T.distcode[fe+((tt&(1<<ne+ye)-1)>>ne)])>>>16&255,le=65535&V,!(ne+(Xt=V>>>24)<=et);){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}tt>>>=ne,et-=ne,T.back+=ne}if(tt>>>=Xt,et-=Xt,T.back+=Xt,64&qt){j.msg="invalid distance code",T.mode=30;break}T.offset=le,T.extra=15&qt,T.mode=24;case 24:if(T.extra){for(X=T.extra;et<X;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}T.offset+=tt&(1<<T.extra)-1,tt>>>=T.extra,et-=T.extra,T.back+=T.extra}if(T.offset>T.dmax){j.msg="invalid distance too far back",T.mode=30;break}T.mode=25;case 25:if(xt===0)break t;if(Mt=Dt-xt,T.offset>Mt){if((Mt=T.offset-Mt)>T.whave&&T.sane){j.msg="invalid distance too far back",T.mode=30;break}te=Mt>T.wnext?(Mt-=T.wnext,T.wsize-Mt):T.wnext-Mt,Mt>T.length&&(Mt=T.length),re=T.window}else re=Pt,te=Gt-T.offset,Mt=T.length;for(xt<Mt&&(Mt=xt),xt-=Mt,T.length-=Mt;Pt[Gt++]=re[te++],--Mt;);T.length===0&&(T.mode=21);break;case 26:if(xt===0)break t;Pt[Gt++]=T.length,xt--,T.mode=21;break;case 27:if(T.wrap){for(;et<32;){if(bt===0)break t;bt--,tt|=ut[pt++]<<et,et+=8}if(Dt-=xt,j.total_out+=Dt,T.total+=Dt,Dt&&(j.adler=T.check=T.flags?h(T.check,Pt,Dt,Gt-Dt):a(T.check,Pt,Dt,Gt-Dt)),Dt=xt,(T.flags?tt:w(tt))!==T.check){j.msg="incorrect data check",T.mode=30;break}et=tt=0}T.mode=28;case 28:if(T.wrap&&T.flags){for(;et<32;){if(bt===0)break t;bt--,tt+=ut[pt++]<<et,et+=8}if(tt!==(4294967295&T.total)){j.msg="incorrect length check",T.mode=30;break}et=tt=0}T.mode=29;case 29:At=1;break t;case 30:At=-3;break t;case 31:return-4;case 32:default:return p}return j.next_out=Gt,j.avail_out=xt,j.next_in=pt,j.avail_in=bt,T.hold=tt,T.bits=et,(T.wsize||Dt!==j.avail_out&&T.mode<30&&(T.mode<27||Z!==4))&&gt(j,j.output,j.next_out,Dt-j.avail_out)?(T.mode=31,-4):(Ht-=j.avail_in,Dt-=j.avail_out,j.total_in+=Ht,j.total_out+=Dt,T.total+=Dt,T.wrap&&Dt&&(j.adler=T.check=T.flags?h(T.check,Pt,Dt,j.next_out-Dt):a(T.check,Pt,Dt,j.next_out-Dt)),j.data_type=T.bits+(T.last?64:0)+(T.mode===12?128:0)+(T.mode===20||T.mode===15?256:0),(Ht==0&&Dt===0||Z===4)&&At===f&&(At=-5),At)},n.inflateEnd=function(j){if(!j||!j.state)return p;var Z=j.state;return Z.window&&(Z.window=null),j.state=null,f},n.inflateGetHeader=function(j,Z){var T;return j&&j.state?(2&(T=j.state).wrap)==0?p:((T.head=Z).done=!1,f):p},n.inflateSetDictionary=function(j,Z){var T,ut=Z.length;return j&&j.state?(T=j.state).wrap!==0&&T.mode!==11?p:T.mode===11&&a(1,Z,ut,0)!==T.check?-3:gt(j,Z,ut,ut)?(T.mode=31,-4):(T.havedict=1,f):p},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,r,n){var s=e("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(m,l,f,p,y,_,v,w){var C,E,k,G,Q,Y,it,J,st,gt=w.bits,j=0,Z=0,T=0,ut=0,Pt=0,pt=0,Gt=0,bt=0,xt=0,tt=0,et=null,Ht=0,Dt=new s.Buf16(16),Mt=new s.Buf16(16),te=null,re=0;for(j=0;j<=15;j++)Dt[j]=0;for(Z=0;Z<p;Z++)Dt[l[f+Z]]++;for(Pt=gt,ut=15;1<=ut&&Dt[ut]===0;ut--);if(ut<Pt&&(Pt=ut),ut===0)return y[_++]=20971520,y[_++]=20971520,w.bits=1,0;for(T=1;T<ut&&Dt[T]===0;T++);for(Pt<T&&(Pt=T),j=bt=1;j<=15;j++)if(bt<<=1,(bt-=Dt[j])<0)return-1;if(0<bt&&(m===0||ut!==1))return-1;for(Mt[1]=0,j=1;j<15;j++)Mt[j+1]=Mt[j]+Dt[j];for(Z=0;Z<p;Z++)l[f+Z]!==0&&(v[Mt[l[f+Z]]++]=Z);if(Y=m===0?(et=te=v,19):m===1?(et=a,Ht-=257,te=h,re-=257,256):(et=u,te=d,-1),j=T,Q=_,Gt=Z=tt=0,k=-1,G=(xt=1<<(pt=Pt))-1,m===1&&852<xt||m===2&&592<xt)return 1;for(;;){for(it=j-Gt,st=v[Z]<Y?(J=0,v[Z]):v[Z]>Y?(J=te[re+v[Z]],et[Ht+v[Z]]):(J=96,0),C=1<<j-Gt,T=E=1<<pt;y[Q+(tt>>Gt)+(E-=C)]=it<<24|J<<16|st|0,E!==0;);for(C=1<<j-1;tt&C;)C>>=1;if(C!==0?(tt&=C-1,tt+=C):tt=0,Z++,--Dt[j]==0){if(j===ut)break;j=l[f+v[Z]]}if(Pt<j&&(tt&G)!==k){for(Gt===0&&(Gt=Pt),Q+=T,bt=1<<(pt=j-Gt);pt+Gt<ut&&!((bt-=Dt[pt+Gt])<=0);)pt++,bt<<=1;if(xt+=1<<pt,m===1&&852<xt||m===2&&592<xt)return 1;y[k=tt&G]=Pt<<24|pt<<16|Q-_|0}}return tt!==0&&(y[Q+tt]=j-Gt<<24|64<<16|0),w.bits=Pt,0}},{"../utils/common":41}],51:[function(e,r,n){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,r,n){var s=e("../utils/common"),a=0,h=1;function u(V){for(var lt=V.length;0<=--lt;)V[lt]=0}var d=0,m=29,l=256,f=l+1+m,p=30,y=19,_=2*f+1,v=15,w=16,C=7,E=256,k=16,G=17,Q=18,Y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],it=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],J=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],st=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],gt=new Array(2*(f+2));u(gt);var j=new Array(2*p);u(j);var Z=new Array(512);u(Z);var T=new Array(256);u(T);var ut=new Array(m);u(ut);var Pt,pt,Gt,bt=new Array(p);function xt(V,lt,Et,Tt,at){this.static_tree=V,this.extra_bits=lt,this.extra_base=Et,this.elems=Tt,this.max_length=at,this.has_stree=V&&V.length}function tt(V,lt){this.dyn_tree=V,this.max_code=0,this.stat_desc=lt}function et(V){return V<256?Z[V]:Z[256+(V>>>7)]}function Ht(V,lt){V.pending_buf[V.pending++]=255&lt,V.pending_buf[V.pending++]=lt>>>8&255}function Dt(V,lt,Et){V.bi_valid>w-Et?(V.bi_buf|=lt<<V.bi_valid&65535,Ht(V,V.bi_buf),V.bi_buf=lt>>w-V.bi_valid,V.bi_valid+=Et-w):(V.bi_buf|=lt<<V.bi_valid&65535,V.bi_valid+=Et)}function Mt(V,lt,Et){Dt(V,Et[2*lt],Et[2*lt+1])}function te(V,lt){for(var Et=0;Et|=1&V,V>>>=1,Et<<=1,0<--lt;);return Et>>>1}function re(V,lt,Et){var Tt,at,Nt=new Array(v+1),Kt=0;for(Tt=1;Tt<=v;Tt++)Nt[Tt]=Kt=Kt+Et[Tt-1]<<1;for(at=0;at<=lt;at++){var Lt=V[2*at+1];Lt!==0&&(V[2*at]=te(Nt[Lt]++,Lt))}}function Xt(V){var lt;for(lt=0;lt<f;lt++)V.dyn_ltree[2*lt]=0;for(lt=0;lt<p;lt++)V.dyn_dtree[2*lt]=0;for(lt=0;lt<y;lt++)V.bl_tree[2*lt]=0;V.dyn_ltree[2*E]=1,V.opt_len=V.static_len=0,V.last_lit=V.matches=0}function qt(V){8<V.bi_valid?Ht(V,V.bi_buf):0<V.bi_valid&&(V.pending_buf[V.pending++]=V.bi_buf),V.bi_buf=0,V.bi_valid=0}function le(V,lt,Et,Tt){var at=2*lt,Nt=2*Et;return V[at]<V[Nt]||V[at]===V[Nt]&&Tt[lt]<=Tt[Et]}function ne(V,lt,Et){for(var Tt=V.heap[Et],at=Et<<1;at<=V.heap_len&&(at<V.heap_len&&le(lt,V.heap[at+1],V.heap[at],V.depth)&&at++,!le(lt,Tt,V.heap[at],V.depth));)V.heap[Et]=V.heap[at],Et=at,at<<=1;V.heap[Et]=Tt}function ye(V,lt,Et){var Tt,at,Nt,Kt,Lt=0;if(V.last_lit!==0)for(;Tt=V.pending_buf[V.d_buf+2*Lt]<<8|V.pending_buf[V.d_buf+2*Lt+1],at=V.pending_buf[V.l_buf+Lt],Lt++,Tt===0?Mt(V,at,lt):(Mt(V,(Nt=T[at])+l+1,lt),(Kt=Y[Nt])!==0&&Dt(V,at-=ut[Nt],Kt),Mt(V,Nt=et(--Tt),Et),(Kt=it[Nt])!==0&&Dt(V,Tt-=bt[Nt],Kt)),Lt<V.last_lit;);Mt(V,E,lt)}function fe(V,lt){var Et,Tt,at,Nt=lt.dyn_tree,Kt=lt.stat_desc.static_tree,Lt=lt.stat_desc.has_stree,ee=lt.stat_desc.elems,D=-1;for(V.heap_len=0,V.heap_max=_,Et=0;Et<ee;Et++)Nt[2*Et]!==0?(V.heap[++V.heap_len]=D=Et,V.depth[Et]=0):Nt[2*Et+1]=0;for(;V.heap_len<2;)Nt[2*(at=V.heap[++V.heap_len]=D<2?++D:0)]=1,V.depth[at]=0,V.opt_len--,Lt&&(V.static_len-=Kt[2*at+1]);for(lt.max_code=D,Et=V.heap_len>>1;1<=Et;Et--)ne(V,Nt,Et);for(at=ee;Et=V.heap[1],V.heap[1]=V.heap[V.heap_len--],ne(V,Nt,1),Tt=V.heap[1],V.heap[--V.heap_max]=Et,V.heap[--V.heap_max]=Tt,Nt[2*at]=Nt[2*Et]+Nt[2*Tt],V.depth[at]=(V.depth[Et]>=V.depth[Tt]?V.depth[Et]:V.depth[Tt])+1,Nt[2*Et+1]=Nt[2*Tt+1]=at,V.heap[1]=at++,ne(V,Nt,1),2<=V.heap_len;);V.heap[--V.heap_max]=V.heap[1],function(b,A){var W,rt,I,N,mt,yt,Ct=A.dyn_tree,Wt=A.max_code,Vt=A.stat_desc.static_tree,be=A.stat_desc.has_stree,Ie=A.stat_desc.extra_bits,Ne=A.stat_desc.extra_base,Be=A.stat_desc.max_length,Ze=0;for(N=0;N<=v;N++)b.bl_count[N]=0;for(Ct[2*b.heap[b.heap_max]+1]=0,W=b.heap_max+1;W<_;W++)Be<(N=Ct[2*Ct[2*(rt=b.heap[W])+1]+1]+1)&&(N=Be,Ze++),Ct[2*rt+1]=N,Wt<rt||(b.bl_count[N]++,mt=0,Ne<=rt&&(mt=Ie[rt-Ne]),yt=Ct[2*rt],b.opt_len+=yt*(N+mt),be&&(b.static_len+=yt*(Vt[2*rt+1]+mt)));if(Ze!==0){do{for(N=Be-1;b.bl_count[N]===0;)N--;b.bl_count[N]--,b.bl_count[N+1]+=2,b.bl_count[Be]--,Ze-=2}while(0<Ze);for(N=Be;N!==0;N--)for(rt=b.bl_count[N];rt!==0;)Wt<(I=b.heap[--W])||(Ct[2*I+1]!==N&&(b.opt_len+=(N-Ct[2*I+1])*Ct[2*I],Ct[2*I+1]=N),rt--)}}(V,lt),re(Nt,D,V.bl_count)}function S(V,lt,Et){var Tt,at,Nt=-1,Kt=lt[1],Lt=0,ee=7,D=4;for(Kt===0&&(ee=138,D=3),lt[2*(Et+1)+1]=65535,Tt=0;Tt<=Et;Tt++)at=Kt,Kt=lt[2*(Tt+1)+1],++Lt<ee&&at===Kt||(Lt<D?V.bl_tree[2*at]+=Lt:at!==0?(at!==Nt&&V.bl_tree[2*at]++,V.bl_tree[2*k]++):Lt<=10?V.bl_tree[2*G]++:V.bl_tree[2*Q]++,Nt=at,D=(Lt=0)===Kt?(ee=138,3):at===Kt?(ee=6,3):(ee=7,4))}function At(V,lt,Et){var Tt,at,Nt=-1,Kt=lt[1],Lt=0,ee=7,D=4;for(Kt===0&&(ee=138,D=3),Tt=0;Tt<=Et;Tt++)if(at=Kt,Kt=lt[2*(Tt+1)+1],!(++Lt<ee&&at===Kt)){if(Lt<D)for(;Mt(V,at,V.bl_tree),--Lt!=0;);else at!==0?(at!==Nt&&(Mt(V,at,V.bl_tree),Lt--),Mt(V,k,V.bl_tree),Dt(V,Lt-3,2)):Lt<=10?(Mt(V,G,V.bl_tree),Dt(V,Lt-3,3)):(Mt(V,Q,V.bl_tree),Dt(V,Lt-11,7));Nt=at,D=(Lt=0)===Kt?(ee=138,3):at===Kt?(ee=6,3):(ee=7,4)}}u(bt);var _t=!1;function X(V,lt,Et,Tt){Dt(V,(d<<1)+(Tt?1:0),3),function(at,Nt,Kt,Lt){qt(at),Lt&&(Ht(at,Kt),Ht(at,~Kt)),s.arraySet(at.pending_buf,at.window,Nt,Kt,at.pending),at.pending+=Kt}(V,lt,Et,!0)}n._tr_init=function(V){_t||(function(){var lt,Et,Tt,at,Nt,Kt=new Array(v+1);for(at=Tt=0;at<m-1;at++)for(ut[at]=Tt,lt=0;lt<1<<Y[at];lt++)T[Tt++]=at;for(T[Tt-1]=at,at=Nt=0;at<16;at++)for(bt[at]=Nt,lt=0;lt<1<<it[at];lt++)Z[Nt++]=at;for(Nt>>=7;at<p;at++)for(bt[at]=Nt<<7,lt=0;lt<1<<it[at]-7;lt++)Z[256+Nt++]=at;for(Et=0;Et<=v;Et++)Kt[Et]=0;for(lt=0;lt<=143;)gt[2*lt+1]=8,lt++,Kt[8]++;for(;lt<=255;)gt[2*lt+1]=9,lt++,Kt[9]++;for(;lt<=279;)gt[2*lt+1]=7,lt++,Kt[7]++;for(;lt<=287;)gt[2*lt+1]=8,lt++,Kt[8]++;for(re(gt,f+1,Kt),lt=0;lt<p;lt++)j[2*lt+1]=5,j[2*lt]=te(lt,5);Pt=new xt(gt,Y,l+1,f,v),pt=new xt(j,it,0,p,v),Gt=new xt(new Array(0),J,0,y,C)}(),_t=!0),V.l_desc=new tt(V.dyn_ltree,Pt),V.d_desc=new tt(V.dyn_dtree,pt),V.bl_desc=new tt(V.bl_tree,Gt),V.bi_buf=0,V.bi_valid=0,Xt(V)},n._tr_stored_block=X,n._tr_flush_block=function(V,lt,Et,Tt){var at,Nt,Kt=0;0<V.level?(V.strm.data_type===2&&(V.strm.data_type=function(Lt){var ee,D=4093624447;for(ee=0;ee<=31;ee++,D>>>=1)if(1&D&&Lt.dyn_ltree[2*ee]!==0)return a;if(Lt.dyn_ltree[18]!==0||Lt.dyn_ltree[20]!==0||Lt.dyn_ltree[26]!==0)return h;for(ee=32;ee<l;ee++)if(Lt.dyn_ltree[2*ee]!==0)return h;return a}(V)),fe(V,V.l_desc),fe(V,V.d_desc),Kt=function(Lt){var ee;for(S(Lt,Lt.dyn_ltree,Lt.l_desc.max_code),S(Lt,Lt.dyn_dtree,Lt.d_desc.max_code),fe(Lt,Lt.bl_desc),ee=y-1;3<=ee&&Lt.bl_tree[2*st[ee]+1]===0;ee--);return Lt.opt_len+=3*(ee+1)+5+5+4,ee}(V),at=V.opt_len+3+7>>>3,(Nt=V.static_len+3+7>>>3)<=at&&(at=Nt)):at=Nt=Et+5,Et+4<=at&&lt!==-1?X(V,lt,Et,Tt):V.strategy===4||Nt===at?(Dt(V,2+(Tt?1:0),3),ye(V,gt,j)):(Dt(V,4+(Tt?1:0),3),function(Lt,ee,D,b){var A;for(Dt(Lt,ee-257,5),Dt(Lt,D-1,5),Dt(Lt,b-4,4),A=0;A<b;A++)Dt(Lt,Lt.bl_tree[2*st[A]+1],3);At(Lt,Lt.dyn_ltree,ee-1),At(Lt,Lt.dyn_dtree,D-1)}(V,V.l_desc.max_code+1,V.d_desc.max_code+1,Kt+1),ye(V,V.dyn_ltree,V.dyn_dtree)),Xt(V),Tt&&qt(V)},n._tr_tally=function(V,lt,Et){return V.pending_buf[V.d_buf+2*V.last_lit]=lt>>>8&255,V.pending_buf[V.d_buf+2*V.last_lit+1]=255&lt,V.pending_buf[V.l_buf+V.last_lit]=255&Et,V.last_lit++,lt===0?V.dyn_ltree[2*Et]++:(V.matches++,lt--,V.dyn_ltree[2*(T[Et]+l+1)]++,V.dyn_dtree[2*et(lt)]++),V.last_lit===V.lit_bufsize-1},n._tr_align=function(V){Dt(V,2,3),Mt(V,E,gt),function(lt){lt.bi_valid===16?(Ht(lt,lt.bi_buf),lt.bi_buf=0,lt.bi_valid=0):8<=lt.bi_valid&&(lt.pending_buf[lt.pending++]=255&lt.bi_buf,lt.bi_buf>>=8,lt.bi_valid-=8)}(V)}},{"../utils/common":41}],53:[function(e,r,n){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,r,n){(function(s){(function(a,h){if(!a.setImmediate){var u,d,m,l,f=1,p={},y=!1,_=a.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(a);v=v&&v.setTimeout?v:a,u={}.toString.call(a.process)==="[object process]"?function(k){process.nextTick(function(){C(k)})}:function(){if(a.postMessage&&!a.importScripts){var k=!0,G=a.onmessage;return a.onmessage=function(){k=!1},a.postMessage("","*"),a.onmessage=G,k}}()?(l="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",E,!1):a.attachEvent("onmessage",E),function(k){a.postMessage(l+k,"*")}):a.MessageChannel?((m=new MessageChannel).port1.onmessage=function(k){C(k.data)},function(k){m.port2.postMessage(k)}):_&&"onreadystatechange"in _.createElement("script")?(d=_.documentElement,function(k){var G=_.createElement("script");G.onreadystatechange=function(){C(k),G.onreadystatechange=null,d.removeChild(G),G=null},d.appendChild(G)}):function(k){setTimeout(C,0,k)},v.setImmediate=function(k){typeof k!="function"&&(k=new Function(""+k));for(var G=new Array(arguments.length-1),Q=0;Q<G.length;Q++)G[Q]=arguments[Q+1];var Y={callback:k,args:G};return p[f]=Y,u(f),f++},v.clearImmediate=w}function w(k){delete p[k]}function C(k){if(y)setTimeout(C,0,k);else{var G=p[k];if(G){y=!0;try{(function(Q){var Y=Q.callback,it=Q.args;switch(it.length){case 0:Y();break;case 1:Y(it[0]);break;case 2:Y(it[0],it[1]);break;case 3:Y(it[0],it[1],it[2]);break;default:Y.apply(h,it)}})(G)}finally{w(k),y=!1}}}}function E(k){k.source===a&&typeof k.data=="string"&&k.data.indexOf(l)===0&&C(+k.data.slice(l.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof si<"u"?si:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(m_);const YR=m_.exports;class uc{static _init(){const t=`
      function resolvePath(path) {
        let pathParts = path.split("/")
        pathParts = pathParts.filter(item => item != "." && item != "")
        while (pathParts.indexOf("..") > -1) {
          const ind = pathParts.indexOf("..")
          if (ind == 0) {
            throw Error("Path" + pathParts.join("/") + "is invalid!")
          }
          pathParts.splice(ind - 1, 2)
        }
        return pathParts.join("/")
      }
      
      async function getFileHandle(path, options) {
        try {
          const pathParts = resolvePath(path).split("/")
          const filename = pathParts.pop()
          const dirHandle = await getDirectoryHandle(
            pathParts.join("/"),
            options
          )
          if (!dirHandle) return undefined
          return await dirHandle.getFileHandle(filename, options)
        } catch (err) {
          console.log(err)
          return undefined
        }
      }
      
      async function getDirectoryHandle(path, options, dir){
        dir ||= await navigator.storage.getDirectory()
        if (path == "" || path == ".") return dir
        try {
          const pathParts = resolvePath(path).split("/")
          const dirname = pathParts.shift()
          const dirHandle = await dir.getDirectoryHandle(dirname, options)
          if (!dirHandle) return undefined
          if (pathParts.length == 0) return dirHandle
          return getDirectoryHandle(pathParts.join("/"), options, dirHandle)
        } catch (err) {
          console.log(err)
          return undefined
        }
      }
      
      async function writeFile(path, arrayBuffer) {
        const handle = await getFileHandle(path)
        const accessHandle = await handle.createSyncAccessHandle();
        const writeSize = accessHandle.write(arrayBuffer, { "at": 0 });
        await accessHandle.flush();
        const fileSize = await accessHandle.getSize();
        // Read file content to a buffer.
        const readBuffer = new ArrayBuffer(fileSize);
        const readSize = accessHandle.read(readBuffer, { "at": 0 });
        console.log(readSize)
        await accessHandle.close();
      }
      
      self.onmessage = function(e){
        writeFile(e.data[1],e.data[2]).then(()=>{
          postMessage(e.data[0])
        })
      }
      `,e=new Blob([t],{type:"application/javascript"});this._worker=new Worker(URL.createObjectURL(e)),this._worker.onmessage=r=>{const n=r.data;console.log("Finished job "+n),this.map.has(n)&&this.map.get(n)()}}static get worker(){return this._worker||this._init(),this._worker}static async writeHandle(t,e){const r=this.workID++;console.log("Starting work write "+t+", id: "+r);const n=new Promise(h=>this.map.set(r,h)),s=new TextEncoder,a=typeof e=="string"?s.encode(e):await e.arrayBuffer();return this.worker.postMessage([r,t,a]),n}}L(uc,"_worker"),L(uc,"workID",0),L(uc,"map",new Map);class Ve{static get root(){return this._root||this.init(),this._root}static async init(){window.nw?(this._root=await Bd(_a(()=>import("./NodeAdapter.75767c8f.js"),["./NodeAdapter.75767c8f.js","./util.30f000cb.js"],import.meta.url),"/"),this.persistentFiles=!0):XR.adapter.native&&!c_().includes("Safari")?(this._root=await Bd(),this.persistentFiles=!0):this._root=await Bd(_a(()=>import("./memory.6e8d61a3.js"),["./memory.6e8d61a3.js","./util.30f000cb.js"],import.meta.url))}static isPersistent(){return this.persistentFiles}static async uploadHandle(t,e){let r;if(typeof e=="string"){const n=await this.getDirectoryHandle(e,{create:!0});if(!n)return;r=n}else r=e??this.root;if(t.kind=="file"){const n=await r.getFileHandle(t.name,{create:!0});await this.writeFile(n,await t.getFile())}else{const n=await r.getDirectoryHandle(t.name,{create:!0}),s=[];for await(const a of t.values())s.push(this.uploadHandle(a,n));await Promise.all(s)}}static async uploadFiles(t,e){let r;if(typeof e=="string"){const n=await this.getDirectoryHandle(e,{create:!0});if(!n)return;r=n}else r=e??this.root;if(t.isFile){const n=t;if(n.name==".DS_Store")return;n.file(async s=>{const a=await r.getFileHandle(s.name,{create:!0});await this.writeHandle(a,s)})}else if(t.isDirectory){const n=t.createReader(),s=await r.getDirectoryHandle(t.name,{create:!0});for await(const a of s.values())await s.removeEntry(a.name,{recursive:!0});n.readEntries(async a=>{const h=[];for(let u=0;u<a.length;u++)h.push(this.uploadFiles(a[u],s));await Promise.all(h)})}}static async handleDropEvent(t,e){t.stopPropagation(),t.preventDefault();const r=t.dataTransfer.items;if(!e){e="";for(let a=0;a<r.length;a++){const h=r[a].webkitGetAsEntry();if(h?.isFile&&(h.name.endsWith(".sm")||h.name.endsWith(".ssc"))){e="New Song";break}}}const n=[];for(let a=0;a<r.length;a++){const h=r[a].webkitGetAsEntry();!h||n.push(this.uploadFiles(h,e))}let s;return r.length==1&&r[0].webkitGetAsEntry().isDirectory&&(s=r[0].webkitGetAsEntry().name),await Promise.all(n),s}static async uploadDir(t,e){let r;if(typeof e=="string"){const s=await this.getDirectoryHandle(e);if(!s)return;r=s}else r=e??this.root;const n=await r.getDirectoryHandle(t.name,{create:!0});for await(const s of t.values())if(s.kind=="file"){const a=await n.getFileHandle(s.name,{create:!0}),h=await s.getFile();await this.writeHandle(a,h)}else await this.uploadDir(s,n)}static async getDirectoryHandle(t,e,r){if(r||(r=this.root),t==""||t==".")return r;try{const n=this.resolvePath(t).split("/"),s=n.shift(),a=await r.getDirectoryHandle(s,e);return a?n.length==0?a:this.getDirectoryHandle(n.join("/"),e,a):void 0}catch(n){console.log(n);return}}static async getFileHandle(t,e){try{const r=this.resolvePath(t).split("/"),n=r.pop(),s=await this.getDirectoryHandle(r.join("/"),e);return s?await s.getFileHandle(n,e):void 0}catch(r){console.log(r);return}}static async getFileHandleRelativeTo(t,e){try{return xn(t)!=""&&(t=zr(t)),this.getFileHandle(this.resolvePath(t+"/"+e))}catch(r){console.log(r);return}}static async getDirectoryFiles(t){try{let e;if(typeof t=="string"){if(e=await this.getDirectoryHandle(t),!e)return[]}else e=t;const r=[];for await(const n of e.values())n.kind=="file"&&r.push(n);return r}catch(e){return console.log(e),[]}}static async getDirectoryFolders(t){try{let e;if(typeof t=="string"){if(e=await this.getDirectoryHandle(t),!e)return[]}else e=t;const r=[];for await(const n of e.values())n.kind=="directory"&&r.push(n);return r}catch(e){return console.log(e),[]}}static async writeFile(t,e){let r;if(typeof t=="string"){if(r=await this.getFileHandle(t,{create:!0}),!r)return}else r=t;await this.writeHandle(r,e)}static async removeFile(t,e){try{const r=zr(t),n=await this.getDirectoryHandle(r);if(!n)return;await n.removeEntry(Ts(t),e)}catch(r){console.log(r);return}}static async removeDirectory(t){return this.removeFile(t,{recursive:!0})}static async remove(t){return xn(t)==""?this.removeDirectory(t):this.removeFile(t)}static resolvePath(t){let e=t.split("/");for(e=e.filter(r=>r!="."&&r!="");e.indexOf("..")>-1;){const r=e.indexOf("..");if(r==0)throw Error("Path"+e.join("/")+"is invalid!");e.splice(r-1,2)}return e.join("/")}static async zipDirectory(t,e){const r=e??new YR,n=xn(t)==""?t:zr(t),s=await this.getDirectoryHandle(n);if(!!s){for(const a of await this.getDirectoryFiles(s))r.file(a.name,await a.getFile());for(const a of await this.getDirectoryFolders(s)){const h=r.folder(a.name);if(!h){console.error("Failed to zip folder "+t+"/"+a.name);continue}this.zipDirectory(t+"/"+a.name,h)}return r}}static async saveDirectory(t){const e=xn(t)==""?t:zr(t);Oe.create("Exporting "+e+".zip");const r=await VR({_preferPolyfill:!1,suggestedName:`${e}.zip`,types:[{accept:{"application/zip":[".zip"]}}],excludeAcceptAllOption:!1}),n=await this.zipDirectory(t);!n||await n.generateAsync({type:"blob"}).then(async s=>{await this.writeHandle(r,s)})}static async renameFile(t,e){try{const r=await this.getDirectoryHandle(zr(t)),n=await this.getDirectoryHandle(zr(e),{create:!0}),s=await this.getFileHandle(t);if(!r||!n||!s)return;await this.copyToHandle(n,s,Ts(e)),await r.removeEntry(Ts(t))}catch(r){console.log(r)}}static async renameDirectory(t,e){if(!e.startsWith(t))try{const r=await this.getDirectoryHandle(zr(t)),n=await this.getDirectoryHandle(zr(e),{create:!0}),s=await this.getDirectoryHandle(t);if(!r||!n||!s)return;await this.copyToHandle(n,s,Ts(e)),await r.removeEntry(Ts(t),{recursive:!0})}catch(r){console.log(r)}}static async copyToHandle(t,e,r){try{if(e.kind=="directory"){const n=await t.getDirectoryHandle(r??e.name,{create:!0}),s=[];for await(const a of e.values())s.push(this.copyToHandle(n,a));await Promise.all(s)}else{const n=await e.getFile(),s=await t.getFileHandle(r??e.name,{create:!0});await this.writeHandle(s,n)}}catch(n){console.log(n)}}static getRelativePath(t,e){const r=t.split("/"),n=e.split("/"),s=Math.min(r.length,n.length);let a=s;for(let u=0;u<s;u++)if(r[u]!==n[u]){a=u;break}if(a==0)return e;let h=[];for(let u=a;u<r.length;u++)h.push("..");return h=h.concat(n.slice(a)),h.join("/")}static async writeHandle(t,e){if(t.createWritable){const r=await t.createWritable();await r.write(e),await r.close()}else{const r=await this.root.resolve(t);if(!r)return;await uc.writeHandle(r.join("/"),e)}}}L(Ve,"_root"),L(Ve,"persistentFiles",!1);Ve.root;const h0=["audio.rate","chart.snap","chart.CMod","play.timingCollection"],$R=[];class yn{}L(yn,"general",{scrollSensitivity:1,mousePlacement:!1,smoothAnimations:!0}),L(yn,"chart",{CMod:!1,reverse:!1,zoom:1,speed:250,snap:1,hideWarpedArrows:!1,doSpeedChanges:!0,drawNoteFlash:!0,receptorYPos:-200,maxDrawBeats:20,maxDrawBeatsBack:10,waveform:{enabled:!0,color:6316402,opacity:.5,lineHeight:1},renderTimingEvent:{BPMS:!0,STOPS:!0,DELAYS:!0,WARPS:!0,FAKES:!0,COMBOS:!0,SPEEDS:!0,LABELS:!0,SCROLLS:!0,TIMESIGNATURES:!0,TICKCOUNTS:!0,BGCHANGES:!0,FGCHANGES:!0,ATTACKS:!0}}),L(yn,"audio",{assistTick:!1,metronome:!1,rate:1,songVolume:.2,soundEffectVolume:.5,effectOffset:0}),L(yn,"play",{offset:0,hideBarlines:!1,judgmentTilt:!0,timingCollection:"ITG",timingWindowScale:1,timingWindowAdd:0,defaultTimingCollection:{"dance-single":"ITG","dance-double":"ITG","dance-3panel":"ITG","dance-solo":"ITG","dance-solodouble":"ITG"}}),L(yn,"performance",{antialiasing:!1,resolution:window.devicePixelRatio}),L(yn,"debug",{renderingStats:!1,showTimers:!1}),L(yn,"experimental",{speedChangeWaveform:!0});class z extends yn{static extractOptions(t,e){return Object.entries(t).reduce((r,n)=>{const s=e?e+".":"";return typeof n[1]=="object"?r=r.concat(this.extractOptions(n[1],s+n[0])):(n[0]=s+n[0],r.push([n[0],n[1]])),r},[])}static applyOption(t){if(typeof this.getDefaultOption(t[0])!=typeof t[1])return console.warn("Couldn't load option "+t[0]+": the value "+t[1]+" ("+typeof t[1]+")  does not match the type "+typeof this.getDefaultOption(t[0]));const e=t[0].split("."),r=e.pop();let n=this;for(const s of e)if(s in n)n=n[s];else return console.warn("Couldn't load option "+t[0]+": the id doesn't exist");n[r]=t[1]}static getDefaultOption(t){const e=t.split(".");let r=yn;for(const n of e)if(n in r)r=r[n];else return;if(!(typeof r!="string"&&typeof r!="number"&&typeof r!="boolean"))return r}static getOption(t){const e=t.split(".");let r=this;for(const n of e)if(n in r)r=r[n];else return;if(!(typeof r!="string"&&typeof r!="number"&&typeof r!="boolean"))return r}static saveOptions(){const t={};for(const e of this.extractOptions(this)){if(h0.includes(e[0]))continue;const r=this.getDefaultOption(e[0]);if(r==null){console.warn("Couldn't save option "+e[0]+": the id doesn't exist");continue}typeof r!=typeof e[1]?(console.warn("Couldn't save option "+e[0]+": the value "+e[1]+" does not match the type "+typeof this.getDefaultOption(e[0])),t[e[0]]=r):t[e[0]]=e[1]}localStorage.setItem("options",JSON.stringify(t))}static loadOptions(){const t=localStorage.getItem("options");if(!t)return;const e=JSON.parse(t);if(typeof e!="object")return console.error("Couldn't load options from storage");for(const r of Object.entries(e))h0.includes(r[0])||this.applyOption(r)}static clearSave(){localStorage.removeItem("options")}}const g_={};for(const i of Object.entries(yn))g_[i[0]]=JSON.parse(JSON.stringify(i[1]));Object.assign(z,g_);class y_{constructor(){L(this,"cols",[])}keyDown(t){this.cols[t]=(this.cols[t]??0)+1}keyUp(t){this.cols[t]=(this.cols[t]??1)-1,this.cols[t]=Math.max(this.cols[t],0)}isPressed(t){return!!this.cols[t]}getHeldCols(){return this.cols.map((t,e)=>e).filter(t=>this.isPressed(t))}reset(){this.cols=[]}}const Mc=class{constructor(t,e){L(this,"tHeight",0);L(this,"tWidth",0);L(this,"texture");L(this,"judgeNames",[]);this.judgeNames=e,this.loadTex(t)}async loadTex(t){const e=await ho.load(t);this.texture=e,this.tHeight=e.height,this.tWidth=e.width}getTexture(t,e){if(!this.judgeNames.includes(e.id))return;let r=0;const n=this.judgeNames.indexOf(e.id)*this.tHeight/this.judgeNames.length;return t>=0&&(r+=this.tWidth/2),this.texture.frame=new Te(r,n,this.tWidth/2,this.tHeight/this.judgeNames.length),this.texture}};let ei=Mc;L(ei,"ITG",new Mc("assets/judgment/judgmentITG.png",["w0","w1","w2","w3","w4","w5","miss"])),L(ei,"WATERFALL",new Mc("assets/judgment/judgmentWaterfall.png",["w0","w1","w2","w3","w4","w5","miss"]));class qc{constructor(t,e,r){L(this,"timingWindowMS");L(this,"dancePoints");L(this,"lifeChange");this.timingWindowMS=t,this.dancePoints=e,this.lifeChange=r}getTimingWindowMS(){return this.timingWindowMS*z.play.timingWindowScale+z.play.timingWindowAdd}}class Kl extends qc{constructor(e,r){super(0,e,r);L(this,"target","dropped")}}class aa extends qc{constructor(e,r,n,s){super(r,n,s);L(this,"noteType");this.noteType=e}}new aa("Hold",0,0,0);class Zl extends qc{constructor(e,r,n){super(e,r,n);L(this,"target","mine")}}class Ni extends qc{constructor(e,r,n,s,a,h,u){super(s,a,h);L(this,"id");L(this,"name");L(this,"color");L(this,"judgmentTexture");this.id=e,this.name=r,this.color=n,this.judgmentTexture=u}}const __=new Ni("w0","Fantastic",183528,0,0,0,ei.ITG);class Ql extends Ni{constructor(t,e,r,n,s){super("miss",t,e,0,r,n,s)}}function va(i){return i.color!=null&&i.id!="miss"}function ts(i){return i.color!=null&&i.id=="miss"}function Is(i){return!!i.noteType}function To(i){return i.target=="dropped"}function da(i){return i.target=="mine"}const uo=class{constructor(t,e){L(this,"windows",[]);L(this,"holdWindows",{});L(this,"missWindow");L(this,"droppedWindow");L(this,"mineWindow");L(this,"hideLimitMS");this.missWindow=new Ql("Miss",16724016,-12,-.1,ei.ITG),this.droppedWindow=new Kl(0,-.08),this.mineWindow=new Zl(71.5,-1,-.05);for(const r of t)va(r)?this.windows.push(r):ts(r)?this.missWindow=r:Is(r)?this.holdWindows[r.noteType]=r:To(r)?this.droppedWindow=r:da(r)&&(this.mineWindow=r);this.windows.sort((r,n)=>r.timingWindowMS-n.timingWindowMS),this.hideLimitMS=e}judgeInput(t){for(const e of this.windows)if(e.getTimingWindowMS()/1e3>=Math.abs(t))return e;return this.missWindow}getHeldJudgement(t){return this.holdWindows[t.type]}getMissJudgment(){return this.missWindow}getDroppedJudgment(){return this.droppedWindow}getMineJudgment(){return this.mineWindow}shouldHideNote(t){return t.id!="miss"&&t.timingWindowMS<=this.hideLimitMS}maxWindowMS(){return this.windows.at(-1)?.getTimingWindowMS()??0}getMaxDancePoints(){return Math.max(...this.windows.map(t=>t.dancePoints),this.missWindow.dancePoints)}getMaxHoldDancePoints(t){return Math.max(this.holdWindows[t].dancePoints??0,this.droppedWindow.dancePoints)}getStandardWindows(){return[...this.windows]}getHoldWindows(){return[...Object.values(this.holdWindows)]}static getCollection(t){return this.COLLECTIONS[t]??this.COLLECTIONS.ITG}static getCollections(){return uo.COLLECTIONS}};let li=uo;L(li,"COLLECTIONS",{ITG:new uo([new Ni("w0","Fantastic",2215144,23,5,.008,ei.ITG),new Ni("w2","Excellent",14851096,44.5,4,.008,ei.ITG),new Ni("w3","Great",6736213,103.5,2,.004,ei.ITG),new Ni("w4","Decent",11820287,136.5,0,0,ei.ITG),new Ni("w5","Way Off",13206878,181.5,-6,-.05,ei.ITG),new Ql("Miss",16724016,-12,-.1,ei.ITG),new aa("Hold",321.5,5,-.008),new aa("Roll",351.5,5,-.008),new Kl(0,-.08),new Zl(71.5,-6,-.05)],103.5),FA:new uo([new Ni("w0","Fantastic",2215144,15,3.5,.008,ei.ITG),new Ni("w1","Fantastic",16777215,23,3,.008,ei.ITG),new Ni("w2","Excellent",14851096,44.5,2,.008,ei.ITG),new Ni("w3","Great",6736213,103.5,1,.004,ei.ITG),new Ni("w4","Decent",11820287,136.5,0,0,ei.ITG),new Ni("w5","Way Off",13206878,181.5,0,-.05,ei.ITG),new Ql("Miss",16724016,0,-.1,ei.ITG),new aa("Hold",321.5,1,-.008),new aa("Roll",351.5,1,-.008),new Kl(0,-.08),new Zl(71.5,-1,-.05)],103.5),WATERFALL:new uo([new Ni("w0","Masterful",16711870,15,10,.008,ei.WATERFALL),new Ni("w2","Awesome",16776960,30,9,.008,ei.WATERFALL),new Ni("w3","Solid",51200,50,6,.008,ei.WATERFALL),new Ni("w4","OK",33023,100,3,.004,ei.WATERFALL),new Ni("w5","Fault",8421504,160,0,0,ei.WATERFALL),new Ql("Miss",16724016,0,-.1,ei.WATERFALL),new aa("Hold",300,6,-.008),new aa("Roll",350,6,-.008),new Kl(0,-.08),new Zl(71.5,-3,-.05)],100)});class qR{}class Lo extends qR{constructor(){super(...arguments);L(this,"chordCohesion",new Map);L(this,"missNoteIndex",0);L(this,"holdProgress",[]);L(this,"heldCols",new y_);L(this,"collection",li.getCollection("ITG"))}update(e){if(!e.chart||!e.chartView)return;const n=e.chartView.getTimeWithOffset()-this.collection.maxWindowMS()/1e3*z.audio.rate;let s=-1;for(;e.chart.notedata[this.missNoteIndex]&&e.chart.notedata[this.missNoteIndex].second<n;){const a=e.chart.notedata[this.missNoteIndex];if(a.beat!=s&&a.type!="Mine"&&!a.fake&&!a.gameplay.hasHit){s=a.beat,e.chartView.doJudgment(a,0,this.collection.getMissJudgment());const h=this.chordCohesion.get(a.beat);e.gameStats?.addDataPoint(h,this.collection.getMissJudgment(),0)}this.missNoteIndex++}for(const a of this.holdProgress)if(!(!a.hold||!a.gameplay.lastHoldActivation)){if(this.heldCols.isPressed(a.col)&&a.type=="Hold"&&(a.gameplay.lastHoldActivation=Date.now()),this.shouldDropHold(a,Date.now())){e.chartView.doJudgment(a,0,this.collection.getDroppedJudgment()),a.gameplay.droppedHoldBeat=e.getBeat(),this.holdProgress.splice(this.holdProgress.indexOf(a),1),e.gameStats?.addHoldDataPoint(a,this.collection.getDroppedJudgment());continue}e.chartView.getTimeWithOffset()>=e.chartView.chart.getSeconds(a.beat+a.hold)&&(a.gameplay.hideNote=!0,e.chartView.doJudgment(a,0,this.collection.getHeldJudgement(a)),this.holdProgress.splice(this.holdProgress.indexOf(a),1),e.gameStats?.addHoldDataPoint(a,this.collection.getHeldJudgement(a)))}for(const a of this.heldCols.getHeldCols()){const h=this.getClosestNote(e.chart.notedata,e.chartView.getTimeWithOffset()-this.collection.getMineJudgment().getTimingWindowMS()/2e3,a,["Mine"],this.collection.getMineJudgment().getTimingWindowMS()/2);h&&(h.gameplay.hasHit=!0,h.gameplay.hideNote=!0,e.chartView.doJudgment(h,0,this.collection.getMineJudgment()),e.gameStats?.addDataPoint([h],this.collection.getMineJudgment(),0),e.mine.play())}}reset(e){if(!e.chart||!e.chartView)return;this.collection=li.getCollection(z.play.timingCollection),this.chordCohesion.clear();for(const a of e.chart.notedata)a.type=="Mine"||a.fake||(this.chordCohesion.has(a.beat)||this.chordCohesion.set(a.beat,[]),this.chordCohesion.get(a.beat).push(a));const n=e.chartView.getTimeWithOffset()-this.collection.maxWindowMS()/1e3*z.audio.rate;let s=en(e.chart.notedata,n,a=>a.second)+1;s>=1&&n<=e.chart.notedata[s-1].second&&s--,this.missNoteIndex=s,this.holdProgress=[],this.heldCols.reset()}keyDown(e,r){if(!e.chart||!e.chartView)return;const n=e.chartView.getTimeWithOffset(),s=this.getClosestNote(e.chart.notedata,n,r,["Tap","Hold","Roll"]);this.heldCols.keyDown(r);for(const a of this.holdProgress)a.type=="Roll"&&a.col==r&&(a.gameplay.lastHoldActivation=Date.now());s?this.hitNote(e,s,n):e.chartView.keyDown(r)}keyUp(e,r){if(!e.chart||!e.chartView)return;const n=e.chartView.getTimeWithOffset(),s=this.getClosestNote(e.chart.notedata,n,r,["Lift"]);this.heldCols.keyUp(r),e.chartView.keyUp(r),s&&this.hitNote(e,s,n)}shouldAssistTick(e){return!e.fake&&e.type!="Mine"}hitNote(e,r,n){r.gameplay.hasHit=!0,ke(r)&&(r.gameplay.lastHoldActivation=Date.now(),e.chartView.activateHold(r.col),this.holdProgress.push(r));const s=this.chordCohesion.get(r.beat);if(s.every(a=>a.gameplay.hasHit)){const a=this.collection.judgeInput((n-r.second)/z.audio.rate),h=this.collection.shouldHideNote(a);s.forEach(u=>{e.chartView.doJudgment(u,(n-u.second)/z.audio.rate,a),h&&eB(u)&&(u.gameplay.hideNote=!0)}),e.gameStats?.addDataPoint(s,a,(n-r.second)/z.audio.rate)}}getClosestNote(e,r,n,s,a){a=a??this.collection.maxWindowMS(),a*=z.audio.rate;const h=r-a/1e3,u=r+a/1e3;let d=en(e,h,l=>l.second)+1;d>=1&&h<=e[d-1].second&&d--;let m;for(;e[d]&&e[d].second<=u;){const l=e[d];if(l.gameplay.hasHit||l.col!=n||l.fake||!s.includes(l.type)){d++;continue}(!m||Math.abs(l.second-r)<Math.abs(m.second-r))&&(m=l),d++}return m}shouldDropHold(e,r){if(!e.gameplay?.lastHoldActivation)return!1;const n=this.collection.getHeldJudgement(e);return n?r-e.gameplay.lastHoldActivation>=n.getTimingWindowMS():!1}}class KR{}const ZR={1:"Tap",2:"Hold",4:"Roll",M:"Mine",F:"Fake",L:"Lift"},QR={Tap:"1",Hold:"2",Roll:"4",Mine:"M",Fake:"F",Lift:"L"};class Fo extends KR{serialize(t,e){if(t.length==0)return"";const r=[];let n=0;const s=t.filter(ke),a=t.at(-1),h=a.beat+(ke(a)?a.hold:0);for(let u=0;u<Math.ceil(h/4);u++){let d="// measure "+u+`
`;const m=[];for(;t[n]?.beat<u*4+4;)m.push(t[n++]);const l=[];for(;s[0]?.beat+s[0]?.hold<u*4+4;)l.push(s.shift());const f=Math.max(4,f_(i0(m.map(p=>e0(p.beat))),i0(l.map(p=>e0(p.beat+p.hold)))));for(let p=0;p<f;p++){const y=u*4+4/f*p,_=new Array(e.numCols).fill("0");for(;ve(m[0]?.beat??-1,3)==ve(y,3);){const v=m.shift();_[v.col]=QR[v.type]}for(;ve(l[0]?.beat+l[0]?.hold,3)==ve(y,3);){const v=l.shift();_[v.col]="3"}d+=_.join("")+`
`}r.push(d)}return r.join(",  ")}fromString(t){const e=t.split(","),r=[],n=[];for(let s=0;s<e.length;s++){const a=e[s].trim().split(`
`);for(let h=0;h<a.length;h++){const u=a[h].trim();let d=0;for(let m=0;m<u.length;m++){const l=s*4+h/a.length*4;let f=u[m];if(f=="D"&&(u[m+1]=="L"||u[m+1]=="M")&&(u[m+1]=="L"?f="3":f="M",m++),f!="0"&&f!="3"){const p={beat:l,col:d,type:ZR[f]};if(p.type==null){console.log("Unknown note type "+f+" at beat "+l+" col "+d);continue}(f=="2"||f=="4")&&(n[d]&&console.log("Missing end of hold/roll for note "+JSON.stringify(n[d])),n[d]=p),r.push(p)}f=="3"&&(n[d]?(n[d].hold=l-n[d].beat,n[d]=void 0):console.log("Extra end of hold/roll at beat "+l+" col "+d)),d++}}}return r}getStats(t,e){const r={npsGraph:this.getNPSPerMeasure(t,e),counts:{Taps:0,Jumps:0,Hands:0,Holds:0,Rolls:0,Mines:0,Fakes:0,Lifts:0}};let n=-1,s=0;const a=[];for(const u of t){if(u.beat!=n){let d=0;for(let m=0;m<a.length;m++)a[m]&&(n>a[m]?a[m]=void 0:a[m]<u.beat&&d++);s>1&&r.counts.Jumps++,s+d>2&&r.counts.Hands++,s=0,n=u.beat}if(u.type!="Mine"&&!u.fake&&s++,u.fake){r.counts.Fakes++;continue}switch(u.type){case"Tap":r.counts.Taps++;break;case"Hold":r.counts.Holds++;break;case"Roll":r.counts.Rolls++;break;case"Lift":r.counts.Lifts++;break;case"Mine":r.counts.Mines++;break}ke(u)&&(a[u.col]=u.beat+u.hold)}let h=0;for(let u=0;u<a.length;u++)a[u]&&a[u]<t[t.length-1].beat&&h++;return s>1&&r.counts.Jumps++,s+h>2&&r.counts.Hands++,r}getNPSPerMeasure(t,e){const r=t[t.length-1]?.beat??0,n=[];let s=0;for(let a=0;a<r;a+=4){const h=e.getSeconds(a+4)-e.getSeconds(a);if(h<=.05){n.push(0);continue}let u=0;for(;t[s+1]&&t[s].beat<a+4;){const d=t[s].type;s++,!t[s].fake&&!t[s].warped&&(d=="Hold"||d=="Roll"||d=="Tap"||d=="Lift")&&u++}n.push(u/h)}return n}}class JR extends we{constructor(e){super();L(this,"renderer");this.renderer=e}}const tk=Ut.from("assets/noteskin/dance/mine/frame.png"),mi=class{static async initArrowTex(t){if(!this.loaded){this.noop_frag=await fetch("assets/noteskin/dance/shader/noop.frag").then(e=>e.text()),this.noop_vert=await fetch("assets/noteskin/dance/shader/noop.vert").then(e=>e.text()),this.arrow_gradient_frag=await fetch("assets/noteskin/dance/shader/arrow_gradient.frag").then(e=>e.text()),this.mine_gradient_frag=await fetch("assets/noteskin/dance/shader/mine_gradient.frag").then(e=>e.text()),this.arrow_body_geometry=await this.loadGeometry("assets/noteskin/dance/tap/body.txt"),this.arrow_frame_geometry=await this.loadGeometry("assets/noteskin/dance/tap/frame.txt"),this.mine_body_geometry=await this.loadGeometry("assets/noteskin/dance/mine/body.txt");{const e=Mr.from(this.noop_vert,this.noop_frag,{sampler0:this.arrow_parts_texture}),r=new ua(mi.arrow_frame_geometry,e);r.x=32,r.y=32,r.rotation=-Math.PI/2,this.arrow_frame=r}for(let e=0;e<8;e++){const r=Mr.from(this.noop_vert,this.arrow_gradient_frag,{sampler0:this.arrow_parts_texture,time:0,quant:e}),n=new Pe(mi.arrow_frame_tex);n.x=e%3*64,n.y=Math.floor(e/3)*64;const s=new ua(mi.arrow_body_geometry,r);s.x=e%3*64+32,s.y=Math.floor(e/3)*64+32,s.rotation=-Math.PI/2,s.name="body"+e,mi.arrow_container.addChild(n),mi.arrow_container.addChild(s)}{const e=Mr.from(this.noop_vert,this.mine_gradient_frag,{sampler0:this.mine_parts_texture,time:0}),r=new ua(mi.mine_body_geometry,e),n=new Pe(tk);n.width=64,n.height=64,n.anchor.set(.5),mi.mine_container.position.set(32),mi.mine_container.addChild(r),mi.mine_container.addChild(n)}t.ticker.add(()=>{t.renderer.render(mi.arrow_frame,{renderTexture:mi.arrow_frame_tex}),t.renderer.render(mi.arrow_container,{renderTexture:mi.arrow_tex}),t.renderer.render(mi.mine_container,{renderTexture:mi.mine_tex})}),this.loaded=!0}}static async loadGeometry(t){try{const r=(await fetch(t).then(d=>d.text())).split(`
`),n=parseInt(r[0]),s=parseInt(r[n+1]),a=[],h=[],u=[];for(let d=0;d<n;d++){const m=/(-?[0-9.]+)\s+(-?[0-9.]+)\s+(-?[0-9.]+)\s+(-?[0-9.]+)/.exec(r[d+1]);if(m)a.push(parseFloat(m[1])),a.push(parseFloat(m[2])),h.push(parseFloat(m[3])),h.push(parseFloat(m[4]));else throw Error("Failed to load vertex "+r[d+1])}for(let d=0;d<s;d++){const m=/(-?[0-9.]+)\s+(-?[0-9.]+)\s+(-?[0-9.]+)/.exec(r[d+2+n]);if(m)u.push(parseFloat(m[1])),u.push(parseFloat(m[2])),u.push(parseFloat(m[3]));else throw Error("Failed to load triangle "+r[d+2+n])}return new Tn().addAttribute("aVertexPosition",a,2).addAttribute("aUvs",h,2).addIndex(u)}catch(e){return console.error(e),new Tn}}static setArrowTexTime(t,e){if(!!this.loaded){for(let r=0;r<8;r++){const n=mi.arrow_container.getChildByName("body"+r);n.shader.uniforms.time=t}mi.mine_container.children[0].shader.uniforms.time=e,mi.mine_container.rotation=e%1*Math.PI*2}}static setNoteTex(t,e){if(e.type=="Mine")t.texture=mi.mine_tex;else{const r=Math.min(Nf(e.beat),7);t.texture=new Ut(mi.arrow_tex.baseTexture,new Te(r%3*64,Math.floor(r/3)*64,64,64))}}};let bi=mi;L(bi,"noop_frag"),L(bi,"noop_vert"),L(bi,"arrow_gradient_frag"),L(bi,"mine_gradient_frag"),L(bi,"arrow_parts_texture",Le.from("assets/noteskin/dance/tap/parts.png")),L(bi,"mine_parts_texture",Le.from("assets/noteskin/dance/mine/parts.png")),L(bi,"arrow_body_geometry"),L(bi,"arrow_frame_geometry"),L(bi,"mine_body_geometry"),L(bi,"arrow_frame_tex",Ui.create({width:64,height:64,resolution:z.performance.resolution})),L(bi,"arrow_frame"),L(bi,"arrow_tex",Ui.create({width:192,height:192,resolution:z.performance.resolution})),L(bi,"arrow_container",new we),L(bi,"mine_tex",Ui.create({width:64,height:64,resolution:z.performance.resolution})),L(bi,"mine_container",new we),L(bi,"loaded",!1);const ek=Ut.from("assets/noteskin/dance/hold/body.png"),ik=Ut.from("assets/noteskin/dance/hold/cap.png"),rk=Ut.from("assets/noteskin/dance/roll/body.png"),nk=Ut.from("assets/noteskin/dance/roll/cap.png"),l0={Fake:Ut.from("assets/noteskin/dance/icon/fake.png"),Lift:Ut.from("assets/noteskin/dance/icon/lift.png")};class sk extends we{constructor(){super();L(this,"note");L(this,"icon");this.note=new Pe,this.note.anchor.set(.5),this.addChild(this.note)}}class ak extends we{constructor(){super(...arguments);L(this,"holdBody");L(this,"holdCap")}}class ok extends we{constructor(){super();L(this,"type","");L(this,"hold");L(this,"item");L(this,"selection");this.hold=new ak,this.item=new sk,this.selection=new Pe(Ut.WHITE),this.selection.alpha=0,this.addChild(this.hold),this.addChild(this.item),this.addChild(this.selection)}}class Xi{static createArrow(){const t=new ok;return t.interactive=!0,t}static setHoldLength(t,e){t.type!="Roll"&&t.type!="Hold"||(t.hold.holdBody.height=e,t.hold.holdBody.y=e,t.hold.holdCap.y=e,t.selection.height=64+e)}static setHoldBrightness(t,e){t.type!="Roll"&&t.type!="Hold"||(t.hold.holdBody.tint=Ec(e*255,e*255,e*255),t.hold.holdCap.tint=Ec(e*255,e*255,e*255))}static hideFakeIcon(t,e){t.type=="Fake"&&(t.item.icon.visible=!e)}static setData(t,e,r){const n=r.col,s=r.type;if(bi.setNoteTex(e.item.note,r),s=="Mine"?e.item.note.rotation=0:e.item.note.rotation=t.getRotFromCol(n),s=="Hold"||s=="Roll"){if(!e.hold.holdBody||!e.hold.holdCap){const a=new Cf(Ut.EMPTY,64,0);a.tileScale.x=.5,a.tileScale.y=.5,a.uvRespectAnchor=!0,a.anchor.y=1,a.x=-32;const h=new Pe;h.width=64,h.height=32,h.anchor.x=.5,e.hold.holdBody=a,e.hold.holdCap=h,e.hold.addChild(a),e.hold.addChild(h)}e.hold.holdBody.texture=s=="Hold"?ek:rk,e.hold.holdCap.texture=s=="Hold"?ik:nk,Xi.setHoldBrightness(e,.8),e.hold.visible=!0}else e.hold.visible=!1;if(l0[s]){if(e.item.icon&&e.type!=r.type&&(e.item.icon.destroy(),e.item.icon=void 0),!e.item.icon){const a=new Pe(l0[s]);a.width=32,a.height=32,a.anchor.set(.5),a.alpha=.9,e.item.icon=a,e.item.addChild(a)}e.item.icon.visible=!0}else e.item.icon&&(e.item.icon.visible=!1);e.selection.x=-32,e.selection.y=-32,e.selection.width=64,e.selection.height=64,e.type=r.type}}const ha=class extends we{constructor(e,r){super();L(this,"children",[]);L(this,"renderer");L(this,"notefield");ha.held_tex||this.loadTex(),this.notefield=e,this.renderer=r}async loadTex(){let e=0,r=0;const n=await ho.load("assets/noteskin/dance/hold_judgment.png");e=n.height,r=n.width,ha.held_tex=new Ut(n,new Te(0,0,r,e/2)),ha.dropped_tex=new Ut(n,new Te(0,e/2,r,e/2))}renderThis(){this.y=z.chart.receptorYPos/z.chart.zoom+48,this.scale.y=z.chart.reverse?-1:1;for(const e of this.children){const r=(Date.now()-e.createTime)/1e3;if(r<.1){const n=1-(1-r/.1)*(1-r/.1);e.scale.set(.3*n)}else if(r>.6&&r<.8){const n=(r-.6)/.2*(r-.6)/.2;e.scale.set(.3*(1-n))}}ui(this.children,e=>Date.now()-e.createTime>800)}addJudge(e,r){if(!To(r)&&!Is(r))return;const n=new Pe(To(r)?ha.dropped_tex:ha.held_tex);n.anchor.set(.5),n.x=this.notefield.getColX(e),n.createTime=Date.now(),n.scale.set(0),this.addChild(n)}};let wh=ha;L(wh,"held_tex"),L(wh,"dropped_tex");class hk extends we{constructor(e,r){super();L(this,"children",[]);L(this,"notefield");L(this,"renderer");L(this,"noteMap",new Map);this.renderer=r,this.notefield=e,this.sortableChildren=!0}renderThis(e,r,n){this.children.forEach(a=>a.marked=!1);const s=this.renderer.chartManager.getTime();for(const a of this.renderer.chart.notedata){if(a.gameplay?.hideNote||z.chart.CMod&&z.chart.hideWarpedArrows&&a.warped||a.beat+(ke(a)?a.hold:0)<r)continue;if(a.beat>n)break;const[h,u,d,m]=this.checkBounds(a,e);if(u)break;if(h)continue;const l=this.getNote(a);if(l.deactivated=!1,l.marked=!0,l.dirtyTime=Date.now(),l.y=d,l.item.scale.y=z.chart.reverse?-1:1,ke(a))if(Xi.setHoldLength(l,m),a.gameplay?.lastHoldActivation){let y=(Date.now()-a.gameplay.lastHoldActivation)/li.getCollection(z.play.timingCollection).getHeldJudgement(a).getTimingWindowMS();y=Math.min(1.2,y),Xi.setHoldBrightness(l,1-y*.7)}else Xi.setHoldBrightness(l,.8);a.type=="Fake"&&Xi.hideFakeIcon(l,this.renderer.chartManager.getMode()==zt.Play);const f=this.renderer.chartManager.getMode()!=zt.Play&&(this.renderer.chartManager.selection.notes.includes(a)||this.renderer.chartManager.selection.inProgressNotes.includes(a));l.selection.alpha=f?Math.sin(Date.now()/320)*.1+.3:0;const p=this.renderer.selectionTest(l);!f&&p&&this.renderer.chartManager.addNoteToDragSelection(a),f&&!p&&this.renderer.chartManager.removeNoteFromDragSelection(a),this.renderer.chartManager.selection.shift&&f?l.visible=!1:l.visible=!0}bi.setArrowTexTime(e,s),this.children.filter(a=>!a.deactivated&&!a.marked).forEach(a=>{a.deactivated=!0,a.visible=!1,this.noteMap.delete(a.note)}),ui(this.children,a=>Date.now()-a.dirtyTime>5e3)}checkBounds(e,r){let n=z.chart.receptorYPos/z.chart.zoom;(!ke(e)||!e.gameplay?.lastHoldActivation||r<e.beat)&&(n=this.renderer.getYPos(e.beat)),ke(e)&&e.gameplay?.droppedHoldBeat&&(n=this.renderer.getYPos(e.gameplay.droppedHoldBeat));const s=this.renderer.getYPos(e.beat+(ke(e)?e.hold:0));return ke(e)&&!e.gameplay?.droppedHoldBeat&&e.gameplay?.lastHoldActivation&&e.beat+e.hold<r?[!0,!1,n,s-n]:s<this.renderer.getUpperBound()?[!0,!1,n,s-n]:n>this.renderer.getLowerBound()?e.beat<r||this.renderer.isNegScroll(e.beat)?[!0,!1,n,s-n]:[!0,!0,n,s-n]:[!1,!1,n,s-n]}getNote(e){if(this.noteMap.get(e))return this.noteMap.get(e);let r;for(const d of this.children)if(d.deactivated){r=d;break}r||(r=Xi.createArrow()),r.note=e,r.visible=!0,r.zIndex=e.beat,Xi.setData(this.notefield,r,e),r.x=this.notefield.getColX(e.col),r.interactive=!0;let n=0,s=0,a=0,h;const u=d=>{var v;const m=h,l=this.renderer.toLocal(d.global);if(Math.abs(l.y-a)**2+Math.abs(l.x-s)**2<32*32){this.renderer.chartManager.selection.shift&&(this.renderer.chartManager.selection.shift={columnShift:0,beatShift:0});return}const f=this.renderer.getBeatFromYPos(l.y),p=z.chart.snap==0?1/48:z.chart.snap;let y=Math.round(f/p)*p;Math.abs(y-f)>Math.abs(f-m.beat)&&(y=m.beat);const _=Math.round((l.x+96)/64);(v=this.renderer.chartManager.selection).shift||(v.shift={columnShift:0,beatShift:0}),n!=_-m.col&&(n=_-m.col,this.renderer.chartManager.selection.notes.every(w=>{const C=w.col+n;return C>=0&&C<this.renderer.chartManager.chart.gameType.numCols})&&(this.renderer.chartManager.selection.shift.columnShift=_-m.col)),this.renderer.chartManager.selection.shift.beatShift=y-m.beat};return r.on("mousedown",d=>{if(z.general.mousePlacement&&!d.getModifierState("Meta")&&!d.getModifierState("Control")&&!d.getModifierState("Shift")&&!this.renderer.chartManager.selection.notes.includes(r.note))return;d.stopImmediatePropagation(),this.renderer.chartManager.selection.notes.includes(r.note)?(d.getModifierState("Control")||d.getModifierState("Meta"))&&this.renderer.chartManager.removeNoteFromSelection(r.note):(!d.getModifierState("Control")&&!d.getModifierState("Meta")&&!d.getModifierState("Shift")&&this.renderer.chartManager.clearSelection(),this.renderer.chartManager.addNoteToSelection(r.note)),s=r.x,a=r.y,h=r.note,this.renderer.on("mousemove",u);const m=()=>{this.renderer.off("mousemove",u),this.renderer.off("mouseup",m),((this.renderer.chartManager.selection.shift?.beatShift??0)!=0||(this.renderer.chartManager.selection.shift?.columnShift??0)!=0)&&this.renderer.chartManager.modifySelection(l=>(l.beat+=this.renderer.chartManager.selection.shift.beatShift,l.col+=this.renderer.chartManager.selection.shift.columnShift,l)),this.renderer.chartManager.selection.shift=void 0};this.renderer.on("mouseup",m)}),r.on("destroyed",()=>{r?.removeAllListeners()}),this.noteMap.set(e,r),this.addChild(r),r}}const lk=Ut.from("assets/noteskin/dance/flash/hold.png"),Pd={w0:Ut.from("assets/noteskin/dance/flash/fantastic.png"),w1:Ut.from("assets/noteskin/dance/flash/white_fantastic.png"),w2:Ut.from("assets/noteskin/dance/flash/excellent.png"),w3:Ut.from("assets/noteskin/dance/flash/great.png"),w4:Ut.from("assets/noteskin/dance/flash/decent.png"),w5:Ut.from("assets/noteskin/dance/flash/way_off.png"),mine:Ut.from("assets/noteskin/dance/flash/mine.png")};class ck extends we{constructor(e){super();L(this,"notefield");L(this,"children",[]);this.notefield=e}renderThis(){this.y=z.chart.receptorYPos/z.chart.zoom,this.scale.y=z.chart.reverse?-1:1;for(const e of this.children)switch(e.type){case"flash":{const r=(Date.now()-e.createTime)/150;e.scale.set(1.1-r*.1),e.alpha=1.2-r*1.2;break}case"mine":{const r=(Date.now()-e.createTime)/600;e.rotation=r*-Math.PI,e.alpha=Math.min(1,2-2*r);break}case"hold":e.alpha=Math.sin(Date.now())*.2+1.2}ui(this.children,e=>Date.now()-e.createTime>150&&e.type=="flash"),ui(this.children,e=>Date.now()-e.createTime>600&&e.type=="hold")}addFlash(e,r){if(!z.chart.drawNoteFlash)return;let n;if(va(r)&&(n=Pd[r.id]),da(r)&&(n=Pd.mine),Is(r)&&(n=Pd.w2),(Is(r)||To(r))&&ui(this.children,a=>a.type=="hold"&&a.col==e),!n)return;const s=new Pe(n);s.anchor.set(.5),s.rotation=this.notefield.getRotFromCol(e),s.x=this.notefield.getColX(e),s.createTime=Date.now(),s.type="flash",s.col=e,da(r)&&(s.type="mine",s.blendMode=ce.ADD),this.addChild(s)}activateHold(e){if(!z.chart.drawNoteFlash)return;const r=new Pe(lk);r.anchor.set(.5),r.rotation=this.notefield.getRotFromCol(e),r.x=this.notefield.getColX(e),r.type="hold",r.col=e,this.addChild(r)}reset(){ui(this.children,e=>e.type=="hold")}}const uk=Ut.from("assets/noteskin/dance/receptor.png");class dk extends we{constructor(e){super();L(this,"notefield");L(this,"receptors",new we);L(this,"pressedCols",new y_);L(this,"children",[]);this.notefield=e;for(let r=0;r<this.notefield.getNumCols();r++){const n=new Pe(uk);n.width=69,n.height=69,n.anchor.set(.5),n.x=this.notefield.getColX(r),n.rotation=this.notefield.getRotFromCol(r),n.lastPressedTime=-1,n.pressed=!1,this.receptors.addChild(n)}this.addChild(this.receptors)}renderThis(e){this.y=z.chart.receptorYPos/z.chart.zoom,this.scale.y=z.chart.reverse?-1:1;for(const r of this.receptors.children){const n=r,s=Math.min(1,Math.max(1-(e+1e5)%1,.5+(n.pressed?.1:0)))*255;let a=1;Date.now()-n.lastPressedTime<110&&(a=(Date.now()-n.lastPressedTime)/110*.25+.75),n.scale.set(a*.5),n.tint=Ec(s,s,s)}}keyDown(e){const r=this.pressedCols.isPressed(e);this.pressedCols.keyDown(e);const n=this.receptors.children[e];n.pressed=!0,r||(n.lastPressedTime=Date.now())}keyUp(e){this.pressedCols.keyUp(e);const r=this.receptors.children[e];r.pressed=this.pressedCols.isPressed(e)}}class fk extends we{constructor(e,r){super();L(this,"children",[]);L(this,"notefield");L(this,"renderer");L(this,"noteMap",new Map);L(this,"lastColShift",0);L(this,"lastBeatShift",0);this.renderer=r,this.notefield=e,this.sortableChildren=!0}renderThis(e,r,n){if(!this.renderer.chartManager.selection.shift){ui(this.children,()=>!0),this.lastBeatShift=0,this.lastColShift=0,this.noteMap.clear();return}const s=this.renderer.chartManager.selection.shift.beatShift,a=this.renderer.chartManager.selection.shift.columnShift;(this.lastBeatShift!=s||this.lastColShift!=a)&&(this.lastBeatShift=s,this.lastColShift=a,this.children.forEach(h=>{Xi.setData(this.notefield,h,{beat:h.note.beat+s,col:h.note.col+a,type:h.note.type}),h.x=this.notefield.getColX(h.note.col+a)})),this.visible=!0,this.children.forEach(h=>h.marked=!1);for(const h of this.renderer.chartManager.selection.notes){if(h.beat+s+(ke(h)?h.hold:0)<r||h.beat+s>n)continue;const[u,d,m,l]=this.checkBounds(h,e);if(d||u)continue;const f=this.getNote(h);f.deactivated=!1,f.marked=!0,f.dirtyTime=Date.now(),f.y=m,f.selection.alpha=Math.sin(Date.now()/320)*.1+.3,f.item.scale.y=z.chart.reverse?-1:1,ke(h)&&(Xi.setHoldLength(f,l),Xi.setHoldBrightness(f,.8))}this.children.filter(h=>!h.deactivated&&!h.marked).forEach(h=>{h.deactivated=!0,h.visible=!1,this.noteMap.delete(h.note)}),ui(this.children,h=>Date.now()-h.dirtyTime>5e3)}checkBounds(e,r){const n=e.beat+this.renderer.chartManager.selection.shift.beatShift,s=this.renderer.getYPos(n),a=this.renderer.getYPos(n+(ke(e)?e.hold:0));return a<this.renderer.getUpperBound()?[!0,!1,s,a-s]:s>this.renderer.getLowerBound()?n<r||this.renderer.isNegScroll(n)?[!0,!1,s,a-s]:[!0,!0,s,a-s]:[!1,!1,s,a-s]}getNote(e){if(this.noteMap.get(e))return this.noteMap.get(e);let r;for(const n of this.children)if(n.deactivated){r=n;break}return r||(r=Xi.createArrow()),r.note=e,r.visible=!0,r.zIndex=e.beat,Xi.setData(this.notefield,r,{beat:e.beat+this.renderer.chartManager.selection.shift.beatShift,col:e.col+this.renderer.chartManager.selection.shift.columnShift,type:e.type}),r.x=this.notefield.getColX(e.col+this.renderer.chartManager.selection.shift.columnShift),r.alpha=.4,r.interactive=!0,this.noteMap.set(e,r),this.addChild(r),r}}class Oo extends JR{constructor(e){super(e);L(this,"receptors");L(this,"notes");L(this,"selectionNotes");L(this,"flashes");L(this,"holdJudges");L(this,"ghostNote");L(this,"ghostNoteEntry");bi.initArrowTex(e.chartManager.app),this.receptors=new dk(this),this.notes=new hk(this,e),this.selectionNotes=new fk(this,e),this.flashes=new ck(this),this.holdJudges=new wh(this,e),this.ghostNote=Xi.createArrow(),this.ghostNote.visible=!1,this.ghostNote.alpha=.4,this.addChild(this.receptors,this.ghostNote,this.notes,this.selectionNotes,this.flashes,this.holdJudges)}setGhostNote(e){if(this.ghostNoteEntry=e,!e){this.ghostNote.visible=!1;return}Xi.setData(this,this.ghostNote,e),this.ghostNote.x=this.getColX(e.col)}getNoteSprite(e){const r=Xi.createArrow();return Xi.setData(this,r,e),r}update(e,r,n){this.receptors.renderThis(e),this.notes.renderThis(e,r,n),this.selectionNotes.renderThis(e,r,n),this.flashes.renderThis(),this.holdJudges.renderThis(),this.ghostNoteEntry&&(this.ghostNote.y=this.renderer.getYPos(this.ghostNoteEntry.beat),this.ghostNote.item.scale.y=z.chart.reverse?-1:1,this.ghostNote.visible=z.general.mousePlacement&&this.renderer.chartManager.getMode()==zt.Edit&&this.ghostNoteEntry.beat>=r&&this.ghostNoteEntry.beat<=n&&this.ghostNoteEntry.beat>=0)}doJudge(e,r){this.flashes.addFlash(e,r),this.holdJudges.addJudge(e,r)}reset(){this.flashes.reset()}keyDown(e){this.receptors.keyDown(e)}keyUp(e){this.receptors.keyUp(e)}activateHold(e){this.flashes.activateHold(e)}getColX(e){return(e-this.getNumCols()/2+.5)*64}getNumCols(){return this.renderer.chart.gameType.numCols}getRotFromCol(e){let r=[0,-90,90,180];return this.getNumCols()==3&&(r=[45,-90,135]),(this.getNumCols()==6||this.getNumCols()==12)&&(r=[0,45,-90,90,135,180]),this.getNumCols()==8&&(r=[0,-90,90,180,0,-90,90,180]),r[e%r.length]/180*Math.PI}}const Ic=class{static register(t){Ic.gameTypes[t.id]=t,this.priority.push(t)}static getPriority(){return this.priority}static getGameType(t){return Ic.gameTypes[t]}};let Si=Ic;L(Si,"gameTypes",{}),L(Si,"priority",[]);Si.register({id:"dance-single",numCols:4,notefieldWidth:4*64,gameLogic:new Lo,parser:new Fo,notefield:Oo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[3,1,2,0],vertical:[0,2,1,3]}});Si.register({id:"dance-double",numCols:8,notefieldWidth:8*64,gameLogic:new Lo,parser:new Fo,notefield:Oo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[3,1,2,0,7,5,6,4],vertical:[0,2,1,3,4,6,5,7]}});Si.register({id:"dance-couple",numCols:8,notefieldWidth:8*64,gameLogic:new Lo,parser:new Fo,notefield:Oo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[3,1,2,0,7,5,6,4],vertical:[0,2,1,3,4,6,5,7]}});Si.register({id:"dance-solo",numCols:6,notefieldWidth:6*64,gameLogic:new Lo,parser:new Fo,notefield:Oo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[5,4,2,3,1,0],vertical:[0,1,3,2,4,5]}});Si.register({id:"dance-solodouble",numCols:12,notefieldWidth:12*64,gameLogic:new Lo,parser:new Fo,notefield:Oo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[5,4,2,3,1,0,11,10,8,9,7,6],vertical:[0,1,3,2,4,5,6,7,9,8,10,11]}});Si.register({id:"dance-3panel",numCols:3,notefieldWidth:3*64,gameLogic:new Lo,parser:new Fo,notefield:Oo,editNoteTypes:["Tap","Mine","Fake","Lift"],flipColumns:{horizontal:[2,1,0],vertical:[0,1,2]}});const $n=class extends Co{static get instance(){return $n._instance||($n._instance=new $n),$n._instance}static emit(t,...e){return $n.instance.emit(t,...e)}static on(t,e,r){$n.instance.on(t,e,r)}static off(t,e,r,n){$n.instance.off(t,e,r,n)}};let Ee=$n;L(Ee,"_instance");const rn=["Beginner","Easy","Medium","Hard","Challenge","Edit"],zf=class{constructor(t){L(this,"items",[]);L(this,"itemIndex",0);L(this,"limit",0);L(this,"app");this.app=t,zf.instance=this}run(t){t.action(this.app),this.items.splice(this.itemIndex,this.items.length-this.itemIndex,t),this.itemIndex++}undo(){!this.items[this.itemIndex-1]||(this.items[this.itemIndex-1].undo(this.app),this.itemIndex--,Ee.emit("undo"))}redo(){!this.items[this.itemIndex]||(this.items[this.itemIndex].redo?this.items[this.itemIndex].redo(this.app):this.items[this.itemIndex].action(this.app),this.itemIndex++,Ee.emit("redo"))}reset(){this.itemIndex=0,this.items=[]}canUndo(){return this.itemIndex>0}canRedo(){return this.itemIndex!=this.items.length}setLimit(){this.limit=this.itemIndex}isDirty(){return this.itemIndex!=this.limit}};let Ji=zf;L(Ji,"instance");const Sc=["BPMS","STOPS","WARPS","DELAYS","LABELS","SPEEDS","SCROLLS","TICKCOUNTS","TIMESIGNATURES","COMBOS","FAKES","ATTACKS","BGCHANGES","FGCHANGES"];class v_{constructor(t,e){L(this,"_fallback");L(this,"_cache",{events:{},warpedBeats:{}});L(this,"_chart");L(this,"events",{});L(this,"offset");this._fallback=t,this._chart=e}parse(t,e){var n;if(t=="OFFSET"){this.offset=parseFloat(e);return}(n=this.events)[t]||(n[t]=[]);let r=e.replaceAll(/[\n\r\t]/g,"").split(",");t=="ATTACKS"&&(r=[e.replaceAll(/[\n\r\t]/g,"")]);for(const s of r){if(t=="ATTACKS"){let u;const d=/TIME=([\d.]+):(END|LEN)=([\d.]+):MODS=([^:]+)/g;for(;(u=d.exec(s))!=null;){const m={type:"ATTACKS",second:parseFloat(u[1]),endType:u[2],value:parseFloat(u[3]),mods:u[4]};this._insert("ATTACKS",m,!1)}return}const a=s.split("=");if(a.length<2)continue;let h;switch(t){case"BPMS":case"STOPS":case"WARPS":case"DELAYS":case"SCROLLS":case"TICKCOUNTS":case"FAKES":h={type:t,beat:parseFloat(a[0]),value:parseFloat(a[1])};break;case"LABELS":h={type:t,beat:parseFloat(a[0]),value:a[1]};break;case"SPEEDS":h={type:t,beat:parseFloat(a[0]),value:parseFloat(a[1]),delay:parseFloat(a[2]),unit:a[3]=="0"?"B":"T"};break;case"TIMESIGNATURES":h={type:t,beat:parseFloat(a[0]),upper:parseInt(a[1]),lower:parseInt(a[2])};break;case"COMBOS":h={type:t,beat:parseFloat(a[0]),hitMult:parseInt(a[1]),missMult:parseInt(a[2]??a[1])};break;case"BGCHANGES":case"FGCHANGES":h={type:t,beat:parseFloat(a[0]),file:a[1],updateRate:parseFloat(a[2]),crossFade:a[3]=="1",stretchRewind:a[4]=="1",stretchNoLoop:a[5]=="1",effect:a[6],file2:a[7],transition:a[8],color1:a[9],color2:a[10]}}this._insert(t,h,!1)}}_insert(t,e,r){this.binsert(t,e),(r??!0)&&this.reloadCache(t)}delete(t,e,r){const n=t?this:this._fallback;if(!n.events[e])return;r=ve(r,3);const s=n.bindex(e,{type:e,beat:r,second:r});if(s==-1||s==0&&e=="BPMS")return;const a=n.events[e][s];Ji.instance.run({action:()=>{n._delete(!0,a),n.reloadCache(e),this!=n&&this.reloadCache(e),Ee.emit("timingModified")},undo:()=>{n._insert(a.type,a),n.reloadCache(e),this!=n&&this.reloadCache(e),Ee.emit("timingModified")}})}_delete(t,e,r){if(!t){this._fallback._delete(!0,e,r),(r??!0)&&this.reloadCache(e.type);return}if(!this.events[e.type])return;const n=this.bindex(e.type,e);n>-1&&(this.events[e.type].splice(n,1),(r??!0)&&this.reloadCache(e.type))}isDuplicate(t,e){if(["STOPS","WARPS","DELAYS","FAKES","BGCHANGES","FGCHANGES"].includes(t.type)||e.type!=t.type)return!1;switch(t.type){case"BPMS":case"SCROLLS":case"TICKCOUNTS":case"LABELS":case"SPEEDS":return e.type==t.type&&t.value==e.value;case"TIMESIGNATURES":return e.type==t.type&&t.upper==e.upper&&t.lower==e.lower;case"COMBOS":return e.type==t.type&&t.hitMult==e.hitMult&&t.missMult==e.missMult;default:return!1}}insert(t,e,r,n){const s=t?this:this._fallback;if(e=="OFFSET"){s.offset=r,this.reloadCache("OFFSET");return}s.events[e]||(t?s.events[e]=JSON.parse(JSON.stringify(this._fallback.events[e])):s.events[e]=[]),n=ve(n,3);const a=s.getTimingEventAtBeat(e,n),h={type:e,beat:n},u=[],d=[];if(a?.beat==n){if(Object.keys(r).length==0){u.push(a),Ji.instance.run({action:()=>{for(const p of u)this._delete(t,p);for(const p of d)s._insert(e,p)},undo:()=>{for(const p of d)s._insert(e,p);for(const p of u)this._delete(t,p)}});return}const f=s.getTimingEventAtBeat(e,n-.001);if(f==a)return;Object.assign(h,r),u.push(a),(!f||!this.isDuplicate(f,h))&&d.push(h)}else{if(Object.keys(r).length==0)return;Object.assign(h,r),d.push(h)}const m=this.getTimingData("BPMS"),l=m[s.searchCache(m,"beat",n)+1];l&&this.isDuplicate(h,l)&&u.push(l),console.log(d,u),Ji.instance.run({action:()=>{for(const f of u)this._delete(t,f);for(const f of d)s._insert(e,f);this.reloadCache(e),Ee.emit("timingModified"),Ee.emit("chartModified")},undo:()=>{for(const f of d)this._delete(t,f);for(const f of u)s._insert(e,f);this.reloadCache(e),Ee.emit("timingModified"),Ee.emit("chartModified")}})}buildBeatTimingDataCache(){const t=[];let e=this.getTimingData("BPMS","STOPS","WARPS","DELAYS");e=e.concat(this.getTimingData("WARPS").map(s=>({type:"WARP_DEST",beat:s.beat+s.value,value:s.value})));const r=["WARP_DEST","BPMS","STOPS","WARPS","DELAYS"];e.sort((s,a)=>s.beat==a.beat?r.indexOf(s.type)-r.indexOf(a.type):s.beat-a.beat);const n=this.getTimingData("OFFSET");t.push({beat:0,secondBefore:-n,secondOf:-n,secondAfter:-n,secondClamp:-n,bpm:this.getTimingData("BPMS")[0]?.value??120,warped:!1});for(const s of e){if(t.at(-1)?.beat!=s.beat){t.at(-1).secondClamp=Math.max(Math.max(t.at(-2)?.secondClamp??-n,t.at(-2)?.secondAfter??-n),t.at(-1).secondBefore);let a=(s.beat-t.at(-1).beat)*60/t.at(-1).bpm;t.at(-1).warped&&(a=0),t.push({beat:s.beat,secondBefore:t.at(-1).secondAfter+a,secondOf:t.at(-1).secondAfter+a,secondAfter:t.at(-1).secondAfter+a,secondClamp:0,bpm:t.at(-1).bpm,warped:t.at(-1).warped})}s.type=="WARPS"&&(t.at(-1).warped=!0),s.type=="WARP_DEST"&&(t.at(-1).warped=!1),s.type=="BPMS"&&(t.at(-1).bpm=s.value),s.type=="STOPS"&&(t.at(-1).secondAfter+=s.value),s.type=="DELAYS"&&(t.at(-1).secondOf+=s.value,t.at(-1).secondAfter+=s.value)}t.at(-1).secondClamp=Math.max(t.at(-2)?.secondClamp??-n,t.at(-1).secondBefore),this._cache.beatTiming=t,this._cache.warpedBeats={}}buildEffectiveBeatTimingDataCache(){const t=this.getTimingData("SCROLLS");let e=0;if(t.length==0){this._cache.effectiveBeatTiming=[];return}e=t[0].beat;for(let r=0;r<t.length-1;r++){const n=t[r],s=t[r+1].beat-n.beat;n.effectiveBeat=e,e+=n.value*s}t[t.length-1].effectiveBeat=e,this._cache.effectiveBeatTiming=t}buildSpeedsTimingDataCache(){const t=this.getTimingData("SPEEDS").map(e=>({type:e.type,beat:e.beat,value:e.value,delay:e.delay,unit:e.unit,second:this.getSeconds(e.beat)}));this._cache.speeds=t}buildTimingDataCache(){Sc.forEach(t=>{this._cache.events[t]=this.events[t]??this._fallback?.events[t]??[]}),this._cache.sortedEvents=Sc.map(t=>this._cache.events[t]).flat().sort((t,e)=>t.beat-e.beat);for(const t of this._cache.sortedEvents)t.type=="DELAYS"?t.second=this.getSeconds(t.beat,"before"):t.second=this.getSeconds(t.beat),t.type=="ATTACKS"&&(t.beat=this.getBeat(t.second))}searchCache(t,e,r){return en(t,r,n=>n[e])}getBeat(t){if(!isFinite(t))return 0;if(this._cache.beatTiming==null&&this.buildBeatTimingDataCache(),t+this.getTimingData("OFFSET")<0)return(t+this.getTimingData("OFFSET"))*this._cache.beatTiming[0].bpm/60;const e=this._cache.beatTiming,r=this.searchCache(e,"secondClamp",t),n=e[r],s=Math.max(0,t-n.secondAfter);return n.beat+s*n.bpm/60}getSeconds(t,e){if(e||(e=""),!isFinite(t))return 0;this._cache.beatTiming==null&&this.buildBeatTimingDataCache();const r=Math.floor(t*1e3)/1e3;if(t<=0){const d=this._cache.beatTiming[0].bpm;return-this.getTimingData("OFFSET")+t*60/d}const n=this._cache.beatTiming,s=this.searchCache(n,"beat",r),a=n[s];if(a.beat==r){if(e=="noclamp"||e=="")return a.secondOf;if(e=="before")return a.secondBefore;if(e=="after")return a.secondAfter}let u=(t-a.beat)*60/a.bpm;return a.warped&&(u=0),e=="noclamp"?a.secondAfter+u:Math.max(a.secondClamp,a.secondAfter+u)}isBeatWarped(t){if(!isFinite(t))return!1;const e=Math.floor(t*1e3)/1e3;if(this._cache.warpedBeats[e])return this._cache.warpedBeats[e];this._cache.beatTiming==null&&this.buildBeatTimingDataCache();const r=this._cache.beatTiming,n=this.searchCache(r,"beat",e),s=r[n],a=s.beat==e?s.secondClamp:Math.max(s.secondAfter,s.secondClamp);return s.warped&&s.beat!=t||this.getSeconds(t,"noclamp")<a?(this._cache.warpedBeats[e]=!0,!0):(this._cache.warpedBeats[e]=!1,!1)}isBeatFaked(t){if(!isFinite(t))return!1;const e=Math.floor(t*1e3)/1e3;if(this.isBeatWarped(e))return!0;const r=this.getTimingData("FAKES");if(r==null)return!1;for(const n of r)if(e>=n.beat&&e<n.beat+n.value)return!0;return!1}getEffectiveBeat(t){if(!isFinite(t))return 0;this._cache.effectiveBeatTiming==null&&this.buildEffectiveBeatTimingDataCache();const e=this._cache.effectiveBeatTiming;if(e.length==0)return t;const r=this.searchCache(e,"beat",t),n=e[r];if(n.beat>t)return t;let s=n.effectiveBeat;const a=t-n.beat;return s+=a*n.value,s}getBeatFromEffectiveBeat(t){if(!isFinite(t))return 0;this._cache.effectiveBeatTiming==null&&this.buildEffectiveBeatTimingDataCache();const e=this._cache.effectiveBeatTiming;if(e.length==0)return t;let r=0;for(;e[r+1]&&(e[r].value<=0||e[r+1].effectiveBeat<=t);)r++;let s=(t-e[r].effectiveBeat)/e[r].value;return isFinite(s)||(s=0),e[r].beat+s}getSpeedMult(t,e){if(!isFinite(t)||!isFinite(e))return 0;this._cache.speeds==null&&this.buildSpeedsTimingDataCache();const r=this._cache.speeds;if(r.length==0)return 1;const n=this.searchCache(r,"beat",t),s=r[n];if(s==null)return 1;let a=t-s.beat;s.unit=="T"&&(a=e-s.second);let h=yr(a/s.delay,0,1);s.delay==0&&(h=1);const u=r[n-1]?.value??1;return h*(s.value-u)+u}getBPM(t){return this.getBPMEvent(t)?.value??120}getBPMEvent(t){if(!isFinite(t))return;this._cache.beatTiming==null&&this.buildBeatTimingDataCache();const e=this.getTimingData("BPMS");if(e.length!=0)return e[this.searchCache(e,"beat",t)]}getTimingEventAtBeat(t,e){const r=this.getTimingData(t);if(!Array.isArray(r))return;const n=r[this.searchCache(r,"beat",e)];if(!(n?.beat&&n.beat>e))return n}reloadCache(t){this.buildTimingDataCache(),(t==null||t=="OFFSET"||["WARPS","STOPS","DELAYS","BPMS"].includes(t))&&this.buildBeatTimingDataCache(),(t==null||t=="SCROLLS")&&this.buildEffectiveBeatTimingDataCache(),(t==null||t=="SPEEDS")&&this.buildSpeedsTimingDataCache(),this._chart?.recalculateNotes()}binsert(t,e){let r="beat";const n=this.events[t];t=="ATTACKS"&&(r="second");let s=0,a=n.length;for(;s<a;){const h=s+a>>>1;n[h][r]<e[r]?s=h+1:a=h}n.splice(s,0,e)}bindex(t,e){let r="beat";const n=this.events[t];t=="ATTACKS"&&(r="second");let s=0,a=n.length;for(;s<=a&&s<n.length;){const h=s+a>>>1;if(n[h][r]==e[r])return h;n[h][r]<e[r]&&(s=h+1),n[h][r]>e[r]&&(a=h-1)}return-1}getBeatTiming(){return[...this._cache.beatTiming]}getTimingData(...t){return t.length==0?this._cache.sortedEvents:t.includes("OFFSET")?this.offset??this._fallback?.offset??0:t.length==1&&t[0]in this._cache.events?this._cache.events[t[0]]:(this._cache.sortedEvents==null&&this.buildTimingDataCache(),this._cache.sortedEvents.filter(r=>t.includes(r.type)))}isEmpty(){for(const t of Object.values(this.events))if(t)return!1;return!0}serialize(t){let e="";this.offset&&(e+="#OFFSET:"+this.offset+`;
`);let r=["BPMS","STOPS","WARPS","DELAYS","SPEEDS","SCROLLS","TICKCOUNTS","TIMESIGNATURES","LABELS","COMBOS","FAKES","BGCHANGES","FGCHANGES","ATTACKS"];t=="sm"&&(r=["BPMS","STOPS","TIMESIGNATURES","BGCHANGES","FGCHANGES","ATTACKS"]);for(const n of r)e+=this.formatProperty(t,n);return e}formatProperty(t,e){if(!this._fallback&&!this.events[e])return"";let n="";switch(e){case"ATTACKS":{n=this.getTimingData(e).map(a=>`TIME=${a.second}${a.endType}=${a.value}:MODS=${a.mods}`).join(`:
`);break}case"BGCHANGES":case"FGCHANGES":{n=this.getTimingData(e).map(a=>`${a.beat}=${a.file}=${ve(a.updateRate,3).toFixed(3)}=${Number(a.crossFade)}=${Number(a.stretchRewind)}=${Number(a.stretchNoLoop)}=${a.effect}=${a.file2}=${a.transition}=${a.color1}=${a.color2}`).join(`,
`);break}case"BPMS":case"DELAYS":case"FAKES":case"SCROLLS":case"WARPS":{n=this.getTimingData(e).map(a=>`${ve(a.beat,3).toFixed(3)}=${ve(a.value,3).toFixed(3)}`).join(`,
`);break}case"STOPS":{let s=this.getTimingData(e);if(t=="sm"){const h=this.getTimingData("WARPS").map(u=>{const d=this.getBPM(u.beat);return{type:"STOPS",beat:u.beat,value:-60/d*u.value}});s=s.concat(h)}n=s.map(a=>`${ve(a.beat,3).toFixed(3)}=${ve(a.value,3).toFixed(3)}`).join(`,
`);break}case"COMBOS":{n=this.getTimingData(e).map(a=>a.hitMult==a.missMult?`${ve(a.beat,3).toFixed(3)}=${a.hitMult}`:`${ve(a.beat,3).toFixed(3)}=${a.hitMult}=${a.missMult}`).join(`,
`);break}case"LABELS":case"TICKCOUNTS":{n=this.getTimingData(e).map(a=>`${ve(a.beat,3).toFixed(3)}=${a.value}`).join(`,
`);break}case"SPEEDS":{n=this.getTimingData(e).map(a=>`${ve(a.beat,3).toFixed(3)}=${ve(a.value,3).toFixed(3)}=${ve(a.delay,3).toFixed(3)}=${a.unit=="B"?0:1}`).join(`,
`);break}case"TIMESIGNATURES":{n=this.getTimingData(e).map(a=>`${ve(a.beat,3).toFixed(3)}=${a.upper}=${a.lower}`).join(`,
`);break}}return n.includes(",")&&(n+=`
`),"#"+e+":"+n+`;
`}}class w_{constructor(t,e){L(this,"gameType",Si.getPriority()[0]);L(this,"description","");L(this,"difficulty","Beginner");L(this,"meter",1);L(this,"meterF",1);L(this,"radarValues","0,0,0,0,0");L(this,"chartName","");L(this,"chartStyle","");L(this,"credit","");L(this,"music");L(this,"timingData");L(this,"sm");L(this,"other_properties",{});L(this,"notedata",[]);L(this,"_notedataStats");if(this.timingData=new v_(t.timingData,this),this.sm=t,!e){this.recalculateStats();return}if(t._type=="ssc"){const r=e;for(const s in r)(s=="OFFSET"||Sc.includes(s))&&this.timingData.parse(s,r[s]);this.timingData.reloadCache();const n=Si.getGameType(r.STEPSTYPE);if(!n)throw Error("Unknown step type "+r.STEPSTYPE);if(this.gameType=n,this.description=r.DESCRIPTION??"",rn.includes(r.DIFFICULTY))this.difficulty=r.DIFFICULTY;else throw Error("Unknown chart difficulty "+r.DIFFICULTY);this.meter=parseInt(r.METER),(!isFinite(this.meter)||this.meter<0)&&(this.meter=0),this.meterF=parseFloat(r.METERF),(!isFinite(this.meterF)||this.meterF<0)&&(this.meterF=this.meter),this.radarValues=r.RADARVALUES??"",this.notedata=n.parser.fromString(r.NOTES).map(s=>this.computeNote(s))??[],this.credit=r.CREDIT??"",this.chartName=r.CHARTNAME??"",this.chartStyle=r.CHARTSTYLE??"",this.music=r.MUSIC;for(const s in r)["STEPSTYPE","DESCRIPTION","DIFFICULTY","METER","METERF","RADARVALUES","CREDIT","CHARTNAME","CHARTSTYLE","MUSIC","NOTES","NOTEDATA"].includes(s)||(this.other_properties[s]=r[s])}else{const r=/([\w\d-]+):[\s ]*([^:]*):[\s ]*([\w\d]+):[\s ]*([\d]+):[\s ]*([\d.,]*):[\s ]*([\w\d\s, ]*)/g.exec(e.trim());if(r!=null){const n=Si.getGameType(r[1]);if(!n)throw Error("Unknown step type "+r[1]);if(this.gameType=n,this.description=r[2]??"",rn.includes(r[3]))this.difficulty=r[3];else throw Error("Unknown chart difficulty "+r[3]);this.meter=parseInt(r[4]),(!isFinite(this.meter)||this.meter<0)&&(this.meter=0),this.meterF=this.meter,this.radarValues=r[5]??"",this.notedata=n.parser.fromString(r[6]).map(s=>this.computeNote(s))??[]}else throw Error("Failed to load sm chart!")}this.recalculateStats()}getNotedataStats(){return this._notedataStats}getSeconds(t,e){return this.timingData.getSeconds(t,e)}getBeat(t){return this.timingData.getBeat(t)}getBeatFromEffectiveBeat(t){return this.timingData.getBeatFromEffectiveBeat(t)}isBeatWarped(t){return this.timingData.isBeatWarped(t)}isBeatFaked(t){return this.timingData.isBeatFaked(t)}getNoteIndex(t){if(this.notedata.includes(t))return this.notedata.indexOf(t);for(let e=0;e<this.notedata.length;e++){const r=this.notedata[e];if(r.beat==t.beat&&r.col==t.col&&r.type==t.type)return e}return-1}addNote(t){t.beat=Math.round(t.beat*48)/48,ke(t)&&(t.hold=Math.round(t.hold*48)/48);const e=this.computeNote(t);let r=en(this.notedata,t.beat,n=>n.beat)+1;return r>=1&&this.notedata[r-1].beat>t.beat&&r--,this.notedata.splice(r,0,e),Ee.emit("chartModified"),e}addNotes(t){const e=t.map(r=>{r.beat=Math.round(r.beat*48)/48,ke(r)&&(r.hold=Math.round(r.hold*48)/48);const n=this.computeNote(r);let s=en(this.notedata,r.beat,a=>a.beat)+1;return s>=1&&this.notedata[s-1].beat>r.beat&&s--,this.notedata.splice(s,0,n),n});return Ee.emit("chartModified"),e}computeNote(t){return Object.assign(t,{warped:this.timingData.isBeatWarped(t.beat),fake:t.type=="Fake"||this.timingData.isBeatFaked(t.beat),second:this.timingData.getSeconds(t.beat)})}modifyNote(t,e){const r=this.getNoteIndex(t);if(r==-1)return;const n=Object.assign({},this.notedata[r]);this.notedata.splice(r,1),Object.assign(n,e),this.addNote(n),Ee.emit("chartModified")}removeNote(t){const e=this.getNoteIndex(t);if(e==-1)return;const r=this.notedata.splice(e,1);return Ee.emit("chartModified"),r[0]}removeNotes(t){const e=t.map(r=>{const n=this.getNoteIndex(r);return n==-1?void 0:this.notedata.splice(n,1)[0]}).filter(r=>r!=null);return Ee.emit("chartModified"),e}setNotedata(t){this.notedata=t,Ee.emit("chartModified")}recalculateNotes(){this.notedata=this.notedata.map(t=>this.computeNote(t))}recalculateStats(){this._notedataStats=this.gameType.parser.getStats(this.notedata,this.timingData)}getMusicPath(){return this.music??this.sm.properties.MUSIC??""}toString(){return this.difficulty+" "+this.meter}serialize(t){let e="//---------------"+this.gameType.id+" - "+this.description+`---------------
`;if(t=="sm")e+=`#NOTES:
`,e+=`     ${this.gameType.id}:
`,e+=`     ${this.description}:
`,e+=`     ${this.difficulty}:
`,e+=`     ${this.meter}:
`,e+=`     ${this.radarValues}:
`;else{e+=`#NOTEDATA:;
`,e+=`#CHARTNAME:${this.chartName};
`,e+=`#CHARTSTYLE:${this.chartStyle};
`,e+=`#CREDIT:${this.credit};
`,this.music&&(e+=`#MUSIC:${this.music};
`),e+=`#STEPSTYPE:${this.gameType.id};
`,e+=`#DESCRIPTION:${this.description};
`,e+=`#DIFFICULTY:${this.difficulty};
`,e+=`#METER:${this.meter};
`,e+=`#METERF:${this.meterF};
`,e+=`#RADARVALUES:${this.radarValues};
`;for(const r in this.other_properties)e+=`#${r}:${this.other_properties[r]};
`;e+=`#NOTES:
`}return e+=this.gameType.parser.serialize(this.notedata,this.gameType)+`;
`,e}}var nr=(i=>(i.SELECT_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAArUlEQVR4nO3YQQ6CQBBE0X8PXKrn9DqGcDNNZC5QhGR2agQk6Z5QL+l9FwULGszMzN6dgB4ogFbOjQTLPzcsniZE/+fy4SHKTgHCQijZFGAALq0GUJ35u+xaDiDg3nqA15YA0bR2HwfYmdxAMLmBYHIDweQGgskNBJMbCCY3EExuIJgO18DY+k/9kGBRfZn57PnTFXgkWFYfDltnFurqESnD6zTWJ794eTMzO44JY84XrlhT/UgAAAAASUVORK5CYII=",i.REVERT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAACY0lEQVR4nO2aTUhVQRiGn1pYSVqLBM0WbQpNuLcoRIhS3AVFEEWLtiEKRRAUghAXidyoRNAf7XPhwqSfRW2jRVw0cpVCBJrR36KIfggqDswFGQY7Z+65986Zbx74tud+73PnnDNnZiAQCAQCgYAFm4BuYCMC2QO8B/4CS8BWBLEb+KTCl+ocQsgbwkc1hJDwHw3hRQjIrxLeewH5/4T3WkAuRnhvBeRihvdSQC5BeO8EtAPvEoT3SkC7RXhvBHQAHyzCR/UWKFahngJTwE01++wBNqQloGgZvtb1HXgInATqyhHw2YEw5dYycMZWxJADAdKqOWCfjYRRyx+8DeytQu0Hjqp/+Q4wv0pPv4DT1ZJQoHa0qZ6/pvmGGsuQgBJb1Kj4Y+jvbKUlFHCHE8BPrb/f6pWZmCsZFIAK+0Xr8Q3QUKmRUMA9jhhuh8u2FxvLoICIa1qf34CmSkgo4Cbr1eRoZa+D5VxwPGMCIi4aJkmkLeES7tKohn6p1+i50Jy2hMO4zSOt31NpXHQAmAb6cZ/zmoAbCKNHE3APYezSBDxDGE2agAWEsV0T8AJhdGoCHiOM45qAuwjjuiZgGGG80gQcQhBdhmX0egTxQBMwiSAOGhZFehHCZrUMtjL8c2ANAqgD7mvho5FwAAE0AE8MaxbRq9B7OoBZQ/himrvILtICXDXsB5Q+fFrxjLXATrX3N602PkxrlS+BbTjMOmBEfZ/HPSQRzep+xNirmMjCQe7BGEGS1mvgGBnhVorBZ4C+ck+J1OLkue3JlEV1NOaCevpnlsaEhyR2ZOHeDgQCgUAA9/kHkepiJFq7BJgAAAAASUVORK5CYII=",i.ADD_FOLDER="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAvUlEQVRIie2UTQ7CIBBGnz8rb+Mt2hqv4TGMmt4Kexl7gUa3TXBRTAALQqGJJr5kNpR+r8ykwJ9vogJaQDrqlCrwhWeRfAoPrRYo5xRI4OYTpGLkLDMEevl9wXqGzC2wH3uQa8gGOVpUAALoVAmGW+GNKSc44v4XLqmCwgpcqfVeWzNOEisQAYJGfyHkspPARu3vrGCbHrjrQz4oSSiLiL2TuBLZoljKAMEuRQBwxj2rOjX8RcXQioeqBu3Ln4QChU8M4+FlAAAAAElFTkSuQmCC",i.CHEVRON="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAbklEQVRIie2PMQqAMAxFXwfP6qJVPIjYzcOKdUkhQ0BaCoLkLS3k818CjuN8ztApYzIDl7xvmalFsAIZuIFozKPMMrC0CAJwKIkuGVX5KdkmLEm3ci1JSlLKU49yLSmXVG1es0EANvnvInKcP/AA784fpjlWwNQAAAAASUVORK5CYII=",i.EDIT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAABqUlEQVRIia3VO2hUQRTG8d+GEC0sRMVKU4naKAQrESEoWBiwshALtREsLQQRGytNt2CvaCPiI52NaK92NlG0kFXw1fgIanztWsy57ma5l52b3APDcGfO+X+z5357h2ZiD9oYa4i3JPZjAT1cbVrkCH4F/HfMV5oSOYW/AZ3FXg3+krMB6uL0wPqKRVrSy+xJrTlakrNPv13tOvBxXI/C75ipyDsXOT8wnQtfhTtRuCA5pyyOSW37g8O58DW4H/APmKrIOyS1pouTufB1eBTwDrZW5E1LLenhfC58Es+j6BM2V+RN4UvkXc6Fb8frKHqr2hFb8D72b8i05S58jKKH0ju4NCDSiryNeBHrDyQjjIwd+BpF85gY2Cv838ZaPI3nx3GIrJiNomJcGNovRN7F/AwbcuFwcUhgWGQCr2L9jWSE7GjhZYlA8TFr4Vo8f8bOOnDSv7MMXownMX/D7rpwuDlCoPjAHVwOfD0WR8C7OFEXPB7zceU+7uBuHOA27tUVKGJe/6Q/cQsHNHD1jUnuWJQ8fQabpItkNeb079zljiWxTfJ9Z4XQ/+MfA5yyJxzqcDgAAAAASUVORK5CYII=",i.ADD_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAABiElEQVRoge2YMU7DMBSGvwQJVO7CwN1YYEFUMAMdYCpHYUMcgg49A3SgEggGE2GskNh5frYr+ZOsppWS93+q9WIbKpWKD4fAHFgBH8BX4NgCt0CbOjiY8M8BYYfGkgwS8wjBs0qsrOKnwH7g/dkl7DkfGh4K+CfsotL7lz3f1SViCjTAnfPbA8oSMQUgg0RsAUgsoSEACSW0BCCRhFRgrA23KHcnqYD9Ijwjg4RU4MJ5RshYSIJ3SAVmwNM/AcfGuyR4h1QAjMQ58EL4cnyQxqO4279T4F0zywYjJlUgN1VgF4jRRkM5Ag5+PgcptY16U+IUajFLiA2RzpJSTqEGuHdqipfXqQT6wkeRSCEwFF4soS3gE14koS2wcGr0bWxEewRtgTf+hm2dmu5u7TW0gLbAFaZl3vA7PdyaLaalboBL++ZSX2R1P7Az+Ah8WtdTjtdV8RFYW9cnFCgxhuRcJ3R0RO18knOdIgQ6iannOkUIpGaLCT96Mrenn2USM+AYuAYeM2epDPINL56D04/lX9sAAAAASUVORK5CYII=",i.MENU_VERTICAL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+ElEQVR4nO3XS04CQRSF4X+kYx8h0UWIM5vFoIxVdkCgmbMDlSWBsAchLMLWVHI76ZC2pnLgfMlNOqlJn1TdeoCZmZnZSbqNknUPrICfqCXQRcw1sG2EqGsHdBAybAlR1wtCZpkgaUzGUyZIHyFne43ebPg0JuUSeAe+ot6Ai//+KTsWPaCMKhBVAlWj0dP3GMGZqFp2rUptZqaZcyTNlIwyE2SCkOKPpfUNPCBmvBcmhRghqohlNlGcCTtUV8Ac2ER9xEVSyjmwbtm1PtWu8YPMOfKIkNmxPHVfM0GeEWv0bUuIjWLDd+ONXodYAHcIu4kyMzMzOzW/IiF2pLfCTcAAAAAASUVORK5CYII=",i.COPY="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVR4nO2YQUoDQRBFHwiDB5AsXCSexYxeIVfwCDlE1hoXuUBuodl4CDGOgSyySrIKGGgZ6EAxTBZOVzc21oPe9OJX/eqqgSkwDMPIiT4wBhbAGjgCTuFsgBnQi5X4JTABDkoJnzvvwJV28nVV3iIn7sSZa1e+mfwrMAKugQv+OBOR+DfwQGYDexAGZPI3wDOwUhxk58/R606BQYiBsRB9Eff3wD7RPOyAsquBhRAaicqnSt4JE3U3/Jq1EKkHFt82p7sP4BYo0KUAhsBSxHrqIiR7+/S1WYm7OvmYDEWsqouAfMY2U9qVb1I0BlvFQNtdTFxIPDOggLMXwGYgCGcthLVQEM5aCGuhIJy1ENZCQbh/3UKb3A3McjfQ87vKbA3gF63zXP+J2/hKuJUoRaxPLdGpEF36IDH2QneNvdCjlvjAb8pSbua2XTdz5ygTmtj6BZc6ff+sVaTtdOX1VStvGIaBOj8GcNhDDTqXrgAAAABJRU5ErkJggg==",i.TRASH="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAABdElEQVRoge2YsU7DMBRFDwxlgb0wlB9BLMDXtFvhE2BAogNDxR+1S+ETEBJiLqVSU6lVGOwoJsQhDnEc0DvSU63c+OXeuElVgyAIddMBBsAUWOqaAH2ttZoj4AmILfWoz2kleyiDNvNJzWjpSgxITUbAEDjUdamPJXo/kMdCpqQGhzn6laFPGvRVmg9Sg90cvWvoiyYM3QArfv5O+64VcG0zuVNwfAHsu+f2whI4yBN2LRNi4B714IUmQnnJxbYCecQV57ngfA3bCvwZJEBoJECGO9R7+9ZRawTzx8XGWutrR83lGl+o+zVadM5v5+ciz0BoJEBoJEBoJEBoJEBoJEBoJECGKPNZVqtM3QFGqD2ckaNWGdlWCY1LgK0x9rG/b/bcWs/K4BLgzRifOMwry6kxfvXQnwfSP9zPwDn1rEQHuNA9k/7jGvp+4xh4x21rvErNgZ6PAKDuus8Qc+DMl/mEHmqJX4BNDaY3utcYj3deEP4rn4hExm+tmh+HAAAAAElFTkSuQmCC",i.IMAGE_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAB8UlEQVRYhd3WTYjNURjH8c9IozRlwUITTbMRNlNWxksWjKxkYbJQY6mUTCKxmDSkZiezm421KQsRFkgpL7Eg2Si3RJOFl5SIzVicc5t7p/9xz//O/5r41el2nnOe83zv8/zPC4usrgLbBPrbXO8DTuHHQgBm8QjvSwZfg0HcxV58L+nfBDDcht9w9P2IO1ie47SkjUCttBMDuIWexQB4gV3YiJutIDoB0AixoRVEpwCyIaoE+BV/Zxvac6zCdlwoclpaIcBt7EN3wdhxrO40wE9cS4wlt3Unv4EslQE4g5nYTlcFkFuCAxjH2dg/hzeY/lsAQ7iH87G/A7sbAPqFe6VWFiC3BDXheF0v7OsBIQOwEvdxpWzwlIouox48Mbe/H0dbF67jU7RvSaw5LVGu3Ax8w9aGti3aTmCPcP0+xdHM9f6o1HXcHQPXoQeF0+9k7I/Efm+BbzIDZQDG4tjLGOwtbph71CwTXkTjZQByS7ACo5jCK1yOgQ9FKMJJOIXDEaZtFWVgDF8iCKxDX4Fvr1CGkXn2BWWg/u8v4mu0vRZKMF8zuIpjGetmA4zGeZcy15zEJukt2aSck/CIkIXPmQB1HcTDKgD2S9zlLfQsZ1IOwIM2gmfrn3oP/J8AqW9gc8Vx1uJd7uSa5qd1VW2iKNhvOK12/OBuEgoAAAAASUVORK5CYII=",i.AUDIO_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAADFElEQVRoge2ZzWsTQQDFf200qVrBUBAURU/aVgTFSvUoXsQqgoIUFDx68SKieBILeujJFhH/AD0VRBD8REHBD/zCIqUm6kG0UqltE0FFqqkedif7Nuymm2bTbWUfLLy8+dj3kpndmQnEiBEjxv+KDuAx8BroBlLR2qkMx4BJ4K9c5yN1FBD1QA9u4+bKVdjXPOA6kAf2h+jRFymgD7fp+yWfK0GztPsKNIbm1ANp4AFus31YoaYbIAG8l7YnwzJbiuVAP26jvVjDCaYfAOCQtB0FFldrthTrgSG5ySTWBFYEDbAHa7zfBBpsLQFkpf2JUFzb2Gbf0HT+C+j0qBc0wFWpd1j0g6K/qc6yg04sw6bjPFYgLwQNcETqZXGGYAoYk7JN5TpZAHRhTZ4/JTf3u4awhpIfggZYhDXOTd1dUnZR9HPlzD8MaNpcA8DKKYxVMonPSN3Lom8V/aNf464KjBewXjLpAKa8AqSAO8AXYIfoLVI3DyRtvQ4YlrIVXjfSZ+5xYH4Ac0HgFaBNtIxt0GBAyraLrpN8rxHrpcJq4b3A7+q9+2IQ+GHztcAWKbstXCfsE+HthmiAhPCJKg1OhZ/ANfm8U/hL4RuFPxfeYogGmGlcEd4uvF/4GuHDwpsMiTKAvpTU6IhwfUiMCm/CA9WsWcrBr99G0b+JnsDZS+RK9IKtF0NG+Qso6ny435dZ1KMMsEr4uPAlOCHyoqdx/BbrRxmgWXhW+FLhOoR03M+KAPuEPxW+Qfhb4cuEjxmiAQrCk9QWC4Hd8vmGcH15vRK+WfigIRrgg/Cj1DZEK84eN4P7F9C10Qvh+rZ+5tXpaWZuMZcE7mI9DvUt3Cp1c7i/xM9S5rmYmw3L6bNS95Lo7aJ/KtdBA3AKeEc0GxrdeXVI2QXRfTc0laDWW8oMzvxM4t6ptVVjXDFTm/oDooe2qTcI+1glB9zCfaySkfahHqsYzOmDLYM5fbRoEPbh7jppN0KND3cNyh2vj5dp54UkcA/4jvfDoabw+oOjZ5p9Rbbg7AAeYT1Fuqn9AjFGjBgxIsA/jvJ6jenUZ2YAAAAASUVORK5CYII=",i.SM_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAcpJREFUeF7tmFGOwkAMQ+H+h95V2S2qqlKcsZ101PADQpPEfnFHgufj5q/nzf0/GkAn4OYE+hG4eQD6EuxHIOER+CFnWJdkbf5vfAEwOoephbiPCoOaN4A/AswWmVpoSZ0ACBN3iNkiUwup7gRAmLhDzBaZWkh1JwDCxB1itsjUQqo7ARAm7hCzRaYWUq1KwJlQxoSr7xuOAsD2x85RPweAbzOh7S+HWACrkKXP9vNWgBoAMjMFwJHhT9+Ngt7DQ2faAXza9vrjZ5suVQIiM60AzoSsg/cxZRMQnWkDgAjZQ2DumuhlF9H30hnZTLj5ycWIbsg+EwUwIgQ16TgH60UAwM0cToiekG4EwNHNTuhKKYXMZ9wBKW53Q2DzUQAzJCFkfgTAlSGEzY8CuCKEIfMMgCtBGDbPArgCBMq8AkAlBNq8CkAFBIl5JYBMCDLzagAZEKTmHQCcEOTmXQAcECzmnQCUEGzm3QAUEKzmMwAwEOzmswCMQEgxnwkgAiHNfDYABEKq+QoAZxDSzVcBOIJQYr4SwBbC8rlMC/qv8CpS/V62+VLqaopMv+oEMNoltQ1AgnHiJp2AiZcnkd4JkGCcuEknYOLlSaT/AqRIb0Fn6qw5AAAAAElFTkSuQmCC",i.UNKNOWN_FILE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QA/wD/AP+gvaeTAAAA+UlEQVR4nO2awQqCQBgGv6KeM+rU+1/L7F4RreY/W86ABw/ujsMPImwiIiLSwlh0XZIcit6piaoAY5JbknPNa31OZYAuI1QH6C7Co9zS63cXgQrQTYTqAMOL+9MC+35MdYBjniOgk1AdIOksAhEg6SgCFSDpJAIZIOkgAvkZfHcNmfDvsJkoOHeNlvVbuCbZtzzwbwGSRp/tzM1+nh0t8ILWiZo1MaufAAPQAjQGoAVoDEAL0BiAFqAxAC1AYwBagMYAtACNAWgBGgPQAjQGoAVoDEAL0BiAFqAxAC1AYwBagMYAtADNN84HLHFOqIzVT4ABaAERERGOO8QV911rDPw7AAAAAElFTkSuQmCC",i.MINIMIZE_WINDOW="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAANtJREFUaEPtlbsNwlAQBMcRLQC10QZEiAAi0wa0xqcMdIiICGmejZ60znfPN3OWBzp/hs7fnyzwb4MxEAOSQE5IAtTxGNAIZUEMSIA6HgMaoSyIAQlQx2NAI5QFMSAB6ngMaISyIAYkQB2PAY1QFsSABKjjMaARyoIYkAB1PAY0QlkQAxKgjseARigLysACOAEbYCX75oo/gCuwrwXOwHauyY3njLVAbbNsXDxX3bMWuHd0Ot9gbrXACOzmQtZ4zvuE6iM+fj7ideMBU9XV1VyAQ/4DUyH+tbd7Ay+Srg0YYU5a1gAAAABJRU5ErkJggg==",i.CLOSE_WINDOW="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAA35JREFUaEPtmbfrFUEQxz+/0pwwFNoqmMCcc46olY1/m7U2Ys45IWIuDFiJCYyYC0X5ypwcx93t7O57yIO37c3Ofr8zszvhBujxNdDj+OkT+N8e7HugVzywGtgLPAB2A1+6BHw4sB+YBuwBLoTO8YTQMuAYMNSUXQM2AZ9CyiO/jwBOAAtt3zdgG3CuTU+IwFLgeAl8oesWsA74EAmySVzgTwILKgJBEm0ElpvlhzScegPYCHzMJDEKOAXMbdDzFdgMXKr73kbgFTAhAO4msCHDE6OB08DswDkvgImxBK4ASxzWVTitB947ZMsiYwz8LMc+XeZVsQRGmmvnOQ64a3firUNWIgobWX6OQ/6O6X4XS0DyIqHLNd9x0D076E1AdixwBpjp0HnbdDZ6N/QK6YymF6Lu/IfAGkD3p26NM/AzHOBdoekhUJAov9Ft5z8ClPiqJAT+LDDdAd6da7wEdKaypEgscgB4bCRemux4A68MG1pu8FIUQ0DyyglHgJUhFMATI/HTsulUx56rluU/O2T/isQS0J5hluCUpUNLJLQmhwSBi8AWQInLvVIISPlg4LBZ2H1Yi+Bly7bRRWIqgYLEIXt1ckioRJDlo8GnhlAZrDxxEFibyEA10A7ge+L+pDtQPWuQkVB1GrOUIHfmgO+EBwrAInHACjsPCZXou4AfHuE2mZw7UNYbk621TyWCwi67n+gEASU4hUPRSXmN2pGmKJdAKviCZDaJHALKyuqV1bnlrOvW2SX12KkEOgW+IJ5MIoWASgkVdYsdZlfLqeVpilTEqcd210Epz6gsfxRY4QCvTkovza+GiUOdimgSMR6IqUQL8EUnpWdWWdfT2UWR8BKIAa/+WJav9rBdIeEhoHpHYePpAZrAF+ESQ8LVG4QICLwamNqRRiWIQ+AL8ZhpR5BEG4EY8JpIqJmvHX3U3NaOkWgjoFpfw9XQ8lq+qsc7ldM+NU/b64C0EXgGTAqgj7V8HQnNiELTuedNWNoIKO4V/wqluiXwem2807gmW8gTbSQ0od4KnI/1gOSr/wYKHfct5nPBly+2Ro3VCbU6NYWx5km1K/QKaVN1zK7BlbzzOnQ5Ir/rYpdJCLziXt5pXB4C2qxQ2Qc8NXeG5p+R2P+Ja2Ktx2OK/cpqBa9dXgKF7O9UZN3aF0OgWxiy9PYJZJmvA5v7HuiAEbNU/AEymbExfA8cowAAAABJRU5ErkJggg==",i))(nr||{});let c0=i=>typeof i=="object"&&i!=null&&i.nodeType===1,u0=(i,t)=>(!t||i!=="hidden")&&i!=="visible"&&i!=="clip",Dd=(i,t)=>{if(i.clientHeight<i.scrollHeight||i.clientWidth<i.scrollWidth){let e=getComputedStyle(i,null);return u0(e.overflowY,t)||u0(e.overflowX,t)||(r=>{let n=(s=>{if(!s.ownerDocument||!s.ownerDocument.defaultView)return null;try{return s.ownerDocument.defaultView.frameElement}catch{return null}})(r);return!!n&&(n.clientHeight<r.scrollHeight||n.clientWidth<r.scrollWidth)})(i)}return!1},Jl=(i,t,e,r,n,s,a,h)=>s<i&&a>t||s>i&&a<t?0:s<=i&&h<=e||a>=t&&h>=e?s-i-r:a>t&&h<e||s<i&&h>e?a-t+n:0,pk=i=>{let t=i.parentElement;return t??(i.getRootNode().host||null)};var d0=(i,t)=>{var e,r,n,s,a,h;if(typeof document>"u")return[];let{scrollMode:u,block:d,inline:m,boundary:l,skipOverflowHiddenElements:f}=t,p=typeof l=="function"?l:T=>T!==l;if(!c0(i))throw new TypeError("Invalid target");let y=document.scrollingElement||document.documentElement,_=[],v=i;for(;c0(v)&&p(v);){if(v=pk(v),v===y){_.push(v);break}v!=null&&v===document.body&&Dd(v)&&!Dd(document.documentElement)||v!=null&&Dd(v,f)&&_.push(v)}let w=(r=(e=window.visualViewport)==null?void 0:e.width)!=null?r:innerWidth,C=(s=(n=window.visualViewport)==null?void 0:n.height)!=null?s:innerHeight,E=(a=window.scrollX)!=null?a:pageXOffset,k=(h=window.scrollY)!=null?h:pageYOffset,{height:G,width:Q,top:Y,right:it,bottom:J,left:st}=i.getBoundingClientRect(),gt=d==="start"||d==="nearest"?Y:d==="end"?J:Y+G/2,j=m==="center"?st+Q/2:m==="end"?it:st,Z=[];for(let T=0;T<_.length;T++){let ut=_[T],{height:Pt,width:pt,top:Gt,right:bt,bottom:xt,left:tt}=ut.getBoundingClientRect();if(u==="if-needed"&&Y>=0&&st>=0&&J<=C&&it<=w&&Y>=Gt&&J<=xt&&st>=tt&&it<=bt)return Z;let et=getComputedStyle(ut),Ht=parseInt(et.borderLeftWidth,10),Dt=parseInt(et.borderTopWidth,10),Mt=parseInt(et.borderRightWidth,10),te=parseInt(et.borderBottomWidth,10),re=0,Xt=0,qt="offsetWidth"in ut?ut.offsetWidth-ut.clientWidth-Ht-Mt:0,le="offsetHeight"in ut?ut.offsetHeight-ut.clientHeight-Dt-te:0,ne="offsetWidth"in ut?ut.offsetWidth===0?0:pt/ut.offsetWidth:0,ye="offsetHeight"in ut?ut.offsetHeight===0?0:Pt/ut.offsetHeight:0;if(y===ut)re=d==="start"?gt:d==="end"?gt-C:d==="nearest"?Jl(k,k+C,C,Dt,te,k+gt,k+gt+G,G):gt-C/2,Xt=m==="start"?j:m==="center"?j-w/2:m==="end"?j-w:Jl(E,E+w,w,Ht,Mt,E+j,E+j+Q,Q),re=Math.max(0,re+k),Xt=Math.max(0,Xt+E);else{re=d==="start"?gt-Gt-Dt:d==="end"?gt-xt+te+le:d==="nearest"?Jl(Gt,xt,Pt,Dt,te+le,gt,gt+G,G):gt-(Gt+Pt/2)+le/2,Xt=m==="start"?j-tt-Ht:m==="center"?j-(tt+pt/2)+qt/2:m==="end"?j-bt+Mt+qt:Jl(tt,bt,pt,Ht,Mt+qt,j,j+Q,Q);let{scrollLeft:fe,scrollTop:S}=ut;re=Math.max(0,Math.min(S+re/ye,ut.scrollHeight-Pt/ye+le)),Xt=Math.max(0,Math.min(fe+Xt/ne,ut.scrollWidth-pt/ne+qt)),gt+=S-re,j+=fe-Xt}Z.push({el:ut,top:re,left:Xt})}return Z};let mk=i=>i===!1?{block:"end",inline:"nearest"}:(t=>t===Object(t)&&Object.keys(t).length!==0)(i)?i:{block:"start",inline:"nearest"};function Ld(i,t){let e=i.isConnected||i.ownerDocument.documentElement.contains(i);if((a=>typeof a=="object"&&typeof a.behavior=="function")(t))return t.behavior(e?d0(i,t):[]);if(!e)return;let r=mk(t),n=d0(i,r),s="scrollBehavior"in document.body.style;n.forEach(a=>{let{el:h,top:u,left:d}=a;h.scroll&&s?h.scroll({top:u,left:d,behavior:r.behavior}):(h.scrollTop=u,h.scrollLeft=d)})}class Ls{constructor(t){L(this,"windowManager");L(this,"options");L(this,"windowElement");L(this,"viewElement");L(this,"block",t=>{!t.target||this.windowElement.contains(t.target)||(t.stopImmediatePropagation(),t.preventDefault())});L(this,"handleDrag",t=>{const e=parseInt(this.windowElement.style.left.slice(0,-2))+t.movementX,r=parseInt(this.windowElement.style.top.slice(0,-2))+t.movementY;this.windowElement.style.left=e+"px",this.windowElement.style.top=r+"px",this.clampPosition()});this.options=t;const e=document.createElement("div"),r=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div");if(e.appendChild(n),e.appendChild(r),e.style.width=t.width+"px",e.style.left=window.innerWidth/2-t.width/2+"px",e.style.top=window.innerHeight/2-t.height/2+"px",e.classList.add("unselectable","window"),r.classList.add("view"),r.style.height=t.height+"px",r.style.width=t.width+"px",n.classList.add("navbar"),n.appendChild(s),!t.disableClose){const a=document.createElement("img"),h=document.createElement("img");a.classList.add("unselectable"),a.draggable=!1,a.src=nr.MINIMIZE_WINDOW,a.onclick=()=>{r.style.height!="0px"?r.style.height="0px":r.style.height=t.height+"px",this.clampPosition()},h.classList.add("unselectable"),h.draggable=!1,h.src=nr.CLOSE_WINDOW,h.onclick=()=>this.closeWindow(),n.appendChild(a),n.appendChild(h)}s.innerText=t.title,s.classList.add("title"),e.addEventListener("mousedown",()=>this.focus()),t.blocking&&(window.addEventListener("mousedown",this.block,!0),document.getElementById("blocker").style.display="block",e.dataset.blocking="block"),s.addEventListener("mousedown",()=>{window.addEventListener("mousemove",this.handleDrag),window.addEventListener("mouseup",()=>window.removeEventListener("mousemove",this.handleDrag))}),this.focus(),e.classList.add("focused"),this.windowElement=e,this.viewElement=r}addToManager(t){this.windowManager=t,t.view.appendChild(this.windowElement),this.focus()}onClose(){}closeWindow(){this.windowManager&&(this.onClose(),this.windowManager.removeWindow(this),this.windowElement.classList.add("exiting"),window.removeEventListener("mousedown",this.block,!0),this.options.blocking&&this.windowManager.windows.filter(t=>t.options.blocking).length==0&&(document.getElementById("blocker").style.display="none"),setTimeout(()=>this.windowManager.view.removeChild(this.windowElement),40))}focus(){if(this.windowManager==null)return;this.windowManager.unfocusAll(),this.windowElement.classList.add("focused");const t=Array.from(this.windowManager.view.children).map(e=>e).filter(e=>e!=this.windowElement);t.sort((e,r)=>parseInt(e.style.zIndex)-parseInt(r.style.zIndex)),t.push(this.windowElement);for(let e=0;e<t.length;e++)t[e].style.zIndex=((t[e].dataset.blocking?10001:0)+e).toString()}unfocus(){this.windowManager!=null&&this.windowElement.classList.remove("focused")}clampPosition(){if(this.windowManager==null)return;const t=parseInt(this.windowElement.style.left.slice(0,-2)),e=parseInt(this.windowElement.style.top.slice(0,-2)),r=this.windowManager.app.view.getBoundingClientRect();this.windowElement.style.left=yr(t,r.left,r.width-this.windowElement.clientWidth+r.left)+"px",this.windowElement.style.top=yr(e,r.top,r.height-this.windowElement.clientHeight+r.top)+"px"}}class Fh extends Ls{constructor(e,r,n){super({title:r.title,width:500,height:400,disableClose:r.disableClose,win_id:"file_selector"+Math.random(),blocking:!0});L(this,"app");L(this,"dirOptions");L(this,"fileDropPath","");L(this,"draggedElement");L(this,"draggedCopy");L(this,"keyHandler");L(this,"dropHandler");L(this,"mouseHandler");L(this,"dragHandler");this.app=e,this.dirOptions=r,r.accepted_file_types||(r.accepted_file_types=[]),this.keyHandler=this.handleKeyEvent.bind(this),this.dropHandler=this.handleDropEvent.bind(this),this.mouseHandler=this.handleMouseEvent.bind(this),this.dragHandler=this.handleDragEvent.bind(this),this.initView(this.viewElement).then(()=>{n&&this.selectPath(n),r.onload?.()})}async initView(e){e.replaceChildren();const r=document.createElement("div");r.classList.add("padding");const n=document.createElement("div");n.classList.add("menu-options");const s=document.createElement("div");s.classList.add("menu-left");const a=document.createElement("div");a.classList.add("menu-right"),n.appendChild(s),n.appendChild(a);const h=document.createElement("button");h.innerText="Cancel",h.onclick=()=>{window.removeEventListener("keydown",this.keyHandler,!0),window.removeEventListener("drop",this.dropHandler,!0),this.closeWindow()};const u=document.createElement("button");u.innerText="Select",u.classList.add("confirm"),u.onclick=()=>this.confirmFile(),u.disabled=!0,s.appendChild(h),a.appendChild(u);const d=document.createElement("div");d.classList.add("dir-selector"),d.onclick=E=>{E.target==d&&this.selectElement(void 0)};const m=document.createElement("div");m.classList.add("file-options");const l=document.createElement("button"),f=document.createElement("img");f.src=nr.ADD_FILE,f.classList.add("icon"),l.appendChild(f),l.appendChild(document.createTextNode("Upload files")),m.appendChild(l),l.onclick=async()=>{const E=this.fileDropPath,k=await zR({_preferPolyfill:!1,excludeAcceptAllOption:!1,multiple:!0}),Q=this.viewElement.querySelector(".info.selected")?.dataset.path??"",Y=[];for(const it of k)Y.push(Ve.uploadHandle(it,Q));await Promise.all(Y),await this.refreshDirectory(E),this.getAcceptableFile(E).then(it=>this.selectPath(it))};const p=document.createElement("button"),y=document.createElement("img");y.src=nr.ADD_FOLDER,y.classList.add("icon"),p.appendChild(y),p.appendChild(document.createTextNode("Upload folder")),m.appendChild(p),p.onclick=async()=>{const E=this.fileDropPath,k=await WR({_preferPolyfill:!1}),Q=this.viewElement.querySelector(".info.selected")?.dataset.path??"";await Ve.uploadHandle(k,Q),await this.refreshDirectory(E),this.getAcceptableFile(E==""?k.name:E+"/"+k.name).then(Y=>this.selectPath(Y))};const _=document.createElement("button");_.classList.add("rename");const v=document.createElement("img");v.src=nr.EDIT,v.classList.add("icon"),_.appendChild(v),_.appendChild(document.createTextNode("Rename")),_.disabled=!0,_.onclick=()=>{const E=this.viewElement.querySelector(".info.selected");!E?.dataset.path||this.startEditing(E.querySelector("textarea"))},m.appendChild(_);const w=document.createElement("button");w.classList.add("delete");const C=document.createElement("img");C.src=nr.TRASH,C.classList.add("icon"),w.appendChild(C),w.appendChild(document.createTextNode("Delete")),w.disabled=!0,w.onclick=()=>{const E=this.viewElement.querySelector(".info.selected"),k=E?.dataset.path;if(!k)return;const G=E.parentElement.classList.contains("folder");Ve[G?"removeDirectory":"removeFile"](k).then(()=>{const Q=this.getElement(k);!Q||(Q.parentElement?.remove(),w.disabled=!0,_.disabled=!0)})},m.appendChild(w),r.appendChild(d),r.appendChild(m),r.appendChild(n),e.appendChild(r),window.addEventListener("keydown",this.keyHandler,!0),window.addEventListener("drop",this.dropHandler,!0),window.addEventListener("mousemove",this.dragHandler,!0),e.addEventListener("dragover",this.mouseHandler),await this.createDiv("").then(E=>d.replaceChildren(...E))}async expand(e){if(!e.parentElement.classList.contains("folder"))return;e.parentElement.classList.remove("collapsed");const r=e.nextSibling;await this.createDiv(e.dataset.path).then(n=>{r.replaceChildren(...n)})}collapse(e){if(!e.parentElement.classList.contains("folder"))return;e.parentElement.classList.add("collapsed"),e.nextSibling.replaceChildren()}selectElement(e){if(this.viewElement.querySelector(".info.selected")?.classList.remove("selected"),!e){this.viewElement.querySelector(".delete").disabled=!0,this.viewElement.querySelector(".rename").disabled=!0;return}e.classList.add("selected"),Ld(e,{scrollMode:"if-needed",block:"nearest",inline:"nearest"});const r=this.viewElement.querySelector("button.confirm"),n=e.dataset.path;r.disabled=!0,n&&(r.disabled=!this.acceptableFileType(n),this.viewElement.querySelector(".delete").disabled=!1,this.viewElement.querySelector(".rename").disabled=!1)}async createDiv(e){const r=await Ve.getDirectoryFolders(e);let n=await Ve.getDirectoryFiles(e);return r.sort((s,a)=>s.name.toLowerCase().localeCompare(a.name.toLowerCase())),n.sort((s,a)=>s.name.toLowerCase().localeCompare(a.name.toLowerCase())),n=n.filter(s=>xn(s.name)!=".crswap"),r.map(s=>this.createBaseElement(e,s)).concat(n.map(s=>this.createBaseElement(e,s)))}createBaseElement(e,r){e!=""&&(e+="/");const n=document.createElement("div");n.classList.add("item");const s=document.createElement("div");if(s.classList.add("info"),n.appendChild(s),r.kind=="directory"){const h=document.createElement("img");h.classList.add("icon"),h.classList.add("folder-icon"),h.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAbklEQVRIie2PMQqAMAxFXwfP6qJVPIjYzcOKdUkhQ0BaCoLkLS3k818CjuN8ztApYzIDl7xvmalFsAIZuIFozKPMMrC0CAJwKIkuGVX5KdkmLEm3ci1JSlLKU49yLSmXVG1es0EANvnvInKcP/AA784fpjlWwNQAAAAASUVORK5CYII=",s.appendChild(h);const u=document.createElement("div");u.classList.add("children"),n.appendChild(u),n.classList.add("folder"),n.classList.add("collapsed"),s.addEventListener("click",d=>{const m=d.target;m?.classList.contains("options-icon")||m.tagName=="TEXTAREA"&&!m.disabled||(n.classList.contains("collapsed")?this.expand(s):this.collapse(s))})}else{this.acceptableFileType(r.name)||s.classList.add("disabled");const h=document.createElement("img");h.src=this.getIcon(r.name),h.classList.add("icon"),s.appendChild(h)}s.dataset.path=e+r.name;const a=document.createElement("textarea");return a.rows=1,a.disabled=!0,a.autocomplete="off",a.autocapitalize="off",a.spellcheck=!1,a.innerText=r.name,a.style.pointerEvents="none",a.classList.add("title"),s.appendChild(a),s.addEventListener("click",()=>this.selectElement(s)),s.addEventListener("mousedown",()=>this.startDragging(s)),s.ondblclick=()=>this.confirmFile(),n}confirmFile(){const r=this.viewElement.querySelector(".info.selected")?.dataset.path;!r||this.acceptableFileType(r)&&(this.dirOptions.callback?.(r),window.removeEventListener("keydown",this.keyHandler,!0),window.removeEventListener("drop",this.dropHandler,!0),window.removeEventListener("mousemove",this.dragHandler,!0),this.closeWindow())}acceptableFileType(e){return this.dirOptions.accepted_file_types.length==0||this.dirOptions.accepted_file_types.includes(xn(e))}getIcon(e){const r=xn(e);return r==""&&!e.startsWith(".")?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAY0lEQVRIiWNgGAWDCXgwMDA8ZmBg+I8DN1BqwSM8hlPFEpgh2EA4AwPDbyIc8B/qUA9SLSDHEpItIBagmMNEBQPxglELRi0YtQDVgsdQmpiiAB9GNgsFeDAQV6KSXdiNgoEBAG+iU6T/ixEpAAAAAElFTkSuQmCC":Hy.includes(r)?nr.IMAGE_FILE:Uc.includes(r)?nr.AUDIO_FILE:[".sm",".ssc"].includes(r)?nr.SM_FILE:nr.UNKNOWN_FILE}startEditing(e){const r=e.value,n=!!e.parentElement?.parentElement?.classList.contains("folder"),s=e.parentElement?.dataset.path??"",a=zr(s);e.value=s.split("/").at(-1)??"",window.removeEventListener("keydown",this.keyHandler,!0),e.disabled=!1,e.style.pointerEvents="",e.focus(),e.addEventListener("keypress",h=>{h.code=="Enter"&&(h.preventDefault(),h.stopImmediatePropagation(),e.blur())},!0),e.addEventListener("blur",async()=>{if(window.addEventListener("keydown",this.keyHandler,!0),e.disabled=!0,e.style.pointerEvents="none",e.value.startsWith(".")){e.value=r;return}e.value=e.value.replaceAll("/","");const h=a==""?e.value:a+"/"+e.value;h!=s&&(e.parentElement.dataset.path=h,await Ve[n?"renameDirectory":"renameFile"](s,h),this.refreshDirectory(a),e.value.length>32&&(e.value=e.value.slice(0,32)+"..."))})}async refreshDirectory(e){const r=this.viewElement.querySelector(".dir-selector");if(!r)return;let n=r.querySelector("div[data-path='"+this.escapeSelector(e)+"']")?.nextSibling;if(e==""&&(n=r),!n)return;const s=Array.from(n.parentElement.querySelectorAll(".folder:not(.collapsed)")).map(a=>a.children[0].dataset.path);await this.createDiv(e).then(a=>n.replaceChildren(...a)),await Promise.all(s.map(a=>this.expand(r.querySelector("div[data-path='"+this.escapeSelector(a)+"']"))))}getElement(e){const r=this.viewElement.querySelector(".dir-selector");return r?r.querySelector("div[data-path='"+this.escapeSelector(e)+"']"):null}async getAcceptableFile(e){const r=await Ve.getDirectoryHandle(e);if(!r)return;const n=[{path:e,handle:r}];for(;n.length>0;){const s=n.shift(),a=s.handle;for await(const h of a.values()){const u=s.path==""?"":s.path+"/";if(h.kind=="directory")n.push({path:u+h.name,handle:h});else if(this.acceptableFileType(h.name))return u+h.name}}}async selectPath(e){if(!e)return;const r=this.viewElement.querySelector(".dir-selector");if(!r)return;const n=e.split("/");n.pop();const s=[];for(;n.length>0;){s.push(n.shift());const h=r.querySelector("div[data-path='"+this.escapeSelector(s.join("/"))+"']");if(!h)return;await this.expand(h)}const a=r.querySelector("div[data-path='"+this.escapeSelector(e)+"']");!a||this.selectElement(a)}handleKeyEvent(e){if(!this.windowElement.classList.contains("focused"))return;const r=this.viewElement.querySelector(".info.selected");if(r==null){if(e.code.startsWith("Arrow")){const n=this.viewElement.querySelector(".info");n&&this.selectElement(n)}return}if(e.code=="ArrowUp"){e.preventDefault(),e.stopImmediatePropagation();const n=r.parentElement;let s=n.previousSibling?.querySelector(".info");s&&!s.parentElement.classList.contains("collapsed")&&s.parentElement.classList.contains("folder")&&(s=s.parentElement.querySelector(".children").lastChild.querySelector(".info")),!s&&n.parentElement.classList.contains("children")&&(s=n.parentElement.parentElement.querySelector(".info")),s&&(this.selectElement(s),Ld(s,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}if(e.code=="ArrowDown"){e.preventDefault(),e.stopImmediatePropagation();const n=r.parentElement;let s;n.classList.contains("folder")&&!n.classList.contains("collapsed")&&(s=n.querySelector(".children").children[0].querySelector(".info")),s||(s=r.parentElement.nextSibling?.querySelector(".info")),!s&&n.parentElement.classList.contains("children")&&(s=n.parentElement.parentElement.nextSibling.querySelector(".info")),s&&(this.selectElement(s),Ld(s,{scrollMode:"if-needed",block:"nearest",inline:"nearest"}))}if(e.code=="ArrowLeft"&&(e.preventDefault(),e.stopImmediatePropagation(),this.collapse(r)),e.code=="ArrowRight"&&(e.preventDefault(),e.stopImmediatePropagation(),this.expand(r)),e.code=="Enter"&&(e.preventDefault(),e.stopImmediatePropagation(),r.parentElement?.querySelector(".title")&&this.startEditing(r.parentElement?.querySelector(".title"))),e.code=="Delete"||e.code=="Backspace"){const n=this.viewElement.querySelector(".info.selected"),s=n?.dataset.path;if(!s)return;const a=n.parentElement.classList.contains("folder");Ve[a?"removeDirectory":"removeFile"](s).then(()=>{const h=this.getElement(s);!h||(h.parentElement?.remove(),this.viewElement.querySelector(".delete").disabled=!0,this.viewElement.querySelector(".rename").disabled=!0)})}}startDragging(e){const r=e;r.totalMovementX=0,r.totalMovementY=0,this.draggedElement=r;const n=()=>{this.stopDragging(),window.removeEventListener("mouseup",n)};window.addEventListener("mouseup",n)}handleDragEvent(e){if(!!this.draggedElement){if(this.draggedElement.totalMovementX+=e.movementX,this.draggedElement.totalMovementY+=e.movementY,!this.draggedCopy)if(Math.abs(this.draggedElement.totalMovementX)+Math.abs(this.draggedElement.totalMovementY)>8){this.viewElement.addEventListener("mousemove",this.mouseHandler),this.draggedCopy=this.draggedElement.parentElement.cloneNode(!0),this.draggedCopy.style.position="fixed";const r=this.draggedElement.getBoundingClientRect();this.draggedCopy.style.top=r.top+this.draggedElement.totalMovementY+"px",this.draggedCopy.style.left=r.left+this.draggedElement.totalMovementX+"px",this.draggedCopy.style.width=r.width+"px",this.draggedCopy.style.boxShadow="3px 3px 3px #222",this.draggedCopy.querySelector(".children")&&this.draggedCopy.removeChild(this.draggedCopy.querySelector(".children")),this.viewElement.appendChild(this.draggedCopy)}else return;this.draggedCopy.style.top=parseFloat(this.draggedCopy.style.top.slice(0,-2))+e.movementY+"px",this.draggedCopy.style.left=parseFloat(this.draggedCopy.style.left.slice(0,-2))+e.movementX+"px"}}async stopDragging(){if(this.draggedCopy){this.draggedCopy.remove(),this.viewElement.removeEventListener("mousemove",this.mouseHandler);const e=this.draggedCopy.classList.contains("folder"),r=this.draggedElement.dataset.path,n=this.fileDropPath==""?Ts(this.draggedElement.dataset.path):this.fileDropPath+"/"+Ts(this.draggedElement.dataset.path);await Ve[e?"renameDirectory":"renameFile"](r,n),await this.refreshDirectory(zr(r)),await this.refreshDirectory(zr(n)),this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),this.fileDropPath=""}this.draggedCopy=void 0,this.draggedElement=void 0}handleDropEvent(e){e.preventDefault(),e.stopImmediatePropagation(),this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),e.target.closest(".dir-selector")&&Ve.handleDropEvent(e,this.fileDropPath).then(async r=>{await this.refreshDirectory(this.fileDropPath),this.getAcceptableFile(r??this.fileDropPath).then(n=>this.selectPath(n)),this.fileDropPath=""})}handleMouseEvent(e){const r=this.viewElement.querySelector(".dir-selector");let n=Array.from(r.querySelectorAll("div.item.folder"));const s=this.viewElement.querySelector(".outlined");n=n.filter(a=>!a.parentElement.closest(".collapsed")),n.reverse(),n.push(r);for(const a of n){const h=a.getBoundingClientRect();if(e.clientX>=h.x&&e.clientX<=h.x+h.width&&e.clientY>=h.y&&e.clientY<=h.y+h.height){s!=a&&s?.classList.remove("outlined");const u=a.querySelector(".info");this.fileDropPath=u?.dataset.path??"",a.classList.contains("dir-selector")&&(this.fileDropPath=""),a.classList.add("outlined");return}}this.viewElement.querySelector(".outlined")?.classList.remove("outlined"),this.fileDropPath=""}escapeSelector(e){return e.replaceAll(/'/g,"\\'")}}function b_(){const i=document.createElement("div");return i.spellcheck=!1,i.contentEditable="true",i.classList.add("inlineEdit"),i.onkeydown=t=>{t.key=="Enter"&&i.blur()},i}function tc(i,t){return{title:i,element:e=>{const r=b_();return r.onblur=()=>{const n=e[t];Ji.instance.run({action:()=>{e[t]=r.innerText},undo:()=>{e[t]=n}}),r.scrollLeft=0},r.innerText=e[t],r}}}const gk={name:tc("Name","chartName"),credit:tc("Artist","credit"),style:tc("Style","chartStyle"),description:tc("Description","description"),music:{title:"Music File",element:(i,t)=>{const e=document.createElement("div");e.classList.add("flex-row","flex-column-gap","flex-static","hide-buttons");const r=()=>{if(n.innerText==(i.music??t.chartManager.sm.properties.MUSIC??""))return;const d=t.chartManager.songAudio.isPlaying();if(n.innerText==""||n.innerText==t.chartManager.sm.properties.MUSIC){i.music=void 0,n.innerText=t.chartManager.sm.properties.MUSIC+"",t.chartManager.loadAudio(),d&&t.chartManager.songAudio.play();return}const m=i.music;Ji.instance.run({action:()=>i.music=n.innerText==t.chartManager.sm.properties.MUSIC?void 0:n.innerText,undo:()=>i.music=m}),t.chartManager.loadAudio(),d&&t.chartManager.songAudio.play()},n=b_();n.style.flex="1",n.onblur=r,n.innerText=i.music??t.chartManager.sm.properties.MUSIC??"";const s=document.createElement("button");s.onclick=()=>{const d=t.chartManager.sm_path.split("/").slice(0,-1).join("/");if(window.nw){const m=document.createElement("input");m.type="file",m.accept="audio/*",m.onchange=()=>{n.innerText=Ve.getRelativePath(d,m.value),r()},m.click()}else t.windowManager.openWindow(new Fh(t,{title:"Select an audio file...",accepted_file_types:Uc,disableClose:!0,callback:m=>{n.innerText=Ve.getRelativePath(d,m),r()}},d+"/"+(i.music??t.chartManager.sm.properties.MUSIC??"")))};const a=document.createElement("img");a.classList.add("icon"),a.style.height="12px",a.src=nr.SELECT_FILE,s.appendChild(a);const h=document.createElement("button");h.onclick=()=>{n.innerText!=(t.chartManager.sm.properties.MUSIC??"")&&(n.innerText=t.chartManager.sm.properties.MUSIC??"",r())};const u=document.createElement("img");return u.classList.add("icon"),u.style.height="12px",u.src=nr.REVERT,h.appendChild(u),e.appendChild(n),e.appendChild(s),e.appendChild(h),e}}};class Ds{constructor(t,e,r){L(this,"view");L(this,"items",[]);L(this,"selectedItem");L(this,"onChangeHandlers",[]);this.view=t,t.classList.add("dropdown"),this.items=e??[],this.selectedItem=r??this.items[0];const n=document.createElement("div");n.classList.add("dropdown-selected");const s=document.createElement("div");s.classList.add("dropdown-items"),s.style.height="",n.onclick=()=>{if(!n.classList.contains("disabled")){if(this.items.length==0){s.style.height="";return}this.createDropdown(),s.style.height==""?(s.style.width=Math.max(s.scrollWidth,n.clientWidth)+"px",s.style.height=s.scrollHeight+"px",Array.from(s.children).forEach((a,h)=>{a.style.animationDelay=h*.02+"s"})):s.style.height=""}},window.addEventListener("click",a=>{const h=a.target;(!h.closest(".dropdown")||h.closest(".dropdown")!=t)&&(s.style.height="")}),this.view.appendChild(n),this.view.appendChild(s),this.setSelected()}static create(t,e){return new Ds(document.createElement("div"),t,e)}onChange(t){this.onChangeHandlers.push(t)}removeHandler(t){!this.onChangeHandlers.includes(t)||this.onChangeHandlers.splice(this.onChangeHandlers.indexOf(t),1)}setItems(t){this.items=t,t.includes(this.selectedItem)||(this.selectedItem=this.items[0],this.setSelected())}setSelected(t){this.selectedItem=t??this.selectedItem;const e=this.view.querySelector(".dropdown-selected");e.innerText=this.selectedItem?this.selectedItem+"":""}get value(){return this.selectedItem}get disabled(){return this.view.querySelector(".dropdown-selected").classList.contains("disabled")}set disabled(t){t?this.view.querySelector(".dropdown-selected").classList.add("disabled"):this.view.querySelector(".dropdown-selected").classList.remove("disabled")}createDropdown(){const t=this.view.querySelector(".dropdown-items"),e=this.items.map(r=>{const n=document.createElement("div");return n.classList.add("dropdown-item"),n.innerText=r+"",n.onclick=()=>{t.style.height="",this.selectedItem!=r&&(this.onChangeHandlers.forEach(s=>s(r)),this.setSelected(r))},n});t.replaceChildren(...e)}}class x_ extends Ls{constructor(e,r,n,s){super({title:r,width:300,height:100,disableClose:!0,win_id:"confirm",blocking:!0});L(this,"app");L(this,"buttonOptions");L(this,"message");L(this,"resolve");L(this,"resolved",new Promise(e=>this.resolve=e));this.app=e,this.message=n,this.buttonOptions=s,this.initView(this.viewElement)}initView(e){e.replaceChildren(),e.classList.add("confirmation");const r=document.createElement("div");r.classList.add("padding");const n=document.createElement("div");n.classList.add("label"),n.innerText=this.message,r.appendChild(n);const s=document.createElement("div");s.classList.add("menu-options"),this.buttonOptions.forEach(a=>{const h=document.createElement("button");h.innerText=a.label,h.onclick=()=>{a.callback?.(),this.resolve?.(a.label),this.closeWindow()},a.type!="default"&&h.classList.add(a.type),s.append(h)}),r.appendChild(s),e.appendChild(r)}}class A_ extends Ls{constructor(e,r){super({title:"Chart List",width:500,height:400,win_id:"chart_list"});L(this,"app");L(this,"gameType");L(this,"chartList");L(this,"chartInfo");L(this,"gameTypeDropdown");L(this,"smLoadHandler",()=>{this.gameTypeDropdown.setItems(Si.getPriority().map(e=>{const r=this.app.chartManager.sm?.charts[e.id]??[];return e.id+" ("+r.length+")"})),this.gameTypeDropdown.setSelected(this.gameType.id+" ("+(this.app.chartManager.sm?.charts[this.gameType.id]??[]).length+") "),this.gameType=this.app.chartManager.chart?.gameType??this.gameType,this.loadCharts()});this.app=e,this.gameType=r??e.chartManager.chart?.gameType??Si.getPriority()[0],this.initView(this.viewElement),Ee.on("smLoadedAfter",this.smLoadHandler)}initView(e){e.replaceChildren();const r=document.createElement("div");r.classList.add("padding");const n=document.createElement("div");n.classList.add("chart-view-type-wrapper");const s=document.createElement("div");s.classList.add("chart-view-type-label"),s.innerText="Game Type:",this.gameTypeDropdown=Ds.create(Si.getPriority().map(h=>{const u=this.app.chartManager.sm?.charts[h.id]??[];return h.id+" ("+u.length+")"}),this.gameType.id+" ("+(this.app.chartManager.sm?.charts[this.gameType.id]??[]).length+") "),this.gameTypeDropdown.onChange(h=>{this.gameType=Si.getGameType(h.split(" ")[0])??this.gameType,this.loadCharts()}),n.appendChild(s),n.appendChild(this.gameTypeDropdown.view);const a=document.createElement("div");a.classList.add("chart-view-scroller"),r.appendChild(n),r.appendChild(a),this.chartList=document.createElement("div"),this.chartList.classList.add("chart-list"),this.chartInfo=document.createElement("div"),this.chartInfo.classList.add("chart-info"),a.appendChild(this.chartList),a.appendChild(this.chartInfo),e.appendChild(r),this.loadCharts()}onClose(){Ee.off("smLoadedAfter",this.smLoadHandler)}loadCharts(){const e=this.app.chartManager.sm?.charts[this.gameType.id]??[],r=[];this.gameTypeDropdown.setItems(Si.getPriority().map(h=>{const u=this.app.chartManager.sm?.charts[h.id]??[];return h.id+" ("+u.length+")"})),this.gameTypeDropdown.setSelected(this.gameType.id+" ("+(this.app.chartManager.sm?.charts[this.gameType.id]??[]).length+") "),e.forEach(h=>{const u=document.createElement("div");u.classList.add("chart-list-item"),u.chart=h,this.app.chartManager.chart==h&&u.classList.add("selected"),u.onclick=()=>{u.chart!=this.app.chartManager.chart&&(this.app.chartManager.loadChart(u.chart),this.chartList.querySelectorAll(".selected").forEach(p=>p.classList.remove("selected")),u.classList.add("selected"))},u.onmouseenter=()=>{this.loadChartDetails(u.chart)},u.onmouseleave=()=>{this.loadChartDetails()};const d=document.createElement("div");d.innerText=h.meter+"",d.classList.add("title",h.difficulty);const m=document.createElement("div");m.classList.add("chart-list-info");const l=document.createElement("div");l.innerText=h.credit,l.classList.add("title","chart-credit");const f=document.createElement("div");f.innerText=h.notedata.length+"",f.classList.add("title","chart-step-count"),m.appendChild(l),m.appendChild(f),u.appendChild(d),u.appendChild(m),r.push(u)});const n=document.createElement("div");n.classList.add("chart-list-item");const s=document.createElement("div");s.innerText="+",s.classList.add("title");const a=document.createElement("div");a.classList.add("chart-list-info"),a.innerText="New Blank Chart",n.appendChild(s),n.appendChild(a),n.onclick=()=>{const h=new w_(this.app.chartManager.sm);h.gameType=this.gameType,this.app.chartManager.sm.addChart(h),this.app.chartManager.loadChart(h),this.loadCharts()},this.chartList.replaceChildren(...r,n),this.loadChartDetails()}loadChartDetails(e){if(e=e??this.app.chartManager.chart,e?.gameType.id!=this.gameType.id){this.chartInfo.replaceChildren();return}if(!e)return;const r=()=>this.app.chartManager.sm.charts[e.gameType.id].sort((v,w)=>rn.indexOf(v.difficulty)==rn.indexOf(w.difficulty)?v.meter-w.meter:rn.indexOf(v.difficulty)-rn.indexOf(w.difficulty)),n=document.createElement("div");n.classList.add("chart-info-main");const s=Ds.create(rn,e.difficulty);s.view.classList.add("no-border","white"),s.onChange(v=>{const w=e.difficulty;Ji.instance.run({action:()=>{e.difficulty=v,r(),this.loadCharts()},undo:()=>{e.difficulty=w,r(),this.loadCharts()}})});const a=document.createElement("div");a.spellcheck=!1,a.contentEditable="true",a.classList.add("inlineEdit","chart-meter"),a.onkeydown=v=>{p_(v)||v.preventDefault(),v.key=="Enter"&&a.blur()},a.onblur=()=>{let v=Math.round(Tc(a.innerText));v=yr(1,v,2**31-1);const w=e.meter;Ji.instance.run({action:()=>{e.meter=v,r(),this.loadCharts()},undo:()=>{e.meter=w,r(),this.loadCharts()}}),a.scrollLeft=0},a.innerText=e.meter+"";const h=document.createElement("div");h.classList.add("chart-properties"),n.appendChild(s.view),n.appendChild(a),Object.values(gk).forEach(v=>{const w=document.createElement("div");w.classList.add("label"),w.innerText=v.title;const C=v.element(e,this.app);v.title=="Artist"&&C.addEventListener("blur",()=>this.loadCharts()),h.appendChild(w),h.appendChild(C)});const u=e.getNotedataStats(),d=document.createElement("div");d.classList.add("chart-info-grid-item");const m=document.createElement("div");m.innerText="Peak NPS",m.classList.add("title","chart-info-grid-label");const l=document.createElement("div");l.innerText=Math.max(Math.max(...u.npsGraph),0).toFixed(2)+"",l.classList.add("title","chart-info-grid-count"),d.appendChild(m),d.appendChild(l);const f=document.createElement("div");f.classList.add("chart-info-grid"),Object.entries(u.counts).forEach(v=>{const w=document.createElement("div");w.classList.add("chart-info-grid-item");const C=document.createElement("div");C.innerText=v[0],C.classList.add("title","chart-info-grid-label");const E=document.createElement("div");E.innerText=v[1]+"",E.classList.add("title","chart-info-grid-count"),w.appendChild(C),w.appendChild(E),f.appendChild(w)});const p=document.createElement("div");p.classList.add("menu-options");const y=document.createElement("button");y.innerText="Duplicate Chart",y.onclick=()=>{const v=Object.assign(Object.create(Object.getPrototypeOf(e)),e);v.setNotedata(e.notedata.map(w=>e.computeNote(w))??[]),this.app.chartManager.sm.addChart(v),this.app.chartManager.loadChart(v),this.loadCharts()},p.append(y);const _=document.createElement("button");_.innerText="Delete Chart",_.onclick=()=>{this.app.windowManager.openWindow(new x_(this.app,"Delete chart","Are you sure you want to delete this chart?",[{type:"default",label:"Cancel"},{type:"delete",label:"Delete",callback:()=>{this.app.chartManager.sm.removeChart(e)&&(this.app.chartManager.loadChart(),this.gameType=this.app.chartManager.chart?.gameType??this.gameType,this.loadCharts())}}]))},_.classList.add("delete"),p.append(_),this.chartInfo.replaceChildren(n,h,d,f,p)}}class yk extends Ls{constructor(e){super({title:"Audio Equalizer",width:600,height:200,win_id:"audio-eq"});L(this,"app");this.app=e,this.initView(this.viewElement)}initView(e){e.replaceChildren();const r=document.createElement("canvas");e.appendChild(r);const n=this.drawEQ(r);requestAnimationFrame(n)}drawEQ(e){const r=e.getContext("2d"),n=[20,30,40,50,60,70,80,90,100,200,300,400,500,600,700,800,900,1e3,2e3,3e3,4e3,5e3,6e3,7e3,8e3,9e3,1e4],s=["20","30","40","50","60","","80","","100","200","300","400","500","600","","800","","1k","2k","3k","4k","5k","6k","","8k","","10k"],a=[];for(const u of n)a.push(Math.floor(Math.log(u/20)/Math.log(500)*1170));r.canvas.width=1200,r.canvas.height=400;const h=()=>{if(!this.app.chartManager.songAudio)return;r.fillStyle="rgba(0, 0, 0, 1)",r.fillRect(0,0,e.width,e.height);const u=this.app.chartManager.songAudio.getFrequencyData();r.fillStyle="rgb(0, 50, 150)";for(let d=0;d<1200;d++){const l=Math.pow(500,d/1170)*20/this.app.chartManager.songAudio.getSampleRate()*2*this.app.chartManager.songAudio.getFFTSize(),f=u[Math.floor(l)]/255;r.fillRect(d,400-f*500,1,f*500)}r.fillStyle="rgba(0, 100, 150, 1)",r.font="22px Assistant";for(let d=0;d<n.length;d++){let m=a[d];r.fillRect(m,0,1,400),d==n.length-1&&(m-=20),r.fillText(s[d],m,200)}for(let d=-10;d<10;d+=2){const m=-d*20+200;r.fillRect(0,m,1200,1),d!=0&&r.fillText(d+"",0,m)}r.fillRect(0,200,1200,1),r.fillStyle="rgba(0, 100, 150,0.5)",e.closest("#windows")&&requestAnimationFrame(h)};return h}}function ro(i,t){return{title:t??Uf(i),element:e=>{const r=e.chartManager.sm,n=document.createElement("input");return n.type="text",n.autocomplete="off",n.spellcheck=!1,n.onkeydown=s=>{s.key=="Enter"&&n.blur()},n.onblur=()=>{const s=r.properties[i];Ji.instance.run({action:()=>r.properties[i]=n.value,undo:()=>r.properties[i]=s})},n.value=r.properties[i]??"",n}}}function Js(i,t,e,r){return{title:e??Uf(i),element:n=>{const s=n.chartManager.sm,a=document.createElement("div");a.classList.add("flex-row","flex-column-gap","flex-static");const h=()=>{s.properties[i]=u.value,r?.(n,u.value)},u=document.createElement("input");u.type="text",u.autocomplete="off",u.spellcheck=!1,u.onkeydown=l=>{l.key=="Enter"&&u.blur()},u.onblur=h,u.value=s.properties[i]??"";const d=document.createElement("button");d.style.height="100%",d.onclick=()=>{const l=n.chartManager.sm_path.split("/").slice(0,-1).join("/");if(window.nw){const f=document.createElement("input");f.type="file",f.accept=t=="audio"?"audio/*":"image/*",f.onchange=()=>{u.value=Ve.getRelativePath(l,f.value),h()},f.click()}else n.windowManager.openWindow(new Fh(n,{title:t=="audio"?"Select an audio file...":"Select an image file...",accepted_file_types:t=="audio"?Uc:Hy,disableClose:!0,callback:f=>{u.value=Ve.getRelativePath(l,f),h()}},s.properties[i]?l+"/"+s.properties[i]:n.chartManager.sm_path))};const m=document.createElement("img");return m.classList.add("icon"),m.style.height="12px",m.src=nr.SELECT_FILE,d.appendChild(m),a.appendChild(u),a.appendChild(d),a}}}const _k={title:ro("TITLE","Song Title"),subtitle:ro("SUBTITLE","Song Subtitle"),artist:ro("ARTIST","Song Artist"),credit:ro("CREDIT"),genre:ro("GENRE"),origin:ro("ORIGIN"),music:Js("MUSIC","audio","Music File",i=>i.chartManager.loadAudio()),bg:Js("BACKGROUND","image","BG Image"),banner:Js("BANNER","image","Banner Image"),cdtitle:Js("CDTITLE","image","CD Title"),cdimage:Js("CDIMAGE","image","CD Image"),jacket:Js("JACKET","image","Jacket"),discImage:Js("DISCIMAGE","image","Disc Image")};class E_ extends Ls{constructor(e,r,n){super({title:"Song Properties",width:400,height:365,disableClose:!!r,win_id:"sm_properties",blocking:!!r});L(this,"app");L(this,"callback");L(this,"changeHandler",()=>this.initView(this.viewElement));this.app=e,this.callback=n,this.initView(this.viewElement),Ee.on("smLoaded",this.changeHandler),Ee.on("undo",this.changeHandler),Ee.on("redo",this.changeHandler)}onClose(){Ee.off("smLoaded",this.changeHandler),Ee.off("undo",this.changeHandler),Ee.off("redo",this.changeHandler)}initView(e){e.replaceChildren(),e.classList.add("sm-properties");const r=document.createElement("div");r.classList.add("padding");const n=document.createElement("div");n.classList.add("property-grid");const s=document.createElement("div");s.classList.add("label"),s.innerText="Apply to",Object.values(_k).forEach(l=>{const f=document.createElement("div");f.classList.add("label"),f.innerText=l.title;const p=l.element(this.app);n.appendChild(f),n.appendChild(p)}),r.appendChild(n);const a=document.createElement("div");a.classList.add("menu-options");const h=document.createElement("div");h.classList.add("menu-left");const u=document.createElement("div");u.classList.add("menu-right"),a.appendChild(h),a.appendChild(u);const d=document.createElement("button");d.innerText="Cancel",d.onclick=()=>{this.callback?.(!1),this.closeWindow()};const m=document.createElement("button");m.innerText="Create",m.classList.add("confirm"),m.onclick=()=>{this.callback?.(!0),this.closeWindow()},h.appendChild(d),u.appendChild(m),this.options.blocking&&r.appendChild(a),e.appendChild(r)}}class ji{constructor(t,e,r,n,s,a){L(this,"view");L(this,"input");L(this,"onChange");L(this,"min",-Number.MAX_VALUE);L(this,"max",Number.MAX_VALUE);L(this,"precision");L(this,"step",1);this.view=t,this.view.classList.add("spinner");const h=document.createElement("input");h.classList.add("spinner-input"),h.type="text",h.autocomplete="off",h.spellcheck=!1,h.onblur=()=>{let l=ve(Tc(h.value),3);l=yr(l,this.min,this.max),h.value=this.formatValue(l),h.value==""?this.onChange?.(void 0):this.onChange?.(l)},h.onkeydown=l=>{p_(l)||l.preventDefault(),l.key=="Enter"&&h.blur()},this.input=h,this.min=s??this.min,this.max=a??this.max,this.step=r,this.precision=n,this.setValue(e),t.appendChild(h);const u=document.createElement("div");u.classList.add("spinner-btns"),t.appendChild(u);const d=document.createElement("button");d.classList.add("spinner-up"),d.onclick=()=>{h.value=this.formatValue(parseFloat(h.value)+r),this.onChange?.(parseFloat(h.value))},u.appendChild(d);const m=document.createElement("button");m.classList.add("spinner-down"),m.onclick=()=>{h.value=this.formatValue(parseFloat(h.value)-r),this.onChange?.(parseFloat(h.value))},u.appendChild(m)}get value(){return parseFloat(this.input.value)}static create(t,e,r,n,s){return new ji(document.createElement("div"),t,e,r,n,s)}setValue(t){parseFloat(this.input.value)!=ve(t,this.precision??3)&&(this.input.value=this.formatValue(t))}formatValue(t){return this.precision?ve(t,this.precision).toFixed(this.precision):ve(t,3).toString()}}const Hr=i=>i,Gr=(i,t,e)=>{const r=i.chartManager.getBeat();i.chartManager.chart?.timingData.delete(t(),e,r)},f0={offset:{title:"Offset",element:Hr({create:(i,t)=>{const e=ji.create(0,.001,3);return e.onChange=r=>{if(r==null){e.setValue(i.chartManager.chart.timingData.getTimingData("OFFSET"));return}i.chartManager.chart?.timingData.insert(t(),"OFFSET",r),i.chartManager.setBeat(i.chartManager.getBeat())},e.view},update:(i,t)=>{const e=t.getTimingData("OFFSET"),r=i.querySelector(".spinner-input");r.dataset.lastValue!=e.toFixed(3)&&(r.dataset.lastValue=e.toFixed(3),r.value=ve(e,3).toFixed(3))}})},bpm:{title:"BPM",element:Hr({create:(i,t)=>{const e=ji.create(120,.001,3);return e.onChange=r=>{if(r==null){Gr(i,t,"BPMS");return}i.chartManager.chart?.timingData.insert(t(),"BPMS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=t.getTimingEventAtBeat("BPMS",e)?.value??120,n=i.querySelector(".spinner-input");n.dataset.lastValue!=r.toFixed(3)&&(n.dataset.lastValue=r.toFixed(3),n.value=ve(r,3).toFixed(3))}})},stop:{title:"Stop",element:Hr({create:(i,t)=>{const e=ji.create(0,.001,3);return e.onChange=r=>{if(r==null||r==0){Gr(i,t,"STOPS");return}i.chartManager.chart?.timingData.insert(t(),"STOPS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=t.getTimingEventAtBeat("STOPS",e);let n=r?.value??0;e!=r?.beat&&(n=0);const s=i.querySelector(".spinner-input");s.dataset.lastValue!=n.toFixed(3)&&(s.dataset.lastValue=n.toFixed(3),s.value=ve(n,3).toFixed(3))}})},delay:{title:"Delay",element:Hr({create:(i,t)=>{const e=ji.create(0,.001,3);return e.onChange=r=>{if(r==null||r==0){Gr(i,t,"DELAYS");return}i.chartManager.chart?.timingData.insert(t(),"DELAYS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=t.getTimingEventAtBeat("DELAYS",e);let n=r?.value??0;e!=r?.beat&&(n=0);const s=i.querySelector(".spinner-input");s.dataset.lastValue!=n.toFixed(3)&&(s.dataset.lastValue=n.toFixed(3),s.value=ve(n,3).toFixed(3))}})},warp:{title:"Warp",element:Hr({create:(i,t)=>{const e=ji.create(0,.001,3,0);return e.onChange=r=>{if(r==null||r==0){Gr(i,t,"WARPS");return}if(r<0){const n=i.chartManager.getBeat(),s=i.chartManager.chart?.timingData.getTimingEventAtBeat("WARPS",n);e.setValue(s?.value??0),n!=s?.beat&&e.setValue(0);return}i.chartManager.chart?.timingData.insert(t(),"WARPS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=t.getTimingEventAtBeat("WARPS",e);let n=r?.value??0;e!=r?.beat&&(n=0);const s=i.querySelector(".spinner-input");s.dataset.lastValue!=n.toFixed(3)&&(s.dataset.lastValue=n.toFixed(3),s.value=ve(n,3).toFixed(3))}})},timeSig:{title:"Time Sig.",element:Hr({create:(i,t)=>{const e=document.createElement("div");e.classList.add("flex-column-gap");const r=ji.create(4,1,0,1);r.onChange=s=>{if(s==null){Gr(i,t,"TIMESIGNATURES");return}if(s<1){const a=i.chartManager.getBeat();r.setValue(i.chartManager.chart?.timingData.getTimingEventAtBeat("TIMESIGNATURES",a)?.upper??4);return}i.chartManager.chart?.timingData.insert(t(),"TIMESIGNATURES",{upper:s,lower:n.value},i.chartManager.getBeat())};const n=ji.create(4,1,0,1);return n.onChange=s=>{if(s==null){Gr(i,t,"TIMESIGNATURES");return}if(s<1){const a=i.chartManager.getBeat();n.setValue(i.chartManager.chart?.timingData.getTimingEventAtBeat("TIMESIGNATURES",a)?.lower??4);return}i.chartManager.chart?.timingData.insert(t(),"TIMESIGNATURES",{upper:r.value,lower:s},i.chartManager.getBeat())},e.appendChild(r.view),e.appendChild(n.view),e},update:(i,t,e)=>{const r=t.getTimingEventAtBeat("TIMESIGNATURES",e),n=r?.upper??4,s=r?.lower??4,a=i.firstElementChild.querySelector(".spinner-input");a.dataset.lastValue!=Math.round(n).toString()&&(a.dataset.lastValue=Math.round(n).toString(),a.value=Math.round(n).toString());const h=i.lastElementChild.querySelector(".spinner-input");h.dataset.lastValue!=Math.round(s).toString()&&(h.dataset.lastValue=Math.round(s).toString(),h.innerText=Math.round(s).toString())}})},tick:{title:"Tickcount",element:Hr({create:(i,t)=>{const e=ji.create(4,1,0,0);return e.onChange=r=>{if(r==null){Gr(i,t,"TICKCOUNTS");return}if(r<0){const n=i.chartManager.getBeat();e.setValue(i.chartManager.chart?.timingData.getTimingEventAtBeat("TICKCOUNTS",n)?.value??0);return}i.chartManager.chart?.timingData.insert(t(),"TICKCOUNTS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=t.getTimingEventAtBeat("TICKCOUNTS",e)?.value??4,n=i.querySelector(".spinner-input");n.dataset.lastValue!=Math.round(r).toString()&&(n.dataset.lastValue=Math.round(r).toString(),n.value=Math.round(r).toString())}})},combo:{title:"Combo",element:Hr({create:(i,t)=>{const e=document.createElement("div");e.classList.add("flex-column-gap");const r=ji.create(1,1,0,0);r.onChange=s=>{if(s==null){Gr(i,t,"COMBOS");return}if(s<0){const a=i.chartManager.getBeat();r.setValue(i.chartManager.chart?.timingData.getTimingEventAtBeat("COMBOS",a)?.hitMult??1);return}i.chartManager.chart?.timingData.insert(t(),"COMBOS",{hitMult:s,missMult:n.value},i.chartManager.getBeat())};const n=ji.create(1,1,0,0);return n.onChange=s=>{if(s==null){const a=i.chartManager.getBeat();n.setValue(i.chartManager.chart?.timingData.getTimingEventAtBeat("COMBOS",a)?.missMult??1);return}if(s<0){const a=i.chartManager.getBeat();n.setValue(i.chartManager.chart?.timingData.getTimingEventAtBeat("COMBOS",a)?.missMult??1);return}i.chartManager.chart?.timingData.insert(t(),"COMBOS",{hitMult:s,missMult:n.value},i.chartManager.getBeat())},e.appendChild(r.view),e.appendChild(n.view),e},update:(i,t,e)=>{const r=t.getTimingEventAtBeat("COMBOS",e),n=r?.hitMult??1,s=r?.missMult??1,a=i.firstElementChild.querySelector(".spinner-input");a.dataset.lastValue!=Math.round(n).toString()&&(a.dataset.lastValue=Math.round(n).toString(),a.value=Math.round(n).toString());const h=i.lastElementChild.querySelector(".spinner-input");h.dataset.lastValue!=Math.round(s).toString()&&(h.dataset.lastValue=Math.round(s).toString(),h.value=Math.round(s).toString())}})},speed:{title:"Speed",element:Hr({create:(i,t)=>{const e=document.createElement("div");e.classList.add("flex-column-gap");const r=()=>{i.chartManager.chart?.timingData.insert(t(),"SPEEDS",{value:n.value,delay:s.value,unit:a.value=="Beats"?"B":"T"},i.chartManager.getBeat())},n=ji.create(1,.1,0);n.onChange=h=>{if(h==null){Gr(i,t,"SPEEDS");return}if(h<0){const u=i.chartManager.getBeat();n.setValue(i.chartManager.chart?.timingData.getTimingEventAtBeat("SPEEDS",u)?.value??1);return}r()};const s=ji.create(1,.1,0);s.onChange=h=>{if(h==null||h<0){const u=i.chartManager.getBeat();s.setValue(i.chartManager.chart?.timingData.getTimingEventAtBeat("SPEEDS",u)?.delay??0);return}r()};const a=Ds.create(["Beat","Time"],"Beats");return a.onChange=r,e.appendChild(n.view),e.appendChild(s.view),e.appendChild(a.view),e},update:(i,t,e)=>{const r=t.getTimingEventAtBeat("SPEEDS",e),n=r?.value??1,s=r?.delay??0,a=r?.unit=="B"?"Beat":"Time",h=i.firstElementChild.querySelector(".spinner-input");h.dataset.lastValue!=ve(n,3).toString()&&(h.dataset.lastValue=ve(n,3).toString(),h.value=ve(n,3).toString());const u=i.children[1].querySelector(".spinner-input");u.dataset.lastValue!=ve(s,3).toString()&&(u.dataset.lastValue=ve(s,3).toString(),u.value=ve(s,3).toString()),u.disabled=r?.beat!=e;const d=i.lastElementChild.querySelector(".dropdown-selected");d.dataset.lastValue!=a&&(d.dataset.lastValue=a,d.innerText=a),r?.beat!=e?d.classList.add("disabled"):d.classList.remove("disabled")}})},scroll:{title:"Scroll",element:Hr({create:(i,t)=>{const e=ji.create(1,.001,3);return e.onChange=r=>{if(r==null){Gr(i,t,"SCROLLS");return}i.chartManager.chart?.timingData.insert(t(),"SCROLLS",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=t.getTimingEventAtBeat("SCROLLS",e)?.value??1,n=i.querySelector(".spinner-input");n.dataset.lastValue!=r.toFixed(3)&&(n.dataset.lastValue=r.toFixed(3),n.value=ve(r,3).toFixed(3))}})},fake:{title:"Fake",element:Hr({create:(i,t)=>{const e=ji.create(1,.001,3,0);return e.onChange=r=>{if(r==null){Gr(i,t,"FAKES");return}if(r<0){const n=i.chartManager.getBeat(),s=i.chartManager.chart?.timingData.getTimingEventAtBeat("FAKES",n);e.setValue(s?.value??0),n!=s?.beat&&e.setValue(0);return}i.chartManager.chart?.timingData.insert(t(),"FAKES",{value:r},i.chartManager.getBeat())},e.view},update:(i,t,e)=>{const r=t.getTimingEventAtBeat("FAKES",e);let n=r?.value??1;e!=r?.beat&&(n=0);const s=i.querySelector(".spinner-input");s.dataset.lastValue!=n.toFixed(3)&&(s.dataset.lastValue=n.toFixed(3),s.value=ve(n,3).toFixed(3))}})},label:{title:"Label",element:Hr({create:(i,t)=>{const e=document.createElement("input");return e.type="text",e.autocomplete="off",e.spellcheck=!1,e.onkeydown=r=>{r.key=="Enter"&&e.blur()},e.onblur=()=>{if(e.value==""){Gr(i,t,"LABELS");return}i.chartManager.chart?.timingData.insert(t(),"LABELS",{value:e.value},i.chartManager.getBeat())},e},update:(i,t,e)=>{const n=t.getTimingEventAtBeat("LABELS",e)?.value??"",s=i;s.dataset.lastValue!=n&&(s.dataset.lastValue=n,s.value=n)}})}};class vk extends Ls{constructor(e){super({title:"Edit Timing Data",width:300,height:340,disableClose:!1,win_id:"timing_data",blocking:!1});L(this,"app");L(this,"lastBeat");L(this,"songTiming",!1);L(this,"interval");L(this,"changeHandler",()=>this.setData(this.viewElement));this.app=e,this.lastBeat=Math.round(this.app.chartManager.getBeat()*1e3)/1e3,this.songTiming=!this.app.chartManager.chart.timingData.isEmpty(),this.initView(this.viewElement),this.interval=setInterval(()=>{Math.round(this.app.chartManager.getBeat()*1e3)/1e3!=this.lastBeat&&(this.lastBeat=Math.round(this.app.chartManager.getBeat()*1e3)/1e3,this.setData(this.viewElement))},17),Ee.on("timingModified",this.changeHandler)}onClose(){Ee.off("timingModified",this.changeHandler),clearInterval(this.interval)}initView(e){e.replaceChildren(),e.classList.add("timing-data");const r=document.createElement("div");r.classList.add("padding");const n=document.createElement("div");n.classList.add("label"),n.innerText="Apply to";const s=Ds.create(["All charts","This chart"],this.songTiming?"This chart":"All charts");s.onChange(a=>{this.songTiming=a=="This chart"}),r.appendChild(n),r.appendChild(s.view),Object.values(f0).forEach(a=>{const h=document.createElement("div");h.classList.add("label"),h.innerText=a.title;const u=a.element.create(this.app,()=>this.songTiming);r.appendChild(h),r.appendChild(u)}),e.appendChild(r),this.setData(e)}setData(e){!this.app.chartManager.chart||Object.values(f0).forEach((r,n)=>{const s=e.children[0].children[n*2+3];r.element.update(s,this.app.chartManager.chart.timingData,this.lastBeat)})}}const ec={"chart.CMod":{label:"Toggle CMod",input:{type:"checkbox"},margin:!0},"chart.reverse":{label:"Reverse playfield",input:{type:"checkbox"}},"chart.hideWarpedArrows":{label:"Hide warped arrows",input:{type:"checkbox"}},"chart.doSpeedChanges":{label:"Do speed changes",input:{type:"checkbox"},margin:!0},"chart.speed":{label:"Scroll speed",input:{type:"slider",min:0,max:750,hardMax:2**31-1}},"chart.receptorYPos":{label:"Receptor Y position",input:{type:"slider",min:-400,max:0,hardMin:-(2**31-1),hardMax:2**31-1}},"chart.snap":{label:"Cursor snap",input:{type:"number",step:1,min:1,transformers:{serialize:i=>4/i,deserialize:i=>4/i}},margin:!0},"chart.maxDrawBeats":{label:"Draw length (beats)",input:{type:"slider",min:0,max:30,hardMax:2**31-1}},"chart.maxDrawBeatsBack":{label:"Draw length past receptors (beats)",input:{type:"slider",min:0,max:30,hardMax:2**31-1}},"chart.zoom":{label:"Playfield zoom",input:{type:"slider",min:0,step:1,max:200,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},"chart.drawNoteFlash":{label:"Toggle noteflashes",input:{type:"checkbox"},margin:!0},"audio.assistTick":{label:"Assist tick",input:{type:"checkbox"}},"audio.metronome":{label:"Metronome",input:{type:"checkbox"},margin:!0},"audio.rate":{label:"Playback rate",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},"audio.songVolume":{label:"Song Volume",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}}},"audio.soundEffectVolume":{label:"Sound effect volume",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}},margin:!0},"audio.effectOffset":{label:"Sound effect offset",input:{type:"slider",min:-1,step:.001,max:1,hardMin:-(2**31-1),hardMax:2**31-1}},"play.offset":{label:"Global offset",input:{type:"slider",min:-1,step:.001,max:1,hardMin:-(2**31-1),hardMax:2**31-1},margin:!0},"play.hideBarlines":{label:"Hide barlines during play",input:{type:"checkbox"}},"play.judgmentTilt":{label:"Judgment tilt",input:{type:"checkbox"},margin:!0},"play.timingCollection":{label:"Timing windows",input:{type:"dropdown",advanced:!1,get items(){return Object.keys(li.getCollections())}}},"play.timingWindowScale":{label:"Timing window scale",input:{type:"slider",min:0,step:.001,max:2,hardMax:2**31-1}},"play.timingWindowAdd":{label:"Timing window add",input:{type:"slider",min:0,step:.001,max:1,hardMax:2**31-1}},"performance.antialiasing":{label:"Antialiasing",input:{type:"checkbox"}},"performance.resolution":{label:"Resolution",input:{type:"slider",min:1,step:1,max:4,hardMin:0,hardMax:2**31-1}},"general.smoothAnimations":{label:"Smooth Animations",input:{type:"checkbox",onChange:i=>{i?document.body.classList.add("animated"):document.body.classList.remove("animated")}}},"debug.renderingStats":{label:"Show rendering stats",input:{type:"checkbox"}},"debug.showTimers":{label:"Show rendering timers",input:{type:"checkbox"}},"experimental.speedChangeWaveform":{label:"Allow waveform speed changes",input:{type:"checkbox"}},"chart.renderTimingEvent":{label:"Show timing event boxes"},"chart.waveform":{label:"Waveform"},"chart.waveform.enabled":{label:"Enable waveform",input:{type:"checkbox"}},"chart.waveform.opacity":{label:"Opacity",input:{type:"slider",min:0,max:1,step:.01}},"chart.waveform.lineHeight":{label:"Line height",input:{type:"slider",min:1,max:3,step:.1,hardMax:100}},"general.scrollSensitivity":{label:"Scroll sensitivity",input:{type:"slider",min:0,step:1,max:100,hardMax:2**31-1,transformers:{serialize:i=>i*100,deserialize:i=>i/100}},margin:!0},"general.mousePlacement":{label:"Mouse note placement",input:{type:"checkbox"},margin:!0},general:{label:"General"},chart:{label:"Chart"},audio:{label:"Audio"},play:{label:"Play Mode"},performance:{label:"Performance"},debug:{label:"Debug"},experimental:{label:"Experimental"}};class wk extends Ls{constructor(e){super({title:"Options",width:500,height:400,disableClose:!1,win_id:"user_options",blocking:!1});L(this,"app");this.app=e,this.initView(this.viewElement)}initView(e){e.replaceChildren();const r=document.createElement("div");r.classList.add("padding");const n=document.createElement("div");n.classList.add("pref-selector");const s=this.createDiv();n.replaceChildren(...s),r.appendChild(n),e.appendChild(r)}createDiv(e){e=e??"";const r=this.getObjects(e);return e=e==""?"":e+".",r?Object.entries(r).filter(n=>!$R.includes(e+n[0])).map(n=>this.makeObj(e,n)):[]}makeObj(e,r){const n=document.createElement("div");n.classList.add("pref-item"),n.dataset.id=e+r[0];const s=document.createElement("div");if(s.classList.add("pref-label","collapsed"),n.appendChild(s),typeof r[1]=="object"){const h=document.createElement("img");h.classList.add("icon"),h.classList.add("folder-icon"),h.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAbklEQVRIie2PMQqAMAxFXwfP6qJVPIjYzcOKdUkhQ0BaCoLkLS3k818CjuN8ztApYzIDl7xvmalFsAIZuIFozKPMMrC0CAJwKIkuGVX5KdkmLEm3ci1JSlLKU49yLSmXVG1es0EANvnvInKcP/AA784fpjlWwNQAAAAASUVORK5CYII=",s.appendChild(h)}const a=document.createElement("div");if(a.innerText=r[0],a.classList.add("title"),s.appendChild(a),typeof r[1]!="object"){let h;if(ec[e+r[0]]){const u=ec[e+r[0]];if(!u.input)return n;switch(a.innerText=u.label,u.input.type){case"checkbox":{const d=document.createElement("input"),m=u.input.onChange;d.type="checkbox",d.checked=r[1],d.onblur=null,d.onchange=()=>{z.applyOption([e+r[0],d.checked]),m?.(d.checked)},d.classList.add("pref-input","right"),d.onkeydown=l=>{l.key=="Enter"&&d.blur()},h=d;break}case"dropdown":{if(u.input.advanced){const d=u.input.transformers.deserialize,m=u.input.transformers.serialize,l=u.input.onChange,f=Ds.create(u.input.items,m(r[1]));f.onChange(p=>{z.applyOption([e+r[0],d(p)]),l?.(d(p))}),f.view.classList.add("pref-input","right"),h=f.view}else{const d=u.input.onChange,m=Ds.create(u.input.items,r[1]);m.onChange(l=>{z.applyOption([e+r[0],l]),d?.(l)}),m.view.classList.add("pref-input","right"),h=m.view}break}case"number":{const d=u.input.transformers?.deserialize??(p=>p),m=u.input.transformers?.serialize??(p=>p),l=u.input.onChange,f=ji.create(m(r[1]),u.input.step,u.input.precision,u.input.min,u.input.max);f.onChange=p=>{if(!p){f.setValue(m(r[1]));return}z.applyOption([e+r[0],d(p)]),l?.(d(p))},h=f.view;break}case"slider":{const d=u.input.transformers?.deserialize??(w=>w),m=u.input.transformers?.serialize??(w=>w),l=u.input.onChange,f=document.createElement("div"),p=document.createElement("input");p.type="range",p.min=u.input.min?.toString()??"",p.max=u.input.max?.toString()??"",p.step=u.input.step?.toString()??"1",p.value=m(r[1]).toString();const y=document.createElement("input");y.type="text",y.value=(Math.round(m(r[1])*1e3)/1e3).toString();const _=u.input.min??u.input.hardMin??-Number.MAX_VALUE,v=u.input.max??u.input.hardMax??Number.MAX_VALUE;y.onblur=()=>{let w=Tc(y.value);w=yr(w,_,v),y.value=ve(w,3).toString(),y.blur(),y.value==""?y.value=m(r[1]).toString():z.applyOption([e+r[0],d(w)]),p.value=w.toString(),l?.(d(w))},y.oninput=()=>{y.value=y.value.replaceAll(/[^.0-9+-/*]/g,"")},p.oninput=()=>{const w=parseFloat(p.value);y.value=ve(w,3).toString(),z.applyOption([e+r[0],d(w)])},y.classList.add("pref-input","right"),y.style.width="50px",y.onkeydown=w=>{w.key=="Enter"&&y.blur()},f.appendChild(p),f.appendChild(y),h=f;break}case"text":{const d=u.input.onChange,m=document.createElement("input");m.type="text",m.value=r[1].toString(),m.onblur=()=>{z.applyOption([e+r[0],m.value]),d?.(m.value)},m.classList.add("pref-input","right"),m.onkeydown=l=>{l.key=="Enter"&&m.blur()},h=m;break}}u.margin&&(s.style.marginBottom="8px")}else console.log("No prefrences entry for "+e+r[0]+"!"),h=this.makeDefaultObject(e,r);s.appendChild(h)}else{const h=document.createElement("div");h.classList.add("pref-dd"),ec[e+r[0]]?.label&&(a.innerText=ec[e+r[0]].label),n.appendChild(h),s.onclick=()=>{h.childElementCount==0?(s.classList.remove("collapsed"),h.replaceChildren(...this.createDiv(e+r[0]))):(s.classList.add("collapsed"),h.replaceChildren())}}return n}makeDefaultObject(e,r){const n=z.getDefaultOption(e+r[0]),s=document.createElement("input");return s.type="text",s.value=r[1].toString(),s.onblur=()=>{z.applyOption([e+r[0],s.value])},typeof n=="boolean"&&(s.type="checkbox",s.checked=r[1],s.onblur=null,s.onchange=()=>{z.applyOption([e+r[0],s.checked])}),typeof n=="number"&&(s.oninput=()=>{s.value=s.value.replaceAll(/[^.0-9+-]/g,"")},s.onblur=()=>{s.value=Tc(s.value).toString(),z.applyOption([e+r[0],Number(s.value)])}),s.classList.add("pref-input","right"),s.onkeydown=a=>{a.key=="Enter"&&s.blur()},s}getObjects(e){const r=e.split(".");let n=z;if(e=="")return n;for(const s of r)if(s in n)n=n[s];else return;return n}}var bh=(i=>(i.SHIFT="Shift",i.CTRL="Ctrl",i.ALT="Alt",i.META="Command",i))(bh||{});const _o=navigator.userAgent.indexOf("Mac OS X")>-1,Vi=_o?"Command":"Ctrl",bk={Shift:_o?"\u21E7":"Shift",Ctrl:_o?"\u2303":"Ctrl",Alt:_o?"\u2325":"Alt",Command:"\u2318"},p0={ArrowLeft:"Left",ArrowUp:"Up",ArrowRight:"Right",ArrowDown:"Down",BracketLeft:"[",BracketRight:"]",Semicolon:";",Quote:"'",Backslash:"\\",Slash:"/",Period:".",Comma:",",Backquote:"`",Minus:"-",Equal:"+"},Cs={playback:{label:"Play/Pause",keybinds:[{key:"Space",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.playPause()},decreaseSnap:{label:"Decrease snap",keybinds:[{key:"Left",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.previousSnap()},increaseSnap:{label:"Increase snap",keybinds:[{key:"Right",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.nextSnap()},cursorUp:{label:"Move cursor up",keybinds:[{key:"Up",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.setAndSnapBeat(i.chartManager.getBeat()-Math.max(.001,z.chart.snap))},cursorDown:{label:"Move cursor down",keybinds:[{key:"Down",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.setAndSnapBeat(i.chartManager.getBeat()+Math.max(.001,z.chart.snap))},increaseScrollSpeed:{label:"Increase scroll speed",keybinds:[{key:"Up",mods:[Vi]}],disabled:i=>!i.chartManager.chartView,callback:()=>z.chart.speed=Math.max(10,z.chart.speed*Math.pow(1.01,30))},decreaseScrollSpeed:{label:"Decrease scroll speed",keybinds:[{key:"Down",mods:[Vi]}],disabled:i=>!i.chartManager.chartView,callback:()=>z.chart.speed=Math.max(10,z.chart.speed*Math.pow(1.01,-30))},zoomIn:{label:"Zoom in",keybinds:[{key:"+",mods:[Vi]}],disabled:i=>!i.chartManager.chartView,callback:()=>{z.chart.zoom+=.1,Oe.create("Zoom: "+Math.round(z.chart.zoom*100)+"%")}},zoomOut:{label:"Zoom out",keybinds:[{key:"-",mods:[Vi]}],disabled:i=>!i.chartManager.chartView,callback:()=>{z.chart.zoom=Math.max(.1,z.chart.zoom-.1),Oe.create("Zoom: "+Math.round(z.chart.zoom*100)+"%")}},zoomDefault:{label:"Reset zoom",keybinds:[{key:"0",mods:[Vi]}],disabled:i=>!i.chartManager.chartView,callback:()=>{z.chart.zoom=1,Oe.create("Zoom: "+Math.round(z.chart.zoom*100)+"%")}},newSong:{label:"New Song...",keybinds:[{key:"N",mods:[Vi]}],disabled:!0,callback:()=>0},openSong:{label:"Open Song...",keybinds:[{key:"O",mods:[Vi]}],disabled:i=>!i.chartManager.sm,callback:i=>{if(window.nw){const t=document.createElement("input");t.type="file",t.accept=".sm,.ssc",t.onchange=()=>{i.chartManager.loadSM(t.value)},t.click()}else i.windowManager.openWindow(new Fh(i,{title:"Select an sm/ssc file...",accepted_file_types:[".sm",".ssc"],disableClose:!0,callback:t=>{i.chartManager.loadSM(t)}}))}},songProperties:{label:"Song Properties...",keybinds:[{key:"U",mods:["Shift"]}],disabled:i=>!i.chartManager.sm,callback:i=>i.windowManager.openWindow(new E_(i))},save:{label:"Save...",keybinds:[{key:"S",mods:[Vi]}],disabled:i=>!i.chartManager.sm,callback:i=>i.chartManager.save()},export:{label:"Save and export current song",keybinds:[{key:"E",mods:[Vi]}],disabled:i=>!i.chartManager.sm,callback:i=>{i.chartManager.save(),Ve.saveDirectory(i.chartManager.sm_path)}},openChart:{label:"Chart List",keybinds:[{key:"O",mods:[Vi,"Shift"]}],disabled:i=>!i.chartManager.sm,callback:i=>i.windowManager.openWindow(new A_(i))},timingData:{label:"Edit Timing Data...",keybinds:[{key:"T",mods:["Shift","Alt"]}],disabled:i=>!i.chartManager.chartView,callback:i=>i.windowManager.openWindow(new vk(i))},selectRegion:{label:"Select Region",keybinds:[{key:"Tab",mods:[]}],disabled:i=>!i.chartManager.chart,callback:i=>i.chartManager.selectRegion()},volumeUp:{label:"Increase volume",keybinds:[{key:"Up",mods:["Shift"]}],disabled:!1,callback:()=>{z.audio.songVolume=Math.min(z.audio.songVolume+.05,1),Oe.create("Volume: "+Math.round(z.audio.songVolume*100)+"%")}},volumeDown:{label:"Decrease volume",keybinds:[{key:"Down",mods:["Shift"]}],disabled:!1,callback:()=>{z.audio.songVolume=Math.max(z.audio.songVolume-.05,0),Oe.create("Volume: "+Math.round(z.audio.songVolume*100)+"%")}},effectvolumeUp:{label:"Increase sound effect volume",keybinds:[{key:"Up",mods:["Shift","Alt"]}],disabled:!1,callback:()=>{z.audio.soundEffectVolume=Math.min(z.audio.soundEffectVolume+.05,1),Oe.create("Effect Volume: "+Math.round(z.audio.soundEffectVolume*100)+"%")}},effectvolumeDown:{label:"Decrease sound effect volume",keybinds:[{key:"Down",mods:["Shift","Alt"]}],disabled:!1,callback:()=>{z.audio.soundEffectVolume=Math.max(z.audio.soundEffectVolume-.05,0),Oe.create("Effect Volume: "+Math.round(z.audio.soundEffectVolume*100)+"%")}},rateUp:{label:"Increase playback rate",keybinds:[{key:"Right",mods:["Shift"]}],disabled:i=>i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:()=>{z.audio.rate+=.05,Oe.create("Playback Rate: "+Math.round(z.audio.rate*100)+"%")}},rateDown:{label:"Decrease playback rate",keybinds:[{key:"Left",mods:["Shift"]}],disabled:i=>i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:()=>{z.audio.rate=Math.max(z.audio.rate-.05,.1),Oe.create("Playback Rate: "+Math.round(z.audio.rate*100)+"%")}},rateDefault:{label:"Reset playback rate",keybinds:[],disabled:!1,callback:()=>{z.audio.rate=1,Oe.create("Playback Rate: "+Math.round(z.audio.rate)+"%")}},previousMeasure:{label:"Previous measure",keybinds:[{key:"PageUp",mods:[]},{key:";",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.setAndSnapBeat(Math.max(0,i.chartManager.getBeat()-4))},nextMeasure:{label:"Next measure",keybinds:[{key:"PageDown",mods:[]},{key:"'",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.setAndSnapBeat(i.chartManager.getBeat()+4)},previousNote:{label:"Previous note",keybinds:[{key:",",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.previousNote()},nextNote:{label:"Next note",keybinds:[{key:".",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.nextNote()},jumpChartStart:{label:"Jump to first note",keybinds:[{key:"Home",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.firstNote()},jumpChartEnd:{label:"Jump to last note",keybinds:[{key:"End",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.lastNote()},jumpSongStart:{label:"Jump to song start",keybinds:[{key:"Home",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.setBeat(Math.max(0,i.chartManager.chart.getBeat(0)))},jumpSongEnd:{label:"Jump to song end",keybinds:[{key:"End",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.setBeat(i.chartManager.chart.getBeat(i.chartManager.songAudio.getSongLength()))},assistTick:{label:"Assist Tick",keybinds:[{key:"F7",mods:[]}],disabled:!1,callback:()=>{z.audio.assistTick=!z.audio.assistTick,Oe.create("Assist Tick: "+(z.audio.assistTick?"on":"off"))}},metronome:{label:"Metronome",keybinds:[{key:"F7",mods:["Alt"]}],disabled:!1,callback:()=>{z.audio.metronome=!z.audio.metronome,Oe.create("Metronome: "+(z.audio.metronome?"on":"off"))}},renderWaveform:{label:"Render waveform",keybinds:[{key:"W",mods:["Shift","Alt"]}],disabled:!1,callback:()=>{z.chart.waveform.enabled=!z.chart.waveform.enabled,Oe.create("Waveform: "+(z.chart.waveform.enabled?"on":"off"))}},waveformOptions:{label:"Waveform options...",keybinds:[],disabled:!0,callback:()=>0},XMod:{label:"XMod (Beat-based)",keybinds:[{key:"X",mods:["Shift"]}],disabled:!1,callback:()=>{z.chart.CMod=!1,Oe.create("Switched to XMod")}},CMod:{label:"CMod (Time-based)",keybinds:[{key:"C",mods:["Shift"]}],disabled:!1,callback:()=>{z.chart.CMod=!0,Oe.create("Switched to CMod")}},hideWarpedArrows:{label:"Hide warped arrows (CMod only)",keybinds:[{key:"W",mods:["Shift"]}],disabled:!1,callback:()=>{z.chart.hideWarpedArrows=!z.chart.hideWarpedArrows,Oe.create("Hide Warped Arrows: "+(z.chart.hideWarpedArrows?"on":"off"))}},doSpeedChanges:{label:"Do speed changes (XMod only)",keybinds:[{key:"S",mods:["Shift"]}],disabled:!1,callback:()=>{z.chart.doSpeedChanges=!z.chart.doSpeedChanges,Oe.create("Speed Changes: "+(z.chart.doSpeedChanges?"on":"off"))}},showEq:{label:"Equalizer",keybinds:[{key:"E",mods:["Shift","Alt"]}],disabled:i=>!i.chartManager.songAudio,callback:i=>i.windowManager.openWindow(new yk(i))},previousNoteType:{label:"Previous note type",keybinds:[{key:"N",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.previousNoteType()},nextNoteType:{label:"Next Note Type",keybinds:[{key:"M",mods:[]}],disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()==zt.Play||i.chartManager.getMode()==zt.Record,callback:i=>i.chartManager.nextNoteType()},undo:{label:"Undo",keybinds:[{key:"Z",mods:[Vi]}],disabled:i=>!i.actionHistory.canUndo()||i.chartManager.getMode()!=zt.Edit,callback:i=>i.actionHistory.undo()},redo:{label:"Redo",keybinds:[{key:"Y",mods:[Vi]}],disabled:i=>!i.actionHistory.canRedo()||i.chartManager.getMode()!=zt.Edit,callback:i=>i.actionHistory.redo()},mousePlacement:{label:"Enable Mouse Note Placement",keybinds:[{key:"M",mods:["Shift"]}],disabled:!1,callback:()=>{z.general.mousePlacement=!z.general.mousePlacement,Oe.create("Mouse Note Placement: "+(z.general.mousePlacement?"on":"off"))}},playMode:{label:"Enter/Exit Play Mode",keybinds:[{key:"P",mods:[]}],disabled:i=>!i.chartManager.chartView&&i.chartManager.getMode()!=zt.Record,callback:i=>i.chartManager.setMode(zt.Play)},recordMode:{label:"Enter/Exit Record Mode",keybinds:[{key:"R",mods:[]}],disabled:i=>!i.chartManager.chartView&&i.chartManager.getMode()!=zt.Play,callback:i=>i.chartManager.setMode(zt.Record)},playModeStart:{label:"Play from start",keybinds:[{key:"P",mods:["Shift"]}],disabled:i=>!i.chartManager.chartView&&i.chartManager.getMode()!=zt.Record,callback:i=>{i.chartManager.setBeat(0),i.chartManager.setMode(zt.Play)}},options:{label:"Options",keybinds:[{key:",",mods:[Vi]}],disabled:!1,callback:i=>{i.windowManager.openWindow(new wk(i))}},convertHoldsRolls:{label:"Holds to rolls",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.type=="Hold"&&(t.type="Roll"),t))}},convertHoldsTaps:{label:"Holds/rolls to taps",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{i.chartManager.modifySelection(t=>((t.type=="Hold"||t.type=="Roll")&&(t.type="Tap"),t))}},convertNotesMines:{label:"Notes to mines",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.type="Mine",t))}},convertTapsFakes:{label:"Taps to fakes",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.type=="Tap"&&(t.type="Fake"),t))}},mirrorHorizontally:{label:"Horizontally",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.col=i.chartManager.chart.gameType.flipColumns.horizontal[t.col],t))}},mirrorVertically:{label:"Vertically",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.col=i.chartManager.chart.gameType.flipColumns.vertical[t.col],t))}},mirrorBoth:{label:"Both",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{i.chartManager.modifySelection(t=>(t.col=i.chartManager.chart.gameType.flipColumns.horizontal[t.col],t.col=i.chartManager.chart.gameType.flipColumns.vertical[t.col],t))}},selectAll:{label:"Select All",keybinds:[{key:"A",mods:[Vi]}],disabled:i=>!i.chartManager.chart,callback:i=>{i.chartManager.selection.notes=[...i.chartManager.chart.notedata]}},expand2to1:{label:"Expand 2:1 (8th to 4th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)*2+t,e.beat=Math.round(e.beat*48)/48,ke(e)&&(e.hold*=2,e.hold=Math.round(e.hold*48)/48),e))}},expand3to2:{label:"Expand 3:2 (12th to 8th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)*1.5+t,e.beat=Math.round(e.beat*48)/48,ke(e)&&(e.hold*=1.5,e.hold=Math.round(e.hold*48)/48),e))}},expand4to3:{label:"Expand 4:3 (16th to 2th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)*4/3+t,e.beat=Math.round(e.beat*48)/48,ke(e)&&(e.hold*=4/3,e.hold=Math.round(e.hold*48)/48),e))}},compress1to2:{label:"Compress 1:2 (4th to 8th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)/2+t,e.beat=Math.round(e.beat*48)/48,ke(e)&&(e.hold/=2,e.hold=Math.round(e.hold*48)/48),e))}},compress2to3:{label:"Compress 2:3 (8th to 12th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)/1.5+t,e.beat=Math.round(e.beat*48)/48,ke(e)&&(e.hold/=1.5,e.hold=Math.round(e.hold*48)/48),e))}},compress3to4:{label:"Compress 3:4 (12th to 16th)",keybinds:[],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>{const t=Math.min(...i.chartManager.selection.notes.map(e=>e.beat));i.chartManager.modifySelection(e=>(e.beat=(e.beat-t)*.75+t,e.beat=Math.round(e.beat*48)/48,ke(e)&&(e.hold*=.75,e.hold=Math.round(e.hold*48)/48),e))}},delete:{label:"Delete",keybinds:[{key:"Backspace",mods:[]},{key:"Delete",mods:[]}],disabled:i=>i.chartManager.selection.notes.length==0||i.chartManager.getMode()!=zt.Edit,callback:i=>i.chartManager.deleteSelection()},paste:{label:"Paste",keybinds:[{key:"V",mods:[Vi]}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=zt.Edit,callback:async i=>{const t=await navigator.clipboard.readText();i.chartManager.pasteNotes(t)}},copy:{label:"Copy",keybinds:[{key:"C",mods:[Vi]}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=zt.Edit,callback:async i=>{const t=i.chartManager.copyNotes();t&&await navigator.clipboard.writeText(t)}},cut:{label:"Cut",keybinds:[{key:"X",mods:[Vi]}],preventDefault:!1,disabled:i=>!i.chartManager.chartView||i.chartManager.getMode()!=zt.Edit,callback:async i=>{const t=i.chartManager.copyNotes();t&&await navigator.clipboard.writeText(t),i.chartManager.deleteSelection()}}},Bc=class extends AI{static init(t){this.tex=Ui.create({width:25,height:25,resolution:t.resolution}),this.noBorderTex=Ui.create({width:25,height:25,resolution:t.resolution}),this.graphics.beginFill(16777215,1),this.graphics.lineStyle(1,0),this.graphics.drawRoundedRect(0,0,25,25,5),this.graphics.endFill(),t.render(this.graphics,{renderTexture:this.tex}),this.graphics.clear(),this.graphics.beginFill(16777215,1),this.graphics.lineStyle(1,16777215),this.graphics.drawRoundedRect(0,0,25,25,5),this.graphics.endFill(),t.render(this.graphics,{renderTexture:this.noBorderTex})}constructor(t){super(t?Bc.noBorderTex:Bc.tex,5,5,5,5)}};let gr=Bc;L(gr,"graphics",new Mo),L(gr,"tex",Ui.create({width:25,height:25})),L(gr,"noBorderTex",Ui.create({width:25,height:25}));class fa{static time(t){this.timers[t]||(this.timers[t]={name:t,time:0,startTime:0,lastTime:0}),this.timers[t].startTime=performance.now()}static endTime(t){!this.timers[t]||(this.timers[t].time+=performance.now()-this.timers[t].startTime)}static endFrame(){for(const t in this.timers)this.timers[t].lastTime=this.timers[t].time,this.timers[t].time=0}static getTimers(){return Object.values(this.timers)}}L(fa,"timers",{});class Wf extends we{constructor(e){super();L(this,"manager");this.manager=e}startPlay(){}endPlay(){}}const m0=310;class xk extends Wf{constructor(e){super(e);L(this,"background",new gr);L(this,"maskObj",new gr);L(this,"items",new we);L(this,"texts",new we);L(this,"noteCounts",new we);L(this,"dropdownExtended",!1);L(this,"dropdownBacking",new gr(!1));L(this,"dropdownBackingTarget",0);L(this,"dropdownItems",new we);L(this,"dropdownItemList",[]);L(this,"dropdownMask",new Pe(Ut.WHITE));L(this,"dropdownArrow",Pe.from("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAGKADAAQAAAABAAAAGAAAAADiNXWtAAAAn0lEQVRIDe2QXQrCQAyEG8Wz+uIPeBCxbx62GL+BBGppdRVBhASG7GYnk+x0XUU5UA781gF337zaoIUzq0HjHgzKswSKI85uibNaeqC+DvQIHaa8qPUj3pTy/I6AgQtQ3MAxOzhvo0byK7B8eyurETwM4f4d8dwkhsgmhX4iKFT7bPMUzywhkD/h2G5L8wYawsBTDD2bmecClcuBP3fgDlzXonnbkyRWAAAAAElFTkSuQmCC"));L(this,"noteTypeContainer",new we);L(this,"songTab",new we);L(this,"showEase",0);L(this,"easeVelocity",0);L(this,"lastType","");L(this,"hoverType");L(this,"lastStatsUpdate",0);this.addChild(this.background),this.background.tint=0,this.background.alpha=.3,this.background.width=m0,this.maskObj.width=m0,this.background.zIndex=-1,this.visible=!1,this.sortableChildren=!0,this.addChild(this.maskObj,this.items),this.items.addChild(this.texts,this.songTab),this.items.mask=this.maskObj;const r=new He("",{fontName:"Assistant",fontSize:25});r.name="Mode",r.x=20,r.y=20,this.texts.addChild(r);const n=new He("",{fontName:"Assistant",fontSize:18});n.name="Info",n.x=20,n.y=60,n.anchor.y=0,this.texts.addChild(n);const s=new He("",{fontName:"Assistant",fontSize:18});s.name="Chart",s.x=20,s.y=50,this.texts.addChild(s);const a=new He("",{fontName:"Assistant",fontSize:18});a.name="RStats",a.x=290,a.y=20,a.align="right",a.visible=!1,a.anchor.x=1,this.texts.addChild(a),Ee.on("chartLoaded",()=>{if(ui(this.noteCounts.children,()=>!0),ui(this.noteTypeContainer.children,()=>!0),!this.manager.chartManager.chart)return;const u=this.manager.chartManager.chart.getNotedataStats().counts;let d=0;for(const f in u){const p=new He(`${f}: ${u[f]}`,{fontName:"Assistant",fontSize:18});p.name=f,p.x=20+150*(d%2),p.y=Math.floor(d++/2)*18,this.noteCounts.addChild(p)}let m=0;const l=this.manager.chartManager.getEditingNoteType();for(const f of this.manager.chartManager.chart.gameType.editNoteTypes){const p=this.manager.chartManager.chartView.notefield.getNoteSprite({type:f,beat:0,col:0});p.name=f,p.x=20+16+40*(m%7),p.y=40*Math.floor(m++/7),p.width=32,p.height=32,p.alpha=.3,f==l&&(p.alpha=.9),p.interactive=!0,p.on("mouseenter",()=>{this.hoverType=f,p.alpha==.3&&(p.alpha=.5)}),p.on("mouseleave",()=>{this.hoverType=void 0,p.alpha==.5&&(p.alpha=.3)}),p.on("click",()=>{this.manager.chartManager.setEditingNoteType(f)}),this.noteTypeContainer.addChild(p)}this.dropdownArrow.visible=!0}),this.items.addChild(this.dropdownArrow),this.dropdownArrow.x=20,this.dropdownArrow.y=54,this.dropdownArrow.scale.set(.5),this.dropdownArrow.visible=!1,this.items.addChild(this.dropdownBacking),this.dropdownBacking.x=15,this.dropdownBacking.y=48,this.dropdownBacking.alpha=.3,this.dropdownBacking.interactive=!0,this.dropdownBacking.on("mouseenter",()=>{this.dropdownBackingTarget=.2}),this.dropdownBacking.on("mouseleave",()=>{this.dropdownBackingTarget=0}),this.dropdownItems.x=15,this.dropdownItems.y=72,this.items.addChild(this.noteTypeContainer);const h=this.manager.chartManager.app.renderer.view;h.addEventListener("click",u=>{const d=this.dropdownBacking.toLocal(new Ue(u.clientX,u.clientY)),m=h.getBoundingClientRect();if(d.y-=m.y,d.x>0&&d.y>0&&d.y<22&&d.x<this.dropdownBacking.getLocalBounds().width){if(this.dropdownExtended){this.dropdownExtended=!1;return}this.dropdownItems.removeChildren(),ui(this.dropdownItems.children,()=>!0),this.dropdownExtended=!0;const l=new gr;if(this.dropdownItems.addChild(l),this.dropdownItemList=[],!this.manager.chartManager.sm||!this.manager.chartManager.chart)return;const f=this.manager.chartManager.sm.charts[this.manager.chartManager.chart.gameType.id]??[];if(f.length==0)return;const p=[];for(let _=0;_<f.length;_++){const v=f[_],w=new He(`${v.difficulty} ${v.meter}`,{fontName:"Assistant",fontSize:18});w.x=5,w.y=1.5+_*22,this.dropdownItems.addChild(w),p.push({text:w,chart:v,hovered:!1})}const y=Math.max(...p.map(_=>_.text.width));for(let _=0;_<f.length;_++){const v=new gr;v.width=y+10,v.height=22,v.x=0,v.y=0+_*22,v.alpha=0,v.interactive=!0,v.on("mouseenter",()=>{p[_].hovered=!0}),v.on("mouseleave",()=>{p[_].hovered=!1}),v.on("click",()=>{this.manager.chartManager.loadChart(p[_].chart),this.dropdownExtended=!1}),this.dropdownItems.addChild(v),p[_].bg=v}this.dropdownMask.width=y+10,this.dropdownMask.x=0,this.dropdownMask.y=0,l.width=y+10,l.height=f.length*22,l.x=0,l.y=0,l.tint=5592405,this.dropdownItemList=p,this.dropdownItems.addChild(this.dropdownMask)}else this.dropdownExtended=!1}),this.items.addChild(this.noteCounts),this.addChild(this.dropdownItems),this.dropdownItems.mask=this.dropdownMask,Ee.on("chartModifiedAfter",()=>{if(!this.manager.chartManager.chart)return;const u=this.manager.chartManager.chart.getNotedataStats().counts;for(const d in u){const m=this.noteCounts.getChildByName(d);m.text=`${d}: ${u[d]}`}}),this.noteTypeContainer.y=190,this.noteCounts.y=220}update(){this.visible=!!this.manager.chartManager.sm,this.x=-this.manager.app.renderer.screen.width/2+15,this.y=-this.manager.app.renderer.screen.height/2+20,this.background.height=150,this.maskObj.height=150;const e=this.manager.chartManager.chart,r=this.manager.chartManager.getEditingNoteType();if(this.texts.getChildByName("Mode").text=this.manager.chartManager.getMode(),this.texts.getChildByName("Info").text=`
Time: `+ve(this.manager.chartManager.getTime(),3)+`
Beat: `+ve(this.manager.chartManager.getBeat(),3)+`
BPM: `+(e?ve(e.timingData.getBPM(this.manager.chartManager.getBeat()),3):"-")+`

Note Type: `+(this.hoverType??r),this.texts.getChildByName("Chart").text=e?`${e.difficulty} ${e.meter}`:"No Chart",this.dropdownArrow.visible=!!e,this.dropdownArrow.x=23+this.texts.getChildByName("Chart").width,this.dropdownBacking.width=this.dropdownArrow.x,this.lastType!=r){for(const s of this.noteTypeContainer.children)s.name==r?s.alpha=.9:s.alpha=.3;this.lastType=r}const n=this.texts.getChildByName("RStats");if(n.visible=z.debug.renderingStats,z.debug.renderingStats&&Date.now()-this.lastStatsUpdate>1e3&&(this.lastStatsUpdate=Date.now(),n.text=BR()+` FPS
`+kR()+` TPS
`+DR()+`
`,z.debug.showTimers))for(const s of fa.getTimers())n.text+=s.name+": "+s.lastTime.toFixed(3)+`ms
`;if(z.general.smoothAnimations){const s=Number(this.manager.chartManager.getMode()!=zt.Edit);this.easeVelocity+=(s-this.showEase)*.05,this.showEase+=this.easeVelocity,this.easeVelocity*=.75,this.background.height+=(1-this.showEase)*(120+this.noteCounts.height),this.dropdownBacking.alpha=(this.dropdownBackingTarget-this.dropdownBacking.alpha)*.3+this.dropdownBacking.alpha;for(const a of this.dropdownItemList){const h=a.hovered?.3:0;a.bg.alpha=(h-a.bg.alpha)*.3+a.bg.alpha}if(e){const a=this.manager.chartManager.sm?.charts[e.gameType.id]??[],h=this.dropdownExtended?a.length*22:0;this.dropdownMask.height=(h-this.dropdownMask.height)*.3+this.dropdownMask.height}}else{this.manager.chartManager.getMode()==zt.Edit&&(this.background.height+=120+this.noteCounts.height),this.dropdownBacking.alpha=this.dropdownBackingTarget;for(const s of this.dropdownItemList)s.bg.alpha=s.hovered?.3:0;if(e){const s=this.manager.chartManager.sm?.charts[e.gameType.id]??[],a=this.dropdownExtended?s.length*22:0;this.dropdownMask.height=a}}this.maskObj.height=this.background.height}}const Ak=[15157287,4033015,11152884,8577607,11152884,15376696,11152884,7071886];class Ek extends Wf{constructor(e){super(e);L(this,"barContainer",new By(1500,{position:!0,scale:!0},16384,!0));L(this,"backing",new gr);L(this,"bars");L(this,"barTexture");L(this,"overlay",new Pe(Ut.WHITE));L(this,"lastHeight",0);L(this,"lastCMod");L(this,"mouseDown",!1);L(this,"queued",!1);this.addChild(this.backing),this.visible=!1,this.backing.tint=0,this.backing.alpha=.3,this.barTexture=Ui.create({resolution:this.manager.app.renderer.resolution}),this.bars=new Pe(this.barTexture),this.bars.anchor.set(.5),this.addChild(this.bars),this.overlay.anchor.x=.5,this.overlay.anchor.y=0,this.overlay.alpha=.3,this.lastCMod=z.chart.CMod,this.addChild(this.overlay),this.x=this.manager.app.renderer.screen.width/2-20,Ee.on("chartLoaded",()=>{this.queued=!1,this.populate()}),Ee.on("chartModifiedAfter",()=>{this.queued||this.populate(),this.queued=!0});const r=setInterval(()=>{this.queued&&(this.queued=!1,this.populate())},3e3);this.on("destroyed",()=>clearInterval(r)),this.populate(),this.interactive=!0,this.on("mousedown",n=>{this.mouseDown=!0,this.handleMouse(n)}),this.on("mousemove",n=>{this.mouseDown&&this.handleMouse(n)}),window.onmouseup=()=>{this.mouseDown=!1}}handleMouse(e){if(this.manager.chartManager.getMode()==zt.Play||!this.getChart())return;let r=(this.bars.toLocal(e.global).y+this.bars.height/2)/this.bars.height;r=yr(r,0,1);const n=this.getChart().notedata.at(-1);if(!n)return;const s=n.beat+(ke(n)?n.hold:0),a=this.getChart().getSeconds(s);z.chart.CMod?this.manager.chartManager.setTime(l_(-this.getChart().timingData.getTimingData("OFFSET"),a,r)):this.manager.chartManager.setBeat(s*r)}update(){const e=this.manager.app.renderer.screen.height-40;this.backing.height=e+10,this.backing.position.y=-this.backing.height/2,this.backing.position.x=-this.backing.width/2,this.bars.height=e,this.x=this.manager.app.renderer.screen.width/2-20;const r=this.getChart(),n=this.manager.chartManager.chartView;if(!r||!n){this.visible=!1;return}this.visible=!0;const s=r.notedata.at(-1);if(!s){this.overlay.height=0;return}const a=s.beat+(ke(s)?s.hold:0),h=r.getSeconds(a),u=z.chart.CMod?n.getTimeFromYPos(-this.manager.app.renderer.screen.height/2):n.getBeatFromYPos(-this.manager.app.renderer.screen.height/2,!0),d=z.chart.CMod?n.getTimeFromYPos(this.manager.app.renderer.screen.height/2):n.getBeatFromYPos(this.manager.app.renderer.screen.height/2,!0);let m=to(0,a,u),l=to(0,a,d);z.chart.CMod&&(m=to(-r.timingData.getTimingData("OFFSET"),h,u),l=to(-r.timingData.getTimingData("OFFSET"),h,d)),m=yr(m,0,1),l=yr(l,0,1);const f=(m-.5)*(this.backing.height-10),p=(l-.5)*(this.backing.height-10);this.overlay.y=f,this.overlay.height=p-f,(this.manager.app.renderer.screen.height!=this.lastHeight||this.lastCMod!=z.chart.CMod)&&(this.lastCMod=z.chart.CMod,this.lastHeight=this.manager.app.renderer.screen.height,this.populate()),this.scale.y=z.chart.reverse?-1:1}populate(){const e=this.getChart();if(!e){ui(this.barContainer.children,()=>!0),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture});return}this.visible=!0;let r=0;const n=e.gameType.numCols,s=e.notedata.at(-1),a=this.manager.app.renderer.screen.height-40;if(this.backing.height=a,this.backing.width=n*6+8,this.overlay.width=n*6+8,this.pivot.x=this.backing.width/2,this.barTexture.resize(n*6,a),!s){ui(this.barContainer.children,()=>!0),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture});return}const h=s.beat+(ke(s)?s.hold:0),u=e.getSeconds(h),d=e.timingData.getTimingData("OFFSET");e.notedata.forEach(m=>{let l=this.barContainer.children[r];l||(l=new Pe(Ut.WHITE),l.width=4,this.barContainer.addChild(l)),l.anchor.set(.5),l.height=1,l.x=(m.col+.5)*6;let f=to(0,h,m.beat);if(z.chart.CMod&&(f=to(d,u,m.second)),l.y=f*a,l.tint=Ak[Nf(m.beat)],m.type=="Mine"&&(l.tint=8421504),r++,ke(m)){let p=this.barContainer.children[r];p||(p=new Pe(Ut.WHITE),p.width=4,p.height=2,this.barContainer.addChild(p)),p.anchor.x=.5,p.anchor.y=0,p.x=(m.col+.5)*6;const y=(z.chart.CMod?e.getSeconds(m.beat+m.hold)/u:(m.beat+m.hold)/h)*a+1;p.y=l.y,p.height=y-l.y,m.type=="Hold"&&(p.tint=10526880),m.type=="Roll"&&(p.tint=11379586),r++}}),ui(this.barContainer.children,(m,l)=>l>=r),this.manager.app.renderer.render(this.barContainer,{renderTexture:this.barTexture})}getChart(){return this.manager.chartManager.chart}}const oi=300,ni=150,Tk=[.045,.09,.18,.37,.18,.09,.045];class Sk extends Wf{constructor(e){super(e);L(this,"max",0);L(this,"barlines",new we);L(this,"backgroundRect",new gr);L(this,"background",new we);L(this,"backgroundLines",new we);L(this,"statText",new we);L(this,"meanText");L(this,"medianText");L(this,"modeText");L(this,"stddevText");L(this,"errorMS",[]);L(this,"texts",new we);L(this,"showEase",0);L(this,"easeVelocity",0);L(this,"toggled",!1);L(this,"hovered",!1);L(this,"drag",!1);L(this,"dragStart",0);this.visible=!1,this.backgroundRect.tint=0,this.backgroundRect.alpha=.3,this.background.addChild(this.backgroundRect),this.addChild(this.background),this.addChild(this.backgroundLines),this.interactive=!0,this.on("mousedown",()=>{this.manager.chartManager.getMode()!=zt.Play&&(this.drag=!0,this.dragStart=Date.now())}),window.addEventListener("mousemove",d=>{this.drag&&(this.showEase+=d.movementY/-350)}),this.on("mouseup",()=>{this.drag&&(Date.now()-this.dragStart>400?this.toggled=this.showEase>.5:(this.hovered=!1,this.toggled=!this.toggled))}),window.addEventListener("mouseup",()=>{this.drag=!1}),this.on("mouseenter",()=>{this.hovered=!0}),this.on("mouseleave",()=>{this.hovered=!1});const r=new He("Early",{fontName:"Assistant",fontSize:15});r.x=-oi/2+5,r.y=-ni+10,r.alpha=.3,this.background.addChild(r);const n=new He("Late",{fontName:"Assistant",fontSize:15});n.anchor.x=1,n.x=oi/2-5,n.y=-ni+10,n.alpha=.3,this.background.addChild(n),this.meanText=new He("-",{fontName:"Assistant",fontSize:15}),this.meanText.anchor.x=.5,this.meanText.x=oi/4*-1.5,this.meanText.y=-ni-20,this.statText.addChild(this.meanText),this.medianText=new He("-",{fontName:"Assistant",fontSize:15}),this.medianText.anchor.x=.5,this.medianText.x=oi/4*-.5,this.medianText.y=-ni-20,this.statText.addChild(this.medianText),this.modeText=new He("-",{fontName:"Assistant",fontSize:15}),this.modeText.anchor.x=.5,this.modeText.x=oi/4*.5,this.modeText.y=-ni-20,this.statText.addChild(this.modeText),this.stddevText=new He("-",{fontName:"Assistant",fontSize:15}),this.stddevText.anchor.x=.5,this.stddevText.x=oi/4*1.5,this.stddevText.y=-ni-20,this.statText.addChild(this.stddevText);const s=new He("Mean",{fontName:"Assistant",fontSize:10});s.anchor.x=.5,s.x=oi/4*-1.5,s.y=-ni-30,this.statText.addChild(s);const a=new He("Median",{fontName:"Assistant",fontSize:10});a.anchor.x=.5,a.x=oi/4*-.5,a.y=-ni-30,this.statText.addChild(a);const h=new He("Mode",{fontName:"Assistant",fontSize:10});h.anchor.x=.5,h.x=oi/4*.5,h.y=-ni-30,this.statText.addChild(h);const u=new He("Std Dev.",{fontName:"Assistant",fontSize:10});u.anchor.x=.5,u.x=oi/4*1.5,u.y=-ni-30,this.statText.addChild(u),this.addChild(this.statText),this.addChild(this.barlines),this.addChild(this.texts)}update(){this.visible=!!this.manager.chartManager.gameStats,this.x=-this.manager.chartManager.app.renderer.screen.width/2+20+oi/2,this.y=this.manager.chartManager.app.renderer.screen.height/2-20,this.backgroundRect.width=oi+10,this.backgroundRect.height=ni+210,this.backgroundRect.x=-oi/2-5,this.backgroundRect.y=-ni-210,this.visible=!!this.manager.chartManager.gameStats;for(const e of this.barlines.children)z.general.smoothAnimations?e.height=(e.targetHeight-e.height)*.2+e.height:e.height=e.targetHeight;if(z.general.smoothAnimations){const e=this.manager.chartManager.getMode()==zt.Play||this.toggled?1:Number(this.hovered)*.05;this.drag||(this.easeVelocity+=(e-this.showEase)*.05,this.showEase+=this.easeVelocity),this.easeVelocity<0&&this.showEase<0&&(this.easeVelocity*=-1),this.easeVelocity*=.75,this.y+=(1-this.showEase)*350}else this.manager.chartManager.getMode()!=zt.Play&&(this.y+=350)}newLine(){const e=new Pe(Ut.WHITE);return e.smoothCount=0,e.targetHeight=0,e.anchor.y=1,e.anchor.x=.5,e.height=0,e.visible=!1,this.barlines.addChild(e),e}startPlay(){const e=this.manager.chartManager.gameStats;this.max=0,this.errorMS=[],this.meanText.text="-",this.medianText.text="-",this.modeText.text="-",this.stddevText.text="-",ui(this.barlines.children,()=>!0),ui(this.backgroundLines.children,()=>!0),ui(this.texts.children,()=>!0);const r=li.getCollection(z.play.timingCollection),n=r.getStandardWindows().length+1,s=Math.round(r.maxWindowMS());for(let y=0;y<s*2;y++){const _=this.newLine();_.width=oi/s/2,_.x=(y-s)*_.width,this.barlines.addChild(_)}let a=0;for(const y of r.getStandardWindows().reverse()){const _=Math.round(y.getTimingWindowMS());if(_!=0){for(let v=-1;v<=1;v+=2){const w=new Pe(Ut.WHITE);w.anchor.y=1,w.anchor.x=.5,w.height=ni,w.tint=y.color,w.alpha=.2,w.width=1,w.x=_*v*oi/s/2,this.backgroundLines.addChild(w)}for(let v=-_+s;v<_+s;v++)this.barlines.children[Math.round(v)].tint=y.color}}const h=new Pe(Ut.WHITE);h.anchor.y=1,h.anchor.x=.5,h.height=ni,h.alpha=.2,h.width=1,h.tint=8947848,this.backgroundLines.addChild(h);for(const y of[...r.getStandardWindows(),r.getMissJudgment()]){const _=new He(y.name,{fontName:"Assistant",fontSize:15}),v=new He("0",{fontName:"Assistant",fontSize:15});_.tint=y.color,v.tint=y.color,v.name=y.id,this.texts.addChild(_),this.texts.addChild(v),_.x=-oi/2+10,v.x=-oi/2+140,_.y=130/n*a-ni-170,v.y=130/n*a++-ni-170,_.anchor.y=.5,v.anchor.y=.5,v.anchor.x=1}const u=r.getHoldWindows().length+2;a=0;for(const y of[...r.getHoldWindows(),r.getMineJudgment()]){const _=Is(y)?y.noteType:"Mine",v=new He(_,{fontName:"Assistant",fontSize:15}),w=new He("0",{fontName:"Assistant",fontSize:15});_!="Mine"&&(w.text="0 / "+this.manager.chartManager.chart.notedata.filter(C=>C.type==_).length),v.tint=14540253,w.tint=14540253,w.name=_,this.texts.addChild(v),this.texts.addChild(w),v.x=-oi/2+160,w.x=-oi/2+290,v.y=80/u*a-ni-170,w.y=80/u*a++-ni-170,v.anchor.y=.5,w.anchor.y=.5,w.anchor.x=1}const d=new He("Max Combo",{fontName:"Assistant",fontSize:15}),m=new He("0",{fontName:"Assistant",fontSize:15});d.tint=14540253,m.tint=14540253,m.name="Combo",this.texts.addChild(d),this.texts.addChild(m),d.x=-oi/2+160,m.x=-oi/2+290,d.y=80/u*a-ni-170,m.y=80/u*a++-ni-170,d.anchor.y=.5,m.anchor.y=.5,m.anchor.x=1;const l=new He("0.00 / 0.00",{fontName:"Assistant",fontSize:20});l.tint=14540253,l.x=-oi/2+225,l.y=-ni-62,l.name="Score",this.texts.addChild(l),l.anchor.set(.5);const f=new He("Score / Current Score",{fontName:"Assistant",fontSize:13});f.tint=8947848,f.x=-oi/2+225,f.y=-ni-85,this.texts.addChild(f),f.anchor.set(.5);const p=new He("Play Statistics",{fontName:"Assistant",fontSize:13});p.y=-ni-195,p.anchor.set(.5),this.texts.addChild(p),e.onJudge((y,_)=>{let v="";(ts(_)||va(_))&&(v=_.id),Is(_)&&(v=_.noteType),da(_)&&(v="Mine");const w=this.texts.getChildByName(v);if(Is(_)){const E=w.text.split(" / ")[1];w.text=e.getCount(_)+" / "+E}else To(_)||(w.text=e.getCount(_)+"");if(this.texts.getChildByName("Combo").text=e.getMaxCombo()+"",this.texts.getChildByName("Score").text=ve(e.getScore()*100,2).toFixed(2)+" / "+ve(e.getCumulativeScore()*100,2).toFixed(2),ts(_)||!va(_))return;const C=Math.round(y*1e3);for(let E=-3;E<=3;E++)!this.barlines.children[C+s+E]||(this.barlines.children[C+s+E].smoothCount+=Tk[E+3],this.barlines.children[C+s+E].visible=!0,this.barlines.children[C+s+E].smoothCount>this.max&&(this.modeText.text=C+"ms",this.max=this.barlines.children[C+s+E].smoothCount));this.errorMS.push(y*1e3),this.meanText.text=FR(this.errorMS).toFixed(2)+"ms",this.medianText.text=u_(this.errorMS).toFixed(2)+"ms",this.stddevText.text=LR(this.errorMS).toFixed(2)+"ms",this.redraw()})}redraw(){for(const e of this.barlines.children)e.targetHeight=e.smoothCount*(ni-20)/this.max}}class Ck extends we{constructor(e){super();L(this,"app");L(this,"chartManager");L(this,"children",[]);this.app=e.app,this.chartManager=e,this.addChild(new Ek(this)),this.addChild(new xk(this)),this.addChild(new Sk(this)),this.zIndex=2}update(){this.x=this.app.renderer.screen.width/2,this.y=this.app.renderer.screen.height/2,this.children.forEach(e=>e.update())}startPlay(){this.children.forEach(e=>e.startPlay())}endPlay(){this.children.forEach(e=>e.endPlay())}}const g0={"dance-single":[{label:"Left",col:0,keybinds:[{key:"Left",mods:[]},{key:"A",mods:[]}]},{label:"Down",col:1,keybinds:[{key:"Down",mods:[]},{key:"S",mods:[]}]},{label:"Up",col:2,keybinds:[{key:"Up",mods:[]},{key:"W",mods:[]}]},{label:"Right",col:3,keybinds:[{key:"Right",mods:[]},{key:"D",mods:[]}]}],"dance-double":[{label:"Left",col:4,keybinds:[{key:"Left",mods:[]}]},{label:"Down",col:5,keybinds:[{key:"Down",mods:[]}]},{label:"Up",col:6,keybinds:[{key:"Up",mods:[]}]},{label:"Right",col:7,keybinds:[{key:"Right",mods:[]}]},{label:"Left",col:0,keybinds:[{key:"A",mods:[]}]},{label:"Down",col:1,keybinds:[{key:"S",mods:[]}]},{label:"Up",col:2,keybinds:[{key:"W",mods:[]}]},{label:"Right",col:3,keybinds:[{key:"D",mods:[]}]}],"dance-solo":[{label:"Left",col:0,keybinds:[{key:"Left",mods:[]},{key:"A",mods:[]}]},{label:"UpLeft",col:1,keybinds:[{key:"Q",mods:[]}]},{label:"Down",col:2,keybinds:[{key:"Down",mods:[]},{key:"S",mods:[]}]},{label:"Up",col:3,keybinds:[{key:"Up",mods:[]},{key:"W",mods:[]}]},{label:"UpRight",col:4,keybinds:[{key:"E",mods:[]}]},{label:"Right",col:5,keybinds:[{key:"Right",mods:[]},{key:"D",mods:[]}]}]},ic=["ctrlKey","altKey","shiftKey","metaKey"],rc=[bh.CTRL,bh.ALT,bh.SHIFT,bh.META];class So{constructor(t){L(this,"app");this.app=t,window.addEventListener("keydown",e=>{if(e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||["Meta","Control","Shift","Alt"].includes(e.key))return;const r=[];for(let a=0;a<ic.length;a++)e[ic[a]]&&r.push(rc[a]);const n=So.getKeyNameFromCode(e.code);if((t.chartManager.getMode()==zt.Play||t.chartManager.getMode()==zt.Record)&&t.chartManager.chart?.gameType){const a=g0[t.chartManager.chart?.gameType.id]??[],h=Object.values(a).filter(u=>{for(const d of u.keybinds)if(this.compareModifiers(d.mods,r)&&d.key==n)return!0;return!1});if(h.length>0){if(e.preventDefault(),t.windowManager.isBlocked())return;for(const u of h)if(!e.repeat){t.chartManager.judgeCol(u.col);return}}}const s=Object.values(Cs).filter(a=>{for(const h of a.keybinds)if(this.compareModifiers(h.mods,r)&&h.key==n)return!0;return!1});if(s.length>0){if(s.every(a=>a.preventDefault!=!1)&&e.preventDefault(),t.windowManager.isBlocked())return;for(const a of s){let h=a.disabled;if(h instanceof Function&&(h=h(this.app)),!h&&!(a.disableRepeat&&e.repeat)){a.callback(this.app);return}}}}),window.addEventListener("keyup",e=>{if(e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||["Meta","Control","Shift","Alt"].includes(e.key))return;const r=[];for(let a=0;a<ic.length;a++)e[ic[a]]&&r.push(rc[a]);const n=So.getKeyNameFromCode(e.code);if((t.chartManager.getMode()==zt.Play||t.chartManager.getMode()==zt.Record)&&t.chartManager.chart?.gameType){const a=g0[t.chartManager.chart?.gameType.id]??[],h=Object.values(a).filter(u=>{for(const d of u.keybinds)if(this.compareModifiers(d.mods,r)&&d.key==n)return!0;return!1});if(h.length>0){if(e.preventDefault(),t.windowManager.isBlocked())return;for(const u of h)if(!e.repeat){t.chartManager.judgeColUp(u.col);return}}}const s=Object.values(Cs).filter(a=>{for(const h of a.keybinds)if(this.compareModifiers(h.mods,r)&&h.key==n)return!0;return!1});if(s.length>0){s.every(a=>a.preventDefault!=!1)&&e.preventDefault();for(const a of s){let h=a.disabled;if(h instanceof Function&&(h=h(this.app)),!h&&!(a.disableRepeat&&e.repeat)){a.callbackKeyUp?.(this.app);return}}}})}static getKeyNameFromCode(t){let e=t;return e.startsWith("Digit")&&(e=e.slice(5)),e.startsWith("Key")&&(e=e.slice(3)),e in p0&&(e=p0[e]),e}static getKeybindString(t){return t in Cs?Cs[t].keybinds.map(r=>{const n=rc.filter(s=>r.mods.includes(s)).map(s=>bk[s]).join("");return n+(n!=""?" ":"")+r.key}).join(" / "):(console.log("Couldn't find keybind with id "+t),"")}compareModifiers(t,e){if(t.length!=e.length)return!1;for(const r of rc)if((t.includes(r)?1:0)+(e.includes(r)?1:0)==1)return!1;return!0}}class nc{constructor(t){L(this,"_audioContext",new AudioContext);L(this,"_audioAnalyzer");L(this,"_freqData");L(this,"_gainNode");L(this,"_source");L(this,"_playbackTime",0);L(this,"_startTimestamp",0);L(this,"_rate",1);L(this,"_isPlaying",!1);L(this,"_buffer");L(this,"_delay");L(this,"_listeners",[]);L(this,"_volume",1);L(this,"_destroyed",!1);L(this,"loaded");this._audioAnalyzer=this._audioContext.createAnalyser(),this._audioAnalyzer.fftSize=8192,this._audioAnalyzer.maxDecibels=0,this._freqData=new Uint8Array(this._audioAnalyzer.frequencyBinCount),this._gainNode=this._audioContext.createGain(),this._buffer=this._audioContext.createBuffer(2,1,44100),this.initSource(),this.loaded=new Promise(e=>{this.decodeData(t).then(r=>{if(!!r)return r}).then(r=>this.renderBuffer(r)).catch(r=>{r.name=="EncodingError"?Oe.createFormatted("Failed to load audio: file format not supported","error"):Oe.createFormatted("Failed to load audio: "+r.message,"error")}).finally(()=>{this.initSource(),this.callListeners(),e()})})}async renderBuffer(t){if(!t)return;const e=new OfflineAudioContext(t.numberOfChannels,t.length,t.sampleRate),r=e.createBufferSource();return r.buffer=t,r.connect(e.destination),r.start(),await e.startRendering().then(n=>{this._buffer=n}).catch(()=>{Oe.createFormatted("Failed to load audio: audio rendering failed","error")})}addWaveform(t){this._listeners.push(t)}getSongLength(){return this._buffer.length/this._buffer.sampleRate}callListeners(){this._listeners.forEach(t=>t.refilter())}getFrequencyData(){return this._destroyed?new Uint8Array:(this._audioAnalyzer.getByteFrequencyData(this._freqData),this._freqData)}destroy(){this._destroyed||(this.stop(),this._buffer=this._audioContext.createBuffer(2,1,44100),this._listeners=[],clearTimeout(this._delay),this._destroyed=!0)}async decodeData(t){return new Promise((e,r)=>{if(!t){e();return}this._audioContext.decodeAudioData(t).then(n=>e(n)).catch(n=>r(n))})}getSampleRate(){return this._buffer.sampleRate}getFFTSize(){return this._audioAnalyzer.fftSize}getRawData(){if(this._destroyed)return[];const t=[];for(let e=0;e<this._buffer.numberOfChannels;e++)t.push(this._buffer.getChannelData(e));return t}isPlaying(){return this._destroyed?!1:this._isPlaying}initSource(){this._source=this._audioContext.createBufferSource(),this._source.buffer=this._buffer,this._source.connect(this._audioAnalyzer),this._audioAnalyzer.connect(this._gainNode),this._gainNode.connect(this._audioContext.destination),this._source.playbackRate.value=this._rate,this._isPlaying&&(this.pause(),this.play())}volume(t){this._destroyed||this._volume!=t&&(this._volume=t,this._gainNode.gain.setValueAtTime(t,this._audioContext.currentTime))}rate(t){this._destroyed||this._rate!=t&&(this._rate=t,this._source&&(this._isPlaying&&(this._playbackTime+=(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value),this._startTimestamp=this._audioContext.currentTime,this._source.playbackRate.value=t))}play(){this._destroyed||!this._source||this._isPlaying||(this.initSource(),this._playbackTime<=this._buffer.duration&&(this._playbackTime<0?(clearTimeout(this._delay),this._delay=setInterval(()=>{this.seek()>0&&(clearInterval(this._delay),this._source?.start(0,0))})):this._source.start(0,this._playbackTime)),this._startTimestamp=this._audioContext.currentTime,this._isPlaying=!0)}seek(t){if(!this._destroyed&&!!this._source){if(t===void 0)return this._isPlaying?(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value+this._playbackTime:this._playbackTime;this._isPlaying?(this.stop(),this._playbackTime=t,this.play()):this._playbackTime=t}}pause(){this._destroyed||this.stop(!0)}stop(t){if(!this._destroyed&&!!this._source&&!!this._isPlaying){if(clearTimeout(this._delay),this._isPlaying=!1,this._playbackTime<=this._buffer.duration)try{this._source.stop()}catch{}this._playbackTime=t?(this._audioContext.currentTime-this._startTimestamp)*this._source.playbackRate.value+this._playbackTime:0}}}const Mk=200,Ik={fontName:"Assistant",fontSize:20,fill:["#ffffff"]};class Bk extends we{constructor(e){super();L(this,"children",[]);L(this,"renderer");L(this,"barlineMap",new Map);L(this,"barlineLabelMap",new Map);this.renderer=e}renderThis(e,r,n){this.visible=this.renderer.chartManager.getMode()!=zt.Play||!z.play.hideBarlines,this.children.forEach(s=>s.marked=!1);for(let s=Math.max(0,Math.floor(r));s<n&&!(this.barlineMap.size>Mk);s++){if(z.chart.CMod&&this.renderer.chart.isBeatWarped(s))continue;const[a,h,u]=this.checkBounds(s,e);if(h)break;if(a)continue;const d=this.getBarline(s);if(d.y=u,d.marked=!0,d.deactivated=!1,d.dirtyTime=Date.now(),s%4==0){const m=this.getBarlineLabel(s);m.y=u,m.marked=!0,m.deactivated=!1,m.dirtyTime=Date.now(),m.scale.y=z.chart.reverse?-1:1}}this.children.filter(s=>!s.deactivated&&!s.marked).forEach(s=>{s.deactivated=!0,s.visible=!1,s.type=="barline"&&this.barlineMap.delete(s.beat),s.type=="label"&&this.barlineLabelMap.delete(s.beat)}),ui(this.children,s=>Date.now()-s.dirtyTime>5e3)}checkBounds(e,r){const n=this.renderer.getYPos(e);return n<this.renderer.getUpperBound()?[!0,!1,n]:n>this.renderer.getLowerBound()?e<r||this.renderer.isNegScroll(e)?[!0,!1,n]:[!0,!0,n]:[!1,!1,n]}getBarline(e){if(this.barlineMap.get(e))return this.barlineMap.get(e);let r;for(const n of this.children)n.type=="barline"&&n.deactivated&&(r=n);return r||(r=new Pe(Ut.WHITE),this.addChild(r)),r.type="barline",r.beat=e,r.anchor.x=.5,r.anchor.y=.5,r.width=this.renderer.chart.gameType.notefieldWidth+128,r.height=this.isMeasureLine(e)?4:1,r.visible=!0,this.barlineMap.set(e,r),r}getBarlineLabel(e){if(this.barlineLabelMap.get(e))return this.barlineLabelMap.get(e);let r;for(const n of this.children)n.type=="label"&&n.deactivated&&(r=n);return r||(r=new He("",Ik),this.addChild(r)),r.type="label",r.beat=e,r.deactivated=!1,r.marked=!0,r.anchor.x=1,r.anchor.y=.5,r.x=(this.renderer.chart.gameType.notefieldWidth+128)/-2-16,r.visible=!0,r.text=`${e/4}`,this.barlineLabelMap.set(e,r),r}isMeasureLine(e){return e%4==0}}class Rk extends He{constructor(e){super("",{fontName:"Assistant-Fancy"});L(this,"renderer");this.y=50,this.anchor.set(.5),this.renderer=e}renderThis(){const e=this.renderer.chartManager.gameStats;if(this.visible=this.renderer.chartManager.getMode()==zt.Play,!e)return;const r=e.getCombo()==0?e.getMissCombo():e.getCombo();r<4?this.text="":this.text=r+"",e.getCombo()==0?this.tint=li.getCollection(z.play.timingCollection).getMissJudgment().color:e.getBestJudge()?this.tint=IR(e.getBestJudge().color,Math.sin(Date.now()/225)*.2+1.2):this.tint=16777215}}class kk extends Pe{constructor(){super();L(this,"createTime",-1);L(this,"active",!1);L(this,"type",__);this.y=-40,this.anchor.set(.5)}renderThis(){if(this.visible=this.active,this.active){const e=(Date.now()-this.createTime)/1e3;let r=1.2;if(li.getCollection(z.play.timingCollection).shouldHideNote(this.type)||(r=.8),e<.1){const n=1-(1-e/.1)*(1-e/.1),s=(1-r)*n+r;this.scale.x=.4*s,this.scale.y=.4*s*(z.chart.reverse?-1:1)}else if(e>.6&&e<.8){const n=(e-.6)/.2*(e-.6)/.2;this.scale.x=.4*(1-n),this.scale.y=.4*(1-n)*(z.chart.reverse?-1:1)}else e>.8&&(this.active=!1)}}doJudge(e,r){if(!va(r)&&!ts(r))return;const n=r.judgmentTexture.getTexture(e,r);!n||(this.texture=n,this.texture.updateUvs(),this.active=!0,this.type=r,this.createTime=Date.now(),z.play.judgmentTilt?this.rotation=yr(e,-.05,.05)*300/180*Math.PI:this.rotation=0)}reset(){this.active=!1}}class Pk extends we{constructor(e){super();L(this,"startMarker",new Pe(Ut.WHITE));L(this,"selectionArea",new Pe(Ut.WHITE));L(this,"renderer");this.renderer=e,this.startMarker.alpha=0,this.selectionArea.alpha=0,this.addChild(this.selectionArea,this.startMarker),this.selectionArea.tint=5140387,this.startMarker.anchor.set(.5),this.selectionArea.anchor.x=.5,this.startMarker.height=64,this.selectionArea.height=64,this.selectionArea.width=this.renderer.chart.gameType.notefieldWidth,this.startMarker.width=this.renderer.chart.gameType.notefieldWidth}renderThis(){if(this.renderer.chartManager.getMode()==zt.Play){this.visible=!1;return}this.visible=!0;const e=this.renderer.chartManager.startRegion,r=this.renderer.chartManager.endRegion;e&&!r?(this.startMarker.alpha=Math.sin(Date.now()/320)*.1+.3,this.startMarker.y=this.renderer.getYPos(e)):this.startMarker.alpha=0,e&&r?(this.selectionArea.alpha=Math.sin(Date.now()/320)*.1+.3,this.selectionArea.y=this.renderer.getYPos(Math.min(e,r)),this.selectionArea.height=this.renderer.getYPos(Math.max(e,r))-this.selectionArea.y):this.selectionArea.alpha=0}}const Dk={fontName:"Assistant",fontSize:10,fill:["#ffffff"]},Lk={4:15157287,8:4033015,12:11152884,16:8577607,24:11152884,32:15376696,48:11152884,64:7071886,96:7071886,192:7071886};class Fk extends we{constructor(e){super();L(this,"renderer");L(this,"children",[]);this.renderer=e;for(let r=0;r<2;r++){const n=new we,s=new Mo,a=new He("4",Dk);n.x=(r-.5)*(this.renderer.chart.gameType.notefieldWidth+48),s.rotation=Math.PI/4,s.lineStyle(1,0,1),s.beginFill(16777215),s.drawRect(-12,-12,24,24),s.endFill(),a.anchor.set(.5),n.addChild(s),n.addChild(a),this.addChild(n)}}renderThis(){this.y=z.chart.receptorYPos/z.chart.zoom,this.visible=this.renderer.chartManager.getMode()==zt.Edit||this.renderer.chartManager.getMode()==zt.Record;for(let e=0;e<2;e++){const r=this.children[e],n=r.children[0];n.tint=Lk[4/z.chart.snap]??7368816;const s=r.children[1];s.text=""+(z.chart.snap==0||4/z.chart.snap%1!=0?"":4/z.chart.snap),s.scale.y=z.chart.reverse?-1:1}}}const T_={BPMS:["right",6689568],STOPS:["left",10395910],DELAYS:["left",434902],WARPS:["left",8391509],FAKES:["left",8947848],COMBOS:["right",1006629],SPEEDS:["right",2968693],LABELS:["right",7222045],SCROLLS:["left",1449797],TIMESIGNATURES:["left",7694657],TICKCOUNTS:["right",3382327],BGCHANGES:["left",11358492],FGCHANGES:["left",13578285],ATTACKS:["left",573320]};class Ok extends we{constructor(e){super();L(this,"children",[]);L(this,"renderer");L(this,"timingAreaMap",new Map);this.renderer=e}renderThis(e,r,n,s){this.visible=this.renderer.chartManager.getMode()!=zt.Play||!z.play.hideBarlines,this.children.forEach(a=>a.marked=!1);for(const a of this.renderer.chart.timingData.getTimingData("STOPS","WARPS","DELAYS","FAKES")){if(!z.chart.renderTimingEvent[a.type]||(a.type=="STOPS"||a.type=="DELAYS")&&a.second+Math.abs(a.value)<=s||(a.type=="WARPS"||a.type=="FAKES")&&a.beat+a.value<r)continue;if(a.beat>n)break;if((a.type=="STOPS"||a.type=="DELAYS")&&!(!z.chart.CMod&&a.value<0||z.chart.CMod&&a.value>0)||a.type=="WARPS"&&z.chart.CMod)continue;const[h,u,d,m]=this.checkBounds(a,e);if(u)break;if(h)continue;const l=this.getTimingArea(a);l.y=d,l.height=m,l.marked=!0,l.dirtyTime=Date.now()}this.children.filter(a=>!a.deactivated&&!a.marked).forEach(a=>{a.deactivated=!0,a.visible=!1,this.timingAreaMap.delete(a.event)}),ui(this.children,a=>Date.now()-a.dirtyTime>5e3)}checkBounds(e,r){const n=z.chart.CMod?this.renderer.getYPosFromTime(e.second):this.renderer.getYPos(e.beat);let s=n;switch(e.type){case"STOPS":case"DELAYS":{z.chart.CMod&&e.value>0?s=this.renderer.getYPosFromTime(e.second+e.value):e.value<0&&(s=this.renderer.getYPos(this.renderer.chart.getBeat(e.second+1e-4)));break}case"FAKES":case"WARPS":{z.chart.CMod||(s=this.renderer.getYPos(e.beat+e.value));break}}const a=s-n;return n+a<this.renderer.getUpperBound()?[!0,!1,n,a]:n>this.renderer.getLowerBound()?e.beat<r||this.renderer.isNegScroll(e.beat)?[!0,!1,n,a]:[!0,!0,n,a]:[!1,!1,n,a]}getTimingArea(e){if(this.timingAreaMap.get(e))return this.timingAreaMap.get(e);let r;for(const n of this.children)if(n.deactivated){n.deactivated=!1,r=n;break}return r||(r=new Pe(Ut.WHITE),this.addChild(r)),r.event=e,r.deactivated=!1,r.marked=!0,r.anchor.x=.5,r.anchor.y=0,r.width=this.renderer.chart.gameType.notefieldWidth+128,r.visible=!0,r.tint=T_[e.type][1],r.alpha=.2,this.timingAreaMap.set(e,r),r}}const Nk=1,y0=15,Uk={fontName:"Assistant-Fancy",fontSize:12};class Hk extends we{constructor(e){super();L(this,"barlines",new we);L(this,"barline");L(this,"currentMedian");L(this,"errorText",new He("",Uk));L(this,"errorTextTime",-1);L(this,"renderer");L(this,"target",0);this.y=10,this.renderer=e,this.barline=new Pe(Ut.WHITE),this.barline.anchor.set(.5),this.barline.height=1,this.barline.alpha=.5;const r=new Pe(Ut.WHITE);r.width=2,r.height=y0,r.anchor.set(.5),this.currentMedian=new Mo,this.currentMedian.beginFill(16777215),this.currentMedian.moveTo(0,-10),this.currentMedian.lineTo(5,-15),this.currentMedian.lineTo(-5,-15),this.currentMedian.lineTo(0,-10),this.errorText.y=-25,this.errorText.anchor.set(.5),this.addChild(this.barline),this.addChild(r),this.addChild(this.barlines),this.addChild(this.currentMedian),this.addChild(this.errorText)}renderThis(){this.visible=this.renderer.chartManager.getMode()==zt.Play;for(const e of this.barlines.children){const r=e,n=(Date.now()-r.createTime)/5e3;n<.05?e.alpha=1:n<.3?e.alpha=l_(1,.2,(n-.05)/.25):n<.9?e.alpha=.2:e.alpha=(1-n)*3}this.errorText.alpha=yr((2e3-(Date.now()-this.errorTextTime))/1e3,0,1),this.barline.width=li.getCollection(z.play.timingCollection).maxWindowMS()/1e3*2*400,ui(this.barlines.children,e=>Date.now()-e.createTime>5e3),z.general.smoothAnimations?this.currentMedian.x=(this.currentMedian.x-this.target)*.8+this.target:this.currentMedian.x=this.target,this.errorText.scale.y=z.chart.reverse?-1:1,this.errorText.y=z.chart.reverse?25:-25,this.currentMedian.scale.y=z.chart.reverse?-1:1}addBar(e,r){if(!ts(r)&&!va(r))return;const n=new Pe(Ut.WHITE);n.width=Nk,n.height=y0,n.anchor.set(.5),n.x=e*400,n.tint=r.color,n.createTime=Date.now(),n.miss=ts(r),n.ms=Math.round(e*1e3),this.errorText.tint=r.color,this.errorText.text=(e*1e3).toFixed(1)+"ms",this.errorTextTime=Date.now(),this.barlines.addChild(n),this.target=u_(this.barlines.children.filter(s=>!s.miss).map(s=>s.ms))*.4}reset(){this.currentMedian.x=0,this.target=0,ui(this.barlines.children,()=>!0)}}const Gk={fontName:"Assistant",fontSize:15};class Wk extends we{constructor(e){super();L(this,"children",[]);L(this,"renderer");L(this,"timingBoxMap",new Map);this.renderer=e,this.sortableChildren=!0}renderThis(e,r,n){this.visible=this.renderer.chartManager.getMode()!=zt.Play||!z.play.hideBarlines,this.children.forEach(d=>d.marked=!1);let s=-1,a,h=0,u=0;for(const d of this.renderer.chart.timingData.getTimingData()){if(n<d.beat)break;if(!z.chart.renderTimingEvent[d.type]||r>d.beat)continue;const[m,l,f]=this.checkBounds(d,e);if(l)break;if(m)continue;const p=this.getTimingBox(d),y=T_[d.type]??["right",0];let _=(y[0]=="right"?1:-1)*(this.renderer.chart.gameType.notefieldWidth*.5+64+16);(s!=d.beat||d.second&&a!=d.second)&&(h=0,u=0),y[0]=="left"&&(_-=h),y[0]=="right"&&(_+=u),p.position.x=_,p.textObj.anchor.x=y[0]=="right"?0:1,p.backgroundObj.position.x=-5-(y[0]=="right"?0:p.textObj.width),p.backgroundObj.tint=y[1],y[0]=="left"&&(h+=p.textObj.width+15),y[0]=="right"&&(u+=p.textObj.width+15),s=d.beat,a=d.second,p.y=f,p.marked=!0,p.dirtyTime=Date.now(),p.backgroundObj.position.y=z.chart.reverse?-14:-11,p.textObj.scale.y=z.chart.reverse?-1:1}this.children.filter(d=>!d.deactivated&&!d.marked).forEach(d=>{d.deactivated=!0,d.visible=!1,this.timingBoxMap.delete(d.event)}),ui(this.children,d=>Date.now()-d.dirtyTime>5e3)}checkBounds(e,r){const n=z.chart.CMod&&e.second?this.renderer.getYPosFromTime(e.second):this.renderer.getYPos(e.beat);return n<this.renderer.getUpperBound()?[!0,!1,n]:n>this.renderer.getLowerBound()?e.beat<r||this.renderer.isNegScroll(e.beat)?[!0,!1,n]:[!0,!0,n]:[!1,!1,n]}getTimingBox(e){if(this.timingBoxMap.get(e))return this.timingBoxMap.get(e);let r;for(const s of this.children)if(s.deactivated){s.deactivated=!1,r=s;break}r||(r=new we,r.textObj=new He("",Gk),r.backgroundObj=new gr,r.addChild(r.backgroundObj),r.addChild(r.textObj),this.addChild(r)),r.event=e,r.deactivated=!1,r.marked=!0,r.visible=!0;let n="";switch(e.type){case"BPMS":case"STOPS":case"WARPS":case"DELAYS":case"TICKCOUNTS":case"FAKES":case"SCROLLS":n=ve(e.value,3).toString();break;case"SPEEDS":n=`${ve(e.value,3)}/${ve(e.delay,3)}/${e.unit}`;break;case"LABELS":n=e.value;break;case"TIMESIGNATURES":n=`${ve(e.upper,3)}/${ve(e.lower,3)}`;break;case"COMBOS":n=`${ve(e.hitMult,3)}/${ve(e.missMult,3)}`;break;case"BGCHANGES":case"FGCHANGES":n=e.file;break;case"ATTACKS":n=`${e.mods} (${e.endType}=${e.value})`}return r.textObj.text=n,r.textObj.anchor.y=.5,r.visible=!0,r.backgroundObj.width=r.textObj.width+10,r.backgroundObj.height=25,r.zIndex=e.beat,this.timingBoxMap.set(e,r),r}}const zk=3500;class Vk extends Pe{constructor(e){super();L(this,"lineContainer",new By(1500,{position:!0,scale:!0},16384,!0));L(this,"waveformTex");L(this,"lineTex",Ui.create({width:16,height:16}));L(this,"chartAudio");L(this,"renderer");L(this,"white");L(this,"strippedWaveform");L(this,"lastReZoom");L(this,"lastZoom");L(this,"zoom");L(this,"poolSearch",0);L(this,"lastBeat",0);L(this,"lastTime",0);L(this,"lastHeight",0);L(this,"lastLineHeight",z.chart.waveform.lineHeight);this.renderer=e,this.waveformTex=Ui.create({resolution:Math.min(1,z.performance.resolution)}),this.chartAudio=this.renderer.chartManager.songAudio,this.texture=this.waveformTex,this.white=new Pe(Ut.WHITE),this.white.width=16,this.white.height=16,this.anchor.set(.5),this.lastZoom=this.getZoom(),this.zoom=this.getZoom(),this.lastReZoom=Date.now(),this.chartAudio.addWaveform(this),this.refilter();const r=()=>this.lastBeat=-1;Ee.on("timingModified",r),this.on("destroyed",()=>{Ee.off("timingModified",r)})}async stripWaveform(e){return new Promise(r=>{if(e==null){r();return}this.strippedWaveform=Array.from({length:e.length},()=>[]);const n=this.chartAudio.getSampleRate()/(this.zoom*4);for(let s=0;s<e.length;s++){const a=Math.floor(e[s].length/n);for(let h=0;h<a;h++){const u=Math.floor(n*h);let d=0;for(let m=0;m<n;m++)d=d+Math.abs(e[s][u+m]);this.strippedWaveform[s].push(d/n)}}r()})}refilter(){this.stripWaveform(this.chartAudio.getRawData()),this.lastBeat=-1}renderThis(e,r){this.visible=z.chart.waveform.enabled&&(this.renderer.chartManager.getMode()!=zt.Play||!z.play.hideBarlines),z.chart.waveform.enabled&&(this.chartAudio!=this.renderer.chartManager.getAudio()&&(this.chartAudio=this.renderer.chartManager.getAudio(),this.refilter(),this.chartAudio.addWaveform(this)),this.lastZoom!=this.getZoom()?(this.lastReZoom=Date.now(),this.lastZoom=this.getZoom(),this.lastBeat=-1):Date.now()-this.lastReZoom>120&&this.zoom!=this.getZoom()&&(this.zoom=this.getZoom(),this.refilter()),this.lastLineHeight!=z.chart.waveform.lineHeight&&(this.lastLineHeight=z.chart.waveform.lineHeight,z.chart.waveform.lineHeight<=0&&(z.chart.waveform.lineHeight=1),this.updateLineHeight()),this.waveformTex.resize(Math.min(this.renderer.chartManager.app.renderer.screen.width,(this.strippedWaveform?.length??0)*288*z.chart.zoom),this.renderer.chartManager.app.renderer.screen.height),this.white.alpha=z.chart.waveform.opacity,this.renderer.chartManager.app.renderer.render(this.white,{renderTexture:this.lineTex}),this.strippedWaveform&&(e!=this.lastBeat||r!=this.lastTime||this.renderer.chartManager.app.renderer.screen.height*z.chart.zoom!=this.lastHeight)&&(this.lastBeat=e,this.lastTime=r,this.lastHeight=this.renderer.chartManager.app.renderer.screen.height*z.chart.zoom,this.renderData(e,this.strippedWaveform),this.renderer.chartManager.app.renderer.render(this.lineContainer,{renderTexture:this.waveformTex}),this.tint=z.chart.waveform.color),this.scale.set(1/z.chart.zoom))}renderData(e,r){if(this.resetPool(),z.experimental.speedChangeWaveform&&!z.chart.CMod&&z.chart.doSpeedChanges){const n=z.chart.speed,s=this.renderer.chart.timingData.getSpeedMult(e,this.renderer.chartManager.getTime());let a=e-z.chart.maxDrawBeatsBack;const h=e+z.chart.maxDrawBeats,u=this.renderer.chart.timingData.getTimingData("SCROLLS"),d=this.renderer.chart.timingData.getTimingData("OFFSET"),m=this.renderer.chart.timingData.getBPM(0),l=this.renderer.chart.timingData.getBeatTiming(),f=100/n/s/64/z.chart.zoom,p=this.renderer.chartManager.app.renderer.screen.height;let y=this.renderer.chart.getSeconds(a),_=en(u,a,w=>w.beat);u[_]?.beat!=0&&_--;let v=Math.round(this.renderer.getYPos(a)*z.chart.zoom+this.parent.y);for(;a<h;){const w=u[_]??{beat:0,value:1},C=u[_+1]?.beat??h,E=this.renderer.getYPos(C)*z.chart.zoom+this.parent.y;if(u[_+1]&&(w.value==0||w.value<0&&E>p||w.value>0&&E<0)){_++,a=u[_].beat,v=Math.round(E);continue}const k=f/Math.abs(w.value);for(;a<Math.min(C,h);){if(v<0){if(w.value<0){a=C;break}a+=k*-v,v=0}if(v>p){if(w.value>0){a=h;break}a+=k*(v-p),v=p;continue}a+=k*z.chart.waveform.lineHeight,v+=(w.value>0?1:-1)*z.chart.waveform.lineHeight;const G=Math.floor(a*1e3)/1e3;if(a<=0)y=-d+a*60/m;else if(G>=l[1]?.beat){for(;G>=l[1]?.beat;)l.shift();y=this.renderer.chart.getSeconds(a)}else{let it=(a-l[0].beat)*60/l[0].bpm;l[0].warped&&(it=0),y=Math.max(l[0].secondClamp,l[0].secondAfter+it)}if(y<0)continue;const Q=Math.floor(y*this.zoom*4);for(let Y=0;Y<r.length;Y++){const it=r[Y][Q];if(!it)continue;const J=this.getLine();J.scale.x=it*16*z.chart.zoom,J.y=v,J.x=this.waveformTex.width/2+288*(Y+.5-r.length/2)*z.chart.zoom}}_++,a=C,v=E}}else for(let n=0;n<this.renderer.chartManager.app.renderer.screen.height;n+=z.chart.waveform.lineHeight){const s=this.renderer.getTimeFromYPos((n-this.parent.y)/z.chart.zoom),a=Math.floor(s*this.zoom*4);for(let h=0;h<r.length;h++){const u=r[h][a];if(!u)continue;const d=this.getLine();d.scale.x=u*16*z.chart.zoom,d.y=n,d.x=this.waveformTex.width/2+288*(h+.5-r.length/2)*z.chart.zoom}}this.purgePool()}resetPool(){this.poolSearch=0}purgePool(){ui(this.lineContainer.children,(e,r)=>r>=this.poolSearch)}updateLineHeight(){for(const e of this.lineContainer.children){const r=e;r.height=z.chart.waveform.lineHeight}}getLine(){for(;this.lineContainer.children[this.poolSearch];){const r=this.lineContainer.children[this.poolSearch];return r.visible=!0,this.poolSearch++,r}const e=new Pe(this.lineTex);return e.height=z.chart.waveform.lineHeight,e.anchor.set(.5),e.visible=!0,this.poolSearch++,this.lineContainer.addChild(e),e}getZoom(){return Math.min(z.chart.speed,zk)}}class jk extends we{constructor(e){super();L(this,"chartManager");L(this,"chart");L(this,"speedMult",1);L(this,"lastMousePos");L(this,"lastMouseBeat",-1);L(this,"lastMouseCol",-1);L(this,"lastNoteType","");L(this,"editingCol",-1);L(this,"waveform");L(this,"barlines");L(this,"timingAreas");L(this,"timingBoxes");L(this,"timingBar");L(this,"notefield");L(this,"snapDisplay");L(this,"judgment");L(this,"combo");L(this,"selectionSprite");L(this,"selectionArea");L(this,"selectionBounds");this.chartManager=e,this.chart=e.chart,this.waveform=new Vk(this),this.barlines=new Bk(this),this.timingAreas=new Ok(this),this.timingBoxes=new Wk(this),this.timingBar=new Hk(this),this.notefield=new this.chart.gameType.notefield(this),this.snapDisplay=new Fk(this),this.selectionArea=new Pk(this),this.judgment=new kk,this.combo=new Rk(this),this.selectionSprite=new Pe(Ut.WHITE),this.selectionSprite.visible=!1,this.selectionSprite.alpha=.2,this.addChild(this.waveform),this.addChild(this.barlines),this.addChild(this.timingAreas),this.addChild(this.selectionArea),this.addChild(this.timingBoxes),this.addChild(this.timingBar),this.addChild(this.combo),this.addChild(this.notefield),this.addChild(this.snapDisplay),this.addChild(this.judgment),this.addChild(this.selectionSprite),this.chartManager.app.stage.addChild(this),this.x=this.chartManager.app.renderer.screen.width/2,this.y=this.chartManager.app.renderer.screen.height/2,this.interactive=!0,this.hitArea=new Te(-1e5,-1e5,2e5,2e5);const r=a=>{if(this.editingCol!=-1){const h=z.chart.snap==0?.020833333333333332:z.chart.snap,u=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/h)*h;this.chartManager.editHoldBeat(this.editingCol,u,a.shiftKey)}};let n=0;const s=()=>{if(!this.chartManager.selection.shift&&!this.selectionBounds||n==0)return;const a=this.getYPos(Math.max(0,this.chartManager.getBeat()+n));this.chartManager.setBeat(Math.max(0,this.chartManager.getBeat()+n)),this.selectionBounds&&(this.selectionBounds.start.y+=z.chart.receptorYPos/z.chart.zoom-a)};this.chartManager.app.ticker.add(s),window.addEventListener("keydown",r),this.on("destroyed",()=>{window.removeEventListener("keydown",r),this.removeAllListeners(),this.chartManager.app.ticker.remove(s)}),this.on("mousedown",a=>{this.chartManager.getMode()!=zt.Play&&(z.general.mousePlacement&&this.lastMouseBeat!=-1&&this.lastMouseCol!=-1&&!a.getModifierState("Shift")?(this.chartManager.clearSelection(),this.editingCol=this.lastMouseCol,this.chartManager.setNote(this.lastMouseCol,"mouse",this.lastMouseBeat)):(!a.getModifierState("Control")&&!a.getModifierState("Meta")&&!a.getModifierState("Shift")&&this.chartManager.clearSelection(),this.chartManager.startDragSelection(),this.selectionBounds={start:this.toLocal(a.global),end:this.toLocal(a.global)}))}),this.on("mousemove",a=>{if(this.lastMousePos=this.toLocal(a.global),this.editingCol!=-1){const h=z.chart.snap==0?.020833333333333332:z.chart.snap,u=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/h)*h;this.chartManager.editHoldBeat(this.editingCol,u,a.shiftKey)}this.selectionBounds&&(this.selectionBounds.end=this.toLocal(a.global)),n=Math.max(0,this.lastMousePos.y-this.getLowerBound()+100)/600,this.lastMousePos.y<0&&(n=Math.min(0,this.lastMousePos.y-this.getUpperBound()-100)/600)}),this.on("mouseup",()=>{this.editingCol!=-1&&(this.chartManager.endEditing(this.editingCol),this.editingCol=-1),this.chartManager.endDragSelection(),this.selectionBounds=void 0,n=0})}doJudgment(e,r,n){this.chartManager.getMode()==zt.Play&&(this.judgment.doJudge(r,n),this.timingBar.addBar(r,n)),this.notefield.doJudge(e.col,n)}activateHold(e){this.notefield.activateHold(e)}keyDown(e){this.notefield.keyDown(e)}keyUp(e){this.notefield.keyUp(e)}endPlay(){this.notefield.reset(),this.timingBar.reset(),this.judgment.reset()}renderThis(){const e=this.getBeatWithOffset(),r=this.getTimeWithOffset();this.speedMult=z.chart.doSpeedChanges?this.chart.timingData.getSpeedMult(e,r):1;let n=e+z.chart.maxDrawBeats,s=e-z.chart.maxDrawBeatsBack,a=this.chart.getSeconds(s);if(z.chart.CMod&&(n=this.getBeatFromYPos(this.getLowerBound())+1,s=this.getBeatFromYPos(this.getUpperBound()),a=this.getTimeFromYPos(this.getUpperBound())),this.selectionSprite.visible=!!this.selectionBounds,this.selectionBounds&&(this.selectionSprite.position.x=Math.min(this.selectionBounds.start.x,this.selectionBounds.end.x),this.selectionSprite.position.y=Math.min(this.selectionBounds.start.y,this.selectionBounds.end.y),this.selectionSprite.width=Math.abs(this.selectionBounds.end.x-this.selectionBounds.start.x),this.selectionSprite.height=Math.abs(this.selectionBounds.end.y-this.selectionBounds.start.y)),this.scale.x=z.chart.zoom,this.scale.y=(z.chart.reverse?-1:1)*z.chart.zoom,this.barlines.renderThis(e,s,n),this.timingAreas.renderThis(e,s,n,a),this.timingBoxes.renderThis(e,s,n),this.timingBar.renderThis(),this.judgment.renderThis(),this.combo.renderThis(),this.snapDisplay.renderThis(),this.selectionArea.renderThis(),this.notefield.update(e,s,n),this.waveform.renderThis(e,r),z.general.mousePlacement&&this.lastMousePos&&this.chartManager.getMode()!=zt.Play){const h=z.chart.snap==0?.020833333333333332:z.chart.snap,u=Math.round(this.getBeatFromYPos(this.lastMousePos.y)/h)*h,d=Math.round((this.lastMousePos.x+96)/64);(u!=this.lastMouseBeat||d!=this.lastMouseCol||this.chartManager.getEditingNoteType()!=this.lastNoteType)&&(this.lastMouseBeat=u,this.lastMouseCol=d,this.lastNoteType=this.chartManager.getEditingNoteType(),this.editingCol!=-1&&this.chartManager.editHoldBeat(this.editingCol,u,!1),d>3||d<0?(this.lastMouseBeat=-1,this.lastMouseCol=-1,this.notefield.setGhostNote()):this.notefield.setGhostNote({beat:u,col:this.lastMouseCol,type:this.chartManager.getEditingNoteType()}))}}getTimeWithOffset(){let e=this.chartManager.getTime();return(this.chartManager.getMode()==zt.Play||this.chartManager.getMode()==zt.Record)&&(e+=z.play.offset),e}getBeatWithOffset(){let e=this.chartManager.getBeat();return(this.chartManager.getMode()==zt.Play||this.chartManager.getMode()==zt.Record)&&(e=this.chart.getBeat(this.getTimeWithOffset())),e}getYPos(e){const r=this.getTimeWithOffset(),n=this.getBeatWithOffset();return z.chart.CMod?(this.chart.getSeconds(e)-r)*z.chart.speed/100*64*4+z.chart.receptorYPos/z.chart.zoom:n==e?z.chart.receptorYPos/z.chart.zoom:z.chart.doSpeedChanges?(this.chart.timingData.getEffectiveBeat(e)-this.chart.timingData.getEffectiveBeat(n))*z.chart.speed/100*64*this.speedMult+z.chart.receptorYPos/z.chart.zoom:(e-n)*z.chart.speed/100*64+z.chart.receptorYPos/z.chart.zoom}getYPosFromTime(e){const r=this.getTimeWithOffset();return z.chart.CMod?(e-r)*z.chart.speed/100*64*4+z.chart.receptorYPos/z.chart.zoom:this.getYPos(this.chart.timingData.getBeat(e))}getTimeFromYPos(e){const r=this.getTimeWithOffset();return z.chart.CMod?(e-z.chart.receptorYPos/z.chart.zoom)/z.chart.speed*100/64/4+r:this.chart.getSeconds(this.getBeatFromYPos(e))}getBeatFromYPos(e,r){const n=this.getBeatWithOffset();return z.chart.CMod?this.chart.getBeat(this.getTimeFromYPos(e)):z.chart.doSpeedChanges&&!r?this.chart.getBeatFromEffectiveBeat((e-z.chart.receptorYPos/z.chart.zoom)/64*100/z.chart.speed/this.speedMult+this.chart.timingData.getEffectiveBeat(n)):(e-z.chart.receptorYPos/z.chart.zoom)/64*100/z.chart.speed+n}isNegScroll(e){return z.chart.doSpeedChanges&&(this.speedMult<0||(this.chart.timingData.getTimingEventAtBeat("SCROLLS",e)?.value??1)<0||this.chart.timingData.getBPM(e)<0)}getLowerBound(){return(this.chartManager.app.renderer.screen.height-this.y)/z.chart.zoom+32}getUpperBound(){return-32-this.y/z.chart.zoom}selectionTest(e){if(!this.selectionBounds)return!1;const r=this.selectionSprite.getBounds(),n=e.getBounds();return r.x+r.width>n.x&&r.x<n.x+n.width&&r.y+r.height>n.y&&r.y<n.y+n.height}}class Xk{constructor(t){L(this,"judgmentCounts",new Map);L(this,"holdJudgmentCounts",new Map);L(this,"dancePoints",0);L(this,"maxCumulativeDancePoints",0);L(this,"maxDancePoints",0);L(this,"chartManager");L(this,"notedata");L(this,"dataPoints",[]);L(this,"handlers",[]);L(this,"combo",0);L(this,"missCombo",0);L(this,"maxCombo",0);L(this,"bestJudge");this.notedata=t.chart.notedata,this.chartManager=t,this.bestJudge=li.getCollection(z.play.timingCollection).getStandardWindows()[0],this.calculateMaxDP()}onJudge(t){this.handlers.push(t)}addDataPoint(t,e,r){this.judgmentCounts.has(e)||this.judgmentCounts.set(e,0),this.judgmentCounts.set(e,this.judgmentCounts.get(e)+1),this.dancePoints+=e.dancePoints;const n=this.chartManager.chart.timingData.getTimingEventAtBeat("COMBOS",t[0].beat),s=n?.hitMult??1,a=n?.missMult??1;da(e)||(this.maxCumulativeDancePoints+=li.getCollection(z.play.timingCollection).getMaxDancePoints()),ts(e)?(this.maxCumulativeDancePoints+=t.filter(ke).reduce((h,u)=>h+li.getCollection(z.play.timingCollection).getMaxHoldDancePoints(u.type),0),this.combo=0,this.missCombo+=a,this.bestJudge=void 0):va(e)&&(li.getCollection(z.play.timingCollection).shouldHideNote(e)?(this.combo+=t.length*s,this.combo>this.maxCombo&&(this.maxCombo=this.combo),this.missCombo=0,this.bestJudge&&e.getTimingWindowMS()>this.bestJudge.getTimingWindowMS()&&(this.bestJudge=e)):(this.bestJudge=void 0,this.combo=0)),this.handlers.forEach(h=>h(r,e)),this.dataPoints.push({second:t[0].second,error:r,judgment:e,notes:t})}addHoldDataPoint(t,e){this.judgmentCounts.has(e)||this.judgmentCounts.set(e,0),this.judgmentCounts.set(e,this.judgmentCounts.get(e)+1);const r=li.getCollection(z.play.timingCollection).getHeldJudgement(t);this.holdJudgmentCounts.has(r)||this.holdJudgmentCounts.set(r,[0,0]);const n=this.holdJudgmentCounts.get(r);Is(e)?n[0]++:n[1]++,this.holdJudgmentCounts.set(r,n),this.dancePoints+=e.dancePoints,this.maxCumulativeDancePoints+=li.getCollection(z.play.timingCollection).getMaxHoldDancePoints(t.type),this.handlers.forEach(s=>s(0,e)),To(e)&&(this.bestJudge=void 0)}getScore(){return this.maxDancePoints==0?0:this.dancePoints/this.maxDancePoints}getCumulativeScore(){return this.maxCumulativeDancePoints==0?0:this.dancePoints/this.maxCumulativeDancePoints}getDataPoints(){return this.dataPoints}getMaxCombo(){return this.maxCombo}recalculate(){this.calculateMaxDP(),this.dancePoints=0,this.maxCumulativeDancePoints=0;for(const t of this.holdJudgmentCounts.entries()){const e=t[0];this.dancePoints+=t[0].dancePoints*t[1][0],this.maxCumulativeDancePoints+=(t[1][0]+t[1][1])*li.getCollection(z.play.timingCollection).getMaxHoldDancePoints(e.noteType)}this.judgmentCounts.clear();for(const t of this.dataPoints){let e=li.getCollection(z.play.timingCollection).judgeInput(t.error);(ts(t.judgment)||da(t.judgment))&&(e=t.judgment),this.judgmentCounts.has(e)||this.judgmentCounts.set(e,0),this.judgmentCounts.set(e,this.judgmentCounts.get(e)+1),this.dancePoints+=e.dancePoints,t.judgment=e,da(e)||(this.maxCumulativeDancePoints+=li.getCollection(z.play.timingCollection).getMaxDancePoints()),ts(e)&&(this.maxCumulativeDancePoints+=t.notes.filter(ke).reduce((r,n)=>r+li.getCollection(z.play.timingCollection).getMaxHoldDancePoints(n.type),0))}}calculateMaxDP(){const t=new Map,e=new Map;for(const r of this.notedata)r.type=="Mine"||r.fake||(ke(r)&&(e.has(r.type)||e.set(r.type,0),e.set(r.type,e.get(r.type)+1)),t.has(r.beat)||t.set(r.beat,[]),t.get(r.beat).push(r));this.maxDancePoints=t.size*li.getCollection(z.play.timingCollection).getMaxDancePoints(),this.maxDancePoints+=Array.from(e.entries()).reduce((r,n)=>r+n[1]*li.getCollection(z.play.timingCollection).getMaxHoldDancePoints(n[0]),0)}getCount(t){return this.judgmentCounts.get(t)??0}getCombo(){return this.combo}getMissCombo(){return this.missCombo}getBestJudge(){return this.bestJudge}}const Yk=["TITLE","SUBTITLE","ARTIST","TITLETRANSLIT","SUBTITLETRANSLIT","ARTISTTRANSLIT","GENRE","CREDIT","ORIGIN","BACKGROUND","BANNER","MUSIC","CDTITLE","JACKET","DISCIMAGE","CDIMAGE","PREVIEW","LYRICSPATH","SAMPLESTART","SAMPLELENGTH","SELECTABLE"];class $k{constructor(t){L(this,"charts",{});L(this,"_type");L(this,"other_properties",{});L(this,"properties",{});L(this,"timingData",new v_);L(this,"unloadedCharts",[]);L(this,"loaded");this.loaded=new Promise(e=>{const r=t.name.split(".").pop();r=="sm"||r=="ssc"?this._type=r:e(),t.text().then(n=>{n=n.replaceAll(/\/\/.+/g,"");const s=[...n.matchAll(/#([A-Z]+):([^;]*);/g)];let a=!1,h={};const u=[];for(const d of s)d[1]=="NOTEDATA"&&r=="ssc"||a?(a=!0,h[d[1]]=d[2],d[1]=="NOTES"&&(u.push(h),h={},a=!1)):d[1]=="NOTES"?u.push(d[2]):Yk.includes(d[1])?this.properties[d[1]]=d[2]:d[1]=="OFFSET"||Sc.includes(d[1])?this.timingData.parse(d[1],d[2]):this.other_properties[d[1]]=d[2];this.timingData.reloadCache(),this.charts={};for(const d of u){let m;try{m=new w_(this,d)}catch(l){this.unloadedCharts.push(d),Oe.createFormatted(OR(l),"warn");continue}this.addChart(m)}e()})})}addChart(t){var e,r;(e=this.charts)[r=t.gameType.id]||(e[r]=[]),this.charts[t.gameType.id].push(t),this.charts[t.gameType.id].sort((n,s)=>rn.indexOf(n.difficulty)==rn.indexOf(s.difficulty)?n.meter-s.meter:rn.indexOf(n.difficulty)-rn.indexOf(s.difficulty))}removeChart(t){if(!this.charts[t.gameType.id])return!1;const e=this.charts[t.gameType.id].indexOf(t);return e==-1?!1:(this.charts[t.gameType.id].splice(e,1),!0)}serialize(t){let e="";t=="sm"?(this.other_properties.NITGVERSION&&(e+=this.formatProperty("NITGVERSION",this.other_properties.NITGVERSION)),e+=this.formatProperty("TITLE",this.properties.TITLE),e+=this.formatProperty("SUBTITLE",this.properties.SUBTITLE),e+=this.formatProperty("ARTIST",this.properties.ARTIST),e+=this.formatProperty("MUSIC",this.properties.MUSIC??""),e+=this.formatProperty("BANNER",this.properties.GENRE),e+=this.formatProperty("BACKGROUND",this.properties.BACKGROUND),e+=this.formatProperty("LYRICSPATH",this.properties.LYRICSPATH),e+=this.formatProperty("CDTITLE",this.properties.CDTITLE),e+=this.formatProperty("SAMPLESTART",this.properties.SAMPLESTART),e+=this.formatProperty("SAMPLELENGTH",this.properties.SAMPLELENGTH)):(e+=this.formatProperty("VERSION",this.other_properties.VERSION??.83),e+=this.formatProperty("TITLE",this.properties.TITLE),e+=this.formatProperty("SUBTITLE",this.properties.SUBTITLE),e+=this.formatProperty("ARTIST",this.properties.ARTIST),e+=this.formatProperty("TITLETRANSLIT",this.properties.TITLETRANSLIT),e+=this.formatProperty("SUBTITLETRANSLIT",this.properties.SUBTITLETRANSLIT),e+=this.formatProperty("ARTISTTRANSLIT",this.properties.ARTISTTRANSLIT),e+=this.formatProperty("GENRE",this.properties.GENRE),e+=this.formatProperty("CREDIT",this.properties.CREDIT),e+=this.formatProperty("MUSIC",this.properties.MUSIC??""),e+=this.formatProperty("BANNER",this.properties.BANNER),e+=this.formatProperty("BACKGROUND",this.properties.BACKGROUND),e+=this.formatProperty("JACKET",this.properties.JACKET),e+=this.formatProperty("DISCIMAGE",this.properties.DISCIMAGE),e+=this.formatProperty("CDIMAGE",this.properties.CDIMAGE),e+=this.formatProperty("SELECTABLE",this.properties.SELECTABLE??"YES"),e+=this.formatProperty("LYRICSPATH",this.properties.LYRICSPATH),e+=this.formatProperty("CDTITLE",this.properties.CDTITLE),e+=this.formatProperty("SAMPLESTART",this.properties.SAMPLESTART),e+=this.formatProperty("SAMPLELENGTH",this.properties.SAMPLELENGTH)),e+=this.timingData.serialize(t);for(const r in this.other_properties)r=="VERSION"||r=="NITGVERSION"||(e+=this.formatProperty(r,this.other_properties[r]));e+=`
`;for(const r in this.charts)for(const n of this.charts[r])e+=n.serialize(t)+`
`;for(const r of this.unloadedCharts)if(typeof r=="string")e+="#NOTES:"+r+`
`;else{e+="//---------------"+r.STEPSTYPE+" - "+r.DESCRIPTION+`---------------
`,e+=`#NOTEDATA:;
`,e+=`#CHARTNAME:${r.CHARTNAME};
`,e+=`#CHARTSTYLE:${r.CHARTSTYLE};
`,e+=`#CREDIT:${r.CREDIT};
`,r.MUSIC&&(e+=`#MUSIC:${r.MUSIC};
`),e+=`#STEPSTYPE:${r.STEPSTYPE};
`,e+=`#DESCRIPTION:${r.DESCRIPTION};
`,e+=`#DIFFICULTY:${r.DIFFICULTY};
`,e+=`#METER:${r.METER};
`,e+=`#METERF:${r.METERF??r.METER};
`,e+=`#RADARVALUES:${r.RADARVALUES};
`,e+="#NOTES:";for(const n in r)["NOTEDATA","CHARTNAME","CHARTSTYLE","CREDIT","MUSIC","STEPSTYPE","DESCRIPTION","DIFFICULTY","METER","METERF","RADARVALUES"].includes(n)||(e+=`#${n}:${r[n]};

`)}return e}usesSplitTiming(){for(const t in this.charts)for(const e of this.charts[t])if(!e.timingData.isEmpty())return!0;return!1}formatProperty(t,e){return e||(e=""),"#"+t.toUpperCase()+":"+e+`;
`}}const As=[1,2,3,4,6,8,12,16,24,48,-1];var zt=(i=>(i.View="View Mode",i.Edit="Edit Mode",i.Play="Play Mode",i.Record="Record Mode",i))(zt||{});class qk{constructor(t){L(this,"app");L(this,"songAudio",new nc);L(this,"chartView");L(this,"widgetManager");L(this,"noChartTextA");L(this,"noChartTextB");L(this,"assistTick",new yh.Howl({src:"assets/sound/assist_tick.ogg",volume:.5}));L(this,"me_high",new yh.Howl({src:"assets/sound/metronome_high.ogg",volume:.5}));L(this,"me_low",new yh.Howl({src:"assets/sound/metronome_low.ogg",volume:.5}));L(this,"mine",new yh.Howl({src:"assets/sound/mine.ogg",volume:.5}));L(this,"sm");L(this,"sm_path","");L(this,"chart");L(this,"selection",{notes:[],inProgressNotes:[],timingEvents:[]});L(this,"beat",0);L(this,"time",0);L(this,"holdEditing",[]);L(this,"editNoteTypeIndex",0);L(this,"snapIndex",0);L(this,"partialScroll",0);L(this,"noteIndex",0);L(this,"lastBeat",-1);L(this,"lastSong","");L(this,"mode","Edit Mode");L(this,"lastMode","Edit Mode");L(this,"virtualClipboard","");L(this,"startRegion");L(this,"endRegion");L(this,"gameStats");this.app=t,document.addEventListener("cut",e=>{if(e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const r=this.copyNotes();r&&e.clipboardData?.setData("text/plain",r),this.deleteSelection(),e.preventDefault()},!0),document.addEventListener("copy",e=>{if(e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const r=this.copyNotes();r&&e.clipboardData?.setData("text/plain",r),e.preventDefault(),e.stopImmediatePropagation()},!0),document.addEventListener("paste",e=>{if(e.target.classList.contains("inlineEdit")||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLInputElement||this.mode!="Edit Mode")return;const r=e.clipboardData?.getData("text/plain");r&&this.pasteNotes(r),e.preventDefault(),e.stopImmediatePropagation()},!0),t.view.addEventListener?.("wheel",e=>{if(!(this.sm==null||this.chart==null||this.chartView==null))if(_o&&e.metaKey||!_o&&e.ctrlKey)z.chart.speed=Math.max(10,z.chart.speed*Math.pow(1.01,e.deltaY/5*z.general.scrollSensitivity));else{if(this.mode=="Play Mode"||this.mode=="Record Mode")return;let r=this.beat;const n=z.chart.snap,s=z.chart.speed*(z.chart.reverse?-1:1);if(n==0?(this.partialScroll=0,r=this.beat+e.deltaY/s*z.general.scrollSensitivity):(this.partialScroll+=e.deltaY/s*z.general.scrollSensitivity,Math.abs(this.partialScroll)>n&&(this.partialScroll<0?r=Math.round((this.beat+Math.ceil(this.partialScroll/n)*n)/n)*n:r=Math.round((this.beat+Math.floor(this.partialScroll/n)*n)/n)*n,this.partialScroll%=n)),r=Math.max(0,r),r!=this.beat&&this.setBeat(r),!this.holdEditing.every(a=>a==null))for(let a=0;a<this.holdEditing.length;a++)!this.holdEditing[a]||this.holdEditing[a].type=="mouse"||this.editHoldBeat(a,this.beat,e.shiftKey)}},{passive:!0}),this.widgetManager=new Ck(this),this.noChartTextA=new He("No Chart",{fontName:"Assistant",fontSize:30}),this.noChartTextA.anchor.set(.5),this.noChartTextA.tint=5592405,this.app.stage.addChild(this.noChartTextA),this.noChartTextB=new He("Create a new chart",{fontName:"Assistant",fontSize:15}),this.noChartTextB.anchor.set(.5),this.noChartTextB.tint=5596791,this.noChartTextB.interactive=!0,this.noChartTextB.on("mouseover",()=>{this.noChartTextB.tint=8952234}),this.noChartTextB.on("mouseleave",()=>{this.noChartTextB.tint=5596791}),this.noChartTextB.on("mousedown",()=>{this.app.windowManager.openWindow(new A_(t,Si.getGameType("dance-single")))}),this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,this.noChartTextA.x=this.app.renderer.screen.width/2,this.noChartTextA.y=this.app.renderer.screen.height/2-20,this.noChartTextB.x=this.app.renderer.screen.width/2,this.noChartTextB.y=this.app.renderer.screen.height/2+10,this.app.stage.addChild(this.noChartTextB),this.app.stage.addChild(this.widgetManager),this.app.ticker.add(()=>{this.widgetManager.update(),!(!this.sm||!this.chart||!this.chartView)&&this.chartView?.renderThis()}),setInterval(()=>{if(!this.sm||!this.chart||!this.chartView)return;const e=this.songAudio.seek();if(fa.time("Update Time"),this.songAudio.isPlaying()&&(this.setTime(e,!0),!this.holdEditing.every(a=>!a)))for(let a=0;a<this.holdEditing.length;a++){if(!this.holdEditing[a]||this.holdEditing[a].type=="mouse")continue;let h=this.beat;this.mode=="Record Mode"&&(h=this.chart.getBeat(this.time+z.play.offset));const u=z.chart.snap==0?1/48:z.chart.snap,d=Math.round(h/u)*u,m=this.holdEditing[a],l=Math.max(0,Math.round(Math.max(this.beat,m.endBeat)*48)/48)-Math.max(0,Math.round(Math.min(this.beat,m.startBeat)*48)/48);console.log(l),l*60/this.chart.timingData.getBPM(this.beat)>.3&&this.editHoldBeat(a,d,!1)}const r=this.chart.notedata;let n=!1;for(;this.noteIndex<r.length&&e>r[this.noteIndex].second+z.audio.effectOffset;)this.songAudio.isPlaying()&&this.chart.gameType.gameLogic.shouldAssistTick(r[this.noteIndex])&&(this.mode!="Play Mode"&&this.chartView.doJudgment(r[this.noteIndex],0,__),!n&&z.audio.assistTick&&(this.assistTick.play(),n=!0)),this.noteIndex++;const s=Math.floor(this.chart.getBeat(this.time+z.audio.effectOffset));s!=this.lastBeat&&(this.lastBeat=s,this.songAudio.isPlaying()&&z.audio.metronome&&(this.lastBeat%4==0?this.me_high.play():this.me_low.play())),this.mode=="Play Mode"&&this.chart.gameType.gameLogic.update(this),this.updateSoundProperties(),PR(),fa.endTime("Update Time")},5),Ee.on("resize",()=>{this.chartView&&(this.chartView.x=this.app.renderer.screen.width/2,this.chartView.y=this.app.renderer.screen.height/2),this.noChartTextA.x=this.app.renderer.screen.width/2,this.noChartTextA.y=this.app.renderer.screen.height/2-20,this.noChartTextB.x=this.app.renderer.screen.width/2,this.noChartTextB.y=this.app.renderer.screen.height/2+10}),Ee.on("chartModified",()=>{this.chart&&(this.chart.recalculateStats(),Ee.emit("chartModifiedAfter"))}),window.addEventListener("keyup",e=>{if(this.mode=="Edit Mode"&&e.code.startsWith("Digit")){const r=parseInt(e.code.slice(5))-1;this.endEditing(r)}},!0),window.addEventListener("keydown",e=>{if(this.mode=="Edit Mode"&&!e.target.classList.contains("inlineEdit")&&!(e.target instanceof HTMLTextAreaElement)&&!(e.target instanceof HTMLInputElement)){if(e.code.startsWith("Digit")&&!e.repeat&&!e.ctrlKey&&!e.metaKey&&!e.altKey&&!e.ctrlKey){const r=parseInt(e.code.slice(5))-1;r<(this.chart?.gameType.numCols??4)&&r>-1&&(this.setNote(r,"key"),e.preventDefault(),e.stopImmediatePropagation())}if(!this.holdEditing.every(r=>r==null)){const r=So.getKeyNameFromCode(e.code),n=["cursorUp","cursorDown","previousNote","nextNote","previousMeasure","nextMeasure","jumpChartStart","jumpChartEnd","jumpSongStart","jumpSongEnd"];for(const s of n)if(Cs[s].keybinds.map(a=>a.key).includes(r)){e.preventDefault(),e.stopImmediatePropagation(),Cs[s].callback(this.app);for(let a=0;a<this.holdEditing.length;a++)!this.holdEditing[a]||this.holdEditing[a].type=="mouse"||this.editHoldBeat(a,this.beat,e.shiftKey);return}for(const s of["undo","redo"])if(Cs[s].keybinds.map(a=>a.key).includes(r)){this.holdEditing=[];return}}}},!0),window.addEventListener("keydown",e=>{this.mode!="Play Mode"&&this.mode!="Record Mode"||e.key=="Escape"&&(this.setMode(this.lastMode),this.songAudio.pause())},!0)}getBeat(){return this.beat}getTime(){return this.time}setBeat(t){!this.chart||(this.beat=t,this.time=this.chart.getSeconds(this.beat),this.songAudio.seek(this.time),this.getAssistTickIndex())}setTime(t,e){!this.chart||(this.time=t,this.beat=this.chart.getBeat(this.time),e||(this.songAudio.seek(this.time),this.getAssistTickIndex()))}async loadSM(t){if(Ji.instance.isDirty()){const n=new x_(this.app,"Save","Do you wish to save the current file?",[{label:"Cancel",type:"default"},{label:"No",type:"default"},{label:"Yes",type:"confirm"}]);this.app.windowManager.openWindow(n);const s=await n.resolved;if(s=="Cancel")return;s=="Yes"&&this.save()}if(!t){this.sm_path="",this.sm=void 0,this.songAudio.stop(),this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,this.chartView?.destroy({children:!0});return}this.songAudio.stop(),this.lastSong="",this.sm_path=t,this.time=0,this.beat=0;const r=await(await Ve.getFileHandle(this.sm_path)).getFile();this.sm=new $k(r),await this.sm.loaded,this.noChartTextA.visible=!0,this.noChartTextB.visible=!0,Ee.emit("smLoaded"),await this.loadChart(),Ee.emit("smLoadedAfter"),this.time==0&&this.setBeat(0)}async loadChart(t){if(this.sm!=null){if(t==null){if(this.chart){const e=this.sm.charts[this.chart.gameType.id];e&&e.length>0&&(t=e.at(-1))}if(!t)for(const e of Si.getPriority()){const r=this.sm.charts[e.id];if(r&&r.length>0){t=r.at(-1);break}}if(!t){this.chartView?.destroy({children:!0}),this.chartView?.removeChildren(),this.beat=0,this.time=0,this.chart=void 0,this.chartView=void 0,this.noChartTextA.visible=!0,this.noChartTextB.visible=!0,Ee.emit("chartLoaded"),Ee.emit("chartModified");return}}if(t!=this.chart){if(this.chartView?.destroy({children:!0}),this.chartView?.removeChildren(),this.clearSelection(),this.chart=t,this.beat=this.chart.getBeat(this.time),Ji.instance.reset(),z.play.timingCollection=z.play.defaultTimingCollection[t.gameType.id]??"ITG",this.getAssistTickIndex(),this.chartView=new jk(this),this.chartView.x=this.app.renderer.screen.width/2,this.chartView.y=this.app.renderer.screen.height/2,(this.mode=="Play Mode"||this.mode=="Record Mode")&&this.setMode(this.lastMode),this.chart.getMusicPath()!=this.lastSong){this.lastSong=this.chart.getMusicPath();const e=this.songAudio.isPlaying();await this.loadAudio(),e&&this.songAudio.play()}this.noChartTextA.visible=!1,this.noChartTextB.visible=!1,Oe.create("Loaded chart "+t.difficulty+" "+t.meter+" "+t.gameType.id),Ee.emit("chartLoaded"),Ee.emit("chartModified")}}}async loadAudio(){if(!this.sm||!this.chart)return;this.songAudio.stop(),this.songAudio?.destroy();const t=this.chart.getMusicPath();if(t==""){Oe.createFormatted("Failed to load audio: no audio file","error"),this.songAudio=new nc(void 0);return}const e=await this.getAudioHandle(t);if(e==null){Oe.createFormatted("Failed to load audio: couldn't find audio file "+t,"error"),this.songAudio=new nc(void 0);return}const r=await e.getFile();this.songAudio=new nc(await r.arrayBuffer()),this.songAudio.seek(this.time),this.getAssistTickIndex()}async getAudioHandle(t){let e=await Ve.getFileHandleRelativeTo(this.sm_path,t);if(e)return e;const r=await Ve.getDirectoryFiles(zr(this.sm_path));return e=r.filter(n=>n.name.toLowerCase()==Ts(t).toLowerCase())[0],e?(Oe.createFormatted("Failed to locate audio file "+t+", using file "+e.name+" instead","warn"),e):(e=r.filter(n=>Uc.includes(xn(n.name)))[0],e&&Oe.createFormatted("Failed to locate audio file "+t+", using file "+e.name+" instead","warn"),e)}getAudio(){return this.songAudio}updateSoundProperties(){this.setEffectVolume(z.audio.soundEffectVolume),this.setVolume(z.audio.songVolume),this.setRate(z.audio.rate)}setRate(t){this.songAudio.rate(t)}setVolume(t){this.songAudio.volume(t)}setEffectVolume(t){this.assistTick.volume()!=t&&this.assistTick.volume(t),this.me_high.volume()!=t&&this.me_high.volume(t),this.me_low.volume()!=t&&this.me_low.volume(t),this.mine.volume()!=t&&this.mine.volume(t)}getAssistTickIndex(){if(this.sm==null||this.chart==null||this.chartView==null||this.chart.notedata.length==0){this.noteIndex=0;return}this.noteIndex=en(this.chart.notedata,this.time,t=>t.second)+1,this.noteIndex>=1&&this.time<=this.chart.notedata[this.noteIndex-1].second&&this.noteIndex--}playPause(){this.songAudio.isPlaying()?this.songAudio.pause():this.songAudio.play()}setAndSnapBeat(t){const e=Math.max(.001,z.chart.snap);let r=Math.round(t/e)*e;r=Math.max(0,r),this.setBeat(r)}previousSnap(){this.snapIndex=(this.snapIndex-1+As.length)%As.length,z.chart.snap=As[this.snapIndex]==-1?0:1/As[this.snapIndex]}nextSnap(){this.snapIndex=(this.snapIndex+1+As.length)%As.length,z.chart.snap=As[this.snapIndex]==-1?0:1/As[this.snapIndex]}removeDuplicateBeats(t){if(t.length===0)return t;const e=[t[0]];for(let r=1;r<t.length;r++)t[r-1]!==t[r]&&e.push(t[r]);return e}previousNote(){if(this.sm==null||this.chart==null||this.chartView==null||this.chart.notedata.length==0)return;const t=this.chart.notedata.filter(ke).map(n=>n.beat+n.hold);let e=this.chart.notedata.map(n=>n.beat).concat(t).sort((n,s)=>n-s);e=this.removeDuplicateBeats(e);let r=en(e,this.beat);this.beat==e[r]&&r--,this.setBeat(e[Math.max(0,r)])}nextNote(){if(this.sm==null||this.chart==null||this.chartView==null||this.chart.notedata.length==0)return;const t=this.chart.notedata.filter(ke).map(n=>n.beat+n.hold);let e=this.chart.notedata.map(n=>n.beat).concat(t).sort((n,s)=>n-s);e=this.removeDuplicateBeats(e);let r=en(e,this.beat);this.beat>=e[r]&&r++,this.setBeat(e[Math.min(e.length-1,r)])}firstNote(){this.sm==null||this.chart==null||this.chartView==null||this.chart.notedata.length!=0&&this.setBeat(this.chart.notedata[0].beat)}lastNote(){if(this.sm==null||this.chart==null||this.chartView==null||this.chart.notedata.length==0)return;const t=this.chart.notedata[this.chart.notedata.length-1];this.setBeat(t.beat+(ke(t)?t.hold:0))}setNote(t,e,r){if(this.sm==null||this.chart==null||this.chartView==null)return;r=r??this.beat,r=Math.max(0,Math.round(r*48)/48);const n=this.chart.notedata.filter(a=>a.col!=t?!1:Math.abs(a.beat-r)<.003?!0:ke(a)&&a.beat<=r&&a.beat+a.hold>=r),s={startBeat:r,endBeat:r,roll:!1,originalNote:void 0,type:e,removedNotes:n};this.holdEditing[t]=s,n.length==0&&(s.originalNote={beat:r,col:t,type:this.getEditingNoteType()}),this.getAssistTickIndex(),this.app.actionHistory.run({action:()=>{s.removedNotes.forEach(a=>this.chart.removeNote(a)),s.originalNote&&this.chart.addNote(s.originalNote)},undo:()=>{s.originalNote&&this.chart.removeNote(s.originalNote),s.removedNotes.forEach(a=>this.chart.addNote(a))}})}editHoldBeat(t,e,r){if(this.sm==null||this.chart==null||this.chartView==null)return;const n=this.holdEditing[t];if(n==null||e==n.startBeat&&e==n.endBeat)return;if(n.startBeat=Math.max(0,Math.round(Math.min(e,n.startBeat)*48)/48),n.endBeat=Math.max(0,Math.round(Math.max(e,n.endBeat)*48)/48),n.roll||(n.roll=r),!n.originalNote)this.chart.addNote({beat:n.startBeat,col:t,type:n.roll?"Roll":"Hold",hold:n.endBeat-n.startBeat});else{const a={beat:n.startBeat,type:n.roll?"Roll":"Hold",hold:n.endBeat-n.startBeat};(a.beat!=n.originalNote.beat||a.type!=n.originalNote.type||!ke(n.originalNote)||a.hold!=n.originalNote.hold)&&this.chart.modifyNote(n.originalNote,a)}n.originalNote={beat:n.startBeat,col:t,type:n.roll?"Roll":"Hold",hold:n.endBeat-n.startBeat};const s=this.chart.notedata.filter(a=>a.beat==n.originalNote.beat&&a.col==n.originalNote.col||a.col!=t?!1:a.beat>=n.startBeat&&a.beat<=n.endBeat?!0:ke(a)&&a.beat+a.hold>=n.startBeat&&a.beat+a.hold<=n.endBeat);n.removedNotes=n.removedNotes.concat(s),s.forEach(a=>this.chart.removeNote(a)),this.getAssistTickIndex()}endEditing(t){this.holdEditing[t]=void 0}previousNoteType(){const t=this.chart?.gameType.editNoteTypes.length??0;this.editNoteTypeIndex=(this.editNoteTypeIndex-1+t)%t}nextNoteType(){const t=this.chart?.gameType.editNoteTypes.length??0;this.editNoteTypeIndex=(this.editNoteTypeIndex+1+t)%t}getEditingNoteType(){return this.chart?.gameType.editNoteTypes[this.editNoteTypeIndex]??""}setEditingNoteType(t){if(!this.chart)return;const r=(this.chart?.gameType.editNoteTypes).indexOf(t);r!=-1&&(this.editNoteTypeIndex=r)}getMode(){return this.mode}setMode(t){if(!(!this.chart||!this.chartView)){if(this.mode==t){(t=="Play Mode"||t=="Record Mode")&&(this.setMode(this.lastMode),this.songAudio.pause());return}if(this.lastMode=this.mode,this.mode=t,this.mode=="Play Mode"){this.chart.notedata.forEach(e=>{e.gameplay={hideNote:!1,hasHit:!1}});for(const e of this.chart.notedata)if(e.second<this.time)e.gameplay.hasHit=!0;else break;this.chart.gameType.gameLogic.reset(this),this.gameStats=new Xk(this),this.widgetManager.startPlay(),this.songAudio.seek(Math.max(0,this.time)-1),this.songAudio.play()}else this.mode=="Record Mode"?(this.songAudio.seek(Math.max(0,this.time)-1),this.songAudio.play()):(this.chartView.endPlay(),this.chart?.notedata.forEach(e=>e.gameplay=void 0))}}judgeCol(t){if(!(!this.chart||!this.chartView)){if(this.mode=="Play Mode")this.chart.gameType.gameLogic.keyDown(this,t);else if(this.mode=="Record Mode"){const e=this.chart.getBeat(this.time+z.play.offset),r=z.chart.snap==0?1/48:z.chart.snap,n=Math.round(e/r)*r;this.setNote(t,"key",n)}}}judgeColUp(t){!this.chart||!this.chartView||(this.mode=="Play Mode"?this.chart.gameType.gameLogic.keyUp(this,t):this.mode=="Record Mode"&&this.endEditing(t))}async save(){if(!this.sm)return;if(!Ji.instance.isDirty()){Oe.create("Saved");return}const t=this.sm_path.split("/"),e=t.pop().split(".").slice(0,-1).join("."),r=t.join("/");!this.sm.usesSplitTiming()&&await Ve.getFileHandle(r+"/"+e+".sm")&&Ve.writeFile(r+"/"+e+".sm",this.sm.serialize("sm")),await Ve.getFileHandle(r+"/"+e+".ssc")&&Ve.writeFile(r+"/"+e+".ssc",this.sm.serialize("ssc")),this.sm.usesSplitTiming()?Oe.create("Saved. No SM file since split timing was used."):Oe.create("Saved"),Ji.instance.setLimit()}clearSelection(){this.selection={notes:[],inProgressNotes:[],timingEvents:[]}}startDragSelection(){this.selection.inProgressNotes=[]}endDragSelection(){this.selection.notes=this.selection.notes.concat(this.selection.inProgressNotes)}addNoteToDragSelection(t){this.selection.inProgressNotes.push(t)}removeNoteFromDragSelection(t){const e=this.selection.inProgressNotes.indexOf(t);e!=-1&&this.selection.inProgressNotes.splice(e,1)}addNoteToSelection(t){this.selection.notes.push(t)}removeNoteFromSelection(t){const e=this.selection.notes.indexOf(t);e!=-1&&this.selection.notes.splice(e,1)}addEventToSelection(t){this.selection.timingEvents.push(t)}selectRegion(){if(this.endRegion&&(this.startRegion=void 0,this.endRegion=void 0),!this.startRegion){this.clearSelection(),this.startRegion=this.beat;return}if(!this.endRegion){this.endRegion=this.beat,this.endRegion<this.startRegion&&(this.endRegion=this.startRegion,this.startRegion=this.beat),this.chart?.notedata.filter(t=>t.beat>=this.startRegion&&t.beat<this.endRegion).filter(t=>!this.selection.notes.includes(t)).forEach(t=>this.addNoteToSelection(t));return}}modifySelection(t){const e=this.selection.notes,r=structuredClone(this.selection.notes).map(t).sort((a,h)=>a.beat==h.beat?a.col-h.col:a.beat-h.beat);if(r.length==0)return;let n=en(this.chart.notedata,r[0].beat,a=>a.beat);const s=[];for(const a of r){let h=n;const u=ke(a);for(;this.chart.notedata[n]&&this.chart.notedata[n].beat<=a.beat+(u?a.hold:0);){const d=this.chart.notedata[n];n++,d.beat<a.beat&&(h=n),!e.includes(d)&&d.col==a.col&&(d.beat==a.beat&&s.push(d),u&&d.beat>a.beat&&d.beat<=a.beat+a.hold&&s.push(d))}n=h}this.app.actionHistory.run({action:()=>{this.chart.removeNotes(e.concat(s)),this.selection.notes=this.chart.addNotes(r)},undo:()=>{this.chart.removeNotes(r),this.chart.addNotes(s),this.selection.notes=this.chart.addNotes(e)}})}deleteSelection(){if(this.selection.notes.length==0)return;const t=this.selection.notes;this.app.actionHistory.run({action:()=>{this.chart.removeNotes(t)},undo:()=>{this.selection.notes=this.chart.addNotes(t)}})}pasteNotes(t){const e=r0(t)??r0(this.virtualClipboard);if(!e||e.length==0)return;e.map(s=>(s.beat+=this.beat,s.beat=Math.round(s.beat*48)/48,s)).sort((s,a)=>s.beat==a.beat?s.col-a.col:s.beat-a.beat);let r=en(this.chart.notedata,e[0].beat,s=>s.beat);const n=[];for(const s of e){let a=r;const h=ke(s);for(;this.chart.notedata[r]&&this.chart.notedata[r].beat<=s.beat+(h?s.hold:0);){const u=this.chart.notedata[r];r++,u.beat<s.beat&&(a=r),u.col==s.col&&(u.beat==s.beat&&n.push(u),h&&u.beat>s.beat&&u.beat<=s.beat+s.hold&&n.push(u))}r=a}this.app.actionHistory.run({action:()=>{this.chart.removeNotes(n),this.selection.notes=this.chart.addNotes(e)},undo:()=>{this.chart.removeNotes(e),this.chart.addNotes(n)}})}copyNotes(){if(this.selection.notes.length==0)return;const t=Math.min(...this.selection.notes.map(n=>n.beat)),e=structuredClone(this.selection.notes).map(n=>(n.beat-=t,n)).sort((n,s)=>n.beat==s.beat?n.col-s.col:n.beat-s.beat),r=UR(e);return this.virtualClipboard=r,r}}const Kk={file:{type:"menu",title:"File",options:[{type:"selection",id:"newSong"},{type:"selection",id:"openSong"},{type:"seperator"},{type:"selection",id:"save"},{type:"selection",id:"export"}]},edit:{type:"menu",title:"Edit",options:[{type:"selection",id:"cut"},{type:"selection",id:"copy"},{type:"selection",id:"paste"},{type:"seperator"},{type:"selection",id:"undo"},{type:"selection",id:"redo"},{type:"seperator"},{type:"checkbox",id:"mousePlacement",checked:()=>z.general.mousePlacement}]},view:{type:"menu",title:"View",options:[{type:"dropdown",title:"Cursor",options:[{type:"selection",id:"cursorUp"},{type:"selection",id:"cursorDown"},{type:"seperator"},{type:"selection",id:"previousNote"},{type:"selection",id:"nextNote"},{type:"seperator"},{type:"selection",id:"previousMeasure"},{type:"selection",id:"nextMeasure"},{type:"seperator"},{type:"selection",id:"jumpChartStart"},{type:"selection",id:"jumpChartEnd"},{type:"seperator"},{type:"selection",id:"jumpSongStart"},{type:"selection",id:"jumpSongEnd"}]},{type:"dropdown",title:"Snap",options:[{type:"selection",id:"decreaseSnap"},{type:"selection",id:"increaseSnap"}]},{type:"dropdown",title:"Scroll",options:[{type:"checkbox",id:"XMod",checked:()=>!z.chart.CMod},{type:"checkbox",id:"CMod",checked:()=>z.chart.CMod},{type:"seperator"},{type:"selection",id:"increaseScrollSpeed"},{type:"selection",id:"decreaseScrollSpeed"}]},{type:"dropdown",title:"Zoom",options:[{type:"selection",id:"zoomIn"},{type:"selection",id:"zoomOut"},{type:"seperator"},{type:"selection",id:"zoomDefault"}]},{type:"dropdown",title:"Waveform",options:[{type:"checkbox",id:"renderWaveform",checked:()=>z.chart.waveform.enabled},{type:"selection",id:"waveformOptions"}]},{type:"seperator"},{type:"selection",id:"playMode"},{type:"selection",id:"playModeStart"},{type:"seperator"},{type:"selection",id:"recordMode"},{type:"seperator"},{type:"checkbox",id:"hideWarpedArrows",checked:()=>z.chart.hideWarpedArrows},{type:"checkbox",id:"doSpeedChanges",checked:()=>z.chart.doSpeedChanges}]},chart:{type:"menu",title:"Chart",options:[{type:"selection",id:"openChart"},{type:"seperator"},{type:"selection",id:"songProperties"},{type:"seperator"},{type:"selection",id:"timingData"}]},selection:{type:"menu",title:"Selection",options:[{type:"dropdown",title:"Convert",options:[{type:"selection",id:"convertHoldsRolls"},{type:"selection",id:"convertHoldsTaps"},{type:"selection",id:"convertNotesMines"},{type:"selection",id:"convertTapsFakes"}]},{type:"dropdown",title:"Mirror",options:[{type:"selection",id:"mirrorHorizontally"},{type:"selection",id:"mirrorVertically"},{type:"selection",id:"mirrorBoth"}]},{type:"dropdown",title:"Stretch",options:[{type:"selection",id:"expand2to1"},{type:"selection",id:"expand3to2"},{type:"selection",id:"expand4to3"},{type:"seperator"},{type:"selection",id:"compress1to2"},{type:"selection",id:"compress2to3"},{type:"selection",id:"compress3to4"}]},{type:"seperator"},{type:"selection",id:"selectAll"}]},audio:{type:"menu",title:"Audio",options:[{type:"checkbox",id:"assistTick",checked:()=>z.audio.assistTick},{type:"checkbox",id:"metronome",checked:()=>z.audio.metronome},{type:"seperator"},{type:"dropdown",title:()=>"Volume ("+Math.round(z.audio.songVolume*100)+"%)",options:[{type:"selection",id:"volumeUp"},{type:"selection",id:"volumeDown"}]},{type:"dropdown",title:()=>"Effect Volume ("+Math.round(z.audio.soundEffectVolume*100)+"%)",options:[{type:"selection",id:"effectvolumeUp"},{type:"selection",id:"effectvolumeDown"}]},{type:"dropdown",title:()=>"Rate ("+Math.round(z.audio.rate*100)+"%)",options:[{type:"selection",id:"rateUp"},{type:"selection",id:"rateDown"},{type:"seperator"},{type:"selection",id:"rateDefault"}]},{type:"seperator"},{type:"selection",id:"showEq"}]},help:{type:"menu",title:"Help",options:[{type:"selection",id:"options"}]}};class Zk{constructor(t,e){L(this,"app");L(this,"view");this.app=t,this.view=e;const r=Object.values(Kk).map(n=>this.createElement(n));e.replaceChildren(...r)}createElement(t){if(t.type=="seperator"){const e=document.createElement("div");return e.classList.add("seperator"),e}if(t.type=="selection"||t.type=="checkbox"||t.type=="dropdown"){const e=document.createElement("div"),r=document.createElement("div"),n=document.createElement("div");let s;if(t.type=="selection"||t.type=="checkbox"){const a=Cs[t.id];s=document.createElement("div"),s.innerText=So.getKeybindString(t.id),s.classList.add("keybind","unselectable"),n.innerText=a.label;let h=a.disabled;typeof h=="function"&&(h=h(this.app)),h&&e.classList.add("disabled"),e.addEventListener("click",()=>{if(h)return;a.callback(this.app),e.closest(".menu-main").querySelector(".menubar-dropdown").replaceChildren()})}else s=document.createElement("img"),s.classList.add("icon"),s.src=nr.CHEVRON,s.style.transform="rotate(-90deg)",n.innerText=typeof t.title=="function"?t.title(this.app):t.title;if(r.appendChild(n),r.appendChild(s),e.appendChild(r),e.classList.add("menu-item"),r.classList.add("menu-item-title","menu-hover"),n.classList.add("title","unselectable"),t.type=="dropdown"){const a=document.createElement("div");e.appendChild(a),a.classList.add("menubar-dropdown"),t.options.map(h=>this.createElement(h)).forEach(h=>a.appendChild(h))}if(t.type=="checkbox"){let a=t.checked;typeof a=="function"&&(a=a(this.app)),a&&(n.innerText="\u2713 "+n.innerText)}return e}if(t.type=="menu"){const e=document.createElement("div"),r=document.createElement("div"),n=document.createElement("div");return e.appendChild(r),r.innerText=t.title,e.appendChild(n),r.classList.add("title","unselectable"),e.classList.add("menu-item","menu-main"),r.classList.add("menu-hover"),n.classList.add("menubar-dropdown","unselectable"),e.onmouseenter=()=>{n.replaceChildren(...t.options.map(s=>this.createElement(s)))},e.onmouseleave=()=>{n.replaceChildren()},e}return document.createElement("div")}}const Qk=`#TITLE:New Song;
#SUBTITLE:;
#ARTIST:;
#TITLETRANSLIT:;
#SUBTITLETRANSLIT:;
#ARTISTTRANSLIT:;
#GENRE:;
#CREDIT:;
#BANNER:;
#BACKGROUND:;
#LYRICSPATH:;
#CDTITLE:;
#MUSIC:;
#OFFSET:0;
#SAMPLESTART:0.000000;
#SAMPLELENGTH:0.000000;
#SELECTABLE:YES;
#BPMS:0.000000=120.000000;
#STOPS:;
#BGCHANGES:;
#FGCHANGES:;
#KEYSOUNDS:;
#ATTACKS:;
`,_0={window_options:{title:"Open a Song",width:300,height:160,disableClose:!0,win_id:"select_sm_initial"},view:[{title:"Open",options:[{label:window.nw?"Open an existing song":"Import a song folder",element:i=>{const t=document.createElement("button");return t.innerHTML=window.nw?"Open...":"Upload...",t.onclick=()=>{if(window.nw){const e=document.createElement("input");e.type="file",e.accept=".sm,.ssc",e.onchange=()=>{i.chartManager.loadSM(e.value),i.windowManager.getWindowById("select_sm_initial").closeWindow()},e.click()}else i.windowManager.openWindow(new Fh(i,{title:"Select an sm/ssc file...",accepted_file_types:[".sm",".ssc"],disableClose:!0,callback:e=>{i.chartManager.loadSM(e),i.windowManager.getWindowById("select_sm_initial").closeWindow()}}))},t}}]},{title:"New",options:[{label:"Create a new song",element:i=>{const t=document.createElement("button");return t.innerHTML="New Song",t.onclick=async()=>{let e="New Song";if(await Ve.getDirectoryHandle(e)){let r=2;for(;await Ve.getDirectoryHandle(e);)e=`New Song ${r++}`}await Ve.writeFile(e+"/song.sm",Qk),await i.chartManager.loadSM(e+"/song.sm"),i.windowManager.openWindow(new E_(i,!0,async r=>{r?i.windowManager.getWindowById("select_sm_initial").closeWindow():(await Ve.removeDirectory(e),i.chartManager.loadSM())}))},t}}]}]};class Jk extends Ls{constructor(e){super(_0.window_options);L(this,"app");this.app=e,this.initView(this.viewElement)}initView(e){e.replaceChildren(),e.classList.add("options");const r=document.createElement("div");r.classList.add("padding"),_0.view.forEach(n=>{const s=document.createElement("div");s.innerText=typeof n.title=="function"?n.title(this.app):n.title,s.classList.add("title"),r.appendChild(s);const a=document.createElement("div");a.classList.add("section"),n.options.forEach(h=>{const u=document.createElement("div");u.classList.add("container");const d=document.createElement("div");d.classList.add("label");const m=h.element(this.app);d.innerText=typeof h.label=="function"?h.label(this.app):h.label,u.appendChild(d),u.appendChild(m),a.appendChild(u)}),r.appendChild(a)}),e.appendChild(r)}}class tP{constructor(t,e){L(this,"view");L(this,"windows",[]);L(this,"app");this.app=t,this.view=e}unfocusAll(){for(const t of this.view.querySelectorAll(".focused"))t.classList.remove("focused")}isBlocked(){return!this.windows.every(t=>!t.options.blocking)}openWindow(t){if(t.options.win_id){const e=this.getWindowById(t.options.win_id);if(e){e.focus();return}}t.addToManager(this),this.windows.push(t)}removeWindow(t){this.windows.splice(this.windows.indexOf(t),1)}getWindowById(t){for(const e of this.windows)if(e.options.win_id==t)return e}}class v0{constructor(){L(this,"renderer");L(this,"ticker");L(this,"stage");L(this,"view");L(this,"options");L(this,"keybinds");L(this,"chartManager");L(this,"windowManager");L(this,"menubarManager");L(this,"actionHistory");L(this,"lastWidth",window.innerWidth);L(this,"lastHeight",window.innerHeight);if(window.nw){const t=nw.Window.get();t.enterFullscreen(),window.addEventListener("keydown",e=>{(e.key=="r"&&(e.metaKey||e.ctrlKey)||e.key=="F5")&&(e.preventDefault(),t.reload())})}z.loadOptions(),setInterval(()=>z.saveOptions(),1e4),z.general.smoothAnimations&&document.body.classList.add("animated"),this.registerFonts(),this.view=document.getElementById("pixi"),this.stage=new we,this.stage.sortableChildren=!0,this.renderer=new ba({backgroundColor:1579292,antialias:z.performance.antialiasing,width:this.view.clientWidth,height:this.view.clientHeight,resolution:z.performance.resolution,autoDensity:!0,view:this.view}),this.ticker=new xi,this.ticker.maxFPS=120,this.ticker.add(()=>{fa.time("Render Time"),this.renderer.render(this.stage),fa.endTime("Render Time"),fa.endFrame(),RR()},pa.LOW),this.ticker.start(),this.stage.sortableChildren=!0,gr.init(this.renderer),this.options=z,this.chartManager=new qk(this),this.menubarManager=new Zk(this,document.getElementById("menubar")),this.windowManager=new tP(this,document.getElementById("windows")),this.actionHistory=new Ji(this),this.registerListeners(),this.keybinds=new So(this),this.onResize(),console.log("smeditor is currently a work in progress. check the github repo for more info!"),this.windowManager.openWindow(new Jk(this)),window.onunload=()=>{z.saveOptions()}}registerFonts(){Qi.from("Assistant",{fontFamily:"Assistant",fontSize:20,fill:"white"},{chars:[["a","z"],["A","Z"],"!@#$%^&*()~{}[]:.-?=,","0123456789/"," "],resolution:window.devicePixelRatio}),Qi.from("Assistant-Fancy",{fontFamily:"Assistant",fontSize:40,fontWeight:"700",fill:["#dddddd","#ffffff"],fillGradientType:Ph.LINEAR_VERTICAL,stroke:11184810,strokeThickness:3},{chars:[["a","z"],["A","Z"],"!@#$%^&*()~{}[]:.-?=,","0123456789/"," "],resolution:window.devicePixelRatio})}registerListeners(){window.addEventListener("keydown",function(t){t.code=="Tab"&&t.preventDefault(),t.code=="Enter"&&t.target instanceof HTMLButtonElement&&t.preventDefault()}),window.addEventListener("dragstart",function(t){t.target instanceof HTMLImageElement&&t.preventDefault()}),setInterval(()=>{(this.lastHeight!=window.innerHeight||this.lastWidth!=window.innerWidth)&&(this.lastHeight=window.innerHeight,this.lastWidth=window.innerWidth,this.onResize(),Ee.emit("resize"))},100),window.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy"}),window.addEventListener("drop",t=>{if(window.nw){t.stopPropagation(),t.preventDefault();let e="";for(const r of t.dataTransfer.files)if(r.path)if(xn(r.path)==".ssc"){e=r.path;break}else e==""&&xn(r.path)==".sm"&&(e=r.path);e!=""&&(this.chartManager.loadSM(e),this.windowManager.getWindowById("select_sm_initial")?.closeWindow())}else Ve.handleDropEvent(t).then(e=>{const r=new Fh(this,{title:"Select an sm/ssc file...",accepted_file_types:[".sm",".ssc"],disableClose:!0,callback:n=>{this.chartManager.loadSM(n),this.windowManager.getWindowById("select_sm_initial")?.closeWindow()},onload:()=>{r.getAcceptableFile(e??"").then(n=>r.selectPath(n))}});this.windowManager.openWindow(r)})})}onResize(){const t=window.innerWidth,e=window.innerHeight-document.getElementById("menubar").clientHeight;this.renderer.screen.width=t,this.renderer.screen.height=e,this.view.width=t*this.renderer.resolution,this.view.height=e*this.renderer.resolution,this.view.style.width=`${t}px`,this.view.style.height=`${e}px`}}document.querySelector("body").innerHTML=`<div id="view-wrapper"> 
            <div id="menubar"></div>
            <div id="waterfall"></div>
            <canvas id="pixi"></canvas>
          </div> 
          <div id="blocker" style="display: none"></div>
          <div id="windows"></div>
        `;tB.load({google:{families:["Assistant:200,300,400,500,600,700,800"]},active:w0,inactive:w0,classes:!1});window.fs=Ve;function w0(){const i=document.createElement("canvas");i.getContext("webgl")||i.getContext("experimental-webgl")?c_().includes("Safari")?(document.querySelector("body").innerHTML=`<div class='browser-unsupported'>
      <div class='browser-unsupported-item'>
      <h1>Safari is currently not supported</h1>
      <div>Please use Chrome/Firefox instead.</div>
      <div class='browser-unsupported-detail'>Check the console for more info.</div>
      </div>
    </div>`,console.log(`SMEditor is not supported for Safari due to various issues involving rendering and sound.
      PIXI.js, the library used in SMEditor, takes an extremely long time to load and does not perform well on Safari.
      Additionally, many audio files cannot be played in Safari.
      If you still want to try loading SMEditor, run the command runSafari()`),window.runSafari=()=>{document.querySelector("body").innerHTML=`<div id="view-wrapper"> 
            <div id="menubar"></div>
            <div id="waterfall"></div>
            <canvas id="pixi"></canvas>
          </div> 
          <div id="blocker" style="display: none"></div>
          <div id="windows"></div>
        `,window.app=new v0,window.runSafari=void 0}):window.app=new v0:document.querySelector("body").innerHTML=`<div class='browser-unsupported'>
      <div class='browser-unsupported-item'>
      <h1>WebGL is not enabled</h1>
      <div>Please visit your browser settings and enable WebGL.</div>
      </div>
    </div>`}export{jR as F,_a as _,nP as a,Mf as b,si as c,iP as g};
